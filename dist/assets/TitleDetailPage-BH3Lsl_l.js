import{c as y,f as p,s as u,h as g,j as e,P as c,l as m,L as f}from"./index-Be1QrzZ4.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=y("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x=y("Clapperboard",[["path",{d:"M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Z",key:"1tn4o7"}],["path",{d:"m6.2 5.3 3.1 3.9",key:"iuk76l"}],["path",{d:"m12.4 3.4 3.1 4",key:"6hsd6n"}],["path",{d:"M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z",key:"ltgou9"}]]);function j(r){return p({queryKey:["similar-titles",r],enabled:!!r,queryFn:async()=>{if(!r)return[];const{data:t,error:l}=await u.functions.invoke("similar-titles",{body:{titleId:r,limit:16}});return l?(console.warn("[useSimilarTitles] edge function error:",l),[]):((t==null?void 0:t.items)??[]).map(s=>({id:s.id,title:s.title,year:s.year??null,runtimeMinutes:s.runtimeMinutes??null,type:s.type??null,posterUrl:s.posterUrl??null}))}})}function N(r,t){return p({queryKey:["trailer",r,t],enabled:!!r,queryFn:async()=>{const{data:l,error:a}=await u.functions.invoke("fetch-trailer",{method:"POST",body:{title:r,year:t}});return a?(console.warn("[TitleDetailPage] trailer fetch error:",a),null):l??null},staleTime:1e3*60*60})}const v=({external_ratings:r})=>{if(!r)return null;const{imdb_rating:t,rt_tomato_meter:l,metacritic_score:a}=r,s=typeof t=="number"&&!Number.isNaN(t)&&t>0,i=typeof l=="number"&&!Number.isNaN(l)&&l>0,o=typeof a=="number"&&!Number.isNaN(a)&&a>0;return!s&&!i&&!o?null:e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-[11px] text-mn-text-muted",children:[s&&e.jsxs("span",{className:"inline-flex items-center rounded-full border border-mn-border-subtle px-2 py-0.5",children:[e.jsx("span",{className:"mr-1 font-semibold",children:"IMDb Rating"}),t.toFixed(1)]}),i&&e.jsxs("span",{className:"inline-flex items-center rounded-full border border-mn-border-subtle px-2 py-0.5",children:[e.jsx("span",{className:"mr-1 font-semibold",children:"Tomatometer"}),l,"%"]}),o&&e.jsxs("span",{className:"inline-flex items-center rounded-full border border-mn-border-subtle px-2 py-0.5",children:[e.jsx("span",{className:"mr-1 font-semibold",children:"MC"}),a]})]})},k=()=>{const{titleId:r}=g(),{data:t,isLoading:l,isError:a}=p({queryKey:["title-detail",r],enabled:!!r,queryFn:async()=>{if(!r)return null;const{data:n,error:h}=await u.from("titles").select(`
          id,
          title,
          year,
          type,
          poster_url,
          backdrop_url,
          external_ratings (
            imdb_rating,
            rt_tomato_meter,
            metacritic_score
          )
        `).eq("id",r).maybeSingle();if(h)throw h;return n}}),s=N((t==null?void 0:t.title)??null,(t==null?void 0:t.year)??null),i=s.data,o=j(r??null);if(!r)return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-3 pb-6 pt-2 sm:px-4 lg:px-6",children:[e.jsx(c,{title:"Title details",description:"Pick something from search, your diary, or the feed to see its details.",icon:x}),e.jsx(m,{children:e.jsxs("p",{className:"text-sm text-mn-text-secondary",children:["No title was specified for this page. Try opening it from search, your diary, or the"," ","home feed."]})})]});if(l)return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-3 pb-6 pt-2 sm:px-4 lg:px-6",children:[e.jsx(c,{title:"Loading title",icon:x}),e.jsx(m,{children:e.jsx("p",{className:"text-sm text-mn-text-secondary",children:"Fetching title details…"})})]});if(a||!t)return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-3 pb-6 pt-2 sm:px-4 lg:px-6",children:[e.jsx(c,{title:"Title not found",icon:x}),e.jsxs(m,{children:[e.jsx("p",{className:"text-sm text-mn-text-secondary",children:"We couldn't find that title."}),e.jsx(f,{to:"/search",className:"mt-3 inline-block text-sm text-mn-primary underline",children:"Back to search"})]})]});const d=[];return t.year&&d.push(String(t.year)),t.type&&d.push(t.type),e.jsxs("div",{className:"mx-auto flex min-h-[60vh] max-w-5xl flex-col gap-4 px-3 pb-6 pt-2 sm:px-4 lg:px-6",children:[t.backdrop_url&&e.jsxs("div",{className:"relative overflow-hidden rounded-3xl border border-mn-border-subtle bg-mn-bg-elevated/80 shadow-mn-soft",children:[e.jsx("img",{src:t.backdrop_url,alt:t.title??"Backdrop",className:"h-48 w-full object-cover sm:h-56 md:h-64"}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-t from-mn-bg/90 via-mn-bg/30 to-transparent"})]}),e.jsx(c,{title:t.title??"Untitled",description:d.length>0?d.join(" · "):"Title details",icon:x,badge:t.type??void 0}),e.jsx(v,{external_ratings:t.external_ratings}),e.jsx(m,{children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[e.jsx("div",{className:"w-28 flex-shrink-0 sm:w-32 md:w-40",children:t.poster_url?e.jsx("img",{src:t.poster_url,alt:t.title??"Poster",className:"aspect-[2/3] w-full rounded-mn-card object-cover shadow-mn-card"}):e.jsx("div",{className:"flex aspect-[2/3] items-center justify-center rounded-mn-card border border-dashed border-mn-border-subtle bg-mn-bg/70 text-xs text-mn-text-muted",children:"No poster available"})}),e.jsxs("div",{className:"flex flex-1 flex-col gap-3",children:[s.isLoading&&e.jsx("p",{className:"text-xs text-mn-text-secondary",children:"Loading trailer…"}),i&&i.videoId&&e.jsxs("div",{className:"mt-1 space-y-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-1.5 rounded-full bg-mn-primary/10 px-2.5 py-1 text-[11px] font-medium text-mn-primary",children:[e.jsx(b,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Official trailer"})]}),e.jsx("div",{className:"aspect-video w-full max-w-2xl",children:e.jsx("iframe",{className:"h-full w-full rounded-2xl",src:`https://www.youtube.com/embed/${i.videoId}`,title:`${t.title??"Trailer"}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})]}),e.jsxs("div",{className:"rounded-2xl border border-dashed border-mn-border-subtle/70 bg-mn-bg/70 px-3 py-3 text-[12px] text-mn-text-secondary",children:[e.jsx("p",{className:"font-semibold text-mn-text-primary",children:"More coming soon"}),e.jsx("p",{className:"mt-1 text-[11.5px] text-mn-text-muted",children:"This early version will grow to show where to watch, your diary entry, ratings, and friends' reactions."})]}),o.data&&o.data.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"mb-2 text-sm font-heading font-semibold text-mn-text-primary",children:"Similar titles"}),e.jsx("div",{className:"-mx-1 overflow-x-auto pb-1",children:e.jsx("div",{className:"flex snap-x snap-mandatory gap-2 px-1",children:o.data.map(n=>e.jsxs(f,{to:`/title/${n.id}`,className:"group flex w-[140px] shrink-0 snap-start flex-col overflow-hidden rounded-2xl border border-mn-border-subtle/80 bg-mn-bg-elevated/80 shadow-mn-soft",children:[e.jsx("div",{className:"relative h-32 overflow-hidden",children:n.posterUrl?e.jsx("img",{src:n.posterUrl,alt:n.title,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-mn-bg-subtle text-[10px] text-mn-text-muted",children:"No poster"})}),e.jsxs("div",{className:"flex flex-1 flex-col justify-between px-2.5 py-2",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"line-clamp-2 text-[12px] font-semibold text-mn-text-primary",children:n.title}),e.jsx("p",{className:"text-[10px] text-mn-text-muted",children:[n.year,n.type].filter(Boolean).join(" · ")})]}),e.jsxs("span",{className:"mt-1 inline-flex items-center gap-1 text-[10px] font-medium text-mn-primary group-hover:underline",children:[e.jsx("span",{children:"Open"}),e.jsx(b,{className:"h-3 w-3","aria-hidden":"true"})]})]})]},n.id))})})]})]})]})})]})};export{k as default};
