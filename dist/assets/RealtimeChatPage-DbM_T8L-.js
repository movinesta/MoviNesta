import{j as e,L as w,r as l,s as C,e as S,k as M,P as E,M as A,l as R}from"./index-Be1QrzZ4.js";import{c as h,B as I}from"./Button-2ZmH2Yg5.js";import{S as k}from"./send-JzWMe0if.js";const B=({message:t,isOwnMessage:s,showHeader:r})=>{var u,c;const n=t.user.name?`/u/${t.user.name}`:null,d=((c=(u=t.user.name)==null?void 0:u[0])==null?void 0:c.toUpperCase())??"?";return e.jsx("div",{className:`flex mt-2 ${s?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:h("max-w-[75%] w-fit flex flex-col gap-1",{"items-end":s}),children:[r&&e.jsxs("div",{className:h("flex items-center gap-2 text-xs px-3",{"justify-end flex-row-reverse":s}),children:[n?e.jsxs(w,{to:n,className:"group inline-flex items-center gap-2 rounded-full px-1.5 py-1 transition hover:text-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2",children:[e.jsx("span",{className:"inline-flex h-7 w-7 items-center justify-center rounded-full bg-muted text-[11px] font-semibold text-foreground",children:d}),e.jsxs("span",{className:"font-medium group-hover:text-primary",children:["@",t.user.name]})]}):e.jsx("span",{className:"font-medium",children:t.user.name}),e.jsx("span",{className:"text-foreground/50 text-xs",children:new Date(t.createdAt).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})})]}),e.jsx("div",{className:h("py-2 px-3 rounded-xl text-sm w-fit",s?"bg-primary text-primary-foreground":"bg-muted text-foreground"),children:t.content})]})})};function D(){const t=l.useRef(null),s=l.useCallback(()=>{if(!t.current)return;const r=t.current;r.scrollTo({top:r.scrollHeight,behavior:"smooth"})},[]);return{containerRef:t,scrollToBottom:s}}const y="message",v=(t,s)=>{const r=Date.parse(t.createdAt),n=Date.parse(s.createdAt);return Number.isNaN(r)||Number.isNaN(n)?t.createdAt.localeCompare(s.createdAt):r-n};function P({roomName:t,username:s}){const[r,n]=l.useState([]),[d,u]=l.useState(null),[c,b]=l.useState(!1),i=l.useMemo(()=>C,[]);l.useEffect(()=>{const x=i.channel(t);return n([]),x.on("broadcast",{event:y},o=>{const p=o.payload;n(a=>a.some(g=>g.id===p.id)?a:[...a,p].sort(v))}).subscribe(async o=>{b(o==="SUBSCRIBED")}),u(x),()=>{i.removeChannel(x),u(null),b(!1)}},[i,t]);const m=l.useCallback(async x=>{if(!d||!c)return;const o={id:crypto.randomUUID(),content:x,user:{name:s},createdAt:new Date().toISOString()};n(a=>[...a,o].sort(v));const{error:p}=await d.send({type:"broadcast",event:y,payload:o});p&&(console.error("Failed to send chat message",p),n(a=>a.filter(f=>f.id!==o.id)))},[d,c,s]);return{messages:r,sendMessage:m,isConnected:c,compareMessagesByCreatedAt:v}}const j=l.forwardRef(({className:t,type:s,...r},n)=>e.jsx("input",{type:s,className:h("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...r}));j.displayName="Input";const T=({roomName:t,username:s,onMessage:r,messages:n=[]})=>{const{containerRef:d,scrollToBottom:u}=D(),{messages:c,sendMessage:b,isConnected:i}=P({roomName:t,username:s}),[m,x]=l.useState(""),o=l.useMemo(()=>{const a=[...n,...c],f=new Map;for(const g of a)f.set(g.id,g);return Array.from(f.values()).sort(v)},[n,c]);l.useEffect(()=>{r&&r(o)},[o,r]),l.useEffect(()=>{u()},[o,u]);const p=l.useCallback(a=>{a.preventDefault(),!(!m.trim()||!i)&&(b(m),x(""))},[m,i,b]);return e.jsxs("div",{className:"flex flex-col h-full w-full bg-background text-foreground antialiased",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 border-b border-border px-4 py-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-muted/60 px-3 py-1 font-medium text-foreground",children:[e.jsx("span",{"aria-hidden":!0,className:h("h-2 w-2 rounded-full",i?"bg-emerald-500 animate-pulse":"bg-amber-500 animate-pulse")}),i?"Connected":"Connecting…"]}),e.jsx("span",{className:"text-[11px]",children:"Messages update live while this window stays open."})]}),e.jsxs("div",{ref:d,className:"flex-1 overflow-y-auto p-4 space-y-4",children:[o.length===0?e.jsx("div",{className:"text-center text-sm text-muted-foreground",children:i?"No messages yet. Start the conversation!":"Hold tight, connecting to the room…"}):null,e.jsx("div",{className:"space-y-1",children:o.map((a,f)=>{const g=f>0?o[f-1]:null,N=!g||g.user.name!==a.user.name;return e.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-300",children:e.jsx(B,{message:a,isOwnMessage:a.user.name===s,showHeader:N})},a.id)})})]}),e.jsxs("form",{onSubmit:p,className:"flex w-full gap-2 border-t border-border p-4",children:[e.jsx(j,{className:h("rounded-full bg-background text-sm transition-all duration-300",i&&m.trim()?"w-[calc(100%-36px)]":"w-full"),type:"text",value:m,onChange:a=>x(a.target.value),placeholder:"Type a message...",disabled:!i}),i&&m.trim()&&e.jsx(I,{className:"aspect-square rounded-full animate-in fade-in slide-in-from-right-4 duration-300",type:"submit",disabled:!i,children:e.jsx(k,{className:"size-4"})})]})]})},F=()=>{const{user:t}=S(),{data:s}=M();if(!t)return null;const r=typeof t.email=="string"?t.email:null,n=r?r.split("@")[0]:null,d=s&&(s.displayName||s.username)||n||"Anonymous";return e.jsxs("div",{className:"relative flex flex-1 flex-col gap-4 overflow-hidden bg-gradient-to-b from-mn-bg to-mn-bg/60 px-3 pb-6 pt-3 sm:px-6 lg:px-10",children:[e.jsx("div",{className:"absolute inset-x-8 top-0 h-32 rounded-3xl bg-gradient-to-r from-fuchsia-500/10 via-mn-primary/10 to-blue-500/10 blur-3xl","aria-hidden":"true"}),e.jsx(E,{title:"Live Lounge",description:"Drop into the global room for a fast, Instagram-inspired chat vibe.",icon:A}),e.jsx(R,{children:e.jsxs("div",{className:"flex h-[min(660px,calc(100vh-8rem))] flex-col rounded-3xl border border-mn-border-subtle/70 bg-mn-bg/85 shadow-xl shadow-mn-primary/10 backdrop-blur",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 text-[12px] text-mn-text-secondary",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[13px] font-semibold text-mn-text-primary",children:"Global lounge"}),e.jsx("p",{className:"text-[11px] text-mn-text-muted",children:"Powered by Supabase Realtime"})]}),e.jsx("span",{className:"rounded-full bg-gradient-to-r from-fuchsia-500 via-mn-primary to-blue-500 px-3 py-1 text-[10px] font-semibold text-white shadow-mn-soft",children:"Open room"})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-mn-border-subtle to-transparent","aria-hidden":"true"}),e.jsx("div",{className:"flex flex-1 flex-col p-3 sm:p-4",children:e.jsx(T,{roomName:"global-lounge",username:d})})]})})]})};export{F as default};
