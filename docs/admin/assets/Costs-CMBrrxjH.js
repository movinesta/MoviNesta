import{r as i,f,j as e,L as os,i as as,B as y,x as is,y as ls,a as Ct,z as cs,A as ds,C as ms,D as us,E as xs,F as hs,G as ps,H as fs}from"./index-CRBf6KpQ.js";import{u as G,E as Re}from"./ErrorBox-DVY8vL3c.js";import{u as js}from"./useMutation-DfZD1PiA.js";import{C as w}from"./Card-BKQRm7Rb.js";import{I as S}from"./Input-eqrST-0v.js";import{S as q}from"./StatCard-B7MZSLFj.js";import{T as $,a as d,b as c}from"./Table-C_8f92Ce.js";import{E as Rt}from"./EmptyState-DFwSBMQU.js";import{C as W}from"./CopyButton-CqevYxQn.js";import{R as Lt,X as Ot,Y as Ft,T as Mt,L as At}from"./generateCategoricalChart-BZg-UuSW.js";import{L as Tt,a as Le}from"./LineChart-BmTb63kD.js";function gs(a){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:a.children})}function Pt(a){return new Date(`${a}T00:00:00.000Z`)}function Y(a,h){const u=Pt(a);return Number.isNaN(u.getTime())||h==="utc"?a:u.toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})}function ge(a,h,u="text/plain"){const g=new Blob([h],{type:u}),j=URL.createObjectURL(g),v=document.createElement("a");v.href=j,v.download=a,document.body.appendChild(v),v.click(),v.remove(),URL.revokeObjectURL(j)}function H(a){const h=Number(a);return Number.isFinite(h)?h:null}function z(a,h){if(!a||typeof a!="object")return null;const u=a;for(const g of h)if(g in u){const j=H(u[g]);if(j!==null)return j}return null}function P(a){return a==null||!Number.isFinite(a)?"—":new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",maximumFractionDigits:4}).format(a)}function bs(a){if(a==null||!Number.isFinite(a))return"—";const h=a<=1.5?a*100:a;return`${h.toFixed(h<99.95?2:3)}%`}function Ns(a){return a==null||!Number.isFinite(a)?"—":a<1?`${(a*1e3).toFixed(0)}ms`:a<10?`${a.toFixed(2)}s`:`${a.toFixed(1)}s`}function ys(a){return a==null||!Number.isFinite(a)?"—":a<10?`${a.toFixed(2)} tok/s`:a<100?`${a.toFixed(1)} tok/s`:`${Math.round(a)} tok/s`}function et(a){const h=String(a??"").split(",").map(j=>j.trim()).filter(j=>j.length>0),u=new Set,g=[];for(const j of h){const v=j.toLowerCase();u.has(v)||(u.add(v),g.push(j))}return g}function qt(a){var j,v,U;const h=new Set;if(!a)return h;const u=a.supported_parameters??a.supported??a.parameters??null,g=R=>{if(R){if(Array.isArray(R)){for(const L of R){const C=String(L??"").trim();C&&h.add(C)}return}if(typeof R=="object")for(const L of Object.keys(R)){const C=String(L??"").trim();C&&h.add(C)}}};return g(u),g((j=a.data)==null?void 0:j.supported_parameters),g((v=a.data)==null?void 0:v.parameters),g((U=a.data)==null?void 0:U.supported),h}function vs(a){return a.replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase()}function Ut(a){const h=a.trim(),u=vs(h),g={max_output_tokens:["max_tokens"],max_tokens:["max_output_tokens"],stop_sequences:["stop"],stop:["stop_sequences"],top_logprobs:["logprobs"],logprobs:["top_logprobs"],...u!==h?{[h]:[u],[u]:[h]}:{}};return g[h]??g[u]??(u!==h?[u]:[])}function tt(a,h){if(!h||h.size===0)return!1;const u=new Set(Array.from(h).map(v=>String(v).trim().toLowerCase())),g=String(a??"").trim(),j=g.toLowerCase();if(u.has(j))return!0;for(const v of Ut(g)){const U=String(v??"").trim().toLowerCase();if(U&&u.has(U))return!0}return!1}function As(){var kt,wt;const[a,h]=i.useState(14),[u,g]=i.useState("utc"),[j,v]=i.useState("providers"),[U,R]=i.useState(""),[L,C]=i.useState("{}"),[Oe,ae]=i.useState(!1),[st,B]=i.useState(null),[nt,rt]=i.useState(!1);function Dt(){try{const t=L.trim()?JSON.parse(L):{};B(null),ae(!0),C(JSON.stringify(t,null,2))}catch(t){B((t==null?void 0:t.message)??String(t))}}function Et(){if(!l)return;const t=(l==null?void 0:l.budgets)??{},n=t.total_daily_budget;R(n==null?"":String(n));const r=t.by_provider_budget&&typeof t.by_provider_budget=="object"?t.by_provider_budget:{};C(JSON.stringify(r,null,2)),ae(!1),B(null)}const ie=G({queryKey:["costs",{days:a}],queryFn:()=>ds({days:a})}),le=G({queryKey:["openrouter-credits"],queryFn:()=>ms()}),ce=G({queryKey:["openrouter-key"],queryFn:()=>us(),refetchInterval:6e4}),Fe=G({queryKey:["assistant-settings"],queryFn:()=>xs(),staleTime:6e4}),be=G({queryKey:["openrouter-models"],queryFn:()=>hs(),staleTime:5*6e4}),ee=G({queryKey:["openrouter-endpoints"],queryFn:()=>ps(),staleTime:5*6e4}),te=js({mutationFn:async()=>{var n,r;const t=((r=(n=Fe.data)==null?void 0:n.assistant_settings)==null?void 0:r.openrouter_base_url)??null;return cs({base_url:t,refresh_parameters:!1})},onSuccess:()=>{le.refetch(),ce.refetch(),be.refetch(),ee.refetch()}}),[O,Jt]=i.useState(""),[Ne,$t]=i.useState(""),[ye,Bt]=i.useState(""),[Me,Ae]=i.useState(""),[Te,ot]=i.useState(""),[qe,It]=i.useState(!0),[Pe,Kt]=i.useState(!0),[Ue,Qt]=i.useState(!0),[De,Zt]=i.useState(!1),[Ee,at]=i.useState(""),[Je,it]=i.useState(""),[$e,lt]=i.useState(""),[Be,ct]=i.useState(""),[I,dt]=i.useState("any"),[de,mt]=i.useState(!1),[se,ut]=i.useState(!1),[Ie,xt]=i.useState(!1),[Ke,ht]=i.useState(!1),[Qe,pt]=i.useState(!1),D=G({queryKey:["openrouter-parameters",{model:O,provider:Ne||null,base_url:ye||null}],queryFn:()=>fs({model:O.trim(),provider:Ne.trim()||null,base_url:ye.trim()||null}),enabled:!!O.trim()}),ft=i.useMemo(()=>{var x;const t=((x=be.data)==null?void 0:x.payload)??null,r=(Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t)?t:[]).map(m=>String((m==null?void 0:m.id)??(m==null?void 0:m.name)??"").trim()).filter(m=>m.length>0),o=new Set,s=[];for(const m of r)if(!o.has(m)&&(o.add(m),s.push(m),s.length>=2e3))break;return s},[be.data]),K=i.useMemo(()=>{var o;const t=((o=ee.data)==null?void 0:o.payload)??null;return(s=>{var x,m;return s?Array.isArray(s)?s:Array.isArray(s.data)?s.data:Array.isArray((x=s.data)==null?void 0:x.data)?s.data.data:Array.isArray((m=s.data)==null?void 0:m.endpoints)?s.data.endpoints:Array.isArray(s.endpoints)?s.endpoints:[]:[]})(t).filter(Boolean).map(s=>{const x=String((s==null?void 0:s.tag)??(s==null?void 0:s.provider)??(s==null?void 0:s.provider_id)??(s==null?void 0:s.owner)??"").trim(),m=String((s==null?void 0:s.provider_name)??(s==null?void 0:s.providerName)??(s==null?void 0:s.name)??"").trim(),b=String((s==null?void 0:s.model)??(s==null?void 0:s.model_id)??(s==null?void 0:s.modelId)??"").trim(),J=String((s==null?void 0:s.id)??(s==null?void 0:s.endpoint_id)??(s==null?void 0:s.endpointId)??"").trim(),T=H((s==null?void 0:s.context_length)??(s==null?void 0:s.contextLength)??(s==null?void 0:s.context)??null),X=qt((s==null?void 0:s.supported_parameters)??(s==null?void 0:s.supported)??(s==null?void 0:s.parameters)??(s==null?void 0:s.capabilities)??null),N=(s==null?void 0:s.pricing)??(s==null?void 0:s.price)??null,ke=N?H((N==null?void 0:N.prompt)??(N==null?void 0:N.prompt_cost)??(N==null?void 0:N.promptCost)??null):null,we=N?H((N==null?void 0:N.completion)??(N==null?void 0:N.completion_cost)??(N==null?void 0:N.completionCost)??null):null,je=String((s==null?void 0:s.base_url)??(s==null?void 0:s.baseUrl)??(s==null?void 0:s.url)??(s==null?void 0:s.endpoint)??(s==null?void 0:s.endpoint_url)??"").trim(),St=String((s==null?void 0:s.data_collection)??(s==null?void 0:s.dataCollection)??(s==null?void 0:s.data_policy)??(s==null?void 0:s.dataPolicy)??"").trim(),ts=H((s==null?void 0:s.uptime_last_30m)??(s==null?void 0:s.uptimeLast30m)??null),ss=H((s==null?void 0:s.latency_last_30m)??(s==null?void 0:s.latencyLast30m)??null),ns=H((s==null?void 0:s.throughput_last_30m)??(s==null?void 0:s.throughputLast30m)??null),Se=(s==null?void 0:s.quantization)??(s==null?void 0:s.quantizations)??(s==null?void 0:s.quant)??null,He=new Set;if(Array.isArray(Se))for(const ze of Se){const Ce=String(ze??"").trim();Ce&&He.add(Ce)}else if(Se!=null){const ze=String(Se).trim();if(ze)for(const Ce of ze.split(",")){const zt=String(Ce??"").trim();zt&&He.add(zt)}}const rs=!!((s==null?void 0:s.zdr)??(s==null?void 0:s.is_zdr)??(s==null?void 0:s.isZdr)??!1)||/zdr/i.test(je)||/zdr/i.test(St);return{provider:x||m||null,providerSlug:x||null,providerName:m||null,model:b||null,id:J||null,baseUrl:je||null,dataCollection:St||null,isZdr:rs,quantizations:He,contextLength:T,promptCost:ke,completionCost:we,uptime30m:ts,latency30m:ss,throughput30m:ns,supported:X,raw:s}})},[ee.data]),ne=i.useMemo(()=>{const t=Me.trim().toLowerCase(),n=Te.trim().toLowerCase();return K.filter(r=>!(t&&!`${r.model??""} ${r.id??""}`.toLowerCase().includes(t)||n&&!`${r.provider??""} ${r.providerName??""}`.toLowerCase().includes(n)))},[K,Me,Te]),Q=i.useMemo(()=>{const t=new Set;for(const n of ne)for(const r of n.supported??new Set)t.add(r);return t},[ne]),Ze=i.useMemo(()=>{const t=new Set,n=[];for(const r of K){const o=String(r.provider??"").trim();if(!o)continue;const s=o.toLowerCase();t.has(s)||(t.add(s),n.push(o))}return n.sort((r,o)=>r.localeCompare(o))},[K]),me=i.useMemo(()=>et(Je),[Je]),ue=i.useMemo(()=>et($e),[$e]),xe=i.useMemo(()=>et(Be),[Be]),re=i.useMemo(()=>{const t=[];Ie&&t.push("tools","tool_choice"),Ke&&t.push("response_format"),Qe&&t.push("plugins");const n=new Set,r=[];for(const o of t){const s=o.toLowerCase();n.has(s)||(n.add(s),r.push(o))}return r},[Ie,Ke,Qe]),ve=i.useMemo(()=>{const t=Ee.trim().toLowerCase(),n=new Set(me.map(s=>s.toLowerCase())),r=new Set(ue.map(s=>s.toLowerCase())),o=new Set(xe.map(s=>s.toLowerCase()));return K.filter(s=>{if(t&&!`${s.model??""} ${s.id??""}`.toLowerCase().includes(t))return!1;const m=String(s.provider??"").trim().toLowerCase();if(n.size&&(!m||!n.has(m))||r.size&&m&&r.has(m))return!1;if(I!=="any"){const b=String(s.dataCollection??"").toLowerCase();if(!b||!b.includes(I))return!1}if(de&&!s.isZdr)return!1;if(o.size){const b=s.quantizations??new Set;if(!b||b.size===0)return!1;let J=!1;for(const T of b)if(o.has(String(T).toLowerCase())){J=!0;break}if(!J)return!1}if(se&&re.length){for(const b of re)if(!tt(b,s.supported??new Set))return!1}return!0})},[K,Ee,me,ue,xe,I,de,se,re]),Ve=i.useMemo(()=>{const t=new Set;for(const n of ve)for(const r of n.supported??new Set)t.add(r);return t},[ve]),jt=i.useMemo(()=>{const t={};return me.length&&(t.only=me),ue.length&&(t.ignore=ue),I!=="any"&&(t.data_collection=I),xe.length&&(t.quantizations=xe),de&&(t.zdr=!0),se&&(t.require_parameters=!0),t},[me,ue,I,xe,de,se]),_=i.useMemo(()=>{const t=D.data??null;return t?{baseUrl:t.base_url??null,modelId:t.model_id??null,provider:t.provider??null,fetchedAt:t.fetched_at??null,ageSeconds:typeof t.age_seconds=="number"?t.age_seconds:null,payload:t.payload??null}:null},[D.data]),F=i.useMemo(()=>{var n,r;const t=((r=(n=Fe.data)==null?void 0:n.assistant_settings)==null?void 0:r.params)??null;return t&&typeof t=="object"?t:null},[Fe.data]),he=i.useMemo(()=>{const t=(_==null?void 0:_.payload)??null;return qt(t)},[_]),oe=i.useMemo(()=>he&&he.size>0?he:Q&&Q.size>0?Q:he,[he,Q]),gt=i.useMemo(()=>{if(!F)return[];const t=new Set(["timeout_ms","base_url","payload_variants"]);return Object.keys(F).sort().map(r=>{const o=F[r];return t.has(r)?{key:r,value:o,status:"local"}:!oe||oe.size===0?{key:r,value:o,status:"unknown"}:{key:r,value:o,status:tt(r,oe)?"supported":"unsupported"}})},[F,oe]),Z=i.useMemo(()=>{if(!F)return null;const t=new Set(["timeout_ms","base_url","payload_variants"]),n={},r=[],o=oe,s=!!o&&o.size>0;for(const x of Object.keys(F)){const m=F[x];if(t.has(x)){n[x]=m;continue}if(!s){n[x]=m;continue}if(tt(x,o)){n[x]=m;continue}const b=Ut(x),J=new Set(Array.from(o).map(X=>String(X).trim().toLowerCase())),T=b.find(X=>J.has(String(X).trim().toLowerCase()));if(T){n[T]=m,r.push(`Rename ${x} → ${T}`);continue}r.push(`Drop ${x} (unsupported)`)}return{params:n,notes:r}},[F,oe]),[bt,Xe]=i.useState(null),[Nt,yt]=i.useState(!1),l=ie.data;i.useEffect(()=>{if(!l||Oe)return;const t=(l==null?void 0:l.budgets)??{},n=t.total_daily_budget;R(n==null?"":String(n));const r=t.by_provider_budget&&typeof t.by_provider_budget=="object"?t.by_provider_budget:{};C(JSON.stringify(r,null,2))},[l,Oe]);const M=i.useMemo(()=>{const t=l==null?void 0:l.daily;return Array.isArray(t)?t.filter(Boolean).filter(n=>typeof n.day=="string"&&typeof n.provider=="string").map(n=>({day:String(n.day),provider:String(n.provider),tokens:Number.isFinite(Number(n.tokens))?Number(n.tokens):0,runs:Number.isFinite(Number(n.runs))?Number(n.runs):0,errors:Number.isFinite(Number(n.errors))?Number(n.errors):0})):[]},[l]),pe=i.useMemo(()=>{const t=l==null?void 0:l.daily_jobs;return Array.isArray(t)?t.filter(Boolean).filter(n=>typeof n.day=="string"&&typeof n.job_name=="string"&&typeof n.provider=="string").map(n=>({day:String(n.day),job_name:String(n.job_name),provider:String(n.provider),tokens:Number.isFinite(Number(n.tokens))?Number(n.tokens):0,runs:Number.isFinite(Number(n.runs))?Number(n.runs):0,errors:Number.isFinite(Number(n.errors))?Number(n.errors):0})):[]},[l]),Ge=i.useMemo(()=>{const t=l==null?void 0:l.jobs;return Array.isArray(t)?t.filter(Boolean).filter(n=>typeof n.job_name=="string").map(n=>({job_name:String(n.job_name),provider:n.provider==null?null:String(n.provider),tokens:Number.isFinite(Number(n.tokens))?Number(n.tokens):0,runs:Number.isFinite(Number(n.runs))?Number(n.runs):0,errors:Number.isFinite(Number(n.errors))?Number(n.errors):0,last_started_at:n.last_started_at?String(n.last_started_at):null})).sort((n,r)=>r.tokens-n.tokens):[]},[l]),We=i.useMemo(()=>{const t=l==null?void 0:l.models;return Array.isArray(t)?t.filter(Boolean).filter(n=>typeof n.model=="string").map(n=>({provider:n.provider==null?null:String(n.provider),model:String(n.model),tokens:Number.isFinite(Number(n.tokens))?Number(n.tokens):0,runs:Number.isFinite(Number(n.runs))?Number(n.runs):0,errors:Number.isFinite(Number(n.errors))?Number(n.errors):0,last_started_at:n.last_started_at?String(n.last_started_at):null})).sort((n,r)=>r.tokens-n.tokens):[]},[l]),A=i.useMemo(()=>{const t=new Set;for(const n of M)t.add(n.provider);return Array.from(t.values()).sort()},[M]),E=i.useMemo(()=>{var o;const t=(o=l==null?void 0:l.today)==null?void 0:o.day,n=t?Pt(t):new Date;if(Number.isNaN(n.getTime()))return[];const r=[];for(let s=a-1;s>=0;s--){const x=new Date(n.getTime());x.setUTCDate(x.getUTCDate()-s),r.push(x.toISOString().slice(0,10))}return r},[l,a]),Vt=i.useMemo(()=>{if(!E.length)return[];const t={};for(const n of E)t[n]={day:n,dayLabel:Y(n,u)};for(const n of M)t[n.day]||(t[n.day]={day:n.day,dayLabel:Y(n.day,u)}),t[n.day][n.provider]=(t[n.day][n.provider]??0)+n.tokens;for(const n of Object.keys(t))for(const r of A)t[n][r]=Number(t[n][r]??0);return Object.values(t).sort((n,r)=>String(n.day).localeCompare(String(r.day)))},[M,E,A,u]),_e=i.useMemo(()=>{const t=new Map;for(const n of pe)t.set(n.job_name,(t.get(n.job_name)??0)+n.tokens);return Array.from(t.entries()).sort((n,r)=>r[1]-n[1]).slice(0,6).map(([n])=>n)},[pe]),Xt=i.useMemo(()=>{if(!E.length)return[];const t={};for(const o of E)t[o]={day:o,dayLabel:Y(o,u)};const n="(other jobs)";for(const o of pe){t[o.day]||(t[o.day]={day:o.day,dayLabel:Y(o.day,u)});const s=_e.includes(o.job_name)?o.job_name:n;t[o.day][s]=(t[o.day][s]??0)+o.tokens}const r=[..._e,n];for(const o of Object.keys(t))for(const s of r)t[o][s]=Number(t[o][s]??0);return Object.values(t).sort((o,s)=>String(o.day).localeCompare(String(s.day)))},[pe,E,_e,u]),Gt=i.useMemo(()=>{const t=M.reduce((r,o)=>r+o.tokens,0),n={};for(const r of M)n[r.provider]=(n[r.provider]??0)+r.tokens;return{total:t,byProvider:n}},[M]),Ye=i.useMemo(()=>{const t=l==null?void 0:l.today,n=typeof(t==null?void 0:t.day)=="string"?t.day:"—",r=Number.isFinite(Number(t==null?void 0:t.total_tokens))?Number(t.total_tokens):0,o=t!=null&&t.by_provider&&typeof t.by_provider=="object"?t.by_provider:{};return{day:n,totalTokens:r,byProvider:o}},[l]),V=i.useMemo(()=>{const t=l==null?void 0:l.openrouter_usage,n=Array.isArray(t==null?void 0:t.daily)?t.daily.filter(Boolean).filter(s=>typeof s.day=="string").map(s=>({day:String(s.day),tokens:Number.isFinite(Number(s.tokens))?Number(s.tokens):0,requests:Number.isFinite(Number(s.requests))?Number(s.requests):0,cost:Number.isFinite(Number(s.cost))?Number(s.cost):0})):[],r=Array.isArray(t==null?void 0:t.by_user)?t.by_user.filter(Boolean).map(s=>({user_id:String(s.user_id??"unknown"),tokens:Number.isFinite(Number(s.tokens))?Number(s.tokens):0,requests:Number.isFinite(Number(s.requests))?Number(s.requests):0,cost:Number.isFinite(Number(s.cost))?Number(s.cost):0})):[],o=Array.isArray(t==null?void 0:t.by_model)?t.by_model.filter(Boolean).map(s=>({provider:s.provider==null?null:String(s.provider),model:String(s.model??"unknown"),tokens:Number.isFinite(Number(s.tokens))?Number(s.tokens):0,requests:Number.isFinite(Number(s.requests))?Number(s.requests):0,cost:Number.isFinite(Number(s.cost))?Number(s.cost):0})):[];return{daily:n,byUser:r,byModel:o}},[l]),vt=i.useMemo(()=>V.daily.length?V.daily.map(t=>({day:t.day,dayLabel:Y(t.day,u),Tokens:t.tokens,Cost:t.cost,Requests:t.requests})):[],[V.daily,u]),k=i.useMemo(()=>{var x,m,b;const t=(x=le.data)==null?void 0:x.payload;if(!t)return null;const n=(t==null?void 0:t.data)??t,r=z(n,["balance","remaining","credits","available","total_credits_remaining"]),o=z(n,["total","total_credits","total_credits_granted"]),s=z(n,["used","spent","total_credits_used"]);return{balance:r,total:o,used:s,raw:t,fetchedAt:((m=le.data)==null?void 0:m.fetched_at)??null,baseUrl:((b=le.data)==null?void 0:b.base_url)??null}},[le.data]),p=i.useMemo(()=>{var ke,we,je;const t=(ke=ce.data)==null?void 0:ke.payload;if(!t)return null;const n=(t==null?void 0:t.data)??t,r=z(n,["limit"]),o=z(n,["limit_remaining","remaining","credits_remaining"]),s=z(n,["usage","spent","total_usage"]),x=z(n,["usage_daily"]),m=z(n,["usage_weekly"]),b=z(n,["usage_monthly"]),J=z(n,["byok_usage"]),T=z(n,["byok_usage_daily"]),X=!!(n!=null&&n.is_free_tier);return{label:typeof(n==null?void 0:n.label)=="string"?n.label:null,limit:r,remaining:o,usage:s,usageDaily:x,usageWeekly:m,usageMonthly:b,byokUsage:J,byokUsageDaily:T,isFreeTier:X,raw:t,fetchedAt:((we=ce.data)==null?void 0:we.fetched_at)??null,baseUrl:((je=ce.data)==null?void 0:je.base_url)??null}},[ce.data]),fe=i.useMemo(()=>{const t=l==null?void 0:l.data_quality;return{rows:Number.isFinite(Number(t==null?void 0:t.rows))?Number(t.rows):0,rowsWithTokens:Number.isFinite(Number(t==null?void 0:t.rows_with_tokens))?Number(t.rows_with_tokens):0,rowsMissingTokens:Number.isFinite(Number(t==null?void 0:t.rows_missing_tokens))?Number(t.rows_missing_tokens):0}},[l]),_t=i.useMemo(()=>{const t=[];return fe.rowsMissingTokens>0&&t.push({kind:"warn",msg:`There are ${f(fe.rowsMissingTokens)} job_run_log rows missing total_tokens. Those rows won’t show up in charts.`}),t},[fe]),Wt=()=>{const t=["day","provider","tokens","runs","errors"].join(","),n=M.map(r=>[r.day,r.provider,r.tokens,r.runs,r.errors].join(","));ge(`costs_daily_${a}d.csv`,[t,...n].join(`
`),"text/csv")},Yt=()=>{const t=["day","job_name","provider","tokens","runs","errors"].join(","),n=pe.map(r=>[r.day,JSON.stringify(r.job_name),r.provider,r.tokens,r.runs,r.errors].join(","));ge(`costs_daily_jobs_${a}d.csv`,[t,...n].join(`
`),"text/csv")},Ht=()=>{const t=["job_name","provider","tokens","runs","errors","last_started_at"].join(","),n=Ge.map(r=>[JSON.stringify(r.job_name),r.provider??"",r.tokens,r.runs,r.errors,r.last_started_at??""].join(","));ge(`costs_jobs_${a}d.csv`,[t,...n].join(`
`),"text/csv")},es=()=>{const t=["provider","model","tokens","runs","errors","last_started_at"].join(","),n=We.map(r=>[r.provider??"",JSON.stringify(r.model),r.tokens,r.runs,r.errors,r.last_started_at??""].join(","));ge(`costs_models_${a}d.csv`,[t,...n].join(`
`),"text/csv")};return ie.isLoading?e.jsx(os,{}):ie.error?e.jsx(Re,{error:ie.error}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(gs,{children:"Costs"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsx(q,{title:`Total tokens (last ${a}d)`,value:f(Gt.total),subtitle:e.jsxs("span",{className:"font-mono text-zinc-500",children:["since: ",(l==null?void 0:l.since)??"—"]})}),e.jsx(q,{title:`Today (${Y(Ye.day,"utc")})`,value:f(Ye.totalTokens),subtitle:((kt=l==null?void 0:l.today)==null?void 0:kt.total_budget)==null?e.jsx("span",{className:"text-zinc-500",children:"No daily budget set."}):e.jsxs("span",{className:"text-zinc-500",children:["Remaining: ",e.jsx("span",{className:"font-mono",children:f(Number(l.today.total_remaining??0))})]})}),e.jsx(q,{title:"Data quality",value:f(fe.rows),subtitle:e.jsxs("span",{children:[e.jsx("span",{className:"font-mono",children:f(fe.rowsMissingTokens)})," rows missing total_tokens"]})})]}),_t.length?e.jsx(w,{title:"Alerts",children:e.jsx("div",{className:"space-y-2",children:_t.map((t,n)=>e.jsx("div",{className:as("rounded-xl border px-3 py-2 text-sm",t.kind==="warn"?"border-amber-200 bg-amber-50 text-amber-700":"border-zinc-200 bg-zinc-50 text-zinc-700"),children:t.msg},n))})}):null,e.jsx(w,{title:"Controls",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Days"}),e.jsx("div",{className:"w-28",children:e.jsx(S,{type:"number",value:String(a),min:3,max:60,onChange:t=>{const n=t.target.value;if(n==="")return;const r=Number(n);if(!Number.isFinite(r))return;const o=Math.max(3,Math.min(60,Math.trunc(r)));h(o)}})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Chart"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:j==="providers"?"primary":"ghost",onClick:()=>v("providers"),children:"Providers"}),e.jsx(y,{variant:j==="jobs"?"primary":"ghost",onClick:()=>v("jobs"),children:"Jobs"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"X-axis labels"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:u==="utc"?"primary":"ghost",onClick:()=>g("utc"),children:"UTC"}),e.jsx(y,{variant:u==="local"?"primary":"ghost",onClick:()=>g("local"),children:"Local"})]})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(y,{variant:"ghost",onClick:Wt,children:"Export daily CSV"}),e.jsx(y,{variant:"ghost",onClick:Yt,children:"Export daily jobs CSV"}),e.jsx(y,{variant:"ghost",onClick:Ht,children:"Export jobs CSV"}),e.jsx(y,{variant:"ghost",onClick:es,children:"Export models CSV"}),e.jsx(y,{variant:"ghost",onClick:()=>{h(14),g("utc"),v("providers")},children:"Reset defaults"}),e.jsxs("div",{className:"flex items-center pl-2 text-xs text-zinc-500",children:["Applied: last ",e.jsx("span",{className:"font-mono",children:a})," days · labels ",e.jsx("span",{className:"font-mono",children:u})," · view ",e.jsx("span",{className:"font-mono",children:j})]})]})]})}),e.jsxs(w,{title:j==="providers"?"Tokens by day (providers)":"Tokens by day (top jobs)",children:[e.jsx("div",{className:"h-72",children:e.jsx(Lt,{width:"100%",height:"100%",children:e.jsxs(Tt,{data:j==="providers"?Vt:Xt,children:[e.jsx(Ot,{dataKey:"dayLabel"}),e.jsx(Ft,{tickFormatter:t=>f(Number(t))}),e.jsx(Mt,{formatter:t=>f(Number(t))}),e.jsx(At,{}),(j==="providers"?A:[..._e,"(other jobs)"]).map(t=>e.jsx(Le,{type:"monotone",dataKey:t,dot:!1},t))]})})}),e.jsxs("div",{className:"mt-4 text-xs text-zinc-500",children:["Note: This dashboard reads ",e.jsx("span",{className:"font-mono",children:"total_tokens"})," from ",e.jsx("span",{className:"font-mono",children:"job_run_log"}),". If a provider doesn’t report tokens, its line may be empty (and will show up as missing-token rows)."]})]}),e.jsx(w,{title:"Today usage (by provider)",children:e.jsxs($,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(d,{children:"Provider"}),e.jsx(d,{className:"text-right",children:"Used"}),e.jsx(d,{className:"text-right",children:"Budget"}),e.jsx(d,{className:"text-right",children:"Remaining"})]})}),e.jsx("tbody",{children:A.length?A.map(t=>{var s,x,m,b;const n=Number(Ye.byProvider[t]??0),r=(x=(s=l==null?void 0:l.today)==null?void 0:s.budget_by_provider)==null?void 0:x[t],o=(b=(m=l==null?void 0:l.today)==null?void 0:m.remaining_by_provider)==null?void 0:b[t];return e.jsxs("tr",{children:[e.jsx(c,{className:"font-mono",children:t}),e.jsx(c,{className:"text-right font-mono",children:f(n)}),e.jsx(c,{className:"text-right font-mono",children:r==null?"—":f(Number(r))}),e.jsx(c,{className:"text-right font-mono",children:o==null?"—":f(Number(o))})]},t)}):e.jsx("tr",{children:e.jsx(c,{colSpan:4,className:"p-6",children:e.jsx(Rt,{title:"No cost data",message:"No provider/model costs were returned for this period.",className:"border-0 bg-transparent p-0"})})})})]})}),e.jsxs(w,{title:"OpenRouter credits",right:e.jsx(y,{variant:"secondary",onClick:()=>te.mutate(),disabled:te.isPending,children:te.isPending?"Refreshing…":"Refresh caches"}),children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsx(q,{title:"Balance",value:P((k==null?void 0:k.balance)??null),subtitle:e.jsx("span",{className:"text-xs text-zinc-500",children:"Remaining credits"})}),e.jsx(q,{title:"Total",value:P((k==null?void 0:k.total)??null),subtitle:e.jsx("span",{className:"text-xs text-zinc-500",children:"Granted credits"})}),e.jsx(q,{title:"Used",value:P((k==null?void 0:k.used)??null),subtitle:e.jsx("span",{className:"text-xs text-zinc-500",children:"Consumed credits"})})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-3 text-xs text-zinc-500",children:[e.jsxs("span",{children:["Base URL: ",e.jsx("span",{className:"font-mono",children:(k==null?void 0:k.baseUrl)??"—"})]}),e.jsxs("span",{children:["Fetched: ",e.jsx("span",{className:"font-mono",children:(k==null?void 0:k.fetchedAt)??"—"})]}),k?null:e.jsx("span",{children:"No credits payload cached yet."})]})]}),e.jsxs(w,{title:"OpenRouter key limits",right:e.jsx(y,{variant:"secondary",onClick:()=>te.mutate(),disabled:te.isPending,children:te.isPending?"Refreshing…":"Refresh caches"}),children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsx(q,{title:"Remaining",value:P((p==null?void 0:p.remaining)??null),subtitle:e.jsx("span",{className:"text-xs text-zinc-500",children:"Credit limit remaining"})}),e.jsx(q,{title:"Used today",value:P((p==null?void 0:p.usageDaily)??null),subtitle:e.jsx("span",{className:"text-xs text-zinc-500",children:"UTC day usage"})}),e.jsx(q,{title:"Used (all time)",value:P((p==null?void 0:p.usage)??null),subtitle:e.jsx("span",{className:"text-xs text-zinc-500",children:"Total usage"})})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-3 text-xs text-zinc-500",children:[e.jsxs("span",{children:["Label: ",e.jsx("span",{className:"font-mono",children:(p==null?void 0:p.label)??"—"})]}),e.jsxs("span",{children:["Free tier: ",e.jsx("span",{className:"font-mono",children:p!=null&&p.isFreeTier?"true":"false"})]}),e.jsxs("span",{children:["Base URL: ",e.jsx("span",{className:"font-mono",children:(p==null?void 0:p.baseUrl)??"—"})]}),e.jsxs("span",{children:["Fetched: ",e.jsx("span",{className:"font-mono",children:(p==null?void 0:p.fetchedAt)??"—"})]}),p?null:e.jsx("span",{children:"No key payload cached yet."})]}),p!=null&&p.raw?e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-zinc-700",children:"Raw /key payload"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(W,{text:JSON.stringify(p.raw,null,2)}),e.jsx("pre",{className:"mt-2 max-h-72 overflow-auto rounded bg-zinc-950 p-3 text-xs text-zinc-100",children:JSON.stringify(p.raw,null,2)})]})]}):null]}),e.jsxs(w,{title:"OpenRouter model parameters",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Model ID (from OpenRouter)"}),e.jsx(S,{value:O,placeholder:"e.g. openai/gpt-4o-mini",list:"openrouter-model-ids",onChange:t=>Jt(t.target.value)}),e.jsx("datalist",{id:"openrouter-model-ids",children:ft.map(t=>e.jsx("option",{value:t},t))}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-500",children:["Tip: start typing to pick from cached models (up to ",ft.length," shown)."]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Provider (optional)"}),e.jsx(S,{value:Ne,placeholder:"e.g. OpenAI",onChange:t=>$t(t.target.value)}),e.jsx("div",{className:"mt-1 text-xs text-zinc-500",children:"Used as a cache key. Leave blank for default."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Base URL override (optional)"}),e.jsx(S,{value:ye,placeholder:"Leave blank to use assistant settings / default",onChange:t=>Bt(t.target.value)}),e.jsx("div",{className:"mt-1 text-xs text-zinc-500",children:"Note: for security, only OpenRouter’s official host/path is accepted."})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(y,{variant:"primary",disabled:!O.trim()||D.isFetching,onClick:()=>{Xe(null),D.refetch()},children:D.isFetching?"Loading…":"Load from cache"}),e.jsx(y,{variant:"ghost",disabled:!O.trim()||Nt,onClick:async()=>{Xe(null),yt(!0);try{await is({model:O.trim(),provider:Ne.trim()||null,base_url:ye.trim()||null}),await D.refetch(),await be.refetch()}catch(t){Xe((t==null?void 0:t.message)??String(t))}finally{yt(!1)}},children:Nt?"Refreshing…":"Refresh now"})]})]}),bt?e.jsx("div",{className:"mt-3",children:e.jsx(Re,{title:"Parameters error",error:bt})}):null,D.isError?e.jsx("div",{className:"mt-3",children:e.jsx(Re,{title:"Parameters error",error:D.error})}):null,_?e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-zinc-500",children:[e.jsxs("span",{children:["Model: ",e.jsx("span",{className:"font-mono",children:_.modelId??"—"})]}),e.jsxs("span",{children:["Provider: ",e.jsx("span",{className:"font-mono",children:_.provider??"—"})]}),e.jsxs("span",{children:["Base URL: ",e.jsx("span",{className:"font-mono",children:_.baseUrl??"—"})]}),e.jsxs("span",{children:["Fetched: ",e.jsx("span",{className:"font-mono",children:_.fetchedAt??"—"})]}),e.jsxs("span",{children:["Age: ",e.jsx("span",{className:"font-mono",children:_.ageSeconds==null?"—":`${_.ageSeconds}s`})]})]}),e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-zinc-700",children:"Raw /parameters payload"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(W,{text:JSON.stringify(_.payload??null,null,2)}),e.jsx("pre",{className:"mt-2 max-h-80 overflow-auto rounded bg-zinc-950 p-3 text-xs text-zinc-100",children:JSON.stringify(_.payload??null,null,2)})]})]}),e.jsxs("div",{className:"mt-4 rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:"App configured OpenRouter params"}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["From ",e.jsx("span",{className:"font-mono",children:"assistant_settings.params"})]})]}),F?e.jsx("div",{className:"mt-2 overflow-auto rounded-lg border border-zinc-200 bg-white",children:e.jsxs($,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(d,{children:"Param"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Value"})]})}),e.jsx("tbody",{children:gt.length?gt.map(t=>e.jsxs("tr",{children:[e.jsx(c,{className:"font-mono text-xs",children:t.key}),e.jsx(c,{className:"text-xs",children:t.status==="supported"?e.jsx("span",{className:"rounded-full bg-green-50 px-2 py-0.5 text-green-700",children:"Supported"}):t.status==="unsupported"?e.jsx("span",{className:"rounded-full bg-red-50 px-2 py-0.5 text-red-700",children:"Unsupported"}):t.status==="local"?e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-0.5 text-zinc-700",children:"Local-only"}):e.jsx("span",{className:"rounded-full bg-amber-50 px-2 py-0.5 text-amber-700",children:"Unknown"})}),e.jsx(c,{className:"font-mono text-xs",children:typeof t.value=="string"?t.value:JSON.stringify(t.value)})]},t.key)):e.jsx("tr",{children:e.jsx(c,{colSpan:3,className:"text-zinc-500",children:"No params configured."})})})]})}):e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"No params loaded (or assistant settings not accessible)."}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Note: “Local-only” params affect your app’s request wrapper but won’t appear in OpenRouter’s ",e.jsx("span",{className:"font-mono",children:"/parameters"})," support list."]}),Z?e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx(W,{text:JSON.stringify(Z.params,null,2),label:"Copy recommended params"}),e.jsx(y,{variant:"ghost",onClick:()=>ge(`assistant_settings_params_recommended_${((_==null?void 0:_.modelId)??"model").replace(/[^a-zA-Z0-9._-]/g,"_")}.json`,JSON.stringify(Z.params,null,2),"application/json"),children:"Download JSON"}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Uses the support list (or endpoints fallback) to keep only compatible params."})]}):null,(wt=Z==null?void 0:Z.notes)!=null&&wt.length?e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"cursor-pointer text-xs text-zinc-600",children:"Show recommended changes"}),e.jsx("ul",{className:"mt-2 list-disc space-y-1 pl-5 text-xs text-zinc-600",children:Z.notes.map((t,n)=>e.jsx("li",{children:t},n))})]}):null]})]}):e.jsx("div",{className:"mt-4 text-xs text-zinc-500",children:"Enter a model ID to view cached parameters (and optionally refresh them)."})]}),e.jsxs(w,{title:"OpenRouter endpoints",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Model filter (substring)"}),e.jsx(S,{value:Me,placeholder:"e.g. gpt-4o-mini",list:"openrouter-model-ids",onChange:t=>Ae(t.target.value)}),e.jsx("div",{className:"mt-1 text-xs text-zinc-500",children:"Matches endpoint model/id. Leave blank to show all endpoints."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Provider filter (substring)"}),e.jsx(S,{value:Te,placeholder:"e.g. OpenAI",onChange:t=>ot(t.target.value)}),e.jsx("div",{className:"mt-1 text-xs text-zinc-500",children:"Matches endpoint provider/owner fields."})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(y,{variant:"ghost",disabled:!O.trim(),onClick:()=>Ae(O.trim()),children:"Use model from above"}),e.jsx(y,{variant:"ghost",onClick:()=>{Ae(""),ot("")},children:"Clear"})]})]}),ee.isError?e.jsx("div",{className:"mt-3",children:e.jsx(Re,{title:"Endpoints error",error:ee.error})}):null,e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-3 text-xs text-zinc-500",children:[e.jsxs("span",{children:["Cached endpoints: ",e.jsx("span",{className:"font-mono",children:K.length})]}),e.jsxs("span",{children:["Matching: ",e.jsx("span",{className:"font-mono",children:ne.length})]}),e.jsxs("span",{children:["Union supported params: ",e.jsx("span",{className:"font-mono",children:Q.size})]}),Q.size?e.jsx(W,{text:JSON.stringify(Array.from(Q).sort(),null,2),label:"Copy union supported params"}):null]}),ne.length?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-4 text-xs text-zinc-700",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:qe,onChange:t=>It(t.target.checked)}),e.jsx("span",{children:"Show perf (uptime/latency/throughput)"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Pe,onChange:t=>Kt(t.target.checked)}),e.jsx("span",{children:"Show provider name"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Ue,onChange:t=>Qt(t.target.checked)}),e.jsx("span",{children:"Show quantization"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:De,onChange:t=>Zt(t.target.checked)}),e.jsx("span",{children:"Show supported params"})]})]}),e.jsx("div",{className:"mt-3 overflow-auto rounded-lg border border-zinc-200 bg-white",children:e.jsxs($,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(d,{children:"Provider"}),Pe?e.jsx(d,{children:"Name"}):null,Ue?e.jsx(d,{children:"Quant"}):null,qe?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"text-right",children:"Uptime"}),e.jsx(d,{className:"text-right",children:"Latency"}),e.jsx(d,{className:"text-right",children:"Throughput"})]}):null,e.jsx(d,{children:"Model"}),e.jsx(d,{children:"Endpoint ID"}),e.jsx(d,{className:"text-right",children:"Context"}),e.jsx(d,{className:"text-right",children:"Prompt"}),e.jsx(d,{className:"text-right",children:"Completion"}),De?e.jsx(d,{children:"Supported params"}):null]})}),e.jsx("tbody",{children:ne.slice(0,50).map((t,n)=>{const r=Array.from(t.supported??new Set).sort(),o=r.slice(0,10).join(", "),s=Array.from(t.quantizations??new Set).join(", ");return e.jsxs("tr",{children:[e.jsx(c,{className:"font-mono text-xs",children:t.provider??"—"}),Pe?e.jsx(c,{className:"text-xs",children:t.providerName??"—"}):null,Ue?e.jsx(c,{className:"font-mono text-xs",children:s||"—"}):null,qe?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"text-right font-mono text-xs",children:bs(t.uptime30m)}),e.jsx(c,{className:"text-right font-mono text-xs",children:Ns(t.latency30m)}),e.jsx(c,{className:"text-right font-mono text-xs",children:ys(t.throughput30m)})]}):null,e.jsx(c,{className:"font-mono text-xs",children:t.model??"—"}),e.jsx(c,{className:"font-mono text-xs",children:t.id??"—"}),e.jsx(c,{className:"text-right font-mono text-xs",children:t.contextLength==null?"—":f(t.contextLength)}),e.jsx(c,{className:"text-right font-mono text-xs",children:t.promptCost==null?"—":String(t.promptCost)}),e.jsx(c,{className:"text-right font-mono text-xs",children:t.completionCost==null?"—":String(t.completionCost)}),De?e.jsx(c,{className:"text-xs",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"text-zinc-700",children:[o||"—",r.length>10?"…":""]}),r.length>10?e.jsxs("details",{children:[e.jsx("summary",{className:"cursor-pointer text-[11px] text-zinc-500",children:"Show all"}),e.jsx("div",{className:"mt-1 whitespace-pre-wrap font-mono text-[11px] text-zinc-600",children:r.join(", ")})]}):null,r.length?e.jsxs("div",{className:"text-[11px] text-zinc-400",children:[r.length," params"]}):null]})}):null]},`${t.id??"id"}-${n}`)})})]})})]}):e.jsx("div",{className:"mt-3 text-xs text-zinc-500",children:ee.isLoading?"Loading cached endpoints…":"No endpoints match the current filters."}),ne.length>50?e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"Showing first 50 matching endpoints. Refine filters to narrow further."}):null]}),e.jsxs(w,{title:"Provider routing simulator",children:[e.jsxs("div",{className:"text-xs text-zinc-600",children:["Preview how OpenRouter ",e.jsx("span",{className:"font-mono",children:"provider"})," routing constraints could reduce the set of available endpoints for a model (using your cached endpoints list). Turn on ",e.jsx("span",{className:"font-mono",children:"require_parameters"})," to simulate strict compatibility when using tools / response_format / plugins."]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Model filter (substring)"}),e.jsx(S,{value:Ee,placeholder:"e.g. gpt-4o-mini",list:"openrouter-model-ids",onChange:t=>at(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Provider only (comma-separated)"}),e.jsx(S,{value:Je,placeholder:"e.g. OpenAI, Anthropic",onChange:t=>it(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Provider ignore (comma-separated)"}),e.jsx(S,{value:$e,placeholder:"e.g. Together",onChange:t=>lt(t.target.value)})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Data collection"}),e.jsxs("select",{value:I,onChange:t=>dt(t.target.value),className:"w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm text-zinc-900 focus:outline-none focus:ring-2 focus:ring-zinc-300",children:[e.jsx("option",{value:"any",children:"Any"}),e.jsx("option",{value:"allow",children:"Allow"}),e.jsx("option",{value:"deny",children:"Deny"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Quantizations (comma-separated)"}),e.jsx(S,{value:Be,placeholder:"e.g. fp16, int8",onChange:t=>ct(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col justify-end gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:de,onChange:t=>mt(t.target.checked)}),"ZDR endpoints only"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:se,onChange:t=>ut(t.target.checked)}),"require_parameters"]})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Advanced params (strict mode)"}),e.jsxs("div",{className:"mt-2 flex flex-col gap-2 text-sm text-zinc-700",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Ie,onChange:t=>xt(t.target.checked)}),"tools / tool_choice"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Ke,onChange:t=>ht(t.target.checked)}),"response_format"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Qe,onChange:t=>pt(t.target.checked)}),"plugins"]})]}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Required keys: ",e.jsx("span",{className:"font-mono",children:re.length?re.join(", "):"(none)"})]}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Tip: if you rely on these, keeping ",e.jsx("span",{className:"font-mono",children:"require_parameters"})," enabled helps avoid providers that ignore unsupported parameters."]})]}),e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Result"}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-600",children:["Matching endpoints: ",e.jsx("span",{className:"font-mono",children:ve.length})]}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-600",children:["Union supported params: ",e.jsx("span",{className:"font-mono",children:Ve.size})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[Ve.size?e.jsx(W,{text:JSON.stringify(Array.from(Ve).sort(),null,2),label:"Copy supported params"}):null,e.jsx(y,{variant:"ghost",onClick:()=>{at(""),it(""),lt(""),ct(""),dt("any"),mt(!1),ut(!1),xt(!1),ht(!1),pt(!1)},children:"Clear"})]})]}),e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Provider routing JSON"}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Copy into ",e.jsx("span",{className:"font-mono",children:"assistant_settings.router.policy.provider"}),"."]}),e.jsx("div",{className:"mt-2",children:e.jsx(W,{text:JSON.stringify(jt,null,2),label:"Copy provider object"})}),e.jsx("pre",{className:"mt-2 max-h-40 overflow-auto rounded-lg bg-zinc-50 p-2 text-[11px] text-zinc-700",children:JSON.stringify(jt,null,2)})]})]}),e.jsxs("details",{className:"mt-3",children:[e.jsxs("summary",{className:"cursor-pointer text-xs text-zinc-600",children:["Show provider names in cache (",Ze.length,")"]}),e.jsx("div",{className:"mt-2 text-xs text-zinc-600",children:Ze.length?Ze.join(", "):"No providers found in cached endpoints."})]}),se&&re.length&&!ve.length?e.jsxs("div",{className:"mt-3 text-xs text-amber-700",children:["No endpoints matched these strict constraints. Try disabling ",e.jsx("span",{className:"font-mono",children:"require_parameters"}),", reducing advanced params, or adjusting provider filters."]}):null]}),e.jsx(w,{title:"OpenRouter usage trends",children:vt.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-64",children:e.jsx(Lt,{width:"100%",height:"100%",children:e.jsxs(Tt,{data:vt,children:[e.jsx(Ot,{dataKey:"dayLabel"}),e.jsx(Ft,{tickFormatter:t=>f(Number(t))}),e.jsx(Mt,{formatter:(t,n)=>n==="Cost"?P(Number(t)):f(Number(t))}),e.jsx(At,{}),e.jsx(Le,{type:"monotone",dataKey:"Tokens",dot:!1}),e.jsx(Le,{type:"monotone",dataKey:"Cost",dot:!1}),e.jsx(Le,{type:"monotone",dataKey:"Requests",dot:!1})]})})}),e.jsxs("div",{className:"mt-3 text-xs text-zinc-500",children:["Trends are based on ",e.jsx("span",{className:"font-mono",children:"openrouter_request_log"})," entries for the last ",a," days."]})]}):e.jsx(Rt,{title:"No OpenRouter usage",message:"No OpenRouter request logs found for this range.",className:"border-0 bg-transparent p-0"})}),e.jsxs(w,{title:"Budgets",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Total daily token budget (optional)"}),e.jsx(S,{type:"number",value:U,placeholder:"0",min:0,onChange:t=>{B(null),ae(!0),R(t.target.value)}}),e.jsx("div",{className:"mt-1 text-xs text-zinc-500",children:"If set, the dashboard will show “remaining” for today."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-zinc-500",children:"Daily budgets by provider (JSON map)"}),e.jsx("textarea",{value:L,rows:6,onChange:t=>{B(null),ae(!0),C(t.target.value)},className:"w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 font-mono text-sm text-zinc-900 placeholder:text-zinc-400 focus:outline-none focus:ring-2 focus:ring-zinc-300",spellCheck:!1}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-500",children:["Keys must match ",e.jsx("span",{className:"font-mono",children:"job_run_log.provider"}),"."]})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[e.jsx(y,{variant:"primary",disabled:nt||!Oe,onClick:async()=>{B(null),rt(!0);try{const t=U.trim();let n=null;if(t!==""){const s=Number(t);if(!Number.isFinite(s)||s<0)throw new Error("Total daily budget must be a non-negative number");n=Math.floor(s)}let r={};try{r=JSON.parse(L||"{}")}catch{throw new Error("Provider budget JSON is invalid")}if(r==null||typeof r!="object"||Array.isArray(r))throw new Error("Provider budget JSON must be an object map");const o={};for(const[s,x]of Object.entries(r)){const m=Number(x);!Number.isFinite(m)||m<0||(o[String(s)]=Math.floor(m))}await ls({total_daily_budget:n,by_provider_budget:o}),ae(!1),await ie.refetch()}catch(t){B((t==null?void 0:t.message)??String(t))}finally{rt(!1)}},children:nt?"Saving…":"Save budgets"}),e.jsx(y,{variant:"ghost",onClick:Dt,children:"Format JSON"}),e.jsx(W,{text:L,label:"Copy JSON"}),e.jsx(y,{variant:"ghost",onClick:Et,disabled:!l,children:"Reset"}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["Stored in DB (",e.jsx("span",{className:"font-mono",children:"admin_costs_settings"}),"). No ENV vars."]}),st?e.jsx("div",{className:"text-xs text-red-600",children:st}):null]})]}),e.jsxs(w,{title:"Per-model token costs (job runs)",children:[e.jsxs($,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(d,{children:"Provider"}),e.jsx(d,{children:"Model"}),e.jsx(d,{className:"text-right",children:"Tokens"}),e.jsx(d,{className:"text-right",children:"Runs"}),e.jsx(d,{className:"text-right",children:"Errors"}),e.jsx(d,{children:"Last run"})]})}),e.jsx("tbody",{children:We.length?We.slice(0,30).map(t=>e.jsxs("tr",{children:[e.jsx(c,{className:"font-mono",children:t.provider??"—"}),e.jsx(c,{className:"font-mono",children:t.model}),e.jsx(c,{className:"text-right font-mono",children:f(t.tokens)}),e.jsx(c,{className:"text-right font-mono",children:f(t.runs)}),e.jsx(c,{className:"text-right font-mono",children:f(t.errors)}),e.jsx(c,{className:"font-mono",children:Ct(t.last_started_at)})]},`${t.provider??""}|${t.model}`)):e.jsx("tr",{children:e.jsx(c,{colSpan:6,className:"text-zinc-500",children:"No model-level data."})})})]}),e.jsxs("div",{className:"mt-3 text-xs text-zinc-500",children:["Token totals are sourced from ",e.jsx("span",{className:"font-mono",children:"job_run_log"})," entries."]})]}),e.jsx(w,{title:"OpenRouter usage by user",children:e.jsxs($,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(d,{children:"User"}),e.jsx(d,{className:"text-right",children:"Tokens"}),e.jsx(d,{className:"text-right",children:"Requests"}),e.jsx(d,{className:"text-right",children:"Cost (USD)"})]})}),e.jsx("tbody",{children:V.byUser.length?V.byUser.slice(0,25).map(t=>e.jsxs("tr",{children:[e.jsx(c,{className:"font-mono",children:t.user_id}),e.jsx(c,{className:"text-right font-mono",children:f(t.tokens)}),e.jsx(c,{className:"text-right font-mono",children:f(t.requests)}),e.jsx(c,{className:"text-right font-mono",children:P(t.cost)})]},t.user_id)):e.jsx("tr",{children:e.jsx(c,{colSpan:4,className:"text-zinc-500",children:"No OpenRouter user usage for this range."})})})]})}),e.jsx(w,{title:"OpenRouter usage by model",children:e.jsxs($,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(d,{children:"Provider"}),e.jsx(d,{children:"Model"}),e.jsx(d,{className:"text-right",children:"Tokens"}),e.jsx(d,{className:"text-right",children:"Requests"}),e.jsx(d,{className:"text-right",children:"Cost (USD)"})]})}),e.jsx("tbody",{children:V.byModel.length?V.byModel.slice(0,25).map(t=>e.jsxs("tr",{children:[e.jsx(c,{className:"font-mono",children:t.provider??"—"}),e.jsx(c,{className:"font-mono",children:t.model}),e.jsx(c,{className:"text-right font-mono",children:f(t.tokens)}),e.jsx(c,{className:"text-right font-mono",children:f(t.requests)}),e.jsx(c,{className:"text-right font-mono",children:P(t.cost)})]},`${t.provider??""}|${t.model}`)):e.jsx("tr",{children:e.jsx(c,{colSpan:5,className:"text-zinc-500",children:"No OpenRouter model usage for this range."})})})]})}),e.jsx(w,{title:"Daily breakdown",children:e.jsxs($,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(d,{children:"Day"}),e.jsx(d,{className:"text-right",children:"Total"}),A.map(t=>e.jsx(d,{className:"text-right",children:t},t))]})}),e.jsx("tbody",{children:E.length?E.map(t=>{const n={};for(const o of A)n[o]=0;for(const o of M)o.day===t&&(n[o.provider]=(n[o.provider]??0)+o.tokens);const r=Object.values(n).reduce((o,s)=>o+s,0);return e.jsxs("tr",{children:[e.jsx(c,{className:"font-mono",children:Y(t,u)}),e.jsx(c,{className:"text-right font-mono",children:f(r)}),A.map(o=>e.jsx(c,{className:"text-right font-mono",children:f(n[o]??0)},o))]},t)}):e.jsx("tr",{children:e.jsx(c,{colSpan:2+A.length,className:"text-zinc-500",children:"No data."})})})]})}),e.jsxs(w,{title:"Top jobs (last period)",children:[e.jsxs($,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(d,{children:"Job"}),e.jsx(d,{children:"Provider"}),e.jsx(d,{className:"text-right",children:"Tokens"}),e.jsx(d,{className:"text-right",children:"Runs"}),e.jsx(d,{className:"text-right",children:"Errors"}),e.jsx(d,{children:"Last run"})]})}),e.jsx("tbody",{children:Ge.length?Ge.slice(0,25).map(t=>e.jsxs("tr",{children:[e.jsx(c,{className:"font-mono",children:t.job_name}),e.jsx(c,{className:"font-mono",children:t.provider??"—"}),e.jsx(c,{className:"text-right font-mono",children:f(t.tokens)}),e.jsx(c,{className:"text-right font-mono",children:f(t.runs)}),e.jsx(c,{className:"text-right font-mono",children:f(t.errors)}),e.jsx(c,{className:"font-mono",children:Ct(t.last_started_at)})]},`${t.job_name}|${t.provider??""}`)):e.jsx("tr",{children:e.jsx(c,{colSpan:6,className:"text-zinc-500",children:"No data."})})})]}),e.jsxs("div",{className:"mt-3 text-xs text-zinc-500",children:["Tip: If you want exact attribution, ensure every worker writes ",e.jsx("span",{className:"font-mono",children:"total_tokens"})," into ",e.jsx("span",{className:"font-mono",children:"job_run_log"}),"."]})]})]})}export{As as default};
