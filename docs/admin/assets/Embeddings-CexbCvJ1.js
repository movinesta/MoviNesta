import{u as A,r as t,j as e,L as M,B as q,f as $,d as V,e as G,h as H}from"./index-CRBf6KpQ.js";import{u as J,E as v}from"./ErrorBox-DVY8vL3c.js";import{u as K}from"./useMutation-DfZD1PiA.js";import{C as h}from"./Card-BKQRm7Rb.js";import{I as d}from"./Input-eqrST-0v.js";import{T as O,a as g,b as m}from"./Table-C_8f92Ce.js";import{E as U}from"./EmptyState-DFwSBMQU.js";function W(i){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:i.children})}function ie(){const i=A(),o=J({queryKey:["embeddings"],queryFn:H}),a=o.data,r=(a==null?void 0:a.embedding_settings)??null,R=(r==null?void 0:r.active_provider)??"—",I=(r==null?void 0:r.active_model)??"—",Q=(r==null?void 0:r.active_dimensions)??1024,B=(r==null?void 0:r.active_task)??"swipe",[x,F]=t.useState(!1),[j,p]=t.useState("voyage"),[b,f]=t.useState("voyage-3-large"),[k,y]=t.useState(1024),[N,u]=t.useState("swipe"),[S,w]=t.useState(!1),[_,z]=t.useState(!1),[E,C]=t.useState(50);t.useEffect(()=>{r&&(x||(p("voyage"),f("voyage-3-large"),y(1024),u(String(r.active_task??"swipe")),w(!!(r.rerank_swipe_enabled??!1)),z(!!(r.rerank_search_enabled??!1)),C(Number(r.rerank_top_k??50)),F(!0)))},[r,x]);const D=t.useMemo(()=>[{provider:"voyage",model:"voyage-3-large",dimensions:1024,task:"swipe"}],[]),n=K({mutationFn:()=>V({provider:j,model:b,dimensions:k,task:N}),onSuccess:async()=>{await i.invalidateQueries({queryKey:["embeddings"]}),await i.invalidateQueries({queryKey:["overview"]})}}),c=K({mutationFn:()=>G({swipe_enabled:S,search_enabled:_,top_k:E}),onSuccess:async()=>{await i.invalidateQueries({queryKey:["embeddings"]}),await i.invalidateQueries({queryKey:["overview"]})}});if(o.isLoading)return e.jsx(M,{});if(o.error)return e.jsx(v,{error:o.error});if(r&&!x)return e.jsx(M,{});const P=(a==null?void 0:a.coverage)??[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{children:"Embeddings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(h,{title:"Active embedding profile",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Provider"}),e.jsx(d,{value:j,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Model"}),e.jsx(d,{value:b,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Dimensions"}),e.jsx(d,{value:String(k),disabled:!0,type:"number"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Task"}),e.jsx(d,{value:N,onChange:s=>u(s.target.value),placeholder:"swipe"})]})]}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:D.map(s=>e.jsxs("button",{className:"rounded-xl border border-zinc-200 bg-zinc-100 px-3 py-2 text-sm text-zinc-700 hover:bg-zinc-200",onClick:()=>{p(s.provider),f(s.model),y(s.dimensions),u(s.task)},children:[s.provider,": ",s.model]},`${s.provider}-${s.model}`))}),e.jsxs("div",{className:"mt-4",children:[e.jsx(q,{onClick:()=>n.mutate(),disabled:n.isPending,children:n.isPending?"Saving…":"Set active profile"}),n.isError?e.jsx(v,{error:n.error,className:"mt-2"}):null]}),e.jsxs("div",{className:"mt-4 text-xs text-zinc-500",children:["Current: ",e.jsx("span",{className:"font-mono",children:R})," / ",e.jsx("span",{className:"font-mono",children:I})," (",Q,") task=",B]})]}),e.jsx(h,{title:"Rerank settings (Voyage rerank-2.5)",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 text-sm text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:s=>w(s.target.checked)}),"Enable rerank for swipe deck"]}),e.jsxs("label",{className:"flex items-center gap-3 text-sm text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:s=>z(s.target.checked)}),"Enable rerank for search results"]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Top K candidates to rerank"}),e.jsx(d,{value:String(E),onChange:s=>{const l=s.target.value;if(l==="")return;const T=Number(l);if(!Number.isFinite(T))return;const L=Math.max(5,Math.min(200,Math.trunc(T)));C(L)},type:"number",min:5,max:200})]}),e.jsx(q,{onClick:()=>c.mutate(),disabled:c.isPending,children:c.isPending?"Saving…":"Save rerank settings"}),c.isError?e.jsx(v,{error:c.error,className:"mt-2"}):null]})})]}),e.jsx(h,{title:"Stored embedding coverage",children:e.jsxs(O,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(g,{children:"Provider"}),e.jsx(g,{children:"Model"}),e.jsx(g,{className:"text-right",children:"Count"})]})}),e.jsx("tbody",{children:P.length?P.map((s,l)=>e.jsxs("tr",{children:[e.jsx(m,{children:s.provider}),e.jsx(m,{className:"font-mono text-xs",children:s.model}),e.jsx(m,{className:"text-right",children:$(s.count)})]},l)):e.jsx("tr",{children:e.jsx(m,{colSpan:3,className:"p-6",children:e.jsx(U,{title:"No coverage",message:"No embedding coverage rows were returned.",className:"border-0 bg-transparent p-0"})})})})]})})]})}export{ie as default};
