import{j as e,e as A,r as m,B as x,u as ln,n as cn,G as dn,H as mn,L as un,I as ee,J as xn,K as pn,M as hn,N as fn,O as Ds,P as Et,Q as At,S as gn,T as vn}from"./index-RmnKeFJ0.js";import{u as We,E as bn}from"./ErrorBox-CT9uctWi.js";import{u as te}from"./useMutation-BNYkbyWO.js";import{C as he}from"./Card-BlxKcLs_.js";import{I as y}from"./Input-D4LaOzI6.js";function se(r){return e.jsx("button",{type:"button",title:r.title??"Hint","aria-label":r.title??"Hint",onClick:r.onClick,className:A("inline-flex h-5 w-5 items-center justify-center rounded-full border border-zinc-200 bg-white text-[11px] font-bold text-zinc-600 shadow-sm hover:bg-zinc-50","focus:outline-none focus:ring-2 focus:ring-zinc-300",r.className),children:"i"})}function fe(r){try{return JSON.stringify(r,null,2)}catch{return String(r)}}function yn(r){if(!r)return"";const i=new Date(r);return Number.isFinite(i.getTime())?i.toLocaleString():String(r)}function Fs(r){return(r.split(".").filter(Boolean).slice(-1)[0]??r).replace(/_/g," ").replace(/\w/g,d=>d.toUpperCase())}function jn(r){var ae;const{open:i,settingKey:d,entry:u,row:I,status:j,hint:c,effectiveValue:h,draftValue:w,recentHistory:g,onClose:N,onCopyKey:O,onOpenHistory:_,onApplyValue:S,onNavigateToKey:M}=r;if(m.useEffect(()=>{if(!i)return;const v=Q=>{Q.key==="Escape"&&N()};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[i,N]),!i)return null;const k=(c==null?void 0:c.impacts)??{},L=Object.keys(k).filter(v=>!!k[v]),T=[];return c&&c.recommended!==void 0&&T.push({label:"Recommended",value:c.recommended,why:c.recommended_why??null}),c&&c.recommended_safe!==void 0&&T.push({label:"Safe",value:c.recommended_safe,why:c.recommended_safe_why??null}),c&&c.recommended_aggressive!==void 0&&T.push({label:"Aggressive",value:c.recommended_aggressive,why:c.recommended_aggressive_why??null}),e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("button",{type:"button","aria-label":"Close",className:"absolute inset-0 bg-black/30",onClick:N}),e.jsxs("div",{className:"absolute right-0 top-0 flex h-full w-full max-w-2xl flex-col bg-white shadow-2xl",role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 border-b border-zinc-200 px-4 py-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"truncate font-mono text-xs text-zinc-900",children:d??"Setting"}),u?e.jsx("span",{className:A("rounded-lg px-2 py-1 text-xs font-semibold",u.scope==="public"&&"bg-emerald-100 text-emerald-800",u.scope==="admin"&&"bg-zinc-200 text-zinc-800",u.scope==="server_only"&&"bg-blue-100 text-blue-800"),children:u.scope}):null,j?e.jsx("span",{className:A("rounded-full px-2 py-0.5 text-[10px] font-semibold",j==="default"&&"bg-zinc-100 text-zinc-700",j==="overridden"&&"bg-amber-100 text-amber-900",j==="redundant"&&"bg-purple-100 text-purple-900"),children:j}):null]}),(c==null?void 0:c.title)??(d?Fs(d):null)?e.jsx("div",{className:"mt-1 text-sm font-semibold text-zinc-900",children:(c==null?void 0:c.title)??(d?Fs(d):"")}):null,u!=null&&u.description?e.jsx("div",{className:"mt-1 text-sm text-zinc-700",children:u.description}):null]}),e.jsxs("div",{className:"flex items-center gap-2",children:[O?e.jsx(x,{variant:"ghost",onClick:O,children:"Copy key"}):null,_?e.jsx(x,{variant:"ghost",onClick:_,children:"History"}):null,e.jsx(x,{type:"button",variant:"ghost",className:"rounded-lg border border-zinc-200 bg-white px-2 py-1 text-xs font-semibold text-zinc-700 hover:bg-zinc-50",onClick:N,children:"Close"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"What it does"}),e.jsx("div",{className:"mt-2 whitespace-pre-wrap text-sm text-zinc-700",children:(c==null?void 0:c.details)??(u==null?void 0:u.description)??"No documentation for this setting yet."}),c!=null&&c.caution?e.jsxs("div",{className:"mt-3 text-sm font-medium text-amber-700",children:["⚠ ",c.caution]}):null,L.length?e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Impact"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:L.map(v=>e.jsxs("span",{className:"rounded-full bg-white px-3 py-1 text-[11px] font-semibold text-zinc-700 ring-1 ring-zinc-200",children:[String(v),k[v]?e.jsx("span",{className:"ml-2 font-normal text-zinc-500",children:String(k[v])}):null]},String(v)))})]}):null]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Current (effective)"}),e.jsx("pre",{className:"mt-2 max-h-40 overflow-auto rounded-xl border border-zinc-200 bg-zinc-50 p-2 text-xs",children:fe(h)})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Draft (will save)"}),e.jsx("pre",{className:"mt-2 max-h-40 overflow-auto rounded-xl border border-zinc-200 bg-zinc-50 p-2 text-xs",children:fe(w)})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Default"}),e.jsx("pre",{className:"mt-2 max-h-40 overflow-auto rounded-xl border border-zinc-200 bg-zinc-50 p-2 text-xs",children:fe(u==null?void 0:u.default)})]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Real-life examples"}),e.jsx("div",{className:"mt-3 space-y-3",children:((c==null?void 0:c.examples)??[]).length?((c==null?void 0:c.examples)??[]).map((v,Q)=>e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-800",children:v.scenario}),e.jsx("div",{className:"mt-1 text-sm text-zinc-700",children:v.effect})]},Q)):e.jsx("div",{className:"text-sm text-zinc-500",children:"No examples available for this setting yet."})})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Recommended values"}),S&&T.length?e.jsx("div",{className:"text-xs text-zinc-500",children:"Apply will update the draft (don’t forget to Save)."}):null]}),T.length?e.jsx("div",{className:"mt-3 space-y-3",children:T.map(v=>e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-800",children:v.label}),v.why?e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:v.why}):null]}),S?e.jsx(x,{variant:"ghost",onClick:()=>S(v.value),children:"Apply"}):null]}),e.jsx("pre",{className:"mt-2 max-h-44 overflow-auto rounded-xl border border-zinc-200 bg-white p-2 text-xs",children:fe(v.value)})]},v.label))}):e.jsx("div",{className:"mt-2 text-sm text-zinc-500",children:"No curated recommendations for this setting yet."})]}),(ae=c==null?void 0:c.related)!=null&&ae.length?e.jsxs("div",{className:"mt-4 rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Related settings"}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:c.related.map(v=>e.jsx(x,{type:"button",variant:"ghost",onClick:()=>M==null?void 0:M(v),className:"rounded-full border border-zinc-200 bg-white px-3 py-1 text-xs font-semibold text-zinc-700 hover:bg-zinc-50",children:v},v))})]}):null,e.jsxs("div",{className:"mt-4 rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Change history"}),_?e.jsx(x,{variant:"ghost",onClick:_,children:"View all"}):null]}),e.jsx("div",{className:"mt-3 space-y-2",children:(g??[]).length?(g??[]).slice(0,5).map(v=>e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-800",children:yn(v.changed_at)}),e.jsx("div",{className:"text-[11px] text-zinc-500",children:v.request_id?`req ${v.request_id}`:""})]}),v.change_reason?e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:v.change_reason}):null,e.jsxs("div",{className:"mt-2 grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-zinc-600",children:"Old"}),e.jsx("pre",{className:"mt-1 max-h-28 overflow-auto rounded-lg border border-zinc-200 bg-white p-2 text-[11px]",children:fe(v.old_value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-zinc-600",children:"New"}),e.jsx("pre",{className:"mt-1 max-h-28 overflow-auto rounded-lg border border-zinc-200 bg-white p-2 text-[11px]",children:fe(v.new_value)})]})]})]},v.id)):e.jsx("div",{className:"text-sm text-zinc-500",children:"No history rows found for this key."})})]}),e.jsx("div",{className:"h-6"})]})]})]})}const wn={"ux.presence.heartbeat_ms":{title:"Presence heartbeat",details:"How often the client broadcasts presence heartbeats (ms). Smaller values feel more ‘live’ but create more realtime traffic.",examples:[{scenario:"Set to 10000ms",effect:"Faster updates; higher Realtime traffic + battery use."},{scenario:"Set to 30000ms",effect:"Lower traffic; presence may lag slightly."}],recommended:2e4,recommended_why:"Balanced default: responsive without being too chatty.",recommended_safe:25e3,recommended_safe_why:"Slightly less Realtime traffic, still responsive.",recommended_aggressive:1e4,recommended_aggressive_why:"Very snappy presence, but higher traffic.",impacts:{ux:"presence freshness",performance:"realtime traffic"},caution:"Very low values can increase Realtime load and mobile battery usage.",related:["ux.presence.online_ttl_ms","ux.presence.db_touch_min_interval_ms"]},"ux.presence.online_ttl_ms":{title:"Online TTL window",details:"A user is shown as ‘online’ if their last_seen timestamp is within this window (ms).",examples:[{scenario:"Lower it (e.g., 20000ms)",effect:"Online clears faster when users disconnect abruptly."},{scenario:"Raise it (e.g., 90000ms)",effect:"Users stay online longer; less accurate."}],recommended:45e3,recommended_why:"Default: responsive but tolerant of mobile networks.",impacts:{ux:"online accuracy"},related:["ux.presence.heartbeat_ms","ux.presence.db_touch_min_interval_ms"]},"ux.presence.away_ttl_ms":{title:"Away TTL window",details:"A user is shown as ‘away’ (recently active) if last_seen is within this window (ms).",examples:[{scenario:"Set to 60000ms",effect:"Away expires quickly; users move to ‘offline’ sooner."},{scenario:"Set to 600000ms",effect:"Away lasts longer; more forgiving but less precise."}],recommended:12e4,recommended_why:"Good UX default: not too aggressive on offline transitions.",impacts:{ux:"presence labels"},related:["ux.presence.online_ttl_ms"]},"ux.presence.db_touch_min_interval_ms":{title:"DB last_seen write interval",details:"Minimum interval between writing last_seen to the database (ms). Throttles DB writes while preserving UX.",examples:[{scenario:"Set to 30000ms",effect:"More accurate timestamps; more DB writes."},{scenario:"Set to 120000ms",effect:"Fewer DB writes; less granular last_seen."}],recommended:6e4,recommended_why:"Default throttle to protect DB while keeping timestamps useful.",impacts:{performance:"db write volume",ops:"db load"},related:["ux.presence.heartbeat_ms"]},"ux.presence.initial_sync_delay_ms":{title:"Presence initial sync delay",details:"Delay before forcing the first presence sync after subscribing (ms). Helps avoid bursts during initial load.",examples:[{scenario:"Set to 0",effect:"Fastest initial presence; can burst on load."},{scenario:"Set to 200",effect:"Smoother load; tiny UX delay."}],recommended:150,recommended_why:"Small delay that reduces burstiness while feeling instant.",impacts:{performance:"burst control",ux:"first load"},related:["ux.presence.heartbeat_ms"]},"ux.typing.remote_ttl_ms":{title:"Remote typing TTL",details:"How long to keep showing a remote user as typing if no new typing heartbeat arrives (ms).",examples:[{scenario:"Set to 3000ms",effect:"Typing clears quickly; can feel unstable on poor networks."},{scenario:"Set to 10000ms",effect:"More forgiving; may feel stale."}],recommended:5e3,recommended_why:"Good balance for mobile networks without feeling stale.",impacts:{ux:"typing stability"},related:["ux.typing.heartbeat_ms","ux.typing.inactivity_ms"]},"ux.typing.inactivity_ms":{title:"Typing inactivity cutoff",details:"Stops sending ‘typing’ after this many ms without local input.",examples:[{scenario:"Set to 1500ms",effect:"Typing clears quickly; can be ‘flickery’."},{scenario:"Set to 6000ms",effect:"More stable; slower to disappear."}],recommended:3e3,recommended_why:"A natural ‘typing pause’ threshold.",impacts:{ux:"typing feel"},related:["ux.typing.remote_ttl_ms"]},"ux.typing.heartbeat_ms":{title:"Typing heartbeat",details:"Maximum frequency for broadcasting typing updates (ms).",examples:[{scenario:"Set to 1000ms",effect:"More realtime updates; higher traffic."},{scenario:"Set to 4000ms",effect:"Lower traffic; typing may lag slightly."}],recommended:2e3,recommended_why:"Responsive without being too chatty.",impacts:{ux:"typing freshness",performance:"realtime traffic"},related:["ux.typing.remote_ttl_ms"]},"ux.messages.max_message_chars":{title:"Max message length",details:"Maximum characters allowed in the message composer.",examples:[{scenario:"Set to 500",effect:"Forces short messages; can frustrate long-form users."},{scenario:"Set to 5000",effect:"Supports long messages; increases AI prompt cost."}],recommended:2e3,recommended_why:"Default supports natural chat while preventing extremely long messages.",impacts:{ux:"composer limits",cost:"ai tokens"},caution:"Very large values can increase AI costs and slow rendering on large threads.",related:["assistant.reply_runner.max_context_messages"]},"ux.messages.composer_max_height_px":{title:"Composer max height",details:"Maximum auto-resize height for the composer textarea (px).",examples:[{scenario:"Set to 100px",effect:"More compact UI; users scroll sooner."},{scenario:"Set to 300px",effect:"Easier long editing; uses more vertical space."}],recommended:140,recommended_why:"Default keeps UI tidy while allowing multi-line editing.",impacts:{ux:"layout density"}},"ux.attachments.max_image_bytes":{title:"Max image upload size",details:"Client-side limit for chat image upload size (bytes). Prevents huge uploads before the server rejects them.",examples:[{scenario:"Set to 5MB",effect:"Faster uploads; fewer large images allowed."},{scenario:"Set to 20MB",effect:"Allows bigger images; slower uploads and higher storage/bandwidth."}],recommended:10*1024*1024,recommended_why:"10MB is a practical balance for mobile images.",impacts:{ux:"upload success",cost:"storage/bandwidth"},caution:"Raising this increases storage and bandwidth costs."},"ux.search.min_query_chars":{title:"Search min query length",details:"Minimum query length to enable search. Prevents expensive queries for tiny inputs.",examples:[{scenario:"Set to 1",effect:"Search triggers quickly; more query load."},{scenario:"Set to 3",effect:"Less load; users type more before results."}],recommended:2,recommended_why:"Good balance between responsiveness and avoiding noisy queries.",impacts:{performance:"query load",ux:"search responsiveness"},related:["ux.search.page_size","ops.search.timeout_ms"]},"ux.search.page_size":{title:"Search page size",details:"How many results per page for search. Higher values return more results but can be slower.",examples:[{scenario:"Set to 10",effect:"Faster responses; more pagination."},{scenario:"Set to 50",effect:"Fewer pages; heavier payload and slower."}],recommended:20,recommended_why:"Useful results while staying fast.",impacts:{performance:"payload size",ux:"scroll depth"}},"ux.search.stale_time_ms":{title:"Search cache staleTime",details:"React Query staleTime for search (ms). Higher values mean fewer refetches, but more stale results.",examples:[{scenario:"Set to 0",effect:"Always refetch; freshest but more requests."},{scenario:"Set to 30 minutes",effect:"Fewer calls; results can lag new content."}],recommended:1e3*60*30,recommended_why:"Default reduces repeated calls while keeping results reasonably fresh.",impacts:{performance:"request volume",ux:"perceived speed"}},"ux.search.gc_time_ms":{title:"Search cache gcTime",details:"How long to keep unused search results in cache (ms).",examples:[{scenario:"Set to 5 minutes",effect:"Lower memory; more refetches."},{scenario:"Set to 2 hours",effect:"Fewer refetches; more memory usage."}],recommended:1e3*60*60,recommended_why:"Keeps common searches warm without keeping data forever.",impacts:{performance:"memory usage"}},"ux.search.batch_sync_limit":{title:"Search background sync batch size",details:"How many records the client syncs per batch (when doing background search index sync).",examples:[{scenario:"Set to 200",effect:"Smoother but slower overall sync."},{scenario:"Set to 2000",effect:"Faster sync; can spike CPU/network."}],recommended:800,recommended_why:"Default avoids spikes on mid-range devices.",impacts:{performance:"sync burst",ux:"background smoothness"}},"ops.rate_limits":{title:"Per-action rate limits",details:"Server-only throttle settings used by Edge Functions to limit abusive/high-cost operations.",examples:[{scenario:"Lower catalog-sync to 30/min",effect:"Prevents bursts; slower bulk sync for users."},{scenario:"Raise to 120/min",effect:"Faster sync, but higher DB/API pressure."}],recommended:{actions:{"catalog-sync":60}},recommended_why:"Keeps sync responsive while preventing accidental tight loops.",recommended_safe:{actions:{"catalog-sync":30}},recommended_safe_why:"More conservative; better during outages or heavy load.",recommended_aggressive:{actions:{"catalog-sync":120}},recommended_aggressive_why:"Faster bursts; higher DB/API pressure.",impacts:{ops:"throttling",performance:"DB/API load",cost:"upstream usage"},caution:"High values can amplify costs and rate-limit upstream services."},"assistant.tool_result_truncation":{title:"Assistant tool result truncation",details:"Caps tool outputs returned to the assistant/client so huge payloads don’t blow up tokens or UI.",examples:[{scenario:"Increase maxString to 2500",effect:"More context in tool results; higher token usage."},{scenario:"Reduce maxArray to 20",effect:"Smaller payloads; might hide useful list items."}],recommended:{defaults:{maxString:1200,maxArray:40,maxObjectKeys:60},caps:{maxString:4e3,maxArray:200,maxObjectKeys:200},maxDepth:4},recommended_why:"Keeps most tool responses usable while preventing huge token spikes.",recommended_safe:{defaults:{maxString:800,maxArray:30,maxObjectKeys:40},caps:{maxString:2500,maxArray:120,maxObjectKeys:120},maxDepth:4},recommended_safe_why:"More conservative payload sizes; reduces token/cost risk.",recommended_aggressive:{defaults:{maxString:2e3,maxArray:60,maxObjectKeys:80},caps:{maxString:6e3,maxArray:300,maxObjectKeys:300},maxDepth:5},recommended_aggressive_why:"More context in tool results; higher token usage risk.",impacts:{cost:"tokens",performance:"payload size",ux:"assistant quality"}},"assistant.reply_runner.backoff":{title:"Assistant reply runner backoff",details:"How the background worker spaces retries after failures (exponential backoff + jitter).",examples:[{scenario:"Increase base_seconds to 20",effect:"Slower retries; reduces contention during outages."},{scenario:"Reduce max_seconds to 600",effect:"Faster recovery after transient errors; more retry load."}],recommended:{base_seconds:10,max_exp:10,max_seconds:3600,jitter_seconds:5},recommended_why:"Balances resilience (keeps trying) without hammering providers.",recommended_safe:{base_seconds:15,max_exp:10,max_seconds:7200,jitter_seconds:8},recommended_safe_why:"Slower retries; safer during provider issues/outages.",recommended_aggressive:{base_seconds:5,max_exp:9,max_seconds:1200,jitter_seconds:3},recommended_aggressive_why:"Faster recovery from transient errors; more retry pressure.",impacts:{ops:"retries",performance:"queue pressure",cost:"provider usage"}},"admin.users.page_limit":{title:"Admin Users list page size",details:"Controls how many users the Admin Users page fetches per request.",examples:[{scenario:"Set to 25",effect:"Faster load, less scrolling; more pagination."},{scenario:"Set to 200",effect:"Fewer pages; can slow load for large accounts."}],recommended:50,recommended_why:"Good balance between speed and admin convenience.",recommended_safe:25,recommended_safe_why:"Faster loads on big accounts; more pagination.",recommended_aggressive:150,recommended_aggressive_why:"Fewer pages; heavier response payloads.",impacts:{ux:"admin speed",performance:"endpoint load"},caution:"Very high values can stress admin endpoints."},"admin.audit.default_limit":{title:"Audit default limit",details:"Default row count returned by Admin Audit if no limit is provided.",examples:[{scenario:"Set to 20",effect:"Quick glance view; less scrolling."},{scenario:"Set to 150",effect:"More history visible; heavier response payload."}],recommended:50,recommended_why:"Enough rows for investigation without huge payloads.",recommended_safe:25,recommended_safe_why:"Quicker load; smaller payload.",recommended_aggressive:150,recommended_aggressive_why:"More rows visible; heavier responses.",impacts:{ux:"investigation speed",performance:"endpoint load"}},"assistant.reply_runner.claim_limit_default":{title:"Runner claim limit",details:"How many pending assistant-reply jobs a single runner invocation claims by default. Higher values increase throughput, but can cause bigger traffic bursts and increase the chance of timeouts.",examples:[{scenario:"Set to 10",effect:"Smoother load; slower backlog drain during spikes."},{scenario:"Set to 50",effect:"Faster backlog drain; more bursty provider usage and higher risk of hitting rate limits."}],recommended:20,recommended_why:"A balanced default: drains normal queues quickly without creating huge bursts.",recommended_safe:10,recommended_safe_why:"Lower burst risk; good for smaller deployments or tight provider limits.",recommended_aggressive:50,recommended_aggressive_why:"Maximizes throughput if you have headroom and strong rate-limit handling.",impacts:{performance:"throughput vs burstiness",cost:"provider usage spikes",ops:"queue stability"},caution:"If set too high, one invocation may spend its entire time budget processing claims and leave jobs half-finished.",related:["assistant.reply_runner.max_attempts_default","assistant.reply_runner.backoff","assistant.reply_runner.stuck_minutes"]},"assistant.reply_runner.max_attempts_default":{title:"Runner max attempts",details:"Default maximum retry attempts for a job. More attempts improves resilience during transient failures, but can turn outages into repeated retries.",examples:[{scenario:"Set to 3",effect:"Quicker failure; fewer retries during outages; less wasted cost."},{scenario:"Set to 7",effect:"More persistent retries; better recovery, but more load while degraded."}],recommended:5,recommended_why:"Good resilience without endless retries.",recommended_safe:3,recommended_safe_why:"Minimizes retry cost during provider outages.",recommended_aggressive:7,recommended_aggressive_why:"More persistent recovery when failures are usually transient.",impacts:{ops:"retry behavior",cost:"extra generations",safety:"stability under outages"},caution:"If retries are too high, a provider outage can create a retry storm.",related:["assistant.reply_runner.backoff","assistant.reply_runner.claim_limit_default"]},"assistant.reply_runner.stuck_minutes":{title:"Stuck job detection window",details:"How long a job can be ‘in progress’ without updates before it’s considered stuck and eligible for recovery.",examples:[{scenario:"Set to 5 minutes",effect:"Faster recovery from crashed workers; higher chance of false positives on slow runs."},{scenario:"Set to 20 minutes",effect:"Fewer false positives; slower recovery when a worker dies."}],recommended:10,recommended_why:"Enough time for normal work, while still recovering quickly from crashes.",recommended_safe:15,recommended_safe_why:"Reduces false positives if jobs sometimes take longer (slow providers).",recommended_aggressive:5,recommended_aggressive_why:"Fastest recovery if you prioritize responsiveness.",impacts:{ops:"job recovery speed",performance:"queue latency",cost:"duplicate work risk"},caution:"Too low can cause duplicate processing (two workers may re-run the same job).",related:["assistant.reply_runner.max_attempts_default","assistant.reply_runner.backoff"]},"assistant.reply_runner.max_context_messages":{title:"Max context messages",details:"How many recent messages are included as context when generating a reply. More context can improve quality, but increases tokens and latency.",examples:[{scenario:"Set to 8",effect:"Cheaper/faster replies; may lose important earlier context."},{scenario:"Set to 20",effect:"Better continuity; higher token cost and higher risk of long prompts."}],recommended:12,recommended_why:"Typically enough to keep conversation coherent without bloating prompts.",recommended_safe:10,recommended_safe_why:"Saves cost while staying coherent for most chats.",recommended_aggressive:18,recommended_aggressive_why:"More context for complex conversations (higher cost).",impacts:{ux:"assistant coherence",cost:"token usage",performance:"latency"},caution:"Very high values can lead to long prompts and more frequent provider length limits.",related:["assistant.tool_result_truncation"]},"ml.rerank.provider":{title:"Rerank provider",details:'Which provider is used for reranking. In this project, only "voyage" is supported right now.',examples:[{scenario:"Keep default: voyage",effect:"Rerank works as expected."},{scenario:"Change to something else",effect:"Will likely fail validation/server calls because only voyage is supported."}],recommended:"voyage",recommended_why:"Only supported option at the moment.",recommended_safe:"voyage",recommended_safe_why:"Same as recommended.",recommended_aggressive:"voyage",recommended_aggressive_why:"Same as recommended.",impacts:{ux:"ranking quality",performance:"latency",cost:"provider usage",ops:"stability"},caution:"If you want a different provider, add support in the server implementation + schema first.",related:["ml.rerank.model","ops.rerank.adaptive_topk","ops.rerank.cache_ttl_seconds"]},"ml.rerank.model":{title:"Voyage rerank model",details:'The Voyage model name used for reranking (example: "rerank-2.5"). This controls quality vs latency/cost.',examples:[{scenario:"rerank-2.5",effect:"Balanced default for quality and speed."},{scenario:"Other Voyage model",effect:"May change quality/cost; check Voyage docs for supported model names."}],recommended:"rerank-2.5",recommended_why:"Project default; a good balance for most catalogs.",recommended_safe:"rerank-2.5",recommended_safe_why:"Stick to the known-good default unless you’ve tested alternatives.",recommended_aggressive:"rerank-2.5",recommended_aggressive_why:"Aggressive tuning is usually done via candidate sizing, not model name.",impacts:{ux:"ranking quality",performance:"latency",cost:"provider usage"},caution:"If the model name is wrong/unsupported, rerank calls may error. Always test in staging.",related:["ml.rerank.provider","ops.rerank.adaptive_topk","ops.rerank.fresh_window_seconds"]},"admin.overview.recent_errors_limit":{title:"Recent errors limit",details:"How many recent errors the Overview page fetches and displays. Higher values can help investigation but increases payload size.",examples:[{scenario:"Set to 20",effect:"Faster overview load; shorter error list."},{scenario:"Set to 200",effect:"More investigation context; bigger payload and slower load."}],recommended:50,recommended_why:"Enough context for triage without making the overview heavy.",recommended_safe:25,recommended_safe_why:"Lightweight overview for smaller admin devices.",recommended_aggressive:150,recommended_aggressive_why:"More context for ops-heavy workflows.",impacts:{ux:"triage speed",performance:"overview load time",ops:"debugging depth"},related:["admin.overview.last_job_runs_limit","admin.audit.default_limit"]},"admin.overview.last_job_runs_limit":{title:"Last job runs limit",details:"How many recent job runs the Overview page shows (cron / background tasks).",examples:[{scenario:"Set to 10",effect:"Quick snapshot; less historical context."},{scenario:"Set to 50",effect:"More history; slightly heavier payload."}],recommended:20,recommended_why:"Clear overview without long tables.",recommended_safe:10,recommended_safe_why:"Minimal payload; good on low bandwidth.",recommended_aggressive:50,recommended_aggressive_why:"More context if you rely on Overview for historical checks.",impacts:{ux:"monitoring convenience",performance:"payload size"},related:["admin.overview.recent_errors_limit","admin.audit.default_limit"]},"admin.users.ban_duration_days":{title:"Default ban duration (days)",details:"How long a ban lasts when you ban a user from the admin dashboard. This is used to set banned_until.",examples:[{scenario:"Set to 7",effect:"Short suspensions; users can return automatically."},{scenario:"Set to 365",effect:"Long bans; still reversible by unbanning."},{scenario:"Set to 18,250 (~50 years)",effect:"Effectively permanent bans unless manually reversed."}],recommended:18250,recommended_why:"Treat bans as ‘permanent’ by default so serious abuse doesn’t auto-expire.",recommended_safe:365,recommended_safe_why:"Long but not permanent; good if you prefer auto-expiring bans.",recommended_aggressive:30,recommended_aggressive_why:"Shorter bans to reduce support friction (manual escalation for repeat abuse).",impacts:{safety:"abuse mitigation",ops:"moderation workflow",ux:"support burden"},caution:"Very short bans can make abuse recurring unless you monitor closely.",related:["admin.users.page_limit"]},"ops.frontend.function_timeout_ms":{title:"Frontend function timeout",details:"Client-side timeout for calling Edge Functions. If the function doesn’t respond before this, the UI reports an error.",examples:[{scenario:"Set to 12s",effect:"Fails fast; better UX during incidents; higher chance of false timeouts on slow networks."},{scenario:"Set to 30s",effect:"Fewer false timeouts; users wait longer when something is stuck."}],recommended:2e4,recommended_why:"Good balance for most Edge Function calls.",recommended_safe:3e4,recommended_safe_why:"Better for slow networks or heavier functions; users wait longer.",recommended_aggressive:12e3,recommended_aggressive_why:"Fast failure for snappy UX and faster incident detection.",impacts:{ux:"perceived responsiveness",ops:"incident detection",performance:"hanging requests"},related:["ops.search.timeout_ms","integrations.tmdb_proxy.timeout_ms"]},"ops.search.timeout_ms":{title:"Search timeout (ms)",details:"Timeout budget for search-related server calls. If exceeded, the request fails to protect UX and costs.",examples:[{scenario:"Set to 10s",effect:"Search fails faster during slowness; fewer long tail requests."},{scenario:"Set to 45s",effect:"More searches succeed under load; users may wait too long."}],recommended:2e4,recommended_why:"Prevents long tail waits while still allowing normal success.",recommended_safe:3e4,recommended_safe_why:"Better success rate under moderate load at the cost of slower UX.",recommended_aggressive:12e3,recommended_aggressive_why:"Snappier UX; good if your search infra is consistently fast.",impacts:{ux:"search latency",cost:"long tail compute",ops:"SLO protection"},related:["ops.frontend.function_timeout_ms"]},"ops.rerank.cache_ttl_seconds":{title:"Rerank cache TTL (seconds)",details:"How long rerank responses are cached. Higher TTL reduces provider calls and cost, but can serve slightly older results.",examples:[{scenario:"Set to 300 (5m)",effect:"Fresher results; more provider calls."},{scenario:"Set to 1800 (30m)",effect:"Lower cost; can reuse cached reranks longer."}],recommended:600,recommended_why:"Great cost/quality balance for most workloads.",recommended_safe:300,recommended_safe_why:"Prioritizes freshness if your catalog changes frequently.",recommended_aggressive:1800,recommended_aggressive_why:"Prioritizes cost reduction if rerank calls are expensive.",impacts:{cost:"provider usage",performance:"latency",ux:"freshness"},related:["ops.rerank.fresh_window_seconds","ops.rerank.cooldown_429_seconds"]},"ops.rerank.fresh_window_seconds":{title:"Rerank freshness window (seconds)",details:"If a title/user signal is considered ‘fresh’, rerank may prefer recalculating instead of using older cache. Lower values mean more cache hits; higher values mean more fresh recompute.",examples:[{scenario:"Set to 4h",effect:"More cache hits; cheaper; slightly less reactive to rapid preference changes."},{scenario:"Set to 12h",effect:"More recompute; more reactive; higher cost."}],recommended:21600,recommended_why:"6 hours balances responsiveness with cost.",recommended_safe:14400,recommended_safe_why:"Cheaper default if preferences don’t change rapidly.",recommended_aggressive:43200,recommended_aggressive_why:"More recompute window to capture preference shifts.",impacts:{ux:"recommendation responsiveness",cost:"rerank calls"},related:["ops.rerank.cache_ttl_seconds"]},"ops.rerank.cooldown_429_seconds":{title:"Rerank 429 cooldown (seconds)",details:"When the rerank provider returns rate-limited (HTTP 429), the system pauses rerank calls for this cooldown window to avoid repeated failures.",examples:[{scenario:"Set to 120 (2m)",effect:"Retries sooner; may keep hitting 429 if limits are tight."},{scenario:"Set to 900 (15m)",effect:"Backs off harder; fewer 429 loops but slower recovery."}],recommended:300,recommended_why:"A practical default that avoids 429 loops without stalling too long.",recommended_safe:600,recommended_safe_why:"More conservative; better if provider limits are strict.",recommended_aggressive:120,recommended_aggressive_why:"Faster recovery if 429s are rare and short-lived.",impacts:{ops:"rate-limit stability",cost:"wasted calls",performance:"recovery time"},related:["ops.rerank.cache_ttl_seconds","ops.rate_limits"]},"integrations.tmdb_proxy.default_language":{title:"TMDB default language",details:"Default language passed to TMDB when the client does not specify one (e.g., UI language).",examples:[{scenario:"en-US",effect:"English titles/overviews by default."},{scenario:"ar-IQ",effect:"Arabic titles/overviews when available."}],recommended:"en-US",recommended_why:"Matches most catalogs; override per-request for localized UX.",impacts:{ux:"localization"},related:["integrations.tmdb_proxy.max_query_len","integrations.tmdb_proxy.timeout_ms"]},"integrations.tmdb_proxy.max_query_len":{title:"TMDB max query length",details:"Maximum allowed length for TMDB search queries. Prevents abuse (huge payloads) and avoids pathological search queries.",examples:[{scenario:"Set to 100",effect:"Stricter input; may reject very long pasted text."},{scenario:"Set to 400",effect:"More permissive; slightly higher abuse surface."}],recommended:200,recommended_why:"Allows normal queries while blocking obvious abuse and giant payloads.",recommended_safe:120,recommended_safe_why:"More conservative if you’ve seen abuse.",recommended_aggressive:300,recommended_aggressive_why:"More permissive UX at the cost of a slightly larger attack surface.",impacts:{safety:"abuse prevention",ops:"input guardrails",ux:"search flexibility"},related:["integrations.tmdb_proxy.max_per_minute"]},"integrations.tmdb_proxy.max_page":{title:"TMDB max page",details:"Maximum page number allowed for TMDB pagination. Limits deep crawling and abuse.",examples:[{scenario:"Set to 10",effect:"Restricts deep paging; faster typical usage."},{scenario:"Set to 100",effect:"Allows deep paging; can increase TMDB usage."}],recommended:50,recommended_why:"Supports real browsing while preventing deep crawling.",recommended_safe:25,recommended_safe_why:"More conservative usage if you want to minimize external traffic.",recommended_aggressive:80,recommended_aggressive_why:"More browsing depth if admins rely on deep pagination.",impacts:{cost:"external API usage",ops:"abuse prevention"},related:["integrations.tmdb_proxy.max_per_minute"]},"integrations.tmdb_proxy.timeout_ms":{title:"TMDB timeout (ms)",details:"Timeout for TMDB proxy requests. Protects your Edge Function budget and keeps UI responsive.",examples:[{scenario:"Set to 4s",effect:"Fast failure; fewer hung requests; may fail on slow TMDB responses."},{scenario:"Set to 12s",effect:"Higher success rate; slower UX on long tail."}],recommended:8e3,recommended_why:"Good balance: allows normal TMDB latency while avoiding long hangs.",recommended_safe:12e3,recommended_safe_why:"More tolerant of slow responses.",recommended_aggressive:5e3,recommended_aggressive_why:"Snappier UX and stricter budgets.",impacts:{ux:"search responsiveness",ops:"budget control",cost:"timeout waste"},related:["ops.frontend.function_timeout_ms"]},"integrations.tmdb_proxy.max_per_minute":{title:"TMDB max per minute",details:"Rate limit for TMDB proxy calls per minute. Prevents hitting TMDB limits and controls cost.",examples:[{scenario:"Set to 60",effect:"More conservative; less likely to hit external limits."},{scenario:"Set to 300",effect:"More throughput; higher risk of 429s if TMDB is strict."}],recommended:120,recommended_why:"Reasonable throughput for normal usage and background tasks.",recommended_safe:60,recommended_safe_why:"Safer if you’re frequently seeing 429s or have many clients.",recommended_aggressive:240,recommended_aggressive_why:"Higher throughput if your workload requires it and TMDB limits allow.",impacts:{ops:"rate-limit stability",cost:"external usage",safety:"abuse prevention"},related:["ops.rate_limits","integrations.tmdb_proxy.max_query_len"]}};function _n(r){const i=r.split(".");return(i[i.length-1]??r).replace(/_/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^\w/,u=>u.toUpperCase())}function ge(r,i,d){return typeof i=="number"&&(r=Math.max(i,r)),typeof d=="number"&&(r=Math.min(d,r)),r}function Nn(r){return r.endsWith("_ms")||r.includes(".ttl_ms")||r.includes(".timeout_ms")||r.includes(".interval_ms")||r.includes(".heartbeat_ms")||r.includes(".debounce_ms")||r.includes(".recompute_ms")||r.includes("_minutes")||r.includes("_seconds")||r.includes("_ttl")||r.includes("_timeout")}function Re(r,i){return Number.isFinite(i)?r.endsWith("_ms")||r.includes("_ms")?i>=6e4?`${Math.round(i/1e3/60)}m`:i>=1e3?`${Math.round(i/100)/10}s`:`${Math.round(i)}ms`:r.endsWith("_seconds")||r.includes("_seconds")?`${Math.round(i)}s`:r.endsWith("_minutes")||r.includes("_minutes")?`${Math.round(i)}m`:String(i):String(i)}function zn(r){const i={},d=r.toLowerCase();return d.startsWith("ux.")&&(i.ux="user experience"),d.startsWith("assistant.")&&(i.ux=i.ux??"assistant behavior",i.cost=i.cost??"model usage"),d.startsWith("ops.")&&(i.ops="operations"),d.startsWith("integrations.")&&(i.ops=i.ops??"integrations"),d.startsWith("admin.")&&(i.ops=i.ops??"admin UX/ops"),d.startsWith("ml.")&&(i.performance="model selection"),(d.includes("timeout")||d.includes("ttl")||d.includes("debounce")||d.includes("interval"))&&(i.performance=i.performance??"latency/load",i.cost=i.cost??"network/model usage"),(d.includes("max_")||d.includes("limit")||d.includes("topk"))&&(i.performance=i.performance??"compute cost",i.cost=i.cost??"usage"),(d.includes("rate")||d.includes("per_minute")||d.includes("cooldown")||d.includes("429"))&&(i.ops=i.ops??"rate limiting",i.safety=i.safety??"stability"),i}function Sn(r,i){const d=i==null?void 0:i.meta,u=zn(r),I=((i==null?void 0:i.description)??"").trim(),j=i==null?void 0:i.default;let c=I||"Matches the app's current default behavior (safe starting point).";const h=[];(d==null?void 0:d.kind)==="number"&&(typeof d.min=="number"||typeof d.max=="number")&&h.push("Stay within the validated range to avoid rejected updates."),(d==null?void 0:d.kind)==="json"&&h.push("Invalid JSON will be rejected by server validation.");const w=r.toLowerCase();if(!d)return{examples:[{scenario:"Leave default",effect:"Keeps the app behavior unchanged."}],recommended:j,recommended_why:c||"Use the default unless you have a clear reason to change it.",caution:h.length?h.join(" "):void 0,impacts:u};if(d.kind==="boolean")return{examples:[{scenario:"Set to true",effect:"Enables the behavior controlled by this setting."},{scenario:"Set to false",effect:"Disables the behavior controlled by this setting."}],recommended:j,recommended_why:c||"Default is usually the safest option.",recommended_safe:!1,recommended_safe_why:"Safer operationally if you’re unsure; may reduce features/UX.",recommended_aggressive:!0,recommended_aggressive_why:"Enables the feature; ensure it doesn’t increase cost/ops load unexpectedly.",caution:h.length?h.join(" "):void 0,impacts:u};if(d.kind==="enum"){const g=d.values.slice(0,3).map(N=>({scenario:`Set to '${N}'`,effect:"Switches behavior to this mode."}));return{examples:g.length?g:[{scenario:"Pick a mode",effect:"Changes behavior according to the selected mode."}],recommended:j,recommended_why:c||"Use the default mode unless you’re deliberately changing behavior.",caution:h.length?h.join(" "):void 0,impacts:u}}if(d.kind==="string")return w.includes("provider")||w.includes("model")?{examples:[{scenario:"Cheaper/faster model",effect:"Lower latency/cost; may reduce answer quality."},{scenario:"Higher-quality model",effect:"Better answers; higher latency/cost."}],recommended:j,recommended_why:c||"Default is tuned for typical quality/cost tradeoffs.",caution:h.length?h.join(" "):void 0,impacts:u}:{examples:[{scenario:"Short / simple value",effect:"Works best for labels and quick UX copy."},{scenario:"Long / detailed value",effect:"Can improve clarity but may clutter the UI."}],recommended:j,recommended_why:c||"Default is usually a sensible copy/label.",caution:h.length?h.join(" "):void 0,impacts:u};if(d.kind==="number"){const g=typeof(i==null?void 0:i.default)=="number"?i.default:typeof d.min=="number"?d.min:0,N=d.min,O=d.max;if(Nn(w)){const M=ge(g*1.5,N,O),k=ge(g*.6,N,O),L=Re(r,M),T=Re(r,k),ae=Re(r,g);return{examples:[{scenario:`Lower (${T})`,effect:"More responsive/fresher behavior, but can increase load/cost."},{scenario:`Default (${ae})`,effect:"Balanced behavior for most users."},{scenario:`Higher (${L})`,effect:"Less load/cost, but can feel slower or show stale data."}],recommended:g,recommended_why:c||"Default is tuned to balance responsiveness and load.",recommended_safe:M,recommended_safe_why:"Safer for stability/cost if you see load spikes; may reduce responsiveness.",recommended_aggressive:k,recommended_aggressive_why:"Feels faster, but may increase load/cost (watch logs and rate limits).",caution:h.length?h.join(" "):void 0,impacts:u}}if(w.includes("max_")||w.includes("limit")||w.includes("topk")||w.includes("rows")||w.includes("page")){const M=ge(Math.max(1,Math.round(g*.7)),N,O),k=ge(Math.max(1,Math.round(g*1.4)),N,O);return{examples:[{scenario:`Lower (${M})`,effect:"Faster/cheaper, but may reduce coverage/results."},{scenario:`Higher (${k})`,effect:"More coverage, but can increase latency/cost."}],recommended:g,recommended_why:c||"Default balances speed/cost with usefulness.",recommended_safe:M,recommended_safe_why:"Safer for performance/cost if you’re tuning for scale.",recommended_aggressive:k,recommended_aggressive_why:"More results/coverage; watch latency/cost.",caution:h.length?h.join(" "):void 0,impacts:u}}if(w.includes("cooldown")||w.includes("backoff")||w.includes("stuck")||w.includes("retry")||w.includes("attempt")){const M=ge(g*1.3,N,O),k=ge(g*.8,N,O);return{examples:[{scenario:`Lower (${Re(r,k)})`,effect:"Retries sooner; can increase pressure on providers."},{scenario:`Higher (${Re(r,M)})`,effect:"Backs off more; slower recovery but more stable under rate limits."}],recommended:g,recommended_why:c||"Default is a good balance between recovery speed and stability.",recommended_safe:M,recommended_safe_why:"Prefer this if you hit rate limits or see repeated retries.",recommended_aggressive:k,recommended_aggressive_why:"Faster recovery, but monitor error rates and provider limits.",caution:h.length?h.join(" "):void 0,impacts:u}}const _=typeof N=="number"?N:"(low)",S=typeof O=="number"?O:"(high)";return{examples:[{scenario:`Lower (${_})`,effect:"Usually reduces cost/load but may reduce quality/responsiveness."},{scenario:`Higher (${S})`,effect:"Usually improves quality/responsiveness but may increase cost/load."}],recommended:g,recommended_why:c||"Default is typically safest unless you’re tuning a specific issue.",caution:h.length?h.join(" "):void 0,impacts:u}}return{examples:[{scenario:"Smaller JSON payload",effect:"Reduces response size and risk of token/payload blowups."},{scenario:"Larger JSON payload",effect:"More flexibility, but can increase latency/cost."}],recommended:j,recommended_why:c||"Default is the safest starting point.",caution:h.length?h.join(" "):void 0,impacts:u}}function De(r,i){const d=wn[r];if(d)return d;const u=_n(r),I=((i==null?void 0:i.description)??"").trim()||"Controls this setting's behavior.",j=Sn(r,i);return{title:u,details:I,examples:j.examples,recommended:j.recommended,recommended_why:j.recommended_why,recommended_safe:j.recommended_safe,recommended_safe_why:j.recommended_safe_why,recommended_aggressive:j.recommended_aggressive,recommended_aggressive_why:j.recommended_aggressive_why,caution:j.caution,impacts:j.impacts}}function kn(r,i,d){const u=d==null?void 0:d.maxLines,I=r.split(`
`),j=i.split(`
`),c=I.length>u?[...I.slice(0,u),`… (truncated ${I.length-u} lines)`]:I,h=j.length>u?[...j.slice(0,u),`… (truncated ${j.length-u} lines)`]:j,w=c.length,g=h.length,N=Array.from({length:w+1},()=>new Array(g+1).fill(0));for(let M=w-1;M>=0;M--)for(let k=g-1;k>=0;k--)N[M][k]=c[M]===h[k]?N[M+1][k+1]+1:Math.max(N[M+1][k],N[M][k+1]);const O=[];let _=0,S=0;for(;_<w&&S<g;){if(c[_]===h[S]){O.push({type:"equal",line:c[_]}),_++,S++;continue}N[_+1][S]>=N[_][S+1]?(O.push({type:"del",line:c[_]}),_++):(O.push({type:"add",line:h[S]}),S++)}for(;_<w;)O.push({type:"del",line:c[_]}),_++;for(;S<g;)O.push({type:"add",line:h[S]}),S++;return O}function qs(r){try{return r===void 0?"undefined":JSON.stringify(r,null,2)}catch{try{return String(r)}catch{return"[unprintable]"}}}function Cn(r){const{before:i,after:d,className:u}=r,[I,j]=m.useState(!1),c=m.useMemo(()=>qs(i),[i]),h=m.useMemo(()=>qs(d),[d]),w=m.useMemo(()=>kn(c,h,{maxLines:350}),[c,h]);return e.jsxs("div",{className:A("rounded-xl border border-zinc-200 bg-white",u),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 border-b border-zinc-200 px-3 py-2",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Diff"}),e.jsxs("label",{className:"flex items-center gap-2 text-[11px] text-zinc-600",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:g=>j(g.target.checked)}),"Show unchanged"]})]}),e.jsx("pre",{className:"max-h-60 overflow-auto px-3 py-2 text-xs leading-5",children:w.filter(g=>I||g.type!=="equal").map((g,N)=>e.jsxs("div",{className:A("whitespace-pre",g.type==="add"&&"bg-emerald-50 text-emerald-900",g.type==="del"&&"bg-rose-50 text-rose-900",g.type==="equal"&&"text-zinc-600"),children:[e.jsx("span",{className:"select-none font-mono opacity-60",children:g.type==="add"?"+":g.type==="del"?"-":" "})," ",g.line]},N))})]})}function Mn(r){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:r.children})}function G(r){try{return JSON.stringify(r,null,2)}catch{return String(r)}}function Ye(r){if(r==null)return String(r);const i=typeof r;if(i==="string")return JSON.stringify(r);if(i==="number"||i==="boolean")return String(r);if(Array.isArray(r))return`[${r.map(d=>Ye(d)).join(",")}]`;if(i==="object")return`{${Object.keys(r).sort().map(I=>`${JSON.stringify(I)}:${Ye(r[I])}`).join(",")}}`;try{return JSON.stringify(r)}catch{return String(r)}}function ve(r,i){return Ye(r)===Ye(i)}function de(r){return typeof r=="string"?"string":typeof r=="number"?"number":typeof r=="boolean"?"boolean":"json"}function Os(r,i,d){if(r==="boolean")return!!d;if(r==="number"){const u=Number(i);if(!Number.isFinite(u))throw new Error("Invalid number");return Number.isInteger(u),u}if(r==="json"){const u=i.trim();if(!u)throw new Error("Empty JSON");return JSON.parse(u)}return i}function be(r){return r.split(".")[0]??"other"}function En(r){const i=r.split(".");return i.length>=2?`${i[0]}.${i[1]}`:i[0]??"other"}function Fe(r){return m.useEffect(()=>{if(!r.open)return;const i=d=>{d.key==="Escape"&&r.onClose()};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[r.open,r.onClose]),r.open?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:r.onClose}),e.jsxs("div",{className:"relative w-full max-w-3xl rounded-2xl border border-zinc-200 bg-white p-5 shadow-xl",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight text-zinc-900",children:r.title}),e.jsx(x,{variant:"ghost",className:"rounded-lg px-2 py-1 text-xs text-zinc-500 hover:bg-zinc-100",onClick:r.onClose,children:"✕"})]}),e.jsx("div",{className:"mt-4",children:r.children})]})]}):null}function On(){var bs,ys,js,ws,_s,Ns,zs,Ss,ks,Cs,Ms,Es,As;const r=ln(),i=cn(),d=dn(),u=mn(),I=u==null?void 0:u.category,j=!I,c=We({queryKey:["app-settings"],queryFn:gn}),h=We({queryKey:["app-settings-history","recent"],queryFn:()=>At({limit:20}),staleTime:1e4}),w=We({queryKey:["app-settings-presets"],queryFn:vn,staleTime:3e4}),[g,N]=m.useState(""),O=m.useRef(null),[_,S]=m.useState("all"),[M,k]=m.useState("all"),[L,T]=m.useState(!1),[ae,v]=m.useState(!1),[Q,Rt]=m.useState(()=>{const t=localStorage.getItem("mn_admin_settings_sort");return t==="key_asc"||t==="last_modified_desc"||t==="favorites_first"?t:"key_asc"});m.useEffect(()=>{try{localStorage.setItem("mn_admin_settings_sort",Q)}catch{}},[Q]);const[Dt,Is]=m.useState("side_by_side"),[Ge,Ft]=m.useState(""),[Ts,ye]=m.useState(!1),[Ls,Ze]=m.useState(null),[qt,Ot]=m.useState(null),[ne,et]=m.useState(null),[P,tt]=m.useState(null),[It,st]=m.useState(null),[Tt,nt]=m.useState(""),[Lt,qe]=m.useState(!1),[at,Pt]=m.useState(!1),[je,re]=m.useState(!1),[rt,me]=m.useState(""),Kt=m.useRef(null);m.useEffect(()=>{function t(n){const s=(n.key??"").toLowerCase();(n.ctrlKey||n.metaKey)&&s==="k"&&(n.preventDefault(),re(!0),me(""))}return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]),m.useEffect(()=>{if(!je)return;const t=setTimeout(()=>{var n;return(n=Kt.current)==null?void 0:n.focus()},0);return()=>clearTimeout(t)},[je]),m.useEffect(()=>{const t=u==null?void 0:u.category;if(typeof t=="string"&&t.trim()){if(t==="favorites"){S("all"),T(!0);return}T(!1),S(t);return}T(!1),S("all")},[u==null?void 0:u.category]);const[U,Bt]=m.useState(()=>{try{const t=localStorage.getItem("mn_admin_settings_favs_v1"),n=t?JSON.parse(t):[];return Array.isArray(n)?n.filter(s=>typeof s=="string"):[]}catch{return[]}}),[we,Ut]=m.useState(!1),[Oe,Ht]=m.useState(""),[_e,it]=m.useState("fallback"),[ot,lt]=m.useState(null);function ue(t){return t.slice().sort().join("|")}m.useEffect(()=>{try{localStorage.setItem("mn_admin_settings_favs_v1",JSON.stringify(U))}catch{}},[U]),m.useEffect(()=>{var n;if(!c.data)return;const t=(n=c.data)==null?void 0:n.favorites_storage;(t==="db"||t==="fallback")&&it(t)},[c.data]),m.useEffect(()=>{var D,F;if(!c.data)return;const t=(D=c.data)==null?void 0:D.favorites;if(!Array.isArray(t)){we||Ut(!0);return}let n=[];try{const p=localStorage.getItem("mn_admin_settings_favs_v1"),B=p?JSON.parse(p):[];n=Array.isArray(B)?B.filter(ie=>typeof ie=="string"):[]}catch{n=[]}const s=Array.from(new Set([...t,...n].filter(p=>typeof p=="string"))),a=ue(s),l=ue(n),o=ue(t);a!==l&&Bt(s);const R=((F=c.data)==null?void 0:F.favorites_storage)==="db"?"db":"fallback";R!==_e&&it(R),Ht(R==="db"?o:a),Ut(!0)},[c.data]);const xe=te({mutationFn:async t=>xn({favorites:t}),onSuccess:t=>{const n=t.favorites??[];Ht(ue(n)),(t.favorites_storage==="db"||t.favorites_storage==="fallback")&&it(t.favorites_storage),lt(null)},onError:t=>{lt((t==null?void 0:t.message)??"Failed to sync favorites")}});m.useEffect(()=>{var s,a;if(!we||!((a=(s=c.data)==null?void 0:s.actor)!=null&&a.userId)||_e!=="db"||ue(U)===Oe)return;const n=setTimeout(()=>{xe.mutate(U)},500);return()=>clearTimeout(n)},[U,we,Oe,(ys=(bs=c.data)==null?void 0:bs.actor)==null?void 0:ys.userId,_e]);const oe=m.useMemo(()=>{if(_e!=="db")return{state:"Offline",detail:"Server storage not available"};if(xe.isPending)return{state:"Saving",detail:null};const t=we&&ue(U)!==Oe;return ot?{state:"Error",detail:ot}:t?{state:"Saving",detail:null}:{state:"Saved",detail:null}},[_e,xe.isPending,we,U,Oe,ot]),ct=te({mutationFn:async t=>pn({slug:t}),onSuccess:(t,n)=>{Ze(null),Ot(n),et(t.preset??null),tt(t.preview??null),st(t.message??null),nt(""),qe(!1),Pt(!1),ye(!0)},onError:t=>{Ze(null),i.push({variant:"error",title:"Preset preview failed",message:(t==null?void 0:t.message)??"Could not load preset preview."})}}),$t=te({mutationFn:async()=>{if(!qt)throw new Error("No preset selected");const t=Tt.trim();if(!t)throw new Error("Reason is required");return hn({slug:qt,expected_version:X,reason:t})},onSuccess:t=>{i.push({variant:"success",title:"Preset applied",message:`${t.preset_slug}: updated ${t.updated_keys.length}, reset ${t.deleted_keys.length}.`}),ye(!1),Ot(null),et(null),tt(null),st(null),nt(""),qe(!1),r.invalidateQueries({queryKey:["app-settings"]}),r.invalidateQueries({queryKey:["app-settings-history"]}),r.invalidateQueries({queryKey:["app-settings-history","recent"]})},onError:t=>{i.push({variant:"error",title:"Preset apply failed",message:(t==null?void 0:t.message)??"Could not apply preset."})}});function Ps(t){Ze(t),st(null),tt(null),et(null),ct.mutate(t)}const[dt,Ks]=m.useState(["public","admin","server_only"]),[le,Jt]=m.useState(""),[Ie,Bs]=m.useState(["public","admin","server_only"]),[mt,Us]=m.useState(!1),[ut,Hs]=m.useState(""),[$s,Te]=m.useState(!1),[K,Vt]=m.useState(null),[Qt,xt]=m.useState(""),[Xt,Le]=m.useState(!1),[E,V]=m.useState({}),[Ne,Pe]=m.useState({}),[ze,Wt]=m.useState({}),f=((js=c.data)==null?void 0:js.registry)??{},Yt=((ws=c.data)==null?void 0:ws.rows)??[],X=((_s=c.data)==null?void 0:_s.version)??0,H=m.useMemo(()=>{const t=new Map;for(const n of Yt)t.set(n.key,n);return t},[Yt]),pt=m.useMemo(()=>{var n;const t=new Map;for(const[s,a]of H.entries())if(a!=null&&a.updated_at){const l=Date.parse(a.updated_at);Number.isFinite(l)&&t.set(s,l)}for(const s of((n=h.data)==null?void 0:n.rows)??[]){const a=Date.parse(s.changed_at);if(!Number.isFinite(a))continue;const l=t.get(s.key);(l===void 0||a>l)&&t.set(s.key,a)}return t},[H,h.data]);m.useEffect(()=>{if(!c.data)return;const t={},n={};for(const[s,a]of Object.entries(f)){const l=H.get(s),o=l?l.value:a.default,C=de(a.default);C==="boolean"?n[s]=!!o:C==="json"?t[s]=G(o):t[s]=o==null?"":String(o)}V(t),Pe(n),Wt({})},[c.data]);const Gt=m.useMemo(()=>{const t=new Set;for(const n of Object.keys(f))t.add(be(n));return["all",...Array.from(t).sort()]},[f]),Zt=m.useMemo(()=>{const t=new Map;for(const n of Object.keys(f)){const s=be(n);t.set(s,(t.get(s)??0)+1)}return t},[f]),ht=m.useMemo(()=>{if(!je)return[];const t=rt.trim().toLowerCase(),n=Object.keys(f),s=[];for(const a of n){const l=f[a],o=De(a,l?{default:l.default,description:l.description,meta:l.meta}:void 0),C=(o==null?void 0:o.title)??a,R=(l==null?void 0:l.description)??"",D=(o==null?void 0:o.details)??"",F=((o==null?void 0:o.examples)??[]).map(q=>`${q.scenario} ${q.effect}`).join(" "),p=((o==null?void 0:o.related)??[]).join(" "),B=String((o==null?void 0:o.recommended_why)??""),ie=`${a} ${C} ${R} ${D} ${F} ${p} ${B}`.toLowerCase();let b=0;t?a.toLowerCase()===t?b=2e3:a.toLowerCase().startsWith(t)?b=1500:a.toLowerCase().includes(t)?b=900:C.toLowerCase().includes(t)?b=600:R.toLowerCase().includes(t)?b=450:D.toLowerCase().includes(t)?b=350:ie.includes(t)&&(b=200):b=1,b>0&&s.push({key:a,title:C,description:R,score:b})}return s.sort((a,l)=>l.score-a.score||a.key.localeCompare(l.key)),s.slice(0,30)},[je,rt,f]),Ke=m.useMemo(()=>{const t=new Map;for(const n of Object.keys(f)){const s=f[n],a=H.get(n);if(!a||ve(a.value,s==null?void 0:s.default))continue;const l=be(n);t.set(l,(t.get(l)??0)+1)}return t},[f,H]),Be=m.useMemo(()=>{const t=[];for(const n of Object.keys(f)){const s=f[n],a=H.get(n);a&&ve(a.value,s==null?void 0:s.default)&&t.push(n)}return t.sort(),t},[f,H]),ft=m.useMemo(()=>{const t=g.trim().toLowerCase(),n=Object.keys(f).filter(s=>{var R;if(_!=="all"&&be(s)!==_||M!=="all"&&((R=f[s])==null?void 0:R.scope)!==M||L&&!U.includes(s))return!1;if(ae){const D=f[s],F=H.get(s);if(!F||ve(F.value,D==null?void 0:D.default))return!1}if(!t)return!0;const a=f[s],l=(a==null?void 0:a.description)??"",o=De(s,{default:a==null?void 0:a.default,description:a==null?void 0:a.description,meta:a==null?void 0:a.meta});return[s,l,(o==null?void 0:o.title)??"",(o==null?void 0:o.details)??"",(o==null?void 0:o.recommended_why)??"",(o==null?void 0:o.caution)??"",...(o==null?void 0:o.related)??[],...((o==null?void 0:o.examples)??[]).flatMap(D=>[D.scenario,D.effect])].join(`
`).toLowerCase().includes(t)});return Q==="key_asc"?n.sort():Q==="favorites_first"?n.sort((s,a)=>{const l=U.includes(s)?1:0,o=U.includes(a)?1:0;return o!==l?o-l:s.localeCompare(a)}):Q==="last_modified_desc"&&n.sort((s,a)=>{const l=pt.get(s)??0,o=pt.get(a)??0;return o!==l?o-l:s.localeCompare(a)}),n},[f,g,_,M,L,U,ae,H,Q,pt]),Js=m.useMemo(()=>{const t=new Map;for(const n of ft){const s=En(n),a=t.get(s);a?a.push(n):t.set(s,[n])}return Array.from(t.entries()).sort((n,s)=>n[0].localeCompare(s[0]))},[ft]),Ue=m.useMemo(()=>Object.keys(ze).filter(t=>ze[t]),[ze]);function Vs(t,n){try{const s=new Blob([n],{type:"application/json"}),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.download=t,l.click(),URL.revokeObjectURL(a)}catch{}}function es(t,n){return t.includes(n)?t.filter(s=>s!==n):[...t,n]}function ts(t){const n=t.trim();if(!n)throw new Error("Import JSON is empty");return JSON.parse(n)}const ss=te({mutationFn:async()=>{if(!dt.length)throw new Error("Select at least one scope to export");return fn({scopes:dt})},onSuccess:t=>{const n=G(t.bundle);Jt(n),i.push({variant:"success",title:"Export ready",message:"Settings bundle generated."})},onError:t=>{i.push({variant:"error",title:"Export failed",message:ee(t)})}}),ns=te({mutationFn:async()=>{if(!Ie.length)throw new Error("Select at least one scope to import");const t=ts(ut);return Ds({mode:"dry_run",bundle:t,scopes:Ie,delete_missing:mt})},onSuccess:t=>{Vt(t.preview??null),xt(""),Le(!1),Te(!0)},onError:t=>{i.push({variant:"error",title:"Preview failed",message:ee(t),durationMs:6e3})}}),as=te({mutationFn:async()=>{if(!K)throw new Error("Run a preview first");if(!Xt)throw new Error("Confirm before applying");const t=Qt.trim();if(!t)throw new Error("Reason is required");const n=ts(ut);return Ds({mode:"apply",bundle:n,scopes:Ie,delete_missing:mt,expected_version:X>0?X:void 0,reason:t})},onSuccess:async()=>{i.push({variant:"success",title:"Import applied",message:"Settings updated."}),Te(!1),Vt(null),xt(""),Le(!1),await r.invalidateQueries({queryKey:["app-settings"]})},onError:t=>{i.push({variant:"error",title:"Import failed",message:ee(t),durationMs:6e3})}}),gt=te({mutationFn:async()=>{const t={};for(const n of Ue){const s=f[n];if(!s)continue;const a=de(s.default),l=E[n]??"",o=Ne[n];t[n]=Os(a,l,o)}return Et({expected_version:X>0?X:void 0,updates:t,reason:Ge.trim()||void 0})},onSuccess:async t=>{var C,R,D,F;const n=((C=t==null?void 0:t.updated_keys)==null?void 0:C.length)??0,s=((R=t==null?void 0:t.deleted_keys)==null?void 0:R.length)??0,a=((D=t==null?void 0:t.same_keys)==null?void 0:D.length)??0,l=((F=t==null?void 0:t.ignored_default_keys)==null?void 0:F.length)??0,o=[];n&&o.push(`updated ${n}`),s&&o.push(`reset ${s}`),a&&o.push(`no-op ${a}`),l&&o.push(`already default ${l}`),i.push({variant:"success",title:"Settings saved",message:o.length?o.join(", ")+".":"No changes."}),Ft(""),await r.invalidateQueries({queryKey:["app-settings"]})},onError:t=>{i.push({variant:"error",title:"Save failed",message:ee(t),durationMs:6e3})}}),vt=te({mutationFn:async()=>{if(!Be.length)throw new Error("No redundant overrides to clean");const t={};for(const a of Be){const l=f[a];l&&(t[a]=l.default)}const n=Ge.trim(),s=n?`Cleanup redundant overrides: ${n}`:"Cleanup redundant overrides";return Et({expected_version:X>0?X:void 0,updates:t,reason:s})},onSuccess:async t=>{var s;const n=((s=t==null?void 0:t.deleted_keys)==null?void 0:s.length)??0;i.push({variant:"success",title:"Cleaned up",message:n?`Removed ${n} redundant override(s).`:"Nothing to remove."}),await r.invalidateQueries({queryKey:["app-settings"]})},onError:t=>{i.push({variant:"error",title:"Cleanup failed",message:ee(t)})}}),[Qs,rs]=m.useState(!1),[$,is]=m.useState(null),[os,ls]=m.useState([]),[He,Xs]=m.useState(30),[$e,Ws]=m.useState(50),[Ys,Je]=m.useState(!1),[Z,Ve]=m.useState(null),[bt,Se]=m.useState("");function ke(t){if(!t||t<=0)return;const n=t*24*60*60*1e3;return new Date(Date.now()-n).toISOString()}const Ce=te({mutationFn:async t=>At(t),onSuccess:t=>ls(t.rows??[]),onError:t=>{i.push({variant:"error",title:"History failed",message:ee(t)})}}),Me=te({mutationFn:async()=>{if(!$||!Z)throw new Error("No rollback target selected");const t=bt.trim();if(!t)throw new Error("Rollback reason is required");const n=f[$];if(!n)throw new Error("Unknown setting key");const s=Z.old_value===null||Z.old_value===void 0?n.default:Z.old_value;return Et({expected_version:X>0?X:void 0,updates:{[$]:s},reason:`Rollback: ${t}`})},onSuccess:async()=>{i.push({variant:"success",title:"Rolled back",message:"Setting restored to the previous value."}),Je(!1),Ve(null),Se(""),await r.invalidateQueries({queryKey:["app-settings"]}),ds()},onError:t=>{i.push({variant:"error",title:"Rollback failed",message:ee(t)})}});function W(t){Wt(n=>({...n,[t]:!0}))}function yt(t){return U.includes(t)}function Gs(t){Bt(n=>n.includes(t)?n.filter(s=>s!==t):[...n,t])}async function Zs(t){var n;try{if((n=navigator==null?void 0:navigator.clipboard)!=null&&n.writeText)return await navigator.clipboard.writeText(t),!0}catch{}try{const s=document.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-9999px",document.body.appendChild(s),s.focus(),s.select();const a=document.execCommand("copy");return document.body.removeChild(s),a}catch{return!1}}async function cs(t){const n=await Zs(t);i.push({variant:n?"success":"error",title:n?"Copied":"Copy failed",message:n?t:"Could not copy to clipboard."})}function en(t){const n=f[t];if(!n)return;const s=de(n.default);s==="boolean"?Pe(a=>({...a,[t]:!!n.default})):V(s==="json"?a=>({...a,[t]:G(n.default)}):a=>({...a,[t]:String(n.default)})),W(t)}function jt(t){is(t),rs(!0),ls([]),Ce.mutate({key:t,limit:$e,since:ke(He)})}function ds(){$&&Ce.mutate({key:$,limit:$e,since:ke(He)})}function tn(t){$&&(Ve(t),Se(""),Je(!0))}const[ms,us]=m.useState(!1),[z,xs]=m.useState(null);function Y(t){xs(t),us(!0)}function Qe(t,n){const s=be(t);N(""),k("all"),T(!1),v(!1),re(!1),me(""),S(s),I!==s&&d(`/settings/${s}`),n!=null&&n.openDetails&&Y(t);let a=0;const l=()=>{const o=document.getElementById(`setting-${t}`);if(o){o.scrollIntoView({behavior:"smooth",block:"start"});return}a++<10&&requestAnimationFrame(l)};setTimeout(()=>requestAnimationFrame(l),0)}function sn(t){N(""),k("all"),T(!1),v(!1),Rt("key_asc"),re(!1),me(""),S("all"),d("/settings")}function nn(){us(!1),xs(null)}function ps(t,n){const s=f[t];if(!s)return;const a=de(s.default);a==="boolean"?Pe(l=>({...l,[t]:!!n})):V(a==="json"?l=>({...l,[t]:G(n)}):l=>({...l,[t]:String(n)})),W(t)}function an(t){const n=f[t],s=De(t,n?{default:n.default,description:n.description,meta:n.meta}:void 0);s.recommended!==void 0&&ps(t,s.recommended)}const wt="ops.rate_limits",pe="assistant.tool_result_truncation",_t="assistant.reply_runner.backoff",Nt="admin.users.page_limit",hs="admin.users.ban_duration_days",zt="admin.overview.recent_errors_limit",fs="admin.overview.last_job_runs_limit",St="admin.audit.default_limit",kt="ux.assistant.username",Ct="ux.presence.label_online",gs="ux.presence.label_active_recently",vs="ux.presence.label_active_prefix",Mt="ux.messages.search.min_query_chars";function Ee(t,n,s,a){const l=Number(t);if(!Number.isFinite(l))return a;const o=Math.trunc(l);return Math.max(n,Math.min(s,o))}function Ae(t){const n=f[t];if(!n)return;const s=H.get(t);return s?s.value:n.default}function ce(t){const n=E[t];if(typeof n=="string"&&n.trim())try{return JSON.parse(n)}catch{}return Ae(t)}function Xe(t,n){V(s=>({...s,[t]:G(n)})),W(t)}function J(t,n){V(s=>({...s,[t]:n})),W(t)}function rn(t){const n=f[t];if(!n)return;if(!ze[t])return Ae(t);const s=de(n.default);if(s==="boolean")return!!Ne[t];if(s==="json")return ce(t);const a=(E[t]??"").trim();if(s==="number"){const l=Number(a);return Number.isFinite(l)?(Number.isInteger(l),l):a}return a}const on=We({queryKey:["app-settings-history","drawer",z??"none"],enabled:ms&&!!z,queryFn:async()=>z?At({key:z,limit:5,since:ke(90)}):{ok:!0,rows:[]}});return c.isLoading?e.jsx(un,{}):c.error?e.jsx(bn,{error:c.error}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Mn,{children:"Settings"}),e.jsx(he,{title:"Export / Import settings",right:e.jsxs("div",{className:"text-xs text-zinc-500",children:["Current version: ",e.jsx("span",{className:"font-mono",children:X})]}),children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Export bundle"}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:"Export non-secret settings as JSON for backup or promotion between environments."}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-3 text-xs",children:[["public","admin","server_only"].map(t=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:dt.includes(t),onChange:()=>Ks(n=>es(n,t))}),e.jsx("span",{className:"font-mono",children:t})]},t)),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx(x,{onClick:()=>ss.mutate(),disabled:ss.isPending,children:"Export"}),e.jsx(x,{variant:"secondary",onClick:()=>{var t;le.trim()&&((t=navigator.clipboard)==null||t.writeText(le).then(()=>{i.push({variant:"success",title:"Copied",message:"Export JSON copied to clipboard."})}).catch(()=>{i.push({variant:"error",title:"Copy failed",message:"Could not copy to clipboard."})}))},disabled:!le.trim(),children:"Copy"}),e.jsx(x,{variant:"secondary",onClick:()=>{if(!le.trim())return;const t=new Date().toISOString().replace(/[:.]/g,"-");Vs(`movinesta-app-settings-${t}.json`,le)},disabled:!le.trim(),children:"Download"})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("textarea",{className:"h-40 w-full rounded-xl border border-zinc-200 bg-white p-3 font-mono text-xs text-zinc-900",placeholder:"Click Export to generate a bundle JSON here…",value:le,onChange:t=>Jt(t.target.value)})})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Import bundle"}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-600",children:["Paste a bundle JSON and run a ",e.jsx("span",{className:"font-medium",children:"dry-run preview"})," before applying. This never moves secrets."]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-3 text-xs",children:[["public","admin","server_only"].map(t=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Ie.includes(t),onChange:()=>Bs(n=>es(n,t))}),e.jsx("span",{className:"font-mono",children:t})]},t)),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:mt,onChange:t=>Us(t.target.checked)}),e.jsx("span",{children:"Delete missing keys"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(x,{onClick:()=>ns.mutate(),disabled:ns.isPending,children:"Preview"})})]}),e.jsx("div",{className:"mt-3",children:e.jsx("textarea",{className:"h-40 w-full rounded-xl border border-zinc-200 bg-white p-3 font-mono text-xs text-zinc-900",placeholder:"Paste export JSON here…",value:ut,onChange:t=>Hs(t.target.value)})})]})]})}),e.jsxs(he,{title:"Recommended presets",right:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-500",children:[e.jsxs("div",{children:["Presets storage: ",e.jsx("span",{className:"font-mono",children:((Ns=w.data)==null?void 0:Ns.presets_storage)??"…"})]}),e.jsx(x,{variant:"ghost",onClick:()=>r.invalidateQueries({queryKey:["app-settings-presets"]}),disabled:w.isFetching,children:w.isFetching?"…":"Refresh"})]}),children:[e.jsx("div",{className:"text-xs text-zinc-600",children:"Presets apply multiple settings in one safe action. You can preview the exact diff before applying."}),w.isLoading?e.jsx("div",{className:"mt-3 text-sm text-zinc-500",children:"Loading presets…"}):(((zs=w.data)==null?void 0:zs.presets_storage)??"fallback")!=="db"?e.jsxs("div",{className:"mt-3 rounded-2xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-900",children:["Presets are not available until you run the migration:",e.jsx("div",{className:"mt-2 font-mono text-[11px]",children:"supabase/migrations/20260108_000200_app_settings_presets.sql"})]}):(((Ss=w.data)==null?void 0:Ss.presets)??[]).length?e.jsx("div",{className:"mt-4 space-y-4",children:Object.entries((((ks=w.data)==null?void 0:ks.presets)??[]).reduce((t,n)=>{const s=(n.group_key??"general").toString();return(t[s]??(t[s]=[])).push(n),t},{})).map(([t,n])=>e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:t}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-600",children:[n.length," preset",n.length===1?"":"s"]})]})}),e.jsx("div",{className:"mt-3 space-y-2",children:n.map(s=>{const a=Object.keys(s.preset??{}).length;return e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3 rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:s.title}),s.is_builtin?e.jsx("span",{className:"rounded-lg bg-zinc-200 px-2 py-1 text-[11px] font-semibold text-zinc-700",children:"Built-in"}):null,e.jsxs("span",{className:"rounded-lg bg-zinc-100 px-2 py-1 text-[11px] font-semibold text-zinc-700",children:[a," keys"]})]}),s.description?e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:s.description}):null,e.jsx("div",{className:"mt-2 font-mono text-[11px] text-zinc-500",children:s.slug})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(x,{variant:"secondary",onClick:()=>Ps(s.slug),disabled:ct.isPending,children:ct.isPending&&Ls===s.slug?"Loading…":"Preview"})})]},s.slug)})})]},t))}):e.jsx("div",{className:"mt-3 text-sm text-zinc-500",children:"No presets found."})]}),e.jsx(Fe,{open:Ts,title:(ne==null?void 0:ne.title)??"Preset preview",onClose:()=>{ye(!1),qe(!1)},children:!ne||!P?e.jsxs("div",{className:"space-y-3",children:[It?e.jsx("div",{className:"rounded-xl border border-amber-200 bg-amber-50 p-3 text-sm text-amber-900",children:It}):null,e.jsx("div",{className:"text-sm text-zinc-600",children:"No preview loaded."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-zinc-900",children:[e.jsx("div",{className:"font-semibold",children:ne.title}),ne.description?e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:ne.description}):null,e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{className:"rounded-lg bg-zinc-100 px-2 py-1 font-mono",children:ne.slug}),e.jsxs("span",{className:"rounded-lg bg-zinc-100 px-2 py-1",children:[Object.keys(ne.preset??{}).length," keys"]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Update"}),e.jsx("div",{className:"font-mono",children:P.counts.update})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Reset"}),e.jsx("div",{className:"font-mono",children:P.counts.reset})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Same"}),e.jsx("div",{className:"font-mono",children:P.counts.same})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Already default"}),e.jsx("div",{className:"font-mono",children:P.counts.already_default})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Unknown"}),e.jsx("div",{className:"font-mono",children:P.counts.unknown})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Invalid"}),e.jsx("div",{className:"font-mono",children:P.counts.invalid})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-600",children:[e.jsx("input",{type:"checkbox",checked:at,onChange:t=>Pt(t.target.checked)}),e.jsx("span",{children:"Show non-changing rows"})]}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Click a row to jump to the setting."})]})]}),P.unknown_keys.length?e.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-amber-900",children:"Unknown keys (ignored)"}),e.jsx("div",{className:"mt-2 max-h-24 overflow-auto rounded-xl border border-amber-200 bg-white p-2 font-mono text-[11px] text-amber-900",children:P.unknown_keys.map(t=>e.jsx("div",{children:t},t))})]}):null,P.invalid_values.length?e.jsxs("div",{className:"rounded-2xl border border-red-200 bg-red-50 p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-red-900",children:"Invalid values (ignored)"}),e.jsx("div",{className:"mt-2 max-h-28 overflow-auto rounded-xl border border-red-200 bg-white p-2 text-[11px] text-red-900",children:P.invalid_values.map(t=>e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"font-mono",children:t.key}),e.jsx("div",{className:"text-right",children:t.message})]},t.key))})]}):null,e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:"Changes"}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["Showing ",at?P.changes.length:P.changes.filter(t=>t.change_type==="update"||t.change_type==="reset").length," rows"]})]}),e.jsx("div",{className:"max-h-[320px] overflow-auto rounded-xl border border-zinc-200",children:(at?P.changes:P.changes.filter(t=>t.change_type==="update"||t.change_type==="reset")).slice(0,120).map(t=>{const n=t.change_type==="update"?"bg-emerald-100 text-emerald-800":t.change_type==="reset"?"bg-amber-100 text-amber-800":t.change_type==="already_default"?"bg-zinc-200 text-zinc-700":"bg-zinc-100 text-zinc-600",s=a=>{if(a===void 0)return"undefined";if(a===null)return"DEFAULT";if(typeof a=="string")return a.length>64?a.slice(0,64)+"…":a;try{const l=JSON.stringify(a);return l.length>90?l.slice(0,90)+"…":l}catch{return String(a)}};return e.jsx(x,{variant:"ghost",type:"button",onClick:()=>{ye(!1),Qe(t.key,{openDetails:!0})},className:"w-full border-b border-zinc-100 px-3 py-2 text-left hover:bg-zinc-50",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:A("rounded-lg px-2 py-1 text-[11px] font-semibold",n),children:t.change_type}),e.jsx("span",{className:"truncate font-mono text-[11px] text-zinc-900",children:t.key}),e.jsx("span",{className:"rounded-lg bg-zinc-100 px-2 py-1 text-[11px] font-semibold text-zinc-700",children:t.scope})]}),e.jsxs("div",{className:"mt-1 text-[11px] text-zinc-600",children:[e.jsx("span",{className:"font-semibold",children:"Current:"})," ",e.jsx("span",{className:"font-mono",children:s(t.current)}),e.jsx("span",{className:"mx-2 text-zinc-400",children:"→"}),e.jsx("span",{className:"font-semibold",children:"Target:"})," ",e.jsx("span",{className:"font-mono",children:s(t.target)})]})]}),e.jsx("div",{className:"shrink-0 text-[11px] text-zinc-500",children:t.had_override?"override":"default"})]})},t.key)})}),P.changes.length>120?e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"Showing first 120 rows."}):null]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:"Apply preset"}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:"Applying writes to settings history and admin audit log."}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-700",children:"Reason (required)"}),e.jsx(y,{value:Tt,onChange:t=>nt(t.target.value),placeholder:"e.g., Switch production to high-quality assistant"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:Lt,onChange:t=>qe(t.target.checked)}),e.jsx("span",{children:"I understand this changes live settings"})]})})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[e.jsx(x,{variant:"secondary",onClick:()=>ye(!1),children:"Close"}),e.jsx(x,{onClick:()=>$t.mutate(),disabled:!Lt||$t.isPending,children:"Apply"})]})]})]})}),e.jsx(Fe,{open:$s,title:"Import preview",onClose:()=>{Te(!1),Le(!1)},children:K?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Adds"}),e.jsx("div",{className:"font-mono",children:K.counts.add})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Updates"}),e.jsx("div",{className:"font-mono",children:K.counts.update})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Deletes"}),e.jsx("div",{className:"font-mono",children:K.counts.delete})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Same"}),e.jsx("div",{className:"font-mono",children:K.counts.same})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Skipped (scope)"}),e.jsx("div",{className:"font-mono",children:K.counts.skipped_scope})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500",children:"Skipped (unknown)"}),e.jsx("div",{className:"font-mono",children:K.counts.skipped_unknown})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Target scopes: ",e.jsx("span",{className:"font-mono",children:K.requestedScopes.join(", ")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 lg:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-700",children:"Adds"}),e.jsx("div",{className:"max-h-40 overflow-auto rounded-xl border border-zinc-200 bg-white p-2 font-mono text-[11px]",children:K.adds.length?K.adds.map(t=>e.jsx("div",{children:t},t)):e.jsx("div",{className:"text-zinc-400",children:"None"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-700",children:"Updates"}),e.jsx("div",{className:"max-h-40 overflow-auto rounded-xl border border-zinc-200 bg-white p-2 font-mono text-[11px]",children:K.updates.length?K.updates.map(t=>e.jsx("div",{children:t},t)):e.jsx("div",{className:"text-zinc-400",children:"None"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-700",children:"Deletes"}),e.jsx("div",{className:"max-h-40 overflow-auto rounded-xl border border-zinc-200 bg-white p-2 font-mono text-[11px]",children:K.deletes.length?K.deletes.map(t=>e.jsx("div",{children:t},t)):e.jsx("div",{className:"text-zinc-400",children:"None"})})]})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Apply changes"}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:"Applying writes history + admin audit log and bumps the settings version."}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-700",children:"Reason (required)"}),e.jsx(y,{value:Qt,onChange:t=>xt(t.target.value),placeholder:"e.g., Promote staging config to production"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 text-xs",children:[e.jsx("input",{type:"checkbox",checked:Xt,onChange:t=>Le(t.target.checked)}),e.jsx("span",{children:"I understand this changes live settings"})]})})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[e.jsx(x,{variant:"secondary",onClick:()=>Te(!1),children:"Close"}),e.jsx(x,{onClick:()=>as.mutate(),disabled:as.isPending,children:"Apply"})]})]})]}):e.jsx("div",{className:"text-sm text-zinc-600",children:"No preview loaded."})}),e.jsx(he,{title:"Quick editors (server-only knobs)",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Rate limits"}),e.jsx(se,{onClick:()=>Y(wt)})]}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-600",children:["Stored as ",e.jsx("span",{className:"font-mono",children:"server_only"})," settings; used by Edge Functions only."]}),(()=>{var s;const t=ce(wt)??{actions:{}},n=Number(((s=t==null?void 0:t.actions)==null?void 0:s["catalog-sync"])??60);return e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-600",children:"catalog-sync (max / minute)"}),e.jsx(y,{type:"number",min:1,max:6e3,value:Number.isFinite(n)?String(n):"60",onChange:a=>{const l=Ee(a.target.value,1,6e3,60),o={...t??{},actions:{...(t==null?void 0:t.actions)??{},"catalog-sync":l}};Xe(wt,o)}}),e.jsxs("div",{className:"text-[11px] text-zinc-500",children:["Tip: You can add more actions in the full table editor under ",e.jsx("span",{className:"font-mono",children:"ops.rate_limits"}),"."]})]})})()]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Tool result truncation"}),e.jsx(se,{onClick:()=>Y(pe)})]}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:"Controls how much tool output is returned (prevents huge payloads)."}),(()=>{const t=ce(pe)??{defaults:{maxString:1200,maxArray:40,maxObjectKeys:60},caps:{maxString:4e3,maxArray:200,maxObjectKeys:200},maxDepth:4},n=(t==null?void 0:t.defaults)??{},s=(t==null?void 0:t.caps)??{},a=Number((t==null?void 0:t.maxDepth)??4),l=(o,C,R)=>{const D=ce(pe)??t,F=o==="defaults"?D.defaults??{}:D.caps??{},p=Number((F==null?void 0:F[C])??(o==="defaults"?n[C]:s[C])),b=Ee(R,C==="maxString"?80:C==="maxArray"?1:5,C==="maxString"?4e3:200,p),q={...D??{},[o]:{...F??{},[C]:b}};Xe(pe,q)};return e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-600",children:"Defaults"}),e.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"maxString"}),e.jsx(y,{type:"number",min:80,max:4e3,value:String(Number(n.maxString??1200)),onChange:o=>l("defaults","maxString",o.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"maxArray"}),e.jsx(y,{type:"number",min:1,max:200,value:String(Number(n.maxArray??40)),onChange:o=>l("defaults","maxArray",o.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"maxKeys"}),e.jsx(y,{type:"number",min:5,max:200,value:String(Number(n.maxObjectKeys??60)),onChange:o=>l("defaults","maxObjectKeys",o.target.value)})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-600",children:"Caps"}),e.jsxs("div",{className:"mt-2 grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"maxString"}),e.jsx(y,{type:"number",min:80,max:4e3,value:String(Number(s.maxString??4e3)),onChange:o=>l("caps","maxString",o.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"maxArray"}),e.jsx(y,{type:"number",min:1,max:200,value:String(Number(s.maxArray??200)),onChange:o=>l("caps","maxArray",o.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"maxKeys"}),e.jsx(y,{type:"number",min:5,max:200,value:String(Number(s.maxObjectKeys??200)),onChange:o=>l("caps","maxObjectKeys",o.target.value)})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-600",children:"maxDepth"}),e.jsx(y,{type:"number",min:1,max:8,value:Number.isFinite(a)?String(a):"4",onChange:o=>{const C=Ee(o.target.value,1,8,4),R=ce(pe)??t;Xe(pe,{...R??{},maxDepth:C})}})]})]})})()]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Reply runner"}),e.jsx(se,{onClick:()=>Y("assistant.reply_runner.backoff")})]}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:"Background assistant job worker knobs (claiming, retries, stuck reclaim, context size, backoff)."}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"claim limit"}),e.jsx(y,{type:"number",min:1,max:200,value:E["assistant.reply_runner.claim_limit_default"]??"",onChange:t=>J("assistant.reply_runner.claim_limit_default",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"max attempts"}),e.jsx(y,{type:"number",min:1,max:10,value:E["assistant.reply_runner.max_attempts_default"]??"",onChange:t=>J("assistant.reply_runner.max_attempts_default",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"stuck minutes"}),e.jsx(y,{type:"number",min:1,max:120,value:E["assistant.reply_runner.stuck_minutes"]??"",onChange:t=>J("assistant.reply_runner.stuck_minutes",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"max context msgs"}),e.jsx(y,{type:"number",min:1,max:50,value:E["assistant.reply_runner.max_context_messages"]??"",onChange:t=>J("assistant.reply_runner.max_context_messages",t.target.value)})]})]}),(()=>{const t=ce(_t)??{base_seconds:10,max_exp:10,max_seconds:3600,jitter_seconds:5},n=(s,a)=>{const l=ce(_t)??t,o=Number((l==null?void 0:l[s])??(t==null?void 0:t[s])),C=s==="base_seconds"?[1,120]:s==="max_exp"?[1,16]:s==="max_seconds"?[10,7200]:[0,30],R=Ee(a,C[0],C[1],o);Xe(_t,{...l??{},[s]:R})};return e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-600",children:"Backoff"}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"base s"}),e.jsx(y,{type:"number",min:1,max:120,value:String(Number(t.base_seconds??10)),onChange:s=>n("base_seconds",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"max exp"}),e.jsx(y,{type:"number",min:1,max:16,value:String(Number(t.max_exp??10)),onChange:s=>n("max_exp",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"max s"}),e.jsx(y,{type:"number",min:10,max:7200,value:String(Number(t.max_seconds??3600)),onChange:s=>n("max_seconds",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"jitter s"}),e.jsx(y,{type:"number",min:0,max:30,value:String(Number(t.jitter_seconds??5)),onChange:s=>n("jitter_seconds",s.target.value)})]})]})]})})()]})]})]})}),e.jsx(he,{title:"Quick editors (admin dashboard defaults)",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Admin Users"}),e.jsx(se,{onClick:()=>Y(Nt)})]}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-600",children:["List page size + ban duration (stored as ",e.jsx("span",{className:"font-mono",children:"admin"})," settings)."]}),e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"page limit"}),e.jsx(y,{type:"number",min:10,max:500,value:E[Nt]??"",onChange:t=>J(Nt,t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"ban duration (days)"}),e.jsx(y,{type:"number",min:1,max:36500,value:E[hs]??"",onChange:t=>J(hs,t.target.value)})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Admin Overview"}),e.jsx(se,{onClick:()=>Y(zt)})]}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:"Controls how many rows the overview endpoint returns."}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"recent errors"}),e.jsx(y,{type:"number",min:1,max:200,value:E[zt]??"",onChange:t=>J(zt,t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"last job runs"}),e.jsx(y,{type:"number",min:1,max:200,value:E[fs]??"",onChange:t=>J(fs,t.target.value)})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Admin Audit"}),e.jsx(se,{onClick:()=>Y(St)})]}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:"Default limit for listing audit rows (request may override, still clamped)."}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"default limit"}),e.jsx(y,{type:"number",min:1,max:200,value:E[St]??"",onChange:t=>J(St,t.target.value)})]})]})]})}),e.jsx(he,{title:"Quick editors (public UX / copy)",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Assistant"}),e.jsx(se,{onClick:()=>Y(kt)})]}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:"Public settings: affect how the client detects the assistant thread on first run."}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"assistant username"}),e.jsx(y,{value:E[kt]??"",onChange:t=>J(kt,t.target.value),placeholder:"movinesta"})]})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Presence labels"}),e.jsx(se,{onClick:()=>Y(Ct)})]}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:"UI copy for online / away / last-active state."}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"online label"}),e.jsx(y,{value:E[Ct]??"",onChange:t=>J(Ct,t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"active recently label"}),e.jsx(y,{value:E[gs]??"",onChange:t=>J(gs,t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"last-active prefix"}),e.jsx(y,{value:E[vs]??"",onChange:t=>J(vs,t.target.value)})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-900",children:"Messages search"}),e.jsx(se,{onClick:()=>Y(Mt)})]}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:"Minimum characters required to enable in-conversation search."}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-[11px] text-zinc-500",children:"min chars"}),e.jsx(y,{type:"number",min:1,max:10,value:E[Mt]??"",onChange:t=>J(Mt,t.target.value)})]})]})]})}),e.jsx(he,{title:"App settings (non-secret)",right:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"text-xs text-zinc-500",children:["Version: ",e.jsx("span",{className:"font-mono",children:X})]}),e.jsx(x,{variant:"ghost",onClick:()=>vt.mutate(),disabled:!Be.length||vt.isPending,children:vt.isPending?"Cleaning…":`Clean redundant (${Be.length})`}),e.jsx(x,{variant:"ghost",onClick:()=>r.invalidateQueries({queryKey:["app-settings"]}),disabled:c.isFetching,children:c.isFetching?"Refreshing…":"Refresh"}),e.jsx(x,{onClick:()=>{try{for(const t of Ue){const n=f[t];if(!n)continue;const s=de(n.default);Os(s,E[t]??"",Ne[t])}}catch(t){i.push({variant:"error",title:"Invalid input",message:ee(t)});return}gt.mutate()},disabled:!Ue.length||gt.isPending,children:gt.isPending?"Saving…":`Save (${Ue.length})`})]}),children:e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-12",children:[e.jsxs("div",{className:"md:col-span-4 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between gap-2 text-xs font-medium text-zinc-600",children:[e.jsx("span",{children:"Search"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"ghost",type:"button",onClick:()=>sn(),className:"rounded-lg border border-zinc-200 bg-white px-2 py-1 text-[11px] font-semibold text-zinc-600 hover:bg-zinc-50",children:"Reset"}),e.jsx(x,{variant:"ghost",type:"button",onClick:()=>re(!0),className:"rounded-lg border border-zinc-200 bg-white px-2 py-1 text-[11px] font-semibold text-zinc-600 hover:bg-zinc-50",children:"Ctrl+K"})]})]}),e.jsx(y,{ref:O,value:g,onChange:t=>N(t.target.value),placeholder:"Search key, hint text, examples…"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between gap-2 text-xs font-medium text-zinc-600",children:[e.jsx("span",{children:"Scope"}),e.jsx(x,{variant:"ghost",type:"button",onClick:()=>{N(""),k("all"),v(!1),T(!1),d("/settings")},className:"rounded-lg px-2 py-1 text-[11px] font-semibold text-zinc-600 hover:bg-zinc-100",children:"Reset"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 rounded-xl border border-zinc-200 bg-white p-2",children:[{value:"all",label:"All"},{value:"public",label:"Public"},{value:"admin",label:"Admin"},{value:"server_only",label:"Server"}].map(t=>e.jsx(x,{variant:"ghost",type:"button",onClick:()=>k(t.value),className:A("rounded-lg px-2 py-1 text-[11px] font-semibold",M===t.value?"bg-zinc-900 text-white":"bg-white text-zinc-700 hover:bg-zinc-50"),children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Favorites"}),e.jsxs("label",{className:"flex h-[42px] items-center gap-2 rounded-xl border border-zinc-200 bg-white px-3 text-sm text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:t=>{const n=t.target.checked;T(n),d(n?"/settings/favorites":_==="all"?"/settings":`/settings/${_}`)}}),e.jsx("span",{children:"Show only"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx("span",{children:"Sync:"}),e.jsx("span",{className:A("rounded-full px-2 py-0.5 text-[10px] font-semibold",oe.state==="Saved"&&"bg-emerald-100 text-emerald-900",oe.state==="Saving"&&"bg-zinc-200 text-zinc-800",oe.state==="Offline"&&"bg-zinc-100 text-zinc-700",oe.state==="Error"&&"bg-rose-100 text-rose-900"),children:oe.state}),oe.detail?e.jsx("span",{className:"truncate text-zinc-500",children:oe.detail}):null]}),e.jsx(x,{variant:"ghost",type:"button",onClick:()=>{lt(null),xe.mutate(U),r.invalidateQueries({queryKey:["app-settings"]})},disabled:xe.isPending,className:A("shrink-0 rounded-lg border border-zinc-200 bg-white px-2 py-1 text-[11px] font-semibold text-zinc-700 hover:bg-zinc-50",xe.isPending&&"opacity-50"),children:"Retry"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Sort"}),e.jsx("div",{className:"flex flex-wrap gap-2 rounded-xl border border-zinc-200 bg-white p-2",children:[{value:"key_asc",label:"Key"},{value:"last_modified_desc",label:"Last modified"},{value:"favorites_first",label:"Favorites first"}].map(t=>e.jsx(x,{variant:"ghost",type:"button",onClick:()=>Rt(t.value),className:A("rounded-lg px-3 py-2 text-xs font-semibold transition",Q===t.value?"bg-zinc-900 text-white":"bg-white text-zinc-700 hover:bg-zinc-50"),children:t.label},t.value))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Changed from default"}),e.jsxs("label",{className:"flex h-[42px] items-center gap-2 rounded-xl border border-zinc-200 bg-white px-3 text-sm text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:ae,onChange:t=>v(t.target.checked)}),e.jsx("span",{children:"Show only overrides"}),e.jsx("span",{className:"ml-auto text-xs text-zinc-500",children:"(stored values)"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs font-medium text-zinc-600",children:"Categories"}),e.jsxs("div",{className:"max-h-[260px] overflow-auto rounded-xl border border-zinc-200 bg-white p-2",children:[e.jsxs(x,{variant:"ghost",type:"button",onClick:()=>{T(!0),S("all"),d("/settings/favorites")},className:A("flex w-full items-center justify-between rounded-lg px-2 py-1.5 text-left text-sm",L?"bg-zinc-900 text-white":"hover:bg-zinc-50"),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[14px]",children:"⭐"}),e.jsx("span",{children:"Favorites"})]}),e.jsx("span",{className:"flex items-center gap-2",children:e.jsx("span",{className:A("text-xs",L?"text-white/80":"text-zinc-500"),children:U.filter(t=>!!f[t]).length})})]}),e.jsxs(x,{variant:"ghost",type:"button",onClick:()=>{T(!1),S("all"),d("/settings")},className:A("flex w-full items-center justify-between rounded-lg px-2 py-1.5 text-left text-sm",_==="all"&&!L?"bg-zinc-900 text-white":"hover:bg-zinc-50"),children:[e.jsx("span",{children:"all"}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:A("text-xs",_==="all"&&!L?"text-white/80":"text-zinc-500"),children:Object.keys(f).length}),Array.from(Ke.values()).reduce((t,n)=>t+n,0)>0&&e.jsx("span",{className:A("rounded-full px-2 py-0.5 text-[10px] font-medium",_==="all"&&!L?"bg-white/15 text-white":"bg-amber-100 text-amber-900"),children:Array.from(Ke.values()).reduce((t,n)=>t+n,0)})]})]}),Gt.filter(t=>t!=="all").map(t=>e.jsxs(x,{variant:"ghost",type:"button",onClick:()=>{T(!1),S(t),d(`/settings/${t}`)},className:A("mt-1 flex w-full items-center justify-between rounded-lg px-2 py-1.5 text-left text-sm",_===t&&!L?"bg-zinc-900 text-white":"hover:bg-zinc-50"),children:[e.jsx("span",{className:"truncate",children:t}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:A("text-xs",_===t&&!L?"text-white/80":"text-zinc-500"),children:Zt.get(t)??0}),(Ke.get(t)??0)>0&&e.jsx("span",{className:A("rounded-full px-2 py-0.5 text-[10px] font-medium",_===t&&!L?"bg-white/15 text-white":"bg-amber-100 text-amber-900"),children:Ke.get(t)??0})]})]},t))]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-600",children:"Recently changed"}),e.jsx(x,{variant:"ghost",onClick:()=>r.invalidateQueries({queryKey:["app-settings-history","recent"]}),disabled:h.isFetching,children:h.isFetching?"…":"Refresh"})]}),e.jsxs("div",{className:"max-h-[220px] overflow-auto rounded-xl border border-zinc-200 bg-white",children:[(((Cs=h.data)==null?void 0:Cs.rows)??[]).slice(0,20).map(t=>e.jsxs(x,{variant:"ghost",type:"button",onClick:()=>jt(t.key),className:"w-full border-b border-zinc-100 px-3 py-2 text-left hover:bg-zinc-50",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"truncate font-mono text-[11px] text-zinc-900",children:t.key}),e.jsx("div",{className:"shrink-0 text-[11px] text-zinc-500",children:new Date(t.changed_at).toLocaleString()})]}),t.change_reason?e.jsx("div",{className:"mt-1 line-clamp-1 text-[11px] text-zinc-600",children:t.change_reason}):null]},t.id)),(((Ms=h.data)==null?void 0:Ms.rows)??[]).length?null:e.jsx("div",{className:"px-3 py-3 text-sm text-zinc-500",children:"No recent changes."})]})]})]}),e.jsxs("div",{className:"md:col-span-8",children:[j?e.jsxs("div",{className:"mb-4 rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:"Settings home"}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:"Pick a category to browse, or use search & filters to find a specific key."})]}),e.jsx(x,{variant:"ghost",onClick:()=>{S("all"),d("/settings/all")},children:"Browse all"})]}),e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3",children:Gt.filter(t=>t!=="all").map(t=>e.jsxs(x,{variant:"ghost",type:"button",onClick:()=>{S(t),d(`/settings/${t}`)},className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-4 text-left hover:bg-zinc-100",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:t}),e.jsx("div",{className:"text-xs text-zinc-600",children:Zt.get(t)??0})]}),e.jsx("div",{className:"mt-2 text-xs text-zinc-600",children:t==="assistant"?"Models, tokens, tool policies, orchestrator behavior.":t==="ux"?"UI copy, presence/seen rules, message UX flags.":t==="ranking"?"Taste &amp; trending weights, thresholds.":t==="moderation"?"Non-secret moderation filters &amp; limits.":t==="ops"?"Timeouts, retries, rate limits, job defaults.":t==="plan"?"Tier caps &amp; quotas.":t==="integrations"?"Non-secret endpoints &amp; integration toggles.":"Settings in this category."})]},t))})]}):null,e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Reason (optional)"}),e.jsx(y,{value:Ge,onChange:t=>Ft(t.target.value),placeholder:"Why are you changing these?"})]}),e.jsxs("div",{className:"space-y-4",children:[Js.map(([t,n])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-600",children:t}),e.jsx("div",{className:"space-y-2",children:n.map(s=>{const a=f[s],l=H.get(s),o=!!l,C=o&&ve(l==null?void 0:l.value,a.default),R=o&&!C,D=!!ze[s],F=de(a.default),p=a.meta,B=De(s,{default:a.default,description:a.description,meta:a.meta}),ie=(B==null?void 0:B.recommended)!==void 0;return e.jsxs("div",{id:`setting-${s}`,className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"truncate font-mono text-xs text-zinc-900",children:s}),e.jsx(x,{variant:"ghost",type:"button",onClick:()=>cs(s),title:"Copy key","aria-label":"Copy key",className:"inline-flex h-6 w-6 p-0 items-center justify-center rounded-full border border-zinc-200 bg-white text-[12px] font-semibold text-zinc-500 shadow-sm hover:text-zinc-700",children:"⧉"}),e.jsx(x,{variant:"ghost",type:"button",onClick:()=>Gs(s),title:yt(s)?"Unfavorite":"Favorite","aria-label":yt(s)?"Unfavorite":"Favorite",className:A("inline-flex h-6 w-6 items-center justify-center rounded-full border border-zinc-200 bg-white text-[12px] font-semibold shadow-sm",yt(s)?"text-amber-600":"text-zinc-400 hover:text-zinc-600"),children:"★"}),e.jsx(se,{onClick:()=>Y(s),title:"Explain this setting"}),e.jsx("span",{className:A("rounded-lg px-2 py-1 text-xs font-semibold",a.scope==="public"&&"bg-emerald-100 text-emerald-800",a.scope==="admin"&&"bg-zinc-200 text-zinc-800",a.scope==="server_only"&&"bg-blue-100 text-blue-800"),children:a.scope}),o?R?e.jsx("span",{className:"rounded-full bg-amber-100 px-2 py-0.5 text-[10px] font-semibold text-amber-900",children:"overridden"}):e.jsx("span",{className:"rounded-full bg-purple-100 px-2 py-0.5 text-[10px] font-semibold text-purple-900",children:"redundant"}):e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-0.5 text-[10px] font-semibold text-zinc-700",children:"default"}),D?e.jsx("span",{className:"rounded bg-amber-100 px-2 py-1 text-[10px] font-semibold text-amber-800",children:"modified"}):null]}),e.jsx("div",{className:"mt-2 text-sm text-zinc-700",children:a.description}),e.jsx("div",{className:"mt-1 text-xs text-zinc-500",children:o?e.jsxs("span",{children:["stored v",(l==null?void 0:l.version)??"?"]}):e.jsx("span",{children:"using default"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"ghost",onClick:()=>en(s),children:"Reset"}),e.jsx(x,{variant:"ghost",onClick:()=>jt(s),children:"History"})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 lg:grid-cols-12",children:[e.jsxs("div",{className:"lg:col-span-8",children:[(p==null?void 0:p.kind)==="enum"?e.jsx("select",{value:E[s]??String(Ae(s)??""),onChange:b=>{V(q=>({...q,[s]:b.target.value})),W(s)},className:"w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm text-zinc-900 focus:outline-none focus:ring-2 focus:ring-zinc-300",children:(p.values??[]).map(b=>e.jsx("option",{value:b,children:b},b))}):F==="boolean"?e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!Ne[s],onChange:b=>{Pe(q=>({...q,[s]:b.target.checked})),W(s)}}),Ne[s]?"true":"false"]}):F==="json"?e.jsx("textarea",{value:E[s]??"",onChange:b=>{V(q=>({...q,[s]:b.target.value})),W(s)},rows:6,className:"w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 font-mono text-xs text-zinc-900 focus:outline-none focus:ring-2 focus:ring-zinc-300"}):F==="number"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{value:E[s]??"",onChange:b=>{V(q=>({...q,[s]:b.target.value})),W(s)},type:"number",min:(p==null?void 0:p.kind)==="number"?p.min:void 0,max:(p==null?void 0:p.kind)==="number"?p.max:void 0,step:(p==null?void 0:p.kind)==="number"&&p.int?1:"any"}),(p==null?void 0:p.kind)==="number"&&typeof p.min=="number"&&typeof p.max=="number"&&p.max-p.min<=1e4?e.jsx("input",{type:"range",min:p.min,max:p.max,step:p.int?1:.1,value:(()=>{const b=(E[s]??"").trim(),q=Number(b);if(b!==""&&Number.isFinite(q))return q;const Rs=Number(Ae(s));return Number.isFinite(Rs)?Rs:p.min})(),onChange:b=>{V(q=>({...q,[s]:b.target.value})),W(s)},className:"w-full"}):null]}):e.jsx(y,{value:E[s]??"",onChange:b=>{V(q=>({...q,[s]:b.target.value})),W(s)},type:"text"}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsxs("div",{children:["Default: ",e.jsx("span",{className:"font-mono",children:F==="json"?"(json)":String(a.default)}),(p==null?void 0:p.kind)==="number"&&(typeof p.min=="number"||typeof p.max=="number")?e.jsxs("span",{className:"ml-2",children:["Range: ",e.jsxs("span",{className:"font-mono",children:[p.min??"-∞","…",p.max??"∞"]})]}):null]}),ie?e.jsx(x,{variant:"ghost",type:"button",onClick:()=>an(s),className:"rounded-lg border border-zinc-200 bg-white px-2 py-1 text-[11px] font-semibold text-zinc-700 hover:bg-zinc-50",children:"Apply recommended"}):null]}),F==="json"?e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx(x,{variant:"ghost",onClick:()=>{try{const b=JSON.parse((E[s]??"").trim());V(q=>({...q,[s]:G(b)})),W(s),i.push({variant:"success",title:"Formatted",message:"JSON formatted."})}catch(b){i.push({variant:"error",title:"Invalid JSON",message:ee(b)})}},children:"Format JSON"}),e.jsx(x,{variant:"ghost",onClick:()=>{try{JSON.parse((E[s]??"").trim()),i.push({variant:"success",title:"Valid",message:"JSON is valid."})}catch(b){i.push({variant:"error",title:"Invalid JSON",message:ee(b)})}},children:"Validate"})]}):null]}),e.jsx("div",{className:"lg:col-span-4",children:e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Suggested"}),e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:ie?(B==null?void 0:B.recommended_why)??"Curated recommended value.":"Default value (matches current app behavior)."}),e.jsx("pre",{className:"mt-2 max-h-40 overflow-auto rounded-xl border border-zinc-200 bg-white p-2 text-xs",children:G(ie?B==null?void 0:B.recommended:a.default)})]})})]})]},s)})})]},t)),ft.length?null:e.jsx("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4 text-sm text-zinc-500",children:"No matching settings."})]})]})]})}),e.jsx(Fe,{open:je,title:"Jump to setting",onClose:()=>{re(!1)},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Search by key, title, hint text, examples…"}),e.jsx("input",{ref:Kt,value:rt,onChange:t=>me(t.target.value),onKeyDown:t=>{var n;if(t.key==="Escape"){t.preventDefault(),re(!1);return}if(t.key==="Enter"){t.preventDefault();const s=(n=ht[0])==null?void 0:n.key;s&&(re(!1),me(""),Qe(s,{openDetails:!0}))}},placeholder:"e.g., ux.presence, tokens, rate limits…",className:"w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm text-zinc-900 placeholder:text-zinc-400 focus:outline-none focus:ring-2 focus:ring-zinc-300"})]}),e.jsx("div",{className:"max-h-[55vh] overflow-auto rounded-xl border border-zinc-200",children:ht.length?e.jsx("div",{className:"divide-y divide-zinc-100",children:ht.map(t=>{const n=f[t.key],s=H.get(t.key),a=s?ve(s.value,n==null?void 0:n.default)?"redundant":"overridden":"default";return e.jsxs(x,{variant:"ghost",type:"button",onClick:()=>{re(!1),me(""),Qe(t.key,{openDetails:!0})},className:"w-full px-3 py-2 text-left hover:bg-zinc-50",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate font-mono text-xs text-zinc-900",children:t.key}),e.jsx("div",{className:"mt-1 line-clamp-1 text-xs text-zinc-600",children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"rounded-lg bg-zinc-100 px-2 py-1 text-[11px] font-semibold text-zinc-700",children:be(t.key)}),e.jsx("span",{className:A("rounded-full px-2 py-0.5 text-[10px] font-semibold",a==="default"&&"bg-zinc-100 text-zinc-700",a==="overridden"&&"bg-amber-100 text-amber-900",a==="redundant"&&"bg-purple-100 text-purple-900"),children:a})]})]}),t.description?e.jsx("div",{className:"mt-1 line-clamp-2 text-xs text-zinc-500",children:t.description}):null]},t.key)})}):e.jsx("div",{className:"px-3 py-3 text-sm text-zinc-500",children:"No matching settings."})}),e.jsxs("div",{className:"text-[11px] text-zinc-500",children:["Tip: press ",e.jsx("span",{className:"font-mono",children:"Enter"})," to jump to the top result. Each result opens the details drawer."]})]})}),e.jsx(jn,{open:ms,settingKey:z,entry:z?f[z]:null,row:z?H.get(z)??null:null,onNavigateToKey:t=>Qe(t,{openDetails:!0}),status:(()=>{if(!z)return;const t=f[z],n=H.get(z);if(t)return n?ve(n.value,t.default)?"redundant":"overridden":"default"})(),hint:z?De(z,f[z]?{default:f[z].default,description:f[z].description,meta:f[z].meta}:void 0):null,effectiveValue:z?Ae(z):void 0,draftValue:z?rn(z):void 0,recentHistory:((Es=on.data)==null?void 0:Es.rows)??[],onClose:nn,onCopyKey:z?(()=>cs(z)):void 0,onOpenHistory:z?(()=>jt(z)):void 0,onApplyValue:z?(t=>ps(z,t)):void 0}),e.jsx(Fe,{open:Qs,title:$?`History: ${$}`:"History",onClose:()=>{rs(!1),is(null)},children:Ce.isPending?e.jsx("div",{className:"text-sm text-zinc-500",children:"Loading history…"}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Range"}),e.jsxs("select",{value:He,onChange:t=>{const n=Number(t.target.value);Xs(n),$&&Ce.mutate({key:$,limit:$e,since:ke(n)})},className:"w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm text-zinc-900 focus:outline-none focus:ring-2 focus:ring-zinc-300",children:[e.jsx("option",{value:0,children:"All"}),e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:90,children:"Last 90 days"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Limit"}),e.jsx(y,{type:"number",value:String($e),min:1,max:200,onChange:t=>{const n=Ee(t.target.value,1,200,50);Ws(n),$&&Ce.mutate({key:$,limit:n,since:ke(He)})}})]}),e.jsxs("div",{className:"ml-auto flex gap-2",children:[e.jsx("div",{className:"flex rounded-xl border border-zinc-200 bg-white p-1",children:[{value:"side_by_side",label:"Side-by-side"},{value:"diff",label:"Diff"}].map(t=>e.jsx(x,{variant:"ghost",type:"button",onClick:()=>Is(t.value),className:A("rounded-lg px-2 py-1 text-[11px] font-semibold transition",Dt===t.value?"bg-zinc-900 text-white":"text-zinc-700 hover:bg-zinc-50"),children:t.label},t.value))}),e.jsx(x,{variant:"ghost",onClick:ds,children:"Refresh"})]})]}),os.length?e.jsx("div",{className:"space-y-2",children:os.map(t=>e.jsxs("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-xs text-zinc-600",children:[e.jsxs("span",{className:"font-mono",children:["v",t.old_version??"—"," → v",t.new_version??"—"]}),e.jsx("span",{className:"mx-2",children:"·"}),e.jsx("span",{className:"font-mono",children:new Date(t.changed_at).toLocaleString()})]}),t.change_reason?e.jsxs("div",{className:"text-xs text-zinc-600",children:["Reason: ",t.change_reason]}):null]}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-xs text-zinc-500",children:["Changed by: ",e.jsx("span",{className:"font-mono",children:t.changed_by??"—"}),t.request_id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"·"}),"Req: ",e.jsx("span",{className:"font-mono",children:t.request_id})]}):null]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(x,{variant:"ghost",onClick:()=>tn(t),children:"Rollback"})})]}),Dt==="diff"?e.jsx("div",{className:"mt-2",children:e.jsx(Cn,{before:t.old_value,after:t.new_value})}):e.jsxs("div",{className:"mt-2 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-semibold text-zinc-700",children:"Old"}),e.jsx("pre",{className:"max-h-48 overflow-auto rounded-xl border border-zinc-200 bg-white p-2 text-xs",children:G(t.old_value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-semibold text-zinc-700",children:"New"}),e.jsx("pre",{className:"max-h-48 overflow-auto rounded-xl border border-zinc-200 bg-white p-2 text-xs",children:G(t.new_value)})]})]})]},t.id))}):e.jsx("div",{className:"text-sm text-zinc-500",children:"No history yet."})]})}),e.jsx(Fe,{open:Ys,title:Z?`Rollback: ${Z.key}`:"Rollback",onClose:()=>{Me.isPending||(Je(!1),Ve(null),Se(""))},children:Z?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-900",children:["This will write a new settings update that restores the old value from version ",e.jsxs("span",{className:"font-mono",children:["v",Z.old_version??"—"]}),". The change is audited and can be rolled back again."]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Reason (required)"}),e.jsx("textarea",{value:bt,onChange:t=>Se(t.target.value),rows:3,placeholder:"Example: Accidentally set too low; restoring previous safe value.",className:"w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm text-zinc-900 focus:outline-none focus:ring-2 focus:ring-zinc-300"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-semibold text-zinc-700",children:"Will restore"}),e.jsx("pre",{className:"max-h-48 overflow-auto rounded-xl border border-zinc-200 bg-zinc-50 p-2 text-xs",children:G(Z.old_value??($?(As=f[$])==null?void 0:As.default:null)??null)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-semibold text-zinc-700",children:"Current (from history row)"}),e.jsx("pre",{className:"max-h-48 overflow-auto rounded-xl border border-zinc-200 bg-zinc-50 p-2 text-xs",children:G(Z.new_value)})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{variant:"ghost",onClick:()=>{Je(!1),Ve(null),Se("")},disabled:Me.isPending,children:"Cancel"}),e.jsx(x,{variant:"danger",onClick:()=>Me.mutate(),disabled:Me.isPending||bt.trim().length<3,children:Me.isPending?"Rolling back…":"Confirm rollback"})]})]}):e.jsx("div",{className:"text-sm text-zinc-500",children:"No rollback target selected."})})]})}export{On as default};
