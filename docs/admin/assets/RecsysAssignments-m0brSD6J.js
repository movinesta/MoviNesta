import{t as k,u as A,r as m,j as e,L as b,ad as E,B as o,aw as C,ax as R,ay as q}from"./index-CoY44SlW.js";import{u as B,E as T}from"./ErrorBox-CvgwTo6Q.js";import{u as j}from"./useMutation-CglkDXYR.js";import{C as y}from"./Card-DzyM45zw.js";import{I as z}from"./Input-CFuN_OLj.js";import{T as D,a as r,b as c}from"./Table-BpO-pS4x.js";import{E as f}from"./EmptyState-DaHQMra1.js";function F(n){return e.jsx("div",{className:"text-xl font-semibold tracking-tight",children:n.children})}function $(){var g;const n=k(),x=A(),[l,d]=m.useState(""),[t,u]=m.useState(""),h=()=>u(l.trim()),v=()=>{d(""),u("")},i=B({queryKey:["recsys_assignments",t],queryFn:()=>q({user:t.trim()}),enabled:!!t.trim()}),p=((g=i.data)==null?void 0:g.rows)??[],N=j({mutationFn:s=>C(s),onSuccess:async()=>{await x.invalidateQueries({queryKey:["recsys_assignments",t]}),n.push({title:"Assignment set",message:"Manual variant override applied.",variant:"success"})}}),_=j({mutationFn:s=>R(s),onSuccess:async()=>{await x.invalidateQueries({queryKey:["recsys_assignments",t]}),n.push({title:"Assignment reset",message:"Auto assignment restored.",variant:"success"})}}),S=m.useMemo(()=>!!t.trim(),[t]);return i.isLoading?e.jsx(b,{}):i.error?e.jsx(T,{error:i.error}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx(F,{children:"Experiment Assignments"}),e.jsx(E,{className:"text-sm text-zinc-600 hover:text-zinc-900",to:"/recsys",children:"â† Back to Recsys"})]}),e.jsxs(y,{title:"Find user",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsx(z,{value:l,onChange:s=>d(s.target.value),onKeyDown:s=>{s.key==="Enter"&&h()},placeholder:"Search by user id or email"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[l||t?e.jsx(o,{variant:"ghost",onClick:v,children:"Clear"}):null,e.jsx(o,{variant:"ghost",onClick:h,children:"Search"})]})]}),t?e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Applied filter: ",e.jsx("span",{className:"font-mono",children:t})]}):null]}),e.jsx(y,{title:"Assignments",children:S?p.length?e.jsxs(D,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(r,{children:"Experiment"}),e.jsx(r,{children:"Variant"}),e.jsx(r,{children:"Mode"}),e.jsx(r,{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:p.map(s=>e.jsxs("tr",{children:[e.jsx(c,{className:"font-mono text-xs",children:s.experiment_key}),e.jsx(c,{className:"text-sm",children:s.variant}),e.jsx(c,{className:"text-xs text-zinc-600",children:s.assignment_mode??"auto"}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[e.jsx("select",{className:"rounded-xl border border-zinc-200 bg-white px-2 py-1 text-xs",defaultValue:s.variant,onChange:a=>N.mutate({experiment_key:s.experiment_key,user_id:s.user_id,variant:a.target.value}),children:(s.available_variants??[s.variant]).map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx(o,{variant:"ghost",onClick:()=>_.mutate({experiment_key:s.experiment_key,user_id:s.user_id}),children:"Reset to auto"})]})})]},`${s.experiment_key}:${s.user_id}`))})]}):e.jsx(f,{title:"No assignments",message:"No assignments were found for this user yet."}):e.jsx(f,{title:"Search for a user",message:"Enter a UUID or email to inspect experiment assignments."})})]})}export{$ as default};
