import{u as z,r as A,j as e,L as k,f as g,a as u,B as N,b as S,c as T,g as $}from"./index-CoY44SlW.js";import{u as P,E as q}from"./ErrorBox-CvgwTo6Q.js";import{u as y}from"./useMutation-CglkDXYR.js";import{S as v}from"./StatCard-Ct239vFi.js";import{C as c}from"./Card-DzyM45zw.js";import{T as x,a as l,b as i}from"./Table-BpO-pS4x.js";import{C as B}from"./ConfirmDialog-DAVx_zvd.js";import{R as O,X as K,Y as L,T as D,B as E}from"./generateCategoricalChart-FnZw2e2y.js";import{B as F}from"./BarChart-CZCNQIUn.js";function J(n){const t=(n||"warn").toLowerCase(),d=t==="critical"?"bg-red-100 text-red-700":t==="info"?"bg-blue-100 text-blue-700":"bg-amber-100 text-amber-800";return e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ${d}`,children:t})}function M(n){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:n.children})}function W(){var p,b,f;const n=z(),[t,d]=A.useState(null),h=y({mutationFn:({id:s,reason:a})=>T(s,a),onSuccess:()=>n.invalidateQueries({queryKey:["overview"]})}),m=y({mutationFn:({reason:s})=>S(s),onSuccess:()=>n.invalidateQueries({queryKey:["overview"]})}),j=P({queryKey:["overview"],queryFn:$}),_=j.data;if(j.isLoading)return e.jsx(k,{});if(j.error)return e.jsx(q,{error:j.error});const r=_,w=r.active_profile?`${r.active_profile.provider} / ${r.active_profile.model} (${r.active_profile.dimensions})`:"—",o=r.zdr_coverage,C=o?`${Math.round((o.coverage_rate??0)*100)}%`:"—",R=r.coverage.map(s=>({name:`${s.provider} / ${s.model}`,count:s.count}));return e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{children:"Overview"}),e.jsx(B,{open:!!t,title:(t==null?void 0:t.mode)==="all"?"Resolve all alerts?":"Resolve this alert?",message:(t==null?void 0:t.mode)==="all"?"This will mark all active alerts as resolved.":"This will mark the alert as resolved.",confirmText:(t==null?void 0:t.mode)==="all"?m.isPending?"Resolving…":"Resolve all":h.isPending?"Resolving…":"Resolve",confirmDisabled:(t==null?void 0:t.mode)==="all"?m.isPending||!((p=r.ops_alerts)!=null&&p.length):h.isPending,onCancel:()=>d(null),onConfirm:()=>{const s=t==null?void 0:t.mode,a=t&&"id"in t?t.id:null;d(null),s==="all"?m.mutate({reason:"Resolved from admin dashboard"}):s==="one"&&a!==null&&h.mutate({id:a,reason:"Resolved from admin dashboard"})}}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsx(v,{title:"Active embeddings",value:w,subtitle:r.active_profile?`task=${r.active_profile.task}`:void 0}),e.jsx(v,{title:"Providers stored",value:r.coverage.length,subtitle:"Distinct provider/model pairs"}),e.jsx(v,{title:"Job cursors",value:r.job_state.length,subtitle:"Saved pagination states"}),e.jsx(v,{title:"ZDR coverage (24h)",value:C,subtitle:o?`${g(o.used)} used / ${g(o.requested)} requested`:"No routing logs yet"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(c,{title:"Embedding coverage",children:[e.jsx("div",{className:"h-64",children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(F,{data:R,children:[e.jsx(K,{dataKey:"name",interval:0,angle:-20,textAnchor:"end",height:60,tickFormatter:s=>typeof s=="string"&&s.length>22?`${s.slice(0,22)}…`:s}),e.jsx(L,{}),e.jsx(D,{}),e.jsx(E,{dataKey:"count"})]})})}),e.jsx("div",{className:"mt-4",children:e.jsxs(x,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(l,{children:"Provider"}),e.jsx(l,{children:"Model"}),e.jsx(l,{className:"text-right",children:"Count"})]})}),e.jsx("tbody",{children:r.coverage.map((s,a)=>e.jsxs("tr",{children:[e.jsx(i,{children:s.provider}),e.jsx(i,{className:"font-mono text-xs",children:s.model}),e.jsx(i,{className:"text-right",children:g(s.count)})]},a))})]})})]}),e.jsx(c,{title:"Recent errors (last 24h)",children:e.jsxs(x,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(l,{children:"At"}),e.jsx(l,{children:"Code"}),e.jsx(l,{children:"Message"})]})}),e.jsx("tbody",{children:r.recent_errors.length?r.recent_errors.map(s=>e.jsxs("tr",{children:[e.jsx(i,{className:"whitespace-nowrap text-xs text-zinc-600",children:u(s.created_at)}),e.jsx(i,{className:"font-mono text-xs",children:s.error_code??"—"}),e.jsx(i,{className:"max-w-[28rem] truncate text-sm",children:s.error_message??"—"})]},s.id)):e.jsx("tr",{children:e.jsx(i,{colSpan:3,className:"text-zinc-500",children:"No recent errors."})})})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:e.jsxs(c,{title:"Ops Alerts",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-zinc-600",children:"Active operational alerts raised by scheduled health checks."}),e.jsx(N,{variant:"secondary",disabled:m.isPending||!((b=r.ops_alerts)!=null&&b.length),onClick:()=>d({mode:"all"}),children:"Resolve all"})]}),e.jsxs(x,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(l,{children:"Severity"}),e.jsx(l,{children:"Title"}),e.jsx(l,{children:"Updated"}),e.jsx(l,{})]})}),e.jsx("tbody",{children:(f=r.ops_alerts)!=null&&f.length?r.ops_alerts.map(s=>e.jsxs("tr",{children:[e.jsx(i,{children:J(s.severity)}),e.jsxs(i,{children:[e.jsx("div",{className:"font-medium",children:s.title}),s.detail?e.jsx("div",{className:"mt-1 text-xs text-zinc-600",children:s.detail}):null,e.jsx("div",{className:"mt-1 text-xs text-zinc-500",children:s.kind})]}),e.jsx(i,{className:"whitespace-nowrap text-xs text-zinc-600",children:u(s.updated_at)}),e.jsx(i,{className:"text-right",children:e.jsx(N,{variant:"secondary",disabled:h.isPending,onClick:()=>d({mode:"one",id:s.id}),children:"Resolve"})})]},s.id)):e.jsx("tr",{children:e.jsx(i,{colSpan:4,className:"text-zinc-500",children:"No active ops alerts."})})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsx(c,{title:"Job cursors",children:e.jsxs(x,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(l,{children:"Job"}),e.jsx(l,{children:"Cursor"}),e.jsx(l,{children:"Updated"})]})}),e.jsx("tbody",{children:r.job_state.map((s,a)=>e.jsxs("tr",{children:[e.jsx(i,{className:"font-mono text-xs",children:s.job_name}),e.jsx(i,{className:"font-mono text-xs",children:s.cursor??"—"}),e.jsx(i,{className:"whitespace-nowrap text-xs text-zinc-600",children:u(s.updated_at)})]},a))})]})}),e.jsx(c,{title:"Last job runs",children:e.jsxs(x,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(l,{children:"At"}),e.jsx(l,{children:"Job"}),e.jsx(l,{children:"Status"})]})}),e.jsx("tbody",{children:r.last_job_runs.length?r.last_job_runs.map(s=>e.jsxs("tr",{children:[e.jsx(i,{className:"whitespace-nowrap text-xs text-zinc-600",children:u(s.started_at)}),e.jsx(i,{className:"font-mono text-xs",children:s.job_name}),e.jsx(i,{className:s.ok?"text-emerald-600":"text-red-600",children:s.ok?"OK":"FAIL"})]},s.id)):e.jsx("tr",{children:e.jsx(i,{colSpan:3,className:"text-zinc-500",children:"No job runs logged yet."})})})]})})]})]})}export{W as default};
