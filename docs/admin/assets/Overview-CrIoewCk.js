import{j as e,L as u,f as x,a as h,g as p}from"./index-CGWJK-B7.js";import{u as v,E as f}from"./ErrorBox-DGVAxfkB.js";import{S as n,R as b,X as N,Y as _,T as y,B as w}from"./generateCategoricalChart-BiCnn-u3.js";import{C as d}from"./Card-BfoASP6-.js";import{T as l,a as i,b as r}from"./Table-DrAL3XMq.js";import{B as $}from"./BarChart-BaiMNwy4.js";function C(a){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:a.children})}function q(){const a=v({queryKey:["overview"],queryFn:p});if(a.isLoading)return e.jsx(u,{});if(a.error)return e.jsx(f,{error:a.error});const t=a.data,j=t.active_profile?`${t.active_profile.provider} / ${t.active_profile.model} (${t.active_profile.dimensions})`:"—",c=t.zdr_coverage,m=c?`${Math.round((c.coverage_rate??0)*100)}%`:"—",g=t.coverage.map(s=>({name:`${s.provider} / ${s.model}`,count:s.count}));return e.jsxs("div",{className:"space-y-6",children:[e.jsx(C,{children:"Overview"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsx(n,{title:"Active embeddings",value:j,subtitle:t.active_profile?`task=${t.active_profile.task}`:void 0}),e.jsx(n,{title:"Providers stored",value:t.coverage.length,subtitle:"Distinct provider/model pairs"}),e.jsx(n,{title:"Job cursors",value:t.job_state.length,subtitle:"Saved pagination states"}),e.jsx(n,{title:"ZDR coverage (24h)",value:m,subtitle:c?`${x(c.used)} used / ${x(c.requested)} requested`:"No routing logs yet"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(d,{title:"Embedding coverage",children:[e.jsx("div",{className:"h-64",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs($,{data:g,children:[e.jsx(N,{dataKey:"name",interval:0,angle:-20,textAnchor:"end",height:60,tickFormatter:s=>typeof s=="string"&&s.length>22?`${s.slice(0,22)}…`:s}),e.jsx(_,{}),e.jsx(y,{}),e.jsx(w,{dataKey:"count"})]})})}),e.jsx("div",{className:"mt-4",children:e.jsxs(l,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(i,{children:"Provider"}),e.jsx(i,{children:"Model"}),e.jsx(i,{className:"text-right",children:"Count"})]})}),e.jsx("tbody",{children:t.coverage.map((s,o)=>e.jsxs("tr",{children:[e.jsx(r,{children:s.provider}),e.jsx(r,{className:"font-mono text-xs",children:s.model}),e.jsx(r,{className:"text-right",children:x(s.count)})]},o))})]})})]}),e.jsx(d,{title:"Recent errors (last 24h)",children:e.jsxs(l,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(i,{children:"At"}),e.jsx(i,{children:"Code"}),e.jsx(i,{children:"Message"})]})}),e.jsx("tbody",{children:t.recent_errors.length?t.recent_errors.map(s=>e.jsxs("tr",{children:[e.jsx(r,{className:"whitespace-nowrap text-xs text-zinc-600",children:h(s.created_at)}),e.jsx(r,{className:"font-mono text-xs",children:s.error_code??"—"}),e.jsx(r,{className:"max-w-[28rem] truncate text-sm",children:s.error_message??"—"})]},s.id)):e.jsx("tr",{children:e.jsx(r,{colSpan:3,className:"text-zinc-500",children:"No recent errors."})})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsx(d,{title:"Job cursors",children:e.jsxs(l,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(i,{children:"Job"}),e.jsx(i,{children:"Cursor"}),e.jsx(i,{children:"Updated"})]})}),e.jsx("tbody",{children:t.job_state.map((s,o)=>e.jsxs("tr",{children:[e.jsx(r,{className:"font-mono text-xs",children:s.job_name}),e.jsx(r,{className:"font-mono text-xs",children:s.cursor??"—"}),e.jsx(r,{className:"whitespace-nowrap text-xs text-zinc-600",children:h(s.updated_at)})]},o))})]})}),e.jsx(d,{title:"Last job runs",children:e.jsxs(l,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(i,{children:"At"}),e.jsx(i,{children:"Job"}),e.jsx(i,{children:"Status"})]})}),e.jsx("tbody",{children:t.last_job_runs.length?t.last_job_runs.map(s=>e.jsxs("tr",{children:[e.jsx(r,{className:"whitespace-nowrap text-xs text-zinc-600",children:h(s.started_at)}),e.jsx(r,{className:"font-mono text-xs",children:s.job_name}),e.jsx(r,{className:s.ok?"text-emerald-600":"text-red-600",children:s.ok?"OK":"FAIL"})]},s.id)):e.jsx("tr",{children:e.jsx(r,{colSpan:3,className:"text-zinc-500",children:"No job runs logged yet."})})})]})})]})]})}export{q as default};
