import{r as d,j as e,L as S,a as p,f as x,B as u,w as k}from"./index-Ce94cHyp.js";import{u as C,E}from"./ErrorBox-DZUsR5L2.js";import{C as _}from"./Card-DXgML9lJ.js";import{T as L,a as c,b as r}from"./Table-B-aH1K18.js";import{I as T}from"./Input-BLXhYdkr.js";import{E as F}from"./EmptyState-mcVY2n_D.js";import{C as v}from"./CopyButton-D3efaj2N.js";function B(n){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:n.children})}function R(){const[n,s]=d.useState(100),[i,l]=d.useState(null),[o,h]=d.useState([]),[j,a]=d.useState(null),g=C({queryKey:["logs",{limit:n,before:i}],queryFn:()=>k({limit:n,before:i})}),m=g.data,N=(m==null?void 0:m.rows)??[],z=(m==null?void 0:m.next_before)??null,f=d.useMemo(()=>N.find(t=>String(t.id)===String(j))??null,[N,j]);return d.useEffect(()=>{j&&(f||a(null))},[j,f]),d.useEffect(()=>{l(null),h([]),a(null)},[n]),g.isLoading?e.jsx(S,{}):g.error?e.jsx(E,{error:g.error}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{children:"Logs"}),e.jsxs(_,{title:"Job run log",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-40",children:e.jsx(T,{type:"number",value:String(n),min:10,max:500,onChange:t=>{const b=t.target.value;if(b==="")return;const y=Number(b);if(!Number.isFinite(y))return;const w=Math.max(10,Math.min(500,Math.trunc(y)));s(w)}})}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Rows"})]}),e.jsxs(L,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(c,{children:"Started"}),e.jsx(c,{children:"Finished"}),e.jsx(c,{children:"Job"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Scanned"}),e.jsx(c,{className:"text-right",children:"Embedded"}),e.jsx(c,{className:"text-right",children:"Tokens"}),e.jsx(c,{children:"Error"})]})}),e.jsx("tbody",{children:N.length?N.map(t=>e.jsxs("tr",{className:"cursor-pointer hover:bg-zinc-100 "+(String(j)===String(t.id)?"bg-zinc-200":""),onClick:()=>a(String(t.id)),children:[e.jsx(r,{className:"whitespace-nowrap text-xs text-zinc-600",children:p(t.started_at)}),e.jsx(r,{className:"whitespace-nowrap text-xs text-zinc-600",children:p(t.finished_at)}),e.jsx(r,{className:"font-mono text-xs",children:t.job_name}),e.jsx(r,{className:t.ok?"text-emerald-600":"text-red-600",children:t.ok?"OK":"FAIL"}),e.jsx(r,{className:"text-right",children:x(t.scanned)}),e.jsx(r,{className:"text-right",children:x(t.embedded)}),e.jsx(r,{className:"text-right",children:x(t.total_tokens)}),e.jsxs(r,{className:"max-w-[20rem] truncate text-xs text-zinc-600",children:[t.error_message??"—",t.error_message?e.jsx(v,{text:String(t.error_message),label:"Copy error",className:"ml-2 h-8 px-2 py-1 text-xs"}):null]})]},t.id)):e.jsx("tr",{children:e.jsx(r,{colSpan:8,className:"p-6",children:e.jsx(F,{title:"No logs",message:"No job logs yet for this range.",className:"border-0 bg-transparent p-0"})})})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx(u,{variant:"secondary",type:"button",className:"rounded-xl border border-zinc-200 bg-zinc-100 px-3 py-2 text-sm text-zinc-700 hover:bg-zinc-200 disabled:opacity-50",onClick:()=>{l(null),h([]),a(null)},disabled:!i&&o.length===0,children:"First page"}),e.jsx(u,{variant:"secondary",type:"button",className:"rounded-xl border border-zinc-200 bg-zinc-50 px-3 py-2 text-sm text-zinc-700 hover:bg-zinc-200",onClick:()=>{s(100),l(null),h([]),a(null)},children:"Reset defaults"}),e.jsxs("div",{className:"ml-auto text-xs text-zinc-500",children:["Applied: limit ",e.jsx("span",{className:"font-mono",children:n}),i?e.jsxs(e.Fragment,{children:[" ","· before ",e.jsx("span",{className:"font-mono",children:i})]}):null]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"secondary",type:"button",className:"rounded-xl border border-zinc-200 bg-zinc-100 px-3 py-2 text-sm text-zinc-700 hover:bg-zinc-200 disabled:opacity-50",onClick:()=>{const t=o[o.length-1]??null;h(b=>b.slice(0,-1)),l(t),a(null)},disabled:o.length===0,children:"Prev"}),e.jsx(u,{variant:"secondary",type:"button",className:"rounded-xl border border-zinc-200 bg-zinc-100 px-3 py-2 text-sm text-zinc-700 hover:bg-zinc-200 disabled:opacity-50",onClick:()=>{z&&(h(t=>[...t,i]),l(z),a(null))},disabled:!z,children:"Next"})]})]})]}),e.jsx(I,{open:!!f,row:f,onClose:()=>a(null)})]})}function I(n){if(d.useEffect(()=>{if(!n.open)return;const l=o=>{o.key==="Escape"&&n.onClose()};return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[n.open,n.onClose]),!n.open||!n.row)return null;const s=n.row,i=(()=>{try{return JSON.stringify(s.meta??{},null,2)}catch{return String(s.meta??"{}")}})();return e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:n.onClose}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full max-w-xl border-l border-zinc-200 bg-white p-5 shadow-xl",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight text-zinc-900",children:"Job run details"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-zinc-500 font-mono",children:[e.jsx("span",{children:s.id}),e.jsx(v,{text:String(s.id),label:"Copy id",className:"h-8 px-2 py-1 text-xs"})]})]}),e.jsx(u,{variant:"ghost",type:"button",className:"rounded-xl px-3 py-2 text-sm text-zinc-600 hover:bg-zinc-100",onClick:n.onClose,"aria-label":"Close",children:"Close"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Started"}),e.jsx("div",{className:"text-zinc-700",children:p(s.started_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Finished"}),e.jsx("div",{className:"text-zinc-700",children:p(s.finished_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Job"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:s.job_name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Status"}),e.jsx("div",{className:s.ok?"text-emerald-600":"text-red-600",children:s.ok?"OK":"FAIL"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Provider / Model"}),e.jsxs("div",{className:"text-zinc-700",children:[e.jsx("span",{className:"font-mono text-xs",children:s.provider??"—"}),e.jsx("span",{className:"text-zinc-600",children:" / "}),e.jsx("span",{className:"font-mono text-xs",children:s.model??"—"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Tokens"}),e.jsx("div",{className:"text-zinc-700",children:x(s.total_tokens)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Scanned"}),e.jsx("div",{className:"text-zinc-700",children:x(s.scanned)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Embedded"}),e.jsx("div",{className:"text-zinc-700",children:x(s.embedded)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Skipped existing"}),e.jsx("div",{className:"text-zinc-700",children:x(s.skipped_existing)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Error code"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:s.error_code??"—"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Error message"}),e.jsxs("div",{className:"mt-1 whitespace-pre-wrap break-words text-sm text-zinc-700",children:[s.error_message??"—",s.error_message?e.jsx(v,{text:String(s.error_message),label:"Copy error",className:"ml-2 h-8 px-2 py-1 text-xs"}):null]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Meta"}),e.jsx(v,{text:i,label:"Copy JSON",className:"h-8 px-2 py-1 text-xs"})]}),e.jsx("pre",{className:"mt-2 max-h-[38vh] overflow-auto rounded-2xl border border-zinc-200 bg-zinc-50 p-3 text-xs text-zinc-700",children:i})]})]})]})}export{R as default};
