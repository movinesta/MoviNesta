import{r as y,j as e,B as F,L as st,f as T,M as Cs,N as Os,O as As,P as Ms,Q as Ps,S as Rs,T as qs,G as Fs,U as Ds,I as Is}from"./index-CoY44SlW.js";import{u as _e,E as Te}from"./ErrorBox-CvgwTo6Q.js";import{u as ze}from"./useMutation-CglkDXYR.js";import{S as Z}from"./StatCard-Ct239vFi.js";import{C as E}from"./Card-DzyM45zw.js";import{C as de}from"./CopyButton-DdPzwO7I.js";import{H as U,g as Ls,S as Ts,a as Es}from"./settingsHints-DoMdsRQ3.js";import{I as fe}from"./Input-CFuN_OLj.js";import{T as G,a as h,b as p}from"./Table-BpO-pS4x.js";import{E as Ut}from"./EmptyState-DaHQMra1.js";import{R as Wt,X as Vt,Y as Ht,T as Yt,B as rt}from"./generateCategoricalChart-FnZw2e2y.js";import{B as Js}from"./BarChart-CZCNQIUn.js";import{L as Bs,a as $s}from"./LineChart-C8RWP0LD.js";function ce(s){return!!s&&typeof s=="object"&&!Array.isArray(s)}function es(s){const n=[];for(const v of s){const j=String(v??"").trim();j&&(n.includes(j)||n.push(j))}return n}function nt(s){return es(String(s??"").split(/\r?\n/).map(n=>n.trim()).filter(Boolean))}function lt(s){return Array.isArray(s)?s.map(n=>String(n??"").trim()).filter(Boolean).join(`
`):""}function Ks(s){return es(String(s??"").split(",").map(n=>n.trim()).filter(Boolean))}function Us(s){return Array.isArray(s)?s.map(n=>String(n??"").trim()).filter(Boolean).join(", "):""}function we(s){const n=Number(s);if(Number.isFinite(n))return n}function Zt(s){if(typeof s=="number"&&Number.isFinite(s))return s;if(typeof s=="string"){const n=Number(s);if(Number.isFinite(n))return n}if(ce(s)){const n={};for(const v of["p50","p75","p90","p99"]){const j=Number(s[v]);Number.isFinite(j)&&(n[v]=j)}return Object.keys(n).length?n:void 0}}function Qt(s){const n={};if(typeof s=="number"&&Number.isFinite(s))return{mode:"single",single:String(s),p:n};if(typeof s=="string"&&s.trim()){const v=Number(s);if(Number.isFinite(v))return{mode:"single",single:String(v),p:n}}if(ce(s)){for(const v of["p50","p75","p90","p99"]){const j=Number(s[v]);Number.isFinite(j)&&(n[v]=j)}return{mode:Object.keys(n).length?"percentiles":"single",single:"",p:n}}return{mode:"single",single:"",p:n}}function Ws(s){const n=y.useMemo(()=>ce(s.value)?s.value:{},[s.value]),v=y.useMemo(()=>{const o=Array.isArray(s.providerOptions)?s.providerOptions:[],O=new Map;for(const q of o){const B=String((q==null?void 0:q.slug)??"").trim();B&&(O.has(B)||O.set(B,{slug:B,name:(q==null?void 0:q.name)??null}))}return Array.from(O.values()).sort((q,B)=>q.slug.localeCompare(B.slug))},[s.providerOptions]),j=o=>{s.onChange({...n??{},...o})},k=(o,O)=>{const q={...n??{}};O==null||typeof O=="string"&&O.trim()===""?delete q[o]:q[o]=O,s.onChange(Object.keys(q).length?q:null)},J=Qt(n.preferred_min_throughput),R=Qt(n.preferred_max_latency),M=ce(n.max_price)?n.max_price:{};return e.jsxs("div",{className:s.className,children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Provider routing policy (OpenRouter)"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Sort"}),e.jsxs("select",{value:typeof n.sort=="string"?n.sort:ce(n.sort)?n.sort.by:"",onChange:o=>{const O=o.target.value;if(!O)return k("sort",void 0);const q=n.sort;if(ce(q)){const B=q.partition;k("sort",{by:O,...B?{partition:B}:{}})}else k("sort",O)},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"(default)"}),e.jsx("option",{value:"price",children:"Price"}),e.jsx("option",{value:"throughput",children:"Throughput"}),e.jsx("option",{value:"latency",children:"Latency"})]}),e.jsx("span",{className:"text-[11px] text-zinc-400",children:"Setting sort disables OpenRouter load balancing."})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Sort partition"}),e.jsxs("select",{value:ce(n.sort)?String(n.sort.partition??""):"",onChange:o=>{const O=o.target.value||void 0;n.sort&&(typeof n.sort=="string"?k("sort",{by:n.sort,...O?{partition:O}:{}}):k("sort",{...n.sort,...O?{partition:O}:{}}))},disabled:!n.sort,className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm disabled:opacity-50",children:[e.jsx("option",{value:"",children:"(none)"}),e.jsx("option",{value:"model",children:"Model"}),e.jsx("option",{value:"none",children:"None"})]}),e.jsx("span",{className:"text-[11px] text-zinc-400",children:'Use "model" if you use model fallbacks.'})]}),e.jsx("div",{className:"flex items-end justify-end gap-2",children:e.jsx(F,{variant:"secondary",onClick:()=>s.onChange(null),title:"Remove the provider policy section (OpenRouter defaults will apply)",children:"Clear"})})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider order (one per line)"}),e.jsx("textarea",{value:lt(n.order),onChange:o=>k("order",nt(o.target.value)),placeholder:v.slice(0,8).map(o=>o.slug).join(`
`),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono"}),e.jsx("span",{className:"text-[11px] text-zinc-400",children:"If set, OpenRouter tries providers in this order first."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Only allow (one per line)"}),e.jsx("textarea",{value:lt(n.only),onChange:o=>k("only",nt(o.target.value)),placeholder:"openai\\nanthropic\\n...",className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Ignore providers (one per line)"}),e.jsx("textarea",{value:lt(n.ignore),onChange:o=>k("ignore",nt(o.target.value)),placeholder:"together\\n...",className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono"})]})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!(n.allow_fallbacks??!0),onChange:o=>j({allow_fallbacks:o.target.checked})}),e.jsx("span",{children:"Allow fallbacks"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!(n.require_parameters??!1),onChange:o=>k("require_parameters",o.target.checked)}),e.jsx("span",{children:"Require parameters support"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!(n.zdr??!1),onChange:o=>k("zdr",o.target.checked)}),e.jsx("span",{children:"ZDR"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!(n.enforce_distillable_text??!1),onChange:o=>k("enforce_distillable_text",o.target.checked)}),e.jsx("span",{children:"Enforce distillable text"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Data collection"}),e.jsxs("select",{value:String(n.data_collection??""),onChange:o=>{const O=o.target.value;if(!O)return k("data_collection",void 0);k("data_collection",O==="deny"?"deny":"allow")},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"(default)"}),e.jsx("option",{value:"allow",children:"Allow"}),e.jsx("option",{value:"deny",children:"Deny"})]}),e.jsx("span",{className:"text-[11px] text-zinc-400",children:"If set to deny, OpenRouter filters providers by their policy."})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Quantizations (comma-separated)"}),e.jsx(fe,{value:Us(n.quantizations),onChange:o=>k("quantizations",Ks(o.target.value)),placeholder:"int8, fp16, bf16"}),e.jsx("span",{className:"text-[11px] text-zinc-400",children:"Optional preference; availability depends on the provider."})]})]}),e.jsxs("div",{className:"mt-3 rounded-lg border border-zinc-200 bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-[11px] font-semibold text-zinc-600",children:"Performance preferences"}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Preferred min throughput"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"throughput_mode",checked:J.mode==="single",onChange:()=>{const o=Zt(J.single);k("preferred_min_throughput",typeof o=="number"?o:void 0)}}),e.jsx("span",{children:"Single"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"throughput_mode",checked:J.mode==="percentiles",onChange:()=>k("preferred_min_throughput",{...J.p||{}})}),e.jsx("span",{children:"Percentiles"})]})]}),J.mode==="single"?e.jsxs("div",{className:"mt-2",children:[e.jsx(fe,{inputMode:"decimal",value:J.single,onChange:o=>k("preferred_min_throughput",we(o.target.value)),placeholder:"e.g. 50"}),e.jsx("div",{className:"mt-1 text-[11px] text-zinc-400",children:"Tokens/sec threshold (approx)."})]}):e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:["p50","p75","p90","p99"].map(o=>e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:o}),e.jsx(fe,{inputMode:"decimal",value:String(J.p[o]??""),onChange:O=>k("preferred_min_throughput",{...J.p||{},[o]:we(O.target.value)}),placeholder:"e.g. 50"})]},o))})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Preferred max latency"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"latency_mode",checked:R.mode==="single",onChange:()=>{const o=Zt(R.single);k("preferred_max_latency",typeof o=="number"?o:void 0)}}),e.jsx("span",{children:"Single"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"latency_mode",checked:R.mode==="percentiles",onChange:()=>k("preferred_max_latency",{...R.p||{}})}),e.jsx("span",{children:"Percentiles"})]})]}),R.mode==="single"?e.jsxs("div",{className:"mt-2",children:[e.jsx(fe,{inputMode:"decimal",value:R.single,onChange:o=>k("preferred_max_latency",we(o.target.value)),placeholder:"e.g. 2.5"}),e.jsx("div",{className:"mt-1 text-[11px] text-zinc-400",children:"Seconds threshold (approx)."})]}):e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:["p50","p75","p90","p99"].map(o=>e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:o}),e.jsx(fe,{inputMode:"decimal",value:String(R.p[o]??""),onChange:O=>k("preferred_max_latency",{...R.p||{},[o]:we(O.target.value)}),placeholder:"e.g. 2.5"})]},o))})]})]}),e.jsxs("div",{className:"mt-3 rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Max price (optional)"}),e.jsx("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-4",children:[["prompt","Prompt"],["completion","Completion"],["request","Request"],["image","Image"]].map(([o,O])=>e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:O}),e.jsx(fe,{inputMode:"decimal",value:String(M[o]??""),onChange:q=>{const B=we(q.target.value),g={...M};B===void 0?delete g[o]:g[o]=B,k("max_price",Object.keys(g).length?g:void 0)},placeholder:"e.g. 0.0005"})]},o))}),e.jsx("div",{className:"mt-1 text-[11px] text-zinc-400",children:"Values are in $/token for prompt/completion, $/request for request, and $/image for image."})]})]})]})}function Vs(s){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:s.children})}function Gt(s){return isFinite(s)?`${Math.round(s*100)}%`:"0%"}function le(s){if(!s)return"";const n=new Date(s);return isFinite(n.getTime())?n.toISOString().replace("T"," ").slice(0,16):String(s)}function Hs(s){var v,j;return s?Array.isArray(s)?s:(Array.isArray(s==null?void 0:s.data)?s.data:null)??(Array.isArray(s==null?void 0:s.endpoints)?s.endpoints:null)??(Array.isArray(s==null?void 0:s.items)?s.items:null)??(Array.isArray(s==null?void 0:s.entries)?s.entries:null)??(Array.isArray((v=s==null?void 0:s.data)==null?void 0:v.endpoints)?s.data.endpoints:null)??(Array.isArray((j=s==null?void 0:s.endpoints)==null?void 0:j.data)?s.endpoints.data:null)??[]:[]}function Ys(s){if(!s||typeof s!="object")return null;const n=s.provider??s.provider_name??s.providerName??null;if(typeof n=="string"&&n.trim())return n.trim();if(n&&typeof n=="object"){const j=n.slug??n.id??n.name??null;if(typeof j=="string"&&j.trim())return j.trim()}const v=s.name??s.provider_id??null;return typeof v=="string"&&v.trim()?v.trim():null}const ke=[{key:"temperature",label:"Temperature",type:"number",min:0,max:2,step:.05},{key:"top_p",label:"Top P",type:"number",min:0,max:1,step:.05},{key:"max_output_tokens",label:"Max output tokens",type:"number",min:1,max:32768,step:1},{key:"verbosity",label:"Verbosity",type:"text"},{key:"reasoning",label:"Reasoning (JSON)",type:"json"},{key:"native_tool_calling",label:"Native tool calling",type:"boolean"},{key:"native_tool_max_loops",label:"Native tool max loops",type:"number",min:1,max:12,step:1},{key:"native_tool_max_calls_per_loop",label:"Native tool max calls per loop",type:"number",min:1,max:20,step:1},{key:"presence_penalty",label:"Presence penalty",type:"number",min:-2,max:2,step:.1},{key:"frequency_penalty",label:"Frequency penalty",type:"number",min:-2,max:2,step:.1},{key:"seed",label:"Seed",type:"number",min:0,max:2e9,step:1},{key:"stop",label:"Stop sequences",type:"string-array"},{key:"logprobs",label:"Logprobs",type:"boolean"},{key:"top_logprobs",label:"Top logprobs",type:"number",min:0,max:20,step:1},{key:"parallel_tool_calls",label:"Parallel tool calls",type:"boolean"},{key:"stream",label:"Stream",type:"boolean"},{key:"stream_passthrough",label:"Stream passthrough (SSE)",type:"boolean"},{key:"timeout_ms",label:"Timeout (ms)",type:"number",min:1e3,max:12e4,step:1e3},{key:"user",label:"User",type:"text"},{key:"metadata",label:"Metadata (JSON)",type:"json"},{key:"tools",label:"Tools (JSON)",type:"json"},{key:"tool_choice",label:"Tool choice (JSON)",type:"json"},{key:"response_format",label:"Response format (JSON)",type:"json"},{key:"response_healing",label:"Response healing (plugin)",type:"boolean"},{key:"web_search",label:"Web search (plugin)",type:"boolean"},{key:"web_search_mode",label:"Web search mode (off/auto/always)",type:"text"},{key:"web_max_results",label:"Web search max results",type:"number",min:1,max:10,step:1},{key:"web_engine",label:"Web search engine (native/exa)",type:"text"},{key:"web_search_prompt",label:"Web search prompt",type:"text"},{key:"plugins",label:"Plugins (JSON)",type:"json"}],se=s=>s.split(`
`).map(n=>n.trim()).filter(Boolean),X=s=>Array.isArray(s)?s.join(`
`):"";function re(s){return!!s&&typeof s=="object"&&!Array.isArray(s)}function oe(s){return s===void 0?s:JSON.parse(JSON.stringify(s))}function x(s,n,v){let j=s;for(const k of n){if(!j||typeof j!="object")return v;j=j[k]}return j===void 0?v:j}function w(s,n,v){let j=s;for(let k=0;k<n.length-1;k++){const J=n[k];(!j[J]||typeof j[J]!="object")&&(j[J]={}),j=j[J]}j[n[n.length-1]]=v}function Ee(s){if(s===null)return"null";if(s===void 0)return"undefined";if(typeof s=="string")return s.length>120?`${s.slice(0,117)}…`:s;if(typeof s=="number"||typeof s=="boolean")return String(s);try{const n=JSON.stringify(s);return n.length>200?`${n.slice(0,197)}…`:n}catch{return String(s)}}function Je(s){return s===!0?"on":s===!1?"off":"auto"}function Be(s){if(s==="on")return!0;if(s==="off")return!1}function ts(s){if(!re(s))return{routing:null,decision:null};const n=re(s.routing)?s.routing:null,v=re(s.decision)?s.decision:null;return{routing:n,decision:v}}function Xt(s){if(!re(s))return null;const n=re(s.routing)?s.routing:null,v=n&&re(n.zdr)?n.zdr:null;return v||(re(s.zdr)?s.zdr:null)}function it(s,n,v=""){if(s===n)return[];const j=re(s),k=re(n);if(j&&k){const J=Array.from(new Set([...Object.keys(s),...Object.keys(n)])).sort(),R=[];for(const M of J){const o=v?`${v}.${M}`:M;R.push(...it(s[M],n[M],o))}return R}if(Array.isArray(s)&&Array.isArray(n)){const J=JSON.stringify(s),R=JSON.stringify(n);return J===R?[]:[{path:v||"(root)",a:s,b:n}]}return[{path:v||"(root)",a:s,b:n}]}function dr(){var Nt,yt,_t,zt;const[s,n]=y.useState(null),[v,j]=y.useState(null),[k,J]=y.useState(14),[R,M]=y.useState("metrics"),[o,O]=y.useState(14),[q,B]=y.useState(!1),[g,$]=y.useState(null),[at,Se]=y.useState(null),[ot,ss]=y.useState(!1),[ct,rs]=y.useState(!1),[$e,ns]=y.useState("Reply with exactly: OK"),[Ke,ls]=y.useState("fast"),[A,Ue]=y.useState(null),[dt,We]=y.useState(null),[Ve,is]=y.useState("Reply with exactly: OK"),[He,as]=y.useState("current"),[xt,os]=y.useState(!1),[_,Ye]=y.useState(null),[mt,Ze]=y.useState(null),[cs,ut]=y.useState(!1),[V,ds]=y.useState(null),[xs,pt]=y.useState(!1),[Y,ht]=y.useState(null),[Ce,ie]=y.useState(null),[ve,ms]=y.useState(50),[xe,us]=y.useState(""),[me,ps]=y.useState("assistant-chat-reply"),[ue,Oe]=y.useState(null),[Ae,Me]=y.useState([]),gt=()=>{pt(!1),ht(null)},Pe=_e({queryKey:["assistant-metrics",o],queryFn:()=>Rs({days:o}),enabled:R==="metrics"}),ae=_e({queryKey:["assistant-health"],queryFn:()=>qs(),enabled:R==="diagnostics",refetchInterval:15e3}),Ne=_e({queryKey:["assistant-settings"],queryFn:()=>Fs(),enabled:R==="settings"}),pe=_e({queryKey:["openrouter-request-log",{limit:ve,cursor:ue,requestId:xe,fn:me}],queryFn:()=>Ds({cursor:ue,limit:ve,request_id:xe.trim()||null,fn:me.trim()||null}),enabled:R==="diagnostics"}),Qe=_e({queryKey:["openrouter-endpoints",(g==null?void 0:g.openrouter_base_url)??null],queryFn:()=>{var l;return Is({base_url:((l=g==null?void 0:g.openrouter_base_url)==null?void 0:l.trim())||null})},enabled:R==="settings"}),Re=ze({mutationFn:l=>Cs(l),onSuccess:()=>{B(!1),Ne.refetch()}}),Ge=ze({mutationFn:l=>Os(l),onSuccess:l=>{We(null),Ue(l)},onError:l=>{Ue(null),We((l==null?void 0:l.message)??"Provider test failed")}}),Xe=ze({mutationFn:l=>As(l),onSuccess:l=>{Ze(null),Ye(l)},onError:l=>{Ye(null),Ze((l==null?void 0:l.message)??"Routing test failed")}}),he=ze({mutationFn:l=>Ms(l??null),onSuccess:(l,i)=>{var N;j(null);const u=Number((l==null?void 0:l.affected)??((N=l==null?void 0:l.data)==null?void 0:N.affected)??0),d=i&&String(i).trim()?String(i).trim():"all models";n(`Circuit reset: ${d} (${u} row${u===1?"":"s"})`),ae.refetch()},onError:l=>{n(null),j((l==null?void 0:l.message)??"Failed to reset circuit")}}),ye=ze({mutationFn:l=>Ps({keep_days:l}),onSuccess:l=>{var d,N;j(null);const i=Number((l==null?void 0:l.deleted)??((d=l==null?void 0:l.data)==null?void 0:d.deleted)??0),u=Number((l==null?void 0:l.keep_days)??((N=l==null?void 0:l.data)==null?void 0:N.keep_days)??14);n(`Circuit history cleaned: deleted ${i} row${i===1?"":"s"} (kept ${u}d)`),ae.refetch()},onError:l=>{n(null),j((l==null?void 0:l.message)??"Failed to cleanup circuit history")}}),D=Pe.data,hs=y.useMemo(()=>((D==null?void 0:D.series)??[]).map(l=>({...l,day:String(l.day).slice(5)})),[D]),gs=y.useMemo(()=>((D==null?void 0:D.trigger_series)??[]).map(l=>({...l,day:String(l.day).slice(5)})),[D]),bs=(D==null?void 0:D.by_surface_kind)??[],js=(D==null?void 0:D.triggers)??[],c=ae.data,ge=Ne.data,S=ge==null?void 0:ge.assistant_settings,W=(Nt=ge==null?void 0:ge.defaults)==null?void 0:Nt.settings,be=((yt=pe.data)==null?void 0:yt.rows)??[],et=((_t=pe.data)==null?void 0:_t.next_cursor)??null,ne=Qe.data,bt=Array.isArray(ne==null?void 0:ne.zdr_endpoints)?ne.zdr_endpoints:[],fs=y.useMemo(()=>{const l=(ne==null?void 0:ne.payload)??null,i=Hs(l),u=new Map;for(const d of i){const N=Ys(d);if(!N)continue;let I=null;const Q=d.provider??d.provider_name??null;if(Q&&typeof Q=="object"){const ee=Q.name??Q.display_name??null;typeof ee=="string"&&ee.trim()&&(I=ee.trim())}!I&&typeof d.provider_name=="string"&&d.provider_name.trim()&&(I=String(d.provider_name).trim()),u.has(N)||u.set(N,{slug:N,name:I})}return Array.from(u.values()).sort((d,N)=>d.slug.localeCompare(N.slug))},[ne]),qe=y.useMemo(()=>be.find(l=>String(l.id)===String(Ce))??null,[be,Ce]),je=y.useMemo(()=>{let l=0,i=0,u=0,d=0;for(const N of be){const I=Xt(N.meta);I&&(I.requested&&(l+=1),I.used&&(i+=1),I.requested&&!I.used&&(d+=1),I.sensitive&&(u+=1))}return{requested:l,used:i,fallback:d,sensitive:u}},[be]),C=(W==null?void 0:W.behavior)??{},f=y.useMemo(()=>{const l=((g==null?void 0:g.behavior_json)??"").trim();if(!l)return{ok:!0,value:oe(C)};try{return{ok:!0,value:JSON.parse(l)}}catch(i){return{ok:!1,value:oe(C),error:String((i==null?void 0:i.message)??i)}}},[g==null?void 0:g.behavior_json,C]),z=l=>{$(i=>{if(!i)return i;const u=(i.behavior_json??"").trim();let d;try{d=u?JSON.parse(u):oe(C)}catch{return i}const N=oe(d);return l(N),{...i,behavior_json:JSON.stringify(N,null,2)}})},vs={"assistant_settings.openrouter_base_url":"field-openrouter_base_url","assistant_settings.default_instructions":"field-default_instructions","assistant_settings.model_fast":"field-model_fast","assistant_settings.model_creative":"field-model_creative","assistant_settings.model_planner":"field-model_planner","assistant_settings.model_maker":"field-model_maker","assistant_settings.model_critic":"field-model_critic","assistant_settings.fallback_models":"field-fallback_models","assistant_settings.model_catalog":"field-model_catalog","assistant_settings.params.timeout_ms":"field-param-timeout_ms","assistant_settings.params.stream_passthrough":"field-param-stream_passthrough","assistant_settings.params.response_healing":"field-param-response_healing","assistant_settings.params.web_search":"field-param-web_search","assistant_settings.params.web_search_mode":"field-param-web_search_mode","assistant_settings.params.web_max_results":"field-param-web_max_results","assistant_settings.params.web_engine":"field-param-web_engine","assistant_settings.params.web_search_prompt":"field-param-web_search_prompt","behavior.diagnostics.user_error_detail":"field-behavior-user_error_detail","behavior.diagnostics.user_error_show_culprit_var":"field-behavior-user_error_show_culprit_var","behavior.diagnostics.user_error_show_culprit_value":"field-behavior-user_error_show_culprit_value","behavior.diagnostics.user_error_show_status_model":"field-behavior-user_error_show_status_model","behavior.diagnostics.user_error_show_trace_ids":"field-behavior-user_error_show_trace_ids","behavior.router.zdr.enabled":"field-zdr-enabled","behavior.router.zdr.mode":"field-zdr-mode","behavior.router.zdr.allow_fallback":"field-zdr-allow-fallback","behavior.router.zdr.base_url":"field-zdr-base-url","assistant_settings.test_provider":"field-provider_test"},Ns=l=>{const i=vs[l];if(!i)return;const u=document.getElementById(i);if(u)try{u.scrollIntoView({behavior:"smooth",block:"center"})}catch{u.scrollIntoView()}},L=(l,i)=>{ds(l),ut(!0),i!=null&&i.scroll&&(M("settings"),setTimeout(()=>Ns(l),50))},ys=(l,i)=>{const u=ke.find(d=>d.key===l);if(!u)return i;if(u.type==="number"){const d=Number(i);return i===""?null:Number.isFinite(d)?d:i}if(u.type==="boolean")return i===""?null:i==="true"?!0:i==="false"?!1:i;if(u.type==="string-array")return i===""?[]:se(i);if(u.type==="json"){if(!i.trim())return null;try{return JSON.parse(i)}catch{return i}}return i},tt=(l,i)=>{var I,Q,ee;const u=S??{},d=W??{},N=g??{};if(l.startsWith("assistant_settings.params.")){const K=l.replace("assistant_settings.params.","");return i==="effective"?(I=u==null?void 0:u.params)==null?void 0:I[K]:i==="default"?(Q=d==null?void 0:d.params)==null?void 0:Q[K]:ys(K,String(((ee=N==null?void 0:N.params)==null?void 0:ee[K])??""))}if(l.startsWith("assistant_settings.")){const K=l.replace("assistant_settings.","");return K==="fallback_models"||K==="model_catalog"?i==="effective"?(u==null?void 0:u[K])??[]:i==="default"?(d==null?void 0:d[K])??[]:(N==null?void 0:N[K])??[]:i==="effective"?u==null?void 0:u[K]:i==="default"?d==null?void 0:d[K]:N==null?void 0:N[K]}if(l.startsWith("behavior.")){const K=l.replace("behavior.","").split(".");return x(i==="effective"?(u==null?void 0:u.behavior)??(d==null?void 0:d.behavior)??{}:i==="default"?(d==null?void 0:d.behavior)??{}:f.value??{},K,void 0)}},_s=(l,i)=>{if(g){if(l.startsWith("assistant_settings.params.")){const u=l.replace("assistant_settings.params.","");$(d=>{if(!d)return d;const N=ke.find(Q=>Q.key===u);let I="";return(N==null?void 0:N.type)==="json"?I=i==null?"":JSON.stringify(i,null,2):(N==null?void 0:N.type)==="string-array"?I=Array.isArray(i)?i.join(`
`):String(i??""):I=i==null?"":String(i),{...d,params:{...d.params,[u]:I}}});return}if(l.startsWith("assistant_settings.")){const u=l.replace("assistant_settings.","");$(d=>d&&{...d,[u]:i});return}if(l.startsWith("behavior.")){const u=l.replace("behavior.","").split(".");z(d=>w(d,u,i));return}}},Fe=y.useMemo(()=>it(C??{},f.value??{}),[C,f.value]),De=y.useMemo(()=>{const l={rate_limit:(C??{}).rate_limit,orchestrator:(C??{}).orchestrator,router:(C??{}).router},i={rate_limit:(f.value??{}).rate_limit,orchestrator:(f.value??{}).orchestrator,router:(f.value??{}).router};return it(l,i)},[C,f.value]);y.useEffect(()=>{if(!S||q)return;const l=u=>{var N,I;const d=((N=S==null?void 0:S.params)==null?void 0:N[u])??((I=W==null?void 0:W.params)==null?void 0:I[u]);return d==null?"":Array.isArray(d)?d.join(`
`):typeof d=="object"?JSON.stringify(d,null,2):String(d)},i={};ke.forEach(u=>{i[u.key]=l(u.key)}),$({openrouter_base_url:(S==null?void 0:S.openrouter_base_url)??"",model_fast:(S==null?void 0:S.model_fast)??"",model_creative:(S==null?void 0:S.model_creative)??"",model_planner:(S==null?void 0:S.model_planner)??"",model_maker:(S==null?void 0:S.model_maker)??"",model_critic:(S==null?void 0:S.model_critic)??"",fallback_models:(S==null?void 0:S.fallback_models)??[],model_catalog:(S==null?void 0:S.model_catalog)??(W==null?void 0:W.model_catalog)??[],default_instructions:(S==null?void 0:S.default_instructions)??"",behavior_json:JSON.stringify((S==null?void 0:S.behavior)??(W==null?void 0:W.behavior)??{},null,2),params:i}),B(!0)},[S,W,q]),y.useEffect(()=>{Ce&&(qe||ie(null))},[Ce,qe]),y.useEffect(()=>{Oe(null),Me([]),ie(null)},[ve,me,xe]);function jt(l){const i=Math.max(0,Math.floor(Number(l)||0)),u=Math.floor(i/60),d=i%60;if(u<=0)return`${d}s`;const N=Math.floor(u/60),I=u%60;return N<=0?`${u}m ${d}s`:`${N}h ${I}m`}const zs=(()=>{var l,i,u,d,N,I,Q,ee,K,wt,kt,St,Ct,Ot,At,Mt,Pt,Rt,qt,Ft,Dt,It,Lt,Tt,Et,Jt,Bt,$t,Kt;return R==="metrics"?Pe.isLoading?e.jsx(st,{}):Pe.isError?e.jsx(Te,{error:Pe.error}):D?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsx(Z,{title:"Suggestions (created)",value:T(((l=D==null?void 0:D.totals)==null?void 0:l.created)??0)}),e.jsx(Z,{title:"Accepted",value:T(((i=D==null?void 0:D.totals)==null?void 0:i.accepted)??0)}),e.jsx(Z,{title:"Accept rate",value:Gt(Number(((u=D==null?void 0:D.totals)==null?void 0:u.acceptRate)??0))}),e.jsx(Z,{title:"Tokens (est.)",value:T(((d=D==null?void 0:D.totals)==null?void 0:d.tokens)??0)})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Suggestions over time"}),e.jsx("div",{className:"h-72",children:e.jsx(Wt,{width:"100%",height:"100%",children:e.jsxs(Js,{data:hs,children:[e.jsx(Vt,{dataKey:"day"}),e.jsx(Ht,{}),e.jsx(Yt,{}),e.jsx(rt,{dataKey:"created"}),e.jsx(rt,{dataKey:"accepted"}),e.jsx(rt,{dataKey:"dismissed"})]})})}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["If this chart stays empty, run the rollup once: call edge function ",e.jsx("code",{children:"assistant-metrics-rollup"}),"."]})]}),e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Trigger fires over time"}),e.jsx("div",{className:"h-72",children:e.jsx(Wt,{width:"100%",height:"100%",children:e.jsxs(Bs,{data:gs,children:[e.jsx(Vt,{dataKey:"day"}),e.jsx(Ht,{}),e.jsx(Yt,{}),e.jsx($s,{dataKey:"fires"})]})})}),e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"Top triggers are shown below."})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"By surface + kind"}),e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Day"}),e.jsx(h,{children:"Surface"}),e.jsx(h,{children:"Kind"}),e.jsx(h,{className:"text-right",children:"Created"}),e.jsx(h,{className:"text-right",children:"Accepted"}),e.jsx(h,{className:"text-right",children:"Dismissed"}),e.jsx(h,{className:"text-right",children:"Rate"})]})}),e.jsx("tbody",{children:bs.slice(0,150).map((t,r)=>{const m=Number(t.created_count??0),a=Number(t.accepted_count??0),P=m?a/m:0;return e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{children:String(t.day).slice(5)}),e.jsx(p,{children:t.surface}),e.jsx(p,{children:t.kind}),e.jsx(p,{className:"text-right",children:T(m)}),e.jsx(p,{className:"text-right",children:T(a)}),e.jsx(p,{className:"text-right",children:T(Number(t.dismissed_count??0))}),e.jsx(p,{className:"text-right",children:Gt(P)})]},r)})})]})]}),e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Top triggers"}),e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Trigger"}),e.jsx(h,{className:"text-right",children:"Fires"}),e.jsx(h,{className:"text-right",children:"Users"})]})}),e.jsx("tbody",{children:js.map((t,r)=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{children:t.name}),e.jsx(p,{className:"text-right",children:T(Number(t.fires??0))}),e.jsx(p,{className:"text-right",children:T(Number(t.unique_users??0))})]},r))})]}),e.jsxs("div",{className:"mt-3 text-xs text-zinc-500",children:["Tip: You can disable noisy triggers by setting ",e.jsx("code",{children:"assistant_triggers.enabled = false"}),"."]})]})]})]}):e.jsx(Ut,{title:"No metrics yet",message:"No assistant metrics were returned."}):R==="diagnostics"?ae.isLoading?e.jsx(st,{}):ae.isError?e.jsx(Te,{error:ae.error}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Snapshot: ",le(c==null?void 0:c.ts)]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsx(Z,{title:"Pending",value:T(Number(((N=c==null?void 0:c.counts)==null?void 0:N.pending)??0))}),e.jsx(Z,{title:"Processing",value:T(Number(((I=c==null?void 0:c.counts)==null?void 0:I.processing)??0))}),e.jsx(Z,{title:"Failed",value:T(Number(((Q=c==null?void 0:c.counts)==null?void 0:Q.failed)??0))}),e.jsx(Z,{title:"Done",value:T(Number(((ee=c==null?void 0:c.counts)==null?void 0:ee.done)??0))})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Queue age"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Z,{title:"Oldest pending",value:jt(Number((c==null?void 0:c.oldestPendingSec)??0))}),e.jsx(Z,{title:"Oldest processing",value:jt(Number((c==null?void 0:c.oldestProcessingSec)??0))})]}),e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"If queue age keeps growing, check runner health and rate limits."})]}),e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Last 24h"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(Z,{title:"Created",value:T(Number(((K=c==null?void 0:c.last24h)==null?void 0:K.created)??0))}),e.jsx(Z,{title:"Done",value:T(Number(((wt=c==null?void 0:c.last24h)==null?void 0:wt.done)??0))}),e.jsx(Z,{title:"Failed",value:T(Number(((kt=c==null?void 0:c.last24h)==null?void 0:kt.failed)??0))})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Jobs by kind"}),e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Kind"}),e.jsx(h,{className:"text-right",children:"Pending"}),e.jsx(h,{className:"text-right",children:"Processing"}),e.jsx(h,{className:"text-right",children:"Failed"}),e.jsx(h,{className:"text-right",children:"Done"}),e.jsx(h,{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:Object.entries((c==null?void 0:c.byKind)??{}).map(([t,r])=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{children:t}),e.jsx(p,{className:"text-right",children:T(Number((r==null?void 0:r.pending)??0))}),e.jsx(p,{className:"text-right",children:T(Number((r==null?void 0:r.processing)??0))}),e.jsx(p,{className:"text-right",children:T(Number((r==null?void 0:r.failed)??0))}),e.jsx(p,{className:"text-right",children:T(Number((r==null?void 0:r.done)??0))}),e.jsx(p,{className:"text-right",children:T(Number((r==null?void 0:r.total)??0))})]},t))})]})]}),e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Recent cron invocations"}),e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"When"}),e.jsx(h,{children:"Job"}),e.jsx(h,{children:"Request ID"})]})}),e.jsx("tbody",{children:((c==null?void 0:c.recentCron)??[]).map(t=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{children:le(t.createdAt)}),e.jsx(p,{children:t.job}),e.jsx(p,{className:"font-mono text-xs",children:t.requestId??""})]},t.id))})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Recent failures"}),e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"When"}),e.jsx(h,{children:"Kind"}),e.jsx(h,{children:"Conversation"}),e.jsx(h,{className:"text-right",children:"Attempts"}),e.jsx(h,{children:"Error"})]})}),e.jsx("tbody",{children:((c==null?void 0:c.recentFailures)??[]).map(t=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{children:le(t.updatedAt)}),e.jsx(p,{children:t.jobKind}),e.jsx(p,{className:"font-mono text-xs",children:t.conversationId}),e.jsx(p,{className:"text-right",children:T(Number(t.attempts??0))}),e.jsx(p,{className:"max-w-[520px] truncate",title:t.lastError,children:t.lastError})]},t.id))})]}),((c==null?void 0:c.recentFailures)??[]).length===0?e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"No recent failures."}):null]})}),e.jsx("div",{className:"mt-6",children:e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Recent AI provider errors"}),e.jsx("div",{className:"text-xs text-zinc-500",children:'Captures OpenRouter/provider issues even when we return a user-facing fallback message (jobs may still be "done").'}),e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"When"}),e.jsx(h,{children:"Code"}),e.jsx(h,{children:"Culprit"}),e.jsx(h,{children:"Reason"}),e.jsx(h,{children:"Request"})]})}),e.jsx("tbody",{children:((c==null?void 0:c.recentAiFailures)??[]).map(t=>{var r,m;return e.jsxs("tr",{className:"border-t border-zinc-100 cursor-pointer hover:bg-zinc-50",onClick:()=>{ht(t),pt(!0)},children:[e.jsx(p,{children:le(t.createdAt)}),e.jsx(p,{className:"font-mono text-xs",children:t.code}),e.jsx(p,{className:"font-mono text-xs",title:((r=t.culprit)==null?void 0:r.value_preview)??"",children:((m=t.culprit)==null?void 0:m.var)??"—"}),e.jsx(p,{className:"max-w-[520px] truncate",title:t.reason,children:t.reason}),e.jsx(p,{className:"font-mono text-xs",children:t.requestId??""})]},t.id)})})]}),((c==null?void 0:c.recentAiFailures)??[]).length===0?e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"No recent AI provider errors."}):null]})}),(((Ct=(St=c==null?void 0:c.aiFailureRollup)==null?void 0:St.codes)==null?void 0:Ct.length)??0)>0||(((At=(Ot=c==null?void 0:c.aiFailureRollup)==null?void 0:Ot.models)==null?void 0:At.length)??0)>0?e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"AI error rollup (72h)"}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["Top error codes captured by ",e.jsx("code",{children:"assistant_failures"}),"."]}),e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Code"}),e.jsx(h,{className:"text-right",children:"Count"})]})}),e.jsx("tbody",{children:(((Mt=c==null?void 0:c.aiFailureRollup)==null?void 0:Mt.codes)??[]).map(t=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{className:"font-mono text-xs",children:t.code}),e.jsx(p,{className:"text-right",children:T(Number(t.count??0))})]},t.code))})]})]}),e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Most affected models (72h)"}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["Derived from ",e.jsx("code",{children:"assistant_failures.details.ai.context.model"}),"."]}),e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Model"}),e.jsx(h,{className:"text-right",children:"Count"})]})}),e.jsx("tbody",{children:(((Pt=c==null?void 0:c.aiFailureRollup)==null?void 0:Pt.models)??[]).map(t=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{className:"font-mono text-xs",children:t.model}),e.jsx(p,{className:"text-right",children:T(Number(t.count??0))})]},`${t.model}`))})]})]})]}):null,((c==null?void 0:c.openrouterCircuits)??[]).length?e.jsx("div",{className:"mt-6",children:e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"OpenRouter circuits (currently skipped models)"}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Models listed here are temporarily skipped by the Edge Functions circuit breaker to reduce repeated 429/5xx storms."}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx(F,{variant:"secondary",onClick:()=>{n(null),j(null),he.mutate(null)},disabled:he.isPending||ye.isPending,children:"Reset all"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Keep"}),e.jsx("input",{type:"number",min:1,max:365,value:String(k),onChange:t=>{const r=Number(t.target.value);Number.isFinite(r)&&J(Math.max(1,Math.min(365,Math.trunc(r))))},className:"w-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm"}),e.jsx("span",{className:"text-[11px] text-zinc-500",children:"days"})]}),e.jsx(F,{variant:"ghost",onClick:()=>{n(null),j(null),ye.mutate(k)},disabled:he.isPending||ye.isPending,children:"Cleanup history"}),he.isPending||ye.isPending?e.jsx("span",{className:"text-xs text-zinc-500",children:"Working…"}):null]}),s?e.jsx("div",{className:"mt-2 text-xs text-zinc-700",children:s}):null,v?e.jsx("div",{className:"mt-2 text-xs text-red-600",children:v}):null,e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Model"}),e.jsx(h,{children:"Open until"}),e.jsx(h,{className:"text-right",children:"Streak"}),e.jsx(h,{className:"text-right",children:"Status"}),e.jsx(h,{children:"Last error"}),e.jsx(h,{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:((c==null?void 0:c.openrouterCircuits)??[]).map(t=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{className:"font-mono text-xs",children:t.model}),e.jsx(p,{children:le(t.openUntil)}),e.jsx(p,{className:"text-right",children:T(Number(t.failureStreak??0))}),e.jsx(p,{className:"text-right",children:t.lastStatus??""}),e.jsx(p,{className:"max-w-[520px] truncate",title:t.lastError??"",children:t.lastError??""}),e.jsx(p,{className:"text-right",children:e.jsx(F,{variant:"ghost",onClick:()=>{n(null),j(null),he.mutate(String(t.model))},disabled:he.isPending||ye.isPending,children:"Reset"})})]},t.model))})]})]})}):null,e.jsx("div",{className:"mt-6",children:e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Routing decision log"}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Recent OpenRouter requests with routing policy details (per request ID)."}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-end gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Rows"}),e.jsx("input",{type:"number",min:10,max:200,value:String(ve),onChange:t=>{const r=t.target.value;if(!r)return;const m=Number(r);Number.isFinite(m)&&ms(Math.max(10,Math.min(200,Math.trunc(m))))},className:"w-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Function"}),e.jsxs("select",{value:me,onChange:t=>ps(t.target.value),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"assistant-chat-reply",children:"assistant-chat-reply"}),e.jsx("option",{value:"assistant-orchestrator",children:"assistant-orchestrator"}),e.jsx("option",{value:"admin-assistant-settings",children:"admin-assistant-settings"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Request ID"}),e.jsx("input",{value:xe,onChange:t=>us(t.target.value),placeholder:"req_...",className:"w-64 rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]}),e.jsx(F,{type:"button",variant:"secondary",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs",onClick:()=>pe.refetch(),children:"Refresh"})]}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["ZDR coverage:"," ",e.jsx("span",{className:"font-mono",children:je.used})," /"," ",e.jsx("span",{className:"font-mono",children:je.requested})," requested",je.fallback?e.jsxs(e.Fragment,{children:[" ","· fallback ",e.jsx("span",{className:"font-mono",children:je.fallback})]}):null,je.sensitive?e.jsxs(e.Fragment,{children:[" ","· sensitive ",e.jsx("span",{className:"font-mono",children:je.sensitive})]}):null]}),pe.isLoading?e.jsx("div",{className:"mt-3 text-xs text-zinc-500",children:"Loading routing logs…"}):pe.isError?e.jsx("div",{className:"mt-3",children:e.jsx(Te,{error:pe.error})}):e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"When"}),e.jsx(h,{children:"Request ID"}),e.jsx(h,{children:"Mode"}),e.jsx(h,{children:"Model"}),e.jsx(h,{children:"Variant"}),e.jsx(h,{children:"ZDR"}),e.jsx(h,{children:"Provider"}),e.jsx(h,{children:"Function"})]})}),e.jsx("tbody",{children:be.length?be.map(t=>{var te;const{routing:r,decision:m}=ts(t.meta),a=String(((te=r==null?void 0:r.policy)==null?void 0:te.mode)??"—"),P=String((m==null?void 0:m.provider)??t.provider??"—"),b=Xt(t.meta),H=b!=null&&b.used?"used":b!=null&&b.requested?"miss":"—";return e.jsxs("tr",{className:"border-t border-zinc-100 cursor-pointer hover:bg-zinc-50",onClick:()=>ie(String(t.id)),children:[e.jsx(p,{children:le(t.created_at)}),e.jsx(p,{className:"font-mono text-xs",children:t.request_id??"—"}),e.jsx(p,{className:"font-mono text-xs",children:a}),e.jsx(p,{className:"font-mono text-xs",children:t.model??"—"}),e.jsx(p,{className:"font-mono text-xs",children:t.variant??"—"}),e.jsx(p,{className:"font-mono text-xs",children:H}),e.jsx(p,{className:"font-mono text-xs",children:P}),e.jsx(p,{className:"font-mono text-xs",children:t.fn})]},t.id)}):e.jsx("tr",{children:e.jsx(p,{colSpan:8,className:"p-6",children:e.jsx(Ut,{title:"No routing logs",message:"No OpenRouter request logs match this filter.",className:"border-0 bg-transparent p-0"})})})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between gap-2",children:[e.jsx(F,{type:"button",variant:"secondary",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs disabled:opacity-50",onClick:()=>{Oe(null),Me([]),ie(null)},disabled:!ue&&Ae.length===0,children:"First page"}),e.jsxs("div",{className:"ml-auto text-[11px] text-zinc-500",children:["Applied: limit ",e.jsx("span",{className:"font-mono",children:ve}),me.trim()?e.jsxs(e.Fragment,{children:[" ","· fn ",e.jsx("span",{className:"font-mono",children:me.trim()})]}):null,xe.trim()?e.jsxs(e.Fragment,{children:[" ","· request ",e.jsx("span",{className:"font-mono",children:xe.trim()})]}):null,ue?e.jsxs(e.Fragment,{children:[" ","· cursor ",e.jsx("span",{className:"font-mono",children:ue})]}):null]}),e.jsx(F,{type:"button",variant:"secondary",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs disabled:opacity-50",onClick:()=>{const t=Ae[Ae.length-1]??null;Me(r=>r.slice(0,-1)),Oe(t),ie(null)},disabled:Ae.length===0,children:"Prev"}),e.jsx(F,{type:"button",variant:"secondary",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs disabled:opacity-50",onClick:()=>{et&&(Me(t=>[...t,ue]),Oe(et),ie(null))},disabled:!et,children:"Next"})]})]})]})})]}):e.jsx("div",{className:"mt-4",children:Ne.isLoading||!g?e.jsx(st,{}):Ne.isError?e.jsx(Te,{error:Ne.error}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(E,{children:[e.jsxs("div",{id:"field-openrouter_base_url",className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold",children:"OpenRouter base URL"}),e.jsx(U,{title:"Details",onClick:()=>L("assistant_settings.openrouter_base_url")})]}),e.jsx("input",{value:g.openrouter_base_url,onChange:t=>$(r=>r&&{...r,openrouter_base_url:t.target.value}),placeholder:"https://openrouter.ai/api/v1",className:"w-full rounded-lg border border-zinc-200 px-3 py-2 text-sm"}),e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"Leave blank to use the environment default."})]}),e.jsxs(E,{children:[e.jsxs("div",{id:"field-default_instructions",className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Default instructions"}),e.jsx(U,{title:"Details",onClick:()=>L("assistant_settings.default_instructions")})]}),e.jsx("textarea",{value:g.default_instructions,onChange:t=>$(r=>r&&{...r,default_instructions:t.target.value}),placeholder:"Optional system instructions applied to every call.",className:"h-28 w-full rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(E,{children:[e.jsxs("div",{id:"field-provider_test",className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Provider test (OpenRouter)"}),e.jsx(U,{title:"Details",onClick:()=>L("assistant_settings.test_provider")})]}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Runs a tiny request using the current Assistant settings. This helps you see the exact failure reason (and the culprit variable) before users hit the error."}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-5",children:[e.jsxs("label",{className:"flex flex-col gap-1 md:col-span-1",children:[e.jsx("span",{className:"text-xs font-semibold text-zinc-600",children:"Model role"}),e.jsxs("select",{value:Ke,onChange:t=>ls(t.target.value),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"fast",children:"Fast"}),e.jsx("option",{value:"creative",children:"Creative"}),e.jsx("option",{value:"planner",children:"Planner"}),e.jsx("option",{value:"maker",children:"Maker"}),e.jsx("option",{value:"critic",children:"Critic"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1 md:col-span-3",children:[e.jsx("span",{className:"text-xs font-semibold text-zinc-600",children:"Prompt"}),e.jsx("input",{value:$e,onChange:t=>ns(t.target.value),placeholder:"Reply with exactly: OK",className:"w-full rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]}),e.jsx("div",{className:"flex items-end md:col-span-1",children:e.jsx(F,{type:"button",className:"w-full rounded-xl bg-zinc-900 px-4 py-2 text-sm text-white",disabled:Ge.isPending,onClick:async()=>{We(null),Ue(null);try{await Ge.mutateAsync({prompt:$e,model_key:Ke})}catch{}},children:Ge.isPending?"Running…":"Run test"})})]}),dt?e.jsx("div",{className:"mt-3 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-800",children:dt}):null,A?e.jsxs("div",{className:"mt-3 rounded-xl border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:(Rt=A==null?void 0:A.test)!=null&&Rt.ok?"✅ Test ok":"⚠ Test failed"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"text-xs text-zinc-500 font-mono",children:A!=null&&A.requestId?`req ${A.requestId}`:""}),e.jsx(de,{label:"Copy debug bundle",className:"rounded-lg border border-zinc-200 bg-white px-2 py-1 text-xs",text:JSON.stringify({requestId:(A==null?void 0:A.requestId)??null,test:(A==null?void 0:A.test)??null,selected:{model_key:Ke,prompt:$e,base_url:(g==null?void 0:g.openrouter_base_url)??null}},null,2)})]})]}),(qt=A==null?void 0:A.test)!=null&&qt.ok?e.jsxs("div",{className:"mt-2 text-sm text-zinc-700",children:["Used model: ",e.jsx("span",{className:"font-mono text-xs",children:A.test.usedModel??""}),typeof A.test.durationMs=="number"?e.jsxs("span",{className:"ml-2 text-xs text-zinc-500",children:["(",A.test.durationMs,"ms)"]}):null,A.test.contentPreview?e.jsx("div",{className:"mt-2 rounded-lg border border-zinc-200 bg-zinc-50 p-2 font-mono text-xs",children:A.test.contentPreview}):null]}):e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("div",{className:"text-sm text-zinc-800",children:((Ft=A==null?void 0:A.test)==null?void 0:Ft.userMessage)??"Provider test failed."}),(Dt=A==null?void 0:A.test)!=null&&Dt.envelope?e.jsxs("div",{className:"text-xs text-zinc-500",children:["Code: ",e.jsx("span",{className:"font-mono",children:A.test.envelope.code}),(It=A.test.culprit)!=null&&It.var?e.jsxs("span",{className:"ml-2",children:["Culprit: ",e.jsx("span",{className:"font-mono",children:A.test.culprit.var})]}):null,(Lt=A.test.culprit)!=null&&Lt.var?e.jsx(F,{type:"button",variant:"ghost",className:"ml-2 rounded-lg border border-zinc-200 bg-white px-2 py-1 text-[11px]",onClick:()=>L(String(A.test.culprit.var),{scroll:!0}),children:"Open culprit"}):null]}):null]})]}):null]})}),e.jsx("div",{className:"mt-4",children:e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 flex items-center justify-between gap-2",children:e.jsx("div",{className:"text-sm font-semibold",children:"Routing policy test"})}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Runs a tiny request using the current routing policy and captures the selected model/provider/variant."}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-5",children:[e.jsxs("label",{className:"flex flex-col gap-1 md:col-span-1",children:[e.jsx("span",{className:"text-xs font-semibold text-zinc-600",children:"Policy mode"}),e.jsxs("select",{value:He,onChange:t=>as(t.target.value),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"current",children:"Use saved policy"}),e.jsx("option",{value:"auto",children:"Force auto"}),e.jsx("option",{value:"fallback",children:"Force fallback"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1 md:col-span-3",children:[e.jsx("span",{className:"text-xs font-semibold text-zinc-600",children:"Prompt"}),e.jsx("input",{value:Ve,onChange:t=>is(t.target.value),placeholder:"Reply with exactly: OK",className:"w-full rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]}),e.jsx("div",{className:"flex items-end md:col-span-1",children:e.jsx(F,{type:"button",className:"w-full rounded-xl bg-zinc-900 px-4 py-2 text-sm text-white",disabled:Xe.isPending,onClick:async()=>{Ze(null),Ye(null);try{await Xe.mutateAsync({prompt:Ve,mode:He,simulate_advanced_params:xt})}catch{}},children:Xe.isPending?"Running…":"Run test"})})]}),e.jsxs("label",{className:"mt-3 flex items-center gap-2 text-xs text-zinc-600",children:[e.jsx("input",{type:"checkbox",checked:xt,onChange:t=>os(t.target.checked)}),"Simulate advanced params (tools/tool_choice) to test provider ",e.jsx("span",{className:"font-mono",children:"require_parameters"})]}),mt?e.jsx("div",{className:"mt-3 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-800",children:mt}):null,_?e.jsxs("div",{className:"mt-3 rounded-xl border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:(Tt=_==null?void 0:_.test)!=null&&Tt.ok?"✅ Test ok":"⚠ Test failed"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"text-xs text-zinc-500 font-mono",children:_!=null&&_.requestId?`req ${_.requestId}`:""}),e.jsx(de,{label:"Copy debug bundle",className:"rounded-lg border border-zinc-200 bg-white px-2 py-1 text-xs",text:JSON.stringify({requestId:(_==null?void 0:_.requestId)??null,test:(_==null?void 0:_.test)??null,selected:{mode:He,prompt:Ve,base_url:(g==null?void 0:g.openrouter_base_url)??null}},null,2)})]})]}),(Et=_==null?void 0:_.test)!=null&&Et.ok?e.jsxs("div",{className:"mt-2 space-y-2 text-sm text-zinc-700",children:[e.jsxs("div",{children:["Used model: ",e.jsx("span",{className:"font-mono text-xs",children:_.test.usedModel??""}),typeof _.test.durationMs=="number"?e.jsxs("span",{className:"ml-2 text-xs text-zinc-500",children:["(",_.test.durationMs,"ms)"]}):null]}),e.jsxs("div",{children:["Provider: ",e.jsx("span",{className:"font-mono text-xs",children:_.test.usedProvider??"—"}),e.jsx("span",{className:"ml-2 text-zinc-500",children:"·"}),e.jsx("span",{className:"ml-2 text-zinc-500",children:"Variant:"})," ",e.jsx("span",{className:"font-mono text-xs",children:_.test.usedVariant??"—"})]}),e.jsxs("div",{children:["require_parameters:"," ",e.jsx("span",{className:"font-mono text-xs",children:_.test.requireParameters===null||typeof _.test.requireParameters>"u"?"—":String(_.test.requireParameters)}),e.jsxs("span",{className:"ml-2 text-xs text-zinc-500",children:["(source: ",_.test.requireParametersSource??"—",")"]})]}),e.jsxs("div",{children:["Base URL: ",e.jsx("span",{className:"font-mono text-xs",children:_.test.baseUrl??"—"})]}),_.test.contentPreview?e.jsx("div",{className:"rounded-lg border border-zinc-200 bg-zinc-50 p-2 font-mono text-xs",children:_.test.contentPreview}):null]}):e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("div",{className:"text-sm text-zinc-800",children:((Jt=_==null?void 0:_.test)==null?void 0:Jt.userMessage)??"Routing test failed."}),(Bt=_==null?void 0:_.test)!=null&&Bt.envelope?e.jsxs("div",{className:"text-xs text-zinc-500",children:["Code: ",e.jsx("span",{className:"font-mono",children:_.test.envelope.code}),($t=_.test.culprit)!=null&&$t.var?e.jsxs("span",{className:"ml-2",children:["Culprit: ",e.jsx("span",{className:"font-mono",children:_.test.culprit.var})]}):null,(Kt=_.test.culprit)!=null&&Kt.var?e.jsx(F,{type:"button",variant:"ghost",className:"ml-2 rounded-lg border border-zinc-200 bg-white px-2 py-1 text-[11px]",onClick:()=>L(String(_.test.culprit.var),{scroll:!0}),children:"Open culprit"}):null]}):null]})]}):null]})}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Models (primary)"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[{key:"model_fast",label:"Fast"},{key:"model_creative",label:"Creative"},{key:"model_planner",label:"Planner"},{key:"model_maker",label:"Maker"},{key:"model_critic",label:"Critic"}].map(t=>{const r=Array.from(new Set([...g.model_catalog??[],g[t.key]].filter(Boolean)));return e.jsxs("label",{id:`field-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),e.jsx(U,{title:"Details",onClick:()=>L(`assistant_settings.${t.key}`)})]}),e.jsxs("select",{value:g[t.key]??"",onChange:m=>$(a=>a&&{...a,[t.key]:m.target.value}),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"—"}),r.map(m=>e.jsx("option",{value:m,children:m},m))]})]},t.key)})})]}),e.jsxs(E,{children:[e.jsxs("div",{id:"field-fallback_models",className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Fallback models"}),e.jsx(U,{title:"Details",onClick:()=>L("assistant_settings.fallback_models")})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2 text-sm",children:Array.from(new Set([...g.model_catalog??[],...g.fallback_models??[]])).map(t=>{const r=g.fallback_models.includes(t);return e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:m=>$(a=>a&&{...a,fallback_models:m.target.checked?Array.from(new Set([...a.fallback_models,t])):a.fallback_models.filter(P=>P!==t)})}),e.jsx("span",{className:"text-xs text-zinc-700",children:t})]},t)})}),e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"These are used when the primary models fail."})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(E,{children:[e.jsxs("div",{id:"field-model_catalog",className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Model catalog"}),e.jsx(U,{title:"Details",onClick:()=>L("assistant_settings.model_catalog")})]}),e.jsx("textarea",{value:(g.model_catalog??[]).join(`
`),onChange:t=>$(r=>r&&{...r,model_catalog:se(t.target.value)}),placeholder:"One model per line",className:"h-40 w-full rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono"}),e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"This list powers the dropdowns and fallback checkboxes."})]})}),e.jsx("div",{className:"mt-6",children:e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Assistant behavior (prompts & chunking)"}),e.jsxs("div",{className:"mb-2 text-xs text-zinc-500",children:["Stored in ",e.jsx("span",{className:"font-mono",children:"assistant_settings.behavior"}),". Supports placeholders:",e.jsx("span",{className:"ml-1 font-mono",children:"{{name}}"}),", ",e.jsx("span",{className:"font-mono",children:"{{bioLine}}"}),",",e.jsx("span",{className:"font-mono",children:"{{toolProtocol}}"}),"."]}),f.ok?e.jsxs("div",{className:"mb-3 rounded-lg border border-zinc-200 bg-zinc-50 px-3 py-3",children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Behavior controls (safe knobs)"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs",onClick:()=>z(t=>{t.rate_limit=oe((C??{}).rate_limit),t.orchestrator=oe((C??{}).orchestrator),w(t,["router","attribution"],oe(x(C??{},["router","attribution"],{})))}),children:"Reset proactivity controls"}),e.jsxs(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs",onClick:()=>rs(t=>!t),children:[ct?"Hide":"Show"," proactivity diff"]}),e.jsxs(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs",onClick:()=>ss(t=>!t),children:[ot?"Hide":"Show"," full diff"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"OpenRouter attribution"}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"HTTP-Referer"}),e.jsx("input",{type:"text",value:String(x(f.value,["router","attribution","http_referer"],"")),onChange:t=>z(r=>w(r,["router","attribution","http_referer"],t.target.value)),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["router","attribution","http_referer"],""))})]}),e.jsxs("label",{className:"mt-2 flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"X-Title"}),e.jsx("input",{type:"text",value:String(x(f.value,["router","attribution","x_title"],"")),onChange:t=>z(r=>w(r,["router","attribution","x_title"],t.target.value)),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["router","attribution","x_title"],""))})]})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Chat reply rate limit"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Limit"}),e.jsx("input",{type:"number",min:1,max:100,step:1,value:String(x(f.value,["rate_limit","chat_reply","limit"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(1,Math.min(100,Number(r)));w(m,["rate_limit","chat_reply","limit"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["rate_limit","chat_reply","limit"],6))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Window (seconds)"}),e.jsx("input",{type:"number",min:5,max:3600,step:1,value:String(x(f.value,["rate_limit","chat_reply","window_seconds"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(5,Math.min(3600,Number(r)));w(m,["rate_limit","chat_reply","window_seconds"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["rate_limit","chat_reply","window_seconds"],60))})]})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-zinc-500",children:["Stored at ",e.jsx("span",{className:"font-mono",children:"behavior.rate_limit.chat_reply"}),"."]})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3 md:col-span-2",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2 text-[11px] font-semibold text-zinc-600",children:[e.jsx("span",{children:"Zero Data Retention (ZDR) routing"}),e.jsx(U,{title:"Details",onClick:()=>L("behavior.router.zdr.enabled")})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsxs("label",{id:"field-zdr-enabled",className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!x(f.value,["router","zdr","enabled"],!1),onChange:t=>z(r=>w(r,["router","zdr","enabled"],t.target.checked))}),e.jsx("span",{children:"Enable ZDR routing"})]}),e.jsxs("label",{id:"field-zdr-mode",className:"flex flex-col gap-1 text-xs text-zinc-700",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Mode"}),e.jsxs("select",{value:String(x(f.value,["router","zdr","mode"],"sensitive_only")),onChange:t=>z(r=>w(r,["router","zdr","mode"],t.target.value)),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"sensitive_only",children:"Sensitive only"}),e.jsx("option",{value:"all",children:"All requests"})]})]}),e.jsxs("label",{id:"field-zdr-allow-fallback",className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!x(f.value,["router","zdr","allow_fallback"],!0),onChange:t=>z(r=>w(r,["router","zdr","allow_fallback"],t.target.checked))}),e.jsx("span",{children:"Allow fallback"})]}),e.jsxs("label",{id:"field-zdr-base-url",className:"flex flex-col gap-1 text-xs text-zinc-700 md:col-span-2",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"ZDR base URL override"}),e.jsx("input",{type:"text",value:String(x(f.value,["router","zdr","base_url"],"")),onChange:t=>z(r=>w(r,["router","zdr","base_url"],t.target.value)),placeholder:"Leave blank to use discovered ZDR endpoints",className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-zinc-500",children:["Uses cached OpenRouter endpoint discovery. Refresh the ",e.jsx("span",{className:"font-mono",children:"openrouter-refresh"})," job to update."]}),Qe.isLoading?e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"Loading ZDR endpoints…"}):Qe.isError?e.jsx("div",{className:"mt-2 text-xs text-red-600",children:"Failed to load endpoints."}):e.jsx("div",{className:"mt-2",children:bt.length?e.jsx("ul",{className:"space-y-1 text-xs text-zinc-700",children:bt.map(t=>e.jsxs("li",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"font-mono",children:t.base_url}),t.name?e.jsxs("span",{className:"text-zinc-500",children:["(",t.name,")"]}):null]},t.base_url))}):e.jsx("div",{className:"text-xs text-zinc-500",children:"No ZDR endpoints found in cache."})})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3 md:col-span-2",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Routing policy"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Mode"}),e.jsxs("select",{value:String(x(f.value,["router","policy","mode"],"fallback")),onChange:t=>z(r=>w(r,["router","policy","mode"],t.target.value||"fallback")),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"fallback",children:"Fallback"}),e.jsx("option",{value:"auto",children:"Auto"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider sort"}),e.jsxs("select",{value:String(x(f.value,["router","policy","provider","sort"],"price")),onChange:t=>z(r=>w(r,["router","policy","provider","sort"],t.target.value||"price")),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"price",children:"Price"}),e.jsx("option",{value:"throughput",children:"Throughput"}),e.jsx("option",{value:"latency",children:"Latency"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Allow provider fallbacks"}),e.jsxs("select",{value:String(x(f.value,["router","policy","provider","allow_fallbacks"],!0)),onChange:t=>z(r=>w(r,["router","policy","provider","allow_fallbacks"],t.target.value==="true")),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Auto model"}),e.jsx("input",{type:"text",value:String(x(f.value,["router","policy","auto_model"],"")),onChange:t=>z(r=>w(r,["router","policy","auto_model"],t.target.value)),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["router","policy","auto_model"],""))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Fallback models (one per line)"}),e.jsx("textarea",{value:X(x(f.value,["router","policy","fallback_models"],[])),onChange:t=>z(r=>w(r,["router","policy","fallback_models"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:X(x(C,["router","policy","fallback_models"],[]))})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider order (one per line)"}),e.jsx("textarea",{value:X(x(f.value,["router","policy","provider","order"],[])),onChange:t=>z(r=>w(r,["router","policy","provider","order"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:X(x(C,["router","policy","provider","order"],[]))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider require (one per line)"}),e.jsx("textarea",{value:X(x(f.value,["router","policy","provider","require"],[])),onChange:t=>z(r=>w(r,["router","policy","provider","require"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:X(x(C,["router","policy","provider","require"],[]))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider allow (one per line)"}),e.jsx("textarea",{value:X(x(f.value,["router","policy","provider","allow"],[])),onChange:t=>z(r=>w(r,["router","policy","provider","allow"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:X(x(C,["router","policy","provider","allow"],[]))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider ignore (one per line)"}),e.jsx("textarea",{value:X(x(f.value,["router","policy","provider","ignore"],[])),onChange:t=>z(r=>w(r,["router","policy","provider","ignore"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:X(x(C,["router","policy","provider","ignore"],[]))})]})]}),e.jsxs("div",{className:"mt-3 rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2 text-[11px] font-semibold text-zinc-600",children:[e.jsx("div",{children:"Provider policy editor (recommended)"}),e.jsx(U,{title:"Details",onClick:()=>L("behavior.router.policy.provider",{scroll:!1})})]}),e.jsx(Ws,{value:x(f.value,["router","policy","provider"],null),providerOptions:fs,onChange:t=>z(r=>w(r,["router","policy","provider"],t))}),e.jsxs("div",{className:"mt-2 text-[11px] text-zinc-500",children:["Uses OpenRouter's ",e.jsx("span",{className:"font-mono",children:"provider"})," routing fields (only/ignore/order, etc.)."]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Payload variants (one per line)"}),e.jsx("textarea",{value:X(x(f.value,["router","policy","variants"],[])),onChange:t=>z(r=>w(r,["router","policy","variants"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:X(x(C,["router","policy","variants"],[]))})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-zinc-500",children:["Stored at ",e.jsx("span",{className:"font-mono",children:"behavior.router.policy.*"}),"."]})]})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2 text-[11px] font-semibold text-zinc-600",children:[e.jsx("div",{children:"User-facing AI error detail"}),e.jsx(U,{title:"Details",onClick:()=>L("behavior.diagnostics.user_error_detail",{scroll:!1})})]}),e.jsxs("label",{id:"field-behavior-user_error_detail",className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{children:"Mode"}),e.jsx(U,{title:"Details",onClick:()=>L("behavior.diagnostics.user_error_detail")})]}),e.jsxs("select",{value:String(x(f.value,["diagnostics","user_error_detail"],"friendly")),onChange:t=>z(r=>w(r,["diagnostics","user_error_detail"],t.target.value||"friendly")),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"friendly",children:"Friendly (generic)"}),e.jsx("option",{value:"code",children:"Code (show error code)"}),e.jsx("option",{value:"technical",children:"Technical (cause + details)"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("label",{id:"field-behavior-user_error_show_culprit_var",className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{children:"Show culprit variable"}),e.jsx(U,{title:"Details",onClick:()=>L("behavior.diagnostics.user_error_show_culprit_var")})]}),e.jsxs("select",{value:Je(x(f.value,["diagnostics","user_error_show_culprit_var"],void 0)),onChange:t=>z(r=>w(r,["diagnostics","user_error_show_culprit_var"],Be(t.target.value))),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"auto",children:"Auto (by mode)"}),e.jsx("option",{value:"on",children:"On"}),e.jsx("option",{value:"off",children:"Off"})]})]}),e.jsxs("label",{id:"field-behavior-user_error_show_culprit_value",className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{children:"Show culprit value preview"}),e.jsx(U,{title:"Details",onClick:()=>L("behavior.diagnostics.user_error_show_culprit_value")})]}),e.jsxs("select",{value:Je(x(f.value,["diagnostics","user_error_show_culprit_value"],void 0)),onChange:t=>z(r=>w(r,["diagnostics","user_error_show_culprit_value"],Be(t.target.value))),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"auto",children:"Auto (by mode)"}),e.jsx("option",{value:"on",children:"On"}),e.jsx("option",{value:"off",children:"Off"})]})]}),e.jsxs("label",{id:"field-behavior-user_error_show_status_model",className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{children:"Show status / model"}),e.jsx(U,{title:"Details",onClick:()=>L("behavior.diagnostics.user_error_show_status_model")})]}),e.jsxs("select",{value:Je(x(f.value,["diagnostics","user_error_show_status_model"],void 0)),onChange:t=>z(r=>w(r,["diagnostics","user_error_show_status_model"],Be(t.target.value))),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"auto",children:"Auto (by mode)"}),e.jsx("option",{value:"on",children:"On"}),e.jsx("option",{value:"off",children:"Off"})]})]}),e.jsxs("label",{id:"field-behavior-user_error_show_trace_ids",className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{children:"Show trace IDs (requestId, upstream)"}),e.jsx(U,{title:"Details",onClick:()=>L("behavior.diagnostics.user_error_show_trace_ids")})]}),e.jsxs("select",{value:Je(x(f.value,["diagnostics","user_error_show_trace_ids"],void 0)),onChange:t=>z(r=>w(r,["diagnostics","user_error_show_trace_ids"],Be(t.target.value))),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"auto",children:"Auto (by mode)"}),e.jsx("option",{value:"on",children:"On"}),e.jsx("option",{value:"off",children:"Off"})]})]})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-zinc-500",children:["Stored at ",e.jsx("span",{className:"font-mono",children:"behavior.diagnostics.*"}),"."]})]})]}),e.jsxs("div",{className:"mt-4 rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Orchestrator (proactive suggestions)"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Default verbosity"}),e.jsx("input",{type:"number",min:.1,max:.9,step:.05,value:String(x(f.value,["orchestrator","default_verbosity"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(.1,Math.min(.9,Number(r)));w(m,["orchestrator","default_verbosity"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","default_verbosity"],.45))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Default suggestions limit"}),e.jsx("input",{type:"number",min:1,max:6,step:1,value:String(x(f.value,["orchestrator","default_suggestions_limit"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(1,Math.min(6,Number(r)));w(m,["orchestrator","default_suggestions_limit"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","default_suggestions_limit"],3))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Max suggestions limit"}),e.jsx("input",{type:"number",min:1,max:6,step:1,value:String(x(f.value,["orchestrator","max_suggestions_limit"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(1,Math.min(6,Number(r)));w(m,["orchestrator","max_suggestions_limit"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","max_suggestions_limit"],6))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Daily cap (level2)"}),e.jsx("input",{type:"number",min:0,max:200,step:1,value:String(x(f.value,["orchestrator","daily_cap","level2"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(200,Number(r)));w(m,["orchestrator","daily_cap","level2"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","daily_cap","level2"],20))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Daily cap (level1)"}),e.jsx("input",{type:"number",min:0,max:200,step:1,value:String(x(f.value,["orchestrator","daily_cap","level1"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(200,Number(r)));w(m,["orchestrator","daily_cap","level1"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","daily_cap","level1"],12))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Daily cap (level0)"}),e.jsx("input",{type:"number",min:0,max:200,step:1,value:String(x(f.value,["orchestrator","daily_cap","level0"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(200,Number(r)));w(m,["orchestrator","daily_cap","level0"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","daily_cap","level0"],0))})]})]}),e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-3 md:grid-cols-4",children:["home","swipe","messages","search","title","diary","default"].map(t=>e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"text-[11px] text-zinc-500",children:["TTL ",t," (min)"]}),e.jsx("input",{type:"number",min:1,max:1440,step:1,value:String(x(f.value,["orchestrator","ttl_minutes",t],"")),onChange:r=>{const m=r.target.value;z(a=>{const P=m===""?void 0:Math.max(1,Math.min(1440,Number(m)));w(a,["orchestrator","ttl_minutes",t],isFinite(Number(P))?P:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","ttl_minutes",t],""))})]},t))}),e.jsxs("div",{className:"mt-4 rounded-lg border border-zinc-200 bg-zinc-50 p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Dismiss cooldown (minutes)"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Level 2"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"swipe"}),e.jsx("input",{type:"number",min:0,max:240,step:1,value:String(x(f.value,["orchestrator","cooldown_minutes","level2","swipe"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(240,Number(r)));w(m,["orchestrator","cooldown_minutes","level2","swipe"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","cooldown_minutes","level2","swipe"],""))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"default"}),e.jsx("input",{type:"number",min:0,max:240,step:1,value:String(x(f.value,["orchestrator","cooldown_minutes","level2","default"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(240,Number(r)));w(m,["orchestrator","cooldown_minutes","level2","default"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","cooldown_minutes","level2","default"],""))})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Level 1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"swipe"}),e.jsx("input",{type:"number",min:0,max:240,step:1,value:String(x(f.value,["orchestrator","cooldown_minutes","level1","swipe"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(240,Number(r)));w(m,["orchestrator","cooldown_minutes","level1","swipe"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","cooldown_minutes","level1","swipe"],""))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"default"}),e.jsx("input",{type:"number",min:0,max:240,step:1,value:String(x(f.value,["orchestrator","cooldown_minutes","level1","default"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(240,Number(r)));w(m,["orchestrator","cooldown_minutes","level1","default"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","cooldown_minutes","level1","default"],""))})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Level 0"}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"default"}),e.jsx("input",{type:"number",min:0,max:1440,step:1,value:String(x(f.value,["orchestrator","cooldown_minutes","level0","default"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(1440,Number(r)));w(m,["orchestrator","cooldown_minutes","level0","default"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","cooldown_minutes","level0","default"],""))})]})]})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-zinc-500",children:["Stored at ",e.jsx("span",{className:"font-mono",children:"behavior.orchestrator.cooldown_minutes"}),"."]})]})]}),ct?e.jsxs("div",{className:"mt-4 rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"mb-2 text-[11px] font-semibold text-zinc-700",children:["Proactivity diff vs defaults (",De.length,")"]}),De.length?e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Path"}),e.jsx(h,{children:"Default"}),e.jsx(h,{children:"Current"})]})}),e.jsx("tbody",{children:De.slice(0,80).map(t=>e.jsxs("tr",{children:[e.jsx(p,{className:"font-mono text-[11px]",children:t.path}),e.jsx(p,{className:"text-[11px]",children:Ee(t.a)}),e.jsx(p,{className:"text-[11px]",children:Ee(t.b)})]},t.path))})]})}):e.jsx("div",{className:"text-xs text-zinc-500",children:"No differences."}),De.length>80?e.jsx("div",{className:"mt-2 text-[11px] text-zinc-500",children:"Showing first 80 rows."}):null]}):null,ot?e.jsxs("div",{className:"mt-4 rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"mb-2 text-[11px] font-semibold text-zinc-700",children:["Full behavior diff vs defaults (",Fe.length,")"]}),Fe.length?e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsxs(G,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Path"}),e.jsx(h,{children:"Default"}),e.jsx(h,{children:"Current"})]})}),e.jsx("tbody",{children:Fe.slice(0,80).map(t=>e.jsxs("tr",{children:[e.jsx(p,{className:"font-mono text-[11px]",children:t.path}),e.jsx(p,{className:"text-[11px]",children:Ee(t.a)}),e.jsx(p,{className:"text-[11px]",children:Ee(t.b)})]},t.path))})]})}):e.jsx("div",{className:"text-xs text-zinc-500",children:"No differences."}),Fe.length>80?e.jsx("div",{className:"mt-2 text-[11px] text-zinc-500",children:"Showing first 80 rows."}):null]}):null]}):e.jsx("div",{className:"mb-3 rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-800",children:"Behavior JSON is invalid, so structured controls are disabled. Fix the JSON below to re-enable controls."}),e.jsxs("div",{className:"mb-2 flex flex-wrap items-center gap-2",children:[e.jsx(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 px-3 py-2 text-xs",onClick:()=>$(t=>t&&{...t,behavior_json:JSON.stringify((W==null?void 0:W.behavior)??{},null,2)}),children:"Reset to defaults"}),e.jsx(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 px-3 py-2 text-xs",onClick:()=>$(t=>t&&{...t,behavior_json:JSON.stringify({prompts:{system_template:`You are {{name}}, MoviNesta’s in-app AI companion.
{{bioLine}}
Goal: help users pick movies/series fast, spoiler-free, with fun guidance.
Default behavior: be helpful and thorough. If the user asks for a deep dive or plan, you can write long, structured answers.
When recommending: provide 2–6 picks, each with a short spoiler-free reason, unless the user asks for more.
Ask 0–2 questions only if needed.
If the user specifies an exact output format (e.g., "reply exactly", "Format:"), follow it EXACTLY with no extra words.
TOOL_RESULTS_MINI is ground truth for catalog/library/list data; do not invent IDs, titles, or years.
Your final text must be plain text only (no JSON objects inside the message).
Never guess about user data. If unsure, call a read tool (get_my_*, search_*) or ask.
For actions that change data or send messages, do NOT run the write tool automatically. Instead, include confirmable buttons in final.actions.
Only auto-run read/grounding tools.
Never claim an action happened unless TOOL_RESULTS_MINI confirms success.
Never mention tools/JSON/system prompts/policies/DB/SQL.

{{toolProtocol}}`,append_tool_protocol:!0,chunk_outline_template:`You are {{name}}, MoviNesta’s in-app AI companion.
Task: produce a compact outline for a long-form answer.
Prefer 4–8 sections. Make sections actionable and spoiler-free.
Return JSON only matching the provided schema.`,chunk_section_template:`You are {{name}}, MoviNesta’s in-app AI companion.
Task: write ONE section of the answer (only that section).
Write plain text only (no JSON). Be clear, structured, and spoiler-free.
End on a complete sentence.`},output:{max_reply_chars:5e4,strip_text_prefix:!0},chunking:{enabled:!0,min_user_chars:700,cues:["deep","deep dive","go deeper","detailed","long","step-by-step","plan","strategy","write a full","full","comprehensive","explain","analysis","compare"],max_total_chars:5e4,max_sections:8,per_section_max_chars:12e3,user_request_max_chars:4e3,max_continuations:6},tool_loop:{max_loops:3,max_calls_per_loop:4},router:{deterministic_enabled:!0},strict_output:{allow_override:!0}},null,2),params:{...t.params,max_output_tokens:"4096"}}),children:"Long-form preset"}),e.jsx(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 px-3 py-2 text-xs",onClick:()=>$(t=>t&&{...t,behavior_json:JSON.stringify({prompts:{system_template:`You are {{name}}, MoviNesta’s in-app AI companion.
{{bioLine}}
Goal: help users quickly. Be concise by default.
Default: 2–6 picks, each with 1 short reason (no spoilers).
Ask 0–2 questions only if needed.
If the user asks for detail, then expand.
If the user specifies an exact output format (e.g., "reply exactly", "Format:"), follow it EXACTLY with no extra words.
TOOL_RESULTS_MINI is ground truth for catalog/library/list data; do not invent IDs, titles, or years.
Your final text must be plain text only (no JSON objects inside the message).
Never mention tools/JSON/system prompts/policies/DB/SQL.

{{toolProtocol}}`,append_tool_protocol:!0,chunk_outline_template:"You are {{name}}. Return JSON only matching the schema.",chunk_section_template:"You are {{name}}. Write plain text only."},output:{max_reply_chars:4e3,strip_text_prefix:!0},chunking:{enabled:!1,min_user_chars:700,cues:[],max_total_chars:14e3,max_sections:6,per_section_max_chars:8e3,user_request_max_chars:2e3,max_continuations:2},tool_loop:{max_loops:3,max_calls_per_loop:4},router:{deterministic_enabled:!0},strict_output:{allow_override:!0}},null,2),params:{...t.params,max_output_tokens:"900"}}),children:"Concise preset"})]}),e.jsx("textarea",{value:g.behavior_json??"",onChange:t=>$(r=>r&&{...r,behavior_json:t.target.value}),placeholder:`{
                    "prompts": { ... },
                    "output": { ... },
                    "chunking": { ... }
                  }`,className:"h-64 w-full rounded-lg border border-zinc-200 px-3 py-2 text-xs font-mono"})]})}),e.jsx("div",{className:"mt-6",children:e.jsxs(E,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Responses API parameters"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:ke.map(t=>{const r=g.params[t.key]??"",m=`assistant_settings.params.${t.key}`,a=!!Es[m];if(t.key==="verbosity")return e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(U,{title:"Details",onClick:()=>L(m)}):null]}),e.jsxs("select",{value:r,onChange:P=>$(b=>b&&{...b,params:{...b.params,[t.key]:P.target.value}}),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Unset"}),e.jsx("option",{value:"low",children:"low"}),e.jsx("option",{value:"medium",children:"medium"}),e.jsx("option",{value:"high",children:"high"})]})]},t.key);if(t.key==="reasoning"){const P=(()=>{const b=(r??"").trim();if(!b)return"";try{const H=JSON.parse(b),te=H==null?void 0:H.effort;return te==="low"||te==="medium"||te==="high"?te:"__custom__"}catch{return"__custom__"}})();return e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(U,{title:"Details",onClick:()=>L(m)}):null]}),e.jsxs("select",{value:P,onChange:b=>{const H=b.target.value,te=H===""?"":H==="__custom__"?r:JSON.stringify({effort:H},null,2);$(Le=>Le&&{...Le,params:{...Le.params,[t.key]:te}})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Unset"}),e.jsx("option",{value:"low",children:"effort: low"}),e.jsx("option",{value:"medium",children:"effort: medium"}),e.jsx("option",{value:"high",children:"effort: high"}),e.jsx("option",{value:"__custom__",children:"Custom JSON…"})]}),e.jsx("textarea",{value:r,onChange:b=>$(H=>H&&{...H,params:{...H.params,[t.key]:b.target.value}}),placeholder:'{ "effort": "medium" }',className:"h-24 w-full rounded-lg border border-zinc-200 px-3 py-2 text-xs font-mono"})]},t.key)}return t.type==="boolean"?e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(U,{title:"Details",onClick:()=>L(m)}):null]}),e.jsxs("select",{value:r,onChange:P=>$(b=>b&&{...b,params:{...b.params,[t.key]:P.target.value}}),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Unset"}),e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]})]},t.key):t.type==="json"?e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(U,{title:"Details",onClick:()=>L(m)}):null]}),e.jsx("textarea",{value:r,onChange:P=>$(b=>b&&{...b,params:{...b.params,[t.key]:P.target.value}}),placeholder:"{}",className:"h-28 w-full rounded-lg border border-zinc-200 px-3 py-2 text-xs font-mono"})]},t.key):t.type==="string-array"?e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(U,{title:"Details",onClick:()=>L(m)}):null]}),e.jsx("textarea",{value:r,onChange:P=>$(b=>b&&{...b,params:{...b.params,[t.key]:P.target.value}}),placeholder:"One per line",className:"h-28 w-full rounded-lg border border-zinc-200 px-3 py-2 text-xs font-mono"})]},t.key):e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(U,{title:"Details",onClick:()=>L(m)}):null]}),t.type==="number"?e.jsx("input",{type:"number",min:t.min,max:t.max,step:t.step,value:r,onChange:P=>$(b=>b&&{...b,params:{...b.params,[t.key]:P.target.value}}),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm"}):e.jsx("input",{type:"text",value:r,onChange:P=>$(b=>b&&{...b,params:{...b.params,[t.key]:P.target.value}}),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]},t.key)})}),at?e.jsx("div",{className:"mt-3 rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700",children:at}):null,e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx(F,{variant:"ghost",type:"button",onClick:async()=>{if(!g)return;Se(null);const t={};for(const a of ke){const P=g.params[a.key]??"";if(a.type==="number"){const b=P.trim();t[a.key]=b?Number(b):null}else if(a.type==="boolean")P==="true"?t[a.key]=!0:P==="false"?t[a.key]=!1:t[a.key]=null;else if(a.type==="json"){const b=P.trim();if(!b)t[a.key]=null;else try{t[a.key]=JSON.parse(b)}catch{Se(`Invalid JSON for ${a.label}.`);return}}else a.type==="string-array"?t[a.key]=P.trim()?se(P):null:t[a.key]=P.trim()?P:null}let r=null;const m=(g.behavior_json??"").trim();if(m)try{r=JSON.parse(m)}catch{Se("Invalid JSON for Behavior.");return}try{await Re.mutateAsync({openrouter_base_url:g.openrouter_base_url.trim()||null,model_fast:g.model_fast.trim()||null,model_creative:g.model_creative.trim()||null,model_planner:g.model_planner.trim()||null,model_maker:g.model_maker.trim()||null,model_critic:g.model_critic.trim()||null,fallback_models:g.fallback_models,model_catalog:g.model_catalog,default_instructions:g.default_instructions.trim()||null,params:t,behavior:r})}catch(a){Se((a==null?void 0:a.message)??"Failed to save settings.");return}},className:"rounded-xl bg-zinc-900 px-4 py-2 text-sm text-white",disabled:Re.isPending,children:Re.isPending?"Saving…":"Save settings"}),Re.isSuccess?e.jsx("span",{className:"text-xs text-green-700",children:"Saved."}):null]})]})})]})})})(),Ie=V?Ls(V):null,ft=V?tt(V,"effective"):void 0,ws=V?tt(V,"draft"):void 0,vt=V?tt(V,"default"):void 0,ks=(()=>{if(V)try{return JSON.stringify(ft)===JSON.stringify(vt)?"default":"overridden"}catch{return"overridden"}})(),Ss=V?{scope:"admin",default:vt,description:(Ie==null?void 0:Ie.details)??""}:null;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx(Vs,{children:"Assistant"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{variant:"ghost",type:"button",onClick:()=>M("metrics"),className:`rounded-xl px-3 py-2 text-sm ${R==="metrics"?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"Metrics"}),e.jsx(F,{variant:"ghost",type:"button",onClick:()=>M("diagnostics"),className:`rounded-xl px-3 py-2 text-sm ${R==="diagnostics"?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"Diagnostics"}),e.jsx(F,{variant:"ghost",type:"button",onClick:()=>M("settings"),className:`rounded-xl px-3 py-2 text-sm ${R==="settings"?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"Settings"}),R==="metrics"?e.jsxs("div",{className:"ml-2 flex items-center gap-2",children:[e.jsx(F,{variant:"ghost",type:"button",onClick:()=>O(7),className:`rounded-xl px-3 py-2 text-sm ${o===7?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"7d"}),e.jsx(F,{variant:"ghost",type:"button",onClick:()=>O(14),className:`rounded-xl px-3 py-2 text-sm ${o===14?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"14d"}),e.jsx(F,{variant:"ghost",type:"button",onClick:()=>O(30),className:`rounded-xl px-3 py-2 text-sm ${o===30?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"30d"})]}):R==="diagnostics"?e.jsx(F,{variant:"ghost",type:"button",onClick:()=>ae.refetch(),className:"ml-2 rounded-xl bg-zinc-100 px-3 py-2 text-sm text-zinc-800",children:"Refresh"}):null]})]}),zs,e.jsx(Ts,{open:cs,settingKey:V,entry:Ss,status:ks,hint:Ie,effectiveValue:ft,draftValue:ws,recentHistory:null,onClose:()=>ut(!1),onCopyKey:()=>{var l,i;V&&((i=(l=navigator.clipboard)==null?void 0:l.writeText)==null||i.call(l,V).catch(()=>{}))},onApplyValue:l=>{V&&_s(V,l)},onNavigateToKey:l=>L(l,{scroll:!0})}),xs&&Y?e.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:gt}),e.jsxs("div",{className:"relative ml-auto h-full w-full max-w-[720px] overflow-auto bg-white shadow-xl",children:[e.jsx("div",{className:"border-b border-zinc-200 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"AI provider error"}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-500",children:[le(Y.createdAt)," · ",e.jsx("span",{className:"font-mono",children:Y.code})]})]}),e.jsx(F,{variant:"ghost",type:"button",className:"rounded-lg border border-zinc-200 bg-white",onClick:gt,children:"Close"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200 p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-600",children:"Summary"}),e.jsx("div",{className:"mt-1 text-sm text-zinc-800",children:Y.reason}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:[e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-1 font-mono",children:Y.requestId??""}),e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-1 font-mono",children:Y.conversationId??""}),e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-1 font-mono",children:Y.userId??""})]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:(()=>{var i;const l=(i=Y.culprit)==null?void 0:i.var;return e.jsxs(e.Fragment,{children:[e.jsx(de,{label:"Copy debug JSON",text:JSON.stringify(Y,null,2),className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs"}),l?e.jsx(F,{variant:"ghost",type:"button",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs",onClick:()=>L(String(l),{scroll:!0}),children:"Open culprit setting"}):null]})})()})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-600",children:"Culprit"}),(zt=Y.culprit)!=null&&zt.var?e.jsx("span",{className:"text-xs font-mono text-zinc-700",children:Y.culprit.var}):e.jsx("span",{className:"text-xs text-zinc-400",children:"—"})]}),e.jsx("pre",{className:"mt-2 overflow-auto rounded-lg bg-zinc-50 p-3 text-[11px] leading-snug text-zinc-800",children:JSON.stringify(Y.culprit??{},null,2)})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-600",children:"Context"}),e.jsx("pre",{className:"mt-2 overflow-auto rounded-lg bg-zinc-50 p-3 text-[11px] leading-snug text-zinc-800",children:JSON.stringify(Y.context??{},null,2)})]})]})]})]}):null,e.jsx(Zs,{open:!!qe,row:qe,onClose:()=>ie(null)})]})}function Zs(s){var O;if(y.useEffect(()=>{if(!s.open)return;const q=B=>{B.key==="Escape"&&s.onClose()};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)},[s.open,s.onClose]),!s.open||!s.row)return null;const n=s.row,{routing:v,decision:j}=ts(n.meta),k=String((j==null?void 0:j.provider)??n.provider??"—"),J=(()=>{try{return JSON.stringify(n.meta??{},null,2)}catch{return String(n.meta??"{}")}})(),R=(()=>{try{return JSON.stringify(v??{},null,2)}catch{return String(v??"{}")}})(),M=(()=>{const q=n.meta;if(!q||typeof q!="object")return null;const B=q.generation_stats??q.generationStats??null;return!B||typeof B!="object"?null:B})(),o=(()=>{if(!M)return"";try{return JSON.stringify(M,null,2)}catch{return String(M??"{}")}})();return e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:s.onClose}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full max-w-xl border-l border-zinc-200 bg-white p-5 shadow-xl",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight text-zinc-900",children:"Routing request details"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-zinc-500 font-mono",children:[e.jsx("span",{children:n.request_id??n.id}),e.jsx(de,{text:String(n.request_id??n.id),label:"Copy request id",className:"h-8 px-2 py-1 text-xs"})]})]}),e.jsx(F,{variant:"ghost",type:"button",className:"rounded-xl px-3 py-2 text-sm text-zinc-600 hover:bg-zinc-100",onClick:s.onClose,"aria-label":"Close",children:"Close"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"When"}),e.jsx("div",{className:"text-zinc-700",children:le(n.created_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Function"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.fn})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Model"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.model??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Variant"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.variant??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Provider"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:k})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Upstream request"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.upstream_request_id??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Base URL"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.base_url??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Policy mode"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:String(((O=v==null?void 0:v.policy)==null?void 0:O.mode)??"—")})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Generation stats"}),M?e.jsx(de,{text:o,label:"Copy generation JSON",className:"h-8 px-2 py-1 text-xs"}):e.jsx("div",{className:"text-[11px] text-zinc-500",children:"Not backfilled yet"})]}),M?e.jsxs("div",{className:"mt-2 rounded-2xl border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-medium text-zinc-500",children:"Total cost (USD)"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:String(M.total_cost??M.totalCost??"—")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-medium text-zinc-500",children:"Provider"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:String(M.provider_name??M.providerName??M.provider??"—")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-medium text-zinc-500",children:"Native prompt tokens"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:String(M.native_tokens_prompt??M.nativeTokensPrompt??M.tokens_prompt??M.tokensPrompt??"—")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-medium text-zinc-500",children:"Native completion tokens"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:String(M.native_tokens_completion??M.nativeTokensCompletion??M.tokens_completion??M.tokensCompletion??"—")})]})]}),e.jsxs("details",{className:"mt-3",children:[e.jsx("summary",{className:"cursor-pointer select-none text-xs font-medium text-zinc-600",children:"Raw generation JSON"}),e.jsx("pre",{className:"mt-2 max-h-[18vh] overflow-auto rounded-2xl border border-zinc-200 bg-zinc-50 p-3 text-xs text-zinc-700",children:o})]})]}):e.jsxs("div",{className:"mt-2 rounded-2xl border border-zinc-200 bg-zinc-50 p-3 text-xs text-zinc-600",children:["This request has no cached generation stats yet. Run the",e.jsx("span",{className:"mx-1 font-mono",children:"openrouter-generation-backfill"})," job (or wait for its cron schedule) to populate cost/native token counts from OpenRouter's generation API."]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Routing policy"}),e.jsx(de,{text:R,label:"Copy routing JSON",className:"h-8 px-2 py-1 text-xs"})]}),e.jsx("pre",{className:"mt-2 max-h-[24vh] overflow-auto rounded-2xl border border-zinc-200 bg-zinc-50 p-3 text-xs text-zinc-700",children:R})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Meta"}),e.jsx(de,{text:J,label:"Copy JSON",className:"h-8 px-2 py-1 text-xs"})]}),e.jsx("pre",{className:"mt-2 max-h-[24vh] overflow-auto rounded-2xl border border-zinc-200 bg-zinc-50 p-3 text-xs text-zinc-700",children:J})]})]})]})}export{dr as default};
