import{r as i,j as e,L as D,B as c,a as T,x as B}from"./index-RmnKeFJ0.js";import{u as L,E as F}from"./ErrorBox-CT9uctWi.js";import{C as E}from"./Card-BlxKcLs_.js";import{T as q,a as b,b as h}from"./Table-CrgI8WuL.js";import{I as _}from"./Input-D4LaOzI6.js";import{E as I}from"./EmptyState-Cd3UWduY.js";import{C as z}from"./CopyButton-CovIfS24.js";function M(s){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:s.children})}function G(){var k,A;const[s,n]=i.useState(100),[j,f]=i.useState(""),[r,w]=i.useState(""),[d,o]=i.useState(null),[v,x]=i.useState([]),[p,l]=i.useState(null),m=L({queryKey:["audit",{limit:s,search:r,before:d}],queryFn:()=>B({limit:s,search:r.trim()||null,before:d})}),N=((k=m.data)==null?void 0:k.rows)??[],y=i.useMemo(()=>N.find(t=>String(t.id)===String(p))??null,[N,p]);i.useEffect(()=>{p&&(y||l(null))},[p,y]),i.useEffect(()=>{o(null),x([]),l(null)},[s,r]);const C=()=>{l(null),o(null),x([]),w(j.trim())},S=()=>{n(100),l(null),o(null),x([]),f(""),w("")};return m.isLoading?e.jsx(D,{}):m.error?e.jsx(F,{error:m.error}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Audit log"}),(()=>{const t=[s!==100?`limit=${s}`:null,r?`q="${r}"`:null,d?`before=${d}`:null].filter(Boolean);return t.length?e.jsxs("div",{className:"text-xs text-zinc-500",children:["Applied: ",e.jsx("span",{className:"font-mono",children:t.join(" • ")})]}):e.jsx("div",{className:"text-xs text-zinc-500",children:"No filters applied."})})()]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(c,{variant:"ghost",type:"button",onClick:S,children:"Reset filters"})})]}),e.jsx(E,{title:"Filters",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center",children:[e.jsx("div",{className:"w-40",children:e.jsx(_,{type:"number",value:String(s),min:10,max:500,onChange:t=>{const a=t.target.value;if(a==="")return;const u=Number(a);if(!Number.isFinite(u))return;const g=Math.max(10,Math.min(500,Math.trunc(u)));n(g)}})}),e.jsx("div",{className:"flex-1",children:e.jsx(_,{value:j,onChange:t=>f(t.target.value),onKeyDown:t=>{t.key==="Enter"&&C()},placeholder:"Search action/target (e.g., ban, reset_cursor, embedding_settings)"})}),e.jsx(c,{type:"button",onClick:C,children:"Apply"}),e.jsx(c,{variant:"ghost",type:"button",onClick:S,children:"Clear"})]})}),e.jsxs(E,{title:"Recent admin actions",children:[e.jsxs(q,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(b,{children:"At"}),e.jsx(b,{children:"Admin"}),e.jsx(b,{children:"Action"}),e.jsx(b,{children:"Target"}),e.jsx(b,{children:"Details"})]})}),e.jsx("tbody",{children:N.length?N.map(t=>{const a=t.admin_email??t.admin_user_id??"—",u=(()=>{try{const g=JSON.stringify(t.details??{});return g.length>120?g.slice(0,120)+"…":g}catch{return"{…}"}})();return e.jsxs("tr",{className:"cursor-pointer hover:bg-zinc-100 "+(String(p)===String(t.id)?"bg-zinc-200":""),onClick:()=>l(String(t.id)),children:[e.jsx(h,{className:"whitespace-nowrap text-xs text-zinc-600",children:T(t.created_at)}),e.jsx(h,{className:"max-w-[16rem] truncate text-xs text-zinc-600",children:a}),e.jsx(h,{className:"font-mono text-xs",children:t.action}),e.jsx(h,{className:"font-mono text-xs",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:t.target}),t.target?e.jsx(z,{text:String(t.target),label:"Copy",className:"h-8 px-2 py-1 text-xs"}):null]})}),e.jsx(h,{className:"max-w-[22rem] truncate text-xs text-zinc-600",children:u})]},t.id)}):e.jsx("tr",{children:e.jsx(h,{colSpan:5,className:"p-6",children:e.jsx(I,{title:"No audit events",message:"No audit rows yet for this range.",className:"border-0 bg-transparent p-0"})})})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx(c,{variant:"secondary",type:"button",className:"rounded-xl border border-zinc-200 bg-zinc-100 px-3 py-2 text-sm text-zinc-700 hover:bg-zinc-200 disabled:opacity-50",onClick:()=>{o(null),x([]),l(null)},disabled:!d&&v.length===0,children:"First page"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"secondary",type:"button",className:"rounded-xl border border-zinc-200 bg-zinc-100 px-3 py-2 text-sm text-zinc-700 hover:bg-zinc-200 disabled:opacity-50",onClick:()=>{const t=v[v.length-1]??null;x(a=>a.slice(0,-1)),o(t),l(null)},disabled:v.length===0,children:"Prev"}),e.jsx(c,{variant:"secondary",type:"button",className:"rounded-xl border border-zinc-200 bg-zinc-100 px-3 py-2 text-sm text-zinc-700 hover:bg-zinc-200 disabled:opacity-50",onClick:()=>{var a;const t=((a=m.data)==null?void 0:a.next_before)??null;t&&(x(u=>[...u,d]),o(t),l(null))},disabled:!((A=m.data)!=null&&A.next_before),children:"Next"})]})]})]}),e.jsx(J,{open:!!y,row:y,onClose:()=>l(null)})]})}function J(s){if(i.useEffect(()=>{if(!s.open)return;const f=r=>{r.key==="Escape"&&s.onClose()};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[s.open,s.onClose]),!s.open||!s.row)return null;const n=s.row,j=(()=>{try{return JSON.stringify(n.details??{},null,2)}catch{return String(n.details??"{}")}})();return e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:s.onClose}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full max-w-xl border-l border-zinc-200 bg-white p-5 shadow-xl",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight text-zinc-900",children:"Audit details"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-zinc-500 font-mono",children:[e.jsx("span",{children:n.id}),e.jsx(z,{text:String(n.id),label:"Copy id",className:"h-8 px-2 py-1 text-xs"})]})]}),e.jsx(c,{variant:"ghost",type:"button",className:"rounded-xl px-3 py-2 text-sm text-zinc-600 hover:bg-zinc-100",onClick:s.onClose,"aria-label":"Close",children:"Close"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"At"}),e.jsx("div",{className:"text-zinc-700",children:T(n.created_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Admin"}),e.jsx("div",{className:"text-zinc-700",children:n.admin_email??n.admin_user_id??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Action"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.action})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Target"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.target})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Details"}),e.jsx(z,{text:j,label:"Copy JSON",className:"h-8 px-2 py-1 text-xs"})]}),e.jsx("pre",{className:"mt-2 max-h-[65vh] overflow-auto rounded-2xl border border-zinc-200 bg-zinc-50 p-3 text-xs text-zinc-700",children:j})]})]})]})}export{G as default};
