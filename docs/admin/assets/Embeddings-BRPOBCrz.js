import{u as $,r as t,j as e,L as q,B as K,f as V,b as G,c as H,d as J}from"./index-RmnKeFJ0.js";import{u as O,E as u}from"./ErrorBox-CT9uctWi.js";import{u as I}from"./useMutation-BNYkbyWO.js";import{C as v}from"./Card-BlxKcLs_.js";import{I as c}from"./Input-D4LaOzI6.js";import{T as U,a as h,b as l}from"./Table-CrgI8WuL.js";import{E as W}from"./EmptyState-Cd3UWduY.js";function X(a){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:a.children})}function ie(){var C,P,T;const a=$(),i=O({queryKey:["embeddings"],queryFn:J}),r=((C=i.data)==null?void 0:C.embedding_settings)??null,Q=(r==null?void 0:r.active_provider)??"—",R=(r==null?void 0:r.active_model)??"—",B=(r==null?void 0:r.active_dimensions)??1024,F=(r==null?void 0:r.active_task)??"swipe",[m,D]=t.useState(!1),[g,j]=t.useState("voyage"),[p,b]=t.useState("voyage-3-large"),[f,k]=t.useState(1024),[y,x]=t.useState("swipe"),[N,S]=t.useState(!1),[w,_]=t.useState(!1),[z,E]=t.useState(50);t.useEffect(()=>{r&&(m||(j("voyage"),b("voyage-3-large"),k(1024),x(String(r.active_task??"swipe")),S(!!(r.rerank_swipe_enabled??!1)),_(!!(r.rerank_search_enabled??!1)),E(Number(r.rerank_top_k??50)),D(!0)))},[r,m]);const L=t.useMemo(()=>[{provider:"voyage",model:"voyage-3-large",dimensions:1024,task:"swipe"}],[]),n=I({mutationFn:()=>G({provider:g,model:p,dimensions:f,task:y}),onSuccess:async()=>{await a.invalidateQueries({queryKey:["embeddings"]}),await a.invalidateQueries({queryKey:["overview"]})}}),d=I({mutationFn:()=>H({swipe_enabled:N,search_enabled:w,top_k:z}),onSuccess:async()=>{await a.invalidateQueries({queryKey:["embeddings"]}),await a.invalidateQueries({queryKey:["overview"]})}});return i.isLoading?e.jsx(q,{}):i.error?e.jsx(u,{error:i.error}):r&&!m?e.jsx(q,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(X,{children:"Embeddings"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(v,{title:"Active embedding profile",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Provider"}),e.jsx(c,{value:g,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Model"}),e.jsx(c,{value:p,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Dimensions"}),e.jsx(c,{value:String(f),disabled:!0,type:"number"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Task"}),e.jsx(c,{value:y,onChange:s=>x(s.target.value),placeholder:"swipe"})]})]}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:L.map(s=>e.jsxs("button",{className:"rounded-xl border border-zinc-200 bg-zinc-100 px-3 py-2 text-sm text-zinc-700 hover:bg-zinc-200",onClick:()=>{j(s.provider),b(s.model),k(s.dimensions),x(s.task)},children:[s.provider,": ",s.model]},`${s.provider}-${s.model}`))}),e.jsxs("div",{className:"mt-4",children:[e.jsx(K,{onClick:()=>n.mutate(),disabled:n.isPending,children:n.isPending?"Saving…":"Set active profile"}),n.isError?e.jsx(u,{error:n.error,className:"mt-2"}):null]}),e.jsxs("div",{className:"mt-4 text-xs text-zinc-500",children:["Current: ",e.jsx("span",{className:"font-mono",children:Q})," / ",e.jsx("span",{className:"font-mono",children:R})," (",B,") task=",F]})]}),e.jsx(v,{title:"Rerank settings (Voyage rerank-2.5)",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 text-sm text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:s=>S(s.target.checked)}),"Enable rerank for swipe deck"]}),e.jsxs("label",{className:"flex items-center gap-3 text-sm text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>_(s.target.checked)}),"Enable rerank for search results"]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs font-medium text-zinc-600",children:"Top K candidates to rerank"}),e.jsx(c,{value:String(z),onChange:s=>{const o=s.target.value;if(o==="")return;const M=Number(o);if(!Number.isFinite(M))return;const A=Math.max(5,Math.min(200,Math.trunc(M)));E(A)},type:"number",min:5,max:200})]}),e.jsx(K,{onClick:()=>d.mutate(),disabled:d.isPending,children:d.isPending?"Saving…":"Save rerank settings"}),d.isError?e.jsx(u,{error:d.error,className:"mt-2"}):null]})})]}),e.jsx(v,{title:"Stored embedding coverage",children:e.jsxs(U,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Provider"}),e.jsx(h,{children:"Model"}),e.jsx(h,{className:"text-right",children:"Count"})]})}),e.jsx("tbody",{children:((T=(P=i.data)==null?void 0:P.coverage)==null?void 0:T.length)??0?i.data.coverage.map((s,o)=>e.jsxs("tr",{children:[e.jsx(l,{children:s.provider}),e.jsx(l,{className:"font-mono text-xs",children:s.model}),e.jsx(l,{className:"text-right",children:V(s.count)})]},o)):e.jsx("tr",{children:e.jsx(l,{colSpan:3,className:"p-6",children:e.jsx(W,{title:"No coverage",message:"No embedding coverage rows were returned.",className:"border-0 bg-transparent p-0"})})})})]})})]})}export{ie as default};
