import{u as k,p as E,r as o,j as e,L as w,B as i,a as _,q,t as D,v as A}from"./index-Ce94cHyp.js";import{u as P,E as b}from"./ErrorBox-DZUsR5L2.js";import{u as S}from"./useMutation-BuMd4YLx.js";import{C as T}from"./Card-DXgML9lJ.js";import{T as F,a as d,b as l}from"./Table-B-aH1K18.js";import{I as K}from"./Input-BLXhYdkr.js";import{C as Q}from"./ConfirmDialog-Svuntyko.js";import{E as I}from"./EmptyState-mcVY2n_D.js";import{C as L}from"./CopyButton-D3efaj2N.js";function R(x){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:x.children})}function X(){const x=k(),f=E(),[p,v]=o.useState(""),[c,y]=o.useState(""),[j,m]=o.useState(null),[a,g]=o.useState(null),N=()=>{m(null),y(p.trim())},B=()=>{m(null),v(""),y("")},h=P({queryKey:["users",{search:c,page:j}],queryFn:()=>A({search:c.trim()||null,page:j})}),t=h.data,r=S({mutationFn:({user_id:s,banned:n})=>q(s,n),onSuccess:async(s,n)=>{await x.invalidateQueries({queryKey:["users"]}),f.push({title:n.banned?"User banned":"User unbanned",message:n.banned?"The account has been banned.":"The account has been unbanned.",variant:"success"})}}),u=S({mutationFn:s=>D(s),onSuccess:async()=>{await x.invalidateQueries({queryKey:["users"]}),f.push({title:"Vectors reset",message:"User embedding vectors were cleared.",variant:"success"})}}),U=o.useMemo(()=>!!(t!=null&&t.next_page),[t==null?void 0:t.next_page]);if(h.isLoading)return e.jsx(w,{});if(h.error)return e.jsx(b,{error:h.error});const C=(t==null?void 0:t.users)??[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(R,{children:"Users"}),e.jsx(Q,{open:!!a,title:(a==null?void 0:a.title)??"",message:(a==null?void 0:a.message)??"",confirmText:a==null?void 0:a.confirmText,danger:a==null?void 0:a.danger,confirmDisabled:a==null?void 0:a.disabled,onCancel:()=>g(null),onConfirm:()=>{const s=a==null?void 0:a.onConfirm;g(null),s==null||s()}}),e.jsx(T,{title:"Search",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsx(K,{value:p,onChange:s=>v(s.target.value),onKeyDown:s=>{s.key==="Enter"&&N()},placeholder:"Search by email (partial match)"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[p.trim()||c.trim()?e.jsx(i,{variant:"ghost",onClick:B,children:"Clear"}):null,e.jsx(i,{variant:"ghost",onClick:N,children:"Apply"})]}),c.trim()?e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Applied: ",e.jsx("span",{className:"font-mono",children:c})]}):null]})}),e.jsxs(T,{title:"Users",children:[e.jsxs(F,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(d,{children:"Email"}),e.jsx(d,{children:"User ID"}),e.jsx(d,{children:"Created"}),e.jsx(d,{children:"Status"}),e.jsx(d,{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:C.length?C.map(s=>{const n=!!s.banned_until;return e.jsxs("tr",{children:[e.jsx(l,{className:"text-sm",children:s.email??"â€”"}),e.jsx(l,{className:"font-mono text-xs",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.id}),e.jsx(L,{text:String(s.id),label:"Copy",className:"h-8 px-2 py-1 text-xs"})]})}),e.jsx(l,{className:"whitespace-nowrap text-xs text-zinc-600",children:_(s.created_at)}),e.jsx(l,{className:n?"text-red-600":"text-emerald-600",children:n?"banned":"active"}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[n?e.jsx(i,{variant:"primary",onClick:()=>r.mutate({user_id:s.id,banned:!1}),disabled:r.isPending,children:"Unban"}):e.jsx(i,{variant:"danger",onClick:()=>g({title:"Ban user",message:`Ban ${s.email??s.id}? This will block access to the app.`,confirmText:"Ban",danger:!0,disabled:r.isPending,onConfirm:()=>r.mutate({user_id:s.id,banned:!0})}),disabled:r.isPending,children:"Ban"}),e.jsx(i,{variant:"ghost",onClick:()=>u.mutate(s.id),disabled:u.isPending,children:"Reset vectors"})]})})]},s.id)}):e.jsx("tr",{children:e.jsx(l,{colSpan:5,className:"p-6",children:e.jsx(I,{title:"No users",message:"No users matched your search.",className:"border-0 bg-transparent p-0"})})})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx(i,{variant:"ghost",onClick:()=>m(null),disabled:!j,children:"First page"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(i,{variant:"ghost",onClick:()=>m((t==null?void 0:t.next_page)??null),disabled:!U,children:"Next page"})})]}),r.isError?e.jsx(b,{error:r.error,className:"mt-2"}):null,u.isError?e.jsx(b,{error:u.error,className:"mt-2"}):null]})]})}export{X as default};
