import{r as d,j as e,B as n,e as B,u as U,n as D,L as _,a as q,o as z,p as A,q as K}from"./index-CGWJK-B7.js";import{u as L,E as b}from"./ErrorBox-DGVAxfkB.js";import{u as k}from"./useMutation-CEd-E173.js";import{C as S}from"./Card-BfoASP6-.js";import{T as P,a as h,b as c}from"./Table-DrAL3XMq.js";import{I as F}from"./Input-5czXp4bm.js";import{E as Q}from"./EmptyState-D234wNkF.js";import{C as I}from"./CopyButton-DYYxrqKe.js";function R(a){return d.useEffect(()=>{if(!a.open)return;const o=m=>{m.key==="Escape"&&a.onCancel()};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[a.open,a.onCancel]),a.open?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:a.onCancel}),e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl border border-zinc-200 bg-white p-5 shadow-xl",children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight text-zinc-900",children:a.title}),e.jsx("div",{className:"mt-2 text-sm text-zinc-600",children:a.message}),e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx(n,{variant:"ghost",onClick:a.onCancel,children:"Cancel"}),e.jsx(n,{variant:a.danger?"danger":"primary",className:B(a.confirmDisabled&&"opacity-60"),onClick:a.onConfirm,disabled:a.confirmDisabled,children:a.confirmText??"Confirm"})]})]})]}):null}function M(a){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:a.children})}function Y(){var C,w;const a=U(),o=D(),[m,p]=d.useState(""),[x,v]=d.useState(""),[g,u]=d.useState(null),[t,f]=d.useState(null),y=()=>{u(null),v(m.trim())},E=()=>{u(null),p(""),v("")},i=L({queryKey:["users",{search:x,page:g}],queryFn:()=>K({search:x.trim()||null,page:g})}),l=k({mutationFn:({user_id:s,banned:r})=>z(s,r),onSuccess:async(s,r)=>{await a.invalidateQueries({queryKey:["users"]}),o.push({title:r.banned?"User banned":"User unbanned",message:r.banned?"The account has been banned.":"The account has been unbanned.",variant:"success"})}}),j=k({mutationFn:s=>A(s),onSuccess:async()=>{await a.invalidateQueries({queryKey:["users"]}),o.push({title:"Vectors reset",message:"User embedding vectors were cleared.",variant:"success"})}}),T=d.useMemo(()=>{var s;return!!((s=i.data)!=null&&s.next_page)},[(C=i.data)==null?void 0:C.next_page]);if(i.isLoading)return e.jsx(_,{});if(i.error)return e.jsx(b,{error:i.error});const N=((w=i.data)==null?void 0:w.users)??[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{children:"Users"}),e.jsx(R,{open:!!t,title:(t==null?void 0:t.title)??"",message:(t==null?void 0:t.message)??"",confirmText:t==null?void 0:t.confirmText,danger:t==null?void 0:t.danger,confirmDisabled:t==null?void 0:t.disabled,onCancel:()=>f(null),onConfirm:()=>{const s=t==null?void 0:t.onConfirm;f(null),s==null||s()}}),e.jsx(S,{title:"Search",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsx(F,{value:m,onChange:s=>p(s.target.value),onKeyDown:s=>{s.key==="Enter"&&y()},placeholder:"Search by email (partial match)"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[m.trim()||x.trim()?e.jsx(n,{variant:"ghost",onClick:E,children:"Clear"}):null,e.jsx(n,{variant:"ghost",onClick:y,children:"Apply"})]}),x.trim()?e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Applied: ",e.jsx("span",{className:"font-mono",children:x})]}):null]})}),e.jsxs(S,{title:"Users",children:[e.jsxs(P,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Email"}),e.jsx(h,{children:"User ID"}),e.jsx(h,{children:"Created"}),e.jsx(h,{children:"Status"}),e.jsx(h,{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:N.length?N.map(s=>{const r=!!s.banned_until;return e.jsxs("tr",{children:[e.jsx(c,{className:"text-sm",children:s.email??"â€”"}),e.jsx(c,{className:"font-mono text-xs",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.id}),e.jsx(I,{text:String(s.id),label:"Copy",className:"h-8 px-2 py-1 text-xs"})]})}),e.jsx(c,{className:"whitespace-nowrap text-xs text-zinc-600",children:q(s.created_at)}),e.jsx(c,{className:r?"text-red-600":"text-emerald-600",children:r?"banned":"active"}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[r?e.jsx(n,{variant:"primary",onClick:()=>l.mutate({user_id:s.id,banned:!1}),disabled:l.isPending,children:"Unban"}):e.jsx(n,{variant:"danger",onClick:()=>f({title:"Ban user",message:`Ban ${s.email??s.id}? This will block access to the app.`,confirmText:"Ban",danger:!0,disabled:l.isPending,onConfirm:()=>l.mutate({user_id:s.id,banned:!0})}),disabled:l.isPending,children:"Ban"}),e.jsx(n,{variant:"ghost",onClick:()=>j.mutate(s.id),disabled:j.isPending,children:"Reset vectors"})]})})]},s.id)}):e.jsx("tr",{children:e.jsx(c,{colSpan:5,className:"p-6",children:e.jsx(Q,{title:"No users",message:"No users matched your search.",className:"border-0 bg-transparent p-0"})})})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx(n,{variant:"ghost",onClick:()=>u(null),disabled:!g,children:"First page"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(n,{variant:"ghost",onClick:()=>{var s;return u(((s=i.data)==null?void 0:s.next_page)??null)},disabled:!T,children:"Next page"})})]}),l.isError?e.jsx(b,{error:l.error,className:"mt-2"}):null,j.isError?e.jsx(b,{error:j.error,className:"mt-2"}):null]})]})}export{Y as default};
