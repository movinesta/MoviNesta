import{aa as L,r as S,_ as Ce,j as e,B as Z,a0 as Le,i as oe,ab as Oe,ac as Pe,ad as Ae,ae as Ee,af as $e,ag as De}from"./index-D9xRnzKs.js";import{u as J,E as G}from"./ErrorBox-CDpT_uq-.js";import{C as P}from"./Card-Aw9GMa-R.js";import{T as R,a as c,b as n}from"./Table-BxocV-Nq.js";import{u as Ie}from"./useMutation-BItk-FIV.js";import{I as Me}from"./Input-YDRMBIzd.js";import{u as qe,a as Te,b as Ge,i as W,c as Ke,d as We,e as de,w as ye,h as _e,j as ke,k as ze,C as Se,l as Be,S as T,R as se,X as ie,Y as ae,T as re,L as ne}from"./generateCategoricalChart-CSPAJsDU.js";import{L as le,a as D}from"./LineChart-D1CO4AIG.js";var He=["x1","y1","x2","y2","key"],Ve=["offset"];function Y(t){"@babel/helpers - typeof";return Y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Y(t)}function ve(t,a){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);a&&(i=i.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),r.push.apply(r,i)}return r}function O(t){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?ve(Object(r),!0).forEach(function(i){Re(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ve(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}function Re(t,a,r){return a=Je(a),a in t?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r,t}function Je(t){var a=Ue(t,"string");return Y(a)=="symbol"?a:a+""}function Ue(t,a){if(Y(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var i=r.call(t,a);if(Y(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function U(){return U=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},U.apply(this,arguments)}function Ne(t,a){if(t==null)return{};var r=Ye(t,a),i,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(t);for(l=0;l<d.length;l++)i=d[l],!(a.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(r[i]=t[i])}return r}function Ye(t,a){if(t==null)return{};var r={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){if(a.indexOf(i)>=0)continue;r[i]=t[i]}return r}var Xe=function(a){var r=a.fill;if(!r||r==="none")return null;var i=a.fillOpacity,l=a.x,d=a.y,m=a.width,f=a.height,u=a.ry;return L.createElement("rect",{x:l,y:d,ry:u,width:m,height:f,stroke:"none",fill:r,fillOpacity:i,className:"recharts-cartesian-grid-bg"})};function Fe(t,a){var r;if(L.isValidElement(t))r=L.cloneElement(t,a);else if(de(t))r=t(a);else{var i=a.x1,l=a.y1,d=a.x2,m=a.y2,f=a.key,u=Ne(a,He),y=Be(u,!1);y.offset;var x=Ne(y,Ve);r=L.createElement("line",U({},x,{x1:i,y1:l,x2:d,y2:m,fill:"none",key:f}))}return r}function Qe(t){var a=t.x,r=t.width,i=t.horizontal,l=i===void 0?!0:i,d=t.horizontalPoints;if(!l||!d||!d.length)return null;var m=d.map(function(f,u){var y=O(O({},t),{},{x1:a,y1:f,x2:a+r,y2:f,key:"line-".concat(u),index:u});return Fe(l,y)});return L.createElement("g",{className:"recharts-cartesian-grid-horizontal"},m)}function Ze(t){var a=t.y,r=t.height,i=t.vertical,l=i===void 0?!0:i,d=t.verticalPoints;if(!l||!d||!d.length)return null;var m=d.map(function(f,u){var y=O(O({},t),{},{x1:f,y1:a,x2:f,y2:a+r,key:"line-".concat(u),index:u});return Fe(l,y)});return L.createElement("g",{className:"recharts-cartesian-grid-vertical"},m)}function et(t){var a=t.horizontalFill,r=t.fillOpacity,i=t.x,l=t.y,d=t.width,m=t.height,f=t.horizontalPoints,u=t.horizontal,y=u===void 0?!0:u;if(!y||!a||!a.length)return null;var x=f.map(function(g){return Math.round(g+l-l)}).sort(function(g,w){return g-w});l!==x[0]&&x.unshift(0);var F=x.map(function(g,w){var $=!x[w+1],k=$?l+m-g:x[w+1]-g;if(k<=0)return null;var h=w%a.length;return L.createElement("rect",{key:"react-".concat(w),y:g,x:i,height:k,width:d,stroke:"none",fill:a[h],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return L.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},F)}function tt(t){var a=t.vertical,r=a===void 0?!0:a,i=t.verticalFill,l=t.fillOpacity,d=t.x,m=t.y,f=t.width,u=t.height,y=t.verticalPoints;if(!r||!i||!i.length)return null;var x=y.map(function(g){return Math.round(g+d-d)}).sort(function(g,w){return g-w});d!==x[0]&&x.unshift(0);var F=x.map(function(g,w){var $=!x[w+1],k=$?d+f-g:x[w+1]-g;if(k<=0)return null;var h=w%i.length;return L.createElement("rect",{key:"react-".concat(w),x:g,y:m,width:k,height:u,stroke:"none",fill:i[h],fillOpacity:l,className:"recharts-cartesian-grid-bg"})});return L.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},F)}var st=function(a,r){var i=a.xAxis,l=a.width,d=a.height,m=a.offset;return _e(ke(O(O(O({},Se.defaultProps),i),{},{ticks:ze(i,!0),viewBox:{x:0,y:0,width:l,height:d}})),m.left,m.left+m.width,r)},it=function(a,r){var i=a.yAxis,l=a.width,d=a.height,m=a.offset;return _e(ke(O(O(O({},Se.defaultProps),i),{},{ticks:ze(i,!0),viewBox:{x:0,y:0,width:l,height:d}})),m.top,m.top+m.height,r)},Q={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function ee(t){var a,r,i,l,d,m,f=qe(),u=Te(),y=Ge(),x=O(O({},t),{},{stroke:(a=t.stroke)!==null&&a!==void 0?a:Q.stroke,fill:(r=t.fill)!==null&&r!==void 0?r:Q.fill,horizontal:(i=t.horizontal)!==null&&i!==void 0?i:Q.horizontal,horizontalFill:(l=t.horizontalFill)!==null&&l!==void 0?l:Q.horizontalFill,vertical:(d=t.vertical)!==null&&d!==void 0?d:Q.vertical,verticalFill:(m=t.verticalFill)!==null&&m!==void 0?m:Q.verticalFill,x:W(t.x)?t.x:y.left,y:W(t.y)?t.y:y.top,width:W(t.width)?t.width:y.width,height:W(t.height)?t.height:y.height}),F=x.x,g=x.y,w=x.width,$=x.height,k=x.syncWithTicks,h=x.horizontalValues,o=x.verticalValues,N=Ke(),z=We();if(!W(w)||w<=0||!W($)||$<=0||!W(F)||F!==+F||!W(g)||g!==+g)return null;var C=x.verticalCoordinatesGenerator||st,K=x.horizontalCoordinatesGenerator||it,v=x.horizontalPoints,p=x.verticalPoints;if((!v||!v.length)&&de(K)){var B=h&&h.length,H=K({yAxis:z?O(O({},z),{},{ticks:B?h:z.ticks}):void 0,width:f,height:u,offset:y},B?!0:k);ye(Array.isArray(H),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Y(H),"]")),Array.isArray(H)&&(v=H)}if((!p||!p.length)&&de(C)){var te=o&&o.length,V=C({xAxis:N?O(O({},N),{},{ticks:te?o:N.ticks}):void 0,width:f,height:u,offset:y},te?!0:k);ye(Array.isArray(V),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Y(V),"]")),Array.isArray(V)&&(p=V)}return L.createElement("g",{className:"recharts-cartesian-grid"},L.createElement(Xe,{fill:x.fill,fillOpacity:x.fillOpacity,x:x.x,y:x.y,width:x.width,height:x.height,ry:x.ry}),L.createElement(Qe,U({},x,{offset:y,horizontalPoints:v,xAxis:N,yAxis:z})),L.createElement(Ze,U({},x,{offset:y,verticalPoints:p,xAxis:N,yAxis:z})),L.createElement(et,U({},x,{horizontalPoints:v})),L.createElement(tt,U({},x,{verticalPoints:p})))}ee.displayName="CartesianGrid";function E(t,a,r){return Number.isFinite(t)?Math.min(r,Math.max(a,t)):a}function I(t,a){const r=Number(t);return Number.isFinite(r)?r:a}function we(t){const a=(t&&typeof t=="object"?t.weights:null)??{},r=(t&&typeof t=="object"?t.source_multipliers:null)??{};return{enabled:!!((t==null?void 0:t.enabled)??!0),skip_when_mix_active:!!((t==null?void 0:t.skip_when_mix_active)??!0),weights:{position:E(I(a.position,1),0,10),popularity:E(I(a.popularity,.25),0,10),vote_avg:E(I(a.vote_avg,.15),0,10),cf_score:E(I(a.cf_score,1),0,10)},source_multipliers:{for_you:E(I(r.for_you,1),0,10),combined:E(I(r.combined,1),0,10),friends:E(I(r.friends,1),0,10),trending:E(I(r.trending,1),0,10),cf:E(I(r.cf,1),0,10),seg_pop:E(I(r.seg_pop,.9),0,10),other:E(I(r.other,1),0,10)}}}function ce(t){const{label:a,value:r,onChange:i,min:l=0,max:d=3,step:m=.05,hint:f}=t;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-700",children:a}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{variant:"secondary",onClick:()=>{setImportError(null),setImportOpen(!0)},disabled:mut.isPending||q.isLoading,title:"Paste JSON to update multipliers/weights (e.g., output of suggest_blend_calibration)",children:"Import JSON"}),e.jsx(Me,{className:"h-8 w-24",type:"number",min:l,max:d,step:m,value:Number.isFinite(r)?r:0,onChange:u=>i(E(Number(u.target.value),l,d))})]})]}),e.jsx("input",{className:"w-full",type:"range",min:l,max:d,step:m,value:Number.isFinite(r)?r:0,onChange:u=>i(E(Number(u.target.value),l,d))}),f?e.jsx("div",{className:"text-xs text-zinc-500",children:f}):null]})}function at(){var $,k;const t=J({queryKey:["app_settings"],queryFn:async()=>Le(),staleTime:3e4,refetchInterval:6e4}),a=S.useMemo(()=>{var o,N;return((N=(((o=t.data)==null?void 0:o.registry)??{})["ranking.swipe.blend"])==null?void 0:N.default)??null},[($=t.data)==null?void 0:$.registry]),r=S.useMemo(()=>{var z;const o=(((z=t.data)==null?void 0:z.rows)??[]).find(C=>C.key==="ranking.swipe.blend"),N=(o==null?void 0:o.value)??a;return we(N)},[(k=t.data)==null?void 0:k.rows,a]),[i,l]=S.useState(null),[d,m]=S.useState(!1),[f,u]=S.useState(""),[y,x]=S.useState(null),F=()=>{var h,o,N,z,C,K;if(x(null),!f.trim()){x("Paste JSON first.");return}try{const v=JSON.parse(f),p=((o=(h=v==null?void 0:v.ranking)==null?void 0:h.swipe)==null?void 0:o.blend)??(v==null?void 0:v["ranking.swipe.blend"])??(v==null?void 0:v.blend)??v,B={enabled:!!((p==null?void 0:p.enabled)??(i==null?void 0:i.enabled)??!0),skip_when_mix_active:!!((p==null?void 0:p.skip_when_mix_active)??(i==null?void 0:i.skip_when_mix_active)??!0),weights:{position:Number(((N=p==null?void 0:p.weights)==null?void 0:N.position)??(i==null?void 0:i.weights.position)??1),popularity:Number(((z=p==null?void 0:p.weights)==null?void 0:z.popularity)??(i==null?void 0:i.weights.popularity)??.15),vote_avg:Number(((C=p==null?void 0:p.weights)==null?void 0:C.vote_avg)??(i==null?void 0:i.weights.vote_avg)??.2),cf_score:Number(((K=p==null?void 0:p.weights)==null?void 0:K.cf_score)??(i==null?void 0:i.weights.cf_score)??1)},source_multipliers:{...(i==null?void 0:i.source_multipliers)??a.source_multipliers,...(p==null?void 0:p.source_multipliers)??{},...(p==null?void 0:p.suggested_source_multipliers)??{}}};l(we(B)),m(!1),u("")}catch(v){x(v!=null&&v.message?String(v.message):"Invalid JSON.")}};S.useEffect(()=>{!i&&t.data&&l(r)},[t.data]),S.useEffect(()=>{if(!i)return;JSON.stringify(i)===JSON.stringify(r)&&l(r)},[r]);const g=Ie({mutationFn:async h=>{var N;const o=(N=t.data)==null?void 0:N.version;return Ce({expected_version:o,updates:{"ranking.swipe.blend":h.cfg},reason:h.reason})},onSuccess:async()=>{await t.refetch()}}),w=!!i&&!g.isPending;return e.jsxs(P,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-200 px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:"Swipe Blend Calibration"}),e.jsxs("div",{className:"text-xs text-zinc-600",children:["Controls the score-based reorder step (feature weights + per-source multipliers). Stored as ",e.jsx("span",{className:"font-mono",children:"ranking.swipe.blend"})," (server_only)."]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{variant:"secondary",onClick:()=>{x(null),m(!0)},disabled:g.isPending||t.isLoading,title:"Paste JSON to update multipliers/weights (e.g., output of suggest_blend_calibration)",children:"Import JSON"}),e.jsx(Z,{variant:"secondary",onClick:()=>l(r),disabled:g.isPending||t.isLoading,title:"Reset editor to current saved values",children:"Reset"}),e.jsx(Z,{onClick:()=>i&&g.mutate({cfg:i,reason:"Update swipe blend calibration"}),disabled:!w,children:"Save"})]})]}),d?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>m(!1)}),e.jsxs("div",{className:"relative w-full max-w-2xl rounded-2xl border border-zinc-200 bg-white p-5 shadow-xl",children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight text-zinc-900",children:"Import blend JSON"}),e.jsxs("div",{className:"mt-2 text-sm text-zinc-600",children:["Paste either ",e.jsx("span",{className:"font-mono",children:'{"weights":..., "source_multipliers":...}'})," or the full"," ",e.jsx("span",{className:"font-mono",children:"ranking.swipe.blend"})," object, or the output of"," ",e.jsx("span",{className:"font-mono",children:"suggest_blend_calibration.mjs"}),"."]}),e.jsx("textarea",{className:"mt-4 h-56 w-full rounded-xl border border-zinc-200 bg-white p-3 font-mono text-xs text-zinc-900 outline-none focus:ring-2 focus:ring-zinc-300",value:f,onChange:h=>u(h.target.value),placeholder:'{"suggested_source_multipliers": {"cf": 1.1, "trending": 0.95}}'}),y?e.jsx("div",{className:"mt-3 text-sm text-red-700",children:y}):null,e.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[e.jsx(Z,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(Z,{onClick:F,children:"Apply"})]})]})]}):null,t.isError?e.jsx("div",{className:"p-4",children:e.jsx(G,{title:"Failed to load app settings",error:t.error})}):null,e.jsxs("div",{className:"grid grid-cols-1 gap-4 p-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-800",children:[e.jsx("input",{type:"checkbox",checked:!!((i==null?void 0:i.enabled)??!0),onChange:h=>l(o=>o&&{...o,enabled:h.target.checked})}),"Enabled"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-zinc-800",children:[e.jsx("input",{type:"checkbox",checked:!!((i==null?void 0:i.skip_when_mix_active)??!0),onChange:h=>l(o=>o&&{...o,skip_when_mix_active:h.target.checked})}),"Skip when mix active"]})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"mb-3 text-sm font-semibold text-zinc-900",children:"Feature weights"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ce,{label:"Position",value:(i==null?void 0:i.weights.position)??1,min:0,max:3,step:.05,onChange:h=>l(o=>o&&{...o,weights:{...o.weights,position:h}}),hint:"Higher = prefer earlier candidates (stability)."}),e.jsx(ce,{label:"Popularity",value:(i==null?void 0:i.weights.popularity)??.25,min:0,max:2,step:.05,onChange:h=>l(o=>o&&{...o,weights:{...o.weights,popularity:h}}),hint:"Higher = more blockbuster bias."}),e.jsx(ce,{label:"Vote avg",value:(i==null?void 0:i.weights.vote_avg)??.15,min:0,max:2,step:.05,onChange:h=>l(o=>o&&{...o,weights:{...o.weights,vote_avg:h}}),hint:"Higher = prefer higher-rated items."}),e.jsx(ce,{label:"CF score",value:(i==null?void 0:i.weights.cf_score)??1,min:0,max:3,step:.05,onChange:h=>l(o=>o&&{...o,weights:{...o.weights,cf_score:h}}),hint:"Higher = more personalized (ALS) influence."})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[e.jsx("div",{className:"mb-3 text-sm font-semibold text-zinc-900",children:"Source multipliers"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[["for_you","For You"],["combined","Combined"],["friends","Friends"],["trending","Trending"],["cf","CF"],["seg_pop","Seg-pop"],["other","Other"]].map(([h,o])=>{var N;return e.jsx(ce,{label:o,value:((N=i==null?void 0:i.source_multipliers)==null?void 0:N[h])??1,min:0,max:2,step:.05,onChange:z=>l(C=>C&&{...C,source_multipliers:{...C.source_multipliers,[h]:z}}),hint:""},h)})}),e.jsxs("div",{className:"mt-3 text-xs text-zinc-600",children:["Tip: generate suggested multipliers from logs using ",e.jsx("span",{className:"font-mono",children:"scripts/recsys/suggest_blend_calibration.mjs"}),"."]}),g.isError?e.jsx("div",{className:"mt-3",children:e.jsx(G,{title:"Save failed",error:g.error})}):null,g.isSuccess?e.jsx("div",{className:"mt-3 text-xs text-emerald-700",children:"Saved."}):null]})]})]})}function M(t){return t==null||!Number.isFinite(t)?"â€”":`${(t*100).toFixed(1)}%`}function j(t){const a=Number(t);return Number.isFinite(a)?String(Math.trunc(a)):"0"}function mt(){var B,H,te,V,xe,he,me,ue,ge,je,pe,fe,be;const[t,a]=S.useState(30),[r,i]=S.useState("quality"),l=J({queryKey:S.useMemo(()=>["rec_variant_metrics",t],[t]),queryFn:async()=>Oe({days:t}),staleTime:3e4,refetchInterval:6e4,enabled:r==="quality"}),d=J({queryKey:S.useMemo(()=>["rec_composition_metrics",t],[t]),queryFn:async()=>Pe({days:t}),staleTime:3e4,refetchInterval:6e4,enabled:r==="composition"}),m=J({queryKey:S.useMemo(()=>["rec_genre_metrics",t],[t]),queryFn:async()=>Ae({days:t}),staleTime:3e4,refetchInterval:6e4,enabled:r==="genres"}),f=J({queryKey:S.useMemo(()=>["rec_health_metrics",t],[t]),queryFn:async()=>Ee({days:t}),staleTime:3e4,refetchInterval:6e4,enabled:r==="health"}),u=J({queryKey:S.useMemo(()=>["rec_position_metrics",t],[t]),queryFn:async()=>$e({days:t,max_position:30}),staleTime:3e4,refetchInterval:6e4,enabled:r==="positions"}),y=J({queryKey:S.useMemo(()=>["rec_alerts_metrics",t],[t]),queryFn:async()=>De({days:t}),staleTime:3e4,refetchInterval:6e4,enabled:r==="alerts"}),x=((B=l.data)==null?void 0:B.rows)??[],F=((H=d.data)==null?void 0:H.rows)??[],g=((te=m.data)==null?void 0:te.rows)??[],w=((V=f.data)==null?void 0:V.rows)??[],$=((xe=u.data)==null?void 0:xe.rows)??[],k=w[0],h=S.useMemo(()=>{const s=new Map;for(const b of $){const A=Number(b.position),X=s.get(A)??{position:A,impressions:0,likes:0,dislikes:0,watchlist_adds:0,detail_opens:0};X.impressions+=Number(b.impressions??0),X.likes+=Number(b.likes??0),X.dislikes+=Number(b.dislikes??0),X.watchlist_adds+=Number(b.watchlist_adds??0),X.detail_opens+=Number(b.detail_opens??0),s.set(A,X)}return Array.from(s.values()).sort((b,A)=>b.position-A.position).map(b=>({...b,like_rate:b.impressions?b.likes/b.impressions:0,dislike_rate:b.impressions?b.dislikes/b.impressions:0,watchlist_rate:b.impressions?b.watchlist_adds/b.impressions:0,detail_open_rate:b.impressions?b.detail_opens/b.impressions:0}))},[$]),o=F.length?F[0].day:null,N=S.useMemo(()=>F.filter(s=>o?s.day===o:!1),[F,o]),z=g.length?g[0].day:null,C=S.useMemo(()=>g.filter(s=>z?s.day===z:!1),[g,z]),K=s=>s.reduce((_,b)=>_+b,0),v=K(N.map(s=>Number(s.impressions)||0)),p=K(C.map(s=>Number(s.muted_impressions)||0));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight text-zinc-900",children:"Recsys Control Center"}),e.jsx("div",{className:"text-sm text-zinc-600",children:"Observe â†’ diagnose â†’ tune â†’ roll out (metrics, composition, drift, and controls)."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-medium text-zinc-700",children:"Window"}),e.jsxs("select",{className:oe("h-9 rounded-xl border border-zinc-200 bg-white px-3 text-sm text-zinc-900 shadow-sm","focus:outline-none focus:ring-2 focus:ring-zinc-300"),value:t,onChange:s=>a(Number(s.target.value)),children:[e.jsx("option",{value:7,children:"Last 7 days"}),e.jsx("option",{value:14,children:"Last 14 days"}),e.jsx("option",{value:30,children:"Last 30 days"}),e.jsx("option",{value:60,children:"Last 60 days"}),e.jsx("option",{value:90,children:"Last 90 days"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"health",label:"Live health"},{key:"quality",label:"Quality (A/B)"},{key:"composition",label:"Composition"},{key:"genres",label:"Genres & drift"},{key:"positions",label:"Position funnel"},{key:"alerts",label:"Alerts & guardrails"},{key:"controls",label:"Controls"}].map(s=>e.jsx("button",{onClick:()=>i(s.key),className:oe("h-9 rounded-xl border px-3 text-sm shadow-sm",r===s.key?"border-zinc-900 bg-zinc-900 text-white":"border-zinc-200 bg-white text-zinc-900 hover:bg-zinc-50"),children:s.label},s.key))}),r==="health"?e.jsxs(e.Fragment,{children:[f.isError?e.jsx(G,{title:"Failed to load health",error:f.error}):null,e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsx(T,{title:"Decks (latest day)",value:k?j(k.decks):"â€”",subtitle:k?`Day: ${k.day}`:void 0}),e.jsx(T,{title:"Impressions",value:k?j(k.impressions):"â€”",subtitle:"rec_impressions rows"}),e.jsx(T,{title:"Users",value:k?j(k.users):"â€”",subtitle:"unique users"})]}),e.jsxs(P,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-200 px-4 py-3",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:"Daily volume + feature flags"}),e.jsx("div",{className:"text-xs text-zinc-600",children:(he=f.data)!=null&&he.since?`Since ${f.data.since}`:f.isLoading?"Loadingâ€¦":"â€”"})]}),e.jsx(R,{children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(c,{children:"Day"}),e.jsx(c,{className:"text-right",children:"Decks"}),e.jsx(c,{className:"text-right",children:"Impr"}),e.jsx(c,{className:"text-right",children:"Users"}),e.jsx(c,{className:"text-right",children:"CF impr"}),e.jsx(c,{className:"text-right",children:"Mix impr"}),e.jsx(c,{className:"text-right",children:"Blend impr"}),e.jsx(c,{className:"text-right",children:"Diversity impr"})]})}),e.jsx("tbody",{children:w.length?w.map((s,_)=>e.jsxs("tr",{children:[e.jsx(n,{className:"text-xs text-zinc-700",children:s.day}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.decks)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.impressions)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.users)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.cf_impressions)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.impressions_in_mix_decks)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.impressions_in_blend_decks)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.impressions_in_diversity_decks)})]},`${s.day}:${_}`)):e.jsx("tr",{children:e.jsx(n,{colSpan:8,className:"py-8 text-center text-sm text-zinc-600",children:f.isLoading?"Loadingâ€¦":"No data yet."})})})]})})]})]}):null,r==="quality"?e.jsxs(e.Fragment,{children:[l.isError?e.jsx(G,{title:"Failed to load metrics",error:l.error}):null,e.jsxs(P,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-200 px-4 py-3",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:"Daily experiment metrics"}),e.jsx("div",{className:"text-xs text-zinc-600",children:(me=l.data)!=null&&me.since?`Since ${l.data.since}`:l.isLoading?"Loadingâ€¦":"â€”"})]}),e.jsx(R,{children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(c,{children:"Day"}),e.jsx(c,{children:"Experiment"}),e.jsx(c,{children:"Variant"}),e.jsx(c,{className:"text-right",children:"Impr"}),e.jsx(c,{className:"text-right",children:"Users"}),e.jsx(c,{className:"text-right",children:"Detail"}),e.jsx(c,{className:"text-right",children:"Likes"}),e.jsx(c,{className:"text-right",children:"Watchlist"}),e.jsx(c,{className:"text-right",children:"Like rate"}),e.jsx(c,{className:"text-right",children:"WL rate"})]})}),e.jsx("tbody",{children:x.length?x.map((s,_)=>e.jsxs("tr",{children:[e.jsx(n,{className:"text-xs text-zinc-700",children:s.day}),e.jsx(n,{className:"text-xs",children:s.experiment_key}),e.jsx(n,{className:"text-xs font-medium",children:s.variant}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.impressions)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.users)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.detail_opens)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.likes)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.watchlist_adds)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:M(s.like_rate)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:M(s.watchlist_add_rate)})]},`${s.day}:${s.experiment_key}:${s.variant}:${_}`)):e.jsx("tr",{children:e.jsx(n,{colSpan:10,className:"py-8 text-center text-sm text-zinc-600",children:l.isLoading?"Loadingâ€¦":"No data yet. Once users swipe, metrics will appear here."})})})]})})]})]}):null,r==="composition"?e.jsxs(e.Fragment,{children:[d.isError?e.jsx(G,{title:"Failed to load composition",error:d.error}):null,e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsx(T,{title:"Latest day",value:o??"â€”",subtitle:"Composition snapshot"}),e.jsx(T,{title:"Total impressions",value:v?j(v):"â€”",subtitle:"Across all sources"}),e.jsx(T,{title:"Top source share",value:v&&N.length?(()=>{const s=[...N].sort((b,A)=>(A.impressions??0)-(b.impressions??0))[0],_=(Number(s==null?void 0:s.impressions)||0)/v;return`${(s==null?void 0:s.source)??"â€”"} Â· ${(_*100).toFixed(0)}%`})():"â€”",subtitle:"Source dominance (watch for drift)"})]}),e.jsxs(P,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-200 px-4 py-3",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:"Daily source metrics"}),e.jsx("div",{className:"text-xs text-zinc-600",children:(ue=d.data)!=null&&ue.since?`Since ${d.data.since}`:d.isLoading?"Loadingâ€¦":"â€”"})]}),e.jsx(R,{children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(c,{children:"Day"}),e.jsx(c,{children:"Mode"}),e.jsx(c,{children:"Source"}),e.jsx(c,{className:"text-right",children:"Impr"}),e.jsx(c,{className:"text-right",children:"Users"}),e.jsx(c,{className:"text-right",children:"Like rate"}),e.jsx(c,{className:"text-right",children:"WL rate"}),e.jsx(c,{className:"text-right",children:"Share"})]})}),e.jsx("tbody",{children:F.length?F.map((s,_)=>{const A=(o?s.day===o:!1)&&v?(Number(s.impressions)||0)/v:null;return e.jsxs("tr",{children:[e.jsx(n,{className:"text-xs text-zinc-700",children:s.day}),e.jsx(n,{className:"text-xs",children:s.mode}),e.jsx(n,{className:"text-xs font-medium",children:s.source}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.impressions)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.users)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:M(s.like_rate)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:M(s.watchlist_add_rate)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:A==null?"â€”":`${(A*100).toFixed(0)}%`})]},`${s.day}:${s.mode}:${s.source}:${_}`)}):e.jsx("tr",{children:e.jsx(n,{colSpan:8,className:"py-8 text-center text-sm text-zinc-600",children:d.isLoading?"Loadingâ€¦":"No data yet."})})})]})})]})]}):null,r==="genres"?e.jsxs(e.Fragment,{children:[m.isError?e.jsx(G,{title:"Failed to load genre metrics",error:m.error}):null,e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsx(T,{title:"Latest day",value:z??"â€”",subtitle:"Genre exposure snapshot"}),e.jsx(T,{title:"Muted leakage (latest)",value:z?j(p):"â€”",subtitle:"Should trend to 0"}),e.jsx(T,{title:"Drift signal",value:C.length?(()=>{const s=[...C].map(_=>({slug:_.genre_slug,d:Math.abs((_.share_day??0)-(_.share_catalog??0))})).sort((_,b)=>b.d-_.d)[0];return s?`${s.slug} Â· ${(s.d*100).toFixed(1)}pp`:"â€”"})():"â€”",subtitle:"Largest |share_day - share_catalog|"})]}),e.jsxs(P,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-200 px-4 py-3",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:"Daily genre exposure"}),e.jsx("div",{className:"text-xs text-zinc-600",children:(ge=m.data)!=null&&ge.since?`Since ${m.data.since}`:m.isLoading?"Loadingâ€¦":"â€”"})]}),e.jsx(R,{children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(c,{children:"Day"}),e.jsx(c,{children:"Genre"}),e.jsx(c,{className:"text-right",children:"Impr"}),e.jsx(c,{className:"text-right",children:"Users"}),e.jsx(c,{className:"text-right",children:"Share (day)"}),e.jsx(c,{className:"text-right",children:"Share (catalog)"}),e.jsx(c,{className:"text-right",children:"Î”"}),e.jsx(c,{className:"text-right",children:"Muted leak"})]})}),e.jsx("tbody",{children:g.length?g.map((s,_)=>{const b=(s.share_day??0)-(s.share_catalog??0),A=Number(s.muted_impressions)||0;return e.jsxs("tr",{children:[e.jsx(n,{className:"text-xs text-zinc-700",children:s.day}),e.jsx(n,{className:"text-xs font-medium",children:s.genre_slug}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.impressions)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.users)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:M(s.share_day)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:M(s.share_catalog)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:`${(b*100).toFixed(1)}pp`}),e.jsx(n,{className:oe("text-right text-xs tabular-nums",A>0?"font-semibold text-red-600":"text-zinc-700"),children:j(A)})]},`${s.day}:${s.genre_slug}:${_}`)}):e.jsx("tr",{children:e.jsx(n,{colSpan:8,className:"py-8 text-center text-sm text-zinc-600",children:m.isLoading?"Loadingâ€¦":"No data yet."})})})]})})]})]}):null,r==="positions"?e.jsxs(e.Fragment,{children:[u.isError?e.jsx(G,{title:"Failed to load position metrics",error:u.error}):null,e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs(P,{className:"p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-zinc-900",children:"Like rate by position"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(le,{data:h,margin:{top:10,right:20,bottom:10,left:0},children:[e.jsx(ee,{strokeDasharray:"3 3"}),e.jsx(ie,{dataKey:"position",tick:{fontSize:12}}),e.jsx(ae,{tick:{fontSize:12},domain:[0,1]}),e.jsx(re,{formatter:s=>`${(Number(s)*100).toFixed(1)}%`}),e.jsx(ne,{}),e.jsx(D,{type:"monotone",dataKey:"like_rate",name:"Like rate",dot:!1}),e.jsx(D,{type:"monotone",dataKey:"dislike_rate",name:"Dislike rate",dot:!1})]})})})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-zinc-900",children:"Engagement by position"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(le,{data:h,margin:{top:10,right:20,bottom:10,left:0},children:[e.jsx(ee,{strokeDasharray:"3 3"}),e.jsx(ie,{dataKey:"position",tick:{fontSize:12}}),e.jsx(ae,{tick:{fontSize:12},domain:[0,1]}),e.jsx(re,{formatter:s=>`${(Number(s)*100).toFixed(1)}%`}),e.jsx(ne,{}),e.jsx(D,{type:"monotone",dataKey:"detail_open_rate",name:"Detail open rate",dot:!1}),e.jsx(D,{type:"monotone",dataKey:"watchlist_rate",name:"Watchlist add rate",dot:!1})]})})})]})]}),e.jsxs(P,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-200 px-4 py-3",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:"Aggregated counts by position (window)"}),e.jsx("div",{className:"text-xs text-zinc-600",children:u.data?`Since ${u.data.since}`:u.isLoading?"Loadingâ€¦":"â€”"})]}),e.jsx(R,{children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-zinc-200 text-xs uppercase tracking-wide text-zinc-600",children:[e.jsx(c,{children:"Pos"}),e.jsx(c,{className:"text-right",children:"Impr"}),e.jsx(c,{className:"text-right",children:"Likes"}),e.jsx(c,{className:"text-right",children:"Dislikes"}),e.jsx(c,{className:"text-right",children:"Detail opens"}),e.jsx(c,{className:"text-right",children:"Watchlist"}),e.jsx(c,{className:"text-right",children:"Like rate"})]})}),e.jsx("tbody",{children:h.map(s=>e.jsxs("tr",{className:"border-b border-zinc-100 text-sm",children:[e.jsx(n,{children:s.position}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.impressions)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.likes)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.dislikes)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.detail_opens)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.watchlist_adds)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:M(s.like_rate)})]},s.position))})]})})]})]}):r==="positions"?e.jsxs(e.Fragment,{children:[u.isError?e.jsx(G,{title:"Failed to load position metrics",error:u.error}):null,e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs(P,{className:"p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-zinc-900",children:"Like / dislike rate by position"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(le,{data:h,margin:{top:8,right:16,bottom:8,left:0},children:[e.jsx(ee,{strokeDasharray:"3 3"}),e.jsx(ie,{dataKey:"position",tick:{fontSize:12}}),e.jsx(ae,{tickFormatter:s=>`${Math.round(s*100)}%`,domain:[0,"auto"],tick:{fontSize:12}}),e.jsx(re,{formatter:s=>`${(Number(s)*100).toFixed(1)}%`}),e.jsx(ne,{}),e.jsx(D,{type:"monotone",dataKey:"like_rate",name:"Like rate",dot:!1}),e.jsx(D,{type:"monotone",dataKey:"dislike_rate",name:"Dislike rate",dot:!1})]})})})]}),e.jsxs(P,{className:"p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-zinc-900",children:"Engagement by position"}),e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(le,{data:h,margin:{top:8,right:16,bottom:8,left:0},children:[e.jsx(ee,{strokeDasharray:"3 3"}),e.jsx(ie,{dataKey:"position",tick:{fontSize:12}}),e.jsx(ae,{tickFormatter:s=>`${Math.round(s*100)}%`,domain:[0,"auto"],tick:{fontSize:12}}),e.jsx(re,{formatter:s=>`${(Number(s)*100).toFixed(1)}%`}),e.jsx(ne,{}),e.jsx(D,{type:"monotone",dataKey:"detail_open_rate",name:"Detail open rate",dot:!1}),e.jsx(D,{type:"monotone",dataKey:"watchlist_rate",name:"Watchlist add rate",dot:!1})]})})})]})]}),e.jsxs(P,{className:"p-0",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-zinc-200 px-4 py-3",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:"Aggregated funnel table"}),e.jsx("div",{className:"text-xs text-zinc-600",children:u.data?`Since ${u.data.since}`:u.isLoading?"Loadingâ€¦":"â€”"})]}),e.jsx(R,{children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-zinc-200",children:[e.jsx(c,{children:"Pos"}),e.jsx(c,{className:"text-right",children:"Impr"}),e.jsx(c,{className:"text-right",children:"Likes"}),e.jsx(c,{className:"text-right",children:"Dislikes"}),e.jsx(c,{className:"text-right",children:"Detail opens"}),e.jsx(c,{className:"text-right",children:"Watchlist"}),e.jsx(c,{className:"text-right",children:"Like rate"})]})}),e.jsx("tbody",{children:h.map(s=>e.jsxs("tr",{className:"border-b border-zinc-100",children:[e.jsx(n,{children:s.position}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.impressions)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.likes)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.dislikes)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.detail_opens)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:j(s.watchlist_adds)}),e.jsx(n,{className:"text-right text-xs tabular-nums",children:M(s.like_rate)})]},s.position))})]})})]})]}):r==="alerts"?e.jsxs(e.Fragment,{children:[y.isError?e.jsx(G,{title:"Failed to load alerts",error:y.error}):null,e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs(P,{className:"p-4 md:col-span-2",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-zinc-900",children:"Guardrail rates over time"}),e.jsx("div",{className:"h-72",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(le,{data:((je=y.data)==null?void 0:je.daily)??[],margin:{top:10,right:20,bottom:10,left:0},children:[e.jsx(ee,{strokeDasharray:"3 3"}),e.jsx(ie,{dataKey:"day",tick:{fontSize:12}}),e.jsx(ae,{tick:{fontSize:12}}),e.jsx(re,{}),e.jsx(ne,{}),e.jsx(D,{type:"monotone",dataKey:"like_rate",name:"Like rate",dot:!1}),e.jsx(D,{type:"monotone",dataKey:"watchlist_rate",name:"Watchlist add rate",dot:!1}),e.jsx(D,{type:"monotone",dataKey:"cf_share",name:"CF share",dot:!1})]})})}),e.jsx("div",{className:"mt-2 text-xs text-zinc-600",children:"Guardrails compare today vs trailing 7-day average and require enough volume (â‰¥200 impressions/day)."})]}),e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"mb-2 text-sm font-semibold text-zinc-900",children:["Active alerts (last ",t,"d)"]}),e.jsxs("div",{className:"space-y-2",children:[(((pe=y.data)==null?void 0:pe.alerts)??[]).slice(0,10).map((s,_)=>e.jsxs("div",{className:"rounded-xl border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-900",children:s.alert_key}),e.jsx("div",{className:oe("rounded-full px-2 py-0.5 text-xs font-semibold",s.severity==="high"?"bg-red-100 text-red-800":s.severity==="medium"?"bg-amber-100 text-amber-900":"bg-zinc-100 text-zinc-800"),children:s.severity})]}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-700",children:[s.day,": ",s.message]})]},_)),(((fe=y.data)==null?void 0:fe.alerts)??[]).length===0?e.jsx("div",{className:"rounded-xl border p-3 text-xs text-zinc-700",children:"No active alerts ðŸŽ‰"}):null]})]})]}),e.jsxs(P,{className:"mt-3 p-4",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-zinc-900",children:"Daily guardrail table"}),e.jsx(R,{children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(c,{children:"Day"}),e.jsx(c,{className:"text-right",children:"Impr"}),e.jsx(c,{className:"text-right",children:"Like%"}),e.jsx(c,{className:"text-right",children:"WL%"}),e.jsx(c,{className:"text-right",children:"CF%"}),e.jsx(c,{className:"text-right",children:"Muted"}),e.jsx(c,{children:"Flags"})]})}),e.jsx("tbody",{children:(((be=y.data)==null?void 0:be.daily)??[]).slice().reverse().map((s,_)=>e.jsxs("tr",{className:"border-t",children:[e.jsx(n,{children:s.day}),e.jsx(n,{className:"text-right",children:j(s.impressions)}),e.jsx(n,{className:"text-right",children:M(s.like_rate)}),e.jsx(n,{className:"text-right",children:M(s.watchlist_rate)}),e.jsx(n,{className:"text-right",children:M(s.cf_share)}),e.jsx(n,{className:"text-right",children:j(s.muted_impressions)}),e.jsx(n,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.alert_muted_leakage?e.jsx("span",{className:"rounded-full bg-red-100 px-2 py-0.5 text-xs font-semibold text-red-800",children:"Muted leakage"}):null,s.alert_like_rate_drop?e.jsx("span",{className:"rounded-full bg-amber-100 px-2 py-0.5 text-xs font-semibold text-amber-900",children:"Like drop"}):null,s.alert_watchlist_rate_drop?e.jsx("span",{className:"rounded-full bg-amber-100 px-2 py-0.5 text-xs font-semibold text-amber-900",children:"WL drop"}):null,s.alert_cf_starvation?e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-0.5 text-xs font-semibold text-zinc-800",children:"CF=0"}):null]})})]},_))})]})})]})]}):r==="controls"?e.jsx(e.Fragment,{children:e.jsx(at,{})}):null]})}export{mt as default};
