import{r as _,j as e,B as F,L as Qe,f as I,J as ys,K as _s,M as zs,N as ws,O as ks,P as Ss,Q as Cs,E as Os,R as As,G as Ms}from"./index-CRBf6KpQ.js";import{u as je,E as Me}from"./ErrorBox-DVY8vL3c.js";import{u as fe}from"./useMutation-DfZD1PiA.js";import{S as Z}from"./StatCard-B7MZSLFj.js";import{C as L}from"./Card-BKQRm7Rb.js";import{C as pe}from"./CopyButton-CqevYxQn.js";import{H as K,g as Ps,S as Rs,a as qs}from"./settingsHints-C505o_Eo.js";import{I as ue}from"./Input-eqrST-0v.js";import{T as X,a as h,b as p}from"./Table-C_8f92Ce.js";import{E as Et}from"./EmptyState-DFwSBMQU.js";import{R as Jt,X as Tt,Y as Bt,T as Kt,B as Xe}from"./generateCategoricalChart-BZg-UuSW.js";import{B as Fs}from"./BarChart-CiVGKepq.js";import{L as Ds,a as Is}from"./LineChart-BmTb63kD.js";function oe(s){return!!s&&typeof s=="object"&&!Array.isArray(s)}function Yt(s){const n=[];for(const v of s){const j=String(v??"").trim();j&&(n.includes(j)||n.push(j))}return n}function Ge(s){return Yt(String(s??"").split(/\r?\n/).map(n=>n.trim()).filter(Boolean))}function et(s){return Array.isArray(s)?s.map(n=>String(n??"").trim()).filter(Boolean).join(`
`):""}function Ls(s){return Yt(String(s??"").split(",").map(n=>n.trim()).filter(Boolean))}function Es(s){return Array.isArray(s)?s.map(n=>String(n??"").trim()).filter(Boolean).join(", "):""}function ve(s){const n=Number(s);if(Number.isFinite(n))return n}function $t(s){if(typeof s=="number"&&Number.isFinite(s))return s;if(typeof s=="string"){const n=Number(s);if(Number.isFinite(n))return n}if(oe(s)){const n={};for(const v of["p50","p75","p90","p99"]){const j=Number(s[v]);Number.isFinite(j)&&(n[v]=j)}return Object.keys(n).length?n:void 0}}function Ut(s){const n={};if(typeof s=="number"&&Number.isFinite(s))return{mode:"single",single:String(s),p:n};if(typeof s=="string"&&s.trim()){const v=Number(s);if(Number.isFinite(v))return{mode:"single",single:String(v),p:n}}if(oe(s)){for(const v of["p50","p75","p90","p99"]){const j=Number(s[v]);Number.isFinite(j)&&(n[v]=j)}return{mode:Object.keys(n).length?"percentiles":"single",single:"",p:n}}return{mode:"single",single:"",p:n}}function Js(s){const n=_.useMemo(()=>oe(s.value)?s.value:{},[s.value]),v=_.useMemo(()=>{const o=Array.isArray(s.providerOptions)?s.providerOptions:[],O=new Map;for(const J of o){const W=String((J==null?void 0:J.slug)??"").trim();W&&(O.has(W)||O.set(W,{slug:W,name:(J==null?void 0:J.name)??null}))}return Array.from(O.values()).sort((J,W)=>J.slug.localeCompare(W.slug))},[s.providerOptions]),j=o=>{s.onChange({...n??{},...o})},k=(o,O)=>{const J={...n??{}};O==null||typeof O=="string"&&O.trim()===""?delete J[o]:J[o]=O,s.onChange(Object.keys(J).length?J:null)},E=Ut(n.preferred_min_throughput),P=Ut(n.preferred_max_latency),U=oe(n.max_price)?n.max_price:{};return e.jsxs("div",{className:s.className,children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Provider routing policy (OpenRouter)"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Sort"}),e.jsxs("select",{value:typeof n.sort=="string"?n.sort:oe(n.sort)?n.sort.by:"",onChange:o=>{const O=o.target.value;if(!O)return k("sort",void 0);const J=n.sort;if(oe(J)){const W=J.partition;k("sort",{by:O,...W?{partition:W}:{}})}else k("sort",O)},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"(default)"}),e.jsx("option",{value:"price",children:"Price"}),e.jsx("option",{value:"throughput",children:"Throughput"}),e.jsx("option",{value:"latency",children:"Latency"})]}),e.jsx("span",{className:"text-[11px] text-zinc-400",children:"Setting sort disables OpenRouter load balancing."})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Sort partition"}),e.jsxs("select",{value:oe(n.sort)?String(n.sort.partition??""):"",onChange:o=>{const O=o.target.value||void 0;n.sort&&(typeof n.sort=="string"?k("sort",{by:n.sort,...O?{partition:O}:{}}):k("sort",{...n.sort,...O?{partition:O}:{}}))},disabled:!n.sort,className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm disabled:opacity-50",children:[e.jsx("option",{value:"",children:"(none)"}),e.jsx("option",{value:"model",children:"Model"}),e.jsx("option",{value:"none",children:"None"})]}),e.jsx("span",{className:"text-[11px] text-zinc-400",children:'Use "model" if you use model fallbacks.'})]}),e.jsx("div",{className:"flex items-end justify-end gap-2",children:e.jsx(F,{variant:"secondary",onClick:()=>s.onChange(null),title:"Remove the provider policy section (OpenRouter defaults will apply)",children:"Clear"})})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider order (one per line)"}),e.jsx("textarea",{value:et(n.order),onChange:o=>k("order",Ge(o.target.value)),placeholder:v.slice(0,8).map(o=>o.slug).join(`
`),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono"}),e.jsx("span",{className:"text-[11px] text-zinc-400",children:"If set, OpenRouter tries providers in this order first."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Only allow (one per line)"}),e.jsx("textarea",{value:et(n.only),onChange:o=>k("only",Ge(o.target.value)),placeholder:"openai\\nanthropic\\n...",className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Ignore providers (one per line)"}),e.jsx("textarea",{value:et(n.ignore),onChange:o=>k("ignore",Ge(o.target.value)),placeholder:"together\\n...",className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono"})]})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!(n.allow_fallbacks??!0),onChange:o=>j({allow_fallbacks:o.target.checked})}),e.jsx("span",{children:"Allow fallbacks"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!(n.require_parameters??!1),onChange:o=>k("require_parameters",o.target.checked)}),e.jsx("span",{children:"Require parameters support"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!(n.zdr??!1),onChange:o=>k("zdr",o.target.checked)}),e.jsx("span",{children:"ZDR"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!(n.enforce_distillable_text??!1),onChange:o=>k("enforce_distillable_text",o.target.checked)}),e.jsx("span",{children:"Enforce distillable text"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Data collection"}),e.jsxs("select",{value:String(n.data_collection??""),onChange:o=>{const O=o.target.value;if(!O)return k("data_collection",void 0);k("data_collection",O==="deny"?"deny":"allow")},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"(default)"}),e.jsx("option",{value:"allow",children:"Allow"}),e.jsx("option",{value:"deny",children:"Deny"})]}),e.jsx("span",{className:"text-[11px] text-zinc-400",children:"If set to deny, OpenRouter filters providers by their policy."})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Quantizations (comma-separated)"}),e.jsx(ue,{value:Es(n.quantizations),onChange:o=>k("quantizations",Ls(o.target.value)),placeholder:"int8, fp16, bf16"}),e.jsx("span",{className:"text-[11px] text-zinc-400",children:"Optional preference; availability depends on the provider."})]})]}),e.jsxs("div",{className:"mt-3 rounded-lg border border-zinc-200 bg-zinc-50 p-3",children:[e.jsx("div",{className:"text-[11px] font-semibold text-zinc-600",children:"Performance preferences"}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Preferred min throughput"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"throughput_mode",checked:E.mode==="single",onChange:()=>{const o=$t(E.single);k("preferred_min_throughput",typeof o=="number"?o:void 0)}}),e.jsx("span",{children:"Single"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"throughput_mode",checked:E.mode==="percentiles",onChange:()=>k("preferred_min_throughput",{...E.p||{}})}),e.jsx("span",{children:"Percentiles"})]})]}),E.mode==="single"?e.jsxs("div",{className:"mt-2",children:[e.jsx(ue,{inputMode:"decimal",value:E.single,onChange:o=>k("preferred_min_throughput",ve(o.target.value)),placeholder:"e.g. 50"}),e.jsx("div",{className:"mt-1 text-[11px] text-zinc-400",children:"Tokens/sec threshold (approx)."})]}):e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:["p50","p75","p90","p99"].map(o=>e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:o}),e.jsx(ue,{inputMode:"decimal",value:String(E.p[o]??""),onChange:O=>k("preferred_min_throughput",{...E.p||{},[o]:ve(O.target.value)}),placeholder:"e.g. 50"})]},o))})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Preferred max latency"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"latency_mode",checked:P.mode==="single",onChange:()=>{const o=$t(P.single);k("preferred_max_latency",typeof o=="number"?o:void 0)}}),e.jsx("span",{children:"Single"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"latency_mode",checked:P.mode==="percentiles",onChange:()=>k("preferred_max_latency",{...P.p||{}})}),e.jsx("span",{children:"Percentiles"})]})]}),P.mode==="single"?e.jsxs("div",{className:"mt-2",children:[e.jsx(ue,{inputMode:"decimal",value:P.single,onChange:o=>k("preferred_max_latency",ve(o.target.value)),placeholder:"e.g. 2.5"}),e.jsx("div",{className:"mt-1 text-[11px] text-zinc-400",children:"Seconds threshold (approx)."})]}):e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:["p50","p75","p90","p99"].map(o=>e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:o}),e.jsx(ue,{inputMode:"decimal",value:String(P.p[o]??""),onChange:O=>k("preferred_max_latency",{...P.p||{},[o]:ve(O.target.value)}),placeholder:"e.g. 2.5"})]},o))})]})]}),e.jsxs("div",{className:"mt-3 rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Max price (optional)"}),e.jsx("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-4",children:[["prompt","Prompt"],["completion","Completion"],["request","Request"],["image","Image"]].map(([o,O])=>e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:O}),e.jsx(ue,{inputMode:"decimal",value:String(U[o]??""),onChange:J=>{const W=ve(J.target.value),g={...U};W===void 0?delete g[o]:g[o]=W,k("max_price",Object.keys(g).length?g:void 0)},placeholder:"e.g. 0.0005"})]},o))}),e.jsx("div",{className:"mt-1 text-[11px] text-zinc-400",children:"Values are in $/token for prompt/completion, $/request for request, and $/image for image."})]})]})]})}function Ts(s){return e.jsx("div",{className:"mb-4 text-xl font-semibold tracking-tight",children:s.children})}function Wt(s){return isFinite(s)?`${Math.round(s*100)}%`:"0%"}function le(s){if(!s)return"";const n=new Date(s);return isFinite(n.getTime())?n.toISOString().replace("T"," ").slice(0,16):String(s)}function Bs(s){var v,j;return s?Array.isArray(s)?s:(Array.isArray(s==null?void 0:s.data)?s.data:null)??(Array.isArray(s==null?void 0:s.endpoints)?s.endpoints:null)??(Array.isArray(s==null?void 0:s.items)?s.items:null)??(Array.isArray(s==null?void 0:s.entries)?s.entries:null)??(Array.isArray((v=s==null?void 0:s.data)==null?void 0:v.endpoints)?s.data.endpoints:null)??(Array.isArray((j=s==null?void 0:s.endpoints)==null?void 0:j.data)?s.endpoints.data:null)??[]:[]}function Ks(s){if(!s||typeof s!="object")return null;const n=s.provider??s.provider_name??s.providerName??null;if(typeof n=="string"&&n.trim())return n.trim();if(n&&typeof n=="object"){const j=n.slug??n.id??n.name??null;if(typeof j=="string"&&j.trim())return j.trim()}const v=s.name??s.provider_id??null;return typeof v=="string"&&v.trim()?v.trim():null}const Ne=[{key:"temperature",label:"Temperature",type:"number",min:0,max:2,step:.05},{key:"top_p",label:"Top P",type:"number",min:0,max:1,step:.05},{key:"max_output_tokens",label:"Max output tokens",type:"number",min:1,max:32768,step:1},{key:"verbosity",label:"Verbosity",type:"text"},{key:"reasoning",label:"Reasoning (JSON)",type:"json"},{key:"native_tool_calling",label:"Native tool calling",type:"boolean"},{key:"native_tool_max_loops",label:"Native tool max loops",type:"number",min:1,max:12,step:1},{key:"native_tool_max_calls_per_loop",label:"Native tool max calls per loop",type:"number",min:1,max:20,step:1},{key:"presence_penalty",label:"Presence penalty",type:"number",min:-2,max:2,step:.1},{key:"frequency_penalty",label:"Frequency penalty",type:"number",min:-2,max:2,step:.1},{key:"seed",label:"Seed",type:"number",min:0,max:2e9,step:1},{key:"stop",label:"Stop sequences",type:"string-array"},{key:"logprobs",label:"Logprobs",type:"boolean"},{key:"top_logprobs",label:"Top logprobs",type:"number",min:0,max:20,step:1},{key:"parallel_tool_calls",label:"Parallel tool calls",type:"boolean"},{key:"stream",label:"Stream",type:"boolean"},{key:"stream_passthrough",label:"Stream passthrough (SSE)",type:"boolean"},{key:"timeout_ms",label:"Timeout (ms)",type:"number",min:1e3,max:12e4,step:1e3},{key:"user",label:"User",type:"text"},{key:"metadata",label:"Metadata (JSON)",type:"json"},{key:"tools",label:"Tools (JSON)",type:"json"},{key:"tool_choice",label:"Tool choice (JSON)",type:"json"},{key:"response_format",label:"Response format (JSON)",type:"json"},{key:"response_healing",label:"Response healing (plugin)",type:"boolean"},{key:"web_search",label:"Web search (plugin)",type:"boolean"},{key:"web_search_mode",label:"Web search mode (off/auto/always)",type:"text"},{key:"web_max_results",label:"Web search max results",type:"number",min:1,max:10,step:1},{key:"web_engine",label:"Web search engine (native/exa)",type:"text"},{key:"web_search_prompt",label:"Web search prompt",type:"text"},{key:"plugins",label:"Plugins (JSON)",type:"json"}],se=s=>s.split(`
`).map(n=>n.trim()).filter(Boolean),G=s=>Array.isArray(s)?s.join(`
`):"";function re(s){return!!s&&typeof s=="object"&&!Array.isArray(s)}function ae(s){return s===void 0?s:JSON.parse(JSON.stringify(s))}function x(s,n,v){let j=s;for(const k of n){if(!j||typeof j!="object")return v;j=j[k]}return j===void 0?v:j}function w(s,n,v){let j=s;for(let k=0;k<n.length-1;k++){const E=n[k];(!j[E]||typeof j[E]!="object")&&(j[E]={}),j=j[E]}j[n[n.length-1]]=v}function Pe(s){if(s===null)return"null";if(s===void 0)return"undefined";if(typeof s=="string")return s.length>120?`${s.slice(0,117)}…`:s;if(typeof s=="number"||typeof s=="boolean")return String(s);try{const n=JSON.stringify(s);return n.length>200?`${n.slice(0,197)}…`:n}catch{return String(s)}}function Re(s){return s===!0?"on":s===!1?"off":"auto"}function qe(s){if(s==="on")return!0;if(s==="off")return!1}function Ht(s){if(!re(s))return{routing:null,decision:null};const n=re(s.routing)?s.routing:null,v=re(s.decision)?s.decision:null;return{routing:n,decision:v}}function Vt(s){if(!re(s))return null;const n=re(s.routing)?s.routing:null,v=n&&re(n.zdr)?n.zdr:null;return v||(re(s.zdr)?s.zdr:null)}function tt(s,n,v=""){if(s===n)return[];const j=re(s),k=re(n);if(j&&k){const E=Array.from(new Set([...Object.keys(s),...Object.keys(n)])).sort(),P=[];for(const U of E){const o=v?`${v}.${U}`:U;P.push(...tt(s[U],n[U],o))}return P}if(Array.isArray(s)&&Array.isArray(n)){const E=JSON.stringify(s),P=JSON.stringify(n);return E===P?[]:[{path:v||"(root)",a:s,b:n}]}return[{path:v||"(root)",a:s,b:n}]}function nr(){var gt,bt,jt;const[s,n]=_.useState(null),[v,j]=_.useState(null),[k,E]=_.useState(14),[P,U]=_.useState("metrics"),[o,O]=_.useState(14),[J,W]=_.useState(!1),[g,T]=_.useState(null),[st,ye]=_.useState(null),[rt,Zt]=_.useState(!1),[nt,Qt]=_.useState(!1),[Fe,Xt]=_.useState("Reply with exactly: OK"),[De,Gt]=_.useState("fast"),[A,Ie]=_.useState(null),[lt,Le]=_.useState(null),[Ee,es]=_.useState("Reply with exactly: OK"),[Je,ts]=_.useState("current"),[it,ss]=_.useState(!1),[y,Te]=_.useState(null),[at,Be]=_.useState(null),[rs,ot]=_.useState(!1),[V,ns]=_.useState(null),[ls,ct]=_.useState(!1),[H,dt]=_.useState(null),[_e,Ke]=_.useState(null),[$e,is]=_.useState(50),[Ue,as]=_.useState(""),[We,os]=_.useState("assistant-chat-reply"),xt=()=>{ct(!1),dt(null)},ze=je({queryKey:["assistant-metrics",o],queryFn:()=>Ss({days:o}),enabled:P==="metrics"}),ie=je({queryKey:["assistant-health"],queryFn:()=>Cs(),enabled:P==="diagnostics",refetchInterval:15e3}),he=je({queryKey:["assistant-settings"],queryFn:()=>Os(),enabled:P==="settings"}),ge=je({queryKey:["openrouter-request-log",{limit:$e,requestId:Ue,fn:We}],queryFn:()=>As({limit:$e,request_id:Ue.trim()||null,fn:We.trim()||null}),enabled:P==="diagnostics"}),Ve=je({queryKey:["openrouter-endpoints",(g==null?void 0:g.openrouter_base_url)??null],queryFn:()=>{var l;return Ms({base_url:((l=g==null?void 0:g.openrouter_base_url)==null?void 0:l.trim())||null})},enabled:P==="settings"}),we=fe({mutationFn:l=>ys(l),onSuccess:()=>{W(!1),he.refetch()}}),Ye=fe({mutationFn:l=>_s(l),onSuccess:l=>{Le(null),Ie(l)},onError:l=>{Ie(null),Le((l==null?void 0:l.message)??"Provider test failed")}}),He=fe({mutationFn:l=>zs(l),onSuccess:l=>{Be(null),Te(l)},onError:l=>{Te(null),Be((l==null?void 0:l.message)??"Routing test failed")}}),ce=fe({mutationFn:l=>ws(l??null),onSuccess:(l,i)=>{var N;j(null);const u=Number((l==null?void 0:l.affected)??((N=l==null?void 0:l.data)==null?void 0:N.affected)??0),d=i&&String(i).trim()?String(i).trim():"all models";n(`Circuit reset: ${d} (${u} row${u===1?"":"s"})`),ie.refetch()},onError:l=>{n(null),j((l==null?void 0:l.message)??"Failed to reset circuit")}}),be=fe({mutationFn:l=>ks({keep_days:l}),onSuccess:l=>{var d,N;j(null);const i=Number((l==null?void 0:l.deleted)??((d=l==null?void 0:l.data)==null?void 0:d.deleted)??0),u=Number((l==null?void 0:l.keep_days)??((N=l==null?void 0:l.data)==null?void 0:N.keep_days)??14);n(`Circuit history cleaned: deleted ${i} row${i===1?"":"s"} (kept ${u}d)`),ie.refetch()},onError:l=>{n(null),j((l==null?void 0:l.message)??"Failed to cleanup circuit history")}}),R=ze.data,cs=_.useMemo(()=>((R==null?void 0:R.series)??[]).map(l=>({...l,day:String(l.day).slice(5)})),[R]),ds=_.useMemo(()=>((R==null?void 0:R.trigger_series)??[]).map(l=>({...l,day:String(l.day).slice(5)})),[R]),xs=(R==null?void 0:R.by_surface_kind)??[],ms=(R==null?void 0:R.triggers)??[],c=ie.data,de=he.data,S=de==null?void 0:de.assistant_settings,$=(gt=de==null?void 0:de.defaults)==null?void 0:gt.settings,xe=((bt=ge.data)==null?void 0:bt.rows)??[],ne=Ve.data,mt=Array.isArray(ne==null?void 0:ne.zdr_endpoints)?ne.zdr_endpoints:[],us=_.useMemo(()=>{const l=(ne==null?void 0:ne.payload)??null,i=Bs(l),u=new Map;for(const d of i){const N=Ks(d);if(!N)continue;let q=null;const Q=d.provider??d.provider_name??null;if(Q&&typeof Q=="object"){const ee=Q.name??Q.display_name??null;typeof ee=="string"&&ee.trim()&&(q=ee.trim())}!q&&typeof d.provider_name=="string"&&d.provider_name.trim()&&(q=String(d.provider_name).trim()),u.has(N)||u.set(N,{slug:N,name:q})}return Array.from(u.values()).sort((d,N)=>d.slug.localeCompare(N.slug))},[ne]),ke=_.useMemo(()=>xe.find(l=>String(l.id)===String(_e))??null,[xe,_e]),me=_.useMemo(()=>{let l=0,i=0,u=0,d=0;for(const N of xe){const q=Vt(N.meta);q&&(q.requested&&(l+=1),q.used&&(i+=1),q.requested&&!q.used&&(d+=1),q.sensitive&&(u+=1))}return{requested:l,used:i,fallback:d,sensitive:u}},[xe]),C=($==null?void 0:$.behavior)??{},f=_.useMemo(()=>{const l=((g==null?void 0:g.behavior_json)??"").trim();if(!l)return{ok:!0,value:ae(C)};try{return{ok:!0,value:JSON.parse(l)}}catch(i){return{ok:!1,value:ae(C),error:String((i==null?void 0:i.message)??i)}}},[g==null?void 0:g.behavior_json,C]),z=l=>{T(i=>{if(!i)return i;const u=(i.behavior_json??"").trim();let d;try{d=u?JSON.parse(u):ae(C)}catch{return i}const N=ae(d);return l(N),{...i,behavior_json:JSON.stringify(N,null,2)}})},ps={"assistant_settings.openrouter_base_url":"field-openrouter_base_url","assistant_settings.default_instructions":"field-default_instructions","assistant_settings.model_fast":"field-model_fast","assistant_settings.model_creative":"field-model_creative","assistant_settings.model_planner":"field-model_planner","assistant_settings.model_maker":"field-model_maker","assistant_settings.model_critic":"field-model_critic","assistant_settings.fallback_models":"field-fallback_models","assistant_settings.model_catalog":"field-model_catalog","assistant_settings.params.timeout_ms":"field-param-timeout_ms","assistant_settings.params.stream_passthrough":"field-param-stream_passthrough","assistant_settings.params.response_healing":"field-param-response_healing","assistant_settings.params.web_search":"field-param-web_search","assistant_settings.params.web_search_mode":"field-param-web_search_mode","assistant_settings.params.web_max_results":"field-param-web_max_results","assistant_settings.params.web_engine":"field-param-web_engine","assistant_settings.params.web_search_prompt":"field-param-web_search_prompt","behavior.diagnostics.user_error_detail":"field-behavior-user_error_detail","behavior.diagnostics.user_error_show_culprit_var":"field-behavior-user_error_show_culprit_var","behavior.diagnostics.user_error_show_culprit_value":"field-behavior-user_error_show_culprit_value","behavior.diagnostics.user_error_show_status_model":"field-behavior-user_error_show_status_model","behavior.diagnostics.user_error_show_trace_ids":"field-behavior-user_error_show_trace_ids","behavior.router.zdr.enabled":"field-zdr-enabled","behavior.router.zdr.mode":"field-zdr-mode","behavior.router.zdr.allow_fallback":"field-zdr-allow-fallback","behavior.router.zdr.base_url":"field-zdr-base-url","assistant_settings.test_provider":"field-provider_test"},hs=l=>{const i=ps[l];if(!i)return;const u=document.getElementById(i);if(u)try{u.scrollIntoView({behavior:"smooth",block:"center"})}catch{u.scrollIntoView()}},D=(l,i)=>{ns(l),ot(!0),i!=null&&i.scroll&&(U("settings"),setTimeout(()=>hs(l),50))},gs=(l,i)=>{const u=Ne.find(d=>d.key===l);if(!u)return i;if(u.type==="number"){const d=Number(i);return i===""?null:Number.isFinite(d)?d:i}if(u.type==="boolean")return i===""?null:i==="true"?!0:i==="false"?!1:i;if(u.type==="string-array")return i===""?[]:se(i);if(u.type==="json"){if(!i.trim())return null;try{return JSON.parse(i)}catch{return i}}return i},Ze=(l,i)=>{var q,Q,ee;const u=S??{},d=$??{},N=g??{};if(l.startsWith("assistant_settings.params.")){const B=l.replace("assistant_settings.params.","");return i==="effective"?(q=u==null?void 0:u.params)==null?void 0:q[B]:i==="default"?(Q=d==null?void 0:d.params)==null?void 0:Q[B]:gs(B,String(((ee=N==null?void 0:N.params)==null?void 0:ee[B])??""))}if(l.startsWith("assistant_settings.")){const B=l.replace("assistant_settings.","");return B==="fallback_models"||B==="model_catalog"?i==="effective"?(u==null?void 0:u[B])??[]:i==="default"?(d==null?void 0:d[B])??[]:(N==null?void 0:N[B])??[]:i==="effective"?u==null?void 0:u[B]:i==="default"?d==null?void 0:d[B]:N==null?void 0:N[B]}if(l.startsWith("behavior.")){const B=l.replace("behavior.","").split(".");return x(i==="effective"?(u==null?void 0:u.behavior)??(d==null?void 0:d.behavior)??{}:i==="default"?(d==null?void 0:d.behavior)??{}:f.value??{},B,void 0)}},bs=(l,i)=>{if(g){if(l.startsWith("assistant_settings.params.")){const u=l.replace("assistant_settings.params.","");T(d=>{if(!d)return d;const N=Ne.find(Q=>Q.key===u);let q="";return(N==null?void 0:N.type)==="json"?q=i==null?"":JSON.stringify(i,null,2):(N==null?void 0:N.type)==="string-array"?q=Array.isArray(i)?i.join(`
`):String(i??""):q=i==null?"":String(i),{...d,params:{...d.params,[u]:q}}});return}if(l.startsWith("assistant_settings.")){const u=l.replace("assistant_settings.","");T(d=>d&&{...d,[u]:i});return}if(l.startsWith("behavior.")){const u=l.replace("behavior.","").split(".");z(d=>w(d,u,i));return}}},Se=_.useMemo(()=>tt(C??{},f.value??{}),[C,f.value]),Ce=_.useMemo(()=>{const l={rate_limit:(C??{}).rate_limit,orchestrator:(C??{}).orchestrator,router:(C??{}).router},i={rate_limit:(f.value??{}).rate_limit,orchestrator:(f.value??{}).orchestrator,router:(f.value??{}).router};return tt(l,i)},[C,f.value]);_.useEffect(()=>{if(!S||J)return;const l=u=>{var N,q;const d=((N=S==null?void 0:S.params)==null?void 0:N[u])??((q=$==null?void 0:$.params)==null?void 0:q[u]);return d==null?"":Array.isArray(d)?d.join(`
`):typeof d=="object"?JSON.stringify(d,null,2):String(d)},i={};Ne.forEach(u=>{i[u.key]=l(u.key)}),T({openrouter_base_url:(S==null?void 0:S.openrouter_base_url)??"",model_fast:(S==null?void 0:S.model_fast)??"",model_creative:(S==null?void 0:S.model_creative)??"",model_planner:(S==null?void 0:S.model_planner)??"",model_maker:(S==null?void 0:S.model_maker)??"",model_critic:(S==null?void 0:S.model_critic)??"",fallback_models:(S==null?void 0:S.fallback_models)??[],model_catalog:(S==null?void 0:S.model_catalog)??($==null?void 0:$.model_catalog)??[],default_instructions:(S==null?void 0:S.default_instructions)??"",behavior_json:JSON.stringify((S==null?void 0:S.behavior)??($==null?void 0:$.behavior)??{},null,2),params:i}),W(!0)},[S,$,J]),_.useEffect(()=>{_e&&(ke||Ke(null))},[_e,ke]);function ut(l){const i=Math.max(0,Math.floor(Number(l)||0)),u=Math.floor(i/60),d=i%60;if(u<=0)return`${d}s`;const N=Math.floor(u/60),q=u%60;return N<=0?`${u}m ${d}s`:`${N}h ${q}m`}const js=(()=>{var l,i,u,d,N,q,Q,ee,B,ft,vt,Nt,yt,_t,zt,wt,kt,St,Ct,Ot,At,Mt,Pt,Rt,qt,Ft,Dt,It,Lt;return P==="metrics"?ze.isLoading?e.jsx(Qe,{}):ze.isError?e.jsx(Me,{error:ze.error}):R?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsx(Z,{title:"Suggestions (created)",value:I(((l=R==null?void 0:R.totals)==null?void 0:l.created)??0)}),e.jsx(Z,{title:"Accepted",value:I(((i=R==null?void 0:R.totals)==null?void 0:i.accepted)??0)}),e.jsx(Z,{title:"Accept rate",value:Wt(Number(((u=R==null?void 0:R.totals)==null?void 0:u.acceptRate)??0))}),e.jsx(Z,{title:"Tokens (est.)",value:I(((d=R==null?void 0:R.totals)==null?void 0:d.tokens)??0)})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Suggestions over time"}),e.jsx("div",{className:"h-72",children:e.jsx(Jt,{width:"100%",height:"100%",children:e.jsxs(Fs,{data:cs,children:[e.jsx(Tt,{dataKey:"day"}),e.jsx(Bt,{}),e.jsx(Kt,{}),e.jsx(Xe,{dataKey:"created"}),e.jsx(Xe,{dataKey:"accepted"}),e.jsx(Xe,{dataKey:"dismissed"})]})})}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["If this chart stays empty, run the rollup once: call edge function ",e.jsx("code",{children:"assistant-metrics-rollup"}),"."]})]}),e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Trigger fires over time"}),e.jsx("div",{className:"h-72",children:e.jsx(Jt,{width:"100%",height:"100%",children:e.jsxs(Ds,{data:ds,children:[e.jsx(Tt,{dataKey:"day"}),e.jsx(Bt,{}),e.jsx(Kt,{}),e.jsx(Is,{dataKey:"fires"})]})})}),e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"Top triggers are shown below."})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"By surface + kind"}),e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Day"}),e.jsx(h,{children:"Surface"}),e.jsx(h,{children:"Kind"}),e.jsx(h,{className:"text-right",children:"Created"}),e.jsx(h,{className:"text-right",children:"Accepted"}),e.jsx(h,{className:"text-right",children:"Dismissed"}),e.jsx(h,{className:"text-right",children:"Rate"})]})}),e.jsx("tbody",{children:xs.slice(0,150).map((t,r)=>{const m=Number(t.created_count??0),a=Number(t.accepted_count??0),M=m?a/m:0;return e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{children:String(t.day).slice(5)}),e.jsx(p,{children:t.surface}),e.jsx(p,{children:t.kind}),e.jsx(p,{className:"text-right",children:I(m)}),e.jsx(p,{className:"text-right",children:I(a)}),e.jsx(p,{className:"text-right",children:I(Number(t.dismissed_count??0))}),e.jsx(p,{className:"text-right",children:Wt(M)})]},r)})})]})]}),e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Top triggers"}),e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Trigger"}),e.jsx(h,{className:"text-right",children:"Fires"}),e.jsx(h,{className:"text-right",children:"Users"})]})}),e.jsx("tbody",{children:ms.map((t,r)=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{children:t.name}),e.jsx(p,{className:"text-right",children:I(Number(t.fires??0))}),e.jsx(p,{className:"text-right",children:I(Number(t.unique_users??0))})]},r))})]}),e.jsxs("div",{className:"mt-3 text-xs text-zinc-500",children:["Tip: You can disable noisy triggers by setting ",e.jsx("code",{children:"assistant_triggers.enabled = false"}),"."]})]})]})]}):e.jsx(Et,{title:"No metrics yet",message:"No assistant metrics were returned."}):P==="diagnostics"?ie.isLoading?e.jsx(Qe,{}):ie.isError?e.jsx(Me,{error:ie.error}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["Snapshot: ",le(c==null?void 0:c.ts)]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsx(Z,{title:"Pending",value:I(Number(((N=c==null?void 0:c.counts)==null?void 0:N.pending)??0))}),e.jsx(Z,{title:"Processing",value:I(Number(((q=c==null?void 0:c.counts)==null?void 0:q.processing)??0))}),e.jsx(Z,{title:"Failed",value:I(Number(((Q=c==null?void 0:c.counts)==null?void 0:Q.failed)??0))}),e.jsx(Z,{title:"Done",value:I(Number(((ee=c==null?void 0:c.counts)==null?void 0:ee.done)??0))})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Queue age"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Z,{title:"Oldest pending",value:ut(Number((c==null?void 0:c.oldestPendingSec)??0))}),e.jsx(Z,{title:"Oldest processing",value:ut(Number((c==null?void 0:c.oldestProcessingSec)??0))})]}),e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"If queue age keeps growing, check runner health and rate limits."})]}),e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Last 24h"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(Z,{title:"Created",value:I(Number(((B=c==null?void 0:c.last24h)==null?void 0:B.created)??0))}),e.jsx(Z,{title:"Done",value:I(Number(((ft=c==null?void 0:c.last24h)==null?void 0:ft.done)??0))}),e.jsx(Z,{title:"Failed",value:I(Number(((vt=c==null?void 0:c.last24h)==null?void 0:vt.failed)??0))})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Jobs by kind"}),e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Kind"}),e.jsx(h,{className:"text-right",children:"Pending"}),e.jsx(h,{className:"text-right",children:"Processing"}),e.jsx(h,{className:"text-right",children:"Failed"}),e.jsx(h,{className:"text-right",children:"Done"}),e.jsx(h,{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:Object.entries((c==null?void 0:c.byKind)??{}).map(([t,r])=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{children:t}),e.jsx(p,{className:"text-right",children:I(Number((r==null?void 0:r.pending)??0))}),e.jsx(p,{className:"text-right",children:I(Number((r==null?void 0:r.processing)??0))}),e.jsx(p,{className:"text-right",children:I(Number((r==null?void 0:r.failed)??0))}),e.jsx(p,{className:"text-right",children:I(Number((r==null?void 0:r.done)??0))}),e.jsx(p,{className:"text-right",children:I(Number((r==null?void 0:r.total)??0))})]},t))})]})]}),e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Recent cron invocations"}),e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"When"}),e.jsx(h,{children:"Job"}),e.jsx(h,{children:"Request ID"})]})}),e.jsx("tbody",{children:((c==null?void 0:c.recentCron)??[]).map(t=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{children:le(t.createdAt)}),e.jsx(p,{children:t.job}),e.jsx(p,{className:"font-mono text-xs",children:t.requestId??""})]},t.id))})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Recent failures"}),e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"When"}),e.jsx(h,{children:"Kind"}),e.jsx(h,{children:"Conversation"}),e.jsx(h,{className:"text-right",children:"Attempts"}),e.jsx(h,{children:"Error"})]})}),e.jsx("tbody",{children:((c==null?void 0:c.recentFailures)??[]).map(t=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{children:le(t.updatedAt)}),e.jsx(p,{children:t.jobKind}),e.jsx(p,{className:"font-mono text-xs",children:t.conversationId}),e.jsx(p,{className:"text-right",children:I(Number(t.attempts??0))}),e.jsx(p,{className:"max-w-[520px] truncate",title:t.lastError,children:t.lastError})]},t.id))})]}),((c==null?void 0:c.recentFailures)??[]).length===0?e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"No recent failures."}):null]})}),e.jsx("div",{className:"mt-6",children:e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Recent AI provider errors"}),e.jsx("div",{className:"text-xs text-zinc-500",children:'Captures OpenRouter/provider issues even when we return a user-facing fallback message (jobs may still be "done").'}),e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"When"}),e.jsx(h,{children:"Code"}),e.jsx(h,{children:"Culprit"}),e.jsx(h,{children:"Reason"}),e.jsx(h,{children:"Request"})]})}),e.jsx("tbody",{children:((c==null?void 0:c.recentAiFailures)??[]).map(t=>{var r,m;return e.jsxs("tr",{className:"border-t border-zinc-100 cursor-pointer hover:bg-zinc-50",onClick:()=>{dt(t),ct(!0)},children:[e.jsx(p,{children:le(t.createdAt)}),e.jsx(p,{className:"font-mono text-xs",children:t.code}),e.jsx(p,{className:"font-mono text-xs",title:((r=t.culprit)==null?void 0:r.value_preview)??"",children:((m=t.culprit)==null?void 0:m.var)??"—"}),e.jsx(p,{className:"max-w-[520px] truncate",title:t.reason,children:t.reason}),e.jsx(p,{className:"font-mono text-xs",children:t.requestId??""})]},t.id)})})]}),((c==null?void 0:c.recentAiFailures)??[]).length===0?e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"No recent AI provider errors."}):null]})}),(((yt=(Nt=c==null?void 0:c.aiFailureRollup)==null?void 0:Nt.codes)==null?void 0:yt.length)??0)>0||(((zt=(_t=c==null?void 0:c.aiFailureRollup)==null?void 0:_t.models)==null?void 0:zt.length)??0)>0?e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"AI error rollup (72h)"}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["Top error codes captured by ",e.jsx("code",{children:"assistant_failures"}),"."]}),e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Code"}),e.jsx(h,{className:"text-right",children:"Count"})]})}),e.jsx("tbody",{children:(((wt=c==null?void 0:c.aiFailureRollup)==null?void 0:wt.codes)??[]).map(t=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{className:"font-mono text-xs",children:t.code}),e.jsx(p,{className:"text-right",children:I(Number(t.count??0))})]},t.code))})]})]}),e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Most affected models (72h)"}),e.jsxs("div",{className:"text-xs text-zinc-500",children:["Derived from ",e.jsx("code",{children:"assistant_failures.details.ai.context.model"}),"."]}),e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Model"}),e.jsx(h,{className:"text-right",children:"Count"})]})}),e.jsx("tbody",{children:(((kt=c==null?void 0:c.aiFailureRollup)==null?void 0:kt.models)??[]).map(t=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{className:"font-mono text-xs",children:t.model}),e.jsx(p,{className:"text-right",children:I(Number(t.count??0))})]},`${t.model}`))})]})]})]}):null,((c==null?void 0:c.openrouterCircuits)??[]).length?e.jsx("div",{className:"mt-6",children:e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"OpenRouter circuits (currently skipped models)"}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Models listed here are temporarily skipped by the Edge Functions circuit breaker to reduce repeated 429/5xx storms."}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx(F,{variant:"secondary",onClick:()=>{n(null),j(null),ce.mutate(null)},disabled:ce.isPending||be.isPending,children:"Reset all"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Keep"}),e.jsx("input",{type:"number",min:1,max:365,value:String(k),onChange:t=>{const r=Number(t.target.value);Number.isFinite(r)&&E(Math.max(1,Math.min(365,Math.trunc(r))))},className:"w-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm"}),e.jsx("span",{className:"text-[11px] text-zinc-500",children:"days"})]}),e.jsx(F,{variant:"ghost",onClick:()=>{n(null),j(null),be.mutate(k)},disabled:ce.isPending||be.isPending,children:"Cleanup history"}),ce.isPending||be.isPending?e.jsx("span",{className:"text-xs text-zinc-500",children:"Working…"}):null]}),s?e.jsx("div",{className:"mt-2 text-xs text-zinc-700",children:s}):null,v?e.jsx("div",{className:"mt-2 text-xs text-red-600",children:v}):null,e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Model"}),e.jsx(h,{children:"Open until"}),e.jsx(h,{className:"text-right",children:"Streak"}),e.jsx(h,{className:"text-right",children:"Status"}),e.jsx(h,{children:"Last error"}),e.jsx(h,{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:((c==null?void 0:c.openrouterCircuits)??[]).map(t=>e.jsxs("tr",{className:"border-t border-zinc-100",children:[e.jsx(p,{className:"font-mono text-xs",children:t.model}),e.jsx(p,{children:le(t.openUntil)}),e.jsx(p,{className:"text-right",children:I(Number(t.failureStreak??0))}),e.jsx(p,{className:"text-right",children:t.lastStatus??""}),e.jsx(p,{className:"max-w-[520px] truncate",title:t.lastError??"",children:t.lastError??""}),e.jsx(p,{className:"text-right",children:e.jsx(F,{variant:"ghost",onClick:()=>{n(null),j(null),ce.mutate(String(t.model))},disabled:ce.isPending||be.isPending,children:"Reset"})})]},t.model))})]})]})}):null,e.jsx("div",{className:"mt-6",children:e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Routing decision log"}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Recent OpenRouter requests with routing policy details (per request ID)."}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-end gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Rows"}),e.jsx("input",{type:"number",min:10,max:200,value:String($e),onChange:t=>{const r=t.target.value;if(!r)return;const m=Number(r);Number.isFinite(m)&&is(Math.max(10,Math.min(200,Math.trunc(m))))},className:"w-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Function"}),e.jsxs("select",{value:We,onChange:t=>os(t.target.value),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"assistant-chat-reply",children:"assistant-chat-reply"}),e.jsx("option",{value:"assistant-orchestrator",children:"assistant-orchestrator"}),e.jsx("option",{value:"admin-assistant-settings",children:"admin-assistant-settings"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Request ID"}),e.jsx("input",{value:Ue,onChange:t=>as(t.target.value),placeholder:"req_...",className:"w-64 rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]}),e.jsx(F,{type:"button",variant:"secondary",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs",onClick:()=>ge.refetch(),children:"Refresh"})]}),e.jsxs("div",{className:"mt-2 text-xs text-zinc-500",children:["ZDR coverage:"," ",e.jsx("span",{className:"font-mono",children:me.used})," /"," ",e.jsx("span",{className:"font-mono",children:me.requested})," requested",me.fallback?e.jsxs(e.Fragment,{children:[" ","· fallback ",e.jsx("span",{className:"font-mono",children:me.fallback})]}):null,me.sensitive?e.jsxs(e.Fragment,{children:[" ","· sensitive ",e.jsx("span",{className:"font-mono",children:me.sensitive})]}):null]}),ge.isLoading?e.jsx("div",{className:"mt-3 text-xs text-zinc-500",children:"Loading routing logs…"}):ge.isError?e.jsx("div",{className:"mt-3",children:e.jsx(Me,{error:ge.error})}):e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"When"}),e.jsx(h,{children:"Request ID"}),e.jsx(h,{children:"Mode"}),e.jsx(h,{children:"Model"}),e.jsx(h,{children:"Variant"}),e.jsx(h,{children:"ZDR"}),e.jsx(h,{children:"Provider"}),e.jsx(h,{children:"Function"})]})}),e.jsx("tbody",{children:xe.length?xe.map(t=>{var te;const{routing:r,decision:m}=Ht(t.meta),a=String(((te=r==null?void 0:r.policy)==null?void 0:te.mode)??"—"),M=String((m==null?void 0:m.provider)??t.provider??"—"),b=Vt(t.meta),Y=b!=null&&b.used?"used":b!=null&&b.requested?"miss":"—";return e.jsxs("tr",{className:"border-t border-zinc-100 cursor-pointer hover:bg-zinc-50",onClick:()=>Ke(String(t.id)),children:[e.jsx(p,{children:le(t.created_at)}),e.jsx(p,{className:"font-mono text-xs",children:t.request_id??"—"}),e.jsx(p,{className:"font-mono text-xs",children:a}),e.jsx(p,{className:"font-mono text-xs",children:t.model??"—"}),e.jsx(p,{className:"font-mono text-xs",children:t.variant??"—"}),e.jsx(p,{className:"font-mono text-xs",children:Y}),e.jsx(p,{className:"font-mono text-xs",children:M}),e.jsx(p,{className:"font-mono text-xs",children:t.fn})]},t.id)}):e.jsx("tr",{children:e.jsx(p,{colSpan:8,className:"p-6",children:e.jsx(Et,{title:"No routing logs",message:"No OpenRouter request logs match this filter.",className:"border-0 bg-transparent p-0"})})})})]})]})})]}):e.jsx("div",{className:"mt-4",children:he.isLoading||!g?e.jsx(Qe,{}):he.isError?e.jsx(Me,{error:he.error}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(L,{children:[e.jsxs("div",{id:"field-openrouter_base_url",className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold",children:"OpenRouter base URL"}),e.jsx(K,{title:"Details",onClick:()=>D("assistant_settings.openrouter_base_url")})]}),e.jsx("input",{value:g.openrouter_base_url,onChange:t=>T(r=>r&&{...r,openrouter_base_url:t.target.value}),placeholder:"https://openrouter.ai/api/v1",className:"w-full rounded-lg border border-zinc-200 px-3 py-2 text-sm"}),e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"Leave blank to use the environment default."})]}),e.jsxs(L,{children:[e.jsxs("div",{id:"field-default_instructions",className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Default instructions"}),e.jsx(K,{title:"Details",onClick:()=>D("assistant_settings.default_instructions")})]}),e.jsx("textarea",{value:g.default_instructions,onChange:t=>T(r=>r&&{...r,default_instructions:t.target.value}),placeholder:"Optional system instructions applied to every call.",className:"h-28 w-full rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(L,{children:[e.jsxs("div",{id:"field-provider_test",className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Provider test (OpenRouter)"}),e.jsx(K,{title:"Details",onClick:()=>D("assistant_settings.test_provider")})]}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Runs a tiny request using the current Assistant settings. This helps you see the exact failure reason (and the culprit variable) before users hit the error."}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-5",children:[e.jsxs("label",{className:"flex flex-col gap-1 md:col-span-1",children:[e.jsx("span",{className:"text-xs font-semibold text-zinc-600",children:"Model role"}),e.jsxs("select",{value:De,onChange:t=>Gt(t.target.value),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"fast",children:"Fast"}),e.jsx("option",{value:"creative",children:"Creative"}),e.jsx("option",{value:"planner",children:"Planner"}),e.jsx("option",{value:"maker",children:"Maker"}),e.jsx("option",{value:"critic",children:"Critic"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1 md:col-span-3",children:[e.jsx("span",{className:"text-xs font-semibold text-zinc-600",children:"Prompt"}),e.jsx("input",{value:Fe,onChange:t=>Xt(t.target.value),placeholder:"Reply with exactly: OK",className:"w-full rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]}),e.jsx("div",{className:"flex items-end md:col-span-1",children:e.jsx(F,{type:"button",className:"w-full rounded-xl bg-zinc-900 px-4 py-2 text-sm text-white",disabled:Ye.isPending,onClick:async()=>{Le(null),Ie(null);try{await Ye.mutateAsync({prompt:Fe,model_key:De})}catch{}},children:Ye.isPending?"Running…":"Run test"})})]}),lt?e.jsx("div",{className:"mt-3 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-800",children:lt}):null,A?e.jsxs("div",{className:"mt-3 rounded-xl border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:(St=A==null?void 0:A.test)!=null&&St.ok?"✅ Test ok":"⚠ Test failed"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"text-xs text-zinc-500 font-mono",children:A!=null&&A.requestId?`req ${A.requestId}`:""}),e.jsx(pe,{label:"Copy debug bundle",className:"rounded-lg border border-zinc-200 bg-white px-2 py-1 text-xs",text:JSON.stringify({requestId:(A==null?void 0:A.requestId)??null,test:(A==null?void 0:A.test)??null,selected:{model_key:De,prompt:Fe,base_url:(g==null?void 0:g.openrouter_base_url)??null}},null,2)})]})]}),(Ct=A==null?void 0:A.test)!=null&&Ct.ok?e.jsxs("div",{className:"mt-2 text-sm text-zinc-700",children:["Used model: ",e.jsx("span",{className:"font-mono text-xs",children:A.test.usedModel??""}),typeof A.test.durationMs=="number"?e.jsxs("span",{className:"ml-2 text-xs text-zinc-500",children:["(",A.test.durationMs,"ms)"]}):null,A.test.contentPreview?e.jsx("div",{className:"mt-2 rounded-lg border border-zinc-200 bg-zinc-50 p-2 font-mono text-xs",children:A.test.contentPreview}):null]}):e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("div",{className:"text-sm text-zinc-800",children:((Ot=A==null?void 0:A.test)==null?void 0:Ot.userMessage)??"Provider test failed."}),(At=A==null?void 0:A.test)!=null&&At.envelope?e.jsxs("div",{className:"text-xs text-zinc-500",children:["Code: ",e.jsx("span",{className:"font-mono",children:A.test.envelope.code}),(Mt=A.test.culprit)!=null&&Mt.var?e.jsxs("span",{className:"ml-2",children:["Culprit: ",e.jsx("span",{className:"font-mono",children:A.test.culprit.var})]}):null,(Pt=A.test.culprit)!=null&&Pt.var?e.jsx(F,{type:"button",variant:"ghost",className:"ml-2 rounded-lg border border-zinc-200 bg-white px-2 py-1 text-[11px]",onClick:()=>D(String(A.test.culprit.var),{scroll:!0}),children:"Open culprit"}):null]}):null]})]}):null]})}),e.jsx("div",{className:"mt-4",children:e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 flex items-center justify-between gap-2",children:e.jsx("div",{className:"text-sm font-semibold",children:"Routing policy test"})}),e.jsx("div",{className:"text-xs text-zinc-500",children:"Runs a tiny request using the current routing policy and captures the selected model/provider/variant."}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3 md:grid-cols-5",children:[e.jsxs("label",{className:"flex flex-col gap-1 md:col-span-1",children:[e.jsx("span",{className:"text-xs font-semibold text-zinc-600",children:"Policy mode"}),e.jsxs("select",{value:Je,onChange:t=>ts(t.target.value),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"current",children:"Use saved policy"}),e.jsx("option",{value:"auto",children:"Force auto"}),e.jsx("option",{value:"fallback",children:"Force fallback"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1 md:col-span-3",children:[e.jsx("span",{className:"text-xs font-semibold text-zinc-600",children:"Prompt"}),e.jsx("input",{value:Ee,onChange:t=>es(t.target.value),placeholder:"Reply with exactly: OK",className:"w-full rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]}),e.jsx("div",{className:"flex items-end md:col-span-1",children:e.jsx(F,{type:"button",className:"w-full rounded-xl bg-zinc-900 px-4 py-2 text-sm text-white",disabled:He.isPending,onClick:async()=>{Be(null),Te(null);try{await He.mutateAsync({prompt:Ee,mode:Je,simulate_advanced_params:it})}catch{}},children:He.isPending?"Running…":"Run test"})})]}),e.jsxs("label",{className:"mt-3 flex items-center gap-2 text-xs text-zinc-600",children:[e.jsx("input",{type:"checkbox",checked:it,onChange:t=>ss(t.target.checked)}),"Simulate advanced params (tools/tool_choice) to test provider ",e.jsx("span",{className:"font-mono",children:"require_parameters"})]}),at?e.jsx("div",{className:"mt-3 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-800",children:at}):null,y?e.jsxs("div",{className:"mt-3 rounded-xl border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold text-zinc-900",children:(Rt=y==null?void 0:y.test)!=null&&Rt.ok?"✅ Test ok":"⚠ Test failed"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"text-xs text-zinc-500 font-mono",children:y!=null&&y.requestId?`req ${y.requestId}`:""}),e.jsx(pe,{label:"Copy debug bundle",className:"rounded-lg border border-zinc-200 bg-white px-2 py-1 text-xs",text:JSON.stringify({requestId:(y==null?void 0:y.requestId)??null,test:(y==null?void 0:y.test)??null,selected:{mode:Je,prompt:Ee,base_url:(g==null?void 0:g.openrouter_base_url)??null}},null,2)})]})]}),(qt=y==null?void 0:y.test)!=null&&qt.ok?e.jsxs("div",{className:"mt-2 space-y-2 text-sm text-zinc-700",children:[e.jsxs("div",{children:["Used model: ",e.jsx("span",{className:"font-mono text-xs",children:y.test.usedModel??""}),typeof y.test.durationMs=="number"?e.jsxs("span",{className:"ml-2 text-xs text-zinc-500",children:["(",y.test.durationMs,"ms)"]}):null]}),e.jsxs("div",{children:["Provider: ",e.jsx("span",{className:"font-mono text-xs",children:y.test.usedProvider??"—"}),e.jsx("span",{className:"ml-2 text-zinc-500",children:"·"}),e.jsx("span",{className:"ml-2 text-zinc-500",children:"Variant:"})," ",e.jsx("span",{className:"font-mono text-xs",children:y.test.usedVariant??"—"})]}),e.jsxs("div",{children:["require_parameters:"," ",e.jsx("span",{className:"font-mono text-xs",children:y.test.requireParameters===null||typeof y.test.requireParameters>"u"?"—":String(y.test.requireParameters)}),e.jsxs("span",{className:"ml-2 text-xs text-zinc-500",children:["(source: ",y.test.requireParametersSource??"—",")"]})]}),e.jsxs("div",{children:["Base URL: ",e.jsx("span",{className:"font-mono text-xs",children:y.test.baseUrl??"—"})]}),y.test.contentPreview?e.jsx("div",{className:"rounded-lg border border-zinc-200 bg-zinc-50 p-2 font-mono text-xs",children:y.test.contentPreview}):null]}):e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("div",{className:"text-sm text-zinc-800",children:((Ft=y==null?void 0:y.test)==null?void 0:Ft.userMessage)??"Routing test failed."}),(Dt=y==null?void 0:y.test)!=null&&Dt.envelope?e.jsxs("div",{className:"text-xs text-zinc-500",children:["Code: ",e.jsx("span",{className:"font-mono",children:y.test.envelope.code}),(It=y.test.culprit)!=null&&It.var?e.jsxs("span",{className:"ml-2",children:["Culprit: ",e.jsx("span",{className:"font-mono",children:y.test.culprit.var})]}):null,(Lt=y.test.culprit)!=null&&Lt.var?e.jsx(F,{type:"button",variant:"ghost",className:"ml-2 rounded-lg border border-zinc-200 bg-white px-2 py-1 text-[11px]",onClick:()=>D(String(y.test.culprit.var),{scroll:!0}),children:"Open culprit"}):null]}):null]})]}):null]})}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Models (primary)"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[{key:"model_fast",label:"Fast"},{key:"model_creative",label:"Creative"},{key:"model_planner",label:"Planner"},{key:"model_maker",label:"Maker"},{key:"model_critic",label:"Critic"}].map(t=>{const r=Array.from(new Set([...g.model_catalog??[],g[t.key]].filter(Boolean)));return e.jsxs("label",{id:`field-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),e.jsx(K,{title:"Details",onClick:()=>D(`assistant_settings.${t.key}`)})]}),e.jsxs("select",{value:g[t.key]??"",onChange:m=>T(a=>a&&{...a,[t.key]:m.target.value}),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"—"}),r.map(m=>e.jsx("option",{value:m,children:m},m))]})]},t.key)})})]}),e.jsxs(L,{children:[e.jsxs("div",{id:"field-fallback_models",className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Fallback models"}),e.jsx(K,{title:"Details",onClick:()=>D("assistant_settings.fallback_models")})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2 text-sm",children:Array.from(new Set([...g.model_catalog??[],...g.fallback_models??[]])).map(t=>{const r=g.fallback_models.includes(t);return e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:m=>T(a=>a&&{...a,fallback_models:m.target.checked?Array.from(new Set([...a.fallback_models,t])):a.fallback_models.filter(M=>M!==t)})}),e.jsx("span",{className:"text-xs text-zinc-700",children:t})]},t)})}),e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"These are used when the primary models fail."})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(L,{children:[e.jsxs("div",{id:"field-model_catalog",className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Model catalog"}),e.jsx(K,{title:"Details",onClick:()=>D("assistant_settings.model_catalog")})]}),e.jsx("textarea",{value:(g.model_catalog??[]).join(`
`),onChange:t=>T(r=>r&&{...r,model_catalog:se(t.target.value)}),placeholder:"One model per line",className:"h-40 w-full rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono"}),e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"This list powers the dropdowns and fallback checkboxes."})]})}),e.jsx("div",{className:"mt-6",children:e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Assistant behavior (prompts & chunking)"}),e.jsxs("div",{className:"mb-2 text-xs text-zinc-500",children:["Stored in ",e.jsx("span",{className:"font-mono",children:"assistant_settings.behavior"}),". Supports placeholders:",e.jsx("span",{className:"ml-1 font-mono",children:"{{name}}"}),", ",e.jsx("span",{className:"font-mono",children:"{{bioLine}}"}),",",e.jsx("span",{className:"font-mono",children:"{{toolProtocol}}"}),"."]}),f.ok?e.jsxs("div",{className:"mb-3 rounded-lg border border-zinc-200 bg-zinc-50 px-3 py-3",children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-700",children:"Behavior controls (safe knobs)"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs",onClick:()=>z(t=>{t.rate_limit=ae((C??{}).rate_limit),t.orchestrator=ae((C??{}).orchestrator),w(t,["router","attribution"],ae(x(C??{},["router","attribution"],{})))}),children:"Reset proactivity controls"}),e.jsxs(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs",onClick:()=>Qt(t=>!t),children:[nt?"Hide":"Show"," proactivity diff"]}),e.jsxs(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs",onClick:()=>Zt(t=>!t),children:[rt?"Hide":"Show"," full diff"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"OpenRouter attribution"}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"HTTP-Referer"}),e.jsx("input",{type:"text",value:String(x(f.value,["router","attribution","http_referer"],"")),onChange:t=>z(r=>w(r,["router","attribution","http_referer"],t.target.value)),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["router","attribution","http_referer"],""))})]}),e.jsxs("label",{className:"mt-2 flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"X-Title"}),e.jsx("input",{type:"text",value:String(x(f.value,["router","attribution","x_title"],"")),onChange:t=>z(r=>w(r,["router","attribution","x_title"],t.target.value)),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["router","attribution","x_title"],""))})]})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Chat reply rate limit"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Limit"}),e.jsx("input",{type:"number",min:1,max:100,step:1,value:String(x(f.value,["rate_limit","chat_reply","limit"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(1,Math.min(100,Number(r)));w(m,["rate_limit","chat_reply","limit"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["rate_limit","chat_reply","limit"],6))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Window (seconds)"}),e.jsx("input",{type:"number",min:5,max:3600,step:1,value:String(x(f.value,["rate_limit","chat_reply","window_seconds"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(5,Math.min(3600,Number(r)));w(m,["rate_limit","chat_reply","window_seconds"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["rate_limit","chat_reply","window_seconds"],60))})]})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-zinc-500",children:["Stored at ",e.jsx("span",{className:"font-mono",children:"behavior.rate_limit.chat_reply"}),"."]})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3 md:col-span-2",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2 text-[11px] font-semibold text-zinc-600",children:[e.jsx("span",{children:"Zero Data Retention (ZDR) routing"}),e.jsx(K,{title:"Details",onClick:()=>D("behavior.router.zdr.enabled")})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsxs("label",{id:"field-zdr-enabled",className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!x(f.value,["router","zdr","enabled"],!1),onChange:t=>z(r=>w(r,["router","zdr","enabled"],t.target.checked))}),e.jsx("span",{children:"Enable ZDR routing"})]}),e.jsxs("label",{id:"field-zdr-mode",className:"flex flex-col gap-1 text-xs text-zinc-700",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Mode"}),e.jsxs("select",{value:String(x(f.value,["router","zdr","mode"],"sensitive_only")),onChange:t=>z(r=>w(r,["router","zdr","mode"],t.target.value)),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"sensitive_only",children:"Sensitive only"}),e.jsx("option",{value:"all",children:"All requests"})]})]}),e.jsxs("label",{id:"field-zdr-allow-fallback",className:"flex items-center gap-2 text-xs text-zinc-700",children:[e.jsx("input",{type:"checkbox",checked:!!x(f.value,["router","zdr","allow_fallback"],!0),onChange:t=>z(r=>w(r,["router","zdr","allow_fallback"],t.target.checked))}),e.jsx("span",{children:"Allow fallback"})]}),e.jsxs("label",{id:"field-zdr-base-url",className:"flex flex-col gap-1 text-xs text-zinc-700 md:col-span-2",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"ZDR base URL override"}),e.jsx("input",{type:"text",value:String(x(f.value,["router","zdr","base_url"],"")),onChange:t=>z(r=>w(r,["router","zdr","base_url"],t.target.value)),placeholder:"Leave blank to use discovered ZDR endpoints",className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]})]}),e.jsxs("div",{className:"mt-3 text-xs text-zinc-500",children:["Uses cached OpenRouter endpoint discovery. Refresh the ",e.jsx("span",{className:"font-mono",children:"openrouter-refresh"})," job to update."]}),Ve.isLoading?e.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"Loading ZDR endpoints…"}):Ve.isError?e.jsx("div",{className:"mt-2 text-xs text-red-600",children:"Failed to load endpoints."}):e.jsx("div",{className:"mt-2",children:mt.length?e.jsx("ul",{className:"space-y-1 text-xs text-zinc-700",children:mt.map(t=>e.jsxs("li",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"font-mono",children:t.base_url}),t.name?e.jsxs("span",{className:"text-zinc-500",children:["(",t.name,")"]}):null]},t.base_url))}):e.jsx("div",{className:"text-xs text-zinc-500",children:"No ZDR endpoints found in cache."})})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3 md:col-span-2",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Routing policy"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Mode"}),e.jsxs("select",{value:String(x(f.value,["router","policy","mode"],"fallback")),onChange:t=>z(r=>w(r,["router","policy","mode"],t.target.value||"fallback")),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"fallback",children:"Fallback"}),e.jsx("option",{value:"auto",children:"Auto"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider sort"}),e.jsxs("select",{value:String(x(f.value,["router","policy","provider","sort"],"price")),onChange:t=>z(r=>w(r,["router","policy","provider","sort"],t.target.value||"price")),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"price",children:"Price"}),e.jsx("option",{value:"throughput",children:"Throughput"}),e.jsx("option",{value:"latency",children:"Latency"})]})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Allow provider fallbacks"}),e.jsxs("select",{value:String(x(f.value,["router","policy","provider","allow_fallbacks"],!0)),onChange:t=>z(r=>w(r,["router","policy","provider","allow_fallbacks"],t.target.value==="true")),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"true",children:"True"}),e.jsx("option",{value:"false",children:"False"})]})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Auto model"}),e.jsx("input",{type:"text",value:String(x(f.value,["router","policy","auto_model"],"")),onChange:t=>z(r=>w(r,["router","policy","auto_model"],t.target.value)),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["router","policy","auto_model"],""))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Fallback models (one per line)"}),e.jsx("textarea",{value:G(x(f.value,["router","policy","fallback_models"],[])),onChange:t=>z(r=>w(r,["router","policy","fallback_models"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:G(x(C,["router","policy","fallback_models"],[]))})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider order (one per line)"}),e.jsx("textarea",{value:G(x(f.value,["router","policy","provider","order"],[])),onChange:t=>z(r=>w(r,["router","policy","provider","order"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:G(x(C,["router","policy","provider","order"],[]))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider require (one per line)"}),e.jsx("textarea",{value:G(x(f.value,["router","policy","provider","require"],[])),onChange:t=>z(r=>w(r,["router","policy","provider","require"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:G(x(C,["router","policy","provider","require"],[]))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider allow (one per line)"}),e.jsx("textarea",{value:G(x(f.value,["router","policy","provider","allow"],[])),onChange:t=>z(r=>w(r,["router","policy","provider","allow"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:G(x(C,["router","policy","provider","allow"],[]))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Provider ignore (one per line)"}),e.jsx("textarea",{value:G(x(f.value,["router","policy","provider","ignore"],[])),onChange:t=>z(r=>w(r,["router","policy","provider","ignore"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:G(x(C,["router","policy","provider","ignore"],[]))})]})]}),e.jsxs("div",{className:"mt-3 rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2 text-[11px] font-semibold text-zinc-600",children:[e.jsx("div",{children:"Provider policy editor (recommended)"}),e.jsx(K,{title:"Details",onClick:()=>D("behavior.router.policy.provider",{scroll:!1})})]}),e.jsx(Js,{value:x(f.value,["router","policy","provider"],null),providerOptions:us,onChange:t=>z(r=>w(r,["router","policy","provider"],t))}),e.jsxs("div",{className:"mt-2 text-[11px] text-zinc-500",children:["Uses OpenRouter's ",e.jsx("span",{className:"font-mono",children:"provider"})," routing fields (only/ignore/order, etc.)."]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Payload variants (one per line)"}),e.jsx("textarea",{value:G(x(f.value,["router","policy","variants"],[])),onChange:t=>z(r=>w(r,["router","policy","variants"],se(t.target.value))),className:"h-24 rounded-lg border border-zinc-200 px-3 py-2 text-sm font-mono",placeholder:G(x(C,["router","policy","variants"],[]))})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-zinc-500",children:["Stored at ",e.jsx("span",{className:"font-mono",children:"behavior.router.policy.*"}),"."]})]})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2 text-[11px] font-semibold text-zinc-600",children:[e.jsx("div",{children:"User-facing AI error detail"}),e.jsx(K,{title:"Details",onClick:()=>D("behavior.diagnostics.user_error_detail",{scroll:!1})})]}),e.jsxs("label",{id:"field-behavior-user_error_detail",className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{children:"Mode"}),e.jsx(K,{title:"Details",onClick:()=>D("behavior.diagnostics.user_error_detail")})]}),e.jsxs("select",{value:String(x(f.value,["diagnostics","user_error_detail"],"friendly")),onChange:t=>z(r=>w(r,["diagnostics","user_error_detail"],t.target.value||"friendly")),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"friendly",children:"Friendly (generic)"}),e.jsx("option",{value:"code",children:"Code (show error code)"}),e.jsx("option",{value:"technical",children:"Technical (cause + details)"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("label",{id:"field-behavior-user_error_show_culprit_var",className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{children:"Show culprit variable"}),e.jsx(K,{title:"Details",onClick:()=>D("behavior.diagnostics.user_error_show_culprit_var")})]}),e.jsxs("select",{value:Re(x(f.value,["diagnostics","user_error_show_culprit_var"],void 0)),onChange:t=>z(r=>w(r,["diagnostics","user_error_show_culprit_var"],qe(t.target.value))),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"auto",children:"Auto (by mode)"}),e.jsx("option",{value:"on",children:"On"}),e.jsx("option",{value:"off",children:"Off"})]})]}),e.jsxs("label",{id:"field-behavior-user_error_show_culprit_value",className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{children:"Show culprit value preview"}),e.jsx(K,{title:"Details",onClick:()=>D("behavior.diagnostics.user_error_show_culprit_value")})]}),e.jsxs("select",{value:Re(x(f.value,["diagnostics","user_error_show_culprit_value"],void 0)),onChange:t=>z(r=>w(r,["diagnostics","user_error_show_culprit_value"],qe(t.target.value))),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"auto",children:"Auto (by mode)"}),e.jsx("option",{value:"on",children:"On"}),e.jsx("option",{value:"off",children:"Off"})]})]}),e.jsxs("label",{id:"field-behavior-user_error_show_status_model",className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{children:"Show status / model"}),e.jsx(K,{title:"Details",onClick:()=>D("behavior.diagnostics.user_error_show_status_model")})]}),e.jsxs("select",{value:Re(x(f.value,["diagnostics","user_error_show_status_model"],void 0)),onChange:t=>z(r=>w(r,["diagnostics","user_error_show_status_model"],qe(t.target.value))),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"auto",children:"Auto (by mode)"}),e.jsx("option",{value:"on",children:"On"}),e.jsx("option",{value:"off",children:"Off"})]})]}),e.jsxs("label",{id:"field-behavior-user_error_show_trace_ids",className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{children:"Show trace IDs (requestId, upstream)"}),e.jsx(K,{title:"Details",onClick:()=>D("behavior.diagnostics.user_error_show_trace_ids")})]}),e.jsxs("select",{value:Re(x(f.value,["diagnostics","user_error_show_trace_ids"],void 0)),onChange:t=>z(r=>w(r,["diagnostics","user_error_show_trace_ids"],qe(t.target.value))),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"auto",children:"Auto (by mode)"}),e.jsx("option",{value:"on",children:"On"}),e.jsx("option",{value:"off",children:"Off"})]})]})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-zinc-500",children:["Stored at ",e.jsx("span",{className:"font-mono",children:"behavior.diagnostics.*"}),"."]})]})]}),e.jsxs("div",{className:"mt-4 rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Orchestrator (proactive suggestions)"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-4",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Default verbosity"}),e.jsx("input",{type:"number",min:.1,max:.9,step:.05,value:String(x(f.value,["orchestrator","default_verbosity"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(.1,Math.min(.9,Number(r)));w(m,["orchestrator","default_verbosity"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","default_verbosity"],.45))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Default suggestions limit"}),e.jsx("input",{type:"number",min:1,max:6,step:1,value:String(x(f.value,["orchestrator","default_suggestions_limit"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(1,Math.min(6,Number(r)));w(m,["orchestrator","default_suggestions_limit"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","default_suggestions_limit"],3))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Max suggestions limit"}),e.jsx("input",{type:"number",min:1,max:6,step:1,value:String(x(f.value,["orchestrator","max_suggestions_limit"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(1,Math.min(6,Number(r)));w(m,["orchestrator","max_suggestions_limit"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","max_suggestions_limit"],6))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Daily cap (level2)"}),e.jsx("input",{type:"number",min:0,max:200,step:1,value:String(x(f.value,["orchestrator","daily_cap","level2"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(200,Number(r)));w(m,["orchestrator","daily_cap","level2"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","daily_cap","level2"],20))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Daily cap (level1)"}),e.jsx("input",{type:"number",min:0,max:200,step:1,value:String(x(f.value,["orchestrator","daily_cap","level1"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(200,Number(r)));w(m,["orchestrator","daily_cap","level1"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","daily_cap","level1"],12))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"Daily cap (level0)"}),e.jsx("input",{type:"number",min:0,max:200,step:1,value:String(x(f.value,["orchestrator","daily_cap","level0"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(200,Number(r)));w(m,["orchestrator","daily_cap","level0"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","daily_cap","level0"],0))})]})]}),e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-3 md:grid-cols-4",children:["home","swipe","messages","search","title","diary","default"].map(t=>e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"text-[11px] text-zinc-500",children:["TTL ",t," (min)"]}),e.jsx("input",{type:"number",min:1,max:1440,step:1,value:String(x(f.value,["orchestrator","ttl_minutes",t],"")),onChange:r=>{const m=r.target.value;z(a=>{const M=m===""?void 0:Math.max(1,Math.min(1440,Number(m)));w(a,["orchestrator","ttl_minutes",t],isFinite(Number(M))?M:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","ttl_minutes",t],""))})]},t))}),e.jsxs("div",{className:"mt-4 rounded-lg border border-zinc-200 bg-zinc-50 p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Dismiss cooldown (minutes)"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Level 2"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"swipe"}),e.jsx("input",{type:"number",min:0,max:240,step:1,value:String(x(f.value,["orchestrator","cooldown_minutes","level2","swipe"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(240,Number(r)));w(m,["orchestrator","cooldown_minutes","level2","swipe"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","cooldown_minutes","level2","swipe"],""))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"default"}),e.jsx("input",{type:"number",min:0,max:240,step:1,value:String(x(f.value,["orchestrator","cooldown_minutes","level2","default"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(240,Number(r)));w(m,["orchestrator","cooldown_minutes","level2","default"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","cooldown_minutes","level2","default"],""))})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Level 1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"swipe"}),e.jsx("input",{type:"number",min:0,max:240,step:1,value:String(x(f.value,["orchestrator","cooldown_minutes","level1","swipe"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(240,Number(r)));w(m,["orchestrator","cooldown_minutes","level1","swipe"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","cooldown_minutes","level1","swipe"],""))})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"default"}),e.jsx("input",{type:"number",min:0,max:240,step:1,value:String(x(f.value,["orchestrator","cooldown_minutes","level1","default"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(240,Number(r)));w(m,["orchestrator","cooldown_minutes","level1","default"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","cooldown_minutes","level1","default"],""))})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsx("div",{className:"mb-2 text-[11px] font-semibold text-zinc-600",children:"Level 0"}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[11px] text-zinc-500",children:"default"}),e.jsx("input",{type:"number",min:0,max:1440,step:1,value:String(x(f.value,["orchestrator","cooldown_minutes","level0","default"],"")),onChange:t=>{const r=t.target.value;z(m=>{const a=r===""?void 0:Math.max(0,Math.min(1440,Number(r)));w(m,["orchestrator","cooldown_minutes","level0","default"],isFinite(Number(a))?a:void 0)})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",placeholder:String(x(C,["orchestrator","cooldown_minutes","level0","default"],""))})]})]})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-zinc-500",children:["Stored at ",e.jsx("span",{className:"font-mono",children:"behavior.orchestrator.cooldown_minutes"}),"."]})]})]}),nt?e.jsxs("div",{className:"mt-4 rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"mb-2 text-[11px] font-semibold text-zinc-700",children:["Proactivity diff vs defaults (",Ce.length,")"]}),Ce.length?e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Path"}),e.jsx(h,{children:"Default"}),e.jsx(h,{children:"Current"})]})}),e.jsx("tbody",{children:Ce.slice(0,80).map(t=>e.jsxs("tr",{children:[e.jsx(p,{className:"font-mono text-[11px]",children:t.path}),e.jsx(p,{className:"text-[11px]",children:Pe(t.a)}),e.jsx(p,{className:"text-[11px]",children:Pe(t.b)})]},t.path))})]})}):e.jsx("div",{className:"text-xs text-zinc-500",children:"No differences."}),Ce.length>80?e.jsx("div",{className:"mt-2 text-[11px] text-zinc-500",children:"Showing first 80 rows."}):null]}):null,rt?e.jsxs("div",{className:"mt-4 rounded-lg border border-zinc-200 bg-white p-3",children:[e.jsxs("div",{className:"mb-2 text-[11px] font-semibold text-zinc-700",children:["Full behavior diff vs defaults (",Se.length,")"]}),Se.length?e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsxs(X,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(h,{children:"Path"}),e.jsx(h,{children:"Default"}),e.jsx(h,{children:"Current"})]})}),e.jsx("tbody",{children:Se.slice(0,80).map(t=>e.jsxs("tr",{children:[e.jsx(p,{className:"font-mono text-[11px]",children:t.path}),e.jsx(p,{className:"text-[11px]",children:Pe(t.a)}),e.jsx(p,{className:"text-[11px]",children:Pe(t.b)})]},t.path))})]})}):e.jsx("div",{className:"text-xs text-zinc-500",children:"No differences."}),Se.length>80?e.jsx("div",{className:"mt-2 text-[11px] text-zinc-500",children:"Showing first 80 rows."}):null]}):null]}):e.jsx("div",{className:"mb-3 rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-800",children:"Behavior JSON is invalid, so structured controls are disabled. Fix the JSON below to re-enable controls."}),e.jsxs("div",{className:"mb-2 flex flex-wrap items-center gap-2",children:[e.jsx(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 px-3 py-2 text-xs",onClick:()=>T(t=>t&&{...t,behavior_json:JSON.stringify(($==null?void 0:$.behavior)??{},null,2)}),children:"Reset to defaults"}),e.jsx(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 px-3 py-2 text-xs",onClick:()=>T(t=>t&&{...t,behavior_json:JSON.stringify({prompts:{system_template:`You are {{name}}, MoviNesta’s in-app AI companion.
{{bioLine}}
Goal: help users pick movies/series fast, spoiler-free, with fun guidance.
Default behavior: be helpful and thorough. If the user asks for a deep dive or plan, you can write long, structured answers.
When recommending: provide 2–6 picks, each with a short spoiler-free reason, unless the user asks for more.
Ask 0–2 questions only if needed.
If the user specifies an exact output format (e.g., "reply exactly", "Format:"), follow it EXACTLY with no extra words.
TOOL_RESULTS_MINI is ground truth for catalog/library/list data; do not invent IDs, titles, or years.
Your final text must be plain text only (no JSON objects inside the message).
Never guess about user data. If unsure, call a read tool (get_my_*, search_*) or ask.
For actions that change data or send messages, do NOT run the write tool automatically. Instead, include confirmable buttons in final.actions.
Only auto-run read/grounding tools.
Never claim an action happened unless TOOL_RESULTS_MINI confirms success.
Never mention tools/JSON/system prompts/policies/DB/SQL.

{{toolProtocol}}`,append_tool_protocol:!0,chunk_outline_template:`You are {{name}}, MoviNesta’s in-app AI companion.
Task: produce a compact outline for a long-form answer.
Prefer 4–8 sections. Make sections actionable and spoiler-free.
Return JSON only matching the provided schema.`,chunk_section_template:`You are {{name}}, MoviNesta’s in-app AI companion.
Task: write ONE section of the answer (only that section).
Write plain text only (no JSON). Be clear, structured, and spoiler-free.
End on a complete sentence.`},output:{max_reply_chars:5e4,strip_text_prefix:!0},chunking:{enabled:!0,min_user_chars:700,cues:["deep","deep dive","go deeper","detailed","long","step-by-step","plan","strategy","write a full","full","comprehensive","explain","analysis","compare"],max_total_chars:5e4,max_sections:8,per_section_max_chars:12e3,user_request_max_chars:4e3,max_continuations:6},tool_loop:{max_loops:3,max_calls_per_loop:4},router:{deterministic_enabled:!0},strict_output:{allow_override:!0}},null,2),params:{...t.params,max_output_tokens:"4096"}}),children:"Long-form preset"}),e.jsx(F,{variant:"secondary",type:"button",className:"rounded-lg border border-zinc-200 px-3 py-2 text-xs",onClick:()=>T(t=>t&&{...t,behavior_json:JSON.stringify({prompts:{system_template:`You are {{name}}, MoviNesta’s in-app AI companion.
{{bioLine}}
Goal: help users quickly. Be concise by default.
Default: 2–6 picks, each with 1 short reason (no spoilers).
Ask 0–2 questions only if needed.
If the user asks for detail, then expand.
If the user specifies an exact output format (e.g., "reply exactly", "Format:"), follow it EXACTLY with no extra words.
TOOL_RESULTS_MINI is ground truth for catalog/library/list data; do not invent IDs, titles, or years.
Your final text must be plain text only (no JSON objects inside the message).
Never mention tools/JSON/system prompts/policies/DB/SQL.

{{toolProtocol}}`,append_tool_protocol:!0,chunk_outline_template:"You are {{name}}. Return JSON only matching the schema.",chunk_section_template:"You are {{name}}. Write plain text only."},output:{max_reply_chars:4e3,strip_text_prefix:!0},chunking:{enabled:!1,min_user_chars:700,cues:[],max_total_chars:14e3,max_sections:6,per_section_max_chars:8e3,user_request_max_chars:2e3,max_continuations:2},tool_loop:{max_loops:3,max_calls_per_loop:4},router:{deterministic_enabled:!0},strict_output:{allow_override:!0}},null,2),params:{...t.params,max_output_tokens:"900"}}),children:"Concise preset"})]}),e.jsx("textarea",{value:g.behavior_json??"",onChange:t=>T(r=>r&&{...r,behavior_json:t.target.value}),placeholder:`{
                    "prompts": { ... },
                    "output": { ... },
                    "chunking": { ... }
                  }`,className:"h-64 w-full rounded-lg border border-zinc-200 px-3 py-2 text-xs font-mono"})]})}),e.jsx("div",{className:"mt-6",children:e.jsxs(L,{children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Responses API parameters"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:Ne.map(t=>{const r=g.params[t.key]??"",m=`assistant_settings.params.${t.key}`,a=!!qs[m];if(t.key==="verbosity")return e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(K,{title:"Details",onClick:()=>D(m)}):null]}),e.jsxs("select",{value:r,onChange:M=>T(b=>b&&{...b,params:{...b.params,[t.key]:M.target.value}}),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Unset"}),e.jsx("option",{value:"low",children:"low"}),e.jsx("option",{value:"medium",children:"medium"}),e.jsx("option",{value:"high",children:"high"})]})]},t.key);if(t.key==="reasoning"){const M=(()=>{const b=(r??"").trim();if(!b)return"";try{const Y=JSON.parse(b),te=Y==null?void 0:Y.effort;return te==="low"||te==="medium"||te==="high"?te:"__custom__"}catch{return"__custom__"}})();return e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(K,{title:"Details",onClick:()=>D(m)}):null]}),e.jsxs("select",{value:M,onChange:b=>{const Y=b.target.value,te=Y===""?"":Y==="__custom__"?r:JSON.stringify({effort:Y},null,2);T(Ae=>Ae&&{...Ae,params:{...Ae.params,[t.key]:te}})},className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Unset"}),e.jsx("option",{value:"low",children:"effort: low"}),e.jsx("option",{value:"medium",children:"effort: medium"}),e.jsx("option",{value:"high",children:"effort: high"}),e.jsx("option",{value:"__custom__",children:"Custom JSON…"})]}),e.jsx("textarea",{value:r,onChange:b=>T(Y=>Y&&{...Y,params:{...Y.params,[t.key]:b.target.value}}),placeholder:'{ "effort": "medium" }',className:"h-24 w-full rounded-lg border border-zinc-200 px-3 py-2 text-xs font-mono"})]},t.key)}return t.type==="boolean"?e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(K,{title:"Details",onClick:()=>D(m)}):null]}),e.jsxs("select",{value:r,onChange:M=>T(b=>b&&{...b,params:{...b.params,[t.key]:M.target.value}}),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Unset"}),e.jsx("option",{value:"true",children:"true"}),e.jsx("option",{value:"false",children:"false"})]})]},t.key):t.type==="json"?e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(K,{title:"Details",onClick:()=>D(m)}):null]}),e.jsx("textarea",{value:r,onChange:M=>T(b=>b&&{...b,params:{...b.params,[t.key]:M.target.value}}),placeholder:"{}",className:"h-28 w-full rounded-lg border border-zinc-200 px-3 py-2 text-xs font-mono"})]},t.key):t.type==="string-array"?e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(K,{title:"Details",onClick:()=>D(m)}):null]}),e.jsx("textarea",{value:r,onChange:M=>T(b=>b&&{...b,params:{...b.params,[t.key]:M.target.value}}),placeholder:"One per line",className:"h-28 w-full rounded-lg border border-zinc-200 px-3 py-2 text-xs font-mono"})]},t.key):e.jsxs("label",{id:`field-param-${t.key}`,className:"flex flex-col gap-1 text-sm",children:[e.jsxs("span",{className:"flex items-center justify-between gap-2 text-xs font-semibold text-zinc-600",children:[e.jsx("span",{children:t.label}),a?e.jsx(K,{title:"Details",onClick:()=>D(m)}):null]}),t.type==="number"?e.jsx("input",{type:"number",min:t.min,max:t.max,step:t.step,value:r,onChange:M=>T(b=>b&&{...b,params:{...b.params,[t.key]:M.target.value}}),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm"}):e.jsx("input",{type:"text",value:r,onChange:M=>T(b=>b&&{...b,params:{...b.params,[t.key]:M.target.value}}),className:"rounded-lg border border-zinc-200 px-3 py-2 text-sm"})]},t.key)})}),st?e.jsx("div",{className:"mt-3 rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700",children:st}):null,e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx(F,{variant:"ghost",type:"button",onClick:async()=>{if(!g)return;ye(null);const t={};for(const a of Ne){const M=g.params[a.key]??"";if(a.type==="number"){const b=M.trim();t[a.key]=b?Number(b):null}else if(a.type==="boolean")M==="true"?t[a.key]=!0:M==="false"?t[a.key]=!1:t[a.key]=null;else if(a.type==="json"){const b=M.trim();if(!b)t[a.key]=null;else try{t[a.key]=JSON.parse(b)}catch{ye(`Invalid JSON for ${a.label}.`);return}}else a.type==="string-array"?t[a.key]=M.trim()?se(M):null:t[a.key]=M.trim()?M:null}let r=null;const m=(g.behavior_json??"").trim();if(m)try{r=JSON.parse(m)}catch{ye("Invalid JSON for Behavior.");return}try{await we.mutateAsync({openrouter_base_url:g.openrouter_base_url.trim()||null,model_fast:g.model_fast.trim()||null,model_creative:g.model_creative.trim()||null,model_planner:g.model_planner.trim()||null,model_maker:g.model_maker.trim()||null,model_critic:g.model_critic.trim()||null,fallback_models:g.fallback_models,model_catalog:g.model_catalog,default_instructions:g.default_instructions.trim()||null,params:t,behavior:r})}catch(a){ye((a==null?void 0:a.message)??"Failed to save settings.");return}},className:"rounded-xl bg-zinc-900 px-4 py-2 text-sm text-white",disabled:we.isPending,children:we.isPending?"Saving…":"Save settings"}),we.isSuccess?e.jsx("span",{className:"text-xs text-green-700",children:"Saved."}):null]})]})})]})})})(),Oe=V?Ps(V):null,pt=V?Ze(V,"effective"):void 0,fs=V?Ze(V,"draft"):void 0,ht=V?Ze(V,"default"):void 0,vs=(()=>{if(V)try{return JSON.stringify(pt)===JSON.stringify(ht)?"default":"overridden"}catch{return"overridden"}})(),Ns=V?{scope:"admin",default:ht,description:(Oe==null?void 0:Oe.details)??""}:null;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx(Ts,{children:"Assistant"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{variant:"ghost",type:"button",onClick:()=>U("metrics"),className:`rounded-xl px-3 py-2 text-sm ${P==="metrics"?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"Metrics"}),e.jsx(F,{variant:"ghost",type:"button",onClick:()=>U("diagnostics"),className:`rounded-xl px-3 py-2 text-sm ${P==="diagnostics"?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"Diagnostics"}),e.jsx(F,{variant:"ghost",type:"button",onClick:()=>U("settings"),className:`rounded-xl px-3 py-2 text-sm ${P==="settings"?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"Settings"}),P==="metrics"?e.jsxs("div",{className:"ml-2 flex items-center gap-2",children:[e.jsx(F,{variant:"ghost",type:"button",onClick:()=>O(7),className:`rounded-xl px-3 py-2 text-sm ${o===7?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"7d"}),e.jsx(F,{variant:"ghost",type:"button",onClick:()=>O(14),className:`rounded-xl px-3 py-2 text-sm ${o===14?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"14d"}),e.jsx(F,{variant:"ghost",type:"button",onClick:()=>O(30),className:`rounded-xl px-3 py-2 text-sm ${o===30?"bg-zinc-900 text-white":"bg-zinc-100 text-zinc-800"}`,children:"30d"})]}):P==="diagnostics"?e.jsx(F,{variant:"ghost",type:"button",onClick:()=>ie.refetch(),className:"ml-2 rounded-xl bg-zinc-100 px-3 py-2 text-sm text-zinc-800",children:"Refresh"}):null]})]}),js,e.jsx(Rs,{open:rs,settingKey:V,entry:Ns,status:vs,hint:Oe,effectiveValue:pt,draftValue:fs,recentHistory:null,onClose:()=>ot(!1),onCopyKey:()=>{var l,i;V&&((i=(l=navigator.clipboard)==null?void 0:l.writeText)==null||i.call(l,V).catch(()=>{}))},onApplyValue:l=>{V&&bs(V,l)},onNavigateToKey:l=>D(l,{scroll:!0})}),ls&&H?e.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:xt}),e.jsxs("div",{className:"relative ml-auto h-full w-full max-w-[720px] overflow-auto bg-white shadow-xl",children:[e.jsx("div",{className:"border-b border-zinc-200 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"AI provider error"}),e.jsxs("div",{className:"mt-1 text-xs text-zinc-500",children:[le(H.createdAt)," · ",e.jsx("span",{className:"font-mono",children:H.code})]})]}),e.jsx(F,{variant:"ghost",type:"button",className:"rounded-lg border border-zinc-200 bg-white",onClick:xt,children:"Close"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"rounded-lg border border-zinc-200 p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-600",children:"Summary"}),e.jsx("div",{className:"mt-1 text-sm text-zinc-800",children:H.reason}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:[e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-1 font-mono",children:H.requestId??""}),e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-1 font-mono",children:H.conversationId??""}),e.jsx("span",{className:"rounded-full bg-zinc-100 px-2 py-1 font-mono",children:H.userId??""})]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:(()=>{var i;const l=(i=H.culprit)==null?void 0:i.var;return e.jsxs(e.Fragment,{children:[e.jsx(pe,{label:"Copy debug JSON",text:JSON.stringify(H,null,2),className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs"}),l?e.jsx(F,{variant:"ghost",type:"button",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-xs",onClick:()=>D(String(l),{scroll:!0}),children:"Open culprit setting"}):null]})})()})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-600",children:"Culprit"}),(jt=H.culprit)!=null&&jt.var?e.jsx("span",{className:"text-xs font-mono text-zinc-700",children:H.culprit.var}):e.jsx("span",{className:"text-xs text-zinc-400",children:"—"})]}),e.jsx("pre",{className:"mt-2 overflow-auto rounded-lg bg-zinc-50 p-3 text-[11px] leading-snug text-zinc-800",children:JSON.stringify(H.culprit??{},null,2)})]}),e.jsxs("div",{className:"rounded-lg border border-zinc-200 p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-600",children:"Context"}),e.jsx("pre",{className:"mt-2 overflow-auto rounded-lg bg-zinc-50 p-3 text-[11px] leading-snug text-zinc-800",children:JSON.stringify(H.context??{},null,2)})]})]})]})]}):null,e.jsx($s,{open:!!ke,row:ke,onClose:()=>Ke(null)})]})}function $s(s){var U;if(_.useEffect(()=>{if(!s.open)return;const o=O=>{O.key==="Escape"&&s.onClose()};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[s.open,s.onClose]),!s.open||!s.row)return null;const n=s.row,{routing:v,decision:j}=Ht(n.meta),k=String((j==null?void 0:j.provider)??n.provider??"—"),E=(()=>{try{return JSON.stringify(n.meta??{},null,2)}catch{return String(n.meta??"{}")}})(),P=(()=>{try{return JSON.stringify(v??{},null,2)}catch{return String(v??"{}")}})();return e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:s.onClose}),e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full max-w-xl border-l border-zinc-200 bg-white p-5 shadow-xl",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight text-zinc-900",children:"Routing request details"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-zinc-500 font-mono",children:[e.jsx("span",{children:n.request_id??n.id}),e.jsx(pe,{text:String(n.request_id??n.id),label:"Copy request id",className:"h-8 px-2 py-1 text-xs"})]})]}),e.jsx(F,{variant:"ghost",type:"button",className:"rounded-xl px-3 py-2 text-sm text-zinc-600 hover:bg-zinc-100",onClick:s.onClose,"aria-label":"Close",children:"Close"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"When"}),e.jsx("div",{className:"text-zinc-700",children:le(n.created_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Function"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.fn})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Model"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.model??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Variant"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.variant??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Provider"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:k})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Upstream request"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.upstream_request_id??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Base URL"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:n.base_url??"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Policy mode"}),e.jsx("div",{className:"font-mono text-xs text-zinc-700",children:String(((U=v==null?void 0:v.policy)==null?void 0:U.mode)??"—")})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Routing policy"}),e.jsx(pe,{text:P,label:"Copy routing JSON",className:"h-8 px-2 py-1 text-xs"})]}),e.jsx("pre",{className:"mt-2 max-h-[24vh] overflow-auto rounded-2xl border border-zinc-200 bg-zinc-50 p-3 text-xs text-zinc-700",children:P})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-500",children:"Meta"}),e.jsx(pe,{text:E,label:"Copy JSON",className:"h-8 px-2 py-1 text-xs"})]}),e.jsx("pre",{className:"mt-2 max-h-[24vh] overflow-auto rounded-2xl border border-zinc-200 bg-zinc-50 p-3 text-xs text-zinc-700",children:E})]})]})]})}export{nr as default};
