import{c as O,r as v,j as e,f as V,t as X,d as Q,s as I,e as ee,R as k,L as H,g as W,h as te,u as ae,M as re,i as se,k as ne}from"./index-DLcJPtaT.js";import{c as le,B as N,S as R}from"./Button-CqL6-bGf.js";import{P as ie}from"./PageChrome-DNNm9VG4.js";import{T as oe}from"./TopBar-fWfwmUrG.js";import{q as de}from"./index-C72iKZMJ.js";import{F as G}from"./film-B1-3ac0G.js";import{S as me}from"./star-DI-RvBk9.js";import{u as ce,U as ue,a as xe}from"./useToggleFollow-HF43t6pM.js";import{U as pe}from"./users-DO_B5-1n.js";import{U as be}from"./user-DNjHOuM-.js";import{X as E}from"./x-CSH6lCyY.js";import"./brand-DTIDtbc4.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=O("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=O("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]),Y=v.forwardRef(({className:t,type:a,...d},c)=>e.jsx("input",{type:a,className:le("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:c,...d}));Y.displayName="Input";const K=v.createContext(null),ge=({value:t,defaultValue:a,onValueChange:d,className:c="",children:l})=>{const[x,g]=v.useState(a??""),r=v.useId(),b=t??x,f=i=>{t===void 0&&g(i),d==null||d(i)};return e.jsx(K.Provider,{value:{value:b,setValue:f,idBase:r},children:e.jsx("div",{className:c,children:l})})};function Z(){const t=v.useContext(K);if(!t)throw new Error("Tabs.* components must be used within <Tabs>");return t}const fe=({className:t="",children:a})=>{const d="flex max-w-full gap-1.5 overflow-x-auto rounded-full border border-mn-border-subtle/60 bg-mn-bg-elevated/70 p-1.5 backdrop-blur "+t;return e.jsx("div",{role:"tablist",className:d,children:a})},A=({value:t,icon:a,className:d="",children:c,...l})=>{const{value:x,setValue:g,idBase:r}=Z(),b=x===t,f=`${r}-tab-${t}`,m=["inline-flex items-center gap-1.5 whitespace-nowrap rounded-full px-3 py-1.5 text-[11px] font-medium outline-none transition",b?"bg-mn-primary text-mn-bg shadow-mn-soft":"bg-transparent text-mn-text-secondary hover:bg-mn-bg-elevated/70",d].filter(Boolean).join(" ");return e.jsxs("button",{type:"button",role:"tab","aria-selected":b,"aria-controls":`${r}-tabpanel-${t}`,id:f,className:m,onClick:()=>g(t),...l,children:[a&&e.jsx("span",{className:"inline-flex h-3.5 w-3.5",children:a}),e.jsx("span",{children:c})]})},q=({value:t,className:a="",children:d})=>{const{value:c,idBase:l}=Z();return c!==t?null:e.jsx("div",{role:"tabpanel",id:`${l}-tabpanel-${t}`,"aria-labelledby":`${l}-tab-${t}`,className:a,children:d})},ye=(t,a)=>{const[d,c]=v.useState(t);return v.useEffect(()=>{const l=window.setTimeout(()=>{c(t)},a);return()=>{window.clearTimeout(l)}},[t,a]),d},B=t=>{if(t!=null&&t.aborted)throw t.reason??new DOMException("Aborted","AbortError")};async function ve(t,a=1,d){const c=t.trim();if(!c)return{results:[],hasMore:!1};B(d);const l=await V("/search/multi",{query:c,include_adult:"false",page:a},d);B(d);const x=Array.isArray(l==null?void 0:l.results)?l.results:[];if(!x.length)return{results:[],hasMore:!1};const g=typeof(l==null?void 0:l.total_pages)=="number"?l.total_pages:1;return{results:x.filter(r=>!!(r&&typeof r.id=="number"&&(r.media_type==="movie"||r.media_type==="tv"))).slice(0,20).map(r=>{const b=r.media_type==="tv"?"tv":"movie",f=r.release_date??r.first_air_date??null,i=f?Number(String(f).slice(0,4)):null;return{tmdbId:Number(r.id),imdbId:r.imdb_id??null,title:r.title??r.name??"Untitled",year:Number.isNaN(i)?null:i,type:b,posterUrl:X(r.poster_path??null)}}),hasMore:a<g}}const T=t=>{if(t!=null&&t.aborted)throw t.reason??new DOMException("Aborted","AbortError")},je=t=>{const a=t.poster_url??t.backdrop_url??null;return{id:t.id,title:t.primary_title??t.original_title??"Untitled",year:t.release_year,type:t.content_type,source:"library",posterUrl:a,originalLanguage:t.language,ageRating:t.omdb_rated,imdbRating:t.imdb_rating,rtTomatoMeter:t.omdb_rt_rating_pct,imdbId:t.omdb_imdb_id,tmdbId:t.tmdb_id}},M=20,we=5,Ne=async(t,a,d,c)=>{var h,o;T(c);const l=`
    id:title_id,
    primary_title,
    original_title,
    release_year,
    content_type,
    poster_url,
    backdrop_url,
    language,
    omdb_rated,
    omdb_imdb_id,
    tmdb_id,
    imdb_rating,
    omdb_rt_rating_pct
  `,x=(h=a==null?void 0:a.genreIds)!=null&&h.length?`${l}, title_genres!inner(genre_id, genres(id, name))`:l,g=(d-1)*M;let r=I.from("titles").select(x,{distinct:!0,count:"exact"}).order("release_year",{ascending:!1}).range(g,g+M-1);if(c&&(r=r.abortSignal(c)),t){const p=`%${t}%`;r=r.or(`primary_title.ilike.${p},original_title.ilike.${p}`)}a!=null&&a.type&&a.type!=="all"&&(r=r.eq("content_type",a.type)),typeof(a==null?void 0:a.minYear)=="number"&&(r=r.gte("release_year",a.minYear)),typeof(a==null?void 0:a.maxYear)=="number"&&(r=r.lte("release_year",a.maxYear)),a!=null&&a.originalLanguage&&(r=r.eq("language",a.originalLanguage)),(o=a==null?void 0:a.genreIds)!=null&&o.length&&(r=r.in("title_genres.genre_id",a.genreIds));const{data:b,error:f,count:i}=await r.returns();if(f)throw new Error(f.message);T(c);const u=b??[],m=typeof i=="number"?i:void 0,n=m?g+u.length<m:u.length===M;return{results:u.map(je),hasMore:n}},_e=async t=>{const{query:a,filters:d,page:c=1,signal:l}=t,x=a.trim();T(l);let g=[],r=!1;try{const{results:o,hasMore:p}=await Ne(x,d,c,l);g=o,r=p}catch(o){console.warn("[search.service] Supabase search failed, falling back to TMDb",o)}const{results:b,hasMore:f}=await ve(x,c,l);if(T(l),!b.length&&g.length>0)return{results:g,hasMore:r};const i=new Set;for(const o of g)o.tmdbId&&i.add(o.tmdbId);const u=b.filter(o=>o.tmdbId&&!i.has(o.tmdbId)).slice(0,we),m=new Map;if(u.length)try{const o=await Q("catalog-sync-batch",{items:u.map(y=>({tmdbId:y.tmdbId,imdbId:y.imdbId??void 0,mediaType:y.type==="tv"?"tv":"movie"})),options:{syncOmdb:!0,syncYoutube:!0,forceRefresh:!1}},{signal:l}),p=(o==null?void 0:o.results)??[];for(const y of p)y.tmdbId&&y.titleId&&m.set(y.tmdbId,y.titleId)}catch(o){console.warn("[search.service] catalog-sync-batch failed",o)}const n=await Promise.all(b.map(async o=>{if(T(l),o.tmdbId&&i.has(o.tmdbId))return null;const p=o.type==="tv"?"series":"movie",y=o.tmdbId&&m.get(o.tmdbId)?m.get(o.tmdbId):`tmdb-${o.tmdbId}`,j=y.startsWith("tmdb-")===!1;return{id:y,title:o.title,year:o.year??null,type:p,source:j?"external-synced":"external-only",posterUrl:o.posterUrl,originalLanguage:null,ageRating:null,imdbRating:null,rtTomatoMeter:null,imdbId:o.imdbId??null,tmdbId:o.tmdbId}}));return{results:[...g,...n.filter(o=>!!o)],hasMore:r||f}},Se=t=>{const{query:a,filters:d}=t,c=a.trim();return ee({queryKey:["search","titles",{query:c,filters:d}],enabled:c.length>0,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:(l,x)=>l.hasMore?x.length+1:void 0,queryFn:({signal:l,pageParam:x})=>_e({query:c,filters:d,page:x??1,signal:l})})},Fe=({item:t})=>{const a=[];t.year&&a.push(String(t.year)),t.type==="movie"&&a.push("Movie"),t.type==="series"&&a.push("Series"),t.originalLanguage&&a.push(`Language: ${t.originalLanguage}`),t.ageRating&&a.push(t.ageRating),t.imdbRating&&a.push(`IMDb ${t.imdbRating.toFixed(1)}`),t.rtTomatoMeter&&a.push(`RT ${t.rtTomatoMeter}%`);const d={library:"Library","external-synced":"Synced","external-only":"External"},c={library:"bg-mn-primary/10 text-mn-primary border-mn-primary/40","external-synced":"bg-emerald-500/10 text-emerald-400 border-emerald-500/30","external-only":"bg-mn-bg-elevated text-mn-text-muted border-mn-border-subtle"};return e.jsx("li",{children:e.jsxs(H,{to:`/title/${t.id}`,className:"flex gap-3 rounded-mn-card border border-mn-border-subtle bg-mn-bg/60 p-2 hover:bg-mn-bg-elevated/80",children:[t.posterUrl?e.jsx("img",{src:t.posterUrl,alt:t.title,className:"h-20 w-14 rounded-mn-card object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-20 w-14 items-center justify-center rounded-mn-card bg-mn-surface-muted",children:e.jsx(G,{className:"h-5 w-5 text-mn-text-muted","aria-hidden":"true"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-[12px] font-medium text-mn-text-primary",children:t.title}),e.jsx("span",{className:`shrink-0 rounded-full border px-2 py-0.5 text-[10px] font-medium ${c[t.source]}`,children:d[t.source]})]}),a.length>0&&e.jsx("p",{className:"text-[11px] text-mn-text-secondary",children:a.join(" • ")})]})]})})},Ye=({query:t,filters:a,onResetFilters:d})=>{const c=t.trim(),{data:l,isLoading:x,isError:g,error:r,fetchNextPage:b,hasNextPage:f,isFetchingNextPage:i}=Se({query:c,filters:a}),u=(l==null?void 0:l.pages.flatMap(p=>p.results))??[],m=u.length,n=[];a.type&&a.type!=="all"&&n.push(a.type==="movie"?"Movies":"Series"),typeof a.minYear=="number"&&n.push(`From ${a.minYear}`),typeof a.maxYear=="number"&&n.push(`Up to ${a.maxYear}`),a.originalLanguage&&n.push(`Language: ${a.originalLanguage==="en"?"English":a.originalLanguage}`);const h=n.length?n.join(" • "):"No filters applied",o=k.useRef(new Set);return k.useEffect(()=>{if(!u||!Array.isArray(u))return;const p=o.current;u.filter(j=>!(p.has(j.id)||!j.imdbId&&!j.tmdbId||j.imdbRating||j.rtTomatoMeter)).slice(0,3).forEach(j=>{p.add(j.id),I.functions.invoke("catalog-sync",{body:{external:{tmdbId:j.tmdbId??void 0,imdbId:j.imdbId??void 0,type:j.type==="series"?"tv":"movie"},options:{syncOmdb:!0,forceRefresh:!1}}}).catch(S=>{console.warn("[SearchTitlesTab] catalog-sync failed for",j.id,S)})})},[l]),c?x?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-mn-text-secondary",children:["Searching for ",e.jsx("span",{className:"font-semibold text-mn-text-primary",children:c}),"…"]}),e.jsx("p",{className:"text-[11px] text-mn-text-muted",children:"Fetching matching titles from your catalog and external sources."}),e.jsx("div",{className:"space-y-2",children:[0,1,2].map(p=>e.jsxs("div",{className:"flex gap-3 rounded-mn-card border border-mn-border-subtle bg-mn-bg/60 p-2",children:[e.jsx("div",{className:"h-16 w-11 animate-pulse rounded-xl bg-mn-bg-elevated/60"}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center space-y-1.5",children:[e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-mn-bg-elevated/60"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-mn-bg-elevated/40"})]})]},p))})]}):g?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-mn-text-destructive",children:"Something went wrong while searching for titles."}),r&&e.jsxs("p",{className:"text-[11px] text-mn-text-muted",children:[e.jsx("span",{className:"font-semibold",children:"Details: "}),r.message]})]}):m?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-[11px] text-mn-text-secondary",children:["Showing ",e.jsx("span",{className:"font-semibold text-mn-text-primary",children:m})," result",m===1?"":"s"," across your catalog and external sources for"," ",e.jsx("span",{className:"font-semibold text-mn-text-primary",children:c}),"."]}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",className:"h-auto rounded-full border-mn-border-subtle px-2 py-1 text-[10px] text-mn-text-muted hover:border-mn-border-strong hover:text-mn-text-primary",onClick:d,children:[e.jsx(R,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Reset filters"})]})]}),e.jsx("div",{className:"rounded-mn-card border border-mn-border-subtle bg-mn-bg/60 p-3",children:e.jsxs("p",{className:"flex items-center gap-2 text-[11px] text-mn-text-secondary",children:[e.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-mn-surface-muted text-[10px] font-medium text-mn-text-muted",children:e.jsx(R,{className:"h-3 w-3","aria-hidden":"true"})}),e.jsx("span",{className:"truncate",children:h})]})}),e.jsx(de,{style:{height:"70vh"},data:u,endReached:()=>{f&&!i&&b()},computeItemKey:(p,y)=>y.id,components:{List:k.forwardRef((p,y)=>e.jsx("ul",{ref:y,className:"space-y-2",...p})),Footer:()=>f?e.jsx("div",{className:"flex justify-center py-3",children:e.jsx(N,{type:"button",className:"inline-flex items-center justify-center gap-2 rounded-full bg-mn-primary px-4 py-2 text-[11px] font-medium text-white shadow-mn-soft transition hover:bg-mn-primary/90 disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>b(),disabled:i,children:i?"Loading more…":"Load more results"})}):null},itemContent:(p,y)=>e.jsx(Fe,{item:y})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-mn-text-secondary",children:["No titles found matching"," ",e.jsx("span",{className:"font-semibold text-mn-text-primary",children:c}),"."]}),e.jsx("p",{className:"text-[11px] text-mn-text-muted",children:"Try adjusting your search or removing some filters to see more results."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-mn-text-secondary",children:"Start typing a title, director, or genre to search the catalog. As you wire Supabase search, results will appear here."}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-[11px] font-medium text-mn-text-primary",children:"Try searching for"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-[11px]",children:["Sci-fi romance","Feel-good comedies","Films from 2020s","Cozy rainy-day movies"].map(p=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-mn-border-subtle px-2 py-1 text-mn-text-muted",children:[e.jsx(G,{className:"mr-1 h-3 w-3 text-mn-text-muted","aria-hidden":"true"}),p]},p))})]}),e.jsxs("div",{className:"space-y-1.5 rounded-mn-card border border-mn-border-subtle bg-mn-bg/60 p-3",children:[e.jsxs("p",{className:"flex items-center gap-1 text-[11px] font-medium text-mn-text-primary",children:[e.jsx(me,{className:"h-3.5 w-3.5 text-mn-primary","aria-hidden":"true"}),e.jsx("span",{children:"Trending this week"})]}),e.jsx("p",{className:"text-[11px] text-mn-text-muted",children:"Once analytics are wired up, you can show what your friends and the community are watching the most here."})]})]})},Ie=t=>{const a=t.trim(),{user:d}=W();return te({queryKey:["search","people",{query:a,userId:(d==null?void 0:d.id)??null}],enabled:a.length>0,queryFn:async()=>{const c=a.replace(/%/g,"\\%").replace(/_/g,"\\_"),l=await I.from("profiles").select("id, username, display_name, avatar_url, bio").returns().or(`username.ilike.%${c}%,display_name.ilike.%${c}%`).limit(20);if(l.error)throw new Error(l.error.message);const x=l.data??[],g=x.map(i=>i.id);let r=new Map;if(g.length){const i=await I.from("user_stats").select("user_id, followers_count, following_count").returns().in("user_id",g);i.error?console.warn("[useSearchPeople] Failed to load user_stats",i.error.message):r=new Map((i.data??[]).map(u=>[u.user_id,{followersCount:u.followers_count??0,followingCount:u.following_count??0}]))}if(!(d!=null&&d.id))return x.map(i=>{const u=r.get(i.id);return{id:i.id,username:i.username,displayName:i.display_name,avatarUrl:i.avatar_url,bio:i.bio,followersCount:(u==null?void 0:u.followersCount)??null,followingCount:(u==null?void 0:u.followingCount)??null,isFollowing:!1}});const b=await I.from("follows").select("followed_id").returns().eq("follower_id",d.id);b.error&&console.warn("[useSearchPeople] Failed to load follows for current user",b.error.message);const f=new Set((b.data??[]).map(i=>i.followed_id));return x.map(i=>{const u=r.get(i.id);return{id:i.id,username:i.username,displayName:i.display_name,avatarUrl:i.avatar_url,bio:i.bio,followersCount:(u==null?void 0:u.followersCount)??null,followingCount:(u==null?void 0:u.followingCount)??null,isFollowing:f.has(i.id)}})}})},Te=({query:t})=>{const a=t.trim(),{data:d,isLoading:c,isError:l,error:x}=Ie(a),g=ce(),r=ae(),{user:b}=W(),[f,i]=v.useState(null),u=d??[],m=async n=>{if(!(b!=null&&b.id)){alert("You need to be signed in to start a conversation.");return}if(b.id===n){alert("You can't start a conversation with yourself.");return}i(n);try{const h=await Q("create-direct-conversation",{targetUserId:n},{timeoutMs:25e3});if(!(h!=null&&h.ok)||!h.conversationId){const o=h==null?void 0:h.errorCode;let p=(h==null?void 0:h.error)??"Failed to get conversation id. Please try again.";o==="UNAUTHORIZED"?p="You need to be signed in to start a conversation.":o==="BAD_REQUEST_SELF_TARGET"?p="You can't start a conversation with yourself.":o==="SERVER_MISCONFIGURED"&&(p="Messaging is temporarily unavailable due to a server issue. Please try again later.");const y=new Error(p);throw y.code=o,y}r(`/messages/${h.conversationId}`)}catch(h){console.error("[SearchPeopleTab] Failed to start conversation",h);const o=h instanceof Error?h.message:"Something went wrong while starting the conversation. Please try again.";alert(o)}finally{i(null)}};return a?c?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-mn-text-secondary",children:"Searching for people…"}),e.jsx("div",{className:"rounded-mn-card border border-mn-border-subtle bg-mn-bg-elevated/80 px-3 py-4 text-[11px] text-mn-text-muted",children:"We'll show matching profiles here as soon as the results come back."})]}):l?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-mn-text-primary",children:"Something went wrong."}),e.jsx("p",{className:"text-[11px] text-mn-text-muted",children:(x==null?void 0:x.message)??"We couldn&apos;t search for people right now. Please try again."})]}):!u||u.length===0?e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{className:"text-[12px] text-mn-text-secondary",children:["No people found for"," ",e.jsxs("span",{className:"rounded border border-mn-border-subtle bg-mn-bg-elevated px-1.5 py-0.5 text-[11px] font-medium text-mn-text-primary",children:["“",a,"”"]}),". Try a different name or username."]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("p",{className:"text-[11px] text-mn-text-secondary",children:["Showing ",u.length," profile",u.length===1?"":"s"," for"," ",e.jsxs("span",{className:"rounded border border-mn-border-subtle bg-mn-bg-elevated px-1.5 py-0.5 text-[11px] font-medium text-mn-text-primary",children:["“",a,"”"]})]})}),e.jsx("ul",{className:"divide-y divide-mn-border-subtle/60 rounded-mn-card border border-mn-border-subtle bg-mn-bg-elevated/80",children:u.map(n=>{var p;const h=n.displayName??n.username??"Unknown user",o=n.username?`@${n.username}`:null;return e.jsxs("li",{className:"flex items-center justify-between gap-3 px-3 py-2 hover:bg-mn-bg-elevated/80",children:[e.jsxs(H,{to:n.username?`/u/${n.username}`:`/u/${n.id}`,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-mn-bg-elevated/80 text-[14px] font-semibold text-mn-text-primary",children:n.avatarUrl?e.jsx("img",{src:n.avatarUrl,alt:h,className:"h-8 w-8 rounded-full object-cover",loading:"lazy"}):h?(p=h[0])==null?void 0:p.toUpperCase():e.jsx(be,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-[13px] font-medium text-mn-text-primary",children:h}),o&&e.jsx("p",{className:"mt-0.5 text-[11px] text-mn-text-muted",children:o}),n.bio&&e.jsx("p",{className:"mt-0.5 line-clamp-2 text-[11px] text-mn-text-secondary",children:n.bio}),(typeof n.followersCount=="number"||typeof n.followingCount=="number")&&e.jsxs("p",{className:"mt-0.5 text-[10px] text-mn-text-muted",children:[typeof n.followersCount=="number"&&e.jsxs("span",{children:[n.followersCount," follower",n.followersCount===1?"":"s"]}),typeof n.followersCount=="number"&&typeof n.followingCount=="number"&&e.jsx("span",{children:" · "}),typeof n.followingCount=="number"&&e.jsxs("span",{children:["following ",n.followingCount]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{type:"button",onClick:()=>g.mutate({targetUserId:n.id,currentlyFollowing:n.isFollowing}),disabled:g.isPending,variant:n.isFollowing?"outline":"default",size:"sm",className:`h-auto rounded-full px-2.5 py-1.5 text-[10px] font-medium ${n.isFollowing?"border-mn-border-subtle/80 bg-mn-bg-elevated/80 text-mn-text-primary hover:border-mn-primary/70 hover:text-mn-text-primary disabled:opacity-60":"border border-transparent bg-mn-primary text-mn-bg hover:bg-mn-primary/90 disabled:opacity-60"}`,children:n.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}),(b==null?void 0:b.id)!==n.id&&e.jsx(N,{type:"button",onClick:()=>m(n.id),disabled:f===n.id,variant:"outline",size:"sm",className:"h-auto rounded-full border-mn-border-subtle/80 bg-mn-bg-elevated/80 px-2.5 py-1.5 text-[10px] font-medium text-mn-text-primary shadow-mn-soft hover:border-mn-primary/70 hover:text-mn-text-primary disabled:cursor-not-allowed disabled:opacity-60",children:f===n.id?e.jsx("span",{children:"Starting…"}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Message"})]})})]})]},n.id)})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-mn-text-secondary",children:"Start typing a name or @username to find people. Once the social graph is wired up, you'll be able to follow friends and start conversations from here."}),e.jsxs("div",{className:"flex items-center gap-2 rounded-mn-card border border-dashed border-mn-border-subtle bg-mn-bg-elevated/60 px-3 py-2 text-[11px] text-mn-text-muted",children:[e.jsx(pe,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Search for people you know, then follow or message them."})]})]})},Ce=["all","movie","series","anime"],z=t=>t.get("tab")==="people"?"people":"titles",C=t=>{if(typeof t!="number")return;const a=new Date().getFullYear();return Math.min(Math.max(t,1900),a)},D=t=>{const a=t.get("type"),d=Ce.includes(a)?a:"all",c=r=>{if(!r)return;const b=Number(r);return Number.isFinite(b)?b:void 0},l=C(c(t.get("minYear"))),x=C(c(t.get("maxYear"))),g=t.get("lang")||void 0;return l&&x&&l>x?{type:d,minYear:x,maxYear:l,originalLanguage:g}:{type:d,minYear:l,maxYear:x,originalLanguage:g}},ke=(t,a)=>t.type===a.type&&t.minYear===a.minYear&&t.maxYear===a.maxYear&&t.originalLanguage===a.originalLanguage,Oe=()=>{const[t,a]=se(),d=z(t),c=t.get("q")??"",l=v.useMemo(()=>D(t),[t]),[x,g]=v.useState(d),[r,b]=v.useState(!1),[f,i]=v.useState(c),u=ye(f,300),[m,n]=v.useState(l);v.useEffect(()=>{x!=="titles"&&b(!1)},[x]),v.useEffect(()=>{!u.trim()&&r&&b(!1)},[u,r]);const h=v.useMemo(()=>{const s=new URLSearchParams(t);return s.set("tab",x),f.trim()?s.set("q",f.trim()):s.delete("q"),x==="titles"&&f.trim()?(s.set("type",m.type),m.minYear?s.set("minYear",String(m.minYear)):s.delete("minYear"),m.maxYear?s.set("maxYear",String(m.maxYear)):s.delete("maxYear"),m.originalLanguage?s.set("lang",m.originalLanguage):s.delete("lang")):(s.delete("type"),s.delete("minYear"),s.delete("maxYear"),s.delete("lang")),s},[x,f,t,m]);v.useEffect(()=>{h.toString()!==t.toString()&&a(h,{replace:!0})},[h,t,a]),v.useEffect(()=>{const s=z(t),w=t.get("q")??"",_=D(t);g(s),i(w),n($=>ke($,_)?$:_)},[t]),v.useEffect(()=>{const s=C(m.minYear),w=C(m.maxYear);if(s&&w&&s>w){n(_=>({..._,minYear:w,maxYear:s}));return}(s!==m.minYear||w!==m.maxYear)&&n(_=>({..._,minYear:s,maxYear:w}))},[m.maxYear,m.minYear]);const o=()=>{i(""),b(!1)},p=v.useCallback(s=>{n(w=>({...w,...s}))},[]),y=()=>{n({type:"all",minYear:void 0,maxYear:void 0,originalLanguage:void 0}),b(!1)},j=v.useMemo(()=>{const s=[];if(m.type!=="all"&&s.push({label:`Type: ${m.type.charAt(0).toUpperCase()}${m.type.slice(1)}`,onRemove:()=>p({type:"all"})}),m.minYear||m.maxYear){const w=m.minYear??"Any",_=m.maxYear??"Now";s.push({label:`Year: ${w} – ${_}`,onRemove:()=>p({minYear:void 0,maxYear:void 0})})}return m.originalLanguage&&s.push({label:`Language: ${m.originalLanguage.toUpperCase()}`,onRemove:()=>p({originalLanguage:void 0})}),s},[m,p]),S=j.length,L=S>0?`Filters (${S} active)`:"Filters (none applied)",F=x==="titles"&&(!!f.trim()||S>0),P=F?L:"Filters are locked until you start typing a title",J=s=>{s.preventDefault()};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-2 pt-1",children:[e.jsx(oe,{title:"Search without the clutter",subtitle:"Find titles, filmmakers, or friends instantly. Switch tabs to move between movies and people."}),e.jsxs(ie,{tone:"default",padded:!0,children:[e.jsxs("form",{onSubmit:J,className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 rounded-full border border-mn-border-subtle bg-mn-bg px-3 py-2 text-[13px] shadow-mn-soft focus-within:border-mn-primary/70",children:[e.jsx(ne,{className:"h-3.5 w-3.5 text-mn-text-muted","aria-hidden":"true"}),e.jsx(Y,{type:"search",value:f,onChange:s=>i(s.target.value),placeholder:"Search for movies, shows, or people...",className:"h-8 flex-1 border-none bg-transparent p-0 text-[13px] text-mn-text-primary shadow-none outline-none ring-0 placeholder:text-mn-text-muted focus-visible:ring-0",autoCorrect:"off",autoCapitalize:"none"}),f?e.jsx(N,{type:"button",onClick:o,variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full text-[10px] text-mn-text-muted hover:bg-mn-border-subtle/60 hover:text-mn-text-primary","aria-label":"Clear search",children:e.jsx(E,{className:"h-3 w-3","aria-hidden":"true"})}):null]}),e.jsxs(N,{type:"button",onClick:()=>{F&&b(s=>!s)},variant:"outline",size:"sm",className:`inline-flex items-center justify-center gap-1 rounded-full px-3 py-2 text-[11px] font-medium shadow-mn-soft ${F?"border-mn-border-subtle bg-mn-bg text-mn-text-secondary hover:border-mn-primary/70 hover:text-mn-text-primary":"cursor-not-allowed border-mn-border-subtle/60 bg-mn-bg/70 text-mn-text-muted"} ${r?"border-mn-primary/70 text-mn-text-primary":""}`,disabled:!F,"aria-pressed":F&&r,"aria-expanded":F&&r,"aria-controls":"search-title-filters","aria-label":P,title:P,children:[e.jsx(R,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:r?"Hide filters":"Filters"}),S>0?e.jsx("span",{className:"inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-mn-primary/15 px-1 text-[10px] font-semibold text-mn-primary",children:S}):null]}),F?e.jsxs("span",{className:"sr-only","aria-live":"polite",children:["Filters are available. ",L]}):e.jsx("span",{className:"text-[10px] text-mn-text-muted sm:ml-1 sm:inline","aria-live":"polite",children:"Start typing to enable title filters."})]}),x==="titles"&&e.jsx("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[11px] text-mn-text-secondary",children:j.length?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg-elevated/60 px-2 py-1 text-[10px] font-semibold uppercase tracking-wide text-mn-text-muted",children:"Active filters"}),j.map(s=>e.jsxs(N,{type:"button",onClick:s.onRemove,variant:"outline",size:"sm",className:"h-auto rounded-full border-mn-border-subtle bg-mn-bg px-2 py-1 text-[11px] text-mn-text-primary shadow-sm hover:border-mn-primary/70 hover:text-mn-text-primary",children:[e.jsx("span",{children:s.label}),e.jsx(E,{className:"h-3 w-3 text-mn-text-muted","aria-hidden":!0})]},s.label)),e.jsx(N,{type:"button",onClick:y,variant:"ghost",size:"sm",className:"h-auto rounded-full bg-mn-primary/10 px-3 py-1 text-[10px] font-semibold uppercase tracking-wide text-mn-primary hover:bg-mn-primary/15",children:"Reset all"})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg-elevated/50 px-2.5 py-1 text-[10px] font-medium text-mn-text-muted",children:[e.jsx(U,{className:"h-3 w-3","aria-hidden":!0}),"No filters applied"]})}),x==="titles"&&r&&e.jsxs("div",{id:"search-title-filters",className:"mt-3 space-y-3 rounded-xl border border-dashed border-mn-border-subtle/80 bg-mn-bg/70 p-3 text-[11px] text-mn-text-secondary",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-medium text-mn-text-primary",children:[e.jsx(U,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Filter titles"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-[1.4fr_1fr_1fr]",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.16em] text-mn-text-muted",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{key:"all",label:"All"},{key:"movie",label:"Movies"},{key:"series",label:"Series"},{key:"anime",label:"Anime"}].map(s=>{const w=m.type===s.key;return e.jsx(N,{type:"button",variant:w?"default":"outline",size:"sm",className:`h-auto rounded-full px-2.5 py-1 text-[10px] font-medium ${w?"bg-mn-primary text-mn-bg shadow-mn-soft":"border-mn-border-subtle bg-mn-bg/80 text-mn-text-secondary hover:border-mn-primary/60 hover:text-mn-text-primary"}`,onClick:()=>p({type:s.key}),"aria-pressed":w,children:s.label},s.key)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.16em] text-mn-text-muted",children:"Years"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsx(Y,{type:"number",min:1900,max:new Date().getFullYear(),value:m.minYear??"",onChange:s=>p({minYear:s.target.value?Number(s.target.value):void 0}),placeholder:"Min",className:"h-9 w-full border-mn-border-subtle bg-mn-bg px-2 py-1.5 text-[11px] text-mn-text-primary shadow-sm","aria-label":"Minimum year"}),e.jsx(Y,{type:"number",min:1900,max:new Date().getFullYear(),value:m.maxYear??"",onChange:s=>p({maxYear:s.target.value?Number(s.target.value):void 0}),placeholder:"Max",className:"h-9 w-full border-mn-border-subtle bg-mn-bg px-2 py-1.5 text-[11px] text-mn-text-primary shadow-sm","aria-label":"Maximum year"})]}),e.jsx("p",{className:"text-[10px] text-mn-text-muted",children:"Use a minimum, maximum, or both."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.16em] text-mn-text-muted",children:"Original language"}),e.jsxs("div",{className:"flex items-center gap-1.5 rounded-md border border-mn-border-subtle bg-mn-bg px-2 py-1.5 shadow-sm",children:[e.jsx(he,{className:"h-3.5 w-3.5 text-mn-text-muted","aria-hidden":"true"}),e.jsx(Y,{type:"text",value:m.originalLanguage??"",onChange:s=>p({originalLanguage:s.target.value||void 0}),placeholder:"e.g. en, ja",className:"h-8 w-full border-none bg-transparent p-0 text-[11px] text-mn-text-primary shadow-none placeholder:text-mn-text-muted focus-visible:ring-0"})]}),e.jsx("p",{className:"text-[10px] text-mn-text-muted",children:"Two-letter codes keep things simple."})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"flex items-center gap-1 text-[10px] text-mn-text-muted",children:[e.jsx("span",{className:"inline-flex h-1.5 w-1.5 rounded-full bg-mn-primary/80"}),"Filters shape the recommendations shown below."]}),e.jsx(N,{type:"button",variant:"link",size:"sm",className:"h-auto p-0 text-[10px] font-semibold text-mn-text-primary hover:text-mn-primary",onClick:y,children:"Reset filters"})]})]})]}),e.jsx("section",{className:"flex flex-1 flex-col gap-3",children:e.jsxs(ge,{value:x,onValueChange:s=>g(s),children:[e.jsxs(fe,{className:"inline-flex items-center gap-1 rounded-full border border-mn-border-subtle bg-mn-bg-elevated/80 p-1 text-[11px] shadow-mn-soft",children:[e.jsx(A,{value:"titles",children:"Titles"}),e.jsx(A,{value:"people",children:"People"})]}),e.jsxs("div",{"aria-live":"polite",className:"flex-1 rounded-mn-card border border-dashed border-mn-border-subtle/80 bg-mn-bg-elevated/60 px-3 py-3 text-[12px] text-mn-text-secondary",children:[e.jsx(q,{value:"titles",children:e.jsx(Ye,{query:u,filters:m,onResetFilters:y})}),e.jsx(q,{value:"people",children:e.jsx(Te,{query:u})})]})]})})]})};export{Oe as default};
