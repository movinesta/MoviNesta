import{g as c,h as m,s as t}from"./index-D8UbFo8l.js";const u=o=>(o==null?void 0:o.code)==="PGRST116",p=o=>{if(!o)return null;const r=o.trim();return r?r.startsWith("@")?r.slice(1):r:null},b=o=>{const{user:r}=c(),i=p(o);return m({queryKey:["profile","byUsername",i,(r==null?void 0:r.id)??null],enabled:!!i,queryFn:async()=>{if(!i)return null;const{data:l,error:e}=await t.from("profiles").select("id, username, display_name, avatar_url, bio").eq("username",i).maybeSingle();if(e)throw u(e)?new Error("Profile not found"):e;if(!l)throw new Error("Profile not found");const n=l.id,[{count:s,error:a},{count:y,error:d}]=await Promise.all([t.from("follows").select("followed_id",{count:"exact",head:!0}).eq("followed_id",n),t.from("follows").select("follower_id",{count:"exact",head:!0}).eq("follower_id",n)]);if(a)throw a;if(d)throw d;let w=!1;if(r&&r.id!==n){const{data:_,error:f}=await t.from("follows").select("follower_id").eq("follower_id",r.id).eq("followed_id",n).maybeSingle();if(f&&!u(f))throw f;w=!!_}return{id:n,username:l.username,displayName:l.display_name,avatarUrl:l.avatar_url,bio:l.bio,followersCount:s??0,followingCount:y??0,isFollowing:w,isCurrentUser:!!r&&r.id===n}}})},g=()=>{const{user:o}=c();return m({queryKey:["profile","current",(o==null?void 0:o.id)??null],enabled:!!o,queryFn:async()=>{if(!o)return null;const{data:r,error:i}=await t.from("profiles").select("id, username, display_name, avatar_url, bio").eq("id",o.id).maybeSingle();if(i)throw u(i)?new Error("Profile not found for current user"):i;if(!r)throw new Error("Profile not found for current user");const l=r.id,{data:e,error:n}=await t.from("user_stats").select("followers_count, following_count").eq("user_id",l).maybeSingle();if(n)throw n;const s=(e==null?void 0:e.followers_count)??0,a=(e==null?void 0:e.following_count)??0;return{id:l,username:r.username,displayName:r.display_name,avatarUrl:r.avatar_url,bio:r.bio,followersCount:s,followingCount:a,isFollowing:!1,isCurrentUser:!0}}})};export{g as a,b as u};
