import{c as x,l as g,s as u,v as f,u as h,w as _,j as e,B as y}from"./index-DyWq_Gt8.js";import{S as j}from"./share-2-CTB7qAGB.js";const v=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],w=x("chevron-left",v),N=s=>g({queryKey:["lists","detail",s],enabled:!!s,queryFn:async()=>{if(!s)return null;const{data:a,error:r}=await u.from("lists").select("id, user_id, name, description, is_public").eq("id",s).maybeSingle();if(r)throw new Error(r.message);if(!a)return null;const{data:o,error:l}=await u.from("list_items").select("title_id, position, created_at").eq("list_id",s).order("position",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!0}).limit(300);if(l)throw new Error(l.message);const n=o??[],i=Array.from(new Set(n.map(t=>t.title_id).filter(t=>!!t))),p=new Map;if(i.length){const{data:t,error:c}=await u.from("media_items").select(`id,
             kind,
             tmdb_title,
             tmdb_name,
             tmdb_original_title,
             tmdb_original_name,
             tmdb_release_date,
             tmdb_first_air_date,
             tmdb_poster_path,
             tmdb_backdrop_path,
             tmdb_original_language,
             omdb_title,
             omdb_year,
             omdb_language,
             omdb_imdb_id,
             omdb_imdb_rating,
             omdb_rating_rotten_tomatoes,
             omdb_poster,
             omdb_rated,
             tmdb_id`).in("id",i);if(!c&&t)for(const m of t){const d=f(m);p.set(m.id,{titleId:m.id,title:d.title??null,year:d.year??null,posterUrl:d.posterUrl??d.backdropUrl??null})}else c&&console.warn("[useListDetail] Failed to load titles",c.message)}const b=n.map(t=>p.get(t.title_id)??{titleId:t.title_id,title:null,year:null,posterUrl:null}).filter(t=>!!t.titleId);return{id:a.id,userId:a.user_id,name:a.name,description:a.description??null,isPublic:!!a.is_public,items:b}}}),k=async s=>{try{if(typeof navigator<"u"&&"share"in navigator){await navigator.share({title:s});return}}catch{}try{await navigator.clipboard.writeText(window.location.href)}catch{}},I=()=>{const s=h(),{listId:a}=_(),{data:r,isLoading:o,isError:l,error:n}=N(a);return e.jsxs("div",{className:"flex flex-1 flex-col pb-24",children:[e.jsxs("header",{className:"sticky top-0 z-10 flex items-center justify-between gap-2 border-b border-border bg-background px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>s(-1),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Back",children:e.jsx(w,{className:"h-5 w-5","aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"truncate text-sm font-semibold text-foreground",children:r?.name??"List"}),e.jsxs("p",{className:"truncate text-xs text-muted-foreground",children:[r?.items.length??0," titles"]})]})]}),e.jsx(y,{type:"button",size:"icon",variant:"ghost",onClick:()=>k(r?.name??"List"),"aria-label":"Share",children:e.jsx(j,{className:"h-4 w-4","aria-hidden":"true"})})]}),o&&e.jsx("div",{className:"px-4 py-6 text-xs text-muted-foreground",children:"Loading listâ€¦"}),l&&e.jsx("div",{className:"px-4 py-6",children:e.jsxs("div",{className:"rounded-2xl border border-destructive/40 bg-destructive/5 p-4 text-xs text-foreground shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:"Unable to load this list."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:n?.message??"Please try again in a moment."})]})}),!o&&!l&&r&&e.jsxs("div",{className:"px-3 py-4",children:[r.description&&e.jsx("p",{className:"mb-3 text-xs text-muted-foreground",children:r.description}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:r.items.map(i=>e.jsxs("button",{type:"button",className:"group relative overflow-hidden rounded-xl border border-border bg-muted/30",onClick:()=>s(`/title/${i.titleId}`),children:[i.posterUrl?e.jsx("img",{src:i.posterUrl,alt:i.title??"Title",className:"aspect-[2/3] w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"aspect-[2/3] w-full bg-muted"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/70 to-transparent px-2 pb-1 pt-6 opacity-0 transition group-hover:opacity-100",children:e.jsx("p",{className:"line-clamp-1 text-left text-[10px] font-semibold text-white",children:i.title??"Untitled"})})]},i.titleId))})]})]})};export{I as default};
