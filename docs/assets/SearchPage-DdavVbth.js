import{c as L,r as v,j as e,h as V,i as K,t as Z,k as O,s as F,l as J,R as T,B as N,L as Q,d as B,e as X,u as ee,M as re,m as te}from"./index-DhZ1aP8k.js";import{C as ae}from"./Chip-BzWWSk8Y.js";import{T as se,a as ne,b as U}from"./Tabs-BdTewCjQ.js";import{S as oe}from"./SearchField-BIWFspT_.js";import{P as le}from"./PageChrome-D5rVYUnf.js";import{T as ie}from"./TopBar-DqXtwt_r.js";import{Y as de}from"./index-iD4_ZCVg.js";import{F as H}from"./film-CREplfjy.js";import{S as ce}from"./star-Bb9N3hIp.js";import{u as ue,U as me,a as xe}from"./useToggleFollow-BcLCdC_E.js";import{U as pe}from"./users-B9oifkuI.js";import{U as fe}from"./user-CyDT3SLz.js";import{X as $}from"./x-DiTvPX9C.js";import"./brand-DTIDtbc4.js";const ge=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],A=L("funnel",ge);const he=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],be=L("languages",he);const ye=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],R=L("sliders-horizontal",ye),I=v.forwardRef(({className:r,type:t,...f},u)=>e.jsx("input",{type:t,className:V("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:u,...f}));I.displayName="Input";const je=(r,t)=>{const[f,u]=v.useState(r);return v.useEffect(()=>{const m=window.setTimeout(()=>{u(r)},t);return()=>{window.clearTimeout(m)}},[r,t]),f},ve=["all","movie","series","anime"],q=r=>r.get("tab")==="people"?"people":"titles",M=r=>{if(typeof r!="number")return;const t=new Date().getFullYear();return Math.min(Math.max(r,1900),t)},z=r=>{const t=r.get("type"),f=ve.includes(t)?t:"all",u=d=>{if(!d)return;const g=Number(d);return Number.isFinite(g)?g:void 0},m=M(u(r.get("minYear"))),c=M(u(r.get("maxYear"))),i=r.get("lang")||void 0;return m&&c&&m>c?{type:f,minYear:c,maxYear:m,originalLanguage:i}:{type:f,minYear:m,maxYear:c,originalLanguage:i}},we=(r,t)=>r.type===t.type&&r.minYear===t.minYear&&r.maxYear===t.maxYear&&r.originalLanguage===t.originalLanguage,D=r=>{if(r?.aborted)throw r.reason??new DOMException("Aborted","AbortError")};async function Ne(r,t=1,f){const u=r.trim();if(!u)return{results:[],hasMore:!1};D(f);const m=await K("/search/multi",{query:u,include_adult:!1,page:t},f);D(f);const c=Array.isArray(m?.results)?m.results:[];if(!c.length)return{results:[],hasMore:!1};const i=typeof m?.total_pages=="number"?m.total_pages:1;return{results:c.filter(d=>!!(d&&typeof d.id=="number"&&(d.media_type==="movie"||d.media_type==="tv"))).slice(0,20).map(d=>{const g=d.media_type==="tv"?"tv":"movie",h=d.release_date??d.first_air_date??null,n=h?Number(String(h).slice(0,4)):null;return{tmdbId:Number(d.id),imdbId:d.imdb_id??null,title:d.title??d.name??"Untitled",year:Number.isNaN(n)?null:n,type:g,posterUrl:Z(d.poster_path??null)}}),hasMore:t<i}}const Y=r=>{if(r?.aborted)throw r.reason??new DOMException("Aborted","AbortError")},_e=r=>{const t=r.poster_url??r.backdrop_url??null;return{id:r.title_id,title:r.primary_title??r.original_title??"Untitled",year:r.release_year,type:r.content_type,source:"library",posterUrl:t,originalLanguage:r.language,ageRating:r.omdb_rated,imdbRating:r.imdb_rating,rtTomatoMeter:r.rt_tomato_pct,imdbId:r.omdb_imdb_id,tmdbId:r.tmdb_id}},C=20,ke=5,Se=async(r,t,f,u)=>{Y(u);const m=`
    title_id,
    primary_title,
    original_title,
    release_year,
    content_type,
    poster_url,
    backdrop_url,
    language,
    omdb_rated,
    omdb_imdb_id,
    tmdb_id,
    imdb_rating,
    rt_tomato_pct
  `,c=(f-1)*C;let i=F.from("titles").select(m,{count:"exact"});if(t?.genreIds?.length){const{data:s,error:b}=await F.from("title_genres").select("title_id").in("genre_id",t.genreIds);if(b)throw new Error(b.message);i=i.in("title_id",s.map(o=>o.title_id))}if(i=i.order("release_year",{ascending:!1}).range(c,c+C-1),u&&(i=i.abortSignal(u)),r){const s=`%${r}%`;i=i.or(`primary_title.ilike.${s},original_title.ilike.${s}`)}t?.type&&t.type!=="all"&&(i=i.eq("content_type",t.type)),typeof t?.minYear=="number"&&(i=i.gte("release_year",t.minYear)),typeof t?.maxYear=="number"&&(i=i.lte("release_year",t.maxYear)),t?.originalLanguage&&(i=i.eq("language",t.originalLanguage));const{data:d,error:g,count:h}=await i;if(g)throw new Error(g.message);Y(u);const n=d??[],x=typeof h=="number"?h:void 0,l=x?c+n.length<x:n.length===C;return{results:n.map(_e),hasMore:l}},Fe=async r=>{const{query:t,filters:f,page:u=1,signal:m}=r,c=t.trim();Y(m);let i=[],d=!1;try{const{results:o,hasMore:p}=await Se(c,f,u,m);i=o,d=p}catch(o){console.warn("[search.service] Supabase search failed, falling back to TMDb",o)}const{results:g,hasMore:h}=await Ne(c,u,m);if(Y(m),!g.length&&i.length>0)return{results:i,hasMore:d};const n=new Set;for(const o of i)o.tmdbId&&n.add(o.tmdbId);const x=g.filter(o=>o.tmdbId&&!n.has(o.tmdbId)).slice(0,ke),l=new Map;if(x.length)try{const p=(await O("catalog-sync-batch",{items:x.map(y=>({tmdbId:y.tmdbId,imdbId:y.imdbId??void 0,contentType:y.type==="tv"?"series":"movie"})),options:{syncOmdb:!0,syncYoutube:!0,forceRefresh:!1}},{signal:m}))?.results??[];for(const y of p)y.tmdbId&&y.titleId&&l.set(y.tmdbId,y.titleId)}catch(o){console.warn("[search.service] catalog-sync-batch failed",o)}const s=await Promise.all(g.map(async o=>{if(Y(m),o.tmdbId&&n.has(o.tmdbId))return null;const p=o.type==="tv"?"series":"movie",y=o.tmdbId&&l.get(o.tmdbId)?l.get(o.tmdbId):`tmdb-${o.tmdbId}`,j=y.startsWith("tmdb-")===!1;return{id:y,title:o.title,year:o.year??null,type:p,source:j?"external-synced":"external-only",posterUrl:o.posterUrl,originalLanguage:null,ageRating:null,imdbRating:null,rtTomatoMeter:null,imdbId:o.imdbId??null,tmdbId:o.tmdbId}}));return{results:[...i,...s.filter(o=>!!o)],hasMore:d||h}},Ye=r=>{const{query:t,filters:f}=r,u=t.trim();return J({queryKey:["search","titles",{query:u,filters:f}],enabled:u.length>0,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:(m,c)=>m.hasMore?c.length+1:void 0,queryFn:({signal:m,pageParam:c})=>Fe({query:u,filters:f,page:c??1,signal:m})})},Ie=({item:r})=>{const t=[];r.year&&t.push(String(r.year)),r.type==="movie"&&t.push("Movie"),r.type==="series"&&t.push("Series"),r.originalLanguage&&t.push(`Language: ${r.originalLanguage}`),r.ageRating&&t.push(r.ageRating),r.imdbRating&&t.push(`IMDb ${r.imdbRating.toFixed(1)}`),r.rtTomatoMeter&&t.push(`RT ${r.rtTomatoMeter}%`);const f={library:"Library","external-synced":"Synced","external-only":"External"},u={library:"bg-primary/10 text-primary border-primary/40","external-synced":"bg-emerald-500/10 text-emerald-400 border-emerald-500/30","external-only":"bg-card text-muted-foreground border-border"};return e.jsx("div",{children:e.jsxs(Q,{to:`/title/${r.id}`,className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2 hover:bg-card/80",children:[r.posterUrl?e.jsx("img",{src:r.posterUrl,alt:r.title,className:"h-20 w-14 rounded-2xl object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-20 w-14 items-center justify-center rounded-2xl bg-muted",children:e.jsx(H,{className:"h-5 w-5 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-[12px] font-medium text-foreground",children:r.title}),e.jsx("span",{className:`shrink-0 rounded-full border px-2 py-0.5 text-xs font-medium ${u[r.source]}`,children:f[r.source]})]}),t.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.join(" • ")})]})]})})},Me=({query:r,filters:t,onResetFilters:f})=>{const u=r.trim(),{data:m,isLoading:c,isError:i,error:d,fetchNextPage:g,hasNextPage:h,isFetchingNextPage:n}=Ye({query:u,filters:t}),x=m?.pages.flatMap(p=>p.results)??[],l=x.length,s=[];t.type&&t.type!=="all"&&s.push(t.type==="movie"?"Movies":"Series"),typeof t.minYear=="number"&&s.push(`From ${t.minYear}`),typeof t.maxYear=="number"&&s.push(`Up to ${t.maxYear}`),t.originalLanguage&&s.push(`Language: ${t.originalLanguage==="en"?"English":t.originalLanguage}`);const b=s.length?s.join(" • "):"No filters applied",o=T.useRef(new Set);return T.useEffect(()=>{if(!x||!Array.isArray(x))return;const p=o.current;x.filter(j=>!(p.has(j.id)||!j.imdbId&&!j.tmdbId||j.imdbRating||j.rtTomatoMeter)).slice(0,3).forEach(j=>{p.add(j.id),F.functions.invoke("catalog-sync",{body:{external:{tmdbId:j.tmdbId??void 0,imdbId:j.imdbId??void 0,type:j.type==="series"?"tv":"movie"},options:{syncOmdb:!0,forceRefresh:!1}}}).catch(k=>{console.warn("[SearchTitlesTab] catalog-sync failed for",j.id,k)})})},[x]),u?c?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["Searching for ",e.jsx("span",{className:"font-semibold text-foreground",children:u}),"…"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fetching matching titles from your catalog and external sources."}),e.jsx("div",{className:"space-y-2",children:[0,1,2].map(p=>e.jsxs("div",{className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2",children:[e.jsx("div",{className:"h-16 w-11 animate-pulse rounded-xl bg-card/60"}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center space-y-1.5",children:[e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-card/60"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-card/40"})]})]},p))})]}):i?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-destructive",children:"Something went wrong while searching for titles."}),d&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Details: "}),d.message]})]}):l?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-semibold text-foreground",children:l})," result",l===1?"":"s"," across your catalog and external sources for"," ",e.jsx("span",{className:"font-semibold text-foreground",children:u}),"."]}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",className:"h-auto rounded-full border-border px-2 py-1 text-muted-foreground hover:border-border hover:text-foreground",onClick:f,children:[e.jsx(R,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Reset filters"})]})]}),e.jsx("div",{className:"rounded-2xl border border-border bg-background/60 p-3",children:e.jsxs("p",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground",children:e.jsx(R,{className:"h-3 w-3","aria-hidden":"true"})}),e.jsx("span",{className:"truncate",children:b})]})}),e.jsx(de,{style:{height:"70vh"},data:x,endReached:()=>{h&&!n&&g()},components:{List:T.forwardRef(function(y,j){return e.jsx("div",{ref:j,className:"space-y-2",...y})}),Footer:()=>h?e.jsx("div",{className:"flex justify-center py-3",children:e.jsx(N,{type:"button",className:"inline-flex items-center justify-center rounded-full bg-primary/90 disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>g(),disabled:n,children:n?"Loading more…":"Load more results"})}):null},itemContent:(p,y)=>e.jsx(Ie,{item:y})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No titles found matching"," ",e.jsx("span",{className:"font-semibold text-foreground",children:u}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search or removing some filters to see more results."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a title, director, or genre to search the catalog. As you wire Supabase search, results will appear here."}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-xs font-medium text-foreground",children:"Try searching for"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-xs",children:["Sci-fi romance","Feel-good comedies","Films from 2020s","Cozy rainy-day movies"].map(p=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-border px-2 py-1 text-muted-foreground",children:[e.jsx(H,{className:"mr-1 h-3 w-3 text-muted-foreground","aria-hidden":"true"}),p]},p))})]}),e.jsxs("div",{className:"space-y-1.5 rounded-2xl border border-border bg-background/60 p-3",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs font-medium text-foreground",children:[e.jsx(ce,{className:"h-3.5 w-3.5 text-primary","aria-hidden":"true"}),e.jsx("span",{children:"Trending this week"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Once analytics are wired up, you can show what your friends and the community are watching the most here."})]})]})},Te=r=>{const t=r.trim(),{user:f}=B();return X({queryKey:["search","people",{query:t,userId:f?.id??null}],enabled:t.length>0,queryFn:async()=>{const u=t.replace(/%/g,"\\%").replace(/_/g,"\\_"),m=await F.from("profiles").select("id, username, display_name, avatar_url, bio").or(`username.ilike.%${u}%,display_name.ilike.%${u}%`).limit(20);if(m.error)throw new Error(m.error.message);const c=m.data??[],i=c.map(n=>n.id);let d=new Map;if(i.length){const n=await F.from("user_stats").select("user_id, followers_count, following_count").in("user_id",i);n.error?console.warn("[useSearchPeople] Failed to load user_stats",n.error.message):d=new Map((n.data??[]).map(x=>[x.user_id,{followersCount:x.followers_count??0,followingCount:x.following_count??0}]))}if(!f?.id)return c.map(n=>{const x=d.get(n.id);return{id:n.id,username:n.username,displayName:n.display_name,avatarUrl:n.avatar_url,bio:n.bio,followersCount:x?.followersCount??null,followingCount:x?.followingCount??null,isFollowing:!1}});const g=await F.from("follows").select("followed_id").eq("follower_id",f.id);g.error&&console.warn("[useSearchPeople] Failed to load follows for current user",g.error.message);const h=new Set((g.data??[]).map(n=>n.followed_id));return c.map(n=>{const x=d.get(n.id);return{id:n.id,username:n.username,displayName:n.display_name,avatarUrl:n.avatar_url,bio:n.bio,followersCount:x?.followersCount??null,followingCount:x?.followingCount??null,isFollowing:h.has(n.id)}})}})},Ce=({query:r})=>{const t=r.trim(),{data:f,isLoading:u,isError:m,error:c}=Te(t),i=ue(),d=ee(),{user:g}=B(),[h,n]=v.useState(null),x=f??[],l=async s=>{if(!g?.id){alert("You need to be signed in to start a conversation.");return}if(g.id===s){alert("You can't start a conversation with yourself.");return}n(s);try{const b=await O("create-direct-conversation",{targetUserId:s},{timeoutMs:25e3});if(!b?.ok||!b.conversationId){const o=b?.errorCode;let p=b?.error??"Failed to get conversation id. Please try again.";o==="UNAUTHORIZED"?p="You need to be signed in to start a conversation.":o==="BAD_REQUEST_SELF_TARGET"?p="You can't start a conversation with yourself.":o==="SERVER_MISCONFIGURED"&&(p="Messaging is temporarily unavailable due to a server issue. Please try again later.");const y=new Error(p);throw y.code=o,y}d(`/messages/${b.conversationId}`)}catch(b){console.error("[SearchPeopleTab] Failed to start conversation",b);const o=b instanceof Error?b.message:"Something went wrong while starting the conversation. Please try again.";alert(o)}finally{n(null)}};return t?u?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Searching for people…"}),e.jsx("div",{className:"rounded-2xl border border-border bg-card/80 px-3 py-4 text-xs text-muted-foreground",children:"We'll show matching profiles here as soon as the results come back."})]}):m?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-foreground",children:"Something went wrong."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?.message??"We couldn&apos;t search for people right now. Please try again."})]}):!x||x.length===0?e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No people found for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",t,"”"]}),". Try a different name or username."]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",x.length," profile",x.length===1?"":"s"," for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",t,"”"]})]})}),e.jsx("ul",{className:"divide-y divide-border/60 rounded-2xl border border-border bg-card/80",children:x.map(s=>{const b=s.displayName??s.username??"Unknown user",o=s.username?`@${s.username}`:null;return e.jsxs("li",{className:"flex items-center justify-between gap-3 px-3 py-2 hover:bg-card/80",children:[e.jsxs(Q,{to:s.username?`/u/${s.username}`:`/u/${s.id}`,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-card/80 text-[14px] font-semibold text-foreground",children:s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:b,className:"h-8 w-8 rounded-full object-cover",loading:"lazy"}):b?b[0]?.toUpperCase():e.jsx(fe,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",children:b}),o&&e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:o}),s.bio&&e.jsx("p",{className:"mt-0.5 line-clamp-2 text-xs text-muted-foreground",children:s.bio}),(typeof s.followersCount=="number"||typeof s.followingCount=="number")&&e.jsxs("p",{className:"mt-0.5 text-xs text-muted-foreground",children:[typeof s.followersCount=="number"&&e.jsxs("span",{children:[s.followersCount," follower",s.followersCount===1?"":"s"]}),typeof s.followersCount=="number"&&typeof s.followingCount=="number"&&e.jsx("span",{children:" · "}),typeof s.followingCount=="number"&&e.jsxs("span",{children:["following ",s.followingCount]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{type:"button",onClick:()=>i.mutate({targetUserId:s.id,currentlyFollowing:s.isFollowing}),disabled:i.isPending,variant:s.isFollowing?"outline":"default",size:"sm",className:`h-auto rounded-full px-2.5 py-1.5 text-xs font-medium ${s.isFollowing?"border-border bg-card/80 text-foreground hover:border-primary/70 hover:text-foreground disabled:opacity-60":"border border-transparent bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-60"}`,children:s.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}),g?.id!==s.id&&e.jsx(N,{type:"button",onClick:()=>l(s.id),disabled:h===s.id,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-card/80 px-2.5 py-1.5 text-xs font-medium text-foreground shadow-md hover:border-primary/70 hover:text-foreground disabled:cursor-not-allowed disabled:opacity-60",children:h===s.id?e.jsx("span",{children:"Starting…"}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Message"})]})})]})]},s.id)})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a name or @username to find people. Once the social graph is wired up, you'll be able to follow friends and start conversations from here."}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-2 text-xs text-muted-foreground",children:[e.jsx(pe,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Search for people you know, then follow or message them."})]})]})},We=()=>{const[r,t]=te(),f=q(r),u=r.get("q")??"",m=v.useMemo(()=>z(r),[r]),[c,i]=v.useState(f),[d,g]=v.useState(!1),[h,n]=v.useState(u),x=je(h,300),[l,s]=v.useState(m);v.useEffect(()=>{c!=="titles"&&g(!1)},[c]),v.useEffect(()=>{!x.trim()&&d&&g(!1)},[x,d]);const b=v.useMemo(()=>{const a=new URLSearchParams(r);return a.set("tab",c),h.trim()?a.set("q",h.trim()):a.delete("q"),c==="titles"&&h.trim()?(a.set("type",l.type??"all"),l.minYear?a.set("minYear",String(l.minYear)):a.delete("minYear"),l.maxYear?a.set("maxYear",String(l.maxYear)):a.delete("maxYear"),l.originalLanguage?a.set("lang",l.originalLanguage):a.delete("lang")):(a.delete("type"),a.delete("minYear"),a.delete("maxYear"),a.delete("lang")),a},[c,h,r,l]);v.useEffect(()=>{b.toString()!==r.toString()&&t(b,{replace:!0})},[b,r,t]),v.useEffect(()=>{const a=q(r),w=r.get("q")??"",_=z(r);i(a),n(w),s(E=>we(E,_)?E:_)},[r]),v.useEffect(()=>{const a=M(l.minYear),w=M(l.maxYear);if(a&&w&&a>w){s(_=>({..._,minYear:w,maxYear:a}));return}(a!==l.minYear||w!==l.maxYear)&&s(_=>({..._,minYear:a,maxYear:w}))},[l.maxYear,l.minYear]);const o=()=>{n(""),g(!1)},p=v.useCallback(a=>{s(w=>({...w,...a}))},[]),y=()=>{s({type:"all",minYear:void 0,maxYear:void 0,originalLanguage:void 0}),g(!1)},j=v.useMemo(()=>{const a=[];if(l.type&&l.type!=="all"&&a.push({label:`Type: ${l.type.charAt(0).toUpperCase()}${l.type.slice(1)}`,onRemove:()=>p({type:"all"})}),l.minYear||l.maxYear){const w=l.minYear??"Any",_=l.maxYear??"Now";a.push({label:`Year: ${w} – ${_}`,onRemove:()=>p({minYear:void 0,maxYear:void 0})})}return l.originalLanguage&&a.push({label:`Language: ${l.originalLanguage.toUpperCase()}`,onRemove:()=>p({originalLanguage:void 0})}),a},[l,p]),k=j.length,W=k>0?`Filters (${k} active)`:"Filters (none applied)",S=c==="titles"&&(!!h.trim()||k>0),P=S?W:"Filters are locked until you start typing a title",G=a=>{a.preventDefault()};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-4",children:[e.jsx(ie,{title:"Search without the clutter",subtitle:"Find titles, filmmakers, or friends instantly. Switch tabs to move between movies and people."}),e.jsxs(le,{tone:"default",padded:!0,children:[e.jsxs("form",{onSubmit:G,className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2",children:[e.jsx(oe,{placeholder:"Search for movies, shows, or people...",value:h,onChange:a=>n(a.target.value),autoCorrect:"off",autoCapitalize:"none",className:"flex-1"}),h?e.jsx(N,{type:"button",onClick:o,variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full text-xs text-muted-foreground hover:bg-border/60 hover:text-foreground","aria-label":"Clear search",children:e.jsx($,{className:"h-3 w-3","aria-hidden":"true"})}):null]}),e.jsxs(N,{type:"button",onClick:()=>{S&&g(a=>!a)},variant:"outline",size:"sm",className:`inline-flex items-center justify-center gap-1 rounded-full px-3 py-2 text-xs font-medium shadow-md ${S?"border-border bg-background text-muted-foreground hover:border-primary/70 hover:text-foreground":"cursor-not-allowed border-border bg-background/70 text-muted-foreground"} ${d?"border-primary/70 text-foreground":""}`,disabled:!S,"aria-pressed":S&&d,"aria-expanded":S&&d,"aria-controls":"search-title-filters","aria-label":P,title:P,children:[e.jsx(R,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:d?"Hide filters":"Filters"}),k>0?e.jsx("span",{className:"inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-primary/15 px-1 text-xs font-semibold text-primary",children:k}):null]})]}),c==="titles"&&e.jsx("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:j.length?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"gap-1 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-muted-foreground",children:"Active filters"}),j.map(a=>e.jsxs(N,{type:"button",onClick:a.onRemove,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-background px-2 py-1 text-xs text-foreground shadow-sm hover:border-primary/70 hover:text-foreground",children:[e.jsx("span",{children:a.label}),e.jsx($,{className:"h-3 w-3 text-muted-foreground","aria-hidden":!0})]},a.label)),e.jsx(N,{type:"button",onClick:y,variant:"ghost",size:"sm",className:"h-auto rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-primary hover:bg-primary/15",children:"Reset all"})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-card/50 px-2.5 py-1 text-xs font-medium text-muted-foreground",children:[e.jsx(A,{className:"h-3 w-3","aria-hidden":!0}),"No filters applied"]})}),c==="titles"&&d&&e.jsxs("div",{id:"search-title-filters",className:"mt-3 space-y-3 rounded-xl border border-dashed border-border bg-background/70 p-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-foreground",children:[e.jsx(A,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Filter titles"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-[1.4fr_1fr_1fr]",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{key:"all",label:"All"},{key:"movie",label:"Movies"},{key:"series",label:"Series"},{key:"anime",label:"Anime"}].map(a=>{const w=l.type===a.key;return e.jsx(N,{type:"button",variant:w?"default":"outline",size:"sm",className:`h-auto rounded-full px-2.5 py-1 text-xs font-medium ${w?"bg-primary text-primary-foreground shadow-md":"border-border bg-background/80 text-muted-foreground hover:border-primary/60 hover:text-foreground"}`,onClick:()=>p({type:a.key}),"aria-pressed":w,children:a.label},a.key)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Years"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsx(I,{type:"number",min:1900,max:new Date().getFullYear(),value:l.minYear??"",onChange:a=>p({minYear:a.target.value?Number(a.target.value):void 0}),placeholder:"Min",className:"h-9 w-full border-border bg-background px-2 py-1.5 text-xs text-foreground shadow-sm","aria-label":"Minimum year"}),e.jsx(I,{type:"number",min:1900,max:new Date().getFullYear(),value:l.maxYear??"",onChange:a=>p({maxYear:a.target.value?Number(a.target.value):void 0}),placeholder:"Max",className:"h-9 w-full border-border bg-background px-2 py-1.5 text-xs text-foreground shadow-sm","aria-label":"Maximum year"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use a minimum, maximum, or both."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Original language"}),e.jsxs("div",{className:"flex items-center gap-1.5 rounded-md border border-border bg-background px-2 py-1.5 shadow-sm",children:[e.jsx(be,{className:"h-3.5 w-3.5 text-muted-foreground","aria-hidden":"true"}),e.jsx(I,{type:"text",value:l.originalLanguage??"",onChange:a=>p({originalLanguage:a.target.value||void 0}),placeholder:"e.g. en, ja",className:"h-8 w-full border-none bg-transparent p-0 text-xs text-foreground shadow-none placeholder:text-muted-foreground focus-visible:ring-0"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Two-letter codes keep things simple."})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-1.5 w-1.5 rounded-full bg-primary/80"}),"Filters shape the recommendations shown below."]}),e.jsx(N,{type:"button",variant:"link",size:"sm",className:"h-auto p-0 text-xs font-semibold text-foreground hover:text-primary",onClick:y,children:"Reset filters"})]})]})]}),e.jsxs("section",{className:"flex flex-1 flex-col gap-3",children:[e.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:e.jsx("div",{className:"w-full sm:max-w-lg",children:e.jsx(se,{value:c,onValueChange:a=>i(a),children:e.jsxs(ne,{className:"w-full",children:[e.jsx(U,{value:"titles",children:"Titles"}),e.jsx(U,{value:"people",children:"People"})]})})})}),e.jsx("div",{"aria-live":"polite",className:"flex-1 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-3 text-[12px] text-muted-foreground",children:c==="titles"?e.jsx(Me,{query:x,filters:l,onResetFilters:y}):e.jsx(Ce,{query:x})})]})]})};export{We as default};
