import{C as F,b as Ve,e as Xe,c as Pt,w as ve,s as $,aE as Z,as as le,aj as _t,r as d,ap as be,N as Mt,az as Rt,R as O,j as s,i as Ae,F as Tt,an as J,ag as Dt,B as It,aw as $t,aF as Lt,E as Ot,O as Ut,P as G,_ as fe,U as V,W as Y,aG as Ft}from"./index-B1gR2HyV.js";import{u as Bt,C as Ht}from"./conversationsCache-CVhhJqhn.js";import{a as Wt,b as zt}from"./format-BXv9LLlt.js";import{D as qe,a as Ge,f as Yt,b as Vt,c as Xt,d as qt}from"./dialog-JvJB_ZLZ.js";import{P as Gt}from"./plus-0vXhlSCG.js";import{X as Kt}from"./x-KxSQUesR.js";import{C as Qt}from"./copy-CEOjqdt5.js";import{C as Jt}from"./circle-alert-DSoZrRVH.js";import{u as Zt}from"./index-C4Lj_15j.js";const er=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Ue=F("check-check",er);const tr=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Ke=F("external-link",tr);const rr=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],nr=F("file-text",rr);const sr=[["path",{d:"M5 12h14",key:"1ays0h"}]],or=F("minus",sr);const ar=[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]],lr=F("music-2",ar);const ir=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],cr=F("pen-line",ir);const ur=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],dr=F("rotate-ccw",ur);const fr=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],mr=F("trash-2",fr);async function Qe(e,t,r){const{data:o,error:n}=await e.from("blocked_users").select("blocker_id, blocked_id").or(`and(blocker_id.eq.${t},blocked_id.eq.${r}),and(blocker_id.eq.${r},blocked_id.eq.${t})`);if(n)throw n;const a=o??[],i=a.some(c=>c.blocker_id===t&&c.blocked_id===r),l=a.some(c=>c.blocker_id===r&&c.blocked_id===t);return{youBlocked:i,blockedYou:l}}const Dn=e=>{const{user:t}=Ve(),r=t?.id??null,o=Xe(),n=["block-status",r,e],a=Pt({queryKey:n,enabled:!!(r&&e&&r!==e),staleTime:3e4,queryFn:async()=>{if(!r||!e||r===e)return{youBlocked:!1,blockedYou:!1};try{return await Qe($,r,e)}catch(h){console.error("[useBlockStatus] Failed to load block status",h);const p=h;throw new Error(p.message??"Failed to load block status")}}}),i=ve({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for block operation.");const{error:h}=await $.from("blocked_users").upsert({blocker_id:r,blocked_id:e,created_at:new Date().toISOString()},{onConflict:"blocker_id,blocked_id"});if(h)throw console.error("[useBlockStatus] Failed to block user",h),new Error(h.message)},onSuccess:()=>{o.invalidateQueries({queryKey:n})}}),l=ve({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for unblock operation.");const{error:h}=await $.from("blocked_users").delete().eq("blocker_id",r).eq("blocked_id",e);if(h)throw console.error("[useBlockStatus] Failed to unblock user",h),new Error(h.message)},onSuccess:()=>{o.invalidateQueries({queryKey:n})}}),c=a.data?.youBlocked??!1,u=a.data?.blockedYou??!1,f=c||u,m=i.isPending||l.isPending;return{youBlocked:c,blockedYou:u,isBlocked:f,isLoading:a.isLoading||m,isError:a.isError,error:a.error??null,block:i,unblock:l}},hr=({isSelf:e,isDeleted:t})=>({bubbleColors:t?"bg-muted text-muted-foreground border border-dashed border-border":e?"bg-primary text-white shadow-[0_0_20px_-6px_rgba(127,19,236,0.5)]":"bg-card text-foreground border border-border/60",bubbleShape:e?"rounded-2xl rounded-tr-sm":"rounded-2xl rounded-tl-sm"}),ye=e=>{const t=new Date(e);return Number.isNaN(t.getTime())?"":zt(t,{hour:"numeric",minute:"2-digit",hour12:!0})},Se=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),pr=e=>{const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const r=new Date,o=new Date;return o.setDate(r.getDate()-1),Se(t,r)?"Today":Se(t,o)?"Yesterday":Wt(t,{day:"numeric",month:"short",year:"numeric"})},Fe=(e,t,r=180*1e3)=>{const o=new Date(e),n=new Date(t);return Number.isNaN(o.getTime())||Number.isNaN(n.getTime())?!1:n.getTime()-o.getTime()<=r},xr=e=>({id:e.id,conversationId:e.conversation_id,senderId:e.user_id,body:e.body??null,attachmentUrl:e.attachment_url??null,createdAt:e.created_at??new Date().toISOString(),text:e.text??null,clientId:e.client_id??null,meta:e.meta??null}),In=e=>({userId:e.user_id,lastReadAt:e.last_read_at??null,lastReadMessageId:e.last_read_message_id??null}),$n=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,deliveredAt:e.delivered_at??e.created_at??new Date().toISOString()}),Ln=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,emoji:e.emoji,createdAt:e.created_at}),me="temp-",te=e=>e.startsWith(me),gr=e=>te(e)?e:`${me}${e}`,On=(e=Date.now())=>`${me}${e}`,br=(e=Date.now())=>`${me}${e}-${Math.random().toString(36).slice(2,8)}`,Un=(e,t={})=>{const{dedupe:r=!0,excludeTemp:o=!1,sort:n=!1}=t,a=e.filter(l=>typeof l=="string").map(l=>l.trim()).filter(Boolean).filter(l=>o?!te(l):!0),i=r?Array.from(new Set(a)):a;return n&&i.sort(),i},Be=()=>({pages:[{items:[],hasMore:!0,cursor:null}],pageParams:[null]}),Je=e=>[...e].sort((t,r)=>{const o=le(t.createdAt),n=le(r.createdAt);return o!==n?o-n:t.id.localeCompare(r.id)}),ee=e=>{const t=new Map;for(const a of e)t.set(a.id,a);const r=new Map,o=[];for(const a of t.values()){const i=a.clientId??Z(a.body);if(!i){o.push(a);continue}const l=r.get(i);l?l.push(a):r.set(i,[a])}const n=[...o];for(const a of r.values()){if(a.length<=1){n.push(...a);continue}const i=a.filter(c=>!te(c.id));if(i.length>0){n.push(...i);continue}const l=a.reduce((c,u)=>{if(!c)return u;const f=le(c.createdAt),m=le(u.createdAt);return m!==f?m>f?u:c:u.id.localeCompare(c.id)>0?u:c},null);l&&n.push(l)}return Je(n)},U=e=>!e||!Array.isArray(e.pages)||!Array.isArray(e.pageParams)?Be():e,yr=e=>e.length?{createdAt:e[0].createdAt,id:e[0].id}:null,re=e=>{const t=(e.pages??[]).map(r=>({...r,items:Array.isArray(r.items)?[...r.items]:[]}));return t.length>0?t:[{items:[],hasMore:!0,cursor:null}]},He=(e,t)=>{const r=U(e),o=re(r),n=o[o.length-1],a=new Map;for(const i of n.items??[])a.set(i.id,i);return a.set(t.id,t),n.items=ee(Array.from(a.values())),{...r,pages:o}},Fn=(e,t)=>{const r=U(e),o=re(r).map(n=>({...n,items:(n.items??[]).map(a=>a.id===t.id?t:a)}));return{...r,pages:o}},Bn=(e,t)=>{const r=U(e),o=re(r).map(n=>({...n,items:(n.items??[]).filter(a=>a.id!==t)}));return{...r,pages:o}},wr=(e,t)=>{const r=U(e),o=re(r),n=t.tempId??null,a=t.row,i=a.clientId??Z(a.body);if(n)for(const c of o)c.items=(c.items??[]).filter(u=>u.id!==n);if(i)for(const c of o)c.items=(c.items??[]).filter(u=>!(te(u.id)&&Z(u.body)===i));let l=!1;for(const c of o){const u=(c.items??[]).findIndex(f=>f.id===a.id);if(u>=0){c.items[u]=a,c.items=ee(c.items),l=!0;break}}if(!l){const c=o[o.length-1];c.items=ee([...c.items??[],a])}return{...r,pages:o}},Hn=(e,t)=>{const r=U(e),o=U(t),n=g=>{if(g==null)return"initial";if(typeof g=="string")return`s:${g}`;if(typeof g=="number")return`n:${g}`;if(typeof g=="boolean")return`b:${g}`;if(typeof g=="object")try{return`o:${JSON.stringify(g)}`}catch{return"o:[unserializable]"}return`u:${String(g)}`},a=new Map,i=r.pageParams??[];for(const[g,y]of r.pages.entries()){const x=i[g];a.set(n(x),y)}const l=new Map,c=o.pageParams??[];for(const[g,y]of o.pages.entries()){const x=c[g];l.set(n(x),y)}const u=[],f=[],m=(o.pages.length>=r.pages.length?c:i)??[],h=new Set;for(const g of m){const y=n(g);if(h.has(y))continue;h.add(y);const x=a.get(y),b=l.get(y);if(!x&&!b)continue;if(!x){u.push(b),f.push(g);continue}if(!b){x&&(u.push(x),f.push(g));continue}const w=new Map;for(const N of x.items??[])w.set(N.id,N);for(const N of b.items??[])w.set(N.id,N);const v=ee(Array.from(w.values()));u.push({...b,items:v,cursor:yr(v),hasMore:b.hasMore??x.hasMore??!0}),f.push(g)}const p=(g,y)=>{for(const x of g){const b=n(x);if(h.has(b))continue;const w=y.get(b);w&&(h.add(b),u.push(w),f.push(x))}};return p(c,l),p(i,a),{...o,pages:u.length>0?u:[{items:[],hasMore:!0,cursor:null}],pageParams:f.length>0?f:o.pageParams??r.pageParams}},Wn=(e,t,r)=>{const o=r?.allowAppend??!0,n=xr(t),a=n.clientId??Z(n.body),i=U(e),l=re(i);if(a)for(const c of l){const u=(c.items??[]).findIndex(f=>te(f.id)&&Z(f.body)===a);if(u>=0){c.items.splice(u,1);break}}for(const c of l){const u=(c.items??[]).findIndex(f=>f.id===n.id);if(u>=0)return c.items[u]=n,c.items=Je(c.items),{...i,pages:l}}if(o){const c=l[l.length-1];c.items=ee([...c.items??[],n])}return{...i,pages:l}},vr="id, conversation_id, user_id, body, message_type, text, client_id, meta, attachment_url, created_at",L="chat-media",ie=(e=()=>`${Date.now()}-${Math.random().toString(36).slice(2,10)}`)=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():e(),je=new Map,Ze=()=>Date.now(),et=e=>{if(!e)return null;const t=je.get(e);return t?t.expiresAt<=Ze()?(je.delete(e),null):t.url:null},Sr=(e,t,r)=>{if(!e||!t)return;const n=Math.max(0,r*1e3-6e4);je.set(e,{url:t,expiresAt:Ze()+n})},Ee=3600,X=e=>/^https?:\/\//i.test(e),Pe=(e,t)=>t&&$.storage.from(e).getPublicUrl(t).data.publicUrl||null,tt=async(e,t,r=Ee)=>{if(!t)return null;const{data:o,error:n}=await $.storage.from(e).createSignedUrl(t,r);return n||!o?.signedUrl?null:(Sr(`${e}:${t}`,o.signedUrl,r),o.signedUrl)};async function ce(e,t,r){if(!t)return null;if(X(t))return r?.allowHttp?t:null;const o=r?.ttlSeconds??Ee,n=r?.allowPublicFallback??!1;if(!(r?.forceRefresh??!1)){const i=et(`${e}:${t}`);if(i)return i}try{const i=await tt(e,t,o);if(i)return i}catch{}if(!n)return null;try{return Pe(e,t)}catch{return null}}async function jr(e,t,r=Ee){if(t&&!X(t)&&!et(`${e}:${t}`))try{await tt(e,t,r)}catch{}}const We=async e=>{if(!e||X(e))return;const{error:t}=await $.storage.from(L).remove([e]);if(t)throw t},rt=new Set(["jpg","jpeg","png","webp","gif","avif","heic","heif"]),nt=new Set(["mp3","wav","ogg","m4a","aac","flac","webm"]),st=new Set(["pdf","doc","docx","xls","xlsx","ppt","pptx","csv","txt","rtf"]),ne=e=>e&&(((e.split("?")[0]?.split("#")[0]??"").split("/").pop()??"").split(".").pop()?.toLowerCase()??"")||null,ot=e=>{const t=ne(e);return t&&rt.has(t)?"image":t&&nt.has(t)?"audio":"document"},Nr=e=>{if(!e)return"Attachment";const t=e.split("?")[0]?.split("#")[0]??e;return(t.split("/").pop()??t)||"Attachment"};function ae(e){const t=e/1048576;if(t>=1)return`${Math.round(t)}MB`;const r=e/1024;return r>=1?`${Math.round(r)}KB`:`${e}B`}const Ne={"image/jpg":"jpg","image/jpeg":"jpg","image/pjpeg":"jpg","image/png":"png","image/webp":"webp","image/gif":"gif","image/avif":"avif","image/heic":"heic","image/heif":"heif"},Ce={"audio/mpeg":"mp3","audio/mp3":"mp3","audio/wav":"wav","audio/x-wav":"wav","audio/ogg":"ogg","audio/webm":"webm","audio/mp4":"m4a","audio/aac":"aac","audio/flac":"flac"},ke={"application/pdf":"pdf","text/plain":"txt","text/csv":"csv","application/rtf":"rtf","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","application/vnd.ms-powerpoint":"ppt","application/vnd.openxmlformats-officedocument.presentationml.presentation":"pptx"},Cr=new Set(Object.keys(Ne)),kr=new Set(Object.keys(Ce)),Ar=new Set(Object.keys(ke)),Er=e=>{if(e.type&&Ne[e.type])return Ne[e.type];const t=ne(e.name);return t?t==="jpeg"?"jpg":rt.has(t)?t:null:null},Pr=e=>{if(e.type&&Ce[e.type])return Ce[e.type];const t=ne(e.name);return t&&nt.has(t)?t:null},_r=e=>{if(e.type&&ke[e.type])return ke[e.type];const t=ne(e.name);return t&&st.has(t)?t:null},Mr=(e,t)=>{const r=e.type??"",o=r.startsWith("image/"),n=r.startsWith("audio/");if(o){if(e.type&&!Cr.has(e.type))return{ok:!1,error:"Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image."};const i=Er(e);return i?e.size>t.image?{ok:!1,error:`That image is too large (max ${ae(t.image)}). Try a smaller file.`}:{ok:!0,kind:"image",ext:i}:{ok:!1,error:"Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image."}}if(n||kr.has(r)){const i=Pr(e);return i?e.size>t.audio?{ok:!1,error:`That audio file is too large (max ${ae(t.audio)}). Try a smaller file.`}:{ok:!0,kind:"audio",ext:i}:{ok:!1,error:"Unsupported audio format. Please choose an MP3, WAV, OGG, M4A, AAC, or FLAC."}}const a=ne(e.name);if(Ar.has(r)||a&&st.has(a)){const i=_r(e);return i?e.size>t.document?{ok:!1,error:`That document is too large (max ${ae(t.document)}). Try a smaller file.`}:{ok:!0,kind:"document",ext:i}:{ok:!1,error:"Unsupported document format. Please choose a PDF, Word, Excel, PowerPoint, text, or CSV file."}}return{ok:!1,error:"Unsupported file type. Please choose an image, audio, or document file."}},Rr=(e,t,r)=>{const o=ie(()=>String(Date.now()));return`message_attachments/${e}/${t}/${Date.now()}-${o}.${r}`};function zn(e){const{conversationId:t,userId:r,isBlocked:o,blockedYou:n,attemptSend:a}=e,{getNumber:i}=_t(),l=Math.max(1,Math.floor(i("ux.attachments.max_image_bytes",10*1024*1024))),c=Math.max(1,Math.floor(i("ux.attachments.max_audio_bytes",20*1024*1024))),u=Math.max(1,Math.floor(i("ux.attachments.max_document_bytes",15*1024*1024))),[f,m]=d.useState(null),[h,p]=d.useState(!1),[g,y]=d.useState(null),x=d.useRef(0),b=d.useRef(null),w=d.useRef(null),v=d.useCallback(()=>m(null),[]),N=d.useCallback(E=>{y(k=>(k?.previewUrl&&URL.revokeObjectURL(k.previewUrl),E))},[]),A=d.useCallback(()=>{N(null)},[N]),P=d.useCallback(()=>{x.current+=1,p(!1),A()},[A]),C=d.useCallback(()=>{!t||!r||o||n||b.current?.click()},[n,t,o,r]),T=d.useCallback(()=>{!t||!r||o||n||w.current?.click()},[n,t,o,r]),S=d.useCallback(async E=>{if(!t||!r||o||n)return;m(null);const k=Mr(E,{image:l,audio:c,document:u});if(!k.ok){m(k.error);return}const K=x.current+=1;p(!0);const xe=k.kind==="image"||k.kind==="audio"?URL.createObjectURL(E):null;N({id:ie(),name:E.name,sizeLabel:ae(E.size),kind:k.kind,previewUrl:xe});const B=Rr(t,r,k.ext);let oe=!1;try{const{error:H}=await $.storage.from(L).upload(B,E,{cacheControl:"3600",upsert:!1});if(K!==x.current){try{await We(B)}catch{}return}if(H){console.error("[useAttachmentUpload] image upload error",H),m("Upload failed. Please try another image.");return}if(jr(L,B),K!==x.current){try{await We(B)}catch{}return}a({text:"",attachmentPath:B,attachmentKind:k.kind}),oe=!0}catch(H){console.error("[useAttachmentUpload] sendAttachmentFile failed",H),m("Something went wrong while sending your attachment.")}finally{K===x.current&&(p(!1),oe&&A())}},[a,n,A,t,o,c,u,l,r]),_=d.useCallback(async E=>{const k=E.target.files?.[0];E.target.value="",!(!k||!t||!r)&&(h||o||n||await S(k))},[n,t,o,h,S,r]),R=d.useCallback(async E=>{const k=E.target.files?.[0];E.target.value="",!(!k||!t||!r)&&(h||o||n||await S(k))},[n,t,o,h,S,r]);return{imageInputRef:b,attachmentInputRef:w,openImagePicker:C,openAttachmentPicker:T,handleImageSelected:_,handleAttachmentSelected:R,sendAttachmentFile:S,pendingAttachment:g,clearPendingAttachment:A,isUploadingAttachment:h,uploadError:f,clearUploadError:v,cancelAttachmentUpload:P}}const Tr=e=>{if(!e)return"Unknown error.";if(typeof e=="string")return e;const t=e,r=t.message??(e instanceof Error?e.message:typeof e=="object"?JSON.stringify(e):String(e)),o=t.code?` (${t.code})`:"",n=t.details?` â€” ${t.details}`:"",a=t.hint?` Hint: ${t.hint}`:"";return`${r}${o}${n}${a}`.trim()},Dr=e=>e==="text"?"text":e==="system"?"system":e==="image"?"image":e.startsWith("text+")?"text+image":"image",ze=(e,t,r,o)=>{const n=e.trim();if(!t&&!n)return{payload:null,trimmed:n};const i=r??(t?ot(t):null)??"image";return t&&n?{payload:{type:`text+${i}`,text:n,clientId:o},trimmed:n}:t?{payload:{type:i,text:"",clientId:o},trimmed:n}:{payload:{type:"text",text:n,clientId:o},trimmed:n}},Yn=(e,t)=>{const{user:r}=Ve(),o=r?.id??null,n=Xe();return ve({mutationFn:async({text:a,attachmentPath:i,attachmentKind:l,clientId:c})=>{if(!e)throw new Error("Missing conversation id.");if(!o)throw new Error("You must be signed in to send messages.");if(t?.otherUserId){const g=await Qe($,o,t.otherUserId);if(g.youBlocked)throw new Error("You have blocked this user. Unblock them to send messages.");if(g.blockedYou)throw new Error("You cannot send messages because this user blocked you.")}const u=c??ie(),{payload:f}=ze(a,i??null,l??null,u);if(!f)throw new Error("Cannot send an empty message.");const{data:m,error:h}=await $.from("messages").insert({conversation_id:e,user_id:o,sender_id:o,body:f,message_type:Dr(f.type),text:f.text??null,client_id:f.clientId??null,meta:f,attachment_url:i??null}).select(vr).single();if(h)throw console.error("[useSendMessage] Failed to send message",h),new Error(Tr(h));if(!m)throw new Error("Failed to send message.");if(m.conversation_id!==e||m.user_id!==o)throw new Error("Unexpected message response.");return{id:m.id,conversationId:m.conversation_id,senderId:m.user_id,body:m.body??null,attachmentUrl:m.attachment_url??null,createdAt:m.created_at,meta:m.meta??null}},onMutate:async a=>{if(!e||!o)return{previous:void 0,tempId:null};const{text:i,attachmentPath:l,attachmentKind:c}=a,u=a.clientId??ie();a.clientId=u;const{payload:f,trimmed:m}=ze(i,l??null,c??null,u);if(!f)throw new Error("Cannot send an empty message.");const h=a.tempId,p=typeof h=="string"&&h.length?gr(h):br(),g=be(e),y=n.getQueryData(g),x=y?.pages?.[y.pages.length-1]?.items,b=x&&x.length?x[x.length-1]?.createdAt:null,w=b?new Date(b).getTime():NaN,v=Number.isFinite(w),N=v?w:Date.now(),A=new Date(N+1).toISOString(),P={id:p,conversationId:e,senderId:o,body:f,attachmentUrl:l??null,createdAt:A,meta:f};await n.cancelQueries({queryKey:g});const C=n.getQueryData(g);return n.setQueryData(g,T=>He(T,P)),{previous:C,tempId:p,optimistic:P,usedServerAnchor:v,payload:{text:m,attachmentPath:l??null,attachmentKind:c??null,clientId:u}}},onError:(a,i,l)=>{if(console.error("[useSendMessage] sendMessage error",a),!e)return;const{previous:c,optimistic:u,payload:f,tempId:m}=l??{previous:void 0,tempId:null},h=be(e);n.setQueryData(h,p=>u?He(c??p,u):U(c??p)),m&&f&&t?.onFailed&&t.onFailed(m,f,a)},onSuccess:(a,i,l)=>{if(!e)return;const c=l?.tempId,u=be(e),f=l?.optimistic?.createdAt??null;if(f&&l?.usedServerAnchor){const m=new Date(a.createdAt).getTime(),h=new Date(f).getTime();Number.isFinite(m)&&Number.isFinite(h)&&m<h&&(a={...a,createdAt:f})}n.setQueryData(u,m=>wr(m,{tempId:c,row:a})),Bt(n,o,e,m=>({...m,lastMessagePreview:Rt(a.body)??m.lastMessagePreview,lastMessageAt:a.createdAt??m.lastMessageAt,lastMessageAtLabel:Mt(a.createdAt??null),hasUnread:!1,lastMessageIsFromSelf:!0,lastMessageSeenByOthers:!1}),{moveToTop:!0}),t?.onRecovered&&t.onRecovered(l?.tempId??null)}})};async function at(e){if(!e)return!1;try{if(typeof navigator<"u"&&navigator.clipboard?.writeText)return await navigator.clipboard.writeText(e),!0}catch{}try{if(typeof document>"u")return!1;const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length);const r=document.execCommand("copy");return document.body.removeChild(t),r}catch{return!1}}const Ir=O.memo(function({isSelf:t,isDeleted:r,children:o,className:n="",role:a,tabIndex:i,...l}){const{bubbleColors:c,bubbleShape:u}=hr({isSelf:t,isDeleted:r});return s.jsx("div",{role:a??"button",tabIndex:i??0,className:Ae("inline-flex max-w-[85%] px-5 py-3 text-[15px] leading-relaxed transition-transform duration-150 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",u,c,n),...l,children:s.jsx("div",{className:"flex flex-col gap-1 text-left leading-relaxed",children:o})})}),$r=/((?:https?:\/\/|www\.)[^\s<]+[^<.,:;"')\]\s])/gi,Lr=/([A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,})/gi,Or=/(\+?\d[\d\s().-]{7,}\d)/g,Ur=e=>/^https?:\/\//i.test(e)?e:/^www\./i.test(e)?`https://${e}`:e,lt=e=>e.replace(/\D/g,""),Fr=e=>{const t=e.trim(),r=t.startsWith("+"),o=lt(t);return`${r?"+":""}${o}`};function Br(e,t){const r=t.trim();if(!r)return[{text:e,match:!1}];const o=e.toLowerCase(),n=r.toLowerCase(),a=[];let i=0;for(;i<e.length;){const l=o.indexOf(n,i);if(l<0){a.push({text:e.slice(i),match:!1});break}l>i&&a.push({text:e.slice(i,l),match:!1}),a.push({text:e.slice(l,l+r.length),match:!0}),i=l+r.length}return a.length?a:[{text:e,match:!1}]}function Q(e,t){const r=(t??"").trim();return r?Br(e,r).map((o,n)=>o.match?s.jsx("mark",{className:"rounded bg-primary/20 px-0.5 text-foreground",children:o.text},`${n}-${o.text}`):s.jsx(O.Fragment,{children:o.text},`${n}-${o.text}`)):e}const Hr=({text:e,highlight:t})=>{const r=l=>{l.stopPropagation()},o=[],n=(l,c)=>{const u=new RegExp(l);let f;for(;(f=u.exec(e))!==null;)o.push({start:f.index,end:f.index+f[0].length,kind:c,raw:f[0]})};n($r,"url"),n(Lr,"email"),n(Or,"phone"),o.sort((l,c)=>l.start-c.start||c.end-l.end);const a=[];let i=0;for(const l of o)if(!(l.start<i)&&!(l.kind==="phone"&&lt(l.raw).length<10)){if(l.start>i){const c=e.slice(i,l.start);a.push(Q(c,t))}if(l.kind==="url"){const c=Ur(l.raw);a.push(s.jsx("a",{href:c,target:"_blank",rel:"noreferrer noopener",className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:Q(l.raw,t)},`${l.start}-${l.raw}`))}else if(l.kind==="email")a.push(s.jsx("a",{href:`mailto:${l.raw}`,className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:Q(l.raw,t)},`${l.start}-${l.raw}`));else{const c=Fr(l.raw);a.push(s.jsx("a",{href:`tel:${c}`,className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:Q(l.raw,t)},`${l.start}-${l.raw}`))}i=l.end}return i<e.length&&a.push(Q(e.slice(i),t)),s.jsx(s.Fragment,{children:a})},Wr=({path:e})=>{const[t,r]=d.useState(null),[o,n]=d.useState(!1),[a,i]=d.useState(!1),l=d.useRef(!0),c=d.useRef(null),u=d.useRef(!1),f=d.useRef(null),m=d.useRef(!1),h=d.useMemo(()=>!!e,[e]);return d.useEffect(()=>()=>{l.current=!1},[]),d.useEffect(()=>{let p=!1;return c.current=e||null,u.current=!1,r(null),n(!1),e?X(e)?(r(e),()=>{p=!0}):((async()=>{try{const g=await ce(L,e,{allowPublicFallback:!0,forceRefresh:!1,allowHttp:!0});if(p||c.current!==e||!l.current)return;if(!g){n(!0);return}r(g)}catch{!p&&l.current&&c.current===e&&n(!0)}})(),()=>{p=!0}):(n(!0),()=>{p=!0})},[e]),o?s.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Image unavailable."}):t?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mt-1 overflow-hidden rounded-xl border border-border bg-background/80",role:h?"button":void 0,tabIndex:h?0:void 0,onTouchStart:()=>{f.current=Date.now(),m.current=!1},onTouchEnd:()=>{if(f.current==null)return;const p=Date.now()-f.current;m.current=p>=450,f.current=null},onTouchCancel:()=>{f.current=null,m.current=!1},onClick:p=>{p.stopPropagation(),h&&(m.current||i(!0))},onKeyDown:p=>{h&&(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),p.stopPropagation(),i(!0))},onContextMenu:p=>{p.stopPropagation()},"aria-label":"Open image",children:s.jsx("img",{src:t,alt:"Attachment",className:"max-h-64 w-full cursor-zoom-in object-cover",loading:"lazy",onError:async()=>{if(!(!l.current||c.current!==e)){if(X(e)){n(!0);return}try{const p=Pe(L,e);if(p&&t===p){n(!0);return}if(u.current){n(!0);return}u.current=!0;const g=await ce(L,e,{allowPublicFallback:!0,forceRefresh:!0,allowHttp:!0});if(!g||g===t){n(!0);return}if(!l.current||c.current!==e)return;r(g)}catch{l.current&&c.current===e&&n(!0)}}}})}),s.jsx(zr,{open:a,onOpenChange:i,url:t})]}):s.jsx("div",{className:"mt-1 h-32 w-40 animate-pulse rounded-xl bg-border/40"})},we=(e,t,r)=>Math.max(t,Math.min(r,e));function zr({open:e,onOpenChange:t,url:r}){const[o,n]=d.useState(1),[a,i]=d.useState({x:0,y:0}),[l,c]=d.useState(!1),u=d.useRef(!1),f=d.useRef({x:0,y:0}),m=d.useRef({x:0,y:0}),h=()=>{n(1),i({x:0,y:0})};return d.useEffect(()=>{e||h()},[e]),s.jsx(qe,{open:e,onOpenChange:t,children:s.jsx(Ge,{className:"max-w-none w-[calc(100%-1rem)] h-[calc(100%-1rem)] max-h-none p-0 overflow-hidden bg-black border-border/30","aria-label":"Image viewer",children:s.jsxs("div",{className:"relative h-full w-full",children:[s.jsxs("div",{className:"absolute left-0 top-0 z-10 flex w-full items-center justify-between gap-2 p-3",children:[s.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-black/40 px-3 py-1 text-xs text-white",children:[s.jsx("span",{className:"font-medium",children:"Image"}),s.jsx("span",{className:"opacity-75",children:"Â·"}),s.jsx("span",{className:"opacity-75",children:"Scroll to zoom"})]}),s.jsxs("div",{className:"inline-flex items-center gap-2",children:[s.jsxs("button",{type:"button",className:"inline-flex h-10 items-center gap-2 rounded-full bg-black/40 px-3 text-sm text-white hover:bg-black/55",onClick:()=>{try{window.open(r,"_blank","noopener,noreferrer")}catch{}},"aria-label":"Open image in new tab",children:[s.jsx(Ke,{className:"h-4 w-4","aria-hidden":!0}),s.jsx("span",{className:"hidden sm:inline",children:"Open"})]}),s.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full bg-black/40 p-1 text-white",children:[s.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-white/10",onClick:()=>n(p=>we(Number((p-.25).toFixed(2)),1,4)),"aria-label":"Zoom out",children:s.jsx(or,{className:"h-4 w-4","aria-hidden":!0})}),s.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-white/10",onClick:()=>n(p=>we(Number((p+.25).toFixed(2)),1,4)),"aria-label":"Zoom in",children:s.jsx(Gt,{className:"h-4 w-4","aria-hidden":!0})}),s.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-white/10",onClick:h,"aria-label":"Reset view",children:s.jsx(dr,{className:"h-4 w-4","aria-hidden":!0})})]}),s.jsx("button",{type:"button",className:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-black/40 text-white hover:bg-black/55",onClick:()=>t(!1),"aria-label":"Close",children:s.jsx(Kt,{className:"h-5 w-5","aria-hidden":!0})})]})]}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",onWheel:p=>{if(o<=1)return;p.preventDefault();const g=-p.deltaY,y=we(Number((o+g*.002).toFixed(2)),1,4);n(y)},onDoubleClick:()=>{n(p=>p===1?2:1),i({x:0,y:0})},onPointerDown:p=>{o<=1||(u.current=!0,c(!0),f.current={x:p.clientX,y:p.clientY},m.current=a,p.currentTarget.setPointerCapture?.(p.pointerId))},onPointerMove:p=>{if(!u.current)return;const g=p.clientX-f.current.x,y=p.clientY-f.current.y;i({x:m.current.x+g,y:m.current.y+y})},onPointerUp:()=>{u.current=!1,c(!1)},onPointerCancel:()=>{u.current=!1,c(!1)},children:s.jsx("img",{src:r,alt:"Attachment",className:"max-h-full max-w-full select-none object-contain",draggable:!1,style:{transform:`translate3d(${a.x}px, ${a.y}px, 0) scale(${o})`,transformOrigin:"center",transition:l?"none":"transform 120ms ease-out",cursor:o>1?"grab":"zoom-in"}})})]})})})}const Yr=e=>{const[t,r]=d.useState(null),[o,n]=d.useState(!1),a=d.useRef(!0),i=d.useRef(null),l=d.useRef(!1);return d.useEffect(()=>()=>{a.current=!1},[]),d.useEffect(()=>{let u=!1;return i.current=e||null,l.current=!1,r(null),n(!1),e?X(e)?(r(e),()=>{u=!0}):((async()=>{try{const f=await ce(L,e,{allowPublicFallback:!0,forceRefresh:!1,allowHttp:!0});if(u||i.current!==e||!a.current)return;if(!f){n(!0);return}r(f)}catch{!u&&a.current&&i.current===e&&n(!0)}})(),()=>{u=!0}):(n(!0),()=>{u=!0})},[e]),{url:t,error:o,retryIfNeeded:async()=>{if(!(!a.current||i.current!==e)){if(X(e)){n(!0);return}try{const u=Pe(L,e);if(u&&t===u){n(!0);return}if(l.current){n(!0);return}l.current=!0;const f=await ce(L,e,{allowPublicFallback:!0,forceRefresh:!0,allowHttp:!0});if(!f||f===t){n(!0);return}if(!a.current||i.current!==e)return;r(f)}catch{a.current&&i.current===e&&n(!0)}}}}},Vr=()=>s.jsx("div",{className:"mt-1 h-12 w-48 animate-pulse rounded-xl bg-border/40"}),it=({children:e})=>s.jsx("div",{className:"mt-1",children:e}),Xr=({url:e,name:t,onError:r})=>s.jsx(it,{children:s.jsxs("div",{className:"flex w-full max-w-xs flex-col gap-2 rounded-xl border border-border bg-background/80 px-3 py-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[s.jsx(lr,{className:"h-4 w-4","aria-hidden":"true"}),s.jsx("span",{className:"font-semibold text-foreground",children:t})]}),s.jsx("audio",{controls:!0,src:e,className:"w-full",onError:r,onClick:o=>o.stopPropagation(),onContextMenu:o=>o.stopPropagation(),children:s.jsx("track",{kind:"captions",srcLang:"en",label:"Captions"})})]})}),qr=({url:e,name:t})=>s.jsx(it,{children:s.jsxs("a",{href:e,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-3 rounded-xl border border-border bg-background/80 px-3 py-2 text-xs text-foreground hover:bg-muted/60",onClick:r=>r.stopPropagation(),onContextMenu:r=>r.stopPropagation(),children:[s.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-muted/70",children:s.jsx(nr,{className:"h-4 w-4","aria-hidden":"true"})}),s.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[s.jsx("span",{className:"truncate font-semibold",children:t}),s.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Open document"})]}),s.jsx(Ke,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true"})]})}),Gr=({path:e})=>{const t=d.useMemo(()=>ot(e),[e]),{url:r,error:o,retryIfNeeded:n}=Yr(e),a=d.useMemo(()=>Nr(e),[e]);return t==="image"?s.jsx(Wr,{path:e}):o?s.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Attachment unavailable."}):r?t==="audio"?s.jsx(Xr,{url:r,name:a,onError:n}):s.jsx(qr,{url:r,name:a}):s.jsx(Vr,{})};function z(e){return typeof e=="string"&&e.trim().length>0}function Kr(e){return!e||typeof e!="object"?null:e}function Qr({ui:e,actions:t,onAction:r}){const o=d.useMemo(()=>Kr(e),[e]),n=d.useMemo(()=>{const x=Array.isArray(o?.citations)?o.citations:[],b=[],w=new Set;for(const v of x){const N=typeof v?.url=="string"?v.url.trim():"";if(!(!N||w.has(N))&&(w.add(N),b.push({url:N,title:typeof v?.title=="string"&&v.title.trim()?v.title.trim():void 0,domain:typeof v?.domain=="string"&&v.domain.trim()?v.domain.trim():void 0}),b.length>=8))break}return b},[o]),a=d.useMemo(()=>Array.isArray(t)?t:[],[t]),i=d.useMemo(()=>{const x=new Map;for(const b of a)b&&typeof b=="object"&&z(b.id)&&x.set(String(b.id),b);return x},[a]),[l,c]=d.useState({}),[u,f]=d.useState(!1),m=()=>n.length?s.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/40 p-3",children:[s.jsxs("button",{type:"button",onClick:()=>f(x=>!x),className:"flex w-full items-center justify-between gap-2 text-left",children:[s.jsx("span",{className:"text-xs font-semibold text-muted-foreground",children:"Sources"}),s.jsx("span",{className:"text-xs text-muted-foreground",children:u?"Hide":"Show"})]}),u?s.jsx("ul",{className:"mt-2 space-y-1 text-xs",children:n.map(x=>{const b=x.title?`${x.domain?`${x.domain} â€” `:""}${x.title}`:x.domain??x.url;return s.jsx("li",{className:"min-w-0",children:s.jsx("a",{href:x.url,target:"_blank",rel:"noreferrer",className:"block truncate text-primary underline-offset-2 hover:underline",title:x.url,children:b})},x.url)})}):null]}):null,h=x=>{const b=Array.from(new Set(x.filter(z))).slice(0,6);return b.length===0?null:s.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(w=>{const v=i.get(w);if(!v)return null;const N=(()=>{const C=String(v.type??"").toLowerCase();return C==="dismiss"?"Dismiss":C==="navigate"?"Open":"Do"})(),A=z(v.label)?v.label:N,P=!!l[w];return s.jsx("button",{type:"button",onClick:async()=>{try{c(C=>({...C,[w]:!0})),await r(w)}finally{c(C=>({...C,[w]:!1}))}},disabled:P,className:"rounded-full px-3 py-1 text-xs font-semibold transition "+(P?"bg-muted text-muted-foreground opacity-70":"bg-primary text-primary-foreground hover:bg-primary/90"),children:P?"Workingâ€¦":A},w)})})};if(!o||(o.layout??"stacked")!=="stacked"){const x=a.map(b=>String(b?.id??"")).filter(z);return x.length===0&&!n.length?null:s.jsxs("div",{className:"mt-2 space-y-2",children:[m(),x.length?s.jsx("div",{children:h(x)}):null]})}const p=Array.isArray(o.cards)?o.cards:[],g=new Set;for(const x of p){const b=(Array.isArray(x?.actionIds)?x.actionIds:[]).filter(z);for(const w of b)g.add(String(w))}const y=a.map(x=>String(x?.id??"")).filter(x=>z(x)&&!g.has(x));return!o.heading&&p.length===0&&y.length===0&&!n.length?null:s.jsxs("div",{className:"mt-2 space-y-2",children:[(o.heading||o.subheading)&&s.jsxs("div",{className:"rounded-2xl border border-border/60 bg-muted/20 p-3",children:[o.heading?s.jsx("div",{className:"text-sm font-semibold text-foreground",children:o.heading}):null,o.subheading?s.jsx("div",{className:"mt-0.5 text-xs text-muted-foreground",children:o.subheading}):null]}),p.map(x=>{const b=(Array.isArray(x.actionIds)?x.actionIds:[]).filter(z);return s.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/60 p-3",children:s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{className:"h-16 w-12 shrink-0 overflow-hidden rounded-xl bg-muted",children:x.poster?s.jsx("img",{src:x.poster,alt:x.title??"",className:"h-full w-full object-cover",loading:"lazy"}):null}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("div",{className:"flex items-start justify-between gap-2",children:s.jsxs("div",{className:"min-w-0",children:[s.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:x.title??""}),s.jsx("div",{className:"mt-0.5 truncate text-xs text-muted-foreground",children:[x.kind,x.year?String(x.year):null].filter(Boolean).join(" â€¢ ")})]})}),x.reason?s.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:x.reason}):null,Array.isArray(x.badges)&&x.badges.length?s.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:x.badges.slice(0,6).map(w=>s.jsx("span",{className:"rounded-full bg-muted/70 px-2 py-0.5 text-[11px] font-semibold text-muted-foreground",children:w},w))}):null,b.length?s.jsx("div",{className:"mt-3",children:h(b)}):null]})]})},x.id)}),y.length?s.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/40 p-3",children:[s.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Actions"}),s.jsx("div",{className:"mt-2",children:h(y)})]}):null,m()]})}function Jr({handles:e,className:t}){const r=Array.isArray(e)?e.map(m=>String(m)).filter(Boolean).slice(0,50):[],[o,n]=O.useState(r[0]??null),[a,i]=O.useState(!1),[l,c]=O.useState({}),u=O.useCallback(async m=>{if(m&&!Object.prototype.hasOwnProperty.call(l,m)){i(!0);try{const h=await Tt("assistant-tool-result",{actionId:m});c(p=>({...p,[m]:h}))}catch(h){c(p=>({...p,[m]:null})),J.error(h?.message??"Couldn't load evidence.")}finally{i(!1)}}},[l]);if(O.useEffect(()=>{o&&u(o)},[o,u]),r.length===0)return null;const f=o?l[o]:null;return s.jsx("div",{className:t,children:s.jsxs(qe,{children:[s.jsx(Yt,{asChild:!0,children:s.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-3 py-1 text-xs font-medium text-muted-foreground hover:bg-muted",children:["Evidence",s.jsx(Dt,{variant:"outline",className:"px-2 py-0 text-[11px]",children:r.length})]})}),s.jsxs(Ge,{className:"max-w-2xl",children:[s.jsxs(Vt,{children:[s.jsx(Xt,{children:"Evidence"}),s.jsx(qt,{children:"Tool results the assistant used while generating this reply."})]}),s.jsxs("div",{className:"mt-2 flex flex-col gap-3",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(m=>s.jsx("button",{type:"button",onClick:()=>{n(m),u(m)},className:`rounded-full border px-3 py-1 text-xs transition ${m===o?"border-primary/50 bg-primary/15 text-primary":"border-border bg-background text-muted-foreground hover:bg-muted"}`,title:m,children:m},m))}),s.jsx("div",{className:"rounded-2xl border border-border bg-background p-4",children:a&&!f?s.jsx("div",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):f?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s.jsx("div",{className:"text-sm font-medium text-foreground",children:f.actionType}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(f.createdAt).toLocaleString()}),s.jsx(It,{variant:"ghost",size:"sm",onClick:async()=>{await at(JSON.stringify(f.payload,null,2))?J.show("Evidence copied."):J.error("Couldn't copy evidence.")},children:"Copy JSON"})]})]}),s.jsx("pre",{className:"mt-3 max-h-[55vh] overflow-auto whitespace-pre-wrap break-words rounded-xl bg-muted/30 p-3 text-xs text-foreground",children:JSON.stringify(f.payload,null,2)})]}):s.jsx("div",{className:"text-sm text-muted-foreground",children:"No details available."})})]})]})]})})}const Zr=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ”¥","ðŸ˜"],Vn=O.memo(function({message:t,meta:r,sender:o,isSelf:n,deliveryStatus:a,showDeliveryStatus:i,reactions:l,index:c,previousMessage:u,nextMessage:f,firstUnreadIndex:m,activeActionMessageId:h,longPressTriggeredRef:p,onOpenMessageActions:g,onCloseMessageActions:y,onOpenEditDialog:x,onOpenDeleteDialog:b,onToggleReaction:w,onRetryMessage:v,onDiscardFailedMessage:N,onAssistantAction:A,onBubbleTouchStart:P,onBubbleTouchEndOrCancel:C,searchQuery:T,isSearchMatch:S,isActiveSearchMatch:_}){const R=u!=null&&u.senderId===t.senderId,E=f!=null&&f.senderId===t.senderId,k=R&&Fe(u.createdAt,t.createdAt),K=E&&Fe(t.createdAt,f.createdAt),xe=!(R&&k),B=!(E&&K),oe=m!=null&&c===m,H=c===0||u!=null&&!Se(new Date(u.createdAt),new Date(t.createdAt)),jt=c===0||H?"mt-0":xe?"mt-3":"mt-1.5",D=r.deleted===!0,De=r.editedAt,Ie=r.deletedAt,Nt=r.streaming===!0,$e=o?.displayName??(n?"You":"Someone"),W=$t(t.body),Le=Nt&&!D,Oe=(T??"").trim(),Ct=!!(Oe&&S&&!D),kt=(()=>{const j=n?"You":$e;return D?`${j} deleted a message`:W?`${j} said: ${W}`:t.attachmentUrl?`${j} sent an attachment`:`${j} sent a message`})(),At=!n&&B,ge=()=>{if(p.current){p.current=!1;return}h===t.id?y():g(t)};return s.jsxs("div",{className:"px-0",children:[H&&s.jsx("div",{className:"my-4 flex items-center justify-center",children:s.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-muted-foreground",children:[s.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),s.jsx("span",{className:"rounded-full bg-muted px-3 py-0.5 text-xs font-medium text-muted-foreground",children:pr(t.createdAt)}),s.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),oe&&s.jsx("div",{className:"my-4 flex items-center justify-center",role:"separator","aria-label":"New messages",children:s.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-primary",children:[s.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),s.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-0.5 text-xs font-semibold text-primary",children:"New messages"}),s.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),s.jsxs("div",{className:`flex w-full flex-col gap-0.5 ${jt}`,children:[s.jsxs("div",{className:`flex w-full items-end gap-2 ${n?"justify-end":"justify-start"}`,children:[!n&&s.jsx(s.Fragment,{children:At?s.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0 overflow-hidden rounded-full bg-muted",children:o?.avatarUrl?s.jsx("img",{src:o.avatarUrl,alt:o.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):s.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs font-medium text-muted-foreground",children:$e.slice(0,2).toUpperCase()})}):s.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0"})}),s.jsxs(Ir,{isSelf:n,isDeleted:D,"data-message-action-scope":t.id,className:D?"":_?"ring-2 ring-primary/60":S?"ring-2 ring-primary/25":"",onClick:ge,onContextMenu:j=>{j.preventDefault(),ge()},onKeyDown:j=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),ge())},onTouchStart:()=>P(t),onTouchEnd:C,onTouchCancel:C,"aria-label":kt,children:[(W||Le)&&s.jsxs("p",{className:"whitespace-pre-wrap break-words [overflow-wrap:anywhere] text-sm leading-snug",children:[W?s.jsx(Hr,{text:W,highlight:Ct?Oe:void 0}):null,Le?s.jsx("span",{className:"ml-1 inline-block h-3 w-1 animate-pulse rounded-sm bg-current align-baseline","aria-hidden":"true"}):null]}),!D&&t.attachmentUrl&&s.jsx(Gr,{path:t.attachmentUrl})]})]}),l.length>0&&s.jsx("div",{className:`mt-0.5 flex w-full ${n?"justify-end pr-6":"justify-start pl-6"}`,children:s.jsx("div",{className:"inline-flex flex-wrap items-center gap-1 rounded-full bg-muted px-1.5 py-0.5 text-xs text-foreground",children:l.map(j=>s.jsxs("button",{type:"button",onClick:()=>w(t.id,j.emoji),className:`inline-flex items-center gap-1 rounded-full px-1.5 py-0.5 transition hover:bg-background ${j.reactedBySelf?"bg-primary/10":""}`,children:[s.jsx("span",{className:"text-[17px]",children:j.emoji}),j.count>1&&s.jsx("span",{className:"text-xs text-muted-foreground",children:j.count})]},j.emoji))})}),h===t.id&&!D&&s.jsx("div",{className:`mt-1 flex w-full ${n?"justify-end pr-6":"justify-start pl-6"}`,children:s.jsxs("div",{className:"inline-flex flex-col items-stretch gap-1 rounded-2xl bg-muted px-2.5 py-1.5 text-xs text-foreground select-none","data-message-action-scope":t.id,children:[s.jsx("div",{className:"flex items-center justify-center gap-1",children:Zr.map(j=>s.jsx("button",{type:"button",onClick:()=>{w(t.id,j),y()},className:"flex h-7 w-7 items-center justify-center rounded-full transition hover:bg-background",children:s.jsx("span",{className:"text-[17px]",children:j})},j))}),s.jsxs("div",{className:`mt-1 flex flex-wrap items-center gap-2 ${n?"justify-end":"justify-start"}`,children:[W?s.jsxs("button",{type:"button",onClick:async()=>{await at(W)?J.show("Copied to clipboard."):J.error("Couldn't copy to clipboard."),y()},className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-muted-foreground hover:bg-background",children:[s.jsx(Qt,{className:"h-3.5 w-3.5","aria-hidden":!0}),s.jsx("span",{children:"Copy"})]}):null,n?(()=>{if(t.attachmentUrl||D)return null;const j=Lt(t.body);return j!=="text"&&j!=="unknown"?null:s.jsxs("button",{type:"button",onClick:Et=>x(t,Et.currentTarget),className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-muted-foreground hover:bg-background",children:[s.jsx(cr,{className:"h-3.5 w-3.5","aria-hidden":!0}),s.jsx("span",{children:"Edit"})]})})():null,n?s.jsxs("button",{type:"button",onClick:()=>b(t),className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-destructive hover:bg-destructive/10",children:[s.jsx(mr,{className:"h-3.5 w-3.5","aria-hidden":!0}),s.jsx("span",{children:"Delete"})]}):null]})]})}),!n&&(t?.meta?.ai?.ui||t?.meta?.ai?.actions)?s.jsx("div",{className:"pl-7 pr-1",children:s.jsx(Qr,{ui:t.meta.ai.ui,actions:t.meta.ai.actions,onAction:async j=>{A&&await A(t.id,j)}})}):null,!n&&Array.isArray(t?.meta?.ai?.toolHandles)&&t.meta.ai.toolHandles.length>0?s.jsx("div",{className:"pl-7 pr-1",children:s.jsx(Jr,{handles:t.meta.ai.toolHandles})}):null,i&&a&&s.jsx("div",{className:`flex items-center gap-1 text-xs text-muted-foreground ${n?"justify-end pr-1":"justify-start pl-7"}`,children:a.status==="failed"?s.jsxs(s.Fragment,{children:[s.jsx(Jt,{className:"h-3 w-3 text-destructive","aria-hidden":!0}),s.jsx("span",{children:"Failed to send."}),s.jsx("button",{type:"button",className:"text-destructive underline",onClick:()=>v(t),children:"Retry"}),s.jsx("span",{"aria-hidden":"true",children:"Â·"}),s.jsx("button",{type:"button",className:"text-destructive underline",onClick:()=>N(t),children:"Discard"})]}):a.status==="sending"?s.jsxs(s.Fragment,{children:[s.jsx(Ot,{className:"h-3 w-3 animate-spin","aria-hidden":!0}),s.jsx("span",{children:"Sendingâ€¦"})]}):a.status==="sent"?s.jsxs(s.Fragment,{children:[s.jsx(Ht,{className:"h-3 w-3","aria-hidden":!0}),s.jsx("span",{children:"Sent"})]}):a.status==="delivered"?s.jsxs(s.Fragment,{children:[s.jsx(Ue,{className:"h-3 w-3","aria-hidden":!0}),s.jsx("span",{children:"Delivered"})]}):s.jsxs(s.Fragment,{children:[s.jsx(Ue,{className:"h-3 w-3","aria-hidden":!0}),s.jsx("span",{children:a.seenAt?`Seen ${ye(a.seenAt)}`:"Seen"})]})}),D&&Ie&&s.jsxs("p",{className:`text-xs text-muted-foreground ${n?"text-right pr-1":"text-left pl-7"}`,children:["Deleted ",ye(Ie)]}),!D&&De&&s.jsxs("p",{className:`text-xs text-muted-foreground ${n?"text-right pr-1":"text-left pl-7"}`,children:["Edited ",ye(De)]})]})]},t.id)});function en(e){const t=tn(e),r=d.forwardRef((o,n)=>{const{children:a,...i}=o,l=d.Children.toArray(a),c=l.find(nn);if(c){const u=c.props.children,f=l.map(m=>m===c?d.Children.count(u)>1?d.Children.only(null):d.isValidElement(u)?u.props.children:null:m);return s.jsx(t,{...i,ref:n,children:d.isValidElement(u)?d.cloneElement(u,void 0,f):null})}return s.jsx(t,{...i,ref:n,children:a})});return r.displayName=`${e}.Slot`,r}function tn(e){const t=d.forwardRef((r,o)=>{const{children:n,...a}=r;if(d.isValidElement(n)){const i=on(n),l=sn(a,n.props);return n.type!==d.Fragment&&(l.ref=o?Ut(o,i):i),d.cloneElement(n,l)}return d.Children.count(n)>1?d.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var rn=Symbol("radix.slottable");function nn(e){return d.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===rn}function sn(e,t){const r={...t};for(const o in t){const n=e[o],a=t[o];/^on[A-Z]/.test(o)?n&&a?r[o]=(...l)=>{const c=a(...l);return n(...l),c}:n&&(r[o]=n):o==="style"?r[o]={...n,...a}:o==="className"&&(r[o]=[n,a].filter(Boolean).join(" "))}return{...e,...r}}function on(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var an=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],se=an.reduce((e,t)=>{const r=en(`Primitive.${t}`),o=d.forwardRef((n,a)=>{const{asChild:i,...l}=n,c=i?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),s.jsx(c,{...l,ref:a})});return o.displayName=`Primitive.${t}`,{...e,[t]:o}},{});function ln(e,t=[]){let r=[];function o(a,i){const l=d.createContext(i),c=r.length;r=[...r,i];const u=m=>{const{scope:h,children:p,...g}=m,y=h?.[e]?.[c]||l,x=d.useMemo(()=>g,Object.values(g));return s.jsx(y.Provider,{value:x,children:p})};u.displayName=a+"Provider";function f(m,h){const p=h?.[e]?.[c]||l,g=d.useContext(p);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${m}\` must be used within \`${a}\``)}return[u,f]}const n=()=>{const a=r.map(i=>d.createContext(i));return function(l){const c=l?.[e]||a;return d.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return n.scopeName=e,[o,cn(n,...t)]}function cn(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(a){const i=o.reduce((l,{useScope:c,scopeName:u})=>{const m=c(a)[`__scope${u}`];return{...l,...m}},{});return d.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return r.scopeName=t.scopeName,r}function un(e,[t,r]){return Math.min(r,Math.max(t,e))}function dn(e,t){return d.useReducer((r,o)=>t[r][o]??r,e)}var _e="ScrollArea",[ct]=ln(_e),[fn,M]=ct(_e),ut=d.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:o="hover",dir:n,scrollHideDelay:a=600,...i}=e,[l,c]=d.useState(null),[u,f]=d.useState(null),[m,h]=d.useState(null),[p,g]=d.useState(null),[y,x]=d.useState(null),[b,w]=d.useState(0),[v,N]=d.useState(0),[A,P]=d.useState(!1),[C,T]=d.useState(!1),S=G(t,R=>c(R)),_=Zt(n);return s.jsx(fn,{scope:r,type:o,dir:_,scrollHideDelay:a,scrollArea:l,viewport:u,onViewportChange:f,content:m,onContentChange:h,scrollbarX:p,onScrollbarXChange:g,scrollbarXEnabled:A,onScrollbarXEnabledChange:P,scrollbarY:y,onScrollbarYChange:x,scrollbarYEnabled:C,onScrollbarYEnabledChange:T,onCornerWidthChange:w,onCornerHeightChange:N,children:s.jsx(se.div,{dir:_,...i,ref:S,style:{position:"relative","--radix-scroll-area-corner-width":b+"px","--radix-scroll-area-corner-height":v+"px",...e.style}})})});ut.displayName=_e;var dt="ScrollAreaViewport",ft=d.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:o,nonce:n,...a}=e,i=M(dt,r),l=d.useRef(null),c=G(t,l,i.onViewportChange);return s.jsxs(s.Fragment,{children:[s.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),s.jsx(se.div,{"data-radix-scroll-area-viewport":"",...a,ref:c,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...e.style},children:s.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:o})})]})});ft.displayName=dt;var I="ScrollAreaScrollbar",Me=d.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=M(I,e.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:i}=n,l=e.orientation==="horizontal";return d.useEffect(()=>(l?a(!0):i(!0),()=>{l?a(!1):i(!1)}),[l,a,i]),n.type==="hover"?s.jsx(mn,{...o,ref:t,forceMount:r}):n.type==="scroll"?s.jsx(hn,{...o,ref:t,forceMount:r}):n.type==="auto"?s.jsx(mt,{...o,ref:t,forceMount:r}):n.type==="always"?s.jsx(Re,{...o,ref:t}):null});Me.displayName=I;var mn=d.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=M(I,e.__scopeScrollArea),[a,i]=d.useState(!1);return d.useEffect(()=>{const l=n.scrollArea;let c=0;if(l){const u=()=>{window.clearTimeout(c),i(!0)},f=()=>{c=window.setTimeout(()=>i(!1),n.scrollHideDelay)};return l.addEventListener("pointerenter",u),l.addEventListener("pointerleave",f),()=>{window.clearTimeout(c),l.removeEventListener("pointerenter",u),l.removeEventListener("pointerleave",f)}}},[n.scrollArea,n.scrollHideDelay]),s.jsx(fe,{present:r||a,children:s.jsx(mt,{"data-state":a?"visible":"hidden",...o,ref:t})})}),hn=d.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=M(I,e.__scopeScrollArea),a=e.orientation==="horizontal",i=pe(()=>c("SCROLL_END"),100),[l,c]=dn("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return d.useEffect(()=>{if(l==="idle"){const u=window.setTimeout(()=>c("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(u)}},[l,n.scrollHideDelay,c]),d.useEffect(()=>{const u=n.viewport,f=a?"scrollLeft":"scrollTop";if(u){let m=u[f];const h=()=>{const p=u[f];m!==p&&(c("SCROLL"),i()),m=p};return u.addEventListener("scroll",h),()=>u.removeEventListener("scroll",h)}},[n.viewport,a,c,i]),s.jsx(fe,{present:r||l!=="hidden",children:s.jsx(Re,{"data-state":l==="hidden"?"hidden":"visible",...o,ref:t,onPointerEnter:V(e.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:V(e.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),mt=d.forwardRef((e,t)=>{const r=M(I,e.__scopeScrollArea),{forceMount:o,...n}=e,[a,i]=d.useState(!1),l=e.orientation==="horizontal",c=pe(()=>{if(r.viewport){const u=r.viewport.offsetWidth<r.viewport.scrollWidth,f=r.viewport.offsetHeight<r.viewport.scrollHeight;i(l?u:f)}},10);return q(r.viewport,c),q(r.content,c),s.jsx(fe,{present:o||a,children:s.jsx(Re,{"data-state":a?"visible":"hidden",...n,ref:t})})}),Re=d.forwardRef((e,t)=>{const{orientation:r="vertical",...o}=e,n=M(I,e.__scopeScrollArea),a=d.useRef(null),i=d.useRef(0),[l,c]=d.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=bt(l.viewport,l.content),f={...o,sizes:l,onSizesChange:c,hasThumb:u>0&&u<1,onThumbChange:h=>a.current=h,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:h=>i.current=h};function m(h,p){return wn(h,i.current,l,p)}return r==="horizontal"?s.jsx(pn,{...f,ref:t,onThumbPositionChange:()=>{if(n.viewport&&a.current){const h=n.viewport.scrollLeft,p=Ye(h,l,n.dir);a.current.style.transform=`translate3d(${p}px, 0, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollLeft=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollLeft=m(h,n.dir))}}):r==="vertical"?s.jsx(xn,{...f,ref:t,onThumbPositionChange:()=>{if(n.viewport&&a.current){const h=n.viewport.scrollTop,p=Ye(h,l);a.current.style.transform=`translate3d(0, ${p}px, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollTop=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollTop=m(h))}}):null}),pn=d.forwardRef((e,t)=>{const{sizes:r,onSizesChange:o,...n}=e,a=M(I,e.__scopeScrollArea),[i,l]=d.useState(),c=d.useRef(null),u=G(t,c,a.onScrollbarXChange);return d.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),s.jsx(pt,{"data-orientation":"horizontal",...n,ref:u,sizes:r,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":he(r)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.x),onDragScroll:f=>e.onDragScroll(f.x),onWheelScroll:(f,m)=>{if(a.viewport){const h=a.viewport.scrollLeft+f.deltaX;e.onWheelScroll(h),wt(h,m)&&f.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&o({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:de(i.paddingLeft),paddingEnd:de(i.paddingRight)}})}})}),xn=d.forwardRef((e,t)=>{const{sizes:r,onSizesChange:o,...n}=e,a=M(I,e.__scopeScrollArea),[i,l]=d.useState(),c=d.useRef(null),u=G(t,c,a.onScrollbarYChange);return d.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),s.jsx(pt,{"data-orientation":"vertical",...n,ref:u,sizes:r,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":he(r)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.y),onDragScroll:f=>e.onDragScroll(f.y),onWheelScroll:(f,m)=>{if(a.viewport){const h=a.viewport.scrollTop+f.deltaY;e.onWheelScroll(h),wt(h,m)&&f.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&o({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:de(i.paddingTop),paddingEnd:de(i.paddingBottom)}})}})}),[gn,ht]=ct(I),pt=d.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:o,hasThumb:n,onThumbChange:a,onThumbPointerUp:i,onThumbPointerDown:l,onThumbPositionChange:c,onDragScroll:u,onWheelScroll:f,onResize:m,...h}=e,p=M(I,r),[g,y]=d.useState(null),x=G(t,S=>y(S)),b=d.useRef(null),w=d.useRef(""),v=p.viewport,N=o.content-o.viewport,A=Y(f),P=Y(c),C=pe(m,10);function T(S){if(b.current){const _=S.clientX-b.current.left,R=S.clientY-b.current.top;u({x:_,y:R})}}return d.useEffect(()=>{const S=_=>{const R=_.target;g?.contains(R)&&A(_,N)};return document.addEventListener("wheel",S,{passive:!1}),()=>document.removeEventListener("wheel",S,{passive:!1})},[v,g,N,A]),d.useEffect(P,[o,P]),q(g,C),q(p.content,C),s.jsx(gn,{scope:r,scrollbar:g,hasThumb:n,onThumbChange:Y(a),onThumbPointerUp:Y(i),onThumbPositionChange:P,onThumbPointerDown:Y(l),children:s.jsx(se.div,{...h,ref:x,style:{position:"absolute",...h.style},onPointerDown:V(e.onPointerDown,S=>{S.button===0&&(S.target.setPointerCapture(S.pointerId),b.current=g.getBoundingClientRect(),w.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",p.viewport&&(p.viewport.style.scrollBehavior="auto"),T(S))}),onPointerMove:V(e.onPointerMove,T),onPointerUp:V(e.onPointerUp,S=>{const _=S.target;_.hasPointerCapture(S.pointerId)&&_.releasePointerCapture(S.pointerId),document.body.style.webkitUserSelect=w.current,p.viewport&&(p.viewport.style.scrollBehavior=""),b.current=null})})})}),ue="ScrollAreaThumb",xt=d.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=ht(ue,e.__scopeScrollArea);return s.jsx(fe,{present:r||n.hasThumb,children:s.jsx(bn,{ref:t,...o})})}),bn=d.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:o,...n}=e,a=M(ue,r),i=ht(ue,r),{onThumbPositionChange:l}=i,c=G(t,m=>i.onThumbChange(m)),u=d.useRef(void 0),f=pe(()=>{u.current&&(u.current(),u.current=void 0)},100);return d.useEffect(()=>{const m=a.viewport;if(m){const h=()=>{if(f(),!u.current){const p=vn(m,l);u.current=p,l()}};return l(),m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[a.viewport,f,l]),s.jsx(se.div,{"data-state":i.hasThumb?"visible":"hidden",...n,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...o},onPointerDownCapture:V(e.onPointerDownCapture,m=>{const p=m.target.getBoundingClientRect(),g=m.clientX-p.left,y=m.clientY-p.top;i.onThumbPointerDown({x:g,y})}),onPointerUp:V(e.onPointerUp,i.onThumbPointerUp)})});xt.displayName=ue;var Te="ScrollAreaCorner",gt=d.forwardRef((e,t)=>{const r=M(Te,e.__scopeScrollArea),o=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&o?s.jsx(yn,{...e,ref:t}):null});gt.displayName=Te;var yn=d.forwardRef((e,t)=>{const{__scopeScrollArea:r,...o}=e,n=M(Te,r),[a,i]=d.useState(0),[l,c]=d.useState(0),u=!!(a&&l);return q(n.scrollbarX,()=>{const f=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(f),c(f)}),q(n.scrollbarY,()=>{const f=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(f),i(f)}),u?s.jsx(se.div,{...o,ref:t,style:{width:a,height:l,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function de(e){return e?parseInt(e,10):0}function bt(e,t){const r=e/t;return isNaN(r)?0:r}function he(e){const t=bt(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=(e.scrollbar.size-r)*t;return Math.max(o,18)}function wn(e,t,r,o="ltr"){const n=he(r),a=n/2,i=t||a,l=n-i,c=r.scrollbar.paddingStart+i,u=r.scrollbar.size-r.scrollbar.paddingEnd-l,f=r.content-r.viewport,m=o==="ltr"?[0,f]:[f*-1,0];return yt([c,u],m)(e)}function Ye(e,t,r="ltr"){const o=he(t),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=t.scrollbar.size-n,i=t.content-t.viewport,l=a-o,c=r==="ltr"?[0,i]:[i*-1,0],u=un(e,c);return yt([0,i],[0,l])(u)}function yt(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const o=(t[1]-t[0])/(e[1]-e[0]);return t[0]+o*(r-e[0])}}function wt(e,t){return e>0&&e<t}var vn=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},o=0;return(function n(){const a={left:e.scrollLeft,top:e.scrollTop},i=r.left!==a.left,l=r.top!==a.top;(i||l)&&t(),r=a,o=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(o)};function pe(e,t){const r=Y(e),o=d.useRef(0);return d.useEffect(()=>()=>window.clearTimeout(o.current),[]),d.useCallback(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(r,t)},[r,t])}function q(e,t){const r=Y(t);Ft(()=>{let o=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(o),o=window.requestAnimationFrame(r)});return n.observe(e),()=>{window.cancelAnimationFrame(o),n.unobserve(e)}}},[e,r])}var vt=ut,Sn=ft,jn=gt;const Nn=d.forwardRef(({className:e,children:t,...r},o)=>s.jsxs(vt,{ref:o,className:Ae("relative overflow-hidden",e),...r,children:[s.jsx(Sn,{className:"h-full w-full rounded-[inherit]",children:t}),s.jsx(St,{}),s.jsx(jn,{})]}));Nn.displayName=vt.displayName;const St=d.forwardRef(({className:e,orientation:t="vertical",...r},o)=>s.jsx(Me,{ref:o,orientation:t,className:Ae("flex touch-none select-none transition-colors data-[orientation=vertical]:h-full data-[orientation=vertical]:w-2 data-[orientation=horizontal]:h-2 data-[orientation=horizontal]:w-full",e),...r,children:s.jsx(xt,{className:"relative flex-1 rounded-full bg-border"})}));St.displayName=Me.displayName;export{L as C,nr as F,vr as M,Nn as S,mr as T,Wn as a,Hn as b,Ln as c,In as d,$n as e,On as f,We as g,X as h,te as i,Bn as j,Ir as k,at as l,xr as m,Un as n,Dn as o,zn as p,br as q,Fn as r,Je as s,ie as t,Yn as u,Vn as v};
