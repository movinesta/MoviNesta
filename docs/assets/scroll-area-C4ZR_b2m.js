import{C as X,b as Xe,e as qe,c as _t,x as Se,s as $,aF as Z,at as ue,ak as Mt,r as f,aq as we,O as Rt,aA as Tt,R as U,j as s,i as Ee,F as Dt,ao as J,ah as It,B as $t,ax as Lt,aG as Ot,E as Ut,P as Ft,Q as G,$ as he,V as Y,X as z,aH as Bt}from"./index-n01z0Q-I.js";import{u as Ht,C as Wt}from"./conversationsCache-D_XJbltN.js";import{b as zt,a as Yt}from"./format-BXv9LLlt.js";import{D as Ge,a as Ke,g as Vt,b as Xt,c as qt,d as Gt}from"./dialog-xEYVlW9E.js";import{E as Qe}from"./external-link-CU7gT4Sf.js";import{P as Kt}from"./plus-BLvVO9lE.js";import{X as Qt}from"./x-CfKoriA-.js";import{C as Jt}from"./copy-gGjX7HRl.js";import{C as Zt}from"./circle-alert-CmdS_X1p.js";import{u as er}from"./index-DNnSGIb8.js";const tr=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Fe=X("check-check",tr);const rr=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],nr=X("file-text",rr);const sr=[["path",{d:"M5 12h14",key:"1ays0h"}]],or=X("minus",sr);const ar=[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]],ir=X("music-2",ar);const lr=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],cr=X("pen-line",lr);const ur=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],dr=X("rotate-ccw",ur);const fr=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],mr=X("trash-2",fr);async function Je(e,t,r){const{data:o,error:n}=await e.from("blocked_users").select("blocker_id, blocked_id").or(`and(blocker_id.eq.${t},blocked_id.eq.${r}),and(blocker_id.eq.${r},blocked_id.eq.${t})`);if(n)throw n;const a=o??[],l=a.some(c=>c.blocker_id===t&&c.blocked_id===r),i=a.some(c=>c.blocker_id===r&&c.blocked_id===t);return{youBlocked:l,blockedYou:i}}const In=e=>{const{user:t}=Xe(),r=t?.id??null,o=qe(),n=["block-status",r,e],a=_t({queryKey:n,enabled:!!(r&&e&&r!==e),staleTime:3e4,queryFn:async()=>{if(!r||!e||r===e)return{youBlocked:!1,blockedYou:!1};try{return await Je($,r,e)}catch(p){console.error("[useBlockStatus] Failed to load block status",p);const h=p;throw new Error(h.message??"Failed to load block status")}}}),l=Se({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for block operation.");const{error:p}=await $.from("blocked_users").upsert({blocker_id:r,blocked_id:e,created_at:new Date().toISOString()},{onConflict:"blocker_id,blocked_id"});if(p)throw console.error("[useBlockStatus] Failed to block user",p),new Error(p.message)},onSuccess:()=>{o.invalidateQueries({queryKey:n})}}),i=Se({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for unblock operation.");const{error:p}=await $.from("blocked_users").delete().eq("blocker_id",r).eq("blocked_id",e);if(p)throw console.error("[useBlockStatus] Failed to unblock user",p),new Error(p.message)},onSuccess:()=>{o.invalidateQueries({queryKey:n})}}),c=a.data?.youBlocked??!1,u=a.data?.blockedYou??!1,d=c||u,m=l.isPending||i.isPending;return{youBlocked:c,blockedYou:u,isBlocked:d,isLoading:a.isLoading||m,isError:a.isError,error:a.error??null,block:l,unblock:i}},pr=({isSelf:e,isDeleted:t,startsGroup:r=!0,endsGroup:o=!0})=>{const a=t?"bg-muted text-muted-foreground border border-dashed border-border":e?"bg-primary text-primary-foreground shadow-sm":"bg-card/85 text-foreground border border-border/70 shadow-sm dark:bg-muted/35 dark:border-border/60",l="rounded-2xl";return e?{bubbleColors:a,bubbleShape:`${l} ${o?"rounded-br-sm":"rounded-br-2xl"} ${r?"rounded-tr-2xl":"rounded-tr-lg"}`}:{bubbleColors:a,bubbleShape:`${l} ${o?"rounded-bl-sm":"rounded-bl-2xl"} ${r?"rounded-tl-2xl":"rounded-tl-lg"}`}},le=e=>{const t=new Date(e);return Number.isNaN(t.getTime())?"":zt(t,{hour:"numeric",minute:"2-digit",hour12:!0})},je=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),hr=e=>{const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const r=new Date,o=new Date;return o.setDate(r.getDate()-1),je(t,r)?"Today":je(t,o)?"Yesterday":Yt(t,{day:"numeric",month:"short",year:"numeric"})},Be=(e,t,r=180*1e3)=>{const o=new Date(e),n=new Date(t);return Number.isNaN(o.getTime())||Number.isNaN(n.getTime())?!1:n.getTime()-o.getTime()<=r},gr=e=>({id:e.id,conversationId:e.conversation_id,senderId:e.user_id,body:e.body??null,attachmentUrl:e.attachment_url??null,createdAt:e.created_at??new Date().toISOString(),text:e.text??null,clientId:e.client_id??null,meta:e.meta??null}),$n=e=>({userId:e.user_id,lastReadAt:e.last_read_at??null,lastReadMessageId:e.last_read_message_id??null}),Ln=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,deliveredAt:e.delivered_at??e.created_at??new Date().toISOString()}),On=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,emoji:e.emoji,createdAt:e.created_at}),ge="temp-",te=e=>e.startsWith(ge),xr=e=>te(e)?e:`${ge}${e}`,Un=(e=Date.now())=>`${ge}${e}`,br=(e=Date.now())=>`${ge}${e}-${Math.random().toString(36).slice(2,8)}`,Fn=(e,t={})=>{const{dedupe:r=!0,excludeTemp:o=!1,sort:n=!1}=t,a=e.filter(i=>typeof i=="string").map(i=>i.trim()).filter(Boolean).filter(i=>o?!te(i):!0),l=r?Array.from(new Set(a)):a;return n&&l.sort(),l},He=()=>({pages:[{items:[],hasMore:!0,cursor:null}],pageParams:[null]}),Ze=e=>[...e].sort((t,r)=>{const o=ue(t.createdAt),n=ue(r.createdAt);return o!==n?o-n:t.id.localeCompare(r.id)}),ee=e=>{const t=new Map;for(const a of e)t.set(a.id,a);const r=new Map,o=[];for(const a of t.values()){const l=a.clientId??Z(a.body);if(!l){o.push(a);continue}const i=r.get(l);i?i.push(a):r.set(l,[a])}const n=[...o];for(const a of r.values()){if(a.length<=1){n.push(...a);continue}const l=a.filter(c=>!te(c.id));if(l.length>0){n.push(...l);continue}const i=a.reduce((c,u)=>{if(!c)return u;const d=ue(c.createdAt),m=ue(u.createdAt);return m!==d?m>d?u:c:u.id.localeCompare(c.id)>0?u:c},null);i&&n.push(i)}return Ze(n)},F=e=>!e||!Array.isArray(e.pages)||!Array.isArray(e.pageParams)?He():e,yr=e=>e.length?{createdAt:e[0].createdAt,id:e[0].id}:null,re=e=>{const t=(e.pages??[]).map(r=>({...r,items:Array.isArray(r.items)?[...r.items]:[]}));return t.length>0?t:[{items:[],hasMore:!0,cursor:null}]},We=(e,t)=>{const r=F(e),o=re(r),n=o[o.length-1],a=new Map;for(const l of n.items??[])a.set(l.id,l);return a.set(t.id,t),n.items=ee(Array.from(a.values())),{...r,pages:o}},Bn=(e,t)=>{const r=F(e),o=re(r).map(n=>({...n,items:(n.items??[]).map(a=>a.id===t.id?t:a)}));return{...r,pages:o}},Hn=(e,t)=>{const r=F(e),o=re(r).map(n=>({...n,items:(n.items??[]).filter(a=>a.id!==t)}));return{...r,pages:o}},wr=(e,t)=>{const r=F(e),o=re(r),n=t.tempId??null,a=t.row,l=a.clientId??Z(a.body);if(n)for(const c of o)c.items=(c.items??[]).filter(u=>u.id!==n);if(l)for(const c of o)c.items=(c.items??[]).filter(u=>!(te(u.id)&&Z(u.body)===l));let i=!1;for(const c of o){const u=(c.items??[]).findIndex(d=>d.id===a.id);if(u>=0){c.items[u]=a,c.items=ee(c.items),i=!0;break}}if(!i){const c=o[o.length-1];c.items=ee([...c.items??[],a])}return{...r,pages:o}},Wn=(e,t)=>{const r=F(e),o=F(t),n=x=>{if(x==null)return"initial";if(typeof x=="string")return`s:${x}`;if(typeof x=="number")return`n:${x}`;if(typeof x=="boolean")return`b:${x}`;if(typeof x=="object")try{return`o:${JSON.stringify(x)}`}catch{return"o:[unserializable]"}return`u:${String(x)}`},a=new Map,l=r.pageParams??[];for(const[x,y]of r.pages.entries()){const g=l[x];a.set(n(g),y)}const i=new Map,c=o.pageParams??[];for(const[x,y]of o.pages.entries()){const g=c[x];i.set(n(g),y)}const u=[],d=[],m=(o.pages.length>=r.pages.length?c:l)??[],p=new Set;for(const x of m){const y=n(x);if(p.has(y))continue;p.add(y);const g=a.get(y),b=i.get(y);if(!g&&!b)continue;if(!g){u.push(b),d.push(x);continue}if(!b){g&&(u.push(g),d.push(x));continue}const w=new Map;for(const N of g.items??[])w.set(N.id,N);for(const N of b.items??[])w.set(N.id,N);const S=ee(Array.from(w.values()));u.push({...b,items:S,cursor:yr(S),hasMore:b.hasMore??g.hasMore??!0}),d.push(x)}const h=(x,y)=>{for(const g of x){const b=n(g);if(p.has(b))continue;const w=y.get(b);w&&(p.add(b),u.push(w),d.push(g))}};return h(c,i),h(l,a),{...o,pages:u.length>0?u:[{items:[],hasMore:!0,cursor:null}],pageParams:d.length>0?d:o.pageParams??r.pageParams}},zn=(e,t,r)=>{const o=r?.allowAppend??!0,n=gr(t),a=n.clientId??Z(n.body),l=F(e),i=re(l);if(a)for(const c of i){const u=(c.items??[]).findIndex(d=>te(d.id)&&Z(d.body)===a);if(u>=0){c.items.splice(u,1);break}}for(const c of i){const u=(c.items??[]).findIndex(d=>d.id===n.id);if(u>=0)return c.items[u]=n,c.items=Ze(c.items),{...l,pages:i}}if(o){const c=i[i.length-1];c.items=ee([...c.items??[],n])}return{...l,pages:i}},vr="id, conversation_id, user_id, body, message_type, text, client_id, meta, attachment_url, created_at",L="chat-media",de=(e=()=>`${Date.now()}-${Math.random().toString(36).slice(2,10)}`)=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():e(),Ne=new Map,et=()=>Date.now(),tt=e=>{if(!e)return null;const t=Ne.get(e);return t?t.expiresAt<=et()?(Ne.delete(e),null):t.url:null},Sr=(e,t,r)=>{if(!e||!t)return;const n=Math.max(0,r*1e3-6e4);Ne.set(e,{url:t,expiresAt:et()+n})},Pe=3600,V=e=>/^https?:\/\//i.test(e),_e=(e,t)=>t&&$.storage.from(e).getPublicUrl(t).data.publicUrl||null,rt=async(e,t,r=Pe)=>{if(!t)return null;const{data:o,error:n}=await $.storage.from(e).createSignedUrl(t,r);return n||!o?.signedUrl?null:(Sr(`${e}:${t}`,o.signedUrl,r),o.signedUrl)};async function fe(e,t,r){if(!t)return null;if(V(t))return r?.allowHttp?t:null;const o=r?.ttlSeconds??Pe,n=r?.allowPublicFallback??!1;if(!(r?.forceRefresh??!1)){const l=tt(`${e}:${t}`);if(l)return l}try{const l=await rt(e,t,o);if(l)return l}catch{}if(!n)return null;try{return _e(e,t)}catch{return null}}async function jr(e,t,r=Pe){if(t&&!V(t)&&!tt(`${e}:${t}`))try{await rt(e,t,r)}catch{}}const ze=async e=>{if(!e||V(e))return;const{error:t}=await $.storage.from(L).remove([e]);if(t)throw t},nt=new Set(["jpg","jpeg","png","webp","gif","avif","heic","heif"]),st=new Set(["mp3","wav","ogg","m4a","aac","flac","webm"]),ot=new Set(["pdf","doc","docx","xls","xlsx","ppt","pptx","csv","txt","rtf"]),ne=e=>e&&(((e.split("?")[0]?.split("#")[0]??"").split("/").pop()??"").split(".").pop()?.toLowerCase()??"")||null,at=e=>{const t=ne(e);return t&&nt.has(t)?"image":t&&st.has(t)?"audio":"document"},Nr=e=>{if(!e)return"Attachment";const t=e.split("?")[0]?.split("#")[0]??e;return(t.split("/").pop()??t)||"Attachment"};function ce(e){const t=e/1048576;if(t>=1)return`${Math.round(t)}MB`;const r=e/1024;return r>=1?`${Math.round(r)}KB`:`${e}B`}const ke={"image/jpg":"jpg","image/jpeg":"jpg","image/pjpeg":"jpg","image/png":"png","image/webp":"webp","image/gif":"gif","image/avif":"avif","image/heic":"heic","image/heif":"heif"},Ce={"audio/mpeg":"mp3","audio/mp3":"mp3","audio/wav":"wav","audio/x-wav":"wav","audio/ogg":"ogg","audio/webm":"webm","audio/mp4":"m4a","audio/aac":"aac","audio/flac":"flac"},Ae={"application/pdf":"pdf","text/plain":"txt","text/csv":"csv","application/rtf":"rtf","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","application/vnd.ms-powerpoint":"ppt","application/vnd.openxmlformats-officedocument.presentationml.presentation":"pptx"},kr=new Set(Object.keys(ke)),Cr=new Set(Object.keys(Ce)),Ar=new Set(Object.keys(Ae)),Er=e=>{if(e.type&&ke[e.type])return ke[e.type];const t=ne(e.name);return t?t==="jpeg"?"jpg":nt.has(t)?t:null:null},Pr=e=>{if(e.type&&Ce[e.type])return Ce[e.type];const t=ne(e.name);return t&&st.has(t)?t:null},_r=e=>{if(e.type&&Ae[e.type])return Ae[e.type];const t=ne(e.name);return t&&ot.has(t)?t:null},Mr=(e,t)=>{const r=e.type??"",o=r.startsWith("image/"),n=r.startsWith("audio/");if(o){if(e.type&&!kr.has(e.type))return{ok:!1,error:"Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image."};const l=Er(e);return l?e.size>t.image?{ok:!1,error:`That image is too large (max ${ce(t.image)}). Try a smaller file.`}:{ok:!0,kind:"image",ext:l}:{ok:!1,error:"Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image."}}if(n||Cr.has(r)){const l=Pr(e);return l?e.size>t.audio?{ok:!1,error:`That audio file is too large (max ${ce(t.audio)}). Try a smaller file.`}:{ok:!0,kind:"audio",ext:l}:{ok:!1,error:"Unsupported audio format. Please choose an MP3, WAV, OGG, M4A, AAC, or FLAC."}}const a=ne(e.name);if(Ar.has(r)||a&&ot.has(a)){const l=_r(e);return l?e.size>t.document?{ok:!1,error:`That document is too large (max ${ce(t.document)}). Try a smaller file.`}:{ok:!0,kind:"document",ext:l}:{ok:!1,error:"Unsupported document format. Please choose a PDF, Word, Excel, PowerPoint, text, or CSV file."}}return{ok:!1,error:"Unsupported file type. Please choose an image, audio, or document file."}},Rr=(e,t,r)=>{const o=de(()=>String(Date.now()));return`message_attachments/${e}/${t}/${Date.now()}-${o}.${r}`};function Yn(e){const{conversationId:t,userId:r,isBlocked:o,blockedYou:n,attemptSend:a}=e,{getNumber:l}=Mt(),i=Math.max(1,Math.floor(l("ux.attachments.max_image_bytes",10*1024*1024))),c=Math.max(1,Math.floor(l("ux.attachments.max_audio_bytes",20*1024*1024))),u=Math.max(1,Math.floor(l("ux.attachments.max_document_bytes",15*1024*1024))),[d,m]=f.useState(null),[p,h]=f.useState(!1),[x,y]=f.useState(null),g=f.useRef(0),b=f.useRef(null),w=f.useRef(null),S=f.useCallback(()=>m(null),[]),N=f.useCallback(E=>{y(C=>(C?.previewUrl&&URL.revokeObjectURL(C.previewUrl),E))},[]),A=f.useCallback(()=>{N(null)},[N]),P=f.useCallback(()=>{g.current+=1,h(!1),A()},[A]),k=f.useCallback(()=>{!t||!r||o||n||b.current?.click()},[n,t,o,r]),T=f.useCallback(()=>{!t||!r||o||n||w.current?.click()},[n,t,o,r]),j=f.useCallback(async E=>{if(!t||!r||o||n)return;m(null);const C=Mr(E,{image:i,audio:c,document:u});if(!C.ok){m(C.error);return}const K=g.current+=1;h(!0);const oe=C.kind==="image"||C.kind==="audio"?URL.createObjectURL(E):null;N({id:de(),name:E.name,sizeLabel:ce(E.size),kind:C.kind,previewUrl:oe});const O=Rr(t,r,C.ext);let ae=!1;try{const{error:B}=await $.storage.from(L).upload(O,E,{cacheControl:"3600",upsert:!1});if(K!==g.current){try{await ze(O)}catch{}return}if(B){console.error("[useAttachmentUpload] image upload error",B),m("Upload failed. Please try another image.");return}if(jr(L,O),K!==g.current){try{await ze(O)}catch{}return}a({text:"",attachmentPath:O,attachmentKind:C.kind}),ae=!0}catch(B){console.error("[useAttachmentUpload] sendAttachmentFile failed",B),m("Something went wrong while sending your attachment.")}finally{K===g.current&&(h(!1),ae&&A())}},[a,n,A,t,o,c,u,i,r]),_=f.useCallback(async E=>{const C=E.target.files?.[0];E.target.value="",!(!C||!t||!r)&&(p||o||n||await j(C))},[n,t,o,p,j,r]),R=f.useCallback(async E=>{const C=E.target.files?.[0];E.target.value="",!(!C||!t||!r)&&(p||o||n||await j(C))},[n,t,o,p,j,r]);return{imageInputRef:b,attachmentInputRef:w,openImagePicker:k,openAttachmentPicker:T,handleImageSelected:_,handleAttachmentSelected:R,sendAttachmentFile:j,pendingAttachment:x,clearPendingAttachment:A,isUploadingAttachment:p,uploadError:d,clearUploadError:S,cancelAttachmentUpload:P}}const Tr=e=>{if(!e)return"Unknown error.";if(typeof e=="string")return e;const t=e,r=t.message??(e instanceof Error?e.message:typeof e=="object"?JSON.stringify(e):String(e)),o=t.code?` (${t.code})`:"",n=t.details?` â€” ${t.details}`:"",a=t.hint?` Hint: ${t.hint}`:"";return`${r}${o}${n}${a}`.trim()},Dr=e=>e==="text"?"text":e==="system"?"system":e==="image"?"image":e.startsWith("text+")?"text+image":"image",Ye=(e,t,r,o)=>{const n=e.trim();if(!t&&!n)return{payload:null,trimmed:n};const l=r??(t?at(t):null)??"image";return t&&n?{payload:{type:`text+${l}`,text:n,clientId:o},trimmed:n}:t?{payload:{type:l,text:"",clientId:o},trimmed:n}:{payload:{type:"text",text:n,clientId:o},trimmed:n}},Vn=(e,t)=>{const{user:r}=Xe(),o=r?.id??null,n=qe();return Se({mutationFn:async({text:a,attachmentPath:l,attachmentKind:i,clientId:c})=>{if(!e)throw new Error("Missing conversation id.");if(!o)throw new Error("You must be signed in to send messages.");if(t?.otherUserId){const x=await Je($,o,t.otherUserId);if(x.youBlocked)throw new Error("You have blocked this user. Unblock them to send messages.");if(x.blockedYou)throw new Error("You cannot send messages because this user blocked you.")}const u=c??de(),{payload:d}=Ye(a,l??null,i??null,u);if(!d)throw new Error("Cannot send an empty message.");const{data:m,error:p}=await $.from("messages").insert({conversation_id:e,user_id:o,sender_id:o,body:d,message_type:Dr(d.type),text:d.text??null,client_id:d.clientId??null,meta:d,attachment_url:l??null}).select(vr).single();if(p)throw console.error("[useSendMessage] Failed to send message",p),new Error(Tr(p));if(!m)throw new Error("Failed to send message.");if(m.conversation_id!==e||m.user_id!==o)throw new Error("Unexpected message response.");return{id:m.id,conversationId:m.conversation_id,senderId:m.user_id,body:m.body??null,attachmentUrl:m.attachment_url??null,createdAt:m.created_at,meta:m.meta??null}},onMutate:async a=>{if(!e||!o)return{previous:void 0,tempId:null};const{text:l,attachmentPath:i,attachmentKind:c}=a,u=a.clientId??de();a.clientId=u;const{payload:d,trimmed:m}=Ye(l,i??null,c??null,u);if(!d)throw new Error("Cannot send an empty message.");const p=a.tempId,h=typeof p=="string"&&p.length?xr(p):br(),x=we(e),y=n.getQueryData(x),g=y?.pages?.[y.pages.length-1]?.items,b=g&&g.length?g[g.length-1]?.createdAt:null,w=b?new Date(b).getTime():NaN,S=Number.isFinite(w),N=S?w:Date.now(),A=new Date(N+1).toISOString(),P={id:h,conversationId:e,senderId:o,body:d,attachmentUrl:i??null,createdAt:A,meta:d};await n.cancelQueries({queryKey:x});const k=n.getQueryData(x);return n.setQueryData(x,T=>We(T,P)),{previous:k,tempId:h,optimistic:P,usedServerAnchor:S,payload:{text:m,attachmentPath:i??null,attachmentKind:c??null,clientId:u}}},onError:(a,l,i)=>{if(console.error("[useSendMessage] sendMessage error",a),!e)return;const{previous:c,optimistic:u,payload:d,tempId:m}=i??{previous:void 0,tempId:null},p=we(e);n.setQueryData(p,h=>u?We(c??h,u):F(c??h)),m&&d&&t?.onFailed&&t.onFailed(m,d,a)},onSuccess:(a,l,i)=>{if(!e)return;const c=i?.tempId,u=we(e),d=i?.optimistic?.createdAt??null;if(d&&i?.usedServerAnchor){const m=new Date(a.createdAt).getTime(),p=new Date(d).getTime();Number.isFinite(m)&&Number.isFinite(p)&&m<p&&(a={...a,createdAt:d})}n.setQueryData(u,m=>wr(m,{tempId:c,row:a})),Ht(n,o,e,m=>({...m,lastMessagePreview:Tt(a.body)??m.lastMessagePreview,lastMessageAt:a.createdAt??m.lastMessageAt,lastMessageAtLabel:Rt(a.createdAt??null),hasUnread:!1,lastMessageIsFromSelf:!0,lastMessageSeenByOthers:!1}),{moveToTop:!0}),t?.onRecovered&&t.onRecovered(i?.tempId??null)}})};async function it(e){if(!e)return!1;try{if(typeof navigator<"u"&&navigator.clipboard?.writeText)return await navigator.clipboard.writeText(e),!0}catch{}try{if(typeof document>"u")return!1;const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length);const r=document.execCommand("copy");return document.body.removeChild(t),r}catch{return!1}}const Ir=U.memo(function({isSelf:t,isDeleted:r,startsGroup:o,endsGroup:n,children:a,className:l="",role:i,tabIndex:c,...u}){const{bubbleColors:d,bubbleShape:m}=pr({isSelf:t,isDeleted:r,startsGroup:o,endsGroup:n});return s.jsx("div",{role:i??"button",tabIndex:c??0,className:Ee("inline-flex max-w-[82%] px-4 py-2.5 text-[14px] leading-snug md:text-[15px] md:leading-relaxed transition-transform duration-150 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/35 focus-visible:ring-offset-2 focus-visible:ring-offset-background active:scale-[0.99]",m,d,l),...u,children:s.jsx("div",{className:"flex flex-col gap-1 text-left leading-relaxed",children:a})})}),$r=/((?:https?:\/\/|www\.)[^\s<]+[^<.,:;"')\]\s])/gi,Lr=/([A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,})/gi,Or=/(\+?\d[\d\s().-]{7,}\d)/g,Ur=e=>/^https?:\/\//i.test(e)?e:/^www\./i.test(e)?`https://${e}`:e,lt=e=>e.replace(/\D/g,""),Fr=e=>{const t=e.trim(),r=t.startsWith("+"),o=lt(t);return`${r?"+":""}${o}`};function Br(e,t){const r=t.trim();if(!r)return[{text:e,match:!1}];const o=e.toLowerCase(),n=r.toLowerCase(),a=[];let l=0;for(;l<e.length;){const i=o.indexOf(n,l);if(i<0){a.push({text:e.slice(l),match:!1});break}i>l&&a.push({text:e.slice(l,i),match:!1}),a.push({text:e.slice(i,i+r.length),match:!0}),l=i+r.length}return a.length?a:[{text:e,match:!1}]}function Q(e,t){const r=(t??"").trim();return r?Br(e,r).map((o,n)=>o.match?s.jsx("mark",{className:"rounded bg-primary/20 px-0.5 text-foreground",children:o.text},`${n}-${o.text}`):s.jsx(U.Fragment,{children:o.text},`${n}-${o.text}`)):e}const Hr=({text:e,highlight:t})=>{const r=i=>{i.stopPropagation()},o=[],n=(i,c)=>{const u=new RegExp(i);let d;for(;(d=u.exec(e))!==null;)o.push({start:d.index,end:d.index+d[0].length,kind:c,raw:d[0]})};n($r,"url"),n(Lr,"email"),n(Or,"phone"),o.sort((i,c)=>i.start-c.start||c.end-i.end);const a=[];let l=0;for(const i of o)if(!(i.start<l)&&!(i.kind==="phone"&&lt(i.raw).length<10)){if(i.start>l){const c=e.slice(l,i.start);a.push(Q(c,t))}if(i.kind==="url"){const c=Ur(i.raw);a.push(s.jsx("a",{href:c,target:"_blank",rel:"noreferrer noopener",className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:Q(i.raw,t)},`${i.start}-${i.raw}`))}else if(i.kind==="email")a.push(s.jsx("a",{href:`mailto:${i.raw}`,className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:Q(i.raw,t)},`${i.start}-${i.raw}`));else{const c=Fr(i.raw);a.push(s.jsx("a",{href:`tel:${c}`,className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:Q(i.raw,t)},`${i.start}-${i.raw}`))}l=i.end}return l<e.length&&a.push(Q(e.slice(l),t)),s.jsx(s.Fragment,{children:a})},Wr=({path:e})=>{const[t,r]=f.useState(null),[o,n]=f.useState(!1),[a,l]=f.useState(!1),i=f.useRef(!0),c=f.useRef(null),u=f.useRef(!1),d=f.useRef(null),m=f.useRef(!1),p=f.useMemo(()=>!!e,[e]);return f.useEffect(()=>()=>{i.current=!1},[]),f.useEffect(()=>{let h=!1;return c.current=e||null,u.current=!1,r(null),n(!1),e?V(e)?(r(e),()=>{h=!0}):((async()=>{try{const x=await fe(L,e,{allowPublicFallback:!0,forceRefresh:!1,allowHttp:!0});if(h||c.current!==e||!i.current)return;if(!x){n(!0);return}r(x)}catch{!h&&i.current&&c.current===e&&n(!0)}})(),()=>{h=!0}):(n(!0),()=>{h=!0})},[e]),o?s.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Image unavailable."}):t?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mt-1 overflow-hidden rounded-xl border border-border bg-background/80",role:p?"button":void 0,tabIndex:p?0:void 0,onTouchStart:()=>{d.current=Date.now(),m.current=!1},onTouchEnd:()=>{if(d.current==null)return;const h=Date.now()-d.current;m.current=h>=450,d.current=null},onTouchCancel:()=>{d.current=null,m.current=!1},onClick:h=>{h.stopPropagation(),p&&(m.current||l(!0))},onKeyDown:h=>{p&&(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),h.stopPropagation(),l(!0))},onContextMenu:h=>{h.stopPropagation()},"aria-label":"Open image",children:s.jsx("img",{src:t,alt:"Attachment",className:"max-h-64 w-full cursor-zoom-in object-cover",loading:"lazy",onError:async()=>{if(!(!i.current||c.current!==e)){if(V(e)){n(!0);return}try{const h=_e(L,e);if(h&&t===h){n(!0);return}if(u.current){n(!0);return}u.current=!0;const x=await fe(L,e,{allowPublicFallback:!0,forceRefresh:!0,allowHttp:!0});if(!x||x===t){n(!0);return}if(!i.current||c.current!==e)return;r(x)}catch{i.current&&c.current===e&&n(!0)}}}})}),s.jsx(zr,{open:a,onOpenChange:l,url:t})]}):s.jsx("div",{className:"mt-1 h-32 w-40 animate-pulse rounded-xl bg-border/40"})},ve=(e,t,r)=>Math.max(t,Math.min(r,e));function zr({open:e,onOpenChange:t,url:r}){const[o,n]=f.useState(1),[a,l]=f.useState({x:0,y:0}),[i,c]=f.useState(!1),u=f.useRef(!1),d=f.useRef({x:0,y:0}),m=f.useRef({x:0,y:0}),p=()=>{n(1),l({x:0,y:0})};return f.useEffect(()=>{e||p()},[e]),s.jsx(Ge,{open:e,onOpenChange:t,children:s.jsx(Ke,{className:"max-w-none w-[calc(100%-1rem)] h-[calc(100%-1rem)] max-h-none p-0 overflow-hidden bg-black border-border/30","aria-label":"Image viewer",children:s.jsxs("div",{className:"relative h-full w-full",children:[s.jsxs("div",{className:"absolute left-0 top-0 z-10 flex w-full items-center justify-between gap-2 p-3",children:[s.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-black/40 px-3 py-1 text-xs text-white",children:[s.jsx("span",{className:"font-medium",children:"Image"}),s.jsx("span",{className:"opacity-75",children:"Â·"}),s.jsx("span",{className:"opacity-75",children:"Scroll to zoom"})]}),s.jsxs("div",{className:"inline-flex items-center gap-2",children:[s.jsxs("button",{type:"button",className:"inline-flex h-10 items-center gap-2 rounded-full bg-black/40 px-3 text-sm text-white hover:bg-black/55",onClick:()=>{try{window.open(r,"_blank","noopener,noreferrer")}catch{}},"aria-label":"Open image in new tab",children:[s.jsx(Qe,{className:"h-4 w-4","aria-hidden":!0}),s.jsx("span",{children:"Open"})]}),s.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full bg-black/40 p-1.5 text-white",children:[s.jsx("button",{type:"button",className:"icon-hit-dark",onClick:()=>n(h=>ve(Number((h-.25).toFixed(2)),1,4)),"aria-label":"Zoom out",children:s.jsx(or,{className:"h-4 w-4","aria-hidden":!0})}),s.jsx("button",{type:"button",className:"icon-hit-dark",onClick:()=>n(h=>ve(Number((h+.25).toFixed(2)),1,4)),"aria-label":"Zoom in",children:s.jsx(Kt,{className:"h-4 w-4","aria-hidden":!0})}),s.jsx("button",{type:"button",className:"icon-hit-dark",onClick:p,"aria-label":"Reset view",children:s.jsx(dr,{className:"h-4 w-4","aria-hidden":!0})})]}),s.jsx("button",{type:"button",className:"icon-hit-dark bg-black/40 hover:bg-black/55",onClick:()=>t(!1),"aria-label":"Close",children:s.jsx(Qt,{className:"h-5 w-5","aria-hidden":!0})})]})]}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",onWheel:h=>{if(o<=1)return;h.preventDefault();const x=-h.deltaY,y=ve(Number((o+x*.002).toFixed(2)),1,4);n(y)},onDoubleClick:()=>{n(h=>h===1?2:1),l({x:0,y:0})},onPointerDown:h=>{o<=1||(u.current=!0,c(!0),d.current={x:h.clientX,y:h.clientY},m.current=a,h.currentTarget.setPointerCapture?.(h.pointerId))},onPointerMove:h=>{if(!u.current)return;const x=h.clientX-d.current.x,y=h.clientY-d.current.y;l({x:m.current.x+x,y:m.current.y+y})},onPointerUp:()=>{u.current=!1,c(!1)},onPointerCancel:()=>{u.current=!1,c(!1)},children:s.jsx("img",{src:r,alt:"Attachment",className:"max-h-full max-w-full select-none object-contain",draggable:!1,style:{transform:`translate3d(${a.x}px, ${a.y}px, 0) scale(${o})`,transformOrigin:"center",transition:i?"none":"transform 120ms ease-out",cursor:o>1?"grab":"zoom-in"}})})]})})})}const Yr=e=>{const[t,r]=f.useState(null),[o,n]=f.useState(!1),a=f.useRef(!0),l=f.useRef(null),i=f.useRef(!1);return f.useEffect(()=>()=>{a.current=!1},[]),f.useEffect(()=>{let u=!1;return l.current=e||null,i.current=!1,r(null),n(!1),e?V(e)?(r(e),()=>{u=!0}):((async()=>{try{const d=await fe(L,e,{allowPublicFallback:!0,forceRefresh:!1,allowHttp:!0});if(u||l.current!==e||!a.current)return;if(!d){n(!0);return}r(d)}catch{!u&&a.current&&l.current===e&&n(!0)}})(),()=>{u=!0}):(n(!0),()=>{u=!0})},[e]),{url:t,error:o,retryIfNeeded:async()=>{if(!(!a.current||l.current!==e)){if(V(e)){n(!0);return}try{const u=_e(L,e);if(u&&t===u){n(!0);return}if(i.current){n(!0);return}i.current=!0;const d=await fe(L,e,{allowPublicFallback:!0,forceRefresh:!0,allowHttp:!0});if(!d||d===t){n(!0);return}if(!a.current||l.current!==e)return;r(d)}catch{a.current&&l.current===e&&n(!0)}}}}},Vr=()=>s.jsx("div",{className:"mt-1 h-12 w-48 animate-pulse rounded-xl bg-border/40"}),ct=({children:e})=>s.jsx("div",{className:"mt-1",children:e}),Xr=({url:e,name:t,onError:r})=>s.jsx(ct,{children:s.jsxs("div",{className:"flex w-full max-w-xs flex-col gap-2 rounded-xl border border-border bg-background/80 px-3 py-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[s.jsx(ir,{className:"h-4 w-4","aria-hidden":"true"}),s.jsx("span",{className:"font-semibold text-foreground",children:t})]}),s.jsx("audio",{controls:!0,src:e,className:"w-full",onError:r,onClick:o=>o.stopPropagation(),onContextMenu:o=>o.stopPropagation(),children:s.jsx("track",{kind:"captions",srcLang:"en",label:"Captions"})})]})}),qr=({url:e,name:t})=>s.jsx(ct,{children:s.jsxs("a",{href:e,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-3 rounded-xl border border-border bg-background/80 px-3 py-2 text-xs text-foreground hover:bg-muted/60",onClick:r=>r.stopPropagation(),onContextMenu:r=>r.stopPropagation(),children:[s.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-muted/70",children:s.jsx(nr,{className:"h-4 w-4","aria-hidden":"true"})}),s.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[s.jsx("span",{className:"truncate font-semibold",children:t}),s.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Open document"})]}),s.jsx(Qe,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true"})]})}),Gr=({path:e})=>{const t=f.useMemo(()=>at(e),[e]),{url:r,error:o,retryIfNeeded:n}=Yr(e),a=f.useMemo(()=>Nr(e),[e]);return t==="image"?s.jsx(Wr,{path:e}):o?s.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Attachment unavailable."}):r?t==="audio"?s.jsx(Xr,{url:r,name:a,onError:n}):s.jsx(qr,{url:r,name:a}):s.jsx(Vr,{})};function W(e){return typeof e=="string"&&e.trim().length>0}function Kr(e){return!e||typeof e!="object"?null:e}function Qr({ui:e,actions:t,onAction:r}){const o=f.useMemo(()=>Kr(e),[e]),n=f.useMemo(()=>{const g=Array.isArray(o?.citations)?o.citations:[],b=[],w=new Set;for(const S of g){const N=typeof S?.url=="string"?S.url.trim():"";if(!(!N||w.has(N))&&(w.add(N),b.push({url:N,title:typeof S?.title=="string"&&S.title.trim()?S.title.trim():void 0,domain:typeof S?.domain=="string"&&S.domain.trim()?S.domain.trim():void 0}),b.length>=8))break}return b},[o]),a=f.useMemo(()=>Array.isArray(t)?t:[],[t]),l=f.useMemo(()=>{const g=new Map;for(const b of a)b&&typeof b=="object"&&W(b.id)&&g.set(String(b.id),b);return g},[a]),[i,c]=f.useState({}),[u,d]=f.useState(!1),m=()=>n.length?s.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/40 p-3",children:[s.jsxs("button",{type:"button",onClick:()=>d(g=>!g),className:"flex w-full items-center justify-between gap-2 text-left",children:[s.jsx("span",{className:"text-xs font-semibold text-muted-foreground",children:"Sources"}),s.jsx("span",{className:"text-xs text-muted-foreground",children:u?"Hide":"Show"})]}),u?s.jsx("ul",{className:"mt-2 space-y-1 text-xs",children:n.map(g=>{const b=g.title?`${g.domain?`${g.domain} â€” `:""}${g.title}`:g.domain??g.url;return s.jsx("li",{className:"min-w-0",children:s.jsx("a",{href:g.url,target:"_blank",rel:"noreferrer",className:"block truncate text-primary underline-offset-2 hover:underline",title:g.url,children:b})},g.url)})}):null]}):null,p=g=>{const b=Array.from(new Set(g.filter(W))).slice(0,6);return b.length===0?null:s.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(w=>{const S=l.get(w);if(!S)return null;const N=(()=>{const k=String(S.type??"").toLowerCase();return k==="dismiss"?"Dismiss":k==="navigate"?"Open":"Do"})(),A=W(S.label)?S.label:N,P=!!i[w];return s.jsx("button",{type:"button",onClick:async()=>{try{c(k=>({...k,[w]:!0})),await r(w)}finally{c(k=>({...k,[w]:!1}))}},disabled:P,className:"rounded-full px-3 py-1 text-xs font-semibold transition "+(P?"bg-muted text-muted-foreground opacity-70":"bg-primary text-primary-foreground hover:bg-primary/90"),children:P?"Workingâ€¦":A},w)})})};if(!o||(o.layout??"stacked")!=="stacked"){const g=a.map(b=>String(b?.id??"")).filter(W);return g.length===0&&!n.length?null:s.jsxs("div",{className:"mt-2 space-y-2",children:[m(),g.length?s.jsx("div",{children:p(g)}):null]})}const h=Array.isArray(o.cards)?o.cards:[],x=new Set;for(const g of h){const b=(Array.isArray(g?.actionIds)?g.actionIds:[]).filter(W);for(const w of b)x.add(String(w))}const y=a.map(g=>String(g?.id??"")).filter(g=>W(g)&&!x.has(g));return!o.heading&&h.length===0&&y.length===0&&!n.length?null:s.jsxs("div",{className:"mt-2 space-y-2",children:[(o.heading||o.subheading)&&s.jsxs("div",{className:"rounded-2xl border border-border/60 bg-muted/20 p-3",children:[o.heading?s.jsx("div",{className:"text-sm font-semibold text-foreground",children:o.heading}):null,o.subheading?s.jsx("div",{className:"mt-0.5 text-xs text-muted-foreground",children:o.subheading}):null]}),h.map(g=>{const b=(Array.isArray(g.actionIds)?g.actionIds:[]).filter(W);return s.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/60 p-3",children:s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{className:"h-16 w-12 shrink-0 overflow-hidden rounded-xl bg-muted",children:g.poster?s.jsx("img",{src:g.poster,alt:g.title??"",className:"h-full w-full object-cover",loading:"lazy"}):null}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("div",{className:"flex items-start justify-between gap-2",children:s.jsxs("div",{className:"min-w-0",children:[s.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:g.title??""}),s.jsx("div",{className:"mt-0.5 truncate text-xs text-muted-foreground",children:[g.kind,g.year?String(g.year):null].filter(Boolean).join(" â€¢ ")})]})}),g.reason?s.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:g.reason}):null,Array.isArray(g.badges)&&g.badges.length?s.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:g.badges.slice(0,6).map(w=>s.jsx("span",{className:"rounded-full bg-muted/70 px-2 py-0.5 text-[11px] font-semibold text-muted-foreground",children:w},w))}):null,b.length?s.jsx("div",{className:"mt-3",children:p(b)}):null]})]})},g.id)}),y.length?s.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/40 p-3",children:[s.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Actions"}),s.jsx("div",{className:"mt-2",children:p(y)})]}):null,m()]})}function Jr({handles:e,className:t}){const r=Array.isArray(e)?e.map(m=>String(m)).filter(Boolean).slice(0,50):[],[o,n]=U.useState(r[0]??null),[a,l]=U.useState(!1),[i,c]=U.useState({}),u=U.useCallback(async m=>{if(m&&!Object.prototype.hasOwnProperty.call(i,m)){l(!0);try{const p=await Dt("assistant-tool-result",{actionId:m});c(h=>({...h,[m]:p}))}catch(p){c(h=>({...h,[m]:null})),J.error(p?.message??"Couldn't load evidence.")}finally{l(!1)}}},[i]);if(U.useEffect(()=>{o&&u(o)},[o,u]),r.length===0)return null;const d=o?i[o]:null;return s.jsx("div",{className:t,children:s.jsxs(Ge,{children:[s.jsx(Vt,{asChild:!0,children:s.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-3 py-1 text-xs font-medium text-muted-foreground hover:bg-muted",children:["Evidence",s.jsx(It,{variant:"outline",className:"px-2 py-0 text-[11px]",children:r.length})]})}),s.jsxs(Ke,{className:"max-w-2xl",children:[s.jsxs(Xt,{children:[s.jsx(qt,{children:"Evidence"}),s.jsx(Gt,{children:"Tool results the assistant used while generating this reply."})]}),s.jsxs("div",{className:"mt-2 flex flex-col gap-3",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(m=>s.jsx("button",{type:"button",onClick:()=>{n(m),u(m)},className:`rounded-full border px-3 py-1 text-xs transition ${m===o?"border-primary/50 bg-primary/15 text-primary":"border-border bg-background text-muted-foreground hover:bg-muted"}`,title:m,children:m},m))}),s.jsx("div",{className:"rounded-2xl border border-border bg-background p-4",children:a&&!d?s.jsx("div",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):d?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s.jsx("div",{className:"text-sm font-medium text-foreground",children:d.actionType}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(d.createdAt).toLocaleString()}),s.jsx($t,{variant:"ghost",size:"sm",onClick:async()=>{await it(JSON.stringify(d.payload,null,2))?J.show("Evidence copied."):J.error("Couldn't copy evidence.")},children:"Copy JSON"})]})]}),s.jsx("pre",{className:"mt-3 max-h-[55vh] overflow-auto whitespace-pre-wrap break-words rounded-xl bg-muted/30 p-3 text-xs text-foreground",children:JSON.stringify(d.payload,null,2)})]}):s.jsx("div",{className:"text-sm text-muted-foreground",children:"No details available."})})]})]})]})})}const Zr=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ”¥","ðŸ˜"],Xn=U.memo(function({message:t,meta:r,sender:o,isSelf:n,deliveryStatus:a,showDeliveryStatus:l,reactions:i,index:c,previousMessage:u,nextMessage:d,firstUnreadIndex:m,activeActionMessageId:p,longPressTriggeredRef:h,onOpenMessageActions:x,onCloseMessageActions:y,onOpenEditDialog:g,onOpenDeleteDialog:b,onToggleReaction:w,onRetryMessage:S,onDiscardFailedMessage:N,onAssistantAction:A,onBubbleTouchStart:P,onBubbleTouchEndOrCancel:k,searchQuery:T,isSearchMatch:j,isActiveSearchMatch:_}){const R=u!=null&&u.senderId===t.senderId,E=d!=null&&d.senderId===t.senderId,C=R&&Be(u.createdAt,t.createdAt),K=E&&Be(t.createdAt,d.createdAt),oe=!(R&&C),O=!(E&&K),ae=m!=null&&c===m,B=c===0||u!=null&&!je(new Date(u.createdAt),new Date(t.createdAt)),Nt=c===0||B?"mt-0":oe?"mt-2.5":"mt-1",D=r.deleted===!0,Ie=r.editedAt,$e=r.deletedAt,kt=r.streaming===!0,Le=o?.displayName??(n?"You":"Someone"),H=Lt(t.body),Oe=kt&&!D,Ue=(T??"").trim(),Ct=!!(Ue&&j&&!D),At=(()=>{const v=n?"You":Le;return D?`${v} deleted a message`:H?`${v} said: ${H}`:t.attachmentUrl?`${v} sent an attachment`:`${v} sent a message`})(),Et=!n&&O,ie=le(t.createdAt),ye=()=>{if(h.current){h.current=!1;return}p===t.id?y():x(t)};return s.jsxs("div",{className:"px-0",children:[B&&s.jsx("div",{className:"my-3 flex items-center justify-center",children:s.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-muted-foreground",children:[s.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),s.jsx("span",{className:"rounded-full bg-muted px-3 py-0.5 text-xs font-medium text-muted-foreground",children:hr(t.createdAt)}),s.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),ae&&s.jsx("div",{className:"my-3 flex items-center justify-center",role:"separator","aria-label":"New messages",children:s.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-primary",children:[s.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),s.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-0.5 text-xs font-semibold text-primary",children:"New messages"}),s.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),s.jsxs("div",{className:`flex w-full flex-col gap-0.5 ${Nt}`,children:[s.jsxs("div",{className:`flex w-full items-end gap-2 ${n?"justify-end":"justify-start"}`,children:[!n&&s.jsx(s.Fragment,{children:Et?s.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0 overflow-hidden rounded-full bg-muted",children:o?.avatarUrl?s.jsx("img",{src:o.avatarUrl,alt:o.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):s.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs font-medium text-muted-foreground",children:Le.slice(0,2).toUpperCase()})}):s.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0"})}),s.jsxs(Ir,{isSelf:n,isDeleted:D,startsGroup:oe,endsGroup:O,"data-message-action-scope":t.id,className:D?"":_?"ring-2 ring-primary/60":j?"ring-2 ring-primary/25":"",onClick:ye,onContextMenu:v=>{v.preventDefault(),ye()},onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),ye())},onTouchStart:()=>P(t),onTouchEnd:k,onTouchCancel:k,"aria-label":At,children:[(H||Oe)&&s.jsxs("p",{className:"whitespace-pre-wrap break-words [overflow-wrap:anywhere] text-sm leading-snug",children:[H?s.jsx(Hr,{text:H,highlight:Ct?Ue:void 0}):null,Oe?s.jsx("span",{className:"ml-1 inline-block h-3 w-1 animate-pulse rounded-sm bg-current align-baseline","aria-hidden":"true"}):null]}),!D&&t.attachmentUrl&&s.jsx(Gr,{path:t.attachmentUrl})]})]}),i.length>0&&s.jsx("div",{className:`mt-0.5 flex w-full ${n?"justify-end pr-6":"justify-start pl-6"}`,children:s.jsx("div",{className:"inline-flex flex-wrap items-center gap-1 rounded-full bg-muted px-1.5 py-0.5 text-xs text-foreground",children:i.map(v=>s.jsxs("button",{type:"button",onClick:()=>w(t.id,v.emoji),"aria-label":`Toggle reaction ${v.emoji}`,className:`inline-flex h-8 items-center gap-1 rounded-full px-2 py-1 text-[12px] font-medium transition hover:bg-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 focus-visible:ring-offset-2 focus-visible:ring-offset-background ${v.reactedBySelf?"bg-primary/10":""}`,children:[s.jsx("span",{className:"text-[17px]",children:v.emoji}),v.count>1&&s.jsx("span",{className:"text-xs text-muted-foreground",children:v.count})]},v.emoji))})}),p===t.id&&!D&&s.jsx("div",{className:`mt-1 flex w-full ${n?"justify-end pr-6":"justify-start pl-6"}`,children:s.jsxs("div",{className:"soft-popover inline-flex max-w-[min(360px,92vw)] flex-col gap-2 p-2.5 text-foreground select-none","data-message-action-scope":t.id,children:[s.jsx("div",{className:"flex items-center justify-center gap-1.5",children:Zr.map(v=>s.jsx("button",{type:"button","aria-label":`React with ${v}`,onClick:()=>{w(t.id,v),y()},className:"inline-flex h-9 w-9 items-center justify-center rounded-full transition hover:bg-muted/60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:s.jsx("span",{className:"text-[18px]",children:v})},v))}),s.jsxs("div",{className:`flex flex-wrap items-center gap-1.5 ${n?"justify-end":"justify-start"}`,children:[H?s.jsxs("button",{type:"button",onClick:async()=>{await it(H)?J.show("Copied to clipboard."):J.error("Couldn't copy to clipboard."),y()},className:"inline-flex items-center gap-1.5 rounded-full bg-muted/60 px-3 py-1.5 text-[12px] font-medium text-foreground transition hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[s.jsx(Jt,{className:"h-3.5 w-3.5","aria-hidden":!0}),s.jsx("span",{children:"Copy"})]}):null,n?(()=>{if(t.attachmentUrl||D)return null;const v=Ot(t.body);return v!=="text"&&v!=="unknown"?null:s.jsxs("button",{type:"button",onClick:Pt=>g(t,Pt.currentTarget),className:"inline-flex items-center gap-1.5 rounded-full bg-muted/60 px-3 py-1.5 text-[12px] font-medium text-foreground transition hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[s.jsx(cr,{className:"h-3.5 w-3.5","aria-hidden":!0}),s.jsx("span",{children:"Edit"})]})})():null,n?s.jsxs("button",{type:"button",onClick:()=>b(t),className:"inline-flex items-center gap-1.5 rounded-full bg-destructive/10 px-3 py-1.5 text-[12px] font-medium text-destructive transition hover:bg-destructive/15 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-destructive/50 focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[s.jsx(mr,{className:"h-3.5 w-3.5","aria-hidden":!0}),s.jsx("span",{children:"Delete"})]}):null]})]})}),!n&&(t?.meta?.ai?.ui||t?.meta?.ai?.actions)?s.jsx("div",{className:"pl-7 pr-1",children:s.jsx(Qr,{ui:t.meta.ai.ui,actions:t.meta.ai.actions,onAction:async v=>{A&&await A(t.id,v)}})}):null,!n&&Array.isArray(t?.meta?.ai?.toolHandles)&&t.meta.ai.toolHandles.length>0?s.jsx("div",{className:"pl-7 pr-1",children:s.jsx(Jr,{handles:t.meta.ai.toolHandles})}):null,l&&a&&s.jsx("div",{className:`mt-0.5 flex items-center gap-1.5 text-[11px] font-medium text-muted-foreground ${n?"justify-end pr-1":"justify-start pl-7"}`,children:a.status==="failed"?s.jsxs(s.Fragment,{children:[s.jsx(Zt,{className:"h-3 w-3 text-destructive","aria-hidden":!0}),s.jsxs("span",{children:["Failed Â· ",ie]}),s.jsx("button",{type:"button",className:"text-destructive underline underline-offset-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-destructive/50 focus-visible:ring-offset-2 focus-visible:ring-offset-background",onClick:()=>S(t),children:"Retry"}),s.jsx("span",{"aria-hidden":"true",children:"Â·"}),s.jsx("button",{type:"button",className:"text-destructive underline underline-offset-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-destructive/50 focus-visible:ring-offset-2 focus-visible:ring-offset-background",onClick:()=>N(t),children:"Discard"})]}):a.status==="sending"?s.jsxs(s.Fragment,{children:[s.jsx(Ut,{className:"h-3 w-3 animate-spin","aria-hidden":!0}),s.jsxs("span",{children:["Sendingâ€¦ Â· ",ie]})]}):a.status==="sent"?s.jsxs(s.Fragment,{children:[s.jsx(Wt,{className:"h-3 w-3","aria-hidden":!0}),s.jsxs("span",{children:["Sent Â· ",ie]})]}):a.status==="delivered"?s.jsxs(s.Fragment,{children:[s.jsx(Fe,{className:"h-3 w-3","aria-hidden":!0}),s.jsxs("span",{children:["Delivered Â· ",ie]})]}):s.jsxs(s.Fragment,{children:[s.jsx(Fe,{className:"h-3 w-3","aria-hidden":!0}),s.jsx("span",{children:a.seenAt?`Seen ${le(a.seenAt)}`:"Seen"})]})}),D&&$e&&s.jsxs("p",{className:`text-xs text-muted-foreground ${n?"text-right pr-1":"text-left pl-7"}`,children:["Deleted ",le($e)]}),!D&&Ie&&s.jsxs("p",{className:`text-xs text-muted-foreground ${n?"text-right pr-1":"text-left pl-7"}`,children:["Edited ",le(Ie)]})]})]},t.id)});function en(e){const t=tn(e),r=f.forwardRef((o,n)=>{const{children:a,...l}=o,i=f.Children.toArray(a),c=i.find(nn);if(c){const u=c.props.children,d=i.map(m=>m===c?f.Children.count(u)>1?f.Children.only(null):f.isValidElement(u)?u.props.children:null:m);return s.jsx(t,{...l,ref:n,children:f.isValidElement(u)?f.cloneElement(u,void 0,d):null})}return s.jsx(t,{...l,ref:n,children:a})});return r.displayName=`${e}.Slot`,r}function tn(e){const t=f.forwardRef((r,o)=>{const{children:n,...a}=r;if(f.isValidElement(n)){const l=on(n),i=sn(a,n.props);return n.type!==f.Fragment&&(i.ref=o?Ft(o,l):l),f.cloneElement(n,i)}return f.Children.count(n)>1?f.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var rn=Symbol("radix.slottable");function nn(e){return f.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===rn}function sn(e,t){const r={...t};for(const o in t){const n=e[o],a=t[o];/^on[A-Z]/.test(o)?n&&a?r[o]=(...i)=>{const c=a(...i);return n(...i),c}:n&&(r[o]=n):o==="style"?r[o]={...n,...a}:o==="className"&&(r[o]=[n,a].filter(Boolean).join(" "))}return{...e,...r}}function on(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var an=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],se=an.reduce((e,t)=>{const r=en(`Primitive.${t}`),o=f.forwardRef((n,a)=>{const{asChild:l,...i}=n,c=l?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),s.jsx(c,{...i,ref:a})});return o.displayName=`Primitive.${t}`,{...e,[t]:o}},{});function ln(e,t=[]){let r=[];function o(a,l){const i=f.createContext(l),c=r.length;r=[...r,l];const u=m=>{const{scope:p,children:h,...x}=m,y=p?.[e]?.[c]||i,g=f.useMemo(()=>x,Object.values(x));return s.jsx(y.Provider,{value:g,children:h})};u.displayName=a+"Provider";function d(m,p){const h=p?.[e]?.[c]||i,x=f.useContext(h);if(x)return x;if(l!==void 0)return l;throw new Error(`\`${m}\` must be used within \`${a}\``)}return[u,d]}const n=()=>{const a=r.map(l=>f.createContext(l));return function(i){const c=i?.[e]||a;return f.useMemo(()=>({[`__scope${e}`]:{...i,[e]:c}}),[i,c])}};return n.scopeName=e,[o,cn(n,...t)]}function cn(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(a){const l=o.reduce((i,{useScope:c,scopeName:u})=>{const m=c(a)[`__scope${u}`];return{...i,...m}},{});return f.useMemo(()=>({[`__scope${t.scopeName}`]:l}),[l])}};return r.scopeName=t.scopeName,r}function un(e,[t,r]){return Math.min(r,Math.max(t,e))}function dn(e,t){return f.useReducer((r,o)=>t[r][o]??r,e)}var Me="ScrollArea",[ut]=ln(Me),[fn,M]=ut(Me),dt=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:o="hover",dir:n,scrollHideDelay:a=600,...l}=e,[i,c]=f.useState(null),[u,d]=f.useState(null),[m,p]=f.useState(null),[h,x]=f.useState(null),[y,g]=f.useState(null),[b,w]=f.useState(0),[S,N]=f.useState(0),[A,P]=f.useState(!1),[k,T]=f.useState(!1),j=G(t,R=>c(R)),_=er(n);return s.jsx(fn,{scope:r,type:o,dir:_,scrollHideDelay:a,scrollArea:i,viewport:u,onViewportChange:d,content:m,onContentChange:p,scrollbarX:h,onScrollbarXChange:x,scrollbarXEnabled:A,onScrollbarXEnabledChange:P,scrollbarY:y,onScrollbarYChange:g,scrollbarYEnabled:k,onScrollbarYEnabledChange:T,onCornerWidthChange:w,onCornerHeightChange:N,children:s.jsx(se.div,{dir:_,...l,ref:j,style:{position:"relative","--radix-scroll-area-corner-width":b+"px","--radix-scroll-area-corner-height":S+"px",...e.style}})})});dt.displayName=Me;var ft="ScrollAreaViewport",mt=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:o,nonce:n,...a}=e,l=M(ft,r),i=f.useRef(null),c=G(t,i,l.onViewportChange);return s.jsxs(s.Fragment,{children:[s.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),s.jsx(se.div,{"data-radix-scroll-area-viewport":"",...a,ref:c,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...e.style},children:s.jsx("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:o})})]})});mt.displayName=ft;var I="ScrollAreaScrollbar",Re=f.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=M(I,e.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:l}=n,i=e.orientation==="horizontal";return f.useEffect(()=>(i?a(!0):l(!0),()=>{i?a(!1):l(!1)}),[i,a,l]),n.type==="hover"?s.jsx(mn,{...o,ref:t,forceMount:r}):n.type==="scroll"?s.jsx(pn,{...o,ref:t,forceMount:r}):n.type==="auto"?s.jsx(pt,{...o,ref:t,forceMount:r}):n.type==="always"?s.jsx(Te,{...o,ref:t}):null});Re.displayName=I;var mn=f.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=M(I,e.__scopeScrollArea),[a,l]=f.useState(!1);return f.useEffect(()=>{const i=n.scrollArea;let c=0;if(i){const u=()=>{window.clearTimeout(c),l(!0)},d=()=>{c=window.setTimeout(()=>l(!1),n.scrollHideDelay)};return i.addEventListener("pointerenter",u),i.addEventListener("pointerleave",d),()=>{window.clearTimeout(c),i.removeEventListener("pointerenter",u),i.removeEventListener("pointerleave",d)}}},[n.scrollArea,n.scrollHideDelay]),s.jsx(he,{present:r||a,children:s.jsx(pt,{"data-state":a?"visible":"hidden",...o,ref:t})})}),pn=f.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=M(I,e.__scopeScrollArea),a=e.orientation==="horizontal",l=be(()=>c("SCROLL_END"),100),[i,c]=dn("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return f.useEffect(()=>{if(i==="idle"){const u=window.setTimeout(()=>c("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(u)}},[i,n.scrollHideDelay,c]),f.useEffect(()=>{const u=n.viewport,d=a?"scrollLeft":"scrollTop";if(u){let m=u[d];const p=()=>{const h=u[d];m!==h&&(c("SCROLL"),l()),m=h};return u.addEventListener("scroll",p),()=>u.removeEventListener("scroll",p)}},[n.viewport,a,c,l]),s.jsx(he,{present:r||i!=="hidden",children:s.jsx(Te,{"data-state":i==="hidden"?"hidden":"visible",...o,ref:t,onPointerEnter:Y(e.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:Y(e.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),pt=f.forwardRef((e,t)=>{const r=M(I,e.__scopeScrollArea),{forceMount:o,...n}=e,[a,l]=f.useState(!1),i=e.orientation==="horizontal",c=be(()=>{if(r.viewport){const u=r.viewport.offsetWidth<r.viewport.scrollWidth,d=r.viewport.offsetHeight<r.viewport.scrollHeight;l(i?u:d)}},10);return q(r.viewport,c),q(r.content,c),s.jsx(he,{present:o||a,children:s.jsx(Te,{"data-state":a?"visible":"hidden",...n,ref:t})})}),Te=f.forwardRef((e,t)=>{const{orientation:r="vertical",...o}=e,n=M(I,e.__scopeScrollArea),a=f.useRef(null),l=f.useRef(0),[i,c]=f.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=yt(i.viewport,i.content),d={...o,sizes:i,onSizesChange:c,hasThumb:u>0&&u<1,onThumbChange:p=>a.current=p,onThumbPointerUp:()=>l.current=0,onThumbPointerDown:p=>l.current=p};function m(p,h){return wn(p,l.current,i,h)}return r==="horizontal"?s.jsx(hn,{...d,ref:t,onThumbPositionChange:()=>{if(n.viewport&&a.current){const p=n.viewport.scrollLeft,h=Ve(p,i,n.dir);a.current.style.transform=`translate3d(${h}px, 0, 0)`}},onWheelScroll:p=>{n.viewport&&(n.viewport.scrollLeft=p)},onDragScroll:p=>{n.viewport&&(n.viewport.scrollLeft=m(p,n.dir))}}):r==="vertical"?s.jsx(gn,{...d,ref:t,onThumbPositionChange:()=>{if(n.viewport&&a.current){const p=n.viewport.scrollTop,h=Ve(p,i);a.current.style.transform=`translate3d(0, ${h}px, 0)`}},onWheelScroll:p=>{n.viewport&&(n.viewport.scrollTop=p)},onDragScroll:p=>{n.viewport&&(n.viewport.scrollTop=m(p))}}):null}),hn=f.forwardRef((e,t)=>{const{sizes:r,onSizesChange:o,...n}=e,a=M(I,e.__scopeScrollArea),[l,i]=f.useState(),c=f.useRef(null),u=G(t,c,a.onScrollbarXChange);return f.useEffect(()=>{c.current&&i(getComputedStyle(c.current))},[c]),s.jsx(gt,{"data-orientation":"horizontal",...n,ref:u,sizes:r,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":xe(r)+"px",...e.style},onThumbPointerDown:d=>e.onThumbPointerDown(d.x),onDragScroll:d=>e.onDragScroll(d.x),onWheelScroll:(d,m)=>{if(a.viewport){const p=a.viewport.scrollLeft+d.deltaX;e.onWheelScroll(p),vt(p,m)&&d.preventDefault()}},onResize:()=>{c.current&&a.viewport&&l&&o({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:pe(l.paddingLeft),paddingEnd:pe(l.paddingRight)}})}})}),gn=f.forwardRef((e,t)=>{const{sizes:r,onSizesChange:o,...n}=e,a=M(I,e.__scopeScrollArea),[l,i]=f.useState(),c=f.useRef(null),u=G(t,c,a.onScrollbarYChange);return f.useEffect(()=>{c.current&&i(getComputedStyle(c.current))},[c]),s.jsx(gt,{"data-orientation":"vertical",...n,ref:u,sizes:r,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":xe(r)+"px",...e.style},onThumbPointerDown:d=>e.onThumbPointerDown(d.y),onDragScroll:d=>e.onDragScroll(d.y),onWheelScroll:(d,m)=>{if(a.viewport){const p=a.viewport.scrollTop+d.deltaY;e.onWheelScroll(p),vt(p,m)&&d.preventDefault()}},onResize:()=>{c.current&&a.viewport&&l&&o({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:pe(l.paddingTop),paddingEnd:pe(l.paddingBottom)}})}})}),[xn,ht]=ut(I),gt=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:o,hasThumb:n,onThumbChange:a,onThumbPointerUp:l,onThumbPointerDown:i,onThumbPositionChange:c,onDragScroll:u,onWheelScroll:d,onResize:m,...p}=e,h=M(I,r),[x,y]=f.useState(null),g=G(t,j=>y(j)),b=f.useRef(null),w=f.useRef(""),S=h.viewport,N=o.content-o.viewport,A=z(d),P=z(c),k=be(m,10);function T(j){if(b.current){const _=j.clientX-b.current.left,R=j.clientY-b.current.top;u({x:_,y:R})}}return f.useEffect(()=>{const j=_=>{const R=_.target;x?.contains(R)&&A(_,N)};return document.addEventListener("wheel",j,{passive:!1}),()=>document.removeEventListener("wheel",j,{passive:!1})},[S,x,N,A]),f.useEffect(P,[o,P]),q(x,k),q(h.content,k),s.jsx(xn,{scope:r,scrollbar:x,hasThumb:n,onThumbChange:z(a),onThumbPointerUp:z(l),onThumbPositionChange:P,onThumbPointerDown:z(i),children:s.jsx(se.div,{...p,ref:g,style:{position:"absolute",...p.style},onPointerDown:Y(e.onPointerDown,j=>{j.button===0&&(j.target.setPointerCapture(j.pointerId),b.current=x.getBoundingClientRect(),w.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",h.viewport&&(h.viewport.style.scrollBehavior="auto"),T(j))}),onPointerMove:Y(e.onPointerMove,T),onPointerUp:Y(e.onPointerUp,j=>{const _=j.target;_.hasPointerCapture(j.pointerId)&&_.releasePointerCapture(j.pointerId),document.body.style.webkitUserSelect=w.current,h.viewport&&(h.viewport.style.scrollBehavior=""),b.current=null})})})}),me="ScrollAreaThumb",xt=f.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=ht(me,e.__scopeScrollArea);return s.jsx(he,{present:r||n.hasThumb,children:s.jsx(bn,{ref:t,...o})})}),bn=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:o,...n}=e,a=M(me,r),l=ht(me,r),{onThumbPositionChange:i}=l,c=G(t,m=>l.onThumbChange(m)),u=f.useRef(void 0),d=be(()=>{u.current&&(u.current(),u.current=void 0)},100);return f.useEffect(()=>{const m=a.viewport;if(m){const p=()=>{if(d(),!u.current){const h=vn(m,i);u.current=h,i()}};return i(),m.addEventListener("scroll",p),()=>m.removeEventListener("scroll",p)}},[a.viewport,d,i]),s.jsx(se.div,{"data-state":l.hasThumb?"visible":"hidden",...n,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...o},onPointerDownCapture:Y(e.onPointerDownCapture,m=>{const h=m.target.getBoundingClientRect(),x=m.clientX-h.left,y=m.clientY-h.top;l.onThumbPointerDown({x,y})}),onPointerUp:Y(e.onPointerUp,l.onThumbPointerUp)})});xt.displayName=me;var De="ScrollAreaCorner",bt=f.forwardRef((e,t)=>{const r=M(De,e.__scopeScrollArea),o=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&o?s.jsx(yn,{...e,ref:t}):null});bt.displayName=De;var yn=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,...o}=e,n=M(De,r),[a,l]=f.useState(0),[i,c]=f.useState(0),u=!!(a&&i);return q(n.scrollbarX,()=>{const d=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(d),c(d)}),q(n.scrollbarY,()=>{const d=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(d),l(d)}),u?s.jsx(se.div,{...o,ref:t,style:{width:a,height:i,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function pe(e){return e?parseInt(e,10):0}function yt(e,t){const r=e/t;return isNaN(r)?0:r}function xe(e){const t=yt(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=(e.scrollbar.size-r)*t;return Math.max(o,18)}function wn(e,t,r,o="ltr"){const n=xe(r),a=n/2,l=t||a,i=n-l,c=r.scrollbar.paddingStart+l,u=r.scrollbar.size-r.scrollbar.paddingEnd-i,d=r.content-r.viewport,m=o==="ltr"?[0,d]:[d*-1,0];return wt([c,u],m)(e)}function Ve(e,t,r="ltr"){const o=xe(t),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=t.scrollbar.size-n,l=t.content-t.viewport,i=a-o,c=r==="ltr"?[0,l]:[l*-1,0],u=un(e,c);return wt([0,l],[0,i])(u)}function wt(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const o=(t[1]-t[0])/(e[1]-e[0]);return t[0]+o*(r-e[0])}}function vt(e,t){return e>0&&e<t}var vn=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},o=0;return(function n(){const a={left:e.scrollLeft,top:e.scrollTop},l=r.left!==a.left,i=r.top!==a.top;(l||i)&&t(),r=a,o=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(o)};function be(e,t){const r=z(e),o=f.useRef(0);return f.useEffect(()=>()=>window.clearTimeout(o.current),[]),f.useCallback(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(r,t)},[r,t])}function q(e,t){const r=z(t);Bt(()=>{let o=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(o),o=window.requestAnimationFrame(r)});return n.observe(e),()=>{window.cancelAnimationFrame(o),n.unobserve(e)}}},[e,r])}var St=dt,Sn=mt,jn=bt;const Nn=f.forwardRef(({className:e,children:t,...r},o)=>s.jsxs(St,{ref:o,className:Ee("relative overflow-hidden",e),...r,children:[s.jsx(Sn,{className:"h-full w-full rounded-[inherit]",children:t}),s.jsx(jt,{}),s.jsx(jn,{})]}));Nn.displayName=St.displayName;const jt=f.forwardRef(({className:e,orientation:t="vertical",...r},o)=>s.jsx(Re,{ref:o,orientation:t,className:Ee("flex touch-none select-none transition-colors data-[orientation=vertical]:h-full data-[orientation=vertical]:w-2 data-[orientation=horizontal]:h-2 data-[orientation=horizontal]:w-full",e),...r,children:s.jsx(xt,{className:"relative flex-1 rounded-full bg-border"})}));jt.displayName=Re.displayName;export{L as C,nr as F,vr as M,Nn as S,mr as T,zn as a,Wn as b,On as c,$n as d,Ln as e,Un as f,ze as g,V as h,te as i,Hn as j,Ir as k,it as l,gr as m,Fn as n,In as o,Yn as p,br as q,Bn as r,Ze as s,de as t,Vn as u,Xn as v};
