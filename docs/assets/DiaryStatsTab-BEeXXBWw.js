import{c as j,k as v,l as N,s as p,v as w,j as e,R as _,L as k,M,y as R}from"./index-DyWq_Gt8.js";import{Y as D}from"./index-LadubUCe.js";import{f as U,a as A}from"./format-DMUSBM01.js";import{F as g}from"./film-clFOPZLM.js";import{S as y}from"./sparkles-Bx_Gyw2G.js";import{U as I}from"./users-D_v2v9Fg.js";import{B as S}from"./bookmark-plus-BktNhIJb.js";import{S as L}from"./star-DjoVrBLJ.js";const B=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],C=j("chart-column",B);const E=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],F=j("chart-pie",E),W=t=>{switch(t){case"rating_created":return"rating";case"review_created":return"review";case"watchlist_added":return"watchlist";case"follow_created":return"follow";default:return"other"}},$=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,f=t=>typeof t=="string"&&$.test(t),m=t=>typeof t=="string"?t:void 0,b=t=>typeof t=="number"&&Number.isFinite(t)?t:void 0,q=(t,l)=>{if(!l||typeof l!="object")return null;const a=l;switch(t){case"rating_created":{const d=b(a.rating);return d===void 0?null:{event_type:t,rating:d,headline:m(a.headline),emoji:m(a.emoji)}}case"review_created":return{event_type:t,rating:b(a.rating),review_snippet:m(a.review_snippet),headline:m(a.headline),emoji:m(a.emoji)};case"watchlist_added":case"watchlist_removed":return{event_type:t,extra:m(a.extra)};case"follow_created":return{event_type:t,extra:m(a.extra)};case"comment_created":case"reply_created":return{event_type:t,extra:m(a.extra)};case"list_created":case"list_item_added":return{event_type:t,extra:m(a.extra)};case"message_sent":return{event_type:t,extra:m(a.extra)};default:return null}},T=t=>{const{user:l}=v(),a=t??l?.id??null,d=N({queryKey:["diary","timeline",a],enabled:!!a,queryFn:async()=>{if(!a)return[];const{data:o,error:x}=await p.from("activity_events").select("id, created_at, event_type, title_id, media_item_id, payload").eq("user_id",a).order("created_at",{ascending:!1}).limit(100);if(x)throw new Error(x.message);if(!o?.length)return[];const u=Array.from(new Set(o.map(s=>s.media_item_id??(f(s.title_id)?s.title_id:null)).filter(s=>!!s)));let n=new Map;if(u.length){const{data:s,error:c}=await p.from("media_items").select(`id,
             kind,
             tmdb_title,
             tmdb_name,
             tmdb_original_title,
             tmdb_original_name,
             tmdb_release_date,
             tmdb_first_air_date,
             tmdb_poster_path,
             tmdb_backdrop_path,
             tmdb_original_language,
             omdb_title,
             omdb_year,
             omdb_language,
             omdb_imdb_id,
             omdb_imdb_rating,
             omdb_rating_rotten_tomatoes,
             omdb_poster,
             omdb_rated,
             tmdb_id`).in("id",u);!c&&s?n=new Map(s.map(r=>[r.id,w(r)])):c&&console.warn("[useDiaryTimeline] Failed to load titles",c.message)}return o.map(s=>{const c=s.media_item_id??(f(s.title_id)?s.title_id:null),r=c?n.get(c)??null:null,h=W(s.event_type),i=q(s.event_type,s.payload);return{id:s.id,createdAt:s.created_at,kind:h,titleId:c??null,title:r?.title??null,year:r?.year??null,posterUrl:r?.posterUrl??r?.backdropUrl??null,rating:i?.event_type==="rating_created"?i.rating:i?.event_type==="review_created"?i.rating??null:null,reviewSnippet:i?.event_type==="review_created"?i.review_snippet??null:null,headline:i?.event_type==="rating_created"||i?.event_type==="review_created"?i.headline??null:null,extra:i?.extra??null,emoji:i?.event_type==="rating_created"||i?.event_type==="review_created"?i.emoji??null:null}})}});return{items:d.data??[],isLoading:d.isLoading,isError:d.isError,error:d.error instanceof Error?d.error.message:null}},z=t=>{switch(t.kind){case"rating":return t.rating!=null?`Rated ${t.rating.toFixed(1)}★`:"Rated";case"review":return"Wrote a review";case"watchlist":return"Updated watchlist";case"follow":return"Followed someone";default:return"Activity"}},G=t=>{switch(t){case"rating":return L;case"review":return M;case"watchlist":return S;case"follow":return I;default:return y}},Z=({userId:t,isOwnProfile:l=!1,displayName:a,username:d})=>{const{items:o,isLoading:x,isError:u,error:n}=T(t),s=a||(d?`@${d}`:"this user");return x?e.jsx("div",{className:"px-2 pb-4",children:e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((c,r)=>e.jsxs("div",{className:"flex gap-3 rounded-2xl border border-border bg-card/80 p-3 shadow-lg",children:[e.jsx("div",{className:"h-12 w-8 rounded bg-background/60"}),e.jsxs("div",{className:"flex flex-1 flex-col gap-2",children:[e.jsx("div",{className:"h-3 w-1/3 rounded bg-background/70"}),e.jsx("div",{className:"h-3 w-2/3 rounded bg-background/80"}),e.jsx("div",{className:"h-2.5 w-1/2 rounded bg-background/80"})]})]},r))})}):u?e.jsx("div",{className:"flex min-h-[40vh] items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-sm rounded-2xl border border-destructive/40 bg-destructive/5 p-4 text-center text-xs text-foreground shadow-lg",children:[e.jsxs("p",{className:"font-semibold",children:["Unable to load ",l?"your":"this profile&apos;s"," activity."]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:n??"Please try again in a moment."})]})}):o.length?e.jsx("div",{className:"px-2 pb-4",children:e.jsx(D,{style:{height:"70vh"},data:o,computeItemKey:(c,r)=>r.id,components:{List:_.forwardRef(function(r,h){return e.jsx("ol",{ref:h,className:"space-y-3",...r})})},itemContent:(c,r)=>{const h=G(r.kind),i=r.titleId?`/title/${r.titleId}`:null;return e.jsx("li",{className:"pb-1",children:e.jsxs("article",{className:"flex gap-3 rounded-2xl border border-border bg-card/80 p-3 shadow-lg",children:[e.jsx("div",{className:"relative h-16 w-11 overflow-hidden rounded bg-background/70",children:r.posterUrl?e.jsx("img",{src:r.posterUrl,alt:r.title??"",className:"h-full w-full object-cover"}):e.jsxs("div",{className:"flex h-full w-full items-center justify-center text-xs text-muted-foreground",children:[e.jsx(g,{className:"mr-1 h-3.5 w-3.5"}),"No poster"]})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1 rounded-full bg-primary/10 px-2 py-0.5 text-xs font-medium text-foreground",children:[e.jsx(h,{className:"h-3 w-3","aria-hidden":"true"}),z(r)]})}),e.jsx("span",{className:"shrink-0 text-xs text-muted-foreground",children:U(r.createdAt)})]}),e.jsx("div",{className:"min-w-0",children:i?e.jsxs(k,{to:i,className:"line-clamp-2 text-sm font-medium text-foreground hover:underline",children:[r.title??"Untitled",r.year?e.jsxs("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",r.year,")"]}):null]}):e.jsx("p",{className:"line-clamp-2 text-sm font-medium text-foreground",children:r.title??"Activity"})}),r.reviewSnippet&&e.jsxs("p",{className:"line-clamp-2 text-xs text-muted-foreground",children:["“",r.reviewSnippet,"”"]}),r.extra&&e.jsx("p",{className:"text-xs text-muted-foreground",children:r.extra})]})]})},r.id)}})}):e.jsx("div",{className:"flex min-h-[40vh] items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-sm rounded-2xl border border-border bg-card/80 p-5 text-center text-xs text-muted-foreground shadow-lg",children:[e.jsx("div",{className:"mx-auto mb-3 flex h-10 w-10 items-center justify-center rounded-2xl bg-primary/15",children:e.jsx(g,{className:"h-5 w-5 text-primary","aria-hidden":"true"})}),e.jsx("p",{className:"font-heading text-sm font-semibold text-foreground",children:l?"Your diary is waiting":`${s}'s diary is quiet`}),e.jsx("p",{className:"mt-1 text-xs",children:l?"As you rate titles, write reviews, and update your library, they’ll show up here in a cozy, chronological timeline.":"When they rate titles, share reviews, or log films, their updates will collect here for you to browse."})]})})},P=t=>{const[l,a]=t.split("-"),d=Number(l),o=Number(a);if(!d||!o)return t;const x=new Date(d,o-1,1);return A(x,{month:"short",year:"numeric"})},ee=()=>{const{stats:t,isLoading:l,isError:a,error:d}=R();if(l)return e.jsx("div",{className:"px-2 pb-4",children:e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((n,s)=>e.jsxs("div",{className:"rounded-2xl border border-border bg-card/80 p-3 shadow-lg",children:[e.jsx("div",{className:"mb-2 h-3 w-1/3 rounded bg-background/70"}),e.jsx("div",{className:"flex gap-1.5",children:Array.from({length:6}).map((c,r)=>e.jsx("div",{className:"h-10 flex-1 rounded bg-background/70"},r))})]},s))})});if(a)return e.jsx("div",{className:"flex min-h-[40vh] items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-sm rounded-2xl border border-destructive/40 bg-destructive/5 p-4 text-center text-xs text-foreground shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:"Unable to load your stats."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:d??"Please try again in a moment."})]})});if(t.totalRated===0&&t.totalWatched===0&&!t.ratingDistribution.length&&!t.topGenres.length&&!t.watchCountByMonth.length)return e.jsx("div",{className:"flex min-h-[40vh] items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-sm rounded-2xl border border-border bg-card/80 p-5 text-center text-xs text-muted-foreground shadow-lg",children:[e.jsx("div",{className:"mx-auto mb-3 flex h-10 w-10 items-center justify-center rounded-2xl bg-primary/15",children:e.jsx(y,{className:"h-5 w-5 text-primary","aria-hidden":"true"})}),e.jsx("p",{className:"font-heading text-sm font-semibold text-foreground",children:"No stats yet"}),e.jsx("p",{className:"mt-1 text-xs",children:"Once you start rating titles and marking them as watched, you'll see your rating distribution, top genres, and watch streaks here."})]})});const o=t.ratingDistribution.reduce((n,s)=>s.count>n?s.count:n,0),x=t.watchCountByMonth.reduce((n,s)=>s.count>n?s.count:n,0),u=t.topGenres.slice(0,6);return e.jsxs("div",{className:"space-y-3 px-2 pb-4",children:[e.jsxs("section",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-2xl border border-border bg-card/80 p-3 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Watched"}),e.jsx(g,{className:"h-3.5 w-3.5 text-muted-foreground","aria-hidden":"true"})]}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:t.totalWatched}),e.jsxs("p",{className:"mt-0.5 text-xs text-muted-foreground",children:["Titles marked as ",e.jsx("span",{className:"font-medium text-foreground",children:"Watched"}),"."]})]}),e.jsxs("div",{className:"rounded-2xl border border-border bg-card/80 p-3 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Rated"}),e.jsx(C,{className:"h-3.5 w-3.5 text-muted-foreground","aria-hidden":"true"})]}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:t.totalRated}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:"Ratings you've logged across movies, series, and anime."})]}),e.jsxs("div",{className:"col-span-2 rounded-2xl border border-border bg-card/80 p-3 text-xs text-muted-foreground shadow-lg sm:col-span-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Average rating"}),e.jsx(F,{className:"h-3.5 w-3.5 text-muted-foreground","aria-hidden":"true"})]}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-foreground",children:t.averageRating!=null?t.averageRating.toFixed(1):"–"}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:"Quick glance at how generous you typically are with stars."})]})]}),e.jsxs("section",{className:"rounded-2xl border border-border bg-card/80 p-3 shadow-lg",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("h2",{className:"text-xs font-semibold text-foreground",children:"Rating distribution"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["0.5 – 5.0 • ",t.totalRated," ratings"]})]}),t.ratingDistribution.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Once you start rating titles, you'll see how your scores cluster here."}):e.jsx("div",{className:"flex items-end gap-1.5",children:t.ratingDistribution.map(n=>{const s=o>0?Math.max(n.count/o*52,6):6;return e.jsxs("div",{className:"flex flex-1 flex-col items-center gap-1",children:[e.jsx("div",{className:"w-full rounded-t bg-primary/25",style:{height:s},"aria-hidden":"true"}),e.jsxs("span",{className:"text-[9px] text-muted-foreground",children:[n.rating.toFixed(1),"★"]})]},n.rating)})})]}),e.jsxs("section",{className:"rounded-2xl border border-border bg-card/80 p-3 shadow-lg",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("h2",{className:"text-xs font-semibold text-foreground",children:"Top genres"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Based on titles you've marked as watched"})]}),u.length?e.jsx("div",{className:"flex flex-wrap gap-1.5",children:u.map(n=>e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-primary/15 px-2.5 py-1 text-xs text-foreground",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:n.genre}),e.jsxs("span",{className:"text-[9px] text-muted-foreground",children:["×",n.count]})]},n.genre))}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Watch and rate a few titles to reveal your go-to genres."})]}),e.jsxs("section",{className:"rounded-2xl border border-border bg-card/80 p-3 shadow-lg",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("h2",{className:"text-xs font-semibold text-foreground",children:"Watch count over time"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Month by month, based on your library"})]}),t.watchCountByMonth.length?e.jsx("div",{className:"space-y-1.5",children:e.jsx("div",{className:"flex items-end gap-1.5",children:t.watchCountByMonth.map(n=>{const s=x>0?Math.max(n.count/x*52,6):6;return e.jsxs("div",{className:"flex flex-1 flex-col items-center gap-1",children:[e.jsx("div",{className:"w-full rounded-t bg-primary/20",style:{height:s},"aria-hidden":"true"}),e.jsx("span",{className:"text-[9px] text-muted-foreground",children:P(n.month)})]},n.month)})})}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"As you mark titles as watched, you'll see your movie-watching streaks here."})]})]})};export{C,Z as D,ee as a};
