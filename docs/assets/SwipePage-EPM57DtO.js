import{n as Ss,o as Fe,v as Ge,e as Sr,r as i,w as or,h as Ms,k as Rs,l as Is,x as Cs,y as Mr,q as mt,z as Es,t as cr,j as e,B as Ts,u as Rr,s as Qt,R as dr,b as Ir,c as yn,A as Fs,C as As}from"./index-BhYCkKJ1.js";import{M as I}from"./material-icon-DzJ3uwwf.js";import{b as Ps}from"./useDiaryLibrary-DjiZyGrD.js";import{u as Ls}from"./scroll-area-BOIyfGIP.js";import"./textarea-x-0MfePo.js";import{D as Cr,a as Er,b as Tr,c as Fr,d as Ds}from"./dialog-DKXGxth9.js";import{a as Os}from"./appUrl-BIFKGN0O.js";import{F as ur}from"./FriendAvatarStack-BsWxiBgE.js";import{V as $s}from"./VerifiedBadge-Bqpsp2OE.js";import"./conversationsCache-BwsAQT1F.js";import"./format-BXv9LLlt.js";import"./external-link-D4YkaPzQ.js";import"./plus-C69Lhyvl.js";import"./x-7msmISva.js";import"./copy-BS5PHfYr.js";import"./circle-alert-BzPyYlSk.js";import"./index-D2Ybm6Xt.js";const Ar="mn_rec_experiment_assignments_v1";function Bs(){if(typeof window>"u")return null;try{const n=window.localStorage.getItem(Ar);if(!n)return null;const r=JSON.parse(n);return r?.v!==1||typeof r.ts!="number"||typeof r.assignments!="object"?null:r}catch{return null}}function qs(n){if(!(typeof window>"u"))try{const r={v:1,ts:Date.now(),assignments:n};window.localStorage.setItem(Ar,JSON.stringify(r))}catch{}}async function zs(n,r){const a=r?.ttlMs,f=[...new Set((n??[]).map(k=>String(k).trim()).filter(Boolean))].slice(0,20);if(!f.length)return{};const v=Bs();if(v&&Date.now()-v.ts<a){const k={};for(const W of f)v.assignments?.[W]&&(k[W]=v.assignments[W]);if(Object.keys(k).length===f.length)return k}const j=(await Ss("experiment-assign",{keys:f}))?.assignments??{};if(j&&typeof j=="object"){const k={...v?.assignments??{},...j};qs(k)}return j}const Jt="movi_swipe_event_queue_v1";function Us(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const r=Math.random()*16|0;return(n==="x"?r:r&3|8).toString(16)})}function Pr(n){return typeof n!="string"?!1:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(n.trim())}function Lr(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Us()}function Ks(n){if(!n)return[];try{const r=JSON.parse(n);return Array.isArray(r)?r.filter(Boolean):[]}catch{return[]}}function Ys(n,r,a){const f=String(n??"").trim(),v=String(a??"").trim(),b=Number(r);return!f||!v||!Number.isFinite(b)||b<0?null:`${f}:${Math.trunc(b)}:${v}`}function Ws(n){if(!Array.isArray(n))return[];const r=[];for(const a of n){if(!a||typeof a!="object")continue;const f=a;if(Array.isArray(f.events)){const v=typeof f.queuedAt=="number"?f.queuedAt:Date.now(),{events:b,...j}=f;for(const k of b)!k||typeof k!="object"||r.push({...j,...k,queuedAt:v});continue}r.push(f)}for(const a of r){Pr(a.clientEventId)||(a.clientEventId=Lr());const v=String(a.dedupeKey??a.dedupe_key??"").trim()||Ys(a.recRequestId,a.position,a.mediaItemId);if(v){a.dedupeKey=v,a.dedupe_key=v;continue}(a.deckId!=null||a.recRequestId!=null||a.position!=null)&&(a.deckId=null,a.recRequestId=null,a.position=null,a.dedupeKey=null,a.dedupe_key=null)}return r.slice(-200)}function Nn(){const n=Ge(Jt),r=Ks(n),a=Ws(r);try{(a.length!==r.length||JSON.stringify(a)!==JSON.stringify(r))&&Fe(Jt,JSON.stringify(a))}catch{}return a}function $e(n){const r=Nn(),a=n;Pr(a.clientEventId)||(a.clientEventId=Lr()),r.push({...a,queuedAt:Date.now()});const f=r.slice(-200);Fe(Jt,JSON.stringify(f))}function Xs(n){if(!n.length)return;const r=new Set(n),a=Nn().filter(f=>!f.clientEventId||!r.has(f.clientEventId));Fe(Jt,JSON.stringify(a))}const Dr="mn_swipe_events_backoff_v1";function Or(){try{const n=Ge(Dr);if(!n)return{failCount:0,nextAt:0,updatedAt:0};const r=JSON.parse(n);return{failCount:Number(r.failCount??0)||0,nextAt:Number(r.nextAt??0)||0,updatedAt:Number(r.updatedAt??0)||0}}catch{return{failCount:0,nextAt:0,updatedAt:0}}}function $r(n){try{Fe(Dr,JSON.stringify(n))}catch{}}function mr(){$r({failCount:0,nextAt:0,updatedAt:Date.now()})}function dt(){const n=Or(),r=Math.min(10,Math.max(0,n.failCount)+1),v=Math.min(6e4,1e3*2**(r-1)),b=Math.floor(Math.random()*v),j=Math.max(250,b);$r({failCount:r,nextAt:Date.now()+j,updatedAt:Date.now()})}function fr(){const n=Or(),r=Date.now();return!n.nextAt||n.nextAt<=r?0:n.nextAt-r}function Hs(n){return"combined"}function Gs(n){if(!n)return null;const r=n.replace("-","_");return r==="for_you"?"for-you":r==="friends"?"from-friends":r==="trending"?"trending":r==="popular"?"popular":r==="explore"?"explore":r==="combined"?"combined":null}function pr(n){return n==="like"?"like":n==="dislike"?"dislike":"skip"}function Be(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Es()}function Vs(n){const r=typeof n.posterUrl=="string"?n.posterUrl.trim():"",a=(r&&r.toLowerCase()!=="n/a"?r:"")||(n.tmdbPosterPath?cr(n.tmdbPosterPath,"w500")??"":"")||(n.tmdbBackdropPath?cr(n.tmdbBackdropPath,"w780")??"":"");if(!a)return null;const f=(n.title??"").trim()||"Untitled";return{...n,posterUrl:a,title:f}}function Qs(n,r){if(typeof window>"u"||r<=0||navigator.connection?.saveData)return;const v=window.requestIdleCallback??(j=>window.setTimeout(j,300)),b=n.slice(0,r);v(()=>{for(const j of b){if(!j.posterUrl)continue;const k=new Image;k.decoding="async",k.loading="lazy",k.src=j.posterUrl}})}function Js(n,r){const a=r?.limit??60,f=r?.prefetchImages??6,v=r?.dwellThresholdMs??1200,b=r?.dwellDebounceMs??8e3,j=r?.invalidateHomeQueries??!1,k=Sr(),W=i.useRef([]),re=i.useRef(null),q=i.useRef(null),P=i.useRef(null),V=i.useRef(new Map);i.useEffect(()=>{let c=!1;const d=async()=>{if(c)return;const N=fr();if(N>0){q.current==null&&(q.current=window.setTimeout(()=>{q.current=null,d()},Math.min(N+50,65e3)));return}const R=Nn();if(!R.length)return;const Q=[],p=25;for(let K=0;K<R.length;K+=p){if(c)return;const ke=R.slice(K,K+p);try{const Ne=ke.map(S=>({sessionId:S.sessionId,deckId:S.deckId??null,recRequestId:S.recRequestId??null,position:S.position??null,dedupeKey:S.dedupeKey??S.dedupe_key??null,mediaItemId:S.mediaItemId,source:S.source??null,events:[{eventType:S.eventType,dwellMs:S.dwellMs??null,rating0_10:S.rating0_10??null,inWatchlist:S.inWatchlist??null,clientEventId:S.clientEventId??null,payload:S.payload??null}]})),J=await or(Ne);if(J.ok){const S=[...J.acceptedClientEventIds??[],...J.rejectedClientEventIds??[]].filter(Boolean);if(S.length&&Q.push(...S),J.shouldRetry){dt();break}mr()}else{dt();break}}catch{dt();break}}Q.length&&Xs(Q)};d();const g=()=>{d()};return window.addEventListener("online",g),()=>{c=!0,window.removeEventListener("online",g)}},[]);const B=i.useRef({}),fe=i.useCallback(async c=>{const d=fr();if(d>0){P.current==null&&(P.current=window.setTimeout(()=>{P.current=null,fe(c)},Math.min(d+50,65e3)));return}const g=W.current;if(!g.length)return;const R=c?g.splice(0,g.length):g.splice(0,Math.min(25,g.length));for(const p of R)p.clientEventId||(p.clientEventId=Be()),V.current.set(p.clientEventId,p);const Q=R.map(p=>({sessionId:p.sessionId,deckId:p.deckId??null,recRequestId:p.recRequestId??null,position:p.position??null,dedupeKey:p.dedupeKey??p.dedupe_key??null,mediaItemId:p.mediaItemId,source:p.source??null,events:[{eventType:p.eventType,dwellMs:p.dwellMs??null,rating0_10:p.rating0_10??null,inWatchlist:p.inWatchlist??null,clientEventId:p.clientEventId??null,payload:p.payload??null}]}));try{const p=await or(Q);if(p.ok){const K=new Set(p.acceptedClientEventIds??[]),ke=new Set(p.rejectedClientEventIds??[]),Ne=new Set(p.retryClientEventIds??[]);for(const J of R){const S=J.clientEventId;if(!S){$e(J);continue}if(Ne.has(S)){$e(J);continue}K.has(S)||ke.has(S)||$e(J)}}else{dt();for(const K of R)$e(K)}p.ok&&p.shouldRetry&&dt(),p.ok&&!p.shouldRetry&&mr();for(const K of R)K.clientEventId&&V.current.delete(K.clientEventId)}catch{dt();for(const p of R)$e(p);for(const p of R)p.clientEventId&&V.current.delete(p.clientEventId)}},[]),oe=i.useCallback(c=>{if(c.clientEventId||(c.clientEventId=Be()),W.current.push(c),W.current.length>=25){fe();return}re.current==null&&(re.current=window.setTimeout(()=>{re.current=null,fe()},1e3))},[fe]),te=i.useCallback(c=>{if(Array.isArray(c?.events)){const{events:d,...g}=c,N=typeof g.payload=="object"&&g.payload?g.payload:null;for(const R of d){if(!R)continue;const Q=typeof R?.payload=="object"&&R.payload?R.payload:null;oe({...g,...R,payload:N||Q?{...N??{},...Q??{}}:null,clientEventId:R?.clientEventId??null})}return}oe(c)},[oe]),Ve=i.useCallback(()=>{re.current!=null&&(window.clearTimeout(re.current),re.current=null);const c=W.current;if(c.length){const g=c.splice(0,c.length);for(const N of g)$e(N)}const d=V.current;if(d.size){for(const g of d.values())$e(g);d.clear()}},[]);i.useEffect(()=>{const c=()=>Ve(),d=()=>Ve();return window.addEventListener("pagehide",c),window.addEventListener("beforeunload",d),()=>{window.removeEventListener("pagehide",c),window.removeEventListener("beforeunload",d),Ve()}},[Ve]),i.useEffect(()=>{const c=()=>{document.visibilityState==="hidden"&&fe(!0)};return document.addEventListener("visibilitychange",c),()=>document.removeEventListener("visibilitychange",c)},[fe]);const z=i.useMemo(()=>Ms(),[]),je=i.useMemo(()=>Hs(),[n]);i.useEffect(()=>{let c=!1;return(async()=>{try{const d=await zs(["swipe_pipeline_v1","swipe_rerank_v1","swipe_diversity_v1","swipe_mix_v1","swipe_cf_v1","swipe_blend_v1"],{ttlMs:216e5});c||(B.current=d)}catch{}})(),()=>{c=!0}},[]);const ft=i.useRef(new Set),ze=i.useRef(!1),Qe=i.useRef(0),pt=i.useRef(null),Ae=i.useRef(new Set),Je=i.useRef(new Map),[D,Tt]=i.useState({status:"idle",cards:[],errorMessage:null}),[Se,ne]=i.useState(null),X=i.useCallback(c=>{Tt(d=>typeof c=="function"?c(d):c)},[]),_=i.useCallback(c=>{if(!c.length)return 0;const d=ft.current,g=[];for(const N of c){if(d.has(N.id))continue;const R=Vs(N);d.add(N.id),R&&g.push(R)}return g.length?(X(N=>{const R={...N,status:"ready",cards:[...N.cards,...g],errorMessage:null};return Qs(g,f),R}),g.length):0},[f,X]),o=i.useCallback(async(c=a)=>{if(!ze.current){ze.current=!0,X(d=>({...d,status:d.cards.length?"ready":"loading",errorMessage:null}));try{const d=r?.kindFilter??null,g=r?.seed??Rs(z,je,d);pt.current!==g&&(pt.current=g,Qe.current=0);const N=3;let R=0,Q=0;for(;R<N&&Q===0;){const p=`${g}:${Qe.current}`;Qe.current+=1;const K=await Is({sessionId:z,mode:je,kindFilter:d??void 0,limit:c,seed:p,minImdbRating:r?.minImdbRating??null,genresAny:r?.genresAny??null,experiments:Object.keys(B.current??{}).length?B.current:null},{timeoutMs:25e3}),ke=K.deckId,Ne=K.recRequestId??null,J=(K.cards??[]).map((S,tn)=>({...S,id:S.mediaItemId,deckId:ke,recRequestId:Ne,position:typeof S.position=="number"?S.position:tn,dedupeKey:S.dedupeKey??S.dedupe_key??null,source:Gs(S.source??n)}));if(!J.length){X(S=>({...S,status:S.cards.length?"ready":"exhausted",errorMessage:null}));return}if(Q=_(J),Q>0)break;R+=1,console.warn("[useMediaSwipeDeck] filtered out all cards (missing OMDb poster?). Retrying...",{attempt:R,mode:je,kind:n,batchSize:c})}Q===0&&X(p=>({...p,status:p.cards.length?"ready":"exhausted",errorMessage:null}))}catch(d){const g=d instanceof Error?d.message:typeof d=="string"?d:"We couldn't load swipe cards.";X(N=>({...N,status:"error",errorMessage:g}))}finally{ze.current=!1}}},[_,a,je,r?.kindFilter,r?.minImdbRating,JSON.stringify(r?.genresAny??[]),r?.seed,z,X]);i.useEffect(()=>{ft.current=new Set,Ae.current=new Set,Je.current=new Map,ze.current=!1,X({status:"loading",cards:[],errorMessage:null}),o(a)},[o,n,a,r?.kindFilter,r?.minImdbRating,JSON.stringify(r?.genresAny??[]),X]);const pe=i.useCallback(()=>{r?.seed==null&&Cs(z,je,r?.kindFilter??null),Qe.current=0,ft.current=new Set,Ae.current=new Set,Je.current=new Map,ze.current=!1,X({status:"loading",cards:[],errorMessage:null}),o(a)},[o,a,je,r?.kindFilter,r?.minImdbRating,JSON.stringify(r?.genresAny??[]),r?.seed,z,X]),Ft=i.useCallback(c=>{c<=0||X(d=>({...d,cards:d.cards.slice(Math.min(c,d.cards.length))}))},[X]),U=Mr({mutationFn:async c=>(te(c),{ok:!0}),onError:(c,d)=>{const g=c instanceof Error?c.message:typeof c=="string"?c:"We couldn't save that action.";$e(d),ne({payload:d,message:g})},onSuccess:()=>{ne(null),j&&(k.invalidateQueries({queryKey:mt.homeFeed(null)}),k.invalidateQueries({queryKey:mt.homeForYou(null)}))}}),Zt=i.useCallback((c,d)=>{if(!c)return;const g=`${c.deckId}:${c.id}`;Ae.current.has(g)||(Ae.current.add(g),U.mutate({sessionId:z,deckId:c.deckId,recRequestId:c.recRequestId??null,position:d??c.position,dedupeKey:c.dedupeKey??null,mediaItemId:c.id,eventType:"impression",source:c.source??null,clientEventId:Be(),payload:(()=>{const N={};Object.keys(B.current).length&&(N.experiments=B.current);const R=typeof c.why=="string"?c.why.trim():"";return R&&(N.why=R),Object.keys(N).length?N:null})()}))},[U,z]),Ze=i.useCallback((c,d,g)=>{if(!c||!Number.isFinite(d)||d<v)return;const N=`${c.deckId}:${c.id}`,R=Date.now(),Q=Je.current.get(N)??0;R-Q<b||(Je.current.set(N,R),U.mutate({sessionId:z,deckId:c.deckId,recRequestId:c.recRequestId??null,position:g??c.position,dedupeKey:c.dedupeKey??null,mediaItemId:c.id,eventType:"dwell",dwellMs:Math.round(d),source:c.source??null,clientEventId:Be(),payload:(()=>{const p={};Object.keys(B.current).length&&(p.experiments=B.current);const K=typeof c.why=="string"?c.why.trim():"";return K&&(p.why=K),Object.keys(p).length?p:null})()}))},[b,v,U,z]),At=i.useCallback(c=>{const d=c.card,g=c.action??null,N={};g&&(N.action=g),U.mutate({sessionId:z,deckId:d.deckId,recRequestId:d.recRequestId??null,position:d.position,dedupeKey:d.dedupeKey??null,mediaItemId:d.id,eventType:pr(c.direction),source:d.source??null,clientEventId:Be(),payload:Object.keys(B.current).length||Object.keys(N).length?{...N,...Object.keys(B.current).length?{experiments:B.current}:{}}:null})},[U,z]),en=i.useCallback(async c=>{const d=c.card,g=c.action??null,N={};return g&&(N.action=g),U.mutateAsync({sessionId:z,deckId:d.deckId,recRequestId:d.recRequestId??null,position:d.position,dedupeKey:d.dedupeKey??null,mediaItemId:d.id,eventType:pr(c.direction),source:d.source??null,clientEventId:Be(),payload:Object.keys(B.current).length||Object.keys(N).length?{...N,...Object.keys(B.current).length?{experiments:B.current}:{}}:null})},[U,z]),Pt=i.useCallback(c=>{const d={...c,sessionId:c.sessionId??z,clientEventId:c.clientEventId??Be()},g=Object.keys(B.current).length?{...d,payload:{...typeof d.payload=="object"&&d.payload?d.payload:{},experiments:B.current}}:d;U.mutate(g)},[U,z]),xt=i.useCallback(async c=>{const d={...c,sessionId:c.sessionId??z,clientEventId:c.clientEventId??Be()},g=Object.keys(B.current).length?{...d,payload:{...typeof d.payload=="object"&&d.payload?d.payload:{},experiments:B.current}}:d;try{await U.mutateAsync(g)}catch{}},[U,z]);return{sessionId:z,mode:je,cards:D.cards,status:D.status,isLoading:D.status==="loading",isError:D.status==="error",isExhausted:D.status==="exhausted",deckError:D.errorMessage??null,fetchMore:o,refresh:pe,trimConsumed:Ft,trackImpression:Zt,trackDwell:Ze,sendEvent:Pt,sendEventAsync:xt,swipe:At,swipeAsync:en,swipeSyncError:Se?.message??null,retryFailedSwipe:()=>{Se&&U.mutate(Se.payload)},isRetryingSwipe:U.isPending&&!!Se}}const h=(n,r,a)=>Math.min(a,Math.max(r,n)),ce=n=>{if(!n)return null;const r=n.trim();return!r||r.toUpperCase()==="N/A"?null:r},xr=n=>{if(!n||n<=0)return null;const r=Math.floor(n/60),a=n%60;return r===0?`${a}m`:a===0?`${r}h`:`${r}h ${a}m`},Zs=n=>{const r=ce(n);if(!r)return null;const a=r.toLowerCase();return a==="united states"||a==="united states of america"?"US":a==="united kingdom"||a==="great britain"?"UK":a==="canada"?"CA":a==="australia"?"AU":a==="germany"?"DE":a==="france"?"FR":a==="spain"?"ES":a==="italy"?"IT":a==="japan"?"JP":a==="south korea"||a==="republic of korea"?"KR":r.length<=3?r.toUpperCase():r},ie=n=>{if(n==null)return null;if(typeof n=="number")return Number.isNaN(n)?null:n;const r=parseFloat(n);return Number.isNaN(r)?null:r},hr=n=>{const r=ie(n);return r==null?null:Math.round(r).toLocaleString()},Vt=n=>{if(!n)return;const r=[];n.year&&r.push(String(n.year));const a=[];typeof n.imdbRating=="number"&&!Number.isNaN(n.imdbRating)&&a.push(`IMDb ${n.imdbRating.toFixed(1)}`),typeof n.rtTomatoMeter=="number"&&!Number.isNaN(n.rtTomatoMeter)&&a.push(`${n.rtTomatoMeter}% Rotten Tomatoes`);const f=[...r,...a].filter(Boolean).join(" · ");return f?`${n.title} (${f})`:n.title},ei=({message:n,onRetry:r,isRetrying:a})=>n?e.jsx("div",{className:"mx-3 mb-3 rounded-md border border-amber-500/60 bg-amber-500/10 px-3 py-2 text-xs text-amber-50",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{name:"error",className:"mt-0.5 text-[18px]",ariaLabel:"Error"}),e.jsxs("div",{className:"flex flex-1 flex-col gap-1",children:[e.jsx("p",{className:"leading-snug",children:n}),e.jsxs(Ts,{type:"button",variant:"outline",size:"sm",onClick:r,disabled:a,children:[e.jsx(I,{name:"refresh",className:"text-[18px]",ariaLabel:"Retry"}),a?"Retrying…":"Retry"]})]})]})}):null,ti="mn_swipe_last_ingest_v1",ni="mn_swipe_events_backoff_v1";function br(n){try{const r=Ge(n);return r?JSON.parse(r):null}catch{return null}}const ri=({active:n})=>{const[r,a]=i.useState(0);return i.useEffect(()=>{const f=window.setInterval(()=>a(v=>v+1),1e3);return()=>window.clearInterval(f)},[]),i.useMemo(()=>br(ti),[r]),i.useMemo(()=>br(ni),[r]),null},vn=({title:n})=>e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-background via-card to-background text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-card/70 shadow-md",children:e.jsx(I,{name:"image_not_supported",className:"text-[24px] text-muted-foreground"})}),e.jsx("span",{className:"text-[12px] font-semibold",children:"Artwork unavailable"}),n&&e.jsxs("span",{className:"max-w-[240px] truncate text-xs text-muted-foreground/80",children:["for ",n]})]})});function si(n){const r=n.trim().split(/\s+/).filter(Boolean);if(!r.length)return"?";const a=r[0]?.[0]??"?",f=r.length>1?r[r.length-1]?.[0]??"":"";return(a+f).toUpperCase()}function ii({open:n,onOpenChange:r,profiles:a,verb:f}){const v=Rr(),b=Array.isArray(a)?a.filter(Boolean):[],j=i.useMemo(()=>b.map(q=>q.id).filter(Boolean),[b]),[k,W]=i.useState({});i.useEffect(()=>{let q=!1;async function P(){if(!n||j.length===0)return;const{data:V,error:B}=await Qt.from("profiles_public").select("id,is_verified,verified_type,verified_label,verified_at,verified_by_org").in("id",j);if(q||B)return;const fe={},oe=V??[];for(const te of oe)te?.id&&(fe[te.id]={is_verified:te.is_verified??null,verified_type:te.verified_type??null,verified_label:te.verified_label??null,verified_at:te.verified_at??null,verified_by_org:te.verified_by_org??null});W(fe)}return P(),()=>{q=!0}},[n,j.join("|")]);const re=b.length?`Friends who ${f}`:`No friends ${f} yet`;return e.jsx(Cr,{open:n,onOpenChange:r,children:e.jsxs(Er,{className:"max-w-md border border-border/60 bg-card text-foreground",children:[e.jsx(Tr,{children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx(Fr,{className:"text-base font-semibold text-foreground",children:re}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"-mr-2 icon-hit border border-border/60 bg-background/60 hover:bg-background/80","aria-label":"Close","data-swipe-interactive":"true",children:e.jsx(I,{name:"close",className:"text-[22px]"})})]})}),b.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Once friends interact with titles, they’ll show up here."}):e.jsx("div",{className:"mt-2 max-h-[60vh] overflow-y-auto pr-1",children:e.jsx("div",{className:"space-y-2",children:b.map(q=>{const P=(q.display_name??q.username??"Friend").trim()||"Friend",V=(q.username??"").trim(),B=si(P);return e.jsxs("button",{type:"button",className:"flex w-full items-center gap-3 rounded-2xl border border-border/60 bg-background/40 px-3 py-2.5 text-left transition hover:bg-background/70",onClick:()=>{V&&(r(!1),v(`/u/${V}`))},"aria-label":V?`Open ${P} profile`:P,"data-swipe-interactive":"true",children:[e.jsx("div",{className:"h-10 w-10 overflow-hidden rounded-full border border-border/60 bg-muted",children:q.avatar_url?e.jsx("img",{src:q.avatar_url,alt:P,className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"grid h-full w-full place-items-center text-xs font-semibold text-foreground/80",children:B})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-1",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:P}),e.jsx($s,{isVerified:k[q.id]?.is_verified,type:k[q.id]?.verified_type,label:k[q.id]?.verified_label,verifiedAt:k[q.id]?.verified_at,org:k[q.id]?.verified_by_org,className:"shrink-0 rounded-full p-0.5 text-primary/90 hover:text-primary"})]}),V?e.jsxs("div",{className:"truncate text-xs text-muted-foreground",children:["@",V]}):e.jsx("div",{className:"truncate text-xs text-muted-foreground",children:"Profile unavailable"})]}),e.jsx("div",{className:"grid h-9 w-9 place-items-center rounded-full border border-border/60 bg-background/60 text-muted-foreground",children:e.jsx(I,{name:"chevron_right",className:"text-[22px]"})})]},q.id)})})})]})})}const It="mn_swipe_onboarding_seen",wr="mn_swipe_sfx_enabled",gr="mn_swipe_haptics_enabled",ai={floaty_gamey:{distanceWidthFactor:.22,distanceMin:86,distanceMax:140,intentFactor:.35,intentMin:30,intentMax:52,velocityThreshold:.55,velocityProjectionMs:220,dragFollowAlpha:.22,rotationFactor:15,rotateZCap:18,rotateYCap:14,rotateXCap:7,undercardTranslateY:8,undercardBlurMax:1.4,punchScale:1.015,punchDurationMs:140,burstBaseCount:12,burstDurationMs:520}},G=ai.floaty_gamey,li=88,Et=(n,r=1)=>{const a=typeof n=="number"&&Number.isFinite(n)&&n>0?n:typeof window<"u"?window.innerWidth:li;return h(a*G.distanceWidthFactor*r,G.distanceMin,G.distanceMax)},yr=(n,r=1)=>h(Math.round(Et(n,r)*G.intentFactor),G.intentMin,G.intentMax),oi=(n,r)=>{const a=Math.abs(n);if(a<=r)return n;const f=a-r;return Math.sign(n)*(r+f*.18)},jn=8,ci=1.25,di=1.6,ui=.25,vr=120,kn=14,mi=70,jr=G.velocityThreshold,Ct=220,fi=360,kr=G.rotationFactor,pi=`
@keyframes mn-swipe-burst {
  0% { transform: translate3d(0px,0px,0px) rotate(0deg) scale(1); opacity: 0.95; }
  100% { transform: translate3d(var(--dx, 0px), var(--dy, 0px), 0px) rotate(var(--rot, 0deg)) scale(var(--s, 1)); opacity: 0; }
}
.mn-swipe-burst-dot {
  position: absolute;
  left: var(--x, 0px);
  top: var(--y, 0px);
  width: var(--sz, 8px);
  height: var(--sz, 8px);
  border-radius: 9999px;
  filter: blur(0px);
  will-change: transform, opacity;
  animation: mn-swipe-burst var(--dur, 520ms) cubic-bezier(0.18, 0.78, 0.22, 1) forwards;
}
.mn-swipe-burst-dot[data-shape="square"] { border-radius: 6px; }
@media (prefers-reduced-motion: reduce) {
  .mn-swipe-burst-dot { animation: none !important; opacity: 0 !important; }
}
`,xi={"--mn-swipe-radius":"clamp(26px, min(6vw, 4.2vh), 44px)","--mn-swipe-pad":"clamp(12px, min(4.6vw, 3.2vh), 24px)","--mn-swipe-kicker":"clamp(10px, min(2.5vw, 1.45vh), 12px)","--mn-swipe-header":"clamp(1.05rem, min(4.2vw, 2.6vh), 1.35rem)","--mn-swipe-top-hit":"clamp(2.25rem, min(9vw, 5.2vh), 2.9rem)","--mn-swipe-top-icon":"clamp(22px, min(5.6vw, 3.2vh), 30px)","--mn-swipe-title":"clamp(1.6rem, min(6.6vw, 4.4vh), 2.6rem)","--mn-swipe-subtitle":"clamp(0.92rem, min(3.6vw, 2.2vh), 1.15rem)","--mn-swipe-meta":"clamp(0.88rem, min(3.2vw, 2.0vh), 1.08rem)","--mn-swipe-chip":"clamp(0.72rem, min(2.9vw, 1.75vh), 0.9rem)","--mn-swipe-hit":"clamp(2.25rem, min(9vw, 5.5vh), 2.85rem)","--mn-swipe-gap":"clamp(1.35rem, min(6.2vw, 3.7vh), 2.5rem)","--mn-swipe-action":"clamp(3.1rem, min(12.5vw, 7.0vh), 4.1rem)","--mn-swipe-action-primary":"clamp(4.4rem, min(17.5vw, 9.2vh), 6.1rem)","--mn-swipe-icon":"clamp(22px, min(5.5vw, 3.4vh), 30px)","--mn-swipe-icon-primary":"clamp(32px, min(8.5vw, 4.8vh), 46px)","--mn-swipe-star-hit":"clamp(18px, min(5vw, 2.8vh), 24px)","--mn-swipe-star-icon":"clamp(14px, min(3.8vw, 2.1vh), 19px)"},Br=n=>{if(n==null)return null;const r=String(n).trim();if(!r)return null;const a=r.replace(/%/g,""),f=Number(a);return Number.isFinite(f)?f:null},hi=n=>{if(n==null)return null;const r=Math.round(n);return r<=0?null:Math.min(10,Math.max(2,r*2))},bi=n=>{const r=(()=>{const b=String(n?.source??"").trim();if(!b)return null;const j=b.replace("-","_");return j==="for_you"||j==="for-you"?"for-you":j==="friends"||j==="from_friends"||j==="from-friends"?"from-friends":j==="trending"?"trending":j==="popular"?"popular":j==="combined"?"combined":j==="explore"?"explore":null})(),a=n?.kind==="series"?"series":n?.kind==="anime"?"anime":"movie",f=typeof n?.releaseYear=="number"?n.releaseYear:n?.releaseYear!=null?Number(n.releaseYear):null,v=typeof n?.runtimeMinutes=="number"?n.runtimeMinutes:n?.runtimeMinutes!=null?Number(n.runtimeMinutes):null;return{id:String(n?.id??""),title:String(n?.title??"Untitled"),deckId:n?.deckId??null,position:typeof n?.position=="number"?n.position:n?.position!=null?Number(n.position):null,year:Number.isFinite(f)?f:null,type:a,runtimeMinutes:Number.isFinite(v)?v:null,tagline:n?.tagline??null,mood:n?.mood??null,vibeTag:n?.vibeTag??null,posterUrl:n?.posterUrl??null,tmdbPosterPath:n?.tmdbPosterPath??null,tmdbBackdropPath:n?.tmdbBackdropPath??null,source:r,why:n?.why??null,friendIds:Array.isArray(n?.friendIds)?n.friendIds:null,friendProfiles:Array.isArray(n?.friendProfiles)?n.friendProfiles:null,friendLikesCount:typeof n?.friendLikesCount=="number"?n.friendLikesCount:Array.isArray(n?.friendProfiles)?n.friendProfiles.length:Array.isArray(n?.friendIds)?n.friendIds.length:null,topFriendName:Array.isArray(n?.friendProfiles)&&n.friendProfiles[0]?String(n.friendProfiles[0].display_name??n.friendProfiles[0].username??""):n?.topFriendName??null,topFriendInitials:n?.topFriendInitials??null,topFriendReviewSnippet:n?.topFriendReviewSnippet??null,overview:n?.overview??null,genres:Array.isArray(n?.genres)?n.genres:null,language:n?.language??null,country:n?.country??null,initialRating:typeof n?.initialRating=="number"?n.initialRating:n?.initialRating!=null?Number(n.initialRating):null,initiallyInWatchlist:!!n?.initiallyInWatchlist,imdbRating:typeof n?.imdbRating=="number"?n.imdbRating:n?.imdbRating!=null?Number(n.imdbRating):null,rtTomatoMeter:typeof n?.rtTomatoMeter=="number"?n.rtTomatoMeter:n?.rtTomatoMeter!=null?Number(n.rtTomatoMeter):null}};function Nr(n){const{card:r,friendCount:a,imdb:f,rt:v}=n;let b=74;const j=r?.source??null;j==="for-you"&&(b+=10),j==="from-friends"&&(b+=7),j==="trending"&&(b+=4),j==="popular"&&(b+=2);const k=typeof r?.friendLikesCount=="number"?r.friendLikesCount:0;if(k>0){const re=a>0?k/Math.max(1,a)*18:Math.min(12,k*3);b+=re}f!=null&&(b+=(f-7)*4),v!=null&&(b+=(v-70)*.15),r?.why&&(b+=3);const W=Math.round(b);return Math.round(h(W,55,99))}const _r=async n=>{const{data:r,error:a}=await Qt.from("media_items").select("id, kind, omdb_plot, omdb_director, omdb_writer, omdb_actors, omdb_genre, omdb_language, omdb_country, omdb_imdb_rating, omdb_imdb_votes, omdb_metascore, omdb_rating_rotten_tomatoes, omdb_poster, omdb_awards, omdb_box_office, omdb_released, omdb_rated, omdb_runtime, omdb_fetched_at, omdb_status, omdb_error").eq("id",n).maybeSingle();if(a)throw a;if(!r)return null;const f=r.omdb_genre!=null?String(r.omdb_genre).split(",").map(b=>b.trim()).filter(Boolean):null,v=Br(r.omdb_rating_rotten_tomatoes);return{title_id:r.id,content_type:r.kind??null,plot:r.omdb_plot??null,omdb_director:r.omdb_director??null,omdb_writer:r.omdb_writer??null,omdb_actors:r.omdb_actors??null,genres:f,omdb_language:r.omdb_language??null,omdb_country:r.omdb_country??null,imdb_rating:r.omdb_imdb_rating??null,imdb_votes:r.omdb_imdb_votes??null,metascore:r.omdb_metascore??null,rt_tomato_pct:v,poster_url:r.omdb_poster??null,omdb_awards:r.omdb_awards??null,omdb_box_office_str:r.omdb_box_office??null,omdb_box_office:null,omdb_released:r.omdb_released??null,omdb_rated:r.omdb_rated??null,omdb_runtime:r.omdb_runtime??null,omdb_fetched_at:r.omdb_fetched_at??null,omdb_status:r.omdb_status??null,omdb_error:r.omdb_error??null}},qe="want_to_watch",ut="watched",zi=()=>{const n=Rr(),[r,a]=i.useState(null),[f,v]=i.useState(!1),[b,j]=i.useState([]),[k,W]=i.useState(0),[re,q]=i.useState({w:0,h:0});i.useEffect(()=>{if(typeof window>"u")return;let t=0;const s=()=>{cancelAnimationFrame(t),t=requestAnimationFrame(()=>{q({w:window.innerWidth,h:window.innerHeight})})};return s(),window.addEventListener("resize",s,{passive:!0}),window.addEventListener("orientationchange",s,{passive:!0}),()=>{cancelAnimationFrame(t),window.removeEventListener("resize",s),window.removeEventListener("orientationchange",s)}},[]);const P=i.useMemo(()=>{const t=re.h||844;return t<640?4:t<720?5:t<820?6:t<920?7:8},[re.h]),V=i.useMemo(()=>h(P+2,6,10),[P]),{cards:B,sessionId:fe,isLoading:oe,isError:te,swipe:Ve,fetchMore:z,trimConsumed:je,swipeSyncError:ft,retryFailedSwipe:ze,isRetryingSwipe:Qe,trackImpression:pt,trackDwell:Ae,sendEventAsync:Je}=Js("combined",{limit:72,kindFilter:r,minImdbRating:k>0?k:null,genresAny:b.length?b:null}),D=i.useMemo(()=>B.map(bi),[B]),Tt=i.useMemo(()=>{const t=new Set;for(const s of D){const l=s?.genres??[];for(const u of l){const m=String(u??"").trim();m&&t.add(m)}}return Array.from(t).sort((s,l)=>s.localeCompare(l))},[D]),Se=dr.useCallback(t=>{if(!t)return!1;if(b.length){const s=Array.isArray(t.genres)?t.genres:[],l=new Set(s.map(m=>String(m).toLowerCase()));if(!b.some(m=>l.has(String(m).toLowerCase())))return!1}if(k>0){const s=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)?t.imdbRating:null;if(s!=null&&s<k)return!1}return!0},[b,k]),[ne,X]=i.useState(0),_=B[ne],o=D[ne],[pe,Ft]=i.useState(!1),U=i.useRef(!1);i.useEffect(()=>{U.current=pe},[pe]);const[Zt,Ze]=i.useState(()=>typeof window>"u"?!1:!Ge(It)),[At,en]=i.useState([]),Pt=(t,s)=>{t&&en(l=>{const u=l.includes(t);return s?u?l:[...l,t]:u?l.filter(m=>m!==t):l})},xt=t=>Pt(o?.id,t),c=!!o?.id&&At.includes(o.id),d=D[ne+1]??null,g=!!d?.id&&At.includes(d.id),N=!!(d?.posterUrl&&!g);i.useEffect(()=>{if(typeof window>"u")return;const t=d?.posterUrl;if(!t)return;const s=new Image;s.decoding="async",s.src=t},[d?.posterUrl]);const[R,Q]=i.useState(!1),[p,K]=i.useState(!1),[ke,Ne]=i.useState(!1),[J,S]=i.useState(null),[tn,nn]=i.useState(!1),Pe=i.useRef(null),_n=i.useRef(new Set),[Sn,Mn]=i.useState(null),ht=i.useRef(null),[,qr]=i.useState(0),[zr,Rn]=i.useState(0),rn=i.useRef(null),sn=i.useRef(!1),[Ur,In]=i.useState(!1),de=o?.id??null,Lt=d?.id??null,{user:Me}=Ir(),bt=Sr();i.useEffect(()=>{if(typeof window>"u"||D.length===0)return;const t=window.requestIdleCallback,s=()=>{const m=Math.min(Math.max(ne+1,0),D.length),w=Math.min(D.length,m+8),x=D.slice(m,w).map(T=>{if(!T.id)return null;const Y=mt.titleDetail(T.id);return bt.getQueryData(Y)?null:bt.prefetchQuery({queryKey:Y,queryFn:()=>_r(T.id),staleTime:1e3*60*30,gcTime:1e3*60*60})});Promise.allSettled(x.filter(Boolean))};if(t){const u=t(s);return()=>{typeof window<"u"&&"cancelIdleCallback"in window&&window.cancelIdleCallback?.(u)}}const l=window.setTimeout(s,280);return()=>window.clearTimeout(l)},[D,ne,bt]);const{data:wt}=yn({queryKey:["title-preview",Lt],enabled:!!Lt,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>{if(!Lt)return null;const{data:t,error:s}=await Qt.from("media_items").select("id, omdb_director, omdb_genre, omdb_rating_rotten_tomatoes, omdb_imdb_rating").eq("id",Lt).maybeSingle();if(s)throw s;return t?{omdb_director:t.omdb_director??null,omdb_genre:t.omdb_genre??null,omdb_rating_rotten_tomatoes:t.omdb_rating_rotten_tomatoes??null,omdb_imdb_rating:t.omdb_imdb_rating??null}:null}}),Cn=ce(wt?.omdb_director),Kr=Br(wt?.omdb_rating_rotten_tomatoes),Yr=ie(wt?.omdb_imdb_rating),{data:Ue=0}=yn({queryKey:["friendCount",{userId:Me?.id??null}],enabled:!!Me?.id,staleTime:1e3*60*10,gcTime:1e3*60*30,refetchOnWindowFocus:!1,queryFn:async()=>{if(!Me?.id)return 0;const{count:t,error:s}=await Qt.from("follows").select("followed_id",{count:"exact",head:!0}).eq("follower_id",Me.id);if(s)throw s;return t??0}}),En=Ps(de),Tn=En.data?.status??null,Fn=En.data?.rating??null,[Wr,Dt]=i.useState(null),[Xr,An]=i.useState(null),an={status:Wr??Tn},Ot=Mr({mutationFn:async t=>{if(!Me?.id||!_)return;const s={sessionId:fe,deckId:_.deckId??null,recRequestId:_.recRequestId??null,dedupeKey:_.dedupeKey??_.dedupe_key??null,position:_.position??null,mediaItemId:_.id,source:_.source??null,events:[]},l=[];if(t.status!==void 0)if(t.statusKind==="watched"){const u=t.status===ut;l.push({eventType:"like",payload:{ui:"SwipePage",action:"status",status:"watched",enabled:u}})}else{const u=t.status===qe;l.push({eventType:"watchlist",inWatchlist:u,payload:{ui:"SwipePage",action:"status",status:"watchlist",enabled:u}})}t.ratingStars!==void 0&&l.push({eventType:"rating",rating0_10:hi(t.ratingStars),payload:{ui:"SwipePage",action:"rating"}}),l.length&&(s.events=l,await Je(s))},onSuccess:()=>{Me?.id&&de&&(bt.invalidateQueries({queryKey:mt.titleDiary(Me.id,de)}),bt.invalidateQueries({queryKey:mt.diaryLibrary(Me.id)}))}}),gt=i.useRef(null),Pn=i.useRef(null),$t=i.useRef(!1),[Hr,Gr]=i.useState(!1),[et,Ln]=i.useState(!0),[tt,Dn]=i.useState(!0),Bt=i.useRef(!0),qt=i.useRef(!0),On=i.useRef(0);i.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const t=window.matchMedia("(prefers-reduced-motion: reduce)"),s=()=>{$t.current=t.matches,Gr(t.matches)};return s(),typeof t.addEventListener=="function"?t.addEventListener("change",s):t.addListener?.(s),()=>{typeof t.removeEventListener=="function"?t.removeEventListener("change",s):t.removeListener?.(s)}},[]),i.useEffect(()=>{if(!(typeof window>"u"))try{const t=Ge(wr),s=Ge(gr),l=t==null?!0:t==="1",u=s==null?!0:s==="1";Ln(l),Dn(u),Bt.current=l,qt.current=u}catch{}},[]),i.useEffect(()=>{if(Bt.current=et,!(typeof window>"u"))try{Fe(wr,et?"1":"0")}catch{}},[et]),i.useEffect(()=>{if(qt.current=tt,!(typeof window>"u"))try{Fe(gr,tt?"1":"0")}catch{}},[tt]);const nt=i.useRef({x:0,y:0});i.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const t=window.matchMedia("(pointer: coarse)"),s=()=>{st.current=t.matches};return s(),typeof t.addEventListener=="function"?t.addEventListener("change",s):t.addListener?.(s),()=>{typeof t.removeEventListener=="function"?t.removeEventListener("change",s):t.removeListener?.(s)}},[]);const $n=()=>{if(typeof window>"u")return null;if(gt.current)return gt.current;const t=window.AudioContext||window.webkitAudioContext;if(!t)return null;const s=new t;return gt.current=s,s},zt=t=>{qt.current&&(typeof navigator>"u"||typeof navigator.vibrate!="function"||navigator.vibrate(t))},Ut=(t,s=1)=>{if(!qt.current)return;const l=typeof performance<"u"?performance.now():Date.now(),u=On.current||0,m=t==="commit"?0:mi;if(l-u<m)return;On.current=l;const w=h(s,.2,1);if(t==="threshold"){zt(8);return}if(t==="snap"){zt(6);return}if(t==="skip"){zt(12);return}const y=Math.round(16+w*22);zt(w>.7?[y,12,y+8]:y)},Bn=(t,s)=>{if(!Bt.current||typeof document<"u"&&document.visibilityState==="hidden")return;const l=$n();if(!l)return;l.state==="suspended"&&l.resume().catch(()=>{});const u=1+(Math.random()*.06-.03),m=h(s,.2,1),w=l.currentTime,y=.11+m*.08,x=Math.max(1,Math.floor(l.sampleRate*y)),T=l.createBuffer(1,x,l.sampleRate),Y=T.getChannelData(0);for(let H=0;H<x;H+=1){const ee=1-H/x;Y[H]=(Math.random()*2-1)*ee}const F=l.createBufferSource();F.buffer=T;const C=l.createBiquadFilter();C.type="bandpass";const L=t==="like"?760:t==="dislike"?520:640,E=t==="like"?1180:t==="dislike"?320:560;C.frequency.setValueAtTime(Math.max(80,L*u),w),C.frequency.exponentialRampToValueAtTime(Math.max(60,E*u),w+y);const M=l.createGain();M.gain.setValueAtTime(1e-4,w),M.gain.exponentialRampToValueAtTime(.09+m*.14,w+.012),M.gain.exponentialRampToValueAtTime(1e-4,w+y),F.connect(C),C.connect(M),M.connect(l.destination),F.start(w),F.stop(w+y+.02);const A=l.createOscillator(),$=l.createGain();A.type=t==="like"?"sine":"triangle";const le=t==="like"?520:t==="dislike"?210:360;A.frequency.setValueAtTime(le*u,w),A.frequency.linearRampToValueAtTime((le+(t==="like"?180:-40))*u,w+y),$.gain.setValueAtTime(1e-4,w),$.gain.exponentialRampToValueAtTime(.04+m*.05,w+.01),$.gain.exponentialRampToValueAtTime(1e-4,w+y),A.connect($),$.connect(l.destination),A.start(w),A.stop(w+y+.02)},Vr=(t,s=1)=>{if($t.current)return;const l=Pn.current;if(!l)return;const u=l.getBoundingClientRect(),m=u.width,w=u.height;if(m<=0||w<=0)return;const y=G.burstDurationMs,x=Math.max(6,Math.round(G.burstBaseCount*h(s,.25,1))),T=t==="like"?Math.min(92,m*.28):Math.max(m-92,m*.72),Y=Math.min(92,w*.14),F=t==="like"?"rgba(52,211,153,0.82)":"rgba(251,113,133,0.82)",C=t==="like"?"rgba(255,255,255,0.75)":"rgba(255,255,255,0.7)";for(let L=0;L<x;L++){const E=document.createElement("span"),M=L%5===0;E.className="mn-swipe-burst-dot",E.setAttribute("data-shape",M?"square":"dot");const A=(Math.random()*Math.PI*.9+Math.PI*.05)*(t==="like"?1:-1),$=62+Math.random()*98,le=Math.cos(A)*$,H=-Math.abs(Math.sin(A))*$*(.85+Math.random()*.5),ee=5+Math.random()*6,me=(Math.random()*160-80).toFixed(1)+"deg",ge=(.8+Math.random()*.9).toFixed(2);E.style.setProperty("--x",T.toFixed(1)+"px"),E.style.setProperty("--y",Y.toFixed(1)+"px"),E.style.setProperty("--dx",le.toFixed(1)+"px"),E.style.setProperty("--dy",H.toFixed(1)+"px"),E.style.setProperty("--rot",me),E.style.setProperty("--s",ge),E.style.setProperty("--sz",ee.toFixed(1)+"px"),E.style.setProperty("--dur",y+"ms"),E.style.background=L%3===0?C:F,l.appendChild(E),window.setTimeout(()=>E.remove(),y+60)}},{data:O}=yn({queryKey:mt.titleDetail(de),enabled:!!de,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>de?_r(de):null}),Kt=ce(O?.plot)??ce(o?.overview)??null,xe=O?.genres??o?.genres??null,Qr=O?.omdb_country??o?.country??null,Jr=ce(Qr),qn=Zs(Jr),Ke=ce(O?.omdb_director),zn=ce(O?.omdb_writer),yt=ce(O?.omdb_actors),rt=O?.imdb_rating??o?.imdbRating??null,ln=O?.rt_tomato_pct??o?.rtTomatoMeter??null,on=O?.metascore??null,cn=O?.imdb_votes??null,Un=ce(O?.omdb_awards),Kn=ce(O?.omdb_box_office_str),Yn=ce(O?.omdb_released),dn=O?.content_type==="movie"||O?.content_type==="series"||O?.content_type==="anime"?O.content_type:o?.type??null,Wn=o,Zr=Wn?.certification??Wn?.rated??O?.omdb_rated??null,Xn=ce(Zr),Hn=(Array.isArray(xe)?xe:xe?String(xe).split(",").map(t=>t.trim()):[])??[],Gn=Hn.length>3?Hn.slice(3).filter(Boolean):[],es=[O?.omdb_language??null,o?.language??null],Vn=Array.from(new Set(es.map(t=>ce(t)).filter(t=>!!t))),un=()=>Me?!0:(alert("Sign in to save this title, rate it, or add it to your watchlist."),!1),Qn=t=>{if(!(!de||!_||!un())){if(t===qe){const s=an.status===qe?null:qe;Dt(s),Ot.mutate({status:s,statusKind:"watchlist"});return}if(t===ut){const s=an.status===ut?null:ut;Dt(s),Ot.mutate({status:s,statusKind:"watched"})}}},ts=()=>{!de||!_||!un()||(Dt(qe),Ot.mutate({status:qe,statusKind:"watchlist"}),as())},ns=t=>{!de||!_||!un()||(An(t),Ot.mutate({ratingStars:t}))},Jn=t=>an?.status===t,mn=Xr??(Fn??null);i.useEffect(()=>{An(null),Dt(null)},[de,Fn,Tn]);const rs=t=>{ns(mn===t?null:t)},Zn=()=>typeof window<"u"?Os(`/title/${o?.id??""}`):`/title/${o?.id??""}`,ss=Zn(),is=async t=>{if(!o||!_)return;const s=Zn(),l=`Check this out: ${o.title}`,u=t??l;try{navigator.share?await navigator.share({title:o.title,text:u,url:s}):navigator.clipboard?.writeText?(await navigator.clipboard.writeText(`${u}

${s}`),alert("Link copied to clipboard")):alert(`${u}

${s}`)}catch{}},er=!!(o?.posterUrl&&!c),he=i.useRef(null),tr=i.useRef(null),Le=i.useRef({w:0,h:0}),st=i.useRef(!1),be=i.useRef(null),we=i.useRef(null),it=i.useRef(0),Ye=i.useRef(0),De=i.useRef(0),We=i.useRef(!1),_e=i.useRef(null),nr=i.useRef(!1),Re=i.useRef(null),Xe=i.useRef(0),vt=i.useRef(null),Ie=i.useRef(null),ue=i.useRef(null),ae=i.useRef(0),Ce=i.useRef(null),Ee=i.useRef(.5),Te=i.useRef(.5),jt=i.useRef(null),kt=i.useRef(null),Yt=i.useRef(null),Wt=i.useRef(null),at=i.useRef(null);i.useEffect(()=>{const t=()=>{const s=he.current;if(!s)return;const l=s.getBoundingClientRect();!l.width||!l.height||(Le.current={w:l.width,h:l.height})};if(t(),!(typeof window>"u"))return window.addEventListener("resize",t,{passive:!0}),()=>window.removeEventListener("resize",t)},[o?.id]);const as=()=>{if(!o)return;Ze(!1),typeof window<"u"&&Fe(It,"1");const t=he.current;t&&(t.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",t.style.transform="perspective(1400px) translateX(0px) translateY(6px) scale(1.02) rotateZ(-1deg)",window.setTimeout(()=>{t.style.transform="perspective(1400px) translateX(0px) translateY(26px) scale(0.95)"},16),t.style.opacity="0"),window.setTimeout(()=>{rr(0,!0),X(s=>Math.min(s+1,D.length)),t&&(t.style.transition="none",t.style.transform="translateX(0px) translateY(0px) scale(1)",t.style.opacity="1")},220)};i.useEffect(()=>{if(typeof window>"u")return;const t=Ge(It);Ze(!t)},[]),i.useEffect(()=>{xt(!1),K(!1),Ne(!1)},[o?.id]),i.useEffect(()=>{!_||!o||oe||te||Se(o)||(K(!1),Ne(!1),X(t=>Math.min(t+1,D.length)))},[_?.id,o?.id,oe,te,Se]),i.useEffect(()=>{if(!_)return;const t=performance.now();if(at.current&&Wt.current&&Wt.current!==_.id){const s=Yt.current;if(s!=null){const l=Math.max(0,Math.round(t-s));Ae(at.current,l)}}if(!Se(o)){at.current=null,Wt.current=null,Yt.current=null;return}pt(_),at.current=_,Wt.current=_.id,Yt.current=t},[_?.id,o?.id,Se,Ae,pt]),i.useEffect(()=>()=>{if(!at.current)return;const t=Yt.current;if(t==null)return;const s=Math.max(0,Math.round(performance.now()-t));Ae(at.current,s)},[]),i.useEffect(()=>{if(typeof window>"u")return;(window.requestIdleCallback??(s=>window.setTimeout(s,180)))(()=>{const s=D.slice(ne+1,ne+4);for(const l of s){if(!l?.posterUrl)continue;const u=new Image;u.loading="lazy",u.decoding="async",u.src=l.posterUrl}})},[D,ne]),i.useEffect(()=>()=>{Re.current&&cancelAnimationFrame(Re.current),Pe.current!=null&&window.clearTimeout(Pe.current),ht.current!=null&&window.clearTimeout(ht.current),gt.current&&gt.current.close().catch(()=>{})},[]),i.useEffect(()=>{const t=D.length-ne;t<12&&z(Math.max(60,t+24))},[D.length,ne,z]),i.useEffect(()=>{if(ne<=10)return;const t=Math.min(Math.max(ne-6,0),D.length);t>0&&(je(t),X(s=>Math.max(4,s-t)))},[D.length,ne,je]);const rr=i.useCallback((t,s=!1,l)=>{const u=tr.current;if(!u)return;const m=st.current?.96:1,w=Et(Le.current.w,m),y=h(Math.abs(t)/Math.max(1,w),0,1),x=h(t/Math.max(1,w),-1,1),T=.68+y*.32+x*y*.03,Y=.9+y*.1+x*y*.02,F=.985+y*.015,C=(1-y)*G.undercardTranslateY,L=(1-y)*G.undercardBlurMax,E=1-y,M=(h(-t*.02,-10,10)+x*y*8)*E,A=h(-t/220,-2.2,2.2)*E,$=l??200;u.style.transition=s?`filter ${$}ms cubic-bezier(0.22,0.61,0.36,1), transform ${$}ms cubic-bezier(0.22,0.61,0.36,1)`:"none",u.style.transform=`translate3d(${M.toFixed(2)}px, ${C.toFixed(2)}px, 0px) rotateZ(${A.toFixed(3)}deg) scale(${F.toFixed(4)})`,u.style.filter=`brightness(${T.toFixed(3)}) saturate(${Y.toFixed(3)}) blur(${L.toFixed(2)}px)`},[]),ls=()=>{typeof performance>"u"||(vt.current=performance.now())},os=()=>{if(typeof performance>"u")return 1;const t=vt.current;if(t==null)return 1;const s=(performance.now()-t)/Math.max(1,G.punchDurationMs);if(s>=1)return vt.current=null,1;const l=Math.sin(Math.PI*s);return 1+(G.punchScale-1)*l},Nt=(t,s=!1,l,u)=>{const m=he.current;if(!m)return;const w=$t.current,y=st.current?.96:1,x=Et(Le.current.w,y),T=yr(Le.current.w,y),F=(Mt=>{const Gt=Math.abs(Mt),Rt=Math.max(1,x)*.7;if(Gt<=Rt)return Mt;const gn=Gt-Rt;return Math.sign(Mt)*(Rt+gn*.38)})(t),C=h(F,-Ct,Ct),L=oi(F,Ct),E=Math.abs(F)>.5&&_e.current==="x";m.style.transformOrigin=E?`${(Te.current*100).toFixed(1)}% ${(Ee.current*100).toFixed(1)}%`:"50% 50%";const M=Math.abs(C),A=T*.6,$=h((M-A)/Math.max(1,x-A),0,1),le=C>0?$:0,H=C<0?$:0;m.style.setProperty("--mn-swipe-like-opacity",String(le)),m.style.setProperty("--mn-swipe-nope-opacity",String(H)),m.style.setProperty("--mn-swipe-like-scale",String(.96+le*.04)),m.style.setProperty("--mn-swipe-nope-scale",String(.96+H*.04));const ee=h(Math.abs(C)/Math.max(1,x),0,1),me=h((.5-Ee.current)*2,-1,1),ge=me<0?-1:1,ye=.55+.45*Math.abs(me),ct=h((Te.current-.5)*2,-1,1),Z=h(Math.abs(ae.current)/1.35,0,1),se=C/kr*ye*ge,ve=h(se*(1+Z*.28),-18,G.rotateZCap),xn=h(C/24+Math.sign(C)*Z*2.8+-ct*ee*4.5,-14,G.rotateYCap),Ht=h(me*(1.8+Z*2.2)*ee,-7,G.rotateXCap);if(w)m.style.setProperty("--mn-swipe-spec-o","0"),m.style.setProperty("--mn-swipe-poster-parallax","0px"),m.style.setProperty("--mn-swipe-poster-parallax-y","0px"),m.style.setProperty("--mn-swipe-bg-parallax","0px"),m.style.boxShadow="0 30px 90px rgba(0,0,0,0.62)",m.style.backdropFilter="blur(8px)";else{const Mt=h(.08+ee*.22+Z*.12,0,.42),Gt=h(50+C/Math.max(1,x)*18+nt.current.x*12,24,76),Rt=h(28+-De.current/Math.max(1,x)*12+nt.current.y*10,16,66);m.style.setProperty("--mn-swipe-spec-o",Mt.toFixed(3)),m.style.setProperty("--mn-swipe-spec-x",`${Gt.toFixed(1)}%`),m.style.setProperty("--mn-swipe-spec-y",`${Rt.toFixed(1)}%`),m.style.setProperty("--mn-swipe-poster-parallax",`${(-C*.035).toFixed(2)}px`),m.style.setProperty("--mn-swipe-poster-parallax-y",`${(De.current*.02).toFixed(2)}px`),m.style.setProperty("--mn-swipe-bg-parallax",`${(C*.02).toFixed(2)}px`);const gn=h(.46+ee*.22+Z*.14,.35,.78);m.style.boxShadow=`0 30px 92px rgba(0,0,0,${gn.toFixed(3)})`,m.style.backdropFilter=`blur(${(8+ee*8).toFixed(1)}px)`}const hn=w?0:h(De.current*.18,-14,14),bn=-ee*(3.2+Z*1.6),ys=os(),vs=(1+ee*.006+Z*.004)*ys,wn=w?{x:0,y:0}:nt.current,js=wn.y*-4,ks=wn.x*5,Ns=wn.y*-4,lr=l??320,_s=u??"cubic-bezier(0.16, 1, 0.3, 1)";m.style.transition=s?`transform ${lr}ms ${_s}`:"none",m.style.transform=`
      perspective(1400px)
      translate3d(${L}px, ${Ns+bn+hn}px, 0px)
      rotateX(${w?0:js+Ht}deg)
      rotateY(${w?0:xn+ks}deg)
      rotateZ(${w?0:ve}deg)
      scale(${vs})
    `,it.current=C,rr(C,s,lr)},Xt=(t=!0,s=0)=>{nt.current={x:0,y:0};const l=Math.abs(s),u=h(l/1.35,0,1),m=t?h(Math.round(320-u*140),170,320):void 0,w=t&&l<.45?"cubic-bezier(0.22, 1.2, 0.36, 1)":"cubic-bezier(0.16, 1, 0.3, 1)";Nt(0,t,m,w),it.current=0,be.current=null,we.current=null,Ie.current=null,ue.current=null,ae.current=0,Ye.current=0,De.current=0,We.current=!1,_e.current=null,Te.current=.5,Ee.current=.5,jt.current=null},cs=(t,s)=>{S({card:t,direction:s}),nn(!0),Pe.current!=null&&window.clearTimeout(Pe.current),Pe.current=window.setTimeout(()=>nn(!1),2800)},ds=()=>{nn(!1),S(null),Pe.current!=null&&(window.clearTimeout(Pe.current),Pe.current=null)},us=()=>{J&&(X(t=>{const s=t-1;if(s<0)return t;const l=D[s];return l&&l.id===J.card.id?s:t}),lt("Reviewing previous card. Swipe actions are already saved."),typeof window<"u"&&window.requestAnimationFrame(()=>Xt(!1)),ds())},lt=t=>{Mn(t),ht.current!=null&&window.clearTimeout(ht.current),t&&(ht.current=window.setTimeout(()=>Mn(null),3200))},ms=(t,s)=>{const l=t.runtimeMinutes??0,u=xe??t.genres??[],m=dn==="series"||t.type==="series",w=u.map(y=>y.toLowerCase());return s==="like"?w.some(y=>y.includes("horror")||y.includes("thriller"))?"We’ll show more intense picks like this.":w.some(y=>y.includes("comedy"))?"We’ll show more light and funny picks like this.":m?"Nice — we’ll bring in more series that match this vibe.":rt!=null&&ie(rt)!=null&&ie(rt)>=7.5?"Nice pick — we’ll show more highly rated titles like this.":t.friendLikesCount&&t.friendLikesCount>=3?"Your friends are into this — we’ll pull in more friend-favorites.":"Got it — we’ll keep tuning around this kind of title.":s==="dislike"?m?"Looks like this series isn’t your thing — we’ll dial down similar shows.":l>130&&zr+1>=3?"You’ve skipped a few long movies — we’ll lean toward shorter runtimes.":l>130?"Noted — we’ll be more careful with super long movies.":"Okay, we’ll dial down similar titles in your feed.":s==="skip"?"We’ll move this out of your way and keep the feed feeling fresh.":null},Oe=(t,s=0,l=null)=>{if(!o||!_)return;const u=`${_.deckId??"unknown"}:${_.id}`;if(_n.current.has(u)){lt("That swipe was already saved. Back is for review only."),Xt(!0);return}if(_n.current.add(u),Ze(!1),typeof window<"u"&&Fe(It,"1"),cs(o,t),Ve({card:_,direction:t,action:l}),l==="more_like_this"?lt("Locked in — we’ll prioritize more picks like this."):l==="not_interested"&&lt("Noted — we’ll keep this out of your deck for a while."),t==="dislike"&&(o.runtimeMinutes??0)>130?Rn(M=>M+1):Rn(0),qr(M=>{const A=M+1,$=ms(o,t);return $&&A>=4&&A%4===0?lt($):lt(null),A}),t==="skip"){const M=he.current;M&&(M.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",M.style.transform="perspective(1400px) translateX(0px) translateY(4px) scale(1.03) rotateZ(-1deg)",window.setTimeout(()=>{M.style.transform="perspective(1400px) translateX(0px) translateY(24px) scale(0.95)"},16),M.style.opacity="0");const A=.4;Ut("skip",A),Bn(t,A),window.setTimeout(()=>{X($=>Math.min($+1,D.length)),M&&(M.style.transition="none",M.style.transform="translateX(0px) translateY(0px) scale(1)",M.style.opacity="1")},220);return}const m=t==="like"?1:-1,w=typeof window<"u"?window.innerWidth+240:fi,y=Math.abs(s),x=h(y/1.35,0,1),T=h(y*260,0,280),Y=(w+T)*m,F=h(Math.round(260-x*110),140,260),C=he.current;if(C){const M=h((.5-Ee.current)*2,-1,1),A=M<0?-1:1,$=.55+.45*Math.abs(M),le=h((Te.current-.5)*2,-1,1);C.style.transformOrigin=`${(Te.current*100).toFixed(1)}% ${(Ee.current*100).toFixed(1)}%`;const H=$t.current,ee=Y/kr*$*A,me=H?0:h(ee*(1+x*.12),-24,24),ge=H?0:h(m*(10+x*12)+-le*(4+x*3),-22,22),ye=H?0:h(M*(4+x*2),-8,8),ct=-4-x*14,Z=1.04+x*.04,se=H?1:1+x*.025,ve=H?1:1-x*.018;C.style.transition=`transform ${F}ms cubic-bezier(0.22,0.61,0.36,1)`,C.style.transform=`
        perspective(1400px)
        translate3d(${Y}px, ${ct}px, 0px)
        rotateX(${ye}deg)
        rotateY(${ge}deg)
        rotateZ(${me}deg)
        scale3d(${(Z*se).toFixed(4)}, ${(Z*ve).toFixed(4)}, 1)
      `}const L=Math.abs(it.current)+Math.abs(s)*220,E=h(L/520,.25,1);Vr(t,E),Ut("commit",E),Bn(t,E),window.setTimeout(()=>{X(M=>Math.min(M+1,D.length)),window.requestAnimationFrame(()=>Xt(!1))},F)},fs=(t,s,l,u,m,w,y,x)=>{if(!o||!_||Ce.current!=null||m==="touch"&&!w||m==="touch"&&typeof y=="number"&&typeof x=="number"&&y>55&&x>55)return;const Y=u instanceof HTMLElement&&!!u.closest('button, a, input, textarea, select, [data-swipe-interactive="true"][role="button"], [data-swipe-interactive="true"][tabindex]:not([tabindex="-1"])');if(nr.current=Y,Y)return;We.current=!0,Ce.current=l,_e.current=null;try{he.current?.setPointerCapture(l)}catch{}be.current=t,we.current=s;const F=he.current;if(F){const L=F.getBoundingClientRect();L.width>0&&L.height>0?(Le.current={w:L.width,h:L.height},Te.current=h((t-L.left)/L.width,0,1),Ee.current=h((s-L.top)/L.height,0,1)):(Te.current=.5,Ee.current=.5)}else Te.current=.5,Ee.current=.5;Ye.current=0,De.current=0,it.current=0,Xe.current=0,vt.current=null,Ie.current=t,ue.current=performance.now(),kt.current=ue.current,ae.current=0;const C=p&&rn.current&&rn.current.contains(u);sn.current=!!C},ps=(t,s,l,u,m,w,y)=>{if(Ce.current!=null&&l!==Ce.current||!We.current||be.current===null||we.current===null||u==="touch"&&!m||u==="touch"&&typeof w=="number"&&typeof y=="number"&&w>55&&y>55)return;const x=performance.now(),T=t-be.current,Y=s-we.current;if(!U.current&&_e.current==null){const Z=Math.abs(T),se=Math.abs(Y);if(Z<jn&&se<jn)return;if(se>Z*ci){We.current=!1,Ce.current=null,_e.current="y",be.current=null,we.current=null,Ie.current=null,ue.current=null,ae.current=0;return}_e.current="x",Ft(!0),U.current=!0,be.current=t-Math.sign(T)*jn,we.current=s,Ie.current=t,ue.current=x,ae.current=0,Bt.current&&$n();const ve=he.current;if(ve)try{ve.setPointerCapture(l)}catch{}}if(!U.current||be.current===null)return;const F=t-be.current,C=st.current?.96:1,L=Et(Le.current.w,C),E=yr(Le.current.w,C),M=we.current!=null?s-we.current:0,A=Math.abs(F),$=Math.abs(M),le=h((A-$*di)/Math.max(1,E),0,1),H=h(1-le*.75-A/Math.max(1,L)*.22,ui,1),ee=M*H,me=h((A-E*.55)/Math.max(1,E*.75),0,1),ge=F+Math.sign(F)*kn*.18*me;Ye.current=ge,De.current=h(ee,-70,70);let ye=null;if(ge>E?ye="like":ge<-E&&(ye="dislike"),ye&&ye!==jt.current&&(Ut("threshold",.6),ls()),jt.current=ye,Ie.current!==null&&ue.current!==null){const Z=x-ue.current;if(Z>0){const se=(t-Ie.current)/Z,ve=h(se,-2.5,2.5);ae.current=ae.current*.75+ve*.25}}if(Ie.current=t,ue.current=x,Re.current!=null)return;const ct=()=>{Re.current=null;const Z=h(G.dragFollowAlpha,.08,1);let se=Ye.current;if(We.current&&U.current&&ue.current!=null){const ve=(typeof performance<"u"?performance.now():Date.now())-ue.current;if(ve>vr){const xn=h((ve-vr)/260,0,1),Ht=Math.abs(se);if(Ht>E*.45&&Ht<L*.86){const hn=Math.sign(se)*Math.min(E*.92,L*.84),bn=h(hn-se,-kn,kn);se=se+bn*xn}}}Xe.current=Xe.current+(se-Xe.current)*Z,Nt(Xe.current),We.current&&U.current&&_e.current==="x"&&(Re.current=window.requestAnimationFrame(ct))};Re.current=window.requestAnimationFrame(ct)},sr=(t,s,l)=>{if(Ce.current!=null&&t!==Ce.current)return;const u=U.current;Ft(!1),U.current=!1,We.current=!1;const m=Ce.current;Ce.current=null,Re.current!=null&&(cancelAnimationFrame(Re.current),Re.current=null,Nt(Xe.current));const w=t??m;if(w!=null)try{he.current?.releasePointerCapture(w)}catch{}if(!u){const A=_e.current==="y",$=be.current,le=we.current,H=$!=null&&s!=null?s-$:0,ee=le!=null&&l!=null?l-le:0,me=kt.current!=null?performance.now()-kt.current:null,ge=!A&&Math.abs(H)<10&&Math.abs(ee)<10&&(me==null||me<280)&&!nr.current;be.current=null,we.current=null,Ie.current=null,ue.current=null,ae.current=0,kt.current=null,Ye.current=0,De.current=0,_e.current=null,Te.current=.5,Ee.current=.5,jt.current=null,ge&&!(p&&sn.current)&&(K(ye=>!ye),Ne(!1));return}kt.current=null;const x=h(it.current,-Ct,Ct)+ae.current*G.velocityProjectionMs,T=p&&sn.current,Y=st.current?.96:1,F=Et(Le.current.w,Y),C=T?F*1.6:F,L=st.current?jr*.92:jr,E=T?L*1.4:L,M=Math.abs(x)>=C||Math.abs(ae.current)>=E;if(be.current=null,we.current=null,Ie.current=null,ue.current=null,Ye.current=0,De.current=0,Xe.current=0,vt.current=null,_e.current=null,M){Oe(x>=0?"like":"dislike",ae.current),jt.current=null,ae.current=0;return}Ut("snap",h(Math.abs(ae.current)/1.35,.25,.9)),Xt(!0,ae.current)},He=!o||oe||te||pe,ir=typeof o?.friendLikesCount=="number"?o.friendLikesCount:0,xs=Ue>0?Math.round(ir/Math.max(1,Ue)*100):0;i.useEffect(()=>{const t=s=>{!o||He||pe||(s.key==="ArrowLeft"?(s.preventDefault(),Oe("dislike")):s.key==="ArrowRight"?(s.preventDefault(),Oe("like")):(s.key==="ArrowDown"||s.key===" ")&&(s.preventDefault(),Oe("skip")))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[o,He,pe]);const hs=()=>{if(!tn||!J)return null;const t=J.direction==="like"?"Loved it":J.direction==="dislike"?"Marked as ‘No thanks’":"Saved for ‘Not now’";return e.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-4 z-40 flex justify-center page-pad",children:e.jsxs("div",{className:"pointer-events-auto inline-flex items-center gap-3 rounded-md border border-border bg-background/95 px-3 py-2 text-[12px] text-foreground shadow-lg backdrop-blur",children:[e.jsx("span",{children:t}),e.jsx("button",{type:"button","aria-label":"Back to previous card",onClick:us,className:"text-xs font-semibold uppercase tracking-[0.14em] text-primary hover:text-primary/80",children:"Back"})]})})},bs=()=>Sn?e.jsx("div",{className:"pointer-events-none absolute inset-x-0 top-2 z-30 flex justify-center page-pad",children:e.jsxs("div",{className:"pointer-events-auto inline-flex max-w-md items-start gap-2 rounded-md border border-border bg-background/95 px-3 py-2 text-xs text-muted-foreground shadow-lg backdrop-blur",children:[e.jsx(I,{name:"auto_awesome",className:"mt-0.5 text-[18px] text-primary"}),e.jsx("span",{children:Sn})]})}):null,_t=typeof o?.imdbRating=="number"&&!Number.isNaN(o.imdbRating)?o.imdbRating:typeof O?.imdb_rating=="number"&&!Number.isNaN(O.imdb_rating)?O.imdb_rating:ie(O?.imdb_rating),St=typeof o?.rtTomatoMeter=="number"&&!Number.isNaN(o.rtTomatoMeter)?o.rtTomatoMeter:typeof O?.rt_tomato_pct=="number"&&!Number.isNaN(O.rt_tomato_pct)?O.rt_tomato_pct:ie(O?.rt_tomato_pct),fn=i.useMemo(()=>Nr({card:o??null,friendCount:Ue,imdb:_t??null,rt:St??null}),[o,Ue,_t,St]),ot=o?(()=>{const t=[];if(o.year&&t.push(String(o.year)),_t!=null&&ie(_t)!=null&&t.push(`IMDb ${String(ie(_t)?.toFixed(1))}`),St!=null&&ie(St)!=null&&t.push(`RT ${Math.round(Number(St))}%`),typeof o.runtimeMinutes=="number"&&o.runtimeMinutes>0){const s=xr(o.runtimeMinutes);s&&t.push(s)}return t.join(" • ")})():"",pn=i.useMemo(()=>{const t=dn??o?.type??null;return t==="series"?"SERIES":t==="anime"?"ANIME":"MOVIE"},[dn,o?.type]),ar=i.useMemo(()=>{const t=xe??o?.genres??null;return(Array.isArray(t)?t:t?String(t).split(",").map(l=>l.trim()).filter(Boolean):[]).map(l=>String(l??"").trim()).filter(Boolean).slice(0,3)},[xe,o?.genres]),ws=t=>{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||pe)return;const s=he.current;if(!s)return;const l=s.getBoundingClientRect(),u=(t.clientX-l.left)/l.width,m=(t.clientY-l.top)/l.height;nt.current={x:(u-.5)*2,y:(m-.5)*2},Nt(Ye.current)},gs=()=>{pe||(nt.current={x:0,y:0},Nt(it.current,!0))};return e.jsxs("div",{"data-reduce-motion":Hr?"1":"0",className:"relative flex flex-1 min-h-0 flex-col overflow-hidden overscroll-none h-[calc(100dvh-(5.5rem+env(safe-area-inset-bottom)))]",style:xi,children:[e.jsx("style",{children:pi}),o?.posterUrl&&e.jsxs("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 -z-10",style:{backgroundImage:`url(${o.posterUrl})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-background/40 via-background/70 to-background"}),e.jsx("div",{className:"absolute inset-0 backdrop-blur-2xl"})]}),bs(),e.jsxs("div",{className:"relative z-10 flex shrink-0 flex-col gap-[calc(var(--mn-swipe-pad)*0.75)] px-[var(--mn-swipe-pad)] pt-[calc(env(safe-area-inset-top)+var(--mn-swipe-pad)*0.75)]",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:()=>v(!0),className:"inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center text-muted-foreground/90 transition-colors hover:text-foreground","aria-label":"Filters",children:e.jsx(I,{name:"tune",className:"text-[length:var(--mn-swipe-top-icon)]"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold tracking-[0.25em] text-primary/90",children:"DISCOVERY"}),e.jsx("div",{className:"text-[length:var(--mn-swipe-header)] font-semibold text-foreground",children:"For You"})]}),e.jsxs("button",{type:"button",onClick:()=>n("/activity"),className:"relative inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center text-muted-foreground/90 transition-colors hover:text-foreground","aria-label":"Activity",children:[e.jsx(I,{name:"notifications",className:"text-[length:var(--mn-swipe-top-icon)]"}),e.jsx("span",{"aria-hidden":"true",className:"absolute right-[8px] top-[8px] h-2 w-2 rounded-full bg-primary"})]})]}),e.jsx(ei,{message:ft,onRetry:ze,isRetrying:Qe}),e.jsx(ri,{active:_?{deckId:_.deckId??null,recRequestId:_.recRequestId??null,position:_.position??null,dedupeKey:_.dedupeKey??_.dedupe_key??null,mediaItemId:_.id??null,source:_.source??null}:null})]}),e.jsxs("div",{className:"relative z-10 flex flex-1 min-h-0 flex-col overflow-visible px-[var(--mn-swipe-pad)]",children:[e.jsxs("div",{className:"relative flex flex-1 min-h-0 items-center justify-center overflow-visible [perspective:1400px]","aria-live":"polite",children:[oe&&!o&&!te&&e.jsx(Fs,{}),te&&!oe&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(I,{name:"info",className:"text-[32px] text-amber-400"}),e.jsx("p",{children:"We couldn't load your swipe deck."}),e.jsx("button",{type:"button",onClick:()=>z(32),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Retry"})]}),!oe&&!te&&!o&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(I,{name:"auto_awesome",className:"text-[32px] text-primary"}),e.jsx("p",{children:"All caught up. New cards will appear soon."}),e.jsx("button",{type:"button",onClick:()=>z(36),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Refresh deck"})]}),!oe&&o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative z-10 mx-auto h-full max-h-[720px] w-full max-w-md",children:[d&&e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0",children:(()=>{const t=d;if(!t)return null;const s=typeof t.friendLikesCount=="number"?t.friendLikesCount:Array.isArray(t.friendProfiles)?t.friendProfiles.length:0,l=Ue>0?Math.round(s/Math.max(1,Ue)*100):0,u=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)?t.imdbRating:Yr??null,m=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)?t.rtTomatoMeter:Kr??null,w=Nr({card:t,friendCount:Ue,imdb:u,rt:m}),y=(()=>{const x=Array.isArray(t.genres)?t.genres:[],T=wt?.omdb_genre!=null?String(wt.omdb_genre).split(",").map(F=>F.trim()).filter(Boolean):[];return(x.length>0?x:T).map(F=>String(F??"").trim()).filter(Boolean).slice(0,3)})();return e.jsx("div",{ref:tr,className:"absolute inset-0",style:{filter:"brightness(0.68) saturate(0.9)",willChange:"filter"},children:e.jsx("div",{className:"relative h-full w-full rounded-[var(--mn-swipe-radius)] bg-gradient-to-b from-white/10 via-primary/25 to-white/10 p-[1.25px] shadow-[0_30px_90px_rgba(0,0,0,0.75)]",children:e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-[var(--mn-swipe-radius)] bg-background/20 backdrop-blur-sm",children:[N&&t.posterUrl?e.jsx("img",{src:t.posterUrl,alt:Vt(t)??`${t.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>Pt(t.id,!0)}):e.jsx("div",{className:"h-full w-full",children:e.jsx(vn,{title:t.title})}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/20 to-black/70"}),t.source==="from-friends"&&e.jsx("div",{className:"absolute left-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)]",children:(()=>{const x=t.topFriendName??t.friendProfiles?.[0]?.display_name??t.friendProfiles?.[0]?.username??"",T=Math.max(0,s-1),Y=!!x,F=(x.trim().charAt(0)||"F").toUpperCase();return e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-black/30 px-2.5 py-2 shadow-sm backdrop-blur-md",children:[e.jsx("div",{className:"grid h-10 w-10 place-items-center overflow-hidden rounded-full border border-white/20 bg-white/10 text-sm font-semibold text-white/90",children:Y&&t.friendProfiles?.[0]?.avatar_url?e.jsx("img",{src:t.friendProfiles[0].avatar_url,alt:x||"Friend",className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("span",{children:F})}),T>0&&e.jsxs("div",{className:"grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-white/10 text-sm font-semibold text-white/90",children:["+",T]}),e.jsx("div",{className:"pr-1 text-sm font-semibold text-white/90",children:Y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary",children:x}),e.jsxs("span",{className:"text-white/80",children:[" ","& others watched"]})]}):e.jsx("span",{className:"text-white/80",children:"From friends"})})]})})()}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-x-0 bottom-0 h-[72%] bg-gradient-to-t from-black/85 via-black/40 to-transparent"}),e.jsxs("div",{className:"relative",children:[(()=>{const x=t.source??"for-you",T=x==="trending"?{label:"Trending",icon:"local_fire_department"}:x==="popular"?{label:"Popular",icon:"stars"}:x==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-primary/25 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-primary-foreground backdrop-blur",children:[e.jsx(I,{name:T.icon,filled:!0,className:"text-[18px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:T.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[w,"% Match"]})]})})(),e.jsx("h2",{className:"line-clamp-2 text-[length:var(--mn-swipe-title)] font-extrabold leading-[1.02] text-white",children:t.title}),Cn&&e.jsxs("p",{className:"mt-1 text-[length:var(--mn-swipe-subtitle)] font-semibold text-white/60",children:["Directed by ",Cn.split(",")[0]]}),e.jsx("div",{className:"mt-4 text-[length:var(--mn-swipe-meta)] text-white/70 whitespace-nowrap overflow-hidden text-ellipsis",children:[t.year?e.jsx("span",{children:t.year},"y"):null,u!=null?e.jsxs("span",{className:"text-white/70",children:["IMDb ",String(u.toFixed(1))]},"i"):null,m!=null?e.jsxs("span",{className:"text-white/70",children:["RT ",Math.round(m),"%"]},"r"):null,typeof t.runtimeMinutes=="number"&&t.runtimeMinutes>0?e.jsx("span",{children:xr(t.runtimeMinutes)},"t"):null].filter(Boolean).map((x,T)=>e.jsxs(dr.Fragment,{children:[T>0&&e.jsx("span",{className:"mx-1 text-white/30",children:"•"}),x]},T))}),Array.isArray(t.friendProfiles)&&t.friendProfiles.length>0&&e.jsxs("div",{className:"mt-5 flex w-full items-center justify-between gap-3 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-left backdrop-blur-md","aria-label":"Friends summary",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ur,{profiles:t.friendProfiles,max:3,size:32}),e.jsxs("div",{className:"leading-tight",children:[e.jsxs("p",{className:"text-[length:var(--mn-swipe-subtitle)] font-extrabold text-white",children:[h(Math.round(l),0,100),"% of friends"]}),e.jsxs("p",{className:"text-sm font-semibold text-white/60",children:[t.source==="from-friends"?"watched":"liked"," ","this title"]})]})]}),e.jsx("div",{className:"grid h-[var(--mn-swipe-hit)] w-[var(--mn-swipe-hit)] place-items-center rounded-full border border-white/10 bg-white/10 text-white/70",children:e.jsx(I,{name:"chevron_right",className:"text-[length:var(--mn-swipe-top-icon)]"})})]}),y.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:y.map(x=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/10 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-white/75",children:["#",x]},x))})]})]})]})})})})()}),e.jsx("div",{className:"relative h-full w-full rounded-[var(--mn-swipe-radius)] bg-gradient-to-b from-white/10 via-primary/25 to-white/10 p-[1.25px] shadow-[0_30px_90px_rgba(0,0,0,0.75)]",children:e.jsxs("article",{ref:he,role:"group","aria-roledescription":"Movie card","aria-label":Vt(o),className:`relative h-full w-full select-none overflow-hidden rounded-[var(--mn-swipe-radius)] bg-background/20 backdrop-blur-sm transform-gpu will-change-transform ${p?"ring-1 ring-primary/40":""}`,onPointerDown:t=>{t.pointerType==="mouse"&&t.button!==0||fs(t.clientX,t.clientY,t.pointerId,t.target,t.pointerType,t.isPrimary,t.width,t.height)},onPointerMove:t=>ps(t.clientX,t.clientY,t.pointerId,t.pointerType,t.isPrimary,t.width,t.height),onPointerUp:t=>sr(t.pointerId,t.clientX,t.clientY),onPointerCancel:t=>sr(t.pointerId,t.clientX,t.clientY),onMouseMove:ws,onMouseLeave:gs,style:{touchAction:p?"pan-y":"none",overscrollBehavior:"contain",userSelect:"none",WebkitUserSelect:"none"},children:[e.jsx("div",{ref:Pn,"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-20 overflow-hidden"}),e.jsxs("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-[-48px] z-[1]",children:[e.jsx("div",{className:"absolute inset-0 blur-3xl bg-emerald-400/30",style:{opacity:"var(--mn-swipe-like-opacity, 0)"}}),e.jsx("div",{className:"absolute inset-0 blur-3xl bg-rose-400/30",style:{opacity:"var(--mn-swipe-nope-opacity, 0)"}})]}),e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-[19]",style:{background:"radial-gradient(circle at var(--mn-swipe-spec-x, 50%) var(--mn-swipe-spec-y, 30%), rgba(255,255,255,0.35), rgba(255,255,255,0) 55%)",opacity:"var(--mn-swipe-spec-o, 0)",mixBlendMode:"soft-light"}}),!p&&e.jsxs("div",{className:"relative z-[2] h-full w-full",children:[er&&o.posterUrl?e.jsx("img",{src:o.posterUrl,alt:Vt(o)??`${o.title} poster`,className:"h-full w-full object-cover",style:{transform:"translate3d(var(--mn-swipe-poster-parallax, 0px), var(--mn-swipe-poster-parallax-y, 0px), 0) scale(1.035)",willChange:"transform"},draggable:!1,loading:"lazy",onError:()=>xt(!0)}):e.jsx("div",{className:"h-full w-full",style:{transform:"translate3d(var(--mn-swipe-poster-parallax, 0px), var(--mn-swipe-poster-parallax-y, 0px), 0) scale(1.02)",willChange:"transform"},children:e.jsx(vn,{title:o.title})}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/20 to-black/70",style:{transform:"translate3d(var(--mn-swipe-bg-parallax, 0px), 0, 0)",willChange:"transform"}}),e.jsx("div",{className:"pointer-events-none absolute inset-x-[calc(var(--mn-swipe-pad)*1.2)] top-[calc(var(--mn-swipe-pad)*0.8)] flex justify-start",children:e.jsxs("div",{className:`flex items-center gap-2 rounded-md bg-emerald-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-emerald-200 shadow-md backdrop-blur-sm ${pe?"":"transition-[opacity,transform] duration-200"}`,style:{opacity:"var(--mn-swipe-like-opacity, 0)",transform:"translate3d(0,0,0) scale(var(--mn-swipe-like-scale, 0.96))"},children:[e.jsx(I,{name:"favorite",filled:!0,className:"text-[18px] text-emerald-300"}),e.jsx("span",{children:"Love it"})]})}),e.jsx("div",{className:"pointer-events-none absolute inset-x-[calc(var(--mn-swipe-pad)*1.2)] top-[calc(var(--mn-swipe-pad)*0.8)] flex justify-end",children:e.jsxs("div",{className:`flex items-center gap-2 rounded-md bg-rose-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-rose-200 shadow-md backdrop-blur-sm ${pe?"":"transition-[opacity,transform] duration-200"}`,style:{opacity:"var(--mn-swipe-nope-opacity, 0)",transform:"translate3d(0,0,0) scale(var(--mn-swipe-nope-scale, 0.96))"},children:[e.jsx(I,{name:"close",className:"text-[18px] text-rose-300"}),e.jsx("span",{children:"No thanks"})]})}),o.source==="from-friends"&&e.jsx("div",{className:"absolute left-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)]",children:(()=>{const t=o.topFriendName??o.friendProfiles?.[0]?.display_name??o.friendProfiles?.[0]?.username??"",s=Math.max(0,ir-1),l=!!t,u=(t.trim().charAt(0)||"F").toUpperCase();return e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-black/30 px-2.5 py-2 shadow-sm backdrop-blur-md",children:[e.jsx("div",{className:"grid h-10 w-10 place-items-center overflow-hidden rounded-full border border-white/20 bg-white/10 text-sm font-semibold text-white/90",children:l&&o.friendProfiles?.[0]?.avatar_url?e.jsx("img",{src:o.friendProfiles[0].avatar_url,alt:t||"Friend",className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("span",{children:u})}),s>0&&e.jsxs("div",{className:"grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-white/10 text-sm font-semibold text-white/90",children:["+",s]}),e.jsx("div",{className:"pr-1 text-sm font-semibold text-white/90",children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary",children:t}),e.jsx("span",{className:"text-white/80",children:" & others watched"})]}):e.jsx("span",{className:"text-white/80",children:"From friends"})})]})})()}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-x-0 bottom-0 h-[72%] bg-gradient-to-t from-black/85 via-black/40 to-transparent"}),e.jsxs("div",{className:"relative",children:[(()=>{const t=o.source??"for-you",s=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-primary/25 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-primary-foreground backdrop-blur",children:[e.jsx(I,{name:s.icon,filled:!0,className:"text-[18px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:s.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[fn,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h2",{className:"min-w-0 line-clamp-2 text-[length:var(--mn-swipe-title)] font-extrabold leading-[1.02] text-white",children:o.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:pn})]}),Ke&&e.jsxs("p",{className:"mt-1 text-[length:var(--mn-swipe-subtitle)] font-semibold text-white/60",children:["Directed by ",Ke.split(",")[0]]}),ot&&e.jsx("div",{className:"mt-4 text-[length:var(--mn-swipe-meta)] text-white/70 whitespace-nowrap overflow-hidden text-ellipsis",children:ot}),Array.isArray(o.friendProfiles)&&o.friendProfiles.length>0&&e.jsxs("button",{type:"button",onClick:()=>Q(!0),className:"mt-5 flex w-full items-center justify-between gap-3 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-left backdrop-blur-md","aria-label":"See friends","data-swipe-interactive":"true",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ur,{profiles:o.friendProfiles,max:3,size:32}),e.jsxs("div",{className:"leading-tight",children:[e.jsxs("p",{className:"text-[length:var(--mn-swipe-subtitle)] font-extrabold text-white",children:[h(Math.round(xs),0,100),"% of friends"]}),e.jsxs("p",{className:"text-sm font-semibold text-white/60",children:[o.source==="from-friends"?"watched":"liked"," ","this title"]})]})]}),e.jsx("div",{className:"grid h-[var(--mn-swipe-hit)] w-[var(--mn-swipe-hit)] place-items-center rounded-full border border-white/10 bg-white/10 text-white/70",children:e.jsx(I,{name:"chevron_right",className:"text-[length:var(--mn-swipe-top-icon)]"})})]}),ar.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:ar.map(t=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/10 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-white/75",children:["#",t]},t))})]})]})]}),p&&o&&e.jsxs("div",{className:"absolute inset-0 z-10 flex h-full flex-col",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden bg-[#261933]",children:[er&&o.posterUrl?e.jsx("img",{src:o.posterUrl,alt:Vt(o)??`${o.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>xt(!0),style:{filter:"blur(6px) brightness(0.60)",transform:"scale(1.14)"}}):e.jsx(vn,{title:o.title}),e.jsx("div",{className:"pointer-events-none absolute inset-0 z-0 bg-gradient-to-b from-black/10 via-black/60 to-[#261933]"})]}),e.jsx("button",{type:"button",onClick:()=>K(!1),className:"absolute right-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)] z-20 inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/80 backdrop-blur hover:bg-white/15","aria-label":"Close details","data-swipe-interactive":"true",children:e.jsx(I,{name:"close",className:"text-[length:var(--mn-swipe-top-icon)]"})}),e.jsxs("div",{className:"relative z-10 flex min-h-0 flex-1 flex-col px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)] pt-[calc(var(--mn-swipe-top-hit)+var(--mn-swipe-pad)*0.75)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-0 bg-gradient-to-b from-[#261933]/35 via-[#261933]/90 to-[#261933]"}),e.jsxs("div",{ref:rn,id:"swipe-detail-panel","aria-label":ke?"Full details":"Details summary","aria-live":"polite",className:"relative z-10 mt-1 flex min-h-0 flex-1 flex-col text-left text-[13px] text-white/70",children:[e.jsx("div",{"data-swipe-interactive":"true",className:"flex min-h-0 flex-1 flex-col overflow-hidden",children:ke?e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[e.jsxs("div",{className:"shrink-0 space-y-2",children:[(()=>{const t=o.source??"for-you",s=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.25)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/80",children:[e.jsx(I,{name:s.icon,filled:!0,className:"text-[length:calc(var(--mn-swipe-chip)+0.25rem)]"}),e.jsx("span",{className:"tracking-[0.12em]",children:s.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[fn,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"min-w-0 line-clamp-1 text-[clamp(1.05rem,4.6vw,1.35rem)] font-extrabold text-white",children:o.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.7)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:pn})]}),ot&&e.jsx("p",{className:"text-[length:var(--mn-swipe-meta)] text-white/55 whitespace-nowrap overflow-hidden text-ellipsis",children:ot})]}),e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-2 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 grid grid-cols-2 gap-x-3 gap-y-2 rounded-2xl border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.5)] text-[length:var(--mn-swipe-chip)] leading-snug text-white/75",children:(()=>{const t=[];if(Gn.length>0&&t.push({label:"Genres",value:Gn.slice(0,6).join(", ")}),Vn.length>0&&t.push({label:"Languages",value:Vn.slice(0,4).join(", ")}),Ke&&t.push({label:"Director",value:Ke}),zn&&t.push({label:"Writers",value:zn}),yt){const l=yt.split(",").map(u=>u.trim()).filter(Boolean).slice(3);l.length>0&&t.push({label:"More cast",value:l.slice(0,8).join(", ")})}return Yn&&t.push({label:"Released",value:Yn}),Un&&t.push({label:"Awards",value:Un}),Kn&&t.push({label:"Box office",value:Kn}),rt&&ie(rt)!=null&&t.push({label:"IMDb",value:String(ie(rt)?.toFixed(1))}),ln&&ie(ln)!=null&&t.push({label:"RT",value:`${String(ie(ln))}%`}),cn&&hr(cn)&&t.push({label:"IMDb votes",value:String(hr(cn))}),on&&ie(on)!=null&&t.push({label:"Metascore",value:String(ie(on))}),t.slice(0,10).map(s=>e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.14em] text-white/45",children:s.label}),e.jsx("p",{className:"line-clamp-2",children:s.value})]},s.label))})()}),e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden rounded-2xl border border-white/10 bg-white/10 px-3 py-2",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.14em] text-white/45",children:"Overview"}),Kt?e.jsx("p",{className:"mt-1 min-h-0 flex-1 overflow-hidden text-[length:var(--mn-swipe-meta)] leading-relaxed text-white/70",style:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:V,overflow:"hidden"},children:Kt}):e.jsx("p",{className:"mt-1 text-[length:var(--mn-swipe-meta)] text-white/40",children:"No overview available."})]})]})]}):e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[e.jsxs("div",{className:"shrink-0 space-y-2",children:[(()=>{const t=o.source??"for-you",s=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.25)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/80",children:[e.jsx(I,{name:s.icon,filled:!0,className:"text-[length:calc(var(--mn-swipe-chip)+0.25rem)]"}),e.jsx("span",{className:"tracking-[0.12em]",children:s.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[fn,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"min-w-0 line-clamp-2 text-[clamp(1.25rem,5vw,1.75rem)] font-extrabold leading-[1.06] text-white",children:o.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.7)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:pn})]}),ot&&e.jsx("p",{className:"text-[clamp(0.78rem,2.8vw,0.95rem)] text-white/60 whitespace-nowrap overflow-hidden text-ellipsis",children:ot}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 text-[clamp(0.70rem,2.6vw,0.8rem)] text-white/65",children:[xe&&e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[e.jsx("span",{className:"shrink-0 font-semibold text-white/75",children:"Genres"}),e.jsx("span",{className:"min-w-0 flex-1 truncate",children:Array.isArray(xe)?xe.slice(0,3).join(", "):String(xe).split(",").map(t=>t.trim()).slice(0,3).join(", ")})]}),Xn&&e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 font-semibold text-white/85",children:Xn}),qn&&e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 font-semibold text-white/70",children:qn})]})]}),Kt?e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden rounded-2xl border border-white/10 bg-white/10 px-3 py-2",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.16em] text-white/45",children:"Overview"}),e.jsx("p",{className:"mt-1 min-h-0 flex-1 overflow-hidden text-[clamp(0.82rem,2.9vw,0.95rem)] leading-relaxed text-white/70",style:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:P,overflow:"hidden"},children:Kt})]}):e.jsx("div",{className:"min-h-0 flex-1"}),Ke||yt?e.jsxs("div",{className:"shrink-0 min-w-0 space-y-1 text-[clamp(0.70rem,2.6vw,0.78rem)] text-white/70",children:[Ke&&e.jsxs("p",{className:"line-clamp-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-white/75",children:"Director:"})," ",e.jsx("span",{className:"min-w-0",children:Ke})]}),yt&&e.jsxs("p",{className:"line-clamp-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-white/75",children:"Cast:"})," ",e.jsx("span",{className:"min-w-0",children:yt.split(",").map(t=>t.trim()).filter(Boolean).slice(0,4).join(", ")})]})]}):null,e.jsxs("div",{className:"shrink-0 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1.5",children:[e.jsx("span",{className:"text-[length:var(--mn-swipe-chip)] font-semibold text-white/50",children:"Your rating"}),e.jsx("div",{className:"flex items-center gap-0.5","aria-label":"Your rating",children:Array.from({length:5}).map((t,s)=>{const l=s+1,u=mn!=null&&mn>=l;return e.jsx("button",{type:"button",onClick:()=>rs(l),className:"flex h-[var(--mn-swipe-star-hit)] w-[var(--mn-swipe-star-hit)] items-center justify-center rounded-full hover:scale-105 focus-visible:outline-none",children:e.jsx(I,{name:"star",filled:u,className:`text-[length:var(--mn-swipe-star-icon)] ${u?"text-yellow-400":"text-white/30"}`})},l)})})]}),e.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{type:"button",onClick:()=>Qn(qe),className:`inline-flex items-center rounded-full px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold transition-colors ${Jn(qe)?"bg-primary/90 text-primary-foreground":"border border-white/10 bg-white/10 text-white/75 hover:bg-white/15"}`,children:"Watchlist"}),e.jsx("button",{type:"button",onClick:()=>Qn(ut),className:`inline-flex items-center rounded-full px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold transition-colors ${Jn(ut)?"bg-emerald-500/90 text-primary-foreground":"border border-white/10 bg-white/10 text-white/75 hover:bg-white/15"}`,children:"Watched"}),e.jsxs("button",{type:"button",onClick:()=>In(!0),className:"inline-flex items-center gap-1 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/75 hover:bg-white/15",children:[e.jsx(I,{name:"share",className:"text-[length:calc(var(--mn-swipe-chip)+0.2rem)]"}),e.jsx("span",{children:"Share"})]})]})]}),typeof o.friendLikesCount=="number"&&o.friendLikesCount>0||o.topFriendName&&o.topFriendReviewSnippet?e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.5)] text-[length:var(--mn-swipe-chip)] text-white/80 shadow-md",children:[typeof o.friendLikesCount=="number"&&o.friendLikesCount>0&&e.jsxs("div",{className:"inline-flex items-center gap-1 text-[length:var(--mn-swipe-chip)] text-white/60",children:[e.jsx(I,{name:"local_fire_department",filled:!0,className:"text-[16px] text-primary/80"}),o.friendLikesCount===1?"1 friend likes this":`${o.friendLikesCount} friends like this`]}),o.topFriendName&&o.topFriendReviewSnippet&&e.jsxs("div",{className:"mt-1 inline-flex w-full items-start gap-2 text-left",children:[e.jsx(I,{name:"check_circle",filled:!0,className:"mt-0.5 text-[16px] text-primary"}),e.jsxs("span",{className:"block line-clamp-2 text-[length:var(--mn-swipe-chip)]",children:[o.topFriendName,": “",o.topFriendReviewSnippet,"”"]})]})]}):null]})]})}),e.jsx("div",{className:"mt-2 flex shrink-0 justify-end",children:e.jsx("button",{type:"button",onClick:()=>Ne(t=>!t),"aria-expanded":ke,"aria-controls":"swipe-detail-panel",className:"inline-flex items-center gap-1 rounded-full border border-white/15 bg-white/5 px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/70 hover:bg-white/10 hover:text-white",children:e.jsx("span",{children:ke?"Collapse":"Full details"})})})]})]})]})]},de??"empty")})]}),Zt&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center bg-gradient-to-b from-background/70 via-background/50 to-background/80",children:e.jsxs("div",{className:"pointer-events-auto max-w-xs rounded-2xl border border-border bg-background/95 p-4 text-center shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Swipe to decide"}),e.jsx("p",{className:"mt-1 text-[12px] text-muted-foreground",children:"Swipe left to pass, right to save what you love."}),e.jsx("button",{type:"button",className:"mt-3 w-full rounded-xl bg-primary px-3 py-2 text-sm font-semibold text-white shadow-md",onClick:()=>{Ze(!1),typeof window<"u"&&Fe(It,"1")},children:"Got it"})]})})]})]}),e.jsxs("div",{className:"mt-3 flex shrink-0 items-center justify-center gap-2","aria-label":"Recommendation feedback",children:[e.jsxs("button",{type:"button",onClick:()=>Oe("dislike",0,"not_interested"),disabled:He,className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1.5 text-xs font-semibold text-white/70 shadow-sm backdrop-blur transition-all duration-150 hover:bg-white/10 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Not interested",children:[e.jsx(I,{name:"thumb_down",filled:!0,className:"text-[16px]"}),"Not interested"]}),e.jsxs("button",{type:"button",onClick:()=>Oe("like",0,"more_like_this"),disabled:He,className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1.5 text-xs font-semibold text-white/70 shadow-sm backdrop-blur transition-all duration-150 hover:bg-white/10 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"More like this",children:[e.jsx(I,{name:"auto_awesome",filled:!0,className:"text-[16px]"}),"More like this"]})]}),e.jsxs("div",{className:"mt-2 flex shrink-0 items-center justify-center gap-[var(--mn-swipe-gap)]","aria-label":"Swipe actions",children:[e.jsx("button",{type:"button",onClick:()=>Oe("dislike"),disabled:He,className:"inline-flex h-[var(--mn-swipe-action)] w-[var(--mn-swipe-action)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/60 shadow-md backdrop-blur transition-all duration-150 hover:bg-white/15 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Dislike",children:e.jsx(I,{name:"close",className:"text-[length:var(--mn-swipe-icon)]"})}),e.jsx("button",{type:"button",onClick:ts,disabled:He,className:"relative inline-flex h-[var(--mn-swipe-action-primary)] w-[var(--mn-swipe-action-primary)] items-center justify-center rounded-full bg-primary text-primary-foreground shadow-[0_22px_55px_rgba(0,0,0,0.55)] transition-all duration-150 hover:brightness-110 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Add to watchlist",children:e.jsx(I,{name:"bookmark_add",filled:!0,className:"text-[length:var(--mn-swipe-icon-primary)]"})}),e.jsx("button",{type:"button",onClick:()=>Oe("like"),disabled:He,className:"inline-flex h-[var(--mn-swipe-action)] w-[var(--mn-swipe-action)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/60 shadow-md backdrop-blur transition-all duration-150 hover:bg-white/15 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Like",children:e.jsx(I,{name:"favorite",filled:!0,className:"text-[length:var(--mn-swipe-icon)]"})})]}),e.jsx(wi,{isOpen:Ur,onClose:()=>In(!1),activeCard:o,shareUrl:ss,onShareExternal:is}),e.jsx(ii,{open:R,onOpenChange:Q,profiles:o?.friendProfiles??[],verb:o?.source==="from-friends"?"watched":"liked"}),e.jsx(Cr,{open:f,onOpenChange:v,children:e.jsxs(Er,{className:"max-w-md border border-border/60 bg-card text-foreground",children:[e.jsxs(Tr,{children:[e.jsx(Fr,{children:"Filters"}),e.jsx(Ds,{className:"text-muted-foreground",children:"Fine-tune what shows up in your Discovery deck."})]}),e.jsxs("div",{className:"mt-2 space-y-5",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs font-semibold tracking-wide text-muted-foreground",children:"Feedback"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>Dn(t=>!t),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",tt?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[e.jsx(I,{name:"vibration",filled:!0,className:"text-[18px] "+(tt?"text-primary":"text-muted-foreground")}),"Haptics"]}),e.jsxs("button",{type:"button",onClick:()=>Ln(t=>!t),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",et?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[e.jsx(I,{name:et?"volume_up":"volume_off",filled:!0,className:"text-[18px] "+(et?"text-primary":"text-muted-foreground")}),"Sound"]})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Turn these off if you prefer silent, minimal feedback."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs font-semibold tracking-wide text-muted-foreground",children:"Content type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{label:"All",value:null},{label:"Movies",value:"movie"},{label:"Series",value:"series"},{label:"Anime",value:"anime"}].map(t=>{const s=r===t.value;return e.jsxs("button",{type:"button",onClick:()=>a(t.value),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",s?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[s?e.jsx(I,{name:"check_circle",filled:!0,className:"text-[18px] text-primary"}):e.jsx("span",{className:"h-4 w-4"}),t.label]},t.label)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide text-muted-foreground",children:"Genres"}),b.length>0&&e.jsx("button",{type:"button",onClick:()=>j([]),className:"text-xs font-semibold text-primary hover:underline",children:"Clear"})]}),Tt.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Load a few cards to unlock genre filters."}):e.jsx("div",{className:"max-h-40 overflow-auto rounded-xl border border-border/60 bg-background/20 p-2",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Tt.map(t=>{const s=b.some(l=>l.toLowerCase()===t.toLowerCase());return e.jsx("button",{type:"button",onClick:()=>j(l=>s?l.filter(u=>u.toLowerCase()!==t.toLowerCase()):[...l,t]),className:["rounded-full border px-3 py-1 text-xs font-semibold transition",s?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-card/40 text-muted-foreground hover:bg-card/55"].join(" "),children:t},t)})})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide text-muted-foreground",children:"Minimum rating"}),e.jsx("div",{className:"text-xs font-semibold text-foreground",children:k<=0?"Any":k.toFixed(1)})]}),e.jsx("input",{type:"range",min:0,max:10,step:.5,value:k,onChange:t=>W(Number(t.target.value)),className:"w-full"}),e.jsxs("div",{className:"mt-1 flex justify-between text-[11px] text-muted-foreground",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"10"})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{a(null),j([]),W(0)},className:"flex-1 rounded-xl border border-border/60 bg-background/20 px-4 py-2 text-sm font-semibold text-muted-foreground hover:bg-background/35",children:"Reset"}),e.jsx("button",{type:"button",onClick:()=>v(!1),className:"flex-1 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground hover:opacity-90",children:"Done"})]})]})]})}),hs()]})]})},wi=({isOpen:n,onClose:r,activeCard:a,shareUrl:f,onShareExternal:v})=>{const{user:b}=Ir(),{data:j=[],isLoading:k}=As();if(i.useEffect(()=>{if(!n)return;const P=V=>{V.key==="Escape"&&r()};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[n,r]),!n||!a)return null;const W=`Check this out: ${a.title}

${f}`,re=P=>{P.target===P.currentTarget&&r()},q=P=>{(P.key==="Enter"||P.key===" ")&&r()};return e.jsx("div",{role:"button",tabIndex:0,className:"fixed inset-0 z-[9999] flex flex-col justify-end bg-black/55",onClick:re,onKeyDown:q,children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"pointer-events-auto mb-[72px] w-full max-w-md self-center rounded-t-2xl bg-card pb-3 pt-2 shadow-[0_-18px_45px_rgba(0,0,0,0.65)]",children:[e.jsxs("div",{className:"flex items-center justify-between px-[var(--page-pad-x)] pb-2",children:[e.jsx("button",{type:"button","aria-hidden":"true",tabIndex:-1,className:"inline-flex h-11 w-11 items-center justify-center rounded-full text-muted-foreground",children:e.jsx(I,{name:"search",className:"text-[18px]"})}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Send to"}),e.jsx("button",{type:"button",onClick:r,"aria-label":"Close",className:"inline-flex h-11 w-11 items-center justify-center rounded-full text-muted-foreground transition hover:bg-background/80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:e.jsx("span",{className:"text-[18px] leading-none",children:"×"})})]}),e.jsxs("section",{className:"border-t border-border px-[var(--page-pad-x)] pt-3 pb-2",children:[e.jsx("h2",{className:"mb-2 text-[12px] font-medium uppercase tracking-[0.08em] text-muted-foreground/90",children:"Send to"}),k?e.jsx("div",{className:"flex gap-3 overflow-hidden",children:Array.from({length:4}).map((P,V)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"h-11 w-11 animate-pulse rounded-full bg-border/50"}),e.jsx("div",{className:"h-2.5 w-12 animate-pulse rounded bg-border/40"})]},V))}):b?j.length===0?e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"No conversations yet. Start a chat from a profile or the Messages tab."}):e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:j.map(P=>e.jsx(gi,{conversation:P,text:W},P.id))}):e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"Sign in to share via messages."})]}),e.jsx("section",{className:"border-t border-border px-[var(--page-pad-x)] pt-3 pb-3",children:e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:[e.jsx(vi,{shareUrl:f,title:a.title}),e.jsx(ji,{shareUrl:f,title:a.title}),e.jsx(ki,{onShareExternal:v}),e.jsx(yi,{shareUrl:f})]})})]})})},gi=({conversation:n,text:r})=>{const a=n.isGroup?null:n.participants?.find(W=>!W.isSelf)??n.participants?.[0],f=a?.displayName??n.title??"Conversation",v=a?.avatarUrl,b=Ls(n.id),j=()=>{b.isPending||b.mutate({text:r})},k=f.split(" ").map(W=>W.charAt(0).toUpperCase()).slice(0,2).join("");return e.jsxs("button",{type:"button",onClick:j,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center overflow-hidden rounded-full bg-muted text-xs text-muted-foreground",children:v?e.jsx("img",{src:v,alt:f,className:"h-full w-full object-cover"}):e.jsx("span",{children:k})}),b.isSuccess&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-emerald-500",children:e.jsx(I,{name:"check",filled:!0,className:"text-[14px] text-primary-foreground"})})]}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:f})]})},yi=({shareUrl:n})=>{const r=async()=>{if(navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(n)}catch{}};return e.jsxs("button",{type:"button",onClick:r,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx(I,{name:"link",className:"text-[18px] text-primary-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Copy link"})]})},vi=({shareUrl:n,title:r})=>{const a=()=>{if(typeof window>"u")return;const f=`Check this out: ${r}

${n}`,v=`https://api.whatsapp.com/send?text=${encodeURIComponent(f)}`;window.open(v,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:a,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"W"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"WhatsApp"})]})},ji=({shareUrl:n,title:r})=>{const a=()=>{if(typeof window>"u")return;const f=`Check this out: ${r}

${n}`,v=`https://t.me/share/url?url=${encodeURIComponent(n)}&text=${encodeURIComponent(f)}`;window.open(v,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:a,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"T"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Telegram"})]})},ki=({onShareExternal:n})=>{const r=async()=>{await n()};return e.jsxs("button",{type:"button",onClick:r,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full border border-border bg-muted",children:e.jsx(I,{name:"more_horiz",className:"text-[18px] text-muted-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"More"})]})};export{zi as default};
