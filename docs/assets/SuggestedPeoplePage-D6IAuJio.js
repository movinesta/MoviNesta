import{u as v,b as y,R as N,j as e,B as m,M as C,o as E}from"./index-yaS868vE.js";import{T as F}from"./TopBar-DVbOlr27.js";import{D as P,a as S,b as k,c as x,d as T}from"./dropdown-menu-DMnOHk4s.js";import{u as M,U,E as D,C as R}from"./useSuggestedPeople-CHfmdrWi.js";import{u as I}from"./useToggleFollow-18dQkAwo.js";import{X as B}from"./x-DNY9LJhZ.js";import"./index-DQ8Wqi_L.js";import"./index-B227mAYG.js";import"./index-6Jf4GuQ-.js";import"./resolveAvatarUrl-Bv46IzST.js";import"./useMutation-WGdhQwN_.js";const $=async s=>{try{await navigator.clipboard.writeText(s)}catch{}},A=s=>s?s.startsWith("@")?s:`@${s}`:"",z=(s,d)=>{const l=(s||d||"").replace(/^@/,"").trim();if(!l)return"?";const i=l.split(/\s+/);return i.length===1?i[0].slice(0,2).toUpperCase():(i[0][0]+i[1][0]).toUpperCase()},Z=()=>{const s=v(),{data:d=[],isLoading:c,isError:l,error:i,dismissPerson:p}=M(),u=I(),{user:g}=y(),[h,f]=N.useState(null),b=async t=>{if(!g?.id){alert("You need to be signed in to start a conversation.");return}if(g.id===t){alert("You can't start a conversation with yourself.");return}f(t);try{const a=await E("create-direct-conversation",{targetUserId:t},{timeoutMs:25e3});if(!a?.ok||!a.conversationId){const r=a?.code;let o=a?.error??"Failed to get conversation id. Please try again.";throw r==="UNAUTHORIZED"?o="You need to be signed in to start a conversation.":r==="BAD_REQUEST_SELF_TARGET"?o="You can't start a conversation with yourself.":r==="SERVER_MISCONFIGURED"&&(o="Messaging is temporarily unavailable due to a server issue. Please try again later."),new Error(o)}s(`/messages/${a.conversationId}`)}catch(a){console.error("[SuggestedPeoplePage] Failed to start conversation",a);const r=a instanceof Error?a.message:"Something went wrong while starting the conversation. Please try again.";alert(r)}finally{f(null)}};return e.jsxs("div",{className:"flex flex-1 flex-col pb-24",children:[e.jsx(F,{title:"Suggested people",onBack:()=>s(-1)}),c&&e.jsx("div",{className:"px-4 py-6 text-xs text-muted-foreground",children:"Loading suggestions…"}),l&&e.jsx("div",{className:"px-4 py-6",children:e.jsxs("div",{className:"rounded-2xl border border-destructive/40 bg-destructive/5 p-4 text-xs text-foreground shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:"Unable to load suggestions."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:i?.message??"Please try again in a moment."})]})}),!c&&!l&&d.length===0&&e.jsx("div",{className:"flex flex-1 items-center justify-center px-4 py-12",children:e.jsxs("div",{className:"max-w-sm rounded-2xl border border-border bg-card/80 p-5 text-center text-xs text-muted-foreground shadow-lg",children:[e.jsx("div",{className:"mx-auto mb-3 flex h-10 w-10 items-center justify-center rounded-2xl bg-primary/15",children:e.jsx(U,{className:"h-5 w-5 text-primary","aria-hidden":"true"})}),e.jsx("p",{className:"font-heading text-sm font-semibold text-foreground",children:"All caught up"}),e.jsx("p",{className:"mt-1 text-xs",children:"No new suggestions right now. Check back later."})]})}),e.jsx("div",{className:"space-y-3 px-3 py-4",children:d.map(t=>{const a=A(t.username),r=t.displayName||a||"User",o=u.isPending&&u.variables?.targetUserId===t.id,w=!!(h&&h===t.id),j=typeof t.commonTitlesCount=="number"&&t.commonTitlesCount>0?`${t.commonTitlesCount} in common`:"Suggested for you";return e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-border bg-card/80 p-3 shadow-lg",children:[e.jsx("button",{type:"button",onClick:()=>p(t.id),className:"absolute right-2 top-2 inline-flex h-8 w-8 items-center justify-center rounded-full text-muted-foreground hover:bg-muted hover:text-foreground","aria-label":"Dismiss suggestion",children:e.jsx(B,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-center gap-3",role:"button",tabIndex:0,onClick:()=>{t.username&&s(`/u/${t.username}`)},onKeyDown:n=>{n.key==="Enter"&&t.username&&s(`/u/${t.username}`)},children:[t.avatarUrl?e.jsx("img",{src:t.avatarUrl,alt:r,className:"h-12 w-12 rounded-full object-cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-muted text-xs font-semibold text-foreground",children:z(t.displayName,t.username)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:r}),e.jsx("p",{className:"truncate text-xs text-muted-foreground",children:a}),e.jsx("p",{className:"mt-0.5 line-clamp-1 text-xs text-muted-foreground",children:j})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{type:"button",size:"sm",disabled:o,onClick:n=>{n.stopPropagation(),u.mutate({targetUserId:t.id,currentlyFollowing:t.isFollowing})},className:t.isFollowing?"h-8 rounded-full bg-muted px-3 text-xs text-foreground hover:bg-muted/80":"h-8 rounded-full px-3 text-xs",children:o?"…":t.isFollowing?"Following":"Follow"}),e.jsx(m,{type:"button",size:"icon",variant:"secondary",className:"h-8 w-8 rounded-full",disabled:w,onClick:n=>{n.stopPropagation(),b(t.id)},"aria-label":"Message",children:e.jsx(C,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs(P,{children:[e.jsx(S,{asChild:!0,children:e.jsx(m,{type:"button",size:"icon",variant:"secondary",className:"h-8 w-8 rounded-full",onClick:n=>n.stopPropagation(),"aria-label":"More",children:e.jsx(D,{className:"h-4 w-4","aria-hidden":"true"})})}),e.jsxs(k,{align:"end",className:"w-44",children:[e.jsxs(x,{onClick:()=>{t.username&&$(`${window.location.origin}/u/${t.username}`)},disabled:!t.username,children:[e.jsx(R,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Copy profile link"]}),e.jsx(T,{}),e.jsx(x,{disabled:!0,children:"Report"}),e.jsx(x,{disabled:!0,children:"Block"})]})]})]})]})]},t.id)})})]})};export{Z as default};
