import{c as v,g as N,n as w,r as m,h as S,o as _,j as e,d as A,s as k}from"./index-DLcJPtaT.js";import{T as C}from"./TopBar-fWfwmUrG.js";import{L as h}from"./loader-circle-MYGw9Oqr.js";import{I as P}from"./info-lkFNDLce.js";import{B as E}from"./bell-CrfU4zqS.js";import{C as R}from"./circle-check-72lKqrQ8.js";import{C as I}from"./circle-alert-D3BN2XF-.js";import{T as F}from"./thumbs-up-i-F1NwAS.js";import"./PageChrome-DNNm9VG4.js";import"./brand-DTIDtbc4.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=v("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]),c={emailActivity:!0,emailRecommendations:!0,inAppSocial:!0,inAppSystem:!0},u=["notification-preferences"],W=()=>{const{user:t}=N(),b=w(),[i,d]=m.useState(c),[x,l]=m.useState("idle"),{data:n,isLoading:f,isError:y,error:p}=S({queryKey:u,enabled:!!t,queryFn:async()=>{const{data:s,error:a}=await k.from("notification_preferences").select("user_id, email_activity, email_recommendations, in_app_social, in_app_system, updated_at").eq("user_id",t.id).maybeSingle();if(a)throw a;return s||{user_id:t.id,email_activity:c.emailActivity,email_recommendations:c.emailRecommendations,in_app_social:c.inAppSocial,in_app_system:c.inAppSystem,updated_at:new Date().toISOString()}}});m.useEffect(()=>{n&&d({emailActivity:n.email_activity,emailRecommendations:n.email_recommendations,inAppSocial:n.in_app_social,inAppSystem:n.in_app_system})},[n]);const r=_({mutationFn:async s=>{const a=await A("update-notification-prefs",{emailActivity:s.emailActivity,emailRecommendations:s.emailRecommendations,inAppSocial:s.inAppSocial,inAppSystem:s.inAppSystem});if(!a.ok)throw new Error(a.error??"Unable to save preferences");return a.preferences},onSuccess:s=>{l("saved"),b.setQueryData(u,{user_id:(t==null?void 0:t.id)??"",email_activity:s.emailActivity,email_recommendations:s.emailRecommendations,in_app_social:s.inAppSocial,in_app_system:s.inAppSystem,updated_at:s.updatedAt})},onError:s=>{console.error("Failed to save notification preferences",s),l("error")}}),o=s=>a=>{d(g=>({...g,[s]:a.target.checked})),l("idle")},j=async()=>{!t||r.isPending||await r.mutateAsync(i)};return t?f?e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center px-4",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-mn-card border border-mn-border-subtle/80 bg-mn-bg-elevated/80 px-4 py-3 text-sm text-mn-text-secondary shadow-mn-card",children:[e.jsx(h,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Loading your notification preferences…"})]})}):y||!n?e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md rounded-mn-card border border-mn-border-subtle/80 bg-mn-bg-elevated/80 px-4 py-6 text-center text-sm text-mn-text-primary shadow-mn-card",children:[e.jsx("h1",{className:"text-base font-heading font-semibold",children:"Notifications unavailable"}),e.jsx("p",{className:"mt-2 text-xs text-mn-text-secondary",children:"We couldn't load your preferences right now."}),p&&e.jsxs("p",{className:"mt-2 text-[11px] text-mn-text-muted",children:[e.jsx("span",{className:"font-semibold",children:"Details:"})," ",p.message]})]})}):e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-2 pt-1",children:[e.jsx(C,{title:"Notifications",subtitle:"Control how MoviNesta keeps in touch with you."}),e.jsxs("div",{className:"mx-4 flex items-start gap-2 rounded-md border border-mn-border-subtle/70 bg-mn-bg-elevated/70 p-3 text-[12px] text-mn-text-secondary shadow-mn-card",children:[e.jsx(P,{className:"mt-0.5 h-4 w-4 text-mn-text-secondary","aria-hidden":"true"}),e.jsx("p",{className:"leading-relaxed",children:"Notification preferences are saved to your MoviNesta account and sync across devices. These toggles control both in-app surfaces and any email digests you opt into."})]}),e.jsxs("section",{className:"space-y-4 px-4 pb-24",children:[e.jsxs("div",{className:"space-y-3 rounded-mn-card border border-mn-border-subtle/80 bg-mn-bg-elevated/80 p-4 shadow-mn-card",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-mn-border-subtle/50",children:e.jsx(M,{className:"h-4 w-4 text-mn-text-secondary","aria-hidden":"true"})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h2",{className:"text-sm font-heading font-semibold text-mn-text-primary",children:"Email"}),e.jsx("p",{className:"text-[11px] text-mn-text-secondary",children:"Occasional updates from MoviNesta in your inbox."})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 text-[12px]",children:[e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-mn-text-primary",children:"Activity on your content"}),e.jsx("span",{className:"block text-[11px] text-mn-text-secondary",children:"New followers, comments, and reactions."})]}),e.jsx("input",{type:"checkbox",checked:i.emailActivity,onChange:o("emailActivity"),className:"mt-1 h-4 w-4 rounded border-mn-border-subtle bg-mn-bg text-mn-accent","aria-label":"Email activity notifications"})]}),e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-mn-text-primary",children:"Recommendations"}),e.jsx("span",{className:"block text-[11px] text-mn-text-secondary",children:"Personalized movie picks and weekly digests."})]}),e.jsx("input",{type:"checkbox",checked:i.emailRecommendations,onChange:o("emailRecommendations"),className:"mt-1 h-4 w-4 rounded border-mn-border-subtle bg-mn-bg text-mn-accent","aria-label":"Email recommendations"})]})]})]}),e.jsxs("div",{className:"space-y-3 rounded-mn-card border border-mn-border-subtle/80 bg-mn-bg-elevated/80 p-4 shadow-mn-card",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-mn-border-subtle/50",children:e.jsx(E,{className:"h-4 w-4 text-mn-text-secondary","aria-hidden":"true"})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h2",{className:"text-sm font-heading font-semibold text-mn-text-primary",children:"In-app notifications"}),e.jsx("p",{className:"text-[11px] text-mn-text-secondary",children:"What shows up inside the app. Push and OS-level settings still apply."})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 text-[12px]",children:[e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-mn-text-primary",children:"Social activity"}),e.jsx("span",{className:"block text-[11px] text-mn-text-secondary",children:"Follows, reactions, and friend activity."})]}),e.jsx("input",{type:"checkbox",checked:i.inAppSocial,onChange:o("inAppSocial"),className:"mt-1 h-4 w-4 rounded border-mn-border-subtle bg-mn-bg text-mn-accent","aria-label":"In-app social notifications"})]}),e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-mn-text-primary",children:"System messages"}),e.jsx("span",{className:"block text-[11px] text-mn-text-secondary",children:"Account notices, billing, and other important updates."})]}),e.jsx("input",{type:"checkbox",checked:i.inAppSystem,onChange:o("inAppSystem"),className:"mt-1 h-4 w-4 rounded border-mn-border-subtle bg-mn-bg text-mn-accent","aria-label":"In-app system messages"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-1",children:[e.jsxs("div",{className:"min-h-[20px] flex-1 text-[11px]",children:[x==="saved"&&e.jsxs("div",{className:"flex items-center gap-1.5 text-emerald-400",children:[e.jsx(R,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Notification preferences saved to your account."})]}),x==="error"&&e.jsxs("div",{className:"flex items-center gap-1.5 text-mn-error",children:[e.jsx(I,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Couldn't save preferences. Try again."})]})]}),e.jsxs("button",{type:"button",onClick:j,disabled:r.isPending,className:"inline-flex items-center gap-1.5 rounded-full bg-mn-accent/90 px-3.5 py-1.5 text-xs font-medium text-black shadow-mn-card transition hover:bg-mn-accent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-accent/70 focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg disabled:cursor-not-allowed disabled:opacity-70",children:[r.isPending?e.jsx(h,{className:"h-3.5 w-3.5 animate-spin","aria-hidden":"true"}):e.jsx(F,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:r.isPending?"Saving…":"Save preferences"})]})]})]})]}):e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md rounded-mn-card border border-mn-border-subtle/80 bg-mn-bg-elevated/80 px-4 py-6 text-center text-sm text-mn-text-primary shadow-mn-card",children:[e.jsx("h1",{className:"text-base font-heading font-semibold",children:"You're signed out"}),e.jsx("p",{className:"mt-2 text-xs text-mn-text-secondary",children:"Sign in to manage how MoviNesta contacts you."})]})})};export{W as default};
