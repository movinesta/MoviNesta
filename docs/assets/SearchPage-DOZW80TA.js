import{c as $,r as j,j as e,h as Z,i as O,t as J,k as H,s as T,l as X,R as E,B as S,L as W,d as V,e as ee,u as te,M as re,m as se}from"./index-fug2llhW.js";import{C as ae}from"./Chip-B1SIVa3M.js";import{T as ne,a as oe,b as z}from"./Tabs-vFvQHl4U.js";import{S as le}from"./SearchField-BwPbPE0n.js";import{P as ie}from"./PageChrome-CqQc8kbT.js";import{T as de}from"./TopBar-Cwkp26YK.js";import{Y as ce}from"./index-DwcsHdQg.js";import{F as G}from"./film-U7k7qJw1.js";import{S as ue}from"./star-COq6dKFa.js";import{u as me,U as xe,a as fe}from"./useToggleFollow-DTSq-aBP.js";import{U as pe}from"./users-BhnP_LC4.js";import{U as he}from"./user-CvXjFL_D.js";import"./index-Ab52zN-Q.js";const ge=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],B=$("funnel",ge);const be=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],ye=$("languages",be);const ve=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],q=$("sliders-horizontal",ve);const je=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],D=$("x",je),R=j.forwardRef(({className:r,type:s,...u},a)=>e.jsx("input",{type:s,className:Z("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:a,...u}));R.displayName="Input";const we=(r,s)=>{const[u,a]=j.useState(r);return j.useEffect(()=>{const i=window.setTimeout(()=>{a(r)},s);return()=>{window.clearTimeout(i)}},[r,s]),u},Ne=["all","movie","series","anime"],Q=r=>r.get("tab")==="people"?"people":"titles",L=r=>{if(typeof r!="number")return;const s=new Date().getFullYear();return Math.min(Math.max(r,1900),s)},_e=r=>{const s=r.get("type"),u=Ne.includes(s)?s:"all",a=m=>{if(!m)return;const g=Number(m);return Number.isFinite(g)?g:void 0},i=L(a(r.get("minYear"))),x=L(a(r.get("maxYear"))),d=r.get("lang")||void 0;return i&&x&&i>x?{type:u,minYear:x,maxYear:i,originalLanguage:d}:{type:u,minYear:i,maxYear:x,originalLanguage:d}},P=r=>{if(r?.aborted)throw r.reason??new DOMException("Aborted","AbortError")};async function ke(r,s){const u=r.map(async a=>{if(a.imdbId||!a.tmdbId)return a;P(s);try{const i=await O(`/${a.type==="tv"?"tv":"movie"}/${a.tmdbId}/external_ids`,{},s);return P(s),{...a,imdbId:i?.imdb_id??null}}catch(i){return console.warn("[externalMovieSearch] Failed to fetch external ids for",a.tmdbId,i),a}});return Promise.all(u)}async function Ie(r,s=1,u){const a=r.trim();if(!a)return{results:[],hasMore:!1};P(u);const i=await O("/search/multi",{query:a,include_adult:!1,page:s},u);P(u);const x=Array.isArray(i?.results)?i.results:[];if(!x.length)return{results:[],hasMore:!1};const d=typeof i?.total_pages=="number"?i.total_pages:1,m=x.filter(f=>!!(f&&typeof f.id=="number"&&(f.media_type==="movie"||f.media_type==="tv"))).slice(0,20).map(f=>{const p=f.media_type==="tv"?"tv":"movie",h=f.release_date??f.first_air_date??null,v=h?Number(String(h).slice(0,4)):null;return{tmdbId:Number(f.id),imdbId:f.imdb_id??null,title:f.title??f.name??"Untitled",year:Number.isNaN(v)?null:v,type:p,posterUrl:J(f.poster_path??null)}});return{results:await ke(m,u),hasMore:s<d}}const M=r=>{if(r?.aborted)throw r.reason??new DOMException("Aborted","AbortError")},Se=r=>{const s=r.poster_url??r.backdrop_url??null;return{id:r.title_id,title:r.primary_title??r.original_title??"Untitled",year:r.release_year,type:r.content_type,source:"library",posterUrl:s,originalLanguage:r.language,ageRating:r.omdb_rated,imdbRating:r.imdb_rating,rtTomatoMeter:r.rt_tomato_pct,imdbId:r.omdb_imdb_id,tmdbId:r.tmdb_id}},U=20,Ce=5,Fe=async(r,s,u,a)=>{M(a);const i=`
    title_id,
    primary_title,
    original_title,
    release_year,
    content_type,
    poster_url,
    backdrop_url,
    language,
    omdb_rated,
    omdb_imdb_id,
    tmdb_id,
    imdb_rating,
    rt_tomato_pct
  `,x=(u-1)*U;let d=T.from("titles").select(i,{count:"exact"});if(s?.genreIds?.length){const{data:b,error:_}=await T.from("title_genres").select("title_id").in("genre_id",s.genreIds);if(_)throw new Error(_.message);d=d.in("title_id",b.map(o=>o.title_id))}if(d=d.range(x,x+U-1),a&&(d=d.abortSignal(a)),r){const b=`%${r}%`;d=d.or(`primary_title.ilike.${b},original_title.ilike.${b}`)}s?.type&&s.type!=="all"&&(d=d.eq("content_type",s.type)),typeof s?.minYear=="number"&&(d=d.gte("release_year",s.minYear)),typeof s?.maxYear=="number"&&(d=d.lte("release_year",s.maxYear)),s?.originalLanguage&&(d=d.eq("language",s.originalLanguage)),d=d.order("release_year",{ascending:!1,nullsLast:!0}).order("primary_title",{ascending:!0,nullsLast:!1});const{data:m,error:g,count:f}=await d;if(g)throw new Error(g.message);M(a);const p=m??[],h=typeof f=="number"?f:void 0,v=h?x+p.length<h:p.length===U;return{results:p.map(Se),hasMore:v}},Te=async r=>{const{query:s,filters:u,page:a=1,signal:i}=r,x=s.trim();M(i);let d=[],m=!1;try{const{results:t,hasMore:c}=await Fe(x,u,a,i);d=t,m=c}catch(t){console.warn("[search.service] Supabase search failed, falling back to TMDb",t)}const{results:g,hasMore:f}=await Ie(x,a,i);if(M(i),!g.length&&d.length>0)return{results:d,hasMore:m};const p=new Set,h=new Set;for(const t of d)t.tmdbId&&p.add(t.tmdbId),t.imdbId&&h.add(t.imdbId);const v=g.filter(t=>t.tmdbId&&!p.has(t.tmdbId)).slice(0,Ce),b=new Map;if(v.length)try{const c=(await H("catalog-sync-batch",{items:v.map(l=>({tmdbId:l.tmdbId,imdbId:l.imdbId??void 0,contentType:l.type==="tv"?"series":"movie"})),options:{syncOmdb:!0,syncYoutube:!0,forceRefresh:!1}},{signal:i}))?.results??[];for(const l of c)l.tmdbId&&l.titleId&&b.set(l.tmdbId,l.titleId)}catch(t){console.warn("[search.service] catalog-sync-batch failed",t)}const _=await Promise.all(g.map(async t=>{M(i);const c=!!(t.tmdbId&&p.has(t.tmdbId)),l=!!(t.imdbId&&h.has(t.imdbId));if(c||l)return null;const I=t.type==="tv"?"series":"movie",k=t.tmdbId&&b.get(t.tmdbId)?b.get(t.tmdbId):`tmdb-${t.tmdbId}`,F=k.startsWith("tmdb-")===!1;return t.tmdbId&&p.add(t.tmdbId),t.imdbId&&h.add(t.imdbId),{id:k,title:t.title,year:t.year??null,type:I,source:F?"external-synced":"external-only",posterUrl:t.posterUrl,originalLanguage:null,ageRating:null,imdbRating:null,rtTomatoMeter:null,imdbId:t.imdbId??null,tmdbId:t.tmdbId}}));return{results:[...d,..._.filter(t=>!!t)],hasMore:m||f}},Me=r=>{const{query:s,filters:u}=r,a=s.trim();return X({queryKey:["search","titles",{query:a,filters:u}],enabled:a.length>0,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:(i,x)=>i.hasMore?x.length+1:void 0,queryFn:({signal:i,pageParam:x})=>Te({query:a,filters:u,page:x??1,signal:i})})},Ye=({item:r})=>{const s=[];r.year&&s.push(String(r.year)),r.type==="movie"&&s.push("Movie"),r.type==="series"&&s.push("Series"),r.type==="anime"&&s.push("Anime"),r.originalLanguage&&s.push(`Language: ${r.originalLanguage}`),r.ageRating&&s.push(r.ageRating),r.imdbRating&&s.push(`IMDb ${r.imdbRating.toFixed(1)}`),r.rtTomatoMeter&&s.push(`RT ${r.rtTomatoMeter}%`);const u={library:"Library","external-synced":"Synced","external-only":"External"},a={library:"bg-primary/10 text-primary border-primary/40","external-synced":"bg-emerald-500/10 text-emerald-400 border-emerald-500/30","external-only":"bg-card text-muted-foreground border-border"};return e.jsx("div",{children:e.jsxs(W,{to:`/title/${r.id}`,className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2 hover:bg-card/80",children:[r.posterUrl?e.jsx("img",{src:r.posterUrl,alt:r.title,className:"h-20 w-14 rounded-2xl object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-20 w-14 items-center justify-center rounded-2xl bg-muted",children:e.jsx(G,{className:"h-5 w-5 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-[12px] font-medium text-foreground",children:r.title}),e.jsx("span",{className:`shrink-0 rounded-full border px-2 py-0.5 text-xs font-medium ${a[r.source]}`,children:u[r.source]})]}),s.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.join(" • ")})]})]})})},Re=({query:r,filters:s,onResetFilters:u})=>{const a=r.trim(),{data:i,isLoading:x,isError:d,error:m,fetchNextPage:g,hasNextPage:f,isFetchingNextPage:p}=Me({query:a,filters:s}),h=i?.pages.flatMap(t=>t.results)??[],v=h.length,b=[];if(s.type&&s.type!=="all"){const t={movie:"Movies",series:"Series",anime:"Anime",all:"All"};b.push(t[s.type])}typeof s.minYear=="number"&&b.push(`From ${s.minYear}`),typeof s.maxYear=="number"&&b.push(`Up to ${s.maxYear}`),s.originalLanguage&&b.push(`Language: ${s.originalLanguage==="en"?"English":s.originalLanguage}`);const _=b.length?b.join(" • "):"No filters applied",o=E.useRef(new Set);return E.useEffect(()=>{if(!h||!Array.isArray(h))return;const t=o.current;h.filter(l=>!(t.has(l.id)||!l.imdbId&&!l.tmdbId||l.imdbRating||l.rtTomatoMeter)).slice(0,3).forEach(l=>{t.add(l.id),T.functions.invoke("catalog-sync",{body:{external:{tmdbId:l.tmdbId??void 0,imdbId:l.imdbId??void 0,type:l.type==="series"?"tv":"movie"},options:{syncOmdb:!0,forceRefresh:!1}}}).catch(I=>{console.warn("[SearchTitlesTab] catalog-sync failed for",l.id,I)})})},[h]),a?x?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["Searching for ",e.jsx("span",{className:"font-semibold text-foreground",children:a}),"…"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fetching matching titles from your catalog and external sources."}),e.jsx("div",{className:"space-y-2",children:[0,1,2].map(t=>e.jsxs("div",{className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2",children:[e.jsx("div",{className:"h-16 w-11 animate-pulse rounded-xl bg-card/60"}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center space-y-1.5",children:[e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-card/60"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-card/40"})]})]},t))})]}):d?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-destructive",children:"Something went wrong while searching for titles."}),m&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Details: "}),m.message]})]}):v?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-semibold text-foreground",children:v})," result",v===1?"":"s"," across your catalog and external sources for"," ",e.jsx("span",{className:"font-semibold text-foreground",children:a}),"."]}),e.jsxs(S,{type:"button",variant:"outline",size:"sm",className:"h-auto rounded-full border-border px-2 py-1 text-muted-foreground hover:border-border hover:text-foreground",onClick:u,children:[e.jsx(q,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Reset filters"})]})]}),e.jsx("div",{className:"rounded-2xl border border-border bg-background/60 p-3",children:e.jsxs("p",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground",children:e.jsx(q,{className:"h-3 w-3","aria-hidden":"true"})}),e.jsx("span",{className:"truncate",children:_})]})}),e.jsx(ce,{style:{height:"70vh"},data:h,endReached:()=>{f&&!p&&g()},components:{List:E.forwardRef(function(c,l){return e.jsx("div",{ref:l,className:"space-y-2",...c})}),Footer:()=>f?e.jsx("div",{className:"flex justify-center py-3",children:e.jsx(S,{type:"button",className:"inline-flex items-center justify-center rounded-full bg-primary/90 disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>g(),disabled:p,children:p?"Loading more…":"Load more results"})}):null},itemContent:(t,c)=>e.jsx(Ye,{item:c})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No titles found matching"," ",e.jsx("span",{className:"font-semibold text-foreground",children:a}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search or removing some filters to see more results."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a title, director, or genre to search the catalog. As you wire Supabase search, results will appear here."}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-xs font-medium text-foreground",children:"Try searching for"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-xs",children:["Sci-fi romance","Feel-good comedies","Films from 2020s","Cozy rainy-day movies"].map(t=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-border px-2 py-1 text-muted-foreground",children:[e.jsx(G,{className:"mr-1 h-3 w-3 text-muted-foreground","aria-hidden":"true"}),t]},t))})]}),e.jsxs("div",{className:"space-y-1.5 rounded-2xl border border-border bg-background/60 p-3",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs font-medium text-foreground",children:[e.jsx(ue,{className:"h-3.5 w-3.5 text-primary","aria-hidden":"true"}),e.jsx("span",{children:"Trending this week"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Once analytics are wired up, you can show what your friends and the community are watching the most here."})]})]})},Y=r=>{if(r?.aborted)throw r.reason??new DOMException("Aborted","AbortError")},Le=r=>{const u=r.trim().replace(/^@+/,""),a=u.toLowerCase(),{user:i}=V();return ee({queryKey:["search","people",{query:u,userId:i?.id??null}],enabled:u.length>0,staleTime:1e3*60*15,gcTime:1e3*60*30,queryFn:async({signal:x})=>{Y(x);const d=u.replace(/%/g,"\\%").replace(/_/g,"\\_");let m=T.from("profiles").select("id, username, display_name, avatar_url, bio").or(`username.ilike.%${d}%,display_name.ilike.%${d}%`).limit(20);i?.id&&(m=m.neq("id",i.id)),x&&(m=m.abortSignal(x));const g=await m;if(Y(x),g.error)throw new Error(g.error.message);const f=g.data??[],p=f.map(t=>t.id);let h=new Map;if(p.length){let t=T.from("user_stats").select("user_id, followers_count, following_count").in("user_id",p);x&&(t=t.abortSignal(x));const c=await t;Y(x),c.error?console.warn("[useSearchPeople] Failed to load user_stats",c.error.message):h=new Map((c.data??[]).map(l=>[l.user_id,{followersCount:l.followers_count??0,followingCount:l.following_count??0}]))}if(!i?.id)return f.map(t=>{const c=h.get(t.id);return{id:t.id,username:t.username,displayName:t.display_name,avatarUrl:t.avatar_url,bio:t.bio,followersCount:c?.followersCount??null,followingCount:c?.followingCount??null,isFollowing:!1}});let v=T.from("follows").select("followed_id").eq("follower_id",i.id);x&&(v=v.abortSignal(x));const b=await v;Y(x),b.error&&console.warn("[useSearchPeople] Failed to load follows for current user",b.error.message);const _=new Set((b.data??[]).map(t=>t.followed_id));return f.map(t=>{const c=h.get(t.id),l=t.username??"",I=t.display_name??"",k=l.toLowerCase(),F=I.toLowerCase();let C=0;k===a?C+=100:k.startsWith(a)?C+=80:F.startsWith(a)?C+=60:k.includes(a)?C+=40:F.includes(a)&&(C+=30);const n=Math.min(15,Math.floor((c?.followersCount??0)/500));return{id:t.id,username:t.username,displayName:t.display_name,avatarUrl:t.avatar_url,bio:t.bio,followersCount:c?.followersCount??null,followingCount:c?.followingCount??null,isFollowing:_.has(t.id),relevance:C+n}}).sort((t,c)=>{if(c.relevance!==t.relevance)return c.relevance-t.relevance;const l=(t.displayName??t.username??"").toLowerCase(),I=(c.displayName??c.username??"").toLowerCase();return l.localeCompare(I)}).map(({relevance:t,...c})=>c)}})},Pe=({query:r})=>{const s=r.trim(),u=s.replace(/^@+/,""),a=u||s,{data:i,isLoading:x,isError:d,error:m}=Le(u),g=me(),f=te(),{user:p}=V(),[h,v]=j.useState(null),b=i??[],_=async o=>{if(!p?.id){alert("You need to be signed in to start a conversation.");return}if(p.id===o){alert("You can't start a conversation with yourself.");return}v(o);try{const t=await H("create-direct-conversation",{targetUserId:o},{timeoutMs:25e3});if(!t?.ok||!t.conversationId){const c=t?.errorCode;let l=t?.error??"Failed to get conversation id. Please try again.";c==="UNAUTHORIZED"?l="You need to be signed in to start a conversation.":c==="BAD_REQUEST_SELF_TARGET"?l="You can't start a conversation with yourself.":c==="SERVER_MISCONFIGURED"&&(l="Messaging is temporarily unavailable due to a server issue. Please try again later.");const I=new Error(l);throw I.code=c,I}f(`/messages/${t.conversationId}`)}catch(t){console.error("[SearchPeopleTab] Failed to start conversation",t);const c=t instanceof Error?t.message:"Something went wrong while starting the conversation. Please try again.";alert(c)}finally{v(null)}};return u?x?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Searching for people…"}),e.jsx("div",{className:"rounded-2xl border border-border bg-card/80 px-3 py-4 text-xs text-muted-foreground",children:"We'll show matching profiles here as soon as the results come back."})]}):d?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-foreground",children:"Something went wrong."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:m?.message??"We couldn&apos;t search for people right now. Please try again."})]}):!b||b.length===0?e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No people found for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",a,"”"]}),". Try a different name or username."]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",b.length," profile",b.length===1?"":"s"," for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",a,"”"]})]})}),e.jsx("ul",{className:"divide-y divide-border/60 rounded-2xl border border-border bg-card/80",children:b.map(o=>{const t=o.displayName??o.username??"Unknown user",c=o.username?`@${o.username}`:null,l=g.isPending&&g.variables?.targetUserId===o.id;return e.jsxs("li",{className:"flex items-center justify-between gap-3 px-3 py-2 hover:bg-card/80",children:[e.jsxs(W,{to:o.username?`/u/${o.username}`:`/u/${o.id}`,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-card/80 text-[14px] font-semibold text-foreground",children:o.avatarUrl?e.jsx("img",{src:o.avatarUrl,alt:t,className:"h-8 w-8 rounded-full object-cover",loading:"lazy"}):t?t[0]?.toUpperCase():e.jsx(he,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",children:t}),c&&e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:c}),o.bio&&e.jsx("p",{className:"mt-0.5 line-clamp-2 text-xs text-muted-foreground",children:o.bio}),(typeof o.followersCount=="number"||typeof o.followingCount=="number")&&e.jsxs("p",{className:"mt-0.5 text-xs text-muted-foreground",children:[typeof o.followersCount=="number"&&e.jsxs("span",{children:[o.followersCount," follower",o.followersCount===1?"":"s"]}),typeof o.followersCount=="number"&&typeof o.followingCount=="number"&&e.jsx("span",{children:" · "}),typeof o.followingCount=="number"&&e.jsxs("span",{children:["following ",o.followingCount]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{type:"button",onClick:()=>g.mutate({targetUserId:o.id,currentlyFollowing:o.isFollowing}),disabled:l,variant:o.isFollowing?"outline":"default",size:"sm",className:`h-auto rounded-full px-2.5 py-1.5 text-xs font-medium ${o.isFollowing?"border-border bg-card/80 text-foreground hover:border-primary/70 hover:text-foreground disabled:opacity-60":"border border-transparent bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-60"}`,children:l?e.jsx("span",{children:"Updating…"}):o.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}),p?.id!==o.id&&e.jsx(S,{type:"button",onClick:()=>_(o.id),disabled:h===o.id,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-card/80 px-2.5 py-1.5 text-xs font-medium text-foreground shadow-md hover:border-primary/70 hover:text-foreground disabled:cursor-not-allowed disabled:opacity-60",children:h===o.id?e.jsx("span",{children:"Starting…"}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Message"})]})})]})]},o.id)})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a name or @username to find people. Once the social graph is wired up, you'll be able to follow friends and start conversations from here."}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-2 text-xs text-muted-foreground",children:[e.jsx(pe,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Search for people you know, then follow or message them."})]})]})},Ge=()=>{const[r,s]=se(),u=j.useMemo(()=>Q(r),[r]),a=r.get("q")??"",[i,x]=j.useState(a),d=we(i,300),m=j.useMemo(()=>_e(r),[r]),[g,f]=j.useState(!1),p=j.useCallback(n=>{const y=new URLSearchParams(r);n(y),s(y,{replace:!0})},[r,s]),h=j.useCallback(n=>{n.delete("type"),n.delete("minYear"),n.delete("maxYear"),n.delete("lang")},[]),v=j.useCallback(n=>{const y=n;p(w=>{w.set("tab",y),w.get("q")||h(w)}),y!=="titles"&&f(!1)},[h,p]),b=()=>{x(""),p(n=>{n.delete("q"),h(n)}),f(!1)},_=j.useCallback(n=>{const y=n.trim();p(w=>{const A=Q(w);y?(w.set("q",y),w.set("tab",A)):(w.delete("q"),h(w))}),y||f(!1)},[h,p]);j.useEffect(()=>{_(d)},[d,_]),j.useEffect(()=>{a!==i&&x(a)},[a]);const o=j.useCallback(n=>{p(y=>{const w={...m,...n},A=L(w.minYear),K=L(w.maxYear),N={...w,minYear:A??void 0,maxYear:K??void 0};N.minYear&&N.maxYear&&N.minYear>N.maxYear&&([N.minYear,N.maxYear]=[N.maxYear,N.minYear]),y.set("tab","titles"),y.set("type",N.type??"all"),N.minYear?y.set("minYear",String(N.minYear)):y.delete("minYear"),N.maxYear?y.set("maxYear",String(N.maxYear)):y.delete("maxYear"),N.originalLanguage?y.set("lang",N.originalLanguage):y.delete("lang")})},[m,p]),t=()=>{p(n=>{n.set("tab","titles"),n.set("type","all"),n.delete("minYear"),n.delete("maxYear"),n.delete("lang")}),f(!1)},c=j.useMemo(()=>{const n=[];if(m.type&&m.type!=="all"&&n.push({label:`Type: ${m.type.charAt(0).toUpperCase()}${m.type.slice(1)}`,onRemove:()=>o({type:"all"})}),m.minYear||m.maxYear){const y=m.minYear??"Any",w=m.maxYear??"Now";n.push({label:`Year: ${y} – ${w}`,onRemove:()=>o({minYear:void 0,maxYear:void 0})})}return m.originalLanguage&&n.push({label:`Language: ${m.originalLanguage.toUpperCase()}`,onRemove:()=>o({originalLanguage:void 0})}),n},[m,o]),l=c.length,I=l>0?`Filters (${l} active)`:"Filters (none applied)",k=u==="titles"&&(!!a.trim()||l>0),F=k?I:"Filters are locked until you start typing a title",C=n=>{n.preventDefault()};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-4",children:[e.jsx(de,{title:"Search without the clutter",subtitle:"Find titles, filmmakers, or friends instantly. Switch tabs to move between movies and people."}),e.jsxs(ie,{tone:"default",padded:!0,children:[e.jsxs("form",{onSubmit:C,className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2",children:[e.jsx(le,{placeholder:"Search for movies, shows, or people...",value:i,onChange:n=>x(n.target.value),autoCorrect:"off",autoCapitalize:"none",className:"flex-1"}),i?e.jsx(S,{type:"button",onClick:b,variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full text-xs text-muted-foreground hover:bg-border/60 hover:text-foreground","aria-label":"Clear search",children:e.jsx(D,{className:"h-3 w-3","aria-hidden":"true"})}):null]}),e.jsxs(S,{type:"button",onClick:()=>{k&&f(n=>!n)},variant:"outline",size:"sm",className:`inline-flex items-center justify-center gap-1 rounded-full px-3 py-2 text-xs font-medium shadow-md ${k?"border-border bg-background text-muted-foreground hover:border-primary/70 hover:text-foreground":"cursor-not-allowed border-border bg-background/70 text-muted-foreground"} ${g?"border-primary/70 text-foreground":""}`,disabled:!k,"aria-pressed":k&&g,"aria-expanded":k&&g,"aria-controls":"search-title-filters","aria-label":F,title:F,children:[e.jsx(q,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:g?"Hide filters":"Filters"}),l>0?e.jsx("span",{className:"inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-primary/15 px-1 text-xs font-semibold text-primary",children:l}):null]})]}),u==="titles"&&e.jsx("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:c.length?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"gap-1 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-muted-foreground",children:"Active filters"}),c.map(n=>e.jsxs(S,{type:"button",onClick:n.onRemove,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-background px-2 py-1 text-xs text-foreground shadow-sm hover:border-primary/70 hover:text-foreground",children:[e.jsx("span",{children:n.label}),e.jsx(D,{className:"h-3 w-3 text-muted-foreground","aria-hidden":!0})]},n.label)),e.jsx(S,{type:"button",onClick:t,variant:"ghost",size:"sm",className:"h-auto rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-primary hover:bg-primary/15",children:"Reset all"})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-card/50 px-2.5 py-1 text-xs font-medium text-muted-foreground",children:[e.jsx(B,{className:"h-3 w-3","aria-hidden":!0}),"No filters applied"]})}),u==="titles"&&g&&e.jsxs("div",{id:"search-title-filters",className:"mt-3 space-y-3 rounded-xl border border-dashed border-border bg-background/70 p-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-foreground",children:[e.jsx(B,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Filter titles"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-[1.4fr_1fr_1fr]",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{key:"all",label:"All"},{key:"movie",label:"Movies"},{key:"series",label:"Series"},{key:"anime",label:"Anime"}].map(n=>{const y=m.type===n.key;return e.jsx(S,{type:"button",variant:y?"default":"outline",size:"sm",className:`h-auto rounded-full px-2.5 py-1 text-xs font-medium ${y?"bg-primary text-primary-foreground shadow-md":"border-border bg-background/80 text-muted-foreground hover:border-primary/60 hover:text-foreground"}`,onClick:()=>o({type:n.key}),"aria-pressed":y,children:n.label},n.key)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Years"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsx(R,{type:"number",min:1900,max:new Date().getFullYear(),value:m.minYear??"",onChange:n=>o({minYear:n.target.value?Number(n.target.value):void 0}),placeholder:"Min",className:"h-9 w-full border-border bg-background px-2 py-1.5 text-xs text-foreground shadow-sm","aria-label":"Minimum year"}),e.jsx(R,{type:"number",min:1900,max:new Date().getFullYear(),value:m.maxYear??"",onChange:n=>o({maxYear:n.target.value?Number(n.target.value):void 0}),placeholder:"Max",className:"h-9 w-full border-border bg-background px-2 py-1.5 text-xs text-foreground shadow-sm","aria-label":"Maximum year"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use a minimum, maximum, or both."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Original language"}),e.jsxs("div",{className:"flex items-center gap-1.5 rounded-md border border-border bg-background px-2 py-1.5 shadow-sm",children:[e.jsx(ye,{className:"h-3.5 w-3.5 text-muted-foreground","aria-hidden":"true"}),e.jsx(R,{type:"text",value:m.originalLanguage??"",onChange:n=>o({originalLanguage:n.target.value||void 0}),placeholder:"e.g. en, ja",className:"h-8 w-full border-none bg-transparent p-0 text-xs text-foreground shadow-none placeholder:text-muted-foreground focus-visible:ring-0"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Two-letter codes keep things simple."})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-1.5 w-1.5 rounded-full bg-primary/80"}),"Filters shape the recommendations shown below."]}),e.jsx(S,{type:"button",variant:"link",size:"sm",className:"h-auto p-0 text-xs font-semibold text-foreground hover:text-primary",onClick:t,children:"Reset filters"})]})]})]}),e.jsxs("section",{className:"flex flex-1 flex-col gap-3",children:[e.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:e.jsx("div",{className:"w-full sm:max-w-lg",children:e.jsx(ne,{value:u,onValueChange:v,children:e.jsxs(oe,{className:"w-full",children:[e.jsx(z,{value:"titles",children:"Titles"}),e.jsx(z,{value:"people",children:"People"})]})})})}),e.jsx("div",{"aria-live":"polite",className:"flex-1 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-3 text-[12px] text-muted-foreground",children:u==="titles"?e.jsx(Re,{query:d,filters:m,onResetFilters:t}):e.jsx(Pe,{query:d})})]})]})};export{Ge as default};
