import{C as x,s as o,j as r,B as h,r as b}from"./index-DuL1-P9A.js";import{D as v,a as w,c as g}from"./dialog-ClweDY8b.js";import{M as y}from"./material-icon-CWnTyIbw.js";import{C as _}from"./clock-C1hCzrJG.js";const j=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],k=x("bell-off",j),u=e=>e.code==="42P10"||/no unique or exclusion constraint matching the ON CONFLICT specification/i.test(e.message??""),m=e=>e.code==="23505"||/duplicate key value violates unique constraint/i.test(e.message??"");let c=null,d=null;const q=async e=>{if(c!==!1){const{error:s}=await o.from("message_delivery_receipts").upsert(e,{onConflict:"conversation_id,message_id,user_id"});if(!s){c=!0;return}if(u(s))c=!1;else{console.error("[writeDeliveryReceipt] Failed to write delivery receipt",s);return}}const{error:t}=await o.from("message_delivery_receipts").insert(e);t&&!m(t)&&console.error("[writeDeliveryReceipt] Failed to insert delivery receipt",t)},F=async e=>{if(d!==!1){const{error:s}=await o.from("message_read_receipts").upsert(e,{onConflict:"conversation_id,user_id"});if(!s){d=!0;return}if(u(s))d=!1;else{console.error("[writeReadReceipt] Failed to write read receipt",s);return}}const{error:t}=await o.from("message_read_receipts").insert(e);t&&!m(t)&&console.error("[writeReadReceipt] Failed to insert read receipt",t)},I=async(e,t)=>{const{error:s}=await o.from("message_read_receipts").delete().eq("conversation_id",e).eq("user_id",t);if(!s)return{ok:!0};const a={conversation_id:e,user_id:t,last_read_message_id:null,last_read_at:new Date(0).toISOString()},{error:n}=await o.from("message_read_receipts").upsert(a,{onConflict:"conversation_id,user_id"});if(!n)return{ok:!0};if(u(n)){const{error:i}=await o.from("message_read_receipts").insert(a);return!i||m(i)?{ok:!0}:{ok:!1,error:i}}return{ok:!1,error:n}},N=[{kind:"duration",minutes:60,label:"1 hour",description:"Mute notifications for 1 hour"},{kind:"duration",minutes:480,label:"8 hours",description:"Mute notifications for 8 hours"},{kind:"duration",minutes:1440,label:"24 hours",description:"Mute notifications for 24 hours"},{kind:"indefinite",label:"Until I turn it back on",description:"Mute notifications until you unmute manually"}],C=({icon:e,title:t,description:s,onClick:a})=>r.jsxs("button",{type:"button",onClick:a,className:"flex w-full items-center gap-3 rounded-2xl px-3 py-3 text-left transition hover:bg-muted/60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",children:[r.jsx("span",{className:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-muted/80",children:e}),r.jsxs("span",{className:"min-w-0 flex-1",children:[r.jsx("span",{className:"block truncate text-sm font-semibold",children:t}),r.jsx("span",{className:"block truncate text-xs text-muted-foreground",children:s})]})]}),B=({open:e,onOpenChange:t,conversationTitle:s,onSelect:a})=>{const n=()=>t(!1);return r.jsx(v,{open:e,onOpenChange:t,children:r.jsxs(w,{className:"left-0 right-0 top-auto bottom-0 w-full max-w-none translate-x-0 translate-y-0 rounded-t-3xl rounded-b-none border border-border bg-card p-4",children:[r.jsx("div",{className:"mx-auto mb-2 h-1.5 w-12 rounded-full bg-muted","aria-hidden":!0}),r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx(g,{className:"text-center text-base text-foreground",children:"Mute notifications"}),r.jsx("p",{className:"mt-1 text-center text-xs text-muted-foreground",children:s||"Choose a duration"})]}),r.jsx("button",{type:"button",onClick:n,className:"rounded-full p-2 text-muted-foreground transition hover:bg-muted/60 hover:text-foreground","aria-label":"Close",children:r.jsx(y,{name:"close"})})]}),r.jsx("div",{className:"mt-3 space-y-1",children:N.map(i=>r.jsx(C,{icon:i.kind==="duration"?r.jsx(_,{className:"h-5 w-5 text-muted-foreground","aria-hidden":!0}):r.jsx(k,{className:"h-5 w-5 text-muted-foreground","aria-hidden":!0}),title:i.label,description:i.description,onClick:()=>{a(i),n()}},i.label))}),r.jsx("div",{className:"pt-3",children:r.jsx(h,{type:"button",variant:"ghost",className:"w-full rounded-2xl border border-border bg-muted/60 text-foreground hover:bg-muted",onClick:n,children:"Cancel"})})]})})},f="movinesta:assistant-cache",R="movinesta.assistantCache.v1";let p,l=null;function E(e){try{window.addEventListener("storage",e),window.addEventListener(f,e)}catch{}return()=>{try{window.removeEventListener("storage",e),window.removeEventListener(f,e)}catch{}}}function M(){let e=null;try{e=localStorage.getItem(R)}catch{e=null}if(e===p)return l;if(p=e,!e)return l=null,null;try{const t=JSON.parse(e);return!t?.conversationId||!t?.assistant?.id?(l=null,null):(l=t,t)}catch{return l=null,null}}function H(){return b.useSyncExternalStore(E,M,()=>null)}export{k as B,B as M,q as a,I as c,H as u,F as w};
