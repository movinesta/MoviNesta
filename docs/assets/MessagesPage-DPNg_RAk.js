import{c as C,j as e,B as U,u as M,g as S,r as p,f as k,M as j,L}from"./index-C9fHGWeV.js";import{T}from"./TopBar-C-VicUv8.js";import{S as P}from"./SearchField-CUVpIU6k.js";import{C as $}from"./Chip-2E86no1e.js";import{T as z,a as A,b}from"./Tabs-DBlfCjiQ.js";import{D as B,a as D,b as I,c as v}from"./dropdown-menu-KxXGdxwY.js";import{M as E}from"./menu-DOwJkYef.js";import{U as G}from"./users-CrEqnsbE.js";import"./index-DDwuZX7F.js";import"./index-B5ogGJIu.js";import"./index-DBHTwg8d.js";const R=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],q=C("square-pen",R),N=({icon:s,title:n,subtitle:t,actionLabel:l,onAction:i})=>e.jsxs("div",{className:"flex min-h-[220px] flex-col items-center justify-center gap-3 rounded-2xl border border-border bg-background/90 p-6 text-center shadow-lg",children:[s?e.jsx("div",{className:"inline-flex h-12 w-12 items-center justify-center rounded-2xl bg-primary/10 text-primary",children:s}):null,e.jsx("h3",{className:"text-base font-semibold text-foreground",children:n}),t?e.jsx("p",{className:"max-w-md text-[12px] text-muted-foreground",children:t}):null,l?e.jsx(U,{size:"sm",onClick:i,className:"mt-1",children:l}):null]}),F=({conversation:s})=>{const n=s.participants??[],t=n.find(r=>!r.isSelf)??n[0]??null,l=t?.displayName?.[0]?.toUpperCase()??t?.username?.[0]?.toUpperCase()??"?",i=s.lastMessageAtLabel??"Now",c=s.isGroup,o=n.length,m="group flex items-center gap-3 rounded-xl px-3 py-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",u=s.hasUnread?"bg-muted border border-border":"hover:bg-muted/60";return e.jsx("li",{className:"py-1 sm:py-1.5",children:e.jsxs(L,{to:`/messages/${s.id}`,className:`${m} ${u}`,children:[e.jsxs("div",{className:"relative flex h-12 w-12 items-center justify-center",children:[c&&o>1?e.jsx("div",{className:"flex -space-x-2",children:n.slice(0,2).map((r,g)=>e.jsx("span",{className:"inline-flex h-10 w-10 items-center justify-center overflow-hidden rounded-full bg-card text-xs font-semibold text-foreground ring-2 ring-background",style:{zIndex:2-g},children:r.avatarUrl?e.jsx("img",{src:r.avatarUrl??"",alt:r.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):r.displayName?.[0]?.toUpperCase()??r.username?.[0]?.toUpperCase()??"?"},r.id))}):e.jsx("span",{className:`inline-flex h-11 w-11 items-center justify-center overflow-hidden rounded-full text-[12px] font-semibold text-foreground ${s.hasUnread?"bg-primary/20":"bg-muted"}`,children:t?.avatarUrl?e.jsx("img",{src:t.avatarUrl??"",alt:t.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):l}),s.hasUnread&&e.jsx("span",{className:"absolute -right-0.5 -top-0.5 h-2.5 w-2.5 rounded-full bg-primary"})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:`truncate text-sm ${s.hasUnread?"font-semibold text-foreground":"font-medium text-foreground"}`,children:s.title}),c&&e.jsxs("div",{className:"mt-0.5 flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(G,{className:"h-3 w-3","aria-hidden":"true"}),e.jsxs("span",{children:[o," participants"]})]})]}),e.jsx("span",{className:"shrink-0 text-xs text-muted-foreground",children:i})]}),e.jsx("p",{className:`truncate text-[12px] ${s.hasUnread?"text-foreground":"text-muted-foreground"}`,children:s.lastMessagePreview??"Start chatting"})]})]})})},se=()=>{const s=M(),{data:n,isLoading:t,isError:l,error:i,refetch:c,isFetching:o}=S(),[m,u]=p.useState(""),[r,g]=p.useState("all"),x=m.trim().toLowerCase(),y=x.length>0,w=p.useMemo(()=>(n??[]).filter(a=>a.hasUnread).length,[n]),h=p.useMemo(()=>(n??[]).filter(a=>r==="unread"?a.hasUnread:r==="groups"?a.isGroup:!0).filter(a=>x?[a.title,a.subtitle,a.lastMessagePreview??"",...a.participants.map(d=>d.displayName),...a.participants.map(d=>d.username).filter(d=>!!d)].join(" ").toLowerCase().includes(x):!0),[n,x,r]),f=()=>{s("/search?tab=people&from=messages")};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-4",children:[e.jsx(T,{title:"Messages",actions:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:f,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-foreground hover:bg-muted","aria-label":"Compose message",children:e.jsx(q,{className:"h-5 w-5","aria-hidden":"true"})}),e.jsxs(B,{children:[e.jsx(D,{asChild:!0,children:e.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-foreground hover:bg-muted","aria-label":"More options",children:e.jsx(E,{className:"h-5 w-5","aria-hidden":"true"})})}),e.jsxs(I,{align:"end",children:[e.jsx(v,{onClick:()=>s("/settings"),children:"Settings"}),e.jsx(v,{onClick:f,children:"New conversation"})]})]})]})}),e.jsx(P,{placeholder:"Search chats or people…",value:m,onChange:a=>u(a.target.value)}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-muted px-2 py-1",children:[e.jsx("span",{className:"inline-flex h-2 w-2 rounded-full bg-emerald-500"}),e.jsx("span",{className:"font-medium",children:w>0?`${w} unread`:"Inbox is caught up"})]}),o&&!t&&e.jsx($,{className:"px-2 py-1 text-xs",children:"Syncing…"})]}),e.jsx("div",{className:"w-full sm:max-w-xs",children:e.jsx(z,{value:r,onValueChange:a=>g(a),children:e.jsxs(A,{className:"w-full",children:[e.jsx(b,{value:"all",children:"All"}),e.jsx(b,{value:"unread",children:"Unread"}),e.jsx(b,{value:"groups",children:"Groups"})]})})})]}),t&&e.jsx(k,{}),l&&!t&&e.jsx("div",{className:"flex flex-1 items-center justify-center",children:e.jsx(N,{icon:e.jsx(j,{className:"h-5 w-5"}),title:"Something went wrong",subtitle:i?.message??"Please try again in a moment.",actionLabel:o?"Retrying…":"Reload inbox",onAction:()=>c()})}),!t&&!l&&y&&h.length===0&&e.jsx(N,{icon:e.jsx(j,{className:"h-6 w-6"}),title:"No conversations match",subtitle:"Try a different name or clear your search to see all chats.",actionLabel:"Clear search",onAction:()=>u("")}),!t&&!l&&!y&&h.length===0&&e.jsx(N,{icon:e.jsx(j,{className:"h-6 w-6"}),title:"Plan together",subtitle:"Create a group chat to line up your next movie night.",actionLabel:"New conversation",onAction:f}),!t&&!l&&h.length>0&&e.jsx("div",{className:"rounded-xl border border-border bg-background",children:e.jsx("ul",{className:"divide-y divide-border px-2 py-1 sm:px-3",children:h.map(a=>e.jsx(F,{conversation:a},a.id))})})]})};export{se as default};
