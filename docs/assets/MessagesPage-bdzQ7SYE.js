import{u as j,z as N,r as u,j as e,y,L as v}from"./index-CuXsBKB-.js";import{M as i}from"./material-icon-sbzzvxfS.js";const w=({conversation:t})=>{const a=t.participants??[],n=a.find(l=>!l.isSelf)??a[0]??null,d=t.lastMessageAtLabel??"Now",o=t.isGroup,c=a.length;return e.jsx("li",{className:"py-1",children:e.jsxs(v,{to:`/messages/${t.id}`,className:"group flex items-center gap-4 rounded-2xl p-3 transition-colors hover:bg-muted/60",children:[e.jsx("div",{className:"relative shrink-0",children:o&&c>1?e.jsx("div",{className:"grid h-16 w-16 grid-cols-2 gap-0.5 overflow-hidden rounded-full bg-muted",children:a.slice(0,4).map(l=>e.jsx("div",{className:"h-full w-full bg-cover bg-center",style:l.avatarUrl?{backgroundImage:`url(${l.avatarUrl})`}:void 0},l.id))}):e.jsxs("div",{className:"relative h-16 w-16 overflow-hidden rounded-full border-2 border-primary/50",children:[n?.avatarUrl?e.jsx("img",{src:n.avatarUrl,alt:n.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-sm font-semibold text-foreground",children:(n?.displayName??"?").slice(0,1).toUpperCase()}),!o&&t.hasUnread&&e.jsx("span",{className:"absolute bottom-0 right-0 h-3.5 w-3.5 rounded-full border-2 border-background bg-green-500"})]})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[e.jsx("h3",{className:"truncate text-base font-bold text-foreground",children:t.title}),e.jsx("span",{className:"whitespace-nowrap text-xs font-medium text-primary",children:d})]}),e.jsxs("div",{className:"mt-0.5 flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-sm text-muted-foreground",children:t.lastMessagePreview??"Start chatting"}),t.hasUnread&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-primary"})]})]})]})})},U=()=>{const t=j(),{data:a,isLoading:n,isError:d,error:o,refetch:c,isFetching:l}=N(),[f,b]=u.useState(""),m=f.trim().toLowerCase(),h=u.useMemo(()=>(a??[]).filter(s=>m?[s.title,s.subtitle,s.lastMessagePreview??"",...s.participants.map(r=>r.displayName),...s.participants.map(r=>r.username).filter(r=>!!r)].join(" ").toLowerCase().includes(m):!0),[a,m]),p=u.useMemo(()=>{const s=new Map;return(a??[]).forEach(x=>{x.participants.filter(r=>!r.isSelf).forEach(r=>{s.has(r.id)||s.set(r.id,{id:r.id,name:r.displayName,avatarUrl:r.avatarUrl,conversationId:x.id})})}),Array.from(s.values()).slice(0,8)},[a]),g=()=>{t("/messages/new")};return n?e.jsx(y,{}):d?e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center px-4 py-12 text-sm text-foreground",children:[e.jsx("p",{className:"font-semibold",children:"Unable to load messages."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:o?.message??"Please try again in a moment."}),e.jsx("button",{type:"button",onClick:()=>c(),className:"mt-4 rounded-full bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:"Try again"})]}):e.jsxs("div",{className:"flex min-h-screen flex-1 flex-col overflow-hidden bg-background text-foreground",children:[e.jsxs("header",{className:"sticky top-0 z-10 bg-background px-4 pb-2 pt-6",children:[e.jsxs("div",{className:"mb-4 mt-2 flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Messages"}),e.jsx("button",{type:"button",onClick:g,className:"flex h-10 w-10 items-center justify-center rounded-full bg-primary/10 text-primary transition-colors hover:bg-primary/20","aria-label":"New message",children:e.jsx(i,{name:"edit_square",className:"text-xl",ariaLabel:"New message"})})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(i,{name:"search",className:"text-muted-foreground"})}),e.jsx("input",{className:"block w-full rounded-full border border-input bg-card py-3 pl-10 pr-3 text-sm text-foreground placeholder:text-muted-foreground shadow-sm focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Search friends or titles...",value:f,onChange:s=>b(s.target.value)})]}),e.jsxs("div",{className:"-mx-4 flex space-x-4 overflow-x-auto border-b border-border/60 pb-4 pl-4 pr-4 [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:[e.jsxs("button",{type:"button",onClick:g,className:"flex shrink-0 flex-col items-center gap-1",children:[e.jsx("div",{className:"relative flex h-16 w-16 items-center justify-center rounded-full border-2 border-dashed border-primary/50",children:e.jsx(i,{name:"add",className:"text-3xl text-primary"})}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"You"})]}),p.map(s=>e.jsxs("button",{type:"button",className:"flex shrink-0 flex-col items-center gap-1",onClick:()=>t(`/messages/${s.conversationId}`),children:[e.jsx("div",{className:"relative h-16 w-16 overflow-hidden rounded-full border-2 border-primary/50",children:s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:s.name,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted text-xs font-semibold text-foreground",children:s.name.slice(0,1).toUpperCase()})}),e.jsx("span",{className:"max-w-[64px] truncate text-xs font-medium text-foreground",children:s.name})]},s.id))]})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto px-4 pb-32 pt-2",children:[e.jsx("div",{className:"py-2 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Recent Chats"}),h.length===0?e.jsxs("div",{className:"mt-6 rounded-2xl border border-border/60 bg-card/60 p-4 text-center text-xs text-muted-foreground",children:[e.jsx("p",{className:"font-semibold",children:"No conversations yet."}),e.jsx("p",{className:"mt-1",children:"Start a chat with your crew."})]}):e.jsx("ul",{children:h.map(s=>e.jsx(w,{conversation:s},s.id))})]}),l&&e.jsxs("div",{className:"pointer-events-none fixed bottom-24 right-4 flex items-center gap-2 rounded-full border border-border bg-background/90 px-3 py-1 text-xs text-muted-foreground shadow-md",children:[e.jsx(i,{name:"sync",className:"text-base"}),"Syncingâ€¦"]})]})};export{U as default};
