import{c as K,j as e,k as Q,l as G,L as A,s as x,y as J}from"./index-C0YC7Lqk.js";import{C as I}from"./Chip-svl2C2tY.js";import{S as U}from"./sparkles-BsAyD2aC.js";import{F as N}from"./film-BhU7UJY3.js";import{C as Y,L as X}from"./list-checks-0WZ9OWE8.js";import{U as O}from"./users-CdKu7Qpk.js";import{C as $}from"./chevron-right-A9t9Q0r-.js";const Z=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],ee=K("play",Z),te=()=>e.jsxs("section",{className:"animate-pulse rounded-2xl border border-border bg-card/90 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"h-4 w-32 rounded-full bg-border/60"}),e.jsx("div",{className:"h-4 w-16 rounded-full bg-border/40"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-28 w-20 rounded-2xl bg-border/60"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-2/3 rounded-full bg-border/60"}),e.jsx("div",{className:"h-3 w-full rounded-full bg-border/40"}),e.jsx("div",{className:"h-3 w-5/6 rounded-full bg-border/40"}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("div",{className:"h-7 w-28 rounded-full bg-border/50"}),e.jsx("div",{className:"h-7 w-28 rounded-full bg-border/40"})]})]})]})]}),se=()=>e.jsx("div",{className:"space-y-3",children:[0,1].map(t=>e.jsxs("section",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-40 rounded-full bg-border/60"}),e.jsx("div",{className:"-mx-1 overflow-x-hidden pb-1",children:e.jsx("div",{className:"flex gap-2 px-1",children:[0,1,2].map(r=>e.jsx("div",{className:"h-40 w-[160px] shrink-0 rounded-2xl border border-border bg-card/80"},r))})})]},t))}),re=()=>e.jsx("section",{className:"rounded-2xl border border-border bg-card/95 px-4 py-5 text-xs text-muted-foreground shadow-lg",children:e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center text-center",children:[e.jsx("div",{className:"mb-3 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-primary/15",children:e.jsx(U,{className:"h-4 w-4 text-primary","aria-hidden":!0})}),e.jsx("h2",{className:"text-sm font-heading font-semibold text-foreground",children:"Smart picks arrive as you watch"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Once you've logged a few titles and swiped through recommendations, MoviNesta will start surfacing a single “tonight's pick” tuned to your taste."}),e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:["For now, head to ",e.jsx("span",{className:"font-medium text-foreground",children:"Swipe"})," or"," ",e.jsx("span",{className:"font-medium text-foreground",children:"Diary"})," to teach the nest what you love."]})]})}),ie=()=>e.jsx("section",{className:"rounded-2xl border border-border bg-card/95 px-4 py-4 text-xs text-muted-foreground shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"inline-flex h-8 w-8 items-center justify-center rounded-2xl bg-primary/15",children:e.jsx(N,{className:"h-4 w-4 text-primary","aria-hidden":!0})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-sm font-heading font-semibold text-foreground",children:"No personalized rows yet"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"As you rate, review, and follow friends, this tab will fill with eerily good recommendations."})]})]})}),ae=t=>{const a=(t?.message??"").toLowerCase();return a.includes("network")||a.includes("failed to fetch")||a.includes("fetch")?"We couldn’t reach the server to load your recommendations. Check your connection and try again.":a.includes("unauthorized")||a.includes("401")||a.includes("403")?"We couldn’t load your recommendations because your session may have expired. Try signing out and back in.":"Something went wrong while loading your recommendations. Please try again."},D=`
  id,
  kind,
  tmdb_title,
  tmdb_name,
  tmdb_original_title,
  tmdb_original_name,
  tmdb_release_date,
  tmdb_first_air_date,
  tmdb_runtime,
  tmdb_poster_path,
  tmdb_backdrop_path,
  tmdb_original_language,
  omdb_title,
  omdb_year,
  omdb_language,
  omdb_imdb_id,
  omdb_imdb_rating,
  omdb_rating_rotten_tomatoes,
  omdb_poster,
  omdb_rated,
  tmdb_id
`,W=t=>{const r=J(t);return{id:r.id,title:r.title,year:r.year,runtimeMinutes:t.tmdb_runtime??null,type:r.type,posterUrl:r.posterUrl,backdropUrl:r.backdropUrl,imdbRating:r.imdbRating,rtTomatoMeter:r.rtTomatoMeter}},p=(t,r)=>t??r??null,ne=async t=>{const[r,a,d]=await Promise.all([x.from("follows").select("followed_id").eq("follower_id",t),x.from("ratings").select("title_id, rating, created_at").eq("user_id",t).order("created_at",{ascending:!1}).limit(40),x.from("library_entries").select("title_id, status, updated_at").eq("user_id",t).order("updated_at",{ascending:!1}).limit(40)]);let n=!1;if(a.error)throw new Error(a.error.message);if(d.error)throw new Error(d.error.message);const m=r.error;m&&(n=!0,console.warn("[HomeForYouTab] Failed to load follows",m.message));const h=a.data??[],v=d.data??[],F=(r.data??[]).map(s=>s.followed_id).filter(s=>!!s)??[],E=h.find(s=>(s.rating??0)>=4)??h[0]??null,o=E?.title_id??null;let y=[];if(F.length>0){const{data:s,error:i}=await x.from("ratings").select("title_id, user_id, created_at").in("user_id",F).order("created_at",{ascending:!1}).limit(30);i&&(n=!0,console.warn("[HomeForYouTab] Failed to load friend ratings",i.message)),y=s??[]}const j=[];y.forEach(s=>{s.title_id&&(j.includes(s.title_id)||j.push(s.title_id))});const g=[];o&&v.forEach(s=>{s.title_id&&s.title_id!==o&&(s.status==="want_to_watch"||s.status==="watching")&&(g.includes(s.title_id)||g.push(s.title_id))});const w=[];v.forEach(s=>{s.title_id&&(s.status==="watching"||s.status==="want_to_watch")&&(w.includes(s.title_id)||w.push(s.title_id))});const{data:B,error:C}=await x.from("media_items").select(D).eq("kind","anime").order("tmdb_release_date",{ascending:!1}).limit(16);C&&(n=!0,console.warn("[HomeForYouTab] Failed to load anime titles",C.message));const P=B?.map(W)??[],H=P.map(s=>s.id),L=Array.from(new Set([...o?[o]:[],...j,...g,...w,...H]));if(!L.length)return{tonightPick:null,sections:[],hasPartialData:n};const _=await x.from("media_items").select(D).in("id",L);if(_.error)throw new Error(_.error.message);const q=(_.data??[]).map(W),f=new Map;q.forEach(s=>{f.set(s.id,s)});const u=new Set;let S=null;if(o&&f.has(o)){const s=f.get(o),i=E?.rating??null;S={id:s.id,name:s.title??"Untitled",year:s.year??new Date().getFullYear(),runtimeMinutes:s.runtimeMinutes??void 0,matchReason:i&&i>=4?"Because you gave this a high rating.":"Based on your recent diary activity.",moodTag:s.type==="anime"?"Anime night":"Cinematic night",logline:void 0,moodLine:s.type==="anime"?"Animated, emotional, and perfect for a late-night binge.":"Feels like the right vibe for tonight based on your recent watches.",friendsWatchingCount:y.filter(c=>c.title_id===o).length,posterUrl:p(s.posterUrl,s.backdropUrl),imdbRating:s.imdbRating??null,rtTomatoMeter:s.rtTomatoMeter??null},u.add(o)}const b=[],T=[];if(j.slice(0,12).forEach(s=>{const i=f.get(s);if(!i||u.has(s))return;const c=y.filter(l=>l.title_id===s).length;T.push({id:i.id,name:i.title??"Untitled",year:i.year??new Date().getFullYear(),friendsWatchingCount:c,moodTag:i.type==="anime"?"Anime night":"Friends love this",posterUrl:p(i.posterUrl,i.backdropUrl),imdbRating:i.imdbRating??null,rtTomatoMeter:i.rtTomatoMeter??null}),u.add(s)}),T.length>0&&b.push({id:"friends-trending",kind:"friends-trending",title:"Trending with friends",subtitle:"What your circle has been rating and logging recently.",pillLabel:"Social picks",items:T}),o&&f.has(o)&&g.length>0){const s=f.get(o),i=[];g.slice(0,12).forEach(c=>{const l=f.get(c);!l||u.has(c)||(i.push({id:l.id,name:l.title??"Untitled",year:l.year??new Date().getFullYear(),matchReason:`On your watchlist after ${s.title??"that favorite"}.`,posterUrl:p(l.posterUrl,l.backdropUrl),imdbRating:l.imdbRating??null,rtTomatoMeter:l.rtTomatoMeter??null}),u.add(c))}),i.length>0&&b.push({id:"because-you-liked",kind:"because-you-liked",title:`Because you liked ${s.title??"this"}`,subtitle:"Watchlist picks tuned by your recent favorites.",pillLabel:"Taste match",items:i})}const R=[];P.slice(0,12).forEach(s=>{u.has(s.id)||(R.push({id:s.id,name:s.title??"Untitled",year:s.year??new Date().getFullYear(),matchReason:"Anime in your catalog and trending in MoviNesta.",posterUrl:p(s.posterUrl,s.backdropUrl),imdbRating:s.imdbRating??null,rtTomatoMeter:s.rtTomatoMeter??null}),u.add(s.id))}),R.length>0&&b.push({id:"popular-anime",kind:"anime",title:"Popular anime right now",subtitle:"Heart-punching stories, cozy vibes, and a bit of chaos.",pillLabel:"Anime corner",items:R});const k=[];return w.slice(0,12).forEach(s=>{const i=f.get(s);if(!i||u.has(s))return;const c=v.find(z=>z.title_id===s),l=i.imdbRating??null,V=i.rtTomatoMeter??null;let M;c?.status==="watching"?M="In progress — pick up where you left off.":c?.status==="want_to_watch"&&(M="On your Watchlist and waiting for a good night."),k.push({id:i.id,name:i.title??"Untitled",year:i.year??new Date().getFullYear(),runtimeMinutes:i.runtimeMinutes??void 0,matchReason:M,posterUrl:p(i.posterUrl,i.backdropUrl),imdbRating:l,rtTomatoMeter:V}),u.add(s)}),k.length>0&&b.push({id:"continue",kind:"continue",title:"Continue swiping / watching",subtitle:"Pick up right where your last movie night left off.",pillLabel:"On deck",items:k}),{tonightPick:S,sections:b,hasPartialData:n}},oe=()=>{const{user:t}=Q(),{data:r,isLoading:a,isFetching:d,error:n}=G({queryKey:["home-for-you",t?.id],enabled:!!t?.id,staleTime:1e3*20,refetchOnWindowFocus:!0,refetchOnReconnect:!0,queryFn:async()=>t?.id?ne(t.id):{tonightPick:null,sections:[],hasPartialData:!1}}),m=n?ae(n):null;return n&&console.error("[HomeForYouTab] Failed to load recommendations",n),{isLoading:a||!r&&d,error:m,tonightPick:r?.tonightPick??null,sections:r?.sections??[],hasPartialData:r?.hasPartialData??!1}},je=()=>{const{isLoading:t,error:r,tonightPick:a,sections:d,hasPartialData:n}=oe(),m=!!a||d.length>0;return e.jsxs("div",{className:"space-y-4",children:[r&&e.jsx("div",{role:"alert",className:"rounded-2xl border border-destructive/60 bg-destructive/10 px-3 py-2 text-xs text-destructive",children:r}),t?e.jsx(te,{}):a?e.jsx(le,{pick:a}):e.jsx(re,{}),t&&e.jsx(se,{}),!t&&d.length>0&&e.jsx("div",{className:"space-y-3",children:d.map(h=>e.jsx(de,{section:h},h.id))}),!t&&n&&!r&&e.jsx("p",{className:"rounded-2xl border border-border-soft bg-muted px-3 py-2 text-xs text-muted-foreground",children:"Some rows might be missing while we catch up on your follows and anime data, but your main recommendations are still here."}),!t&&!m&&e.jsx(ie,{})]})},le=({pick:t})=>{const r=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)&&t.imdbRating>0,a=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)&&t.rtTomatoMeter>0;return e.jsxs("section",{className:"rounded-2xl border border-border bg-card/95 p-4 text-xs text-muted-foreground shadow-lg",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsxs(I,{variant:"accent",className:"gap-1 px-2.5 py-0.5 text-xs",children:[e.jsx(U,{className:"h-3.5 w-3.5","aria-hidden":!0}),e.jsx("span",{children:"Tonight's pick for you"})]}),t.runtimeMinutes?e.jsxs(I,{className:"gap-1 px-2 py-0.5 text-xs",children:[e.jsx(Y,{className:"h-3 w-3","aria-hidden":!0}),e.jsxs("span",{children:[t.runtimeMinutes," min"]})]}):null]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(A,{to:`/title/${t.id}`,className:"relative flex h-28 w-20 shrink-0 overflow-hidden rounded-2xl bg-background/80 shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[t.posterUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.posterUrl,alt:t.name,className:"h-full w-full object-cover"}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-t from-black/65 via-black/20 to-transparent"})]}):e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-1 bg-gradient-to-br from-card/80 via-background to-primary/70 text-xs text-muted-foreground",children:[e.jsx(N,{className:"h-4 w-4 text-primary","aria-hidden":!0}),e.jsx("span",{children:"No poster yet"})]}),e.jsxs("div",{className:"pointer-events-none absolute bottom-1 left-1 right-1 space-y-0.5 px-1.5",children:[e.jsx("span",{className:"inline-flex items-center rounded-full bg-background/80 px-2 py-0.5 text-[9px] font-semibold uppercase tracking-[0.18em] text-primary",children:t.year}),e.jsx("span",{className:"block text-xs font-heading font-semibold text-primary-foreground line-clamp-3 drop-shadow",children:t.name})]})]}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-1",children:[e.jsxs("h2",{className:"text-sm font-heading font-semibold text-foreground",children:["Movie night mood: ",t.moodTag??"Surprise me"]}),t.logline&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3",children:t.logline}),t.moodLine&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.moodLine}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1.5 rounded-full bg-primary px-3 py-1.5 text-xs font-medium text-primary-foreground shadow-md hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[e.jsx(ee,{className:"h-3.5 w-3.5","aria-hidden":!0}),e.jsx("span",{children:"Add to Watchlist"})]}),e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1.5 rounded-full border border-border bg-background/80 px-3 py-1.5 text-xs text-muted-foreground hover:border-primary/70 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[e.jsx(X,{className:"h-3.5 w-3.5","aria-hidden":!0}),e.jsx("span",{children:"Why this pick?"})]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[t.friendsWatchingCount?e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(O,{className:"h-3 w-3","aria-hidden":!0}),e.jsxs("span",{children:["Watched by ",t.friendsWatchingCount," friend(s)"]})]}):null,r&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-muted-foreground",children:"IMDb Rating"}),e.jsx("span",{children:t.imdbRating.toFixed(1)})]}),a&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-muted-foreground",children:"Tomatometer"}),e.jsxs("span",{children:[t.rtTomatoMeter,"%"]})]}),t.matchReason&&e.jsxs("span",{className:"line-clamp-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Because: "}),t.matchReason]})]})]})]})]})},de=({section:t})=>t.items.length?e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h3",{className:"text-[12px] font-heading font-semibold text-foreground",children:t.title}),t.pillLabel&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-card/80 px-2 py-0.5 text-[9px] text-muted-foreground",children:t.pillLabel})]}),t.subtitle&&e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground line-clamp-2",children:t.subtitle})]}),e.jsxs("button",{type:"button","aria-label":`See all for ${t.title}`,className:"inline-flex items-center gap-1 rounded-full border border-border bg-background/80 px-2.5 py-1 text-xs text-muted-foreground hover:border-primary/70 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[e.jsx("span",{children:"See all"}),e.jsx($,{className:"h-3 w-3","aria-hidden":"true"})]})]}),e.jsx("div",{className:"-mx-1 overflow-x-auto pb-1",children:e.jsx("div",{className:"flex snap-x snap-mandatory gap-2 px-1",children:t.items.map(r=>e.jsx(me,{item:r,sectionKind:t.kind},r.id))})})]}):null,ce={"friends-trending":{icon:O,label:"Friends"},"because-you-liked":{icon:N,label:"Match"},anime:{icon:U,label:"Anime"},continue:{icon:Y,label:"Continue"}},me=({item:t,sectionKind:r})=>{const a=[];t.friendsWatchingCount&&a.push(`Watched by ${t.friendsWatchingCount} friend(s)`),t.runtimeMinutes&&a.push(`${t.runtimeMinutes} min`);const d=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)&&t.imdbRating>0,n=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)&&t.rtTomatoMeter>0;d&&a.push(`IMDb Rating ${t.imdbRating.toFixed(1)}`),n&&a.push(`Tomatometer ${t.rtTomatoMeter}%`);const m=ce[r],h=m.icon;return e.jsxs(A,{to:`/title/${t.id}`,className:"group flex w-[160px] shrink-0 snap-start flex-col overflow-hidden rounded-2xl border border-border bg-card/90 text-xs text-muted-foreground shadow-md no-underline outline-none ring-offset-2 ring-offset-background focus-visible:ring-2 focus-visible:ring-primary",children:[e.jsxs("div",{className:"relative h-32 overflow-hidden",children:[t.posterUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.posterUrl,alt:t.name,className:"h-full w-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/45 via-background/40 to-primary/75"})]}):e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-1 bg-gradient-to-br from-card/80 via-background to-primary/70 text-xs text-muted-foreground",children:[e.jsx(N,{className:"h-4 w-4 text-primary","aria-hidden":!0}),e.jsx("span",{children:"Poster missing"})]}),e.jsx("div",{className:"relative flex h-full flex-col justify-between p-2.5",children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"line-clamp-2 text-xs font-heading font-semibold text-foreground",children:t.name}),t.matchReason&&e.jsx("p",{className:"line-clamp-2 text-[9px] text-muted-foreground",children:t.matchReason})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col justify-between gap-1 px-2.5 py-2",children:[a.length>0&&e.jsx("p",{className:"line-clamp-1 text-[9px] text-muted-foreground",children:a.join(" • ")}),e.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-muted-foreground",children:[e.jsx(h,{className:"h-3 w-3","aria-hidden":!0}),e.jsx("span",{children:m.label})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-primary group-hover:underline",children:[e.jsx("span",{className:"text-xs font-medium",children:"Open"}),e.jsx($,{className:"h-2.5 w-2.5","aria-hidden":"true"})]})]})]})]})};export{se as CarouselsSkeleton,te as TonightPickSkeleton,je as default};
