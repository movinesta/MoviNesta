import{C as W,b as Ie,e as $e,c as bt,w as ue,s as M,aC as X,aq as Z,r as m,an as ie,N as yt,ax as wt,R as D,j as o,i as ge,F as vt,al as V,ag as St,B as jt,au as Ct,aD as Nt,E as kt,O as At,P as z,_ as re,U as F,W as L,aE as Et}from"./index-FRLeEtOr.js";import{u as Pt,C as _t}from"./conversationsCache-y5RHZfL7.js";import{a as Rt,b as Tt}from"./format-BXv9LLlt.js";import{D as Le,a as Fe,f as Mt,b as Dt,c as It,d as $t}from"./dialog-D6_lOO3L.js";import{P as Lt}from"./plus-aqzEzVew.js";import{X as Ft}from"./x-DxtH38RV.js";import{C as Ot}from"./copy-DQ5V5Cjh.js";import{C as Ut}from"./circle-alert-C9LGaVPh.js";import{u as Bt}from"./index-QF19Xe59.js";const Ht=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Ae=W("check-check",Ht);const Wt=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],zt=W("external-link",Wt);const Yt=[["path",{d:"M5 12h14",key:"1ays0h"}]],Vt=W("minus",Yt);const Xt=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],qt=W("pen-line",Xt);const Gt=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Qt=W("rotate-ccw",Gt);const Kt=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Jt=W("trash-2",Kt);async function Oe(e,t,r){const{data:s,error:n}=await e.from("blocked_users").select("blocker_id, blocked_id").or(`and(blocker_id.eq.${t},blocked_id.eq.${r}),and(blocker_id.eq.${r},blocked_id.eq.${t})`);if(n)throw n;const a=s??[],c=a.some(i=>i.blocker_id===t&&i.blocked_id===r),l=a.some(i=>i.blocker_id===r&&i.blocked_id===t);return{youBlocked:c,blockedYou:l}}const ln=e=>{const{user:t}=Ie(),r=t?.id??null,s=$e(),n=["block-status",r,e],a=bt({queryKey:n,enabled:!!(r&&e&&r!==e),staleTime:3e4,queryFn:async()=>{if(!r||!e||r===e)return{youBlocked:!1,blockedYou:!1};try{return await Oe(M,r,e)}catch(f){console.error("[useBlockStatus] Failed to load block status",f);const h=f;throw new Error(h.message??"Failed to load block status")}}}),c=ue({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for block operation.");const{error:f}=await M.from("blocked_users").upsert({blocker_id:r,blocked_id:e,created_at:new Date().toISOString()},{onConflict:"blocker_id,blocked_id"});if(f)throw console.error("[useBlockStatus] Failed to block user",f),new Error(f.message)},onSuccess:()=>{s.invalidateQueries({queryKey:n})}}),l=ue({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for unblock operation.");const{error:f}=await M.from("blocked_users").delete().eq("blocker_id",r).eq("blocked_id",e);if(f)throw console.error("[useBlockStatus] Failed to unblock user",f),new Error(f.message)},onSuccess:()=>{s.invalidateQueries({queryKey:n})}}),i=a.data?.youBlocked??!1,d=a.data?.blockedYou??!1,u=i||d,p=c.isPending||l.isPending;return{youBlocked:i,blockedYou:d,isBlocked:u,isLoading:a.isLoading||p,isError:a.isError,error:a.error??null,block:c,unblock:l}},Zt=({isSelf:e,isDeleted:t})=>({bubbleColors:t?"bg-muted text-muted-foreground border border-dashed border-border":e?"bg-primary text-white shadow-[0_0_20px_-6px_rgba(127,19,236,0.5)]":"bg-card text-foreground border border-border/60",bubbleShape:e?"rounded-2xl rounded-tr-sm":"rounded-2xl rounded-tl-sm"}),ce=e=>{const t=new Date(e);return Number.isNaN(t.getTime())?"":Tt(t,{hour:"numeric",minute:"2-digit",hour12:!0})},fe=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),er=e=>{const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const r=new Date,s=new Date;return s.setDate(r.getDate()-1),fe(t,r)?"Today":fe(t,s)?"Yesterday":Rt(t,{day:"numeric",month:"short",year:"numeric"})},Ee=(e,t,r=180*1e3)=>{const s=new Date(e),n=new Date(t);return Number.isNaN(s.getTime())||Number.isNaN(n.getTime())?!1:n.getTime()-s.getTime()<=r},tr=e=>({id:e.id,conversationId:e.conversation_id,senderId:e.user_id,body:e.body??null,attachmentUrl:e.attachment_url??null,createdAt:e.created_at??new Date().toISOString(),text:e.text??null,clientId:e.client_id??null,meta:e.meta??null}),cn=e=>({userId:e.user_id,lastReadAt:e.last_read_at??null,lastReadMessageId:e.last_read_message_id??null}),dn=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,deliveredAt:e.delivered_at??e.created_at??new Date().toISOString()}),un=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,emoji:e.emoji,createdAt:e.created_at}),ne="temp-",Q=e=>e.startsWith(ne),rr=e=>Q(e)?e:`${ne}${e}`,fn=(e=Date.now())=>`${ne}${e}`,nr=(e=Date.now())=>`${ne}${e}-${Math.random().toString(36).slice(2,8)}`,mn=(e,t={})=>{const{dedupe:r=!0,excludeTemp:s=!1,sort:n=!1}=t,a=e.filter(l=>typeof l=="string").map(l=>l.trim()).filter(Boolean).filter(l=>s?!Q(l):!0),c=r?Array.from(new Set(a)):a;return n&&c.sort(),c},Pe=()=>({pages:[{items:[],hasMore:!0,cursor:null}],pageParams:[null]}),Ue=e=>[...e].sort((t,r)=>{const s=Z(t.createdAt),n=Z(r.createdAt);return s!==n?s-n:t.id.localeCompare(r.id)}),q=e=>{const t=new Map;for(const a of e)t.set(a.id,a);const r=new Map,s=[];for(const a of t.values()){const c=a.clientId??X(a.body);if(!c){s.push(a);continue}const l=r.get(c);l?l.push(a):r.set(c,[a])}const n=[...s];for(const a of r.values()){if(a.length<=1){n.push(...a);continue}const c=a.filter(i=>!Q(i.id));if(c.length>0){n.push(...c);continue}const l=a.reduce((i,d)=>{if(!i)return d;const u=Z(i.createdAt),p=Z(d.createdAt);return p!==u?p>u?d:i:d.id.localeCompare(i.id)>0?d:i},null);l&&n.push(l)}return Ue(n)},I=e=>!e||!Array.isArray(e.pages)||!Array.isArray(e.pageParams)?Pe():e,sr=e=>e.length?{createdAt:e[0].createdAt,id:e[0].id}:null,K=e=>{const t=(e.pages??[]).map(r=>({...r,items:Array.isArray(r.items)?[...r.items]:[]}));return t.length>0?t:[{items:[],hasMore:!0,cursor:null}]},_e=(e,t)=>{const r=I(e),s=K(r),n=s[s.length-1],a=new Map;for(const c of n.items??[])a.set(c.id,c);return a.set(t.id,t),n.items=q(Array.from(a.values())),{...r,pages:s}},hn=(e,t)=>{const r=I(e),s=K(r).map(n=>({...n,items:(n.items??[]).map(a=>a.id===t.id?t:a)}));return{...r,pages:s}},pn=(e,t)=>{const r=I(e),s=K(r).map(n=>({...n,items:(n.items??[]).filter(a=>a.id!==t)}));return{...r,pages:s}},or=(e,t)=>{const r=I(e),s=K(r),n=t.tempId??null,a=t.row,c=a.clientId??X(a.body);if(n)for(const i of s)i.items=(i.items??[]).filter(d=>d.id!==n);if(c)for(const i of s)i.items=(i.items??[]).filter(d=>!(Q(d.id)&&X(d.body)===c));let l=!1;for(const i of s){const d=(i.items??[]).findIndex(u=>u.id===a.id);if(d>=0){i.items[d]=a,i.items=q(i.items),l=!0;break}}if(!l){const i=s[s.length-1];i.items=q([...i.items??[],a])}return{...r,pages:s}},gn=(e,t)=>{const r=I(e),s=I(t),n=g=>{if(g==null)return"initial";if(typeof g=="string")return`s:${g}`;if(typeof g=="number")return`n:${g}`;if(typeof g=="boolean")return`b:${g}`;if(typeof g=="object")try{return`o:${JSON.stringify(g)}`}catch{return"o:[unserializable]"}return`u:${String(g)}`},a=new Map,c=r.pageParams??[];for(const[g,x]of r.pages.entries()){const y=c[g];a.set(n(y),x)}const l=new Map,i=s.pageParams??[];for(const[g,x]of s.pages.entries()){const y=i[g];l.set(n(y),x)}const d=[],u=[],p=(s.pages.length>=r.pages.length?i:c)??[],f=new Set;for(const g of p){const x=n(g);if(f.has(x))continue;f.add(x);const y=a.get(x),b=l.get(x);if(!y&&!b)continue;if(!y){d.push(b),u.push(g);continue}if(!b){y&&(d.push(y),u.push(g));continue}const w=new Map;for(const C of y.items??[])w.set(C.id,C);for(const C of b.items??[])w.set(C.id,C);const S=q(Array.from(w.values()));d.push({...b,items:S,cursor:sr(S),hasMore:b.hasMore??y.hasMore??!0}),u.push(g)}const h=(g,x)=>{for(const y of g){const b=n(y);if(f.has(b))continue;const w=x.get(b);w&&(f.add(b),d.push(w),u.push(y))}};return h(i,l),h(c,a),{...s,pages:d.length>0?d:[{items:[],hasMore:!0,cursor:null}],pageParams:u.length>0?u:s.pageParams??r.pageParams}},xn=(e,t,r)=>{const s=r?.allowAppend??!0,n=tr(t),a=n.clientId??X(n.body),c=I(e),l=K(c);if(a)for(const i of l){const d=(i.items??[]).findIndex(u=>Q(u.id)&&X(u.body)===a);if(d>=0){i.items.splice(d,1);break}}for(const i of l){const d=(i.items??[]).findIndex(u=>u.id===n.id);if(d>=0)return i.items[d]=n,i.items=Ue(i.items),{...c,pages:l}}if(s){const i=l[l.length-1];i.items=q([...i.items??[],n])}return{...c,pages:l}},ar="id, conversation_id, user_id, body, message_type, text, client_id, meta, attachment_url, created_at",B="chat-media",me=(e=()=>`${Date.now()}-${Math.random().toString(36).slice(2,10)}`)=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():e(),he=new Map,Be=()=>Date.now(),He=e=>{if(!e)return null;const t=he.get(e);return t?t.expiresAt<=Be()?(he.delete(e),null):t.url:null},lr=(e,t,r)=>{if(!e||!t)return;const n=Math.max(0,r*1e3-6e4);he.set(e,{url:t,expiresAt:Be()+n})},xe=3600,G=e=>/^https?:\/\//i.test(e),We=(e,t)=>t&&M.storage.from(e).getPublicUrl(t).data.publicUrl||null,ze=async(e,t,r=xe)=>{if(!t)return null;const{data:s,error:n}=await M.storage.from(e).createSignedUrl(t,r);return n||!s?.signedUrl?null:(lr(`${e}:${t}`,s.signedUrl,r),s.signedUrl)};async function Re(e,t,r){if(!t)return null;if(G(t))return r?.allowHttp?t:null;const s=r?.ttlSeconds??xe,n=r?.allowPublicFallback??!1;if(!(r?.forceRefresh??!1)){const c=He(`${e}:${t}`);if(c)return c}try{const c=await ze(e,t,s);if(c)return c}catch{}if(!n)return null;try{return We(e,t)}catch{return null}}async function ir(e,t,r=xe){if(t&&!G(t)&&!He(`${e}:${t}`))try{await ze(e,t,r)}catch{}}const Te=async e=>{if(!e||G(e))return;const{error:t}=await M.storage.from(B).remove([e]);if(t)throw t},cr=10*1024*1024,pe={"image/jpg":"jpg","image/jpeg":"jpg","image/pjpeg":"jpg","image/png":"png","image/webp":"webp","image/gif":"gif","image/avif":"avif","image/heic":"heic","image/heif":"heif"},dr=new Set(Object.keys(pe)),Ye=e=>{if(e.type&&pe[e.type])return pe[e.type];const t=e.name.split(".").pop()?.toLowerCase()??null;return t?t==="jpeg"?"jpg":["jpg","png","webp","gif","avif","heic","heif"].includes(t)?t:null:null},ur=e=>{if(e.type){if(!e.type.startsWith("image/"))return{ok:!1,error:"Please choose an image file."};if(!dr.has(e.type))return{ok:!1,error:"Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image."}}else if(!Ye(e))return{ok:!1,error:"Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image."};return e.size>cr?{ok:!1,error:"That image is too large (max 10MB). Try a smaller file."}:{ok:!0}},fr=(e,t,r)=>{const s=me(()=>String(Date.now()));return`message_attachments/${e}/${t}/${Date.now()}-${s}.${r}`};function bn(e){const{conversationId:t,userId:r,isBlocked:s,blockedYou:n,attemptSend:a}=e,[c,l]=m.useState(null),[i,d]=m.useState(!1),u=m.useRef(0),p=m.useRef(null),f=m.useCallback(()=>l(null),[]),h=m.useCallback(()=>{u.current+=1,d(!1)},[]),g=m.useCallback(()=>{!t||!r||s||n||p.current?.click()},[n,t,s,r]),x=m.useCallback(async b=>{if(!t||!r||s||n)return;l(null);const w=ur(b);if(!w.ok){l(w.error);return}const S=u.current+=1;d(!0);const C=Ye(b);if(!C){l("Unsupported image format."),d(!1);return}const N=fr(t,r,C);try{const{error:k}=await M.storage.from(B).upload(N,b,{cacheControl:"3600",upsert:!1});if(S!==u.current){try{await Te(N)}catch{}return}if(k){console.error("[useAttachmentUpload] image upload error",k),l("Upload failed. Please try another image.");return}if(ir(B,N),S!==u.current){try{await Te(N)}catch{}return}a({text:"",attachmentPath:N})}catch(k){console.error("[useAttachmentUpload] sendImageFile failed",k),l("Something went wrong while sending your image.")}finally{S===u.current&&d(!1)}},[a,n,t,s,r]),y=m.useCallback(async b=>{const w=b.target.files?.[0];b.target.value="",!(!w||!t||!r)&&(i||s||n||await x(w))},[n,t,s,i,x,r]);return{fileInputRef:p,openFilePicker:g,handleImageSelected:y,sendImageFile:x,isUploadingImage:i,uploadError:c,clearUploadError:f,cancelImageUpload:h}}const mr=e=>{if(!e)return"Unknown error.";if(typeof e=="string")return e;const t=e,r=t.message??(e instanceof Error?e.message:typeof e=="object"?JSON.stringify(e):String(e)),s=t.code?` (${t.code})`:"",n=t.details?` â€” ${t.details}`:"",a=t.hint?` Hint: ${t.hint}`:"";return`${r}${s}${n}${a}`.trim()},Me=(e,t,r)=>{const s=e.trim();return!t&&!s?{payload:null,trimmed:s}:t&&s?{payload:{type:"text+image",text:s,clientId:r},trimmed:s}:t?{payload:{type:"image",text:"",clientId:r},trimmed:s}:{payload:{type:"text",text:s,clientId:r},trimmed:s}},yn=(e,t)=>{const{user:r}=Ie(),s=r?.id??null,n=$e();return ue({mutationFn:async({text:a,attachmentPath:c,clientId:l})=>{if(!e)throw new Error("Missing conversation id.");if(!s)throw new Error("You must be signed in to send messages.");if(t?.otherUserId){const h=await Oe(M,s,t.otherUserId);if(h.youBlocked)throw new Error("You have blocked this user. Unblock them to send messages.");if(h.blockedYou)throw new Error("You cannot send messages because this user blocked you.")}const i=l??me(),{payload:d}=Me(a,c??null,i);if(!d)throw new Error("Cannot send an empty message.");const{data:u,error:p}=await M.from("messages").insert({conversation_id:e,user_id:s,sender_id:s,body:d,message_type:d.type,text:d.text??null,client_id:d.clientId??null,meta:d,attachment_url:c??null}).select(ar).single();if(p)throw console.error("[useSendMessage] Failed to send message",p),new Error(mr(p));if(!u)throw new Error("Failed to send message.");if(u.conversation_id!==e||u.user_id!==s)throw new Error("Unexpected message response.");return{id:u.id,conversationId:u.conversation_id,senderId:u.user_id,body:u.body??null,attachmentUrl:u.attachment_url??null,createdAt:u.created_at,meta:u.meta??null}},onMutate:async a=>{if(!e||!s)return{previous:void 0,tempId:null};const{text:c,attachmentPath:l}=a,i=a.clientId??me();a.clientId=i;const{payload:d,trimmed:u}=Me(c,l??null,i);if(!d)throw new Error("Cannot send an empty message.");const p=a.tempId,f=typeof p=="string"&&p.length?rr(p):nr(),h=ie(e),g=n.getQueryData(h),x=g?.pages?.[g.pages.length-1]?.items,y=x&&x.length?x[x.length-1]?.createdAt:null,b=y?new Date(y).getTime():NaN,w=Number.isFinite(b),S=w?b:Date.now(),C=new Date(S+1).toISOString(),N={id:f,conversationId:e,senderId:s,body:d,attachmentUrl:l??null,createdAt:C,meta:d};await n.cancelQueries({queryKey:h});const k=n.getQueryData(h);return n.setQueryData(h,_=>_e(_,N)),{previous:k,tempId:f,optimistic:N,usedServerAnchor:w,payload:{text:u,attachmentPath:l??null,clientId:i}}},onError:(a,c,l)=>{if(console.error("[useSendMessage] sendMessage error",a),!e)return;const{previous:i,optimistic:d,payload:u,tempId:p}=l??{previous:void 0,tempId:null},f=ie(e);n.setQueryData(f,h=>d?_e(i??h,d):I(i??h)),p&&u&&t?.onFailed&&t.onFailed(p,u,a)},onSuccess:(a,c,l)=>{if(!e)return;const i=l?.tempId,d=ie(e),u=l?.optimistic?.createdAt??null;if(u&&l?.usedServerAnchor){const p=new Date(a.createdAt).getTime(),f=new Date(u).getTime();Number.isFinite(p)&&Number.isFinite(f)&&p<f&&(a={...a,createdAt:u})}n.setQueryData(d,p=>or(p,{tempId:i,row:a})),Pt(n,s,e,p=>({...p,lastMessagePreview:wt(a.body)??p.lastMessagePreview,lastMessageAt:a.createdAt??p.lastMessageAt,lastMessageAtLabel:yt(a.createdAt??null),hasUnread:!1,lastMessageIsFromSelf:!0,lastMessageSeenByOthers:!1}),{moveToTop:!0}),t?.onRecovered&&t.onRecovered(l?.tempId??null)}})};async function Ve(e){if(!e)return!1;try{if(typeof navigator<"u"&&navigator.clipboard?.writeText)return await navigator.clipboard.writeText(e),!0}catch{}try{if(typeof document>"u")return!1;const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length);const r=document.execCommand("copy");return document.body.removeChild(t),r}catch{return!1}}const hr=D.memo(function({isSelf:t,isDeleted:r,children:s,className:n="",role:a,tabIndex:c,...l}){const{bubbleColors:i,bubbleShape:d}=Zt({isSelf:t,isDeleted:r});return o.jsx("div",{role:a??"button",tabIndex:c??0,className:ge("inline-flex max-w-[85%] px-5 py-3 text-[15px] leading-relaxed transition-transform duration-150 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",d,i,n),...l,children:o.jsx("div",{className:"flex flex-col gap-1 text-left leading-relaxed",children:s})})}),pr=/((?:https?:\/\/|www\.)[^\s<]+[^<.,:;"')\]\s])/gi,gr=/([A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,})/gi,xr=/(\+?\d[\d\s().-]{7,}\d)/g,br=e=>/^https?:\/\//i.test(e)?e:/^www\./i.test(e)?`https://${e}`:e,Xe=e=>e.replace(/\D/g,""),yr=e=>{const t=e.trim(),r=t.startsWith("+"),s=Xe(t);return`${r?"+":""}${s}`};function wr(e,t){const r=t.trim();if(!r)return[{text:e,match:!1}];const s=e.toLowerCase(),n=r.toLowerCase(),a=[];let c=0;for(;c<e.length;){const l=s.indexOf(n,c);if(l<0){a.push({text:e.slice(c),match:!1});break}l>c&&a.push({text:e.slice(c,l),match:!1}),a.push({text:e.slice(l,l+r.length),match:!0}),c=l+r.length}return a.length?a:[{text:e,match:!1}]}function Y(e,t){const r=(t??"").trim();return r?wr(e,r).map((s,n)=>s.match?o.jsx("mark",{className:"rounded bg-primary/20 px-0.5 text-foreground",children:s.text},`${n}-${s.text}`):o.jsx(D.Fragment,{children:s.text},`${n}-${s.text}`)):e}const vr=({text:e,highlight:t})=>{const r=l=>{l.stopPropagation()},s=[],n=(l,i)=>{const d=new RegExp(l);let u;for(;(u=d.exec(e))!==null;)s.push({start:u.index,end:u.index+u[0].length,kind:i,raw:u[0]})};n(pr,"url"),n(gr,"email"),n(xr,"phone"),s.sort((l,i)=>l.start-i.start||i.end-l.end);const a=[];let c=0;for(const l of s)if(!(l.start<c)&&!(l.kind==="phone"&&Xe(l.raw).length<10)){if(l.start>c){const i=e.slice(c,l.start);a.push(Y(i,t))}if(l.kind==="url"){const i=br(l.raw);a.push(o.jsx("a",{href:i,target:"_blank",rel:"noreferrer noopener",className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:Y(l.raw,t)},`${l.start}-${l.raw}`))}else if(l.kind==="email")a.push(o.jsx("a",{href:`mailto:${l.raw}`,className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:Y(l.raw,t)},`${l.start}-${l.raw}`));else{const i=yr(l.raw);a.push(o.jsx("a",{href:`tel:${i}`,className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:Y(l.raw,t)},`${l.start}-${l.raw}`))}c=l.end}return c<e.length&&a.push(Y(e.slice(c),t)),o.jsx(o.Fragment,{children:a})},Sr=({path:e})=>{const[t,r]=m.useState(null),[s,n]=m.useState(!1),[a,c]=m.useState(!1),l=m.useRef(!0),i=m.useRef(null),d=m.useRef(!1),u=m.useRef(null),p=m.useRef(!1),f=m.useMemo(()=>!!e,[e]);return m.useEffect(()=>()=>{l.current=!1},[]),m.useEffect(()=>{let h=!1;return i.current=e||null,d.current=!1,r(null),n(!1),e?G(e)?(r(e),()=>{h=!0}):((async()=>{try{const g=await Re(B,e,{allowPublicFallback:!0,forceRefresh:!1,allowHttp:!0});if(h||i.current!==e||!l.current)return;if(!g){n(!0);return}r(g)}catch{!h&&l.current&&i.current===e&&n(!0)}})(),()=>{h=!0}):(n(!0),()=>{h=!0})},[e]),s?o.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Image unavailable."}):t?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"mt-1 overflow-hidden rounded-xl border border-border bg-background/80",role:f?"button":void 0,tabIndex:f?0:void 0,onTouchStart:()=>{u.current=Date.now(),p.current=!1},onTouchEnd:()=>{if(u.current==null)return;const h=Date.now()-u.current;p.current=h>=450,u.current=null},onTouchCancel:()=>{u.current=null,p.current=!1},onClick:h=>{h.stopPropagation(),f&&(p.current||c(!0))},onKeyDown:h=>{f&&(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),h.stopPropagation(),c(!0))},onContextMenu:h=>{h.stopPropagation()},"aria-label":"Open image",children:o.jsx("img",{src:t,alt:"Attachment",className:"max-h-64 w-full cursor-zoom-in object-cover",loading:"lazy",onError:async()=>{if(!(!l.current||i.current!==e)){if(G(e)){n(!0);return}try{const h=We(B,e);if(h&&t===h){n(!0);return}if(d.current){n(!0);return}d.current=!0;const g=await Re(B,e,{allowPublicFallback:!0,forceRefresh:!0,allowHttp:!0});if(!g||g===t){n(!0);return}if(!l.current||i.current!==e)return;r(g)}catch{l.current&&i.current===e&&n(!0)}}}})}),o.jsx(jr,{open:a,onOpenChange:c,url:t})]}):o.jsx("div",{className:"mt-1 h-32 w-40 animate-pulse rounded-xl bg-border/40"})},de=(e,t,r)=>Math.max(t,Math.min(r,e));function jr({open:e,onOpenChange:t,url:r}){const[s,n]=m.useState(1),[a,c]=m.useState({x:0,y:0}),[l,i]=m.useState(!1),d=m.useRef(!1),u=m.useRef({x:0,y:0}),p=m.useRef({x:0,y:0}),f=()=>{n(1),c({x:0,y:0})};return m.useEffect(()=>{e||f()},[e]),o.jsx(Le,{open:e,onOpenChange:t,children:o.jsx(Fe,{className:"max-w-none w-[calc(100%-1rem)] h-[calc(100%-1rem)] max-h-none p-0 overflow-hidden bg-black border-border/30","aria-label":"Image viewer",children:o.jsxs("div",{className:"relative h-full w-full",children:[o.jsxs("div",{className:"absolute left-0 top-0 z-10 flex w-full items-center justify-between gap-2 p-3",children:[o.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-black/40 px-3 py-1 text-xs text-white",children:[o.jsx("span",{className:"font-medium",children:"Image"}),o.jsx("span",{className:"opacity-75",children:"Â·"}),o.jsx("span",{className:"opacity-75",children:"Scroll to zoom"})]}),o.jsxs("div",{className:"inline-flex items-center gap-2",children:[o.jsxs("button",{type:"button",className:"inline-flex h-10 items-center gap-2 rounded-full bg-black/40 px-3 text-sm text-white hover:bg-black/55",onClick:()=>{try{window.open(r,"_blank","noopener,noreferrer")}catch{}},"aria-label":"Open image in new tab",children:[o.jsx(zt,{className:"h-4 w-4","aria-hidden":!0}),o.jsx("span",{className:"hidden sm:inline",children:"Open"})]}),o.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full bg-black/40 p-1 text-white",children:[o.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-white/10",onClick:()=>n(h=>de(Number((h-.25).toFixed(2)),1,4)),"aria-label":"Zoom out",children:o.jsx(Vt,{className:"h-4 w-4","aria-hidden":!0})}),o.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-white/10",onClick:()=>n(h=>de(Number((h+.25).toFixed(2)),1,4)),"aria-label":"Zoom in",children:o.jsx(Lt,{className:"h-4 w-4","aria-hidden":!0})}),o.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-white/10",onClick:f,"aria-label":"Reset view",children:o.jsx(Qt,{className:"h-4 w-4","aria-hidden":!0})})]}),o.jsx("button",{type:"button",className:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-black/40 text-white hover:bg-black/55",onClick:()=>t(!1),"aria-label":"Close",children:o.jsx(Ft,{className:"h-5 w-5","aria-hidden":!0})})]})]}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",onWheel:h=>{if(s<=1)return;h.preventDefault();const g=-h.deltaY,x=de(Number((s+g*.002).toFixed(2)),1,4);n(x)},onDoubleClick:()=>{n(h=>h===1?2:1),c({x:0,y:0})},onPointerDown:h=>{s<=1||(d.current=!0,i(!0),u.current={x:h.clientX,y:h.clientY},p.current=a,h.currentTarget.setPointerCapture?.(h.pointerId))},onPointerMove:h=>{if(!d.current)return;const g=h.clientX-u.current.x,x=h.clientY-u.current.y;c({x:p.current.x+g,y:p.current.y+x})},onPointerUp:()=>{d.current=!1,i(!1)},onPointerCancel:()=>{d.current=!1,i(!1)},children:o.jsx("img",{src:r,alt:"Attachment",className:"max-h-full max-w-full select-none object-contain",draggable:!1,style:{transform:`translate3d(${a.x}px, ${a.y}px, 0) scale(${s})`,transformOrigin:"center",transition:l?"none":"transform 120ms ease-out",cursor:s>1?"grab":"zoom-in"}})})]})})})}function $(e){return typeof e=="string"&&e.trim().length>0}function Cr(e){return!e||typeof e!="object"?null:e}function Nr({ui:e,actions:t,onAction:r}){const s=m.useMemo(()=>Cr(e),[e]),n=m.useMemo(()=>Array.isArray(t)?t:[],[t]),a=m.useMemo(()=>{const f=new Map;for(const h of n)h&&typeof h=="object"&&$(h.id)&&f.set(String(h.id),h);return f},[n]),[c,l]=m.useState({}),i=f=>{const h=Array.from(new Set(f.filter($))).slice(0,6);return h.length===0?null:o.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(g=>{const x=a.get(g);if(!x)return null;const y=(()=>{const S=String(x.type??"").toLowerCase();return S==="dismiss"?"Dismiss":S==="navigate"?"Open":"Do"})(),b=$(x.label)?x.label:y,w=!!c[g];return o.jsx("button",{type:"button",onClick:async()=>{try{l(S=>({...S,[g]:!0})),await r(g)}finally{l(S=>({...S,[g]:!1}))}},disabled:w,className:"rounded-full px-3 py-1 text-xs font-semibold transition "+(w?"bg-muted text-muted-foreground opacity-70":"bg-primary text-primary-foreground hover:bg-primary/90"),children:w?"Workingâ€¦":b},g)})})};if(!s||(s.layout??"stacked")!=="stacked"){const f=n.map(h=>String(h?.id??"")).filter($);return f.length===0?null:o.jsx("div",{className:"mt-2",children:i(f)})}const d=Array.isArray(s.cards)?s.cards:[],u=new Set;for(const f of d){const h=(Array.isArray(f?.actionIds)?f.actionIds:[]).filter($);for(const g of h)u.add(String(g))}const p=n.map(f=>String(f?.id??"")).filter(f=>$(f)&&!u.has(f));return!s.heading&&d.length===0&&p.length===0?null:o.jsxs("div",{className:"mt-2 space-y-2",children:[(s.heading||s.subheading)&&o.jsxs("div",{className:"rounded-2xl border border-border/60 bg-muted/20 p-3",children:[s.heading?o.jsx("div",{className:"text-sm font-semibold text-foreground",children:s.heading}):null,s.subheading?o.jsx("div",{className:"mt-0.5 text-xs text-muted-foreground",children:s.subheading}):null]}),d.map(f=>{const h=(Array.isArray(f.actionIds)?f.actionIds:[]).filter($);return o.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/60 p-3",children:o.jsxs("div",{className:"flex gap-3",children:[o.jsx("div",{className:"h-16 w-12 shrink-0 overflow-hidden rounded-xl bg-muted",children:f.poster?o.jsx("img",{src:f.poster,alt:f.title??"",className:"h-full w-full object-cover",loading:"lazy"}):null}),o.jsxs("div",{className:"min-w-0 flex-1",children:[o.jsx("div",{className:"flex items-start justify-between gap-2",children:o.jsxs("div",{className:"min-w-0",children:[o.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:f.title??""}),o.jsx("div",{className:"mt-0.5 truncate text-xs text-muted-foreground",children:[f.kind,f.year?String(f.year):null].filter(Boolean).join(" â€¢ ")})]})}),f.reason?o.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:f.reason}):null,Array.isArray(f.badges)&&f.badges.length?o.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:f.badges.slice(0,6).map(g=>o.jsx("span",{className:"rounded-full bg-muted/70 px-2 py-0.5 text-[11px] font-semibold text-muted-foreground",children:g},g))}):null,h.length?o.jsx("div",{className:"mt-3",children:i(h)}):null]})]})},f.id)}),p.length?o.jsxs("div",{className:"rounded-2xl border border-border/60 bg-card/40 p-3",children:[o.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Actions"}),o.jsx("div",{className:"mt-2",children:i(p)})]}):null]})}function kr({handles:e,className:t}){const r=Array.isArray(e)?e.map(p=>String(p)).filter(Boolean).slice(0,50):[],[s,n]=D.useState(r[0]??null),[a,c]=D.useState(!1),[l,i]=D.useState({}),d=D.useCallback(async p=>{if(p&&!Object.prototype.hasOwnProperty.call(l,p)){c(!0);try{const f=await vt("assistant-tool-result",{actionId:p});i(h=>({...h,[p]:f}))}catch(f){i(h=>({...h,[p]:null})),V.error(f?.message??"Couldn't load evidence.")}finally{c(!1)}}},[l]);if(D.useEffect(()=>{s&&d(s)},[s,d]),r.length===0)return null;const u=s?l[s]:null;return o.jsx("div",{className:t,children:o.jsxs(Le,{children:[o.jsx(Mt,{asChild:!0,children:o.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-3 py-1 text-xs font-medium text-muted-foreground hover:bg-muted",children:["Evidence",o.jsx(St,{variant:"outline",className:"px-2 py-0 text-[11px]",children:r.length})]})}),o.jsxs(Fe,{className:"max-w-2xl",children:[o.jsxs(Dt,{children:[o.jsx(It,{children:"Evidence"}),o.jsx($t,{children:"Tool results the assistant used while generating this reply."})]}),o.jsxs("div",{className:"mt-2 flex flex-col gap-3",children:[o.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(p=>o.jsx("button",{type:"button",onClick:()=>{n(p),d(p)},className:`rounded-full border px-3 py-1 text-xs transition ${p===s?"border-primary/50 bg-primary/15 text-primary":"border-border bg-background text-muted-foreground hover:bg-muted"}`,title:p,children:p},p))}),o.jsx("div",{className:"rounded-2xl border border-border bg-background p-4",children:a&&!u?o.jsx("div",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):u?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[o.jsx("div",{className:"text-sm font-medium text-foreground",children:u.actionType}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(u.createdAt).toLocaleString()}),o.jsx(jt,{variant:"ghost",size:"sm",onClick:async()=>{await Ve(JSON.stringify(u.payload,null,2))?V.show("Evidence copied."):V.error("Couldn't copy evidence.")},children:"Copy JSON"})]})]}),o.jsx("pre",{className:"mt-3 max-h-[55vh] overflow-auto whitespace-pre-wrap break-words rounded-xl bg-muted/30 p-3 text-xs text-foreground",children:JSON.stringify(u.payload,null,2)})]}):o.jsx("div",{className:"text-sm text-muted-foreground",children:"No details available."})})]})]})]})})}const Ar=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ”¥","ðŸ˜"],wn=D.memo(function({message:t,meta:r,sender:s,isSelf:n,deliveryStatus:a,showDeliveryStatus:c,reactions:l,index:i,previousMessage:d,nextMessage:u,firstUnreadIndex:p,activeActionMessageId:f,longPressTriggeredRef:h,onOpenMessageActions:g,onCloseMessageActions:x,onOpenEditDialog:y,onOpenDeleteDialog:b,onToggleReaction:w,onRetryMessage:S,onDiscardFailedMessage:C,onAssistantAction:N,onBubbleTouchStart:k,onBubbleTouchEndOrCancel:_,searchQuery:O,isSearchMatch:j,isActiveSearchMatch:A}){const R=d!=null&&d.senderId===t.senderId,ae=u!=null&&u.senderId===t.senderId,it=R&&Ee(d.createdAt,t.createdAt),ct=ae&&Ee(t.createdAt,u.createdAt),dt=!(R&&it),ut=!(ae&&ct),ft=p!=null&&i===p,Se=i===0||d!=null&&!fe(new Date(d.createdAt),new Date(t.createdAt)),mt=i===0||Se?"mt-0":dt?"mt-3":"mt-1.5",T=r.deleted===!0,je=r.editedAt,Ce=r.deletedAt,Ne=s?.displayName??(n?"You":"Someone"),U=Ct(t.body),ke=(O??"").trim(),ht=!!(ke&&j&&!T),pt=(()=>{const v=n?"You":Ne;return T?`${v} deleted a message`:U?`${v} said: ${U}`:t.attachmentUrl?`${v} sent an attachment`:`${v} sent a message`})(),gt=!n&&ut,le=()=>{if(h.current){h.current=!1;return}f===t.id?x():g(t)};return o.jsxs("div",{className:"px-0",children:[Se&&o.jsx("div",{className:"my-4 flex items-center justify-center",children:o.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-muted-foreground",children:[o.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),o.jsx("span",{className:"rounded-full bg-muted px-3 py-0.5 text-xs font-medium text-muted-foreground",children:er(t.createdAt)}),o.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),ft&&o.jsx("div",{className:"my-4 flex items-center justify-center",role:"separator","aria-label":"New messages",children:o.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-primary",children:[o.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),o.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-0.5 text-xs font-semibold text-primary",children:"New messages"}),o.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),o.jsxs("div",{className:`flex w-full flex-col gap-0.5 ${mt}`,children:[o.jsxs("div",{className:`flex w-full items-end gap-2 ${n?"justify-end":"justify-start"}`,children:[!n&&o.jsx(o.Fragment,{children:gt?o.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0 overflow-hidden rounded-full bg-muted",children:s?.avatarUrl?o.jsx("img",{src:s.avatarUrl,alt:s.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):o.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs font-medium text-muted-foreground",children:Ne.slice(0,2).toUpperCase()})}):o.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0"})}),o.jsxs(hr,{isSelf:n,isDeleted:T,"data-message-action-scope":t.id,className:T?"":A?"ring-2 ring-primary/60":j?"ring-2 ring-primary/25":"",onClick:le,onContextMenu:v=>{v.preventDefault(),le()},onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),le())},onTouchStart:()=>k(t),onTouchEnd:_,onTouchCancel:_,"aria-label":pt,children:[U&&o.jsx("p",{className:"whitespace-pre-wrap break-words [overflow-wrap:anywhere] text-sm leading-snug",children:o.jsx(vr,{text:U,highlight:ht?ke:void 0})}),!T&&t.attachmentUrl&&o.jsx(Sr,{path:t.attachmentUrl})]})]}),l.length>0&&o.jsx("div",{className:`mt-0.5 flex w-full ${n?"justify-end pr-6":"justify-start pl-6"}`,children:o.jsx("div",{className:"inline-flex flex-wrap items-center gap-1 rounded-full bg-muted px-1.5 py-0.5 text-xs text-foreground",children:l.map(v=>o.jsxs("button",{type:"button",onClick:()=>w(t.id,v.emoji),className:`inline-flex items-center gap-1 rounded-full px-1.5 py-0.5 transition hover:bg-background ${v.reactedBySelf?"bg-primary/10":""}`,children:[o.jsx("span",{className:"text-[17px]",children:v.emoji}),v.count>1&&o.jsx("span",{className:"text-xs text-muted-foreground",children:v.count})]},v.emoji))})}),f===t.id&&!T&&o.jsx("div",{className:`mt-1 flex w-full ${n?"justify-end pr-6":"justify-start pl-6"}`,children:o.jsxs("div",{className:"inline-flex flex-col items-stretch gap-1 rounded-2xl bg-muted px-2.5 py-1.5 text-xs text-foreground select-none","data-message-action-scope":t.id,children:[o.jsx("div",{className:"flex items-center justify-center gap-1",children:Ar.map(v=>o.jsx("button",{type:"button",onClick:()=>{w(t.id,v),x()},className:"flex h-7 w-7 items-center justify-center rounded-full transition hover:bg-background",children:o.jsx("span",{className:"text-[17px]",children:v})},v))}),o.jsxs("div",{className:`mt-1 flex flex-wrap items-center gap-2 ${n?"justify-end":"justify-start"}`,children:[U?o.jsxs("button",{type:"button",onClick:async()=>{await Ve(U)?V.show("Copied to clipboard."):V.error("Couldn't copy to clipboard."),x()},className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-muted-foreground hover:bg-background",children:[o.jsx(Ot,{className:"h-3.5 w-3.5","aria-hidden":!0}),o.jsx("span",{children:"Copy"})]}):null,n?(()=>{if(t.attachmentUrl||T)return null;const v=Nt(t.body);return v!=="text"&&v!=="unknown"?null:o.jsxs("button",{type:"button",onClick:xt=>y(t,xt.currentTarget),className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-muted-foreground hover:bg-background",children:[o.jsx(qt,{className:"h-3.5 w-3.5","aria-hidden":!0}),o.jsx("span",{children:"Edit"})]})})():null,n?o.jsxs("button",{type:"button",onClick:()=>b(t),className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-destructive hover:bg-destructive/10",children:[o.jsx(Jt,{className:"h-3.5 w-3.5","aria-hidden":!0}),o.jsx("span",{children:"Delete"})]}):null]})]})}),!n&&(t?.meta?.ai?.ui||t?.meta?.ai?.actions)?o.jsx("div",{className:"pl-7 pr-1",children:o.jsx(Nr,{ui:t.meta.ai.ui,actions:t.meta.ai.actions,onAction:async v=>{N&&await N(t.id,v)}})}):null,!n&&Array.isArray(t?.meta?.ai?.toolHandles)&&t.meta.ai.toolHandles.length>0?o.jsx("div",{className:"pl-7 pr-1",children:o.jsx(kr,{handles:t.meta.ai.toolHandles})}):null,c&&a&&o.jsx("div",{className:`flex items-center gap-1 text-xs text-muted-foreground ${n?"justify-end pr-1":"justify-start pl-7"}`,children:a.status==="failed"?o.jsxs(o.Fragment,{children:[o.jsx(Ut,{className:"h-3 w-3 text-destructive","aria-hidden":!0}),o.jsx("span",{children:"Failed to send."}),o.jsx("button",{type:"button",className:"text-destructive underline",onClick:()=>S(t),children:"Retry"}),o.jsx("span",{"aria-hidden":"true",children:"Â·"}),o.jsx("button",{type:"button",className:"text-destructive underline",onClick:()=>C(t),children:"Discard"})]}):a.status==="sending"?o.jsxs(o.Fragment,{children:[o.jsx(kt,{className:"h-3 w-3 animate-spin","aria-hidden":!0}),o.jsx("span",{children:"Sendingâ€¦"})]}):a.status==="sent"?o.jsxs(o.Fragment,{children:[o.jsx(_t,{className:"h-3 w-3","aria-hidden":!0}),o.jsx("span",{children:"Sent"})]}):a.status==="delivered"?o.jsxs(o.Fragment,{children:[o.jsx(Ae,{className:"h-3 w-3","aria-hidden":!0}),o.jsx("span",{children:"Delivered"})]}):o.jsxs(o.Fragment,{children:[o.jsx(Ae,{className:"h-3 w-3","aria-hidden":!0}),o.jsx("span",{children:a.seenAt?`Seen ${ce(a.seenAt)}`:"Seen"})]})}),T&&Ce&&o.jsxs("p",{className:`text-xs text-muted-foreground ${n?"text-right pr-1":"text-left pl-7"}`,children:["Deleted ",ce(Ce)]}),!T&&je&&o.jsxs("p",{className:`text-xs text-muted-foreground ${n?"text-right pr-1":"text-left pl-7"}`,children:["Edited ",ce(je)]})]})]},t.id)});function Er(e){const t=Pr(e),r=m.forwardRef((s,n)=>{const{children:a,...c}=s,l=m.Children.toArray(a),i=l.find(Rr);if(i){const d=i.props.children,u=l.map(p=>p===i?m.Children.count(d)>1?m.Children.only(null):m.isValidElement(d)?d.props.children:null:p);return o.jsx(t,{...c,ref:n,children:m.isValidElement(d)?m.cloneElement(d,void 0,u):null})}return o.jsx(t,{...c,ref:n,children:a})});return r.displayName=`${e}.Slot`,r}function Pr(e){const t=m.forwardRef((r,s)=>{const{children:n,...a}=r;if(m.isValidElement(n)){const c=Mr(n),l=Tr(a,n.props);return n.type!==m.Fragment&&(l.ref=s?At(s,c):c),m.cloneElement(n,l)}return m.Children.count(n)>1?m.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var _r=Symbol("radix.slottable");function Rr(e){return m.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===_r}function Tr(e,t){const r={...t};for(const s in t){const n=e[s],a=t[s];/^on[A-Z]/.test(s)?n&&a?r[s]=(...l)=>{const i=a(...l);return n(...l),i}:n&&(r[s]=n):s==="style"?r[s]={...n,...a}:s==="className"&&(r[s]=[n,a].filter(Boolean).join(" "))}return{...e,...r}}function Mr(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var Dr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],J=Dr.reduce((e,t)=>{const r=Er(`Primitive.${t}`),s=m.forwardRef((n,a)=>{const{asChild:c,...l}=n,i=c?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),o.jsx(i,{...l,ref:a})});return s.displayName=`Primitive.${t}`,{...e,[t]:s}},{});function Ir(e,t=[]){let r=[];function s(a,c){const l=m.createContext(c),i=r.length;r=[...r,c];const d=p=>{const{scope:f,children:h,...g}=p,x=f?.[e]?.[i]||l,y=m.useMemo(()=>g,Object.values(g));return o.jsx(x.Provider,{value:y,children:h})};d.displayName=a+"Provider";function u(p,f){const h=f?.[e]?.[i]||l,g=m.useContext(h);if(g)return g;if(c!==void 0)return c;throw new Error(`\`${p}\` must be used within \`${a}\``)}return[d,u]}const n=()=>{const a=r.map(c=>m.createContext(c));return function(l){const i=l?.[e]||a;return m.useMemo(()=>({[`__scope${e}`]:{...l,[e]:i}}),[l,i])}};return n.scopeName=e,[s,$r(n,...t)]}function $r(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const s=e.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(a){const c=s.reduce((l,{useScope:i,scopeName:d})=>{const p=i(a)[`__scope${d}`];return{...l,...p}},{});return m.useMemo(()=>({[`__scope${t.scopeName}`]:c}),[c])}};return r.scopeName=t.scopeName,r}function Lr(e,[t,r]){return Math.min(r,Math.max(t,e))}function Fr(e,t){return m.useReducer((r,s)=>t[r][s]??r,e)}var be="ScrollArea",[qe]=Ir(be),[Or,E]=qe(be),Ge=m.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:s="hover",dir:n,scrollHideDelay:a=600,...c}=e,[l,i]=m.useState(null),[d,u]=m.useState(null),[p,f]=m.useState(null),[h,g]=m.useState(null),[x,y]=m.useState(null),[b,w]=m.useState(0),[S,C]=m.useState(0),[N,k]=m.useState(!1),[_,O]=m.useState(!1),j=z(t,R=>i(R)),A=Bt(n);return o.jsx(Or,{scope:r,type:s,dir:A,scrollHideDelay:a,scrollArea:l,viewport:d,onViewportChange:u,content:p,onContentChange:f,scrollbarX:h,onScrollbarXChange:g,scrollbarXEnabled:N,onScrollbarXEnabledChange:k,scrollbarY:x,onScrollbarYChange:y,scrollbarYEnabled:_,onScrollbarYEnabledChange:O,onCornerWidthChange:w,onCornerHeightChange:C,children:o.jsx(J.div,{dir:A,...c,ref:j,style:{position:"relative","--radix-scroll-area-corner-width":b+"px","--radix-scroll-area-corner-height":S+"px",...e.style}})})});Ge.displayName=be;var Qe="ScrollAreaViewport",Ke=m.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:s,nonce:n,...a}=e,c=E(Qe,r),l=m.useRef(null),i=z(t,l,c.onViewportChange);return o.jsxs(o.Fragment,{children:[o.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),o.jsx(J.div,{"data-radix-scroll-area-viewport":"",...a,ref:i,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...e.style},children:o.jsx("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:s})})]})});Ke.displayName=Qe;var P="ScrollAreaScrollbar",ye=m.forwardRef((e,t)=>{const{forceMount:r,...s}=e,n=E(P,e.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:c}=n,l=e.orientation==="horizontal";return m.useEffect(()=>(l?a(!0):c(!0),()=>{l?a(!1):c(!1)}),[l,a,c]),n.type==="hover"?o.jsx(Ur,{...s,ref:t,forceMount:r}):n.type==="scroll"?o.jsx(Br,{...s,ref:t,forceMount:r}):n.type==="auto"?o.jsx(Je,{...s,ref:t,forceMount:r}):n.type==="always"?o.jsx(we,{...s,ref:t}):null});ye.displayName=P;var Ur=m.forwardRef((e,t)=>{const{forceMount:r,...s}=e,n=E(P,e.__scopeScrollArea),[a,c]=m.useState(!1);return m.useEffect(()=>{const l=n.scrollArea;let i=0;if(l){const d=()=>{window.clearTimeout(i),c(!0)},u=()=>{i=window.setTimeout(()=>c(!1),n.scrollHideDelay)};return l.addEventListener("pointerenter",d),l.addEventListener("pointerleave",u),()=>{window.clearTimeout(i),l.removeEventListener("pointerenter",d),l.removeEventListener("pointerleave",u)}}},[n.scrollArea,n.scrollHideDelay]),o.jsx(re,{present:r||a,children:o.jsx(Je,{"data-state":a?"visible":"hidden",...s,ref:t})})}),Br=m.forwardRef((e,t)=>{const{forceMount:r,...s}=e,n=E(P,e.__scopeScrollArea),a=e.orientation==="horizontal",c=oe(()=>i("SCROLL_END"),100),[l,i]=Fr("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return m.useEffect(()=>{if(l==="idle"){const d=window.setTimeout(()=>i("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(d)}},[l,n.scrollHideDelay,i]),m.useEffect(()=>{const d=n.viewport,u=a?"scrollLeft":"scrollTop";if(d){let p=d[u];const f=()=>{const h=d[u];p!==h&&(i("SCROLL"),c()),p=h};return d.addEventListener("scroll",f),()=>d.removeEventListener("scroll",f)}},[n.viewport,a,i,c]),o.jsx(re,{present:r||l!=="hidden",children:o.jsx(we,{"data-state":l==="hidden"?"hidden":"visible",...s,ref:t,onPointerEnter:F(e.onPointerEnter,()=>i("POINTER_ENTER")),onPointerLeave:F(e.onPointerLeave,()=>i("POINTER_LEAVE"))})})}),Je=m.forwardRef((e,t)=>{const r=E(P,e.__scopeScrollArea),{forceMount:s,...n}=e,[a,c]=m.useState(!1),l=e.orientation==="horizontal",i=oe(()=>{if(r.viewport){const d=r.viewport.offsetWidth<r.viewport.scrollWidth,u=r.viewport.offsetHeight<r.viewport.scrollHeight;c(l?d:u)}},10);return H(r.viewport,i),H(r.content,i),o.jsx(re,{present:s||a,children:o.jsx(we,{"data-state":a?"visible":"hidden",...n,ref:t})})}),we=m.forwardRef((e,t)=>{const{orientation:r="vertical",...s}=e,n=E(P,e.__scopeScrollArea),a=m.useRef(null),c=m.useRef(0),[l,i]=m.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=nt(l.viewport,l.content),u={...s,sizes:l,onSizesChange:i,hasThumb:d>0&&d<1,onThumbChange:f=>a.current=f,onThumbPointerUp:()=>c.current=0,onThumbPointerDown:f=>c.current=f};function p(f,h){return Xr(f,c.current,l,h)}return r==="horizontal"?o.jsx(Hr,{...u,ref:t,onThumbPositionChange:()=>{if(n.viewport&&a.current){const f=n.viewport.scrollLeft,h=De(f,l,n.dir);a.current.style.transform=`translate3d(${h}px, 0, 0)`}},onWheelScroll:f=>{n.viewport&&(n.viewport.scrollLeft=f)},onDragScroll:f=>{n.viewport&&(n.viewport.scrollLeft=p(f,n.dir))}}):r==="vertical"?o.jsx(Wr,{...u,ref:t,onThumbPositionChange:()=>{if(n.viewport&&a.current){const f=n.viewport.scrollTop,h=De(f,l);a.current.style.transform=`translate3d(0, ${h}px, 0)`}},onWheelScroll:f=>{n.viewport&&(n.viewport.scrollTop=f)},onDragScroll:f=>{n.viewport&&(n.viewport.scrollTop=p(f))}}):null}),Hr=m.forwardRef((e,t)=>{const{sizes:r,onSizesChange:s,...n}=e,a=E(P,e.__scopeScrollArea),[c,l]=m.useState(),i=m.useRef(null),d=z(t,i,a.onScrollbarXChange);return m.useEffect(()=>{i.current&&l(getComputedStyle(i.current))},[i]),o.jsx(et,{"data-orientation":"horizontal",...n,ref:d,sizes:r,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":se(r)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.x),onDragScroll:u=>e.onDragScroll(u.x),onWheelScroll:(u,p)=>{if(a.viewport){const f=a.viewport.scrollLeft+u.deltaX;e.onWheelScroll(f),ot(f,p)&&u.preventDefault()}},onResize:()=>{i.current&&a.viewport&&c&&s({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:i.current.clientWidth,paddingStart:te(c.paddingLeft),paddingEnd:te(c.paddingRight)}})}})}),Wr=m.forwardRef((e,t)=>{const{sizes:r,onSizesChange:s,...n}=e,a=E(P,e.__scopeScrollArea),[c,l]=m.useState(),i=m.useRef(null),d=z(t,i,a.onScrollbarYChange);return m.useEffect(()=>{i.current&&l(getComputedStyle(i.current))},[i]),o.jsx(et,{"data-orientation":"vertical",...n,ref:d,sizes:r,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":se(r)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.y),onDragScroll:u=>e.onDragScroll(u.y),onWheelScroll:(u,p)=>{if(a.viewport){const f=a.viewport.scrollTop+u.deltaY;e.onWheelScroll(f),ot(f,p)&&u.preventDefault()}},onResize:()=>{i.current&&a.viewport&&c&&s({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:i.current.clientHeight,paddingStart:te(c.paddingTop),paddingEnd:te(c.paddingBottom)}})}})}),[zr,Ze]=qe(P),et=m.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:s,hasThumb:n,onThumbChange:a,onThumbPointerUp:c,onThumbPointerDown:l,onThumbPositionChange:i,onDragScroll:d,onWheelScroll:u,onResize:p,...f}=e,h=E(P,r),[g,x]=m.useState(null),y=z(t,j=>x(j)),b=m.useRef(null),w=m.useRef(""),S=h.viewport,C=s.content-s.viewport,N=L(u),k=L(i),_=oe(p,10);function O(j){if(b.current){const A=j.clientX-b.current.left,R=j.clientY-b.current.top;d({x:A,y:R})}}return m.useEffect(()=>{const j=A=>{const R=A.target;g?.contains(R)&&N(A,C)};return document.addEventListener("wheel",j,{passive:!1}),()=>document.removeEventListener("wheel",j,{passive:!1})},[S,g,C,N]),m.useEffect(k,[s,k]),H(g,_),H(h.content,_),o.jsx(zr,{scope:r,scrollbar:g,hasThumb:n,onThumbChange:L(a),onThumbPointerUp:L(c),onThumbPositionChange:k,onThumbPointerDown:L(l),children:o.jsx(J.div,{...f,ref:y,style:{position:"absolute",...f.style},onPointerDown:F(e.onPointerDown,j=>{j.button===0&&(j.target.setPointerCapture(j.pointerId),b.current=g.getBoundingClientRect(),w.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",h.viewport&&(h.viewport.style.scrollBehavior="auto"),O(j))}),onPointerMove:F(e.onPointerMove,O),onPointerUp:F(e.onPointerUp,j=>{const A=j.target;A.hasPointerCapture(j.pointerId)&&A.releasePointerCapture(j.pointerId),document.body.style.webkitUserSelect=w.current,h.viewport&&(h.viewport.style.scrollBehavior=""),b.current=null})})})}),ee="ScrollAreaThumb",tt=m.forwardRef((e,t)=>{const{forceMount:r,...s}=e,n=Ze(ee,e.__scopeScrollArea);return o.jsx(re,{present:r||n.hasThumb,children:o.jsx(Yr,{ref:t,...s})})}),Yr=m.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:s,...n}=e,a=E(ee,r),c=Ze(ee,r),{onThumbPositionChange:l}=c,i=z(t,p=>c.onThumbChange(p)),d=m.useRef(void 0),u=oe(()=>{d.current&&(d.current(),d.current=void 0)},100);return m.useEffect(()=>{const p=a.viewport;if(p){const f=()=>{if(u(),!d.current){const h=qr(p,l);d.current=h,l()}};return l(),p.addEventListener("scroll",f),()=>p.removeEventListener("scroll",f)}},[a.viewport,u,l]),o.jsx(J.div,{"data-state":c.hasThumb?"visible":"hidden",...n,ref:i,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:F(e.onPointerDownCapture,p=>{const h=p.target.getBoundingClientRect(),g=p.clientX-h.left,x=p.clientY-h.top;c.onThumbPointerDown({x:g,y:x})}),onPointerUp:F(e.onPointerUp,c.onThumbPointerUp)})});tt.displayName=ee;var ve="ScrollAreaCorner",rt=m.forwardRef((e,t)=>{const r=E(ve,e.__scopeScrollArea),s=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&s?o.jsx(Vr,{...e,ref:t}):null});rt.displayName=ve;var Vr=m.forwardRef((e,t)=>{const{__scopeScrollArea:r,...s}=e,n=E(ve,r),[a,c]=m.useState(0),[l,i]=m.useState(0),d=!!(a&&l);return H(n.scrollbarX,()=>{const u=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(u),i(u)}),H(n.scrollbarY,()=>{const u=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(u),c(u)}),d?o.jsx(J.div,{...s,ref:t,style:{width:a,height:l,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function te(e){return e?parseInt(e,10):0}function nt(e,t){const r=e/t;return isNaN(r)?0:r}function se(e){const t=nt(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,s=(e.scrollbar.size-r)*t;return Math.max(s,18)}function Xr(e,t,r,s="ltr"){const n=se(r),a=n/2,c=t||a,l=n-c,i=r.scrollbar.paddingStart+c,d=r.scrollbar.size-r.scrollbar.paddingEnd-l,u=r.content-r.viewport,p=s==="ltr"?[0,u]:[u*-1,0];return st([i,d],p)(e)}function De(e,t,r="ltr"){const s=se(t),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=t.scrollbar.size-n,c=t.content-t.viewport,l=a-s,i=r==="ltr"?[0,c]:[c*-1,0],d=Lr(e,i);return st([0,c],[0,l])(d)}function st(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const s=(t[1]-t[0])/(e[1]-e[0]);return t[0]+s*(r-e[0])}}function ot(e,t){return e>0&&e<t}var qr=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},s=0;return(function n(){const a={left:e.scrollLeft,top:e.scrollTop},c=r.left!==a.left,l=r.top!==a.top;(c||l)&&t(),r=a,s=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(s)};function oe(e,t){const r=L(e),s=m.useRef(0);return m.useEffect(()=>()=>window.clearTimeout(s.current),[]),m.useCallback(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(r,t)},[r,t])}function H(e,t){const r=L(t);Et(()=>{let s=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(r)});return n.observe(e),()=>{window.cancelAnimationFrame(s),n.unobserve(e)}}},[e,r])}var at=Ge,Gr=Ke,Qr=rt;const Kr=m.forwardRef(({className:e,children:t,...r},s)=>o.jsxs(at,{ref:s,className:ge("relative overflow-hidden",e),...r,children:[o.jsx(Gr,{className:"h-full w-full rounded-[inherit]",children:t}),o.jsx(lt,{}),o.jsx(Qr,{})]}));Kr.displayName=at.displayName;const lt=m.forwardRef(({className:e,orientation:t="vertical",...r},s)=>o.jsx(ye,{ref:s,orientation:t,className:ge("flex touch-none select-none transition-colors data-[orientation=vertical]:h-full data-[orientation=vertical]:w-2 data-[orientation=horizontal]:h-2 data-[orientation=horizontal]:w-full",e),...r,children:o.jsx(tt,{className:"relative flex-1 rounded-full bg-border"})}));lt.displayName=ye.displayName;export{B as C,ar as M,Kr as S,Jt as T,xn as a,gn as b,un as c,cn as d,dn as e,fn as f,Te as g,G as h,Q as i,pn as j,hr as k,Ve as l,tr as m,mn as n,ln as o,bn as p,nr as q,hn as r,Ue as s,me as t,yn as u,wn as v};
