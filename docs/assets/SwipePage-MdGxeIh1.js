import{c as ae,b as Ht,r as a,g as Fn,f as En,t as Dn,d as Kt,q as ot,e as $n,j as e,B as Ln,h as Gt,i as Dt,k as Pn,F as $t,l as Un,S as Bn,s as Lt}from"./index-DwnuloBv.js";import{T as Yn}from"./TopBar-Cwkp26YK.js";import{u as Vt}from"./useMutation-DKHT9dyE.js";import{u as qn}from"./dialog-CKUJMV_w.js";import{C as On}from"./circle-alert-BYMzNc5s.js";import{I as zn,T as Pt}from"./thumbs-up-BWQVippD.js";import{S as it}from"./sparkles-CXyAxzu3.js";import{C as lt}from"./circle-check-oJx-Nhz9.js";import{S as Wn}from"./star-kR1agmaq.js";import"./index-DNaqzluz.js";import"./users-DG0f3SAW.js";import"./format-DWLSBLoY.js";const Xn=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]],Hn=ae("image-off",Xn);const Kn=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Gn=ae("link-2",Kn);const Vn=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Qn=ae("rotate-cw",Vn);const Zn=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Qt=ae("share-2",Zn);const Jn=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],er=ae("skip-forward",Jn);const tr=[["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}],["path",{d:"M17 14V2",key:"8ymqnk"}]],Ut=ae("thumbs-down",tr),Ie=(n,i,l)=>Math.min(l,Math.max(i,n)),I=n=>{if(!n)return null;const i=n.trim();return!i||i.toUpperCase()==="N/A"?null:i},nr=n=>{if(!n||n<=0)return null;const i=Math.floor(n/60),l=n%60;return i===0?`${l}m`:l===0?`${i}h`:`${i}h ${l}m`},rr=n=>{const i=I(n);if(!i)return null;const l=i.toLowerCase();return l==="united states"||l==="united states of america"?"US":l==="united kingdom"||l==="great britain"?"UK":l==="canada"?"CA":l==="australia"?"AU":l==="germany"?"DE":l==="france"?"FR":l==="spain"?"ES":l==="italy"?"IT":l==="japan"?"JP":l==="south korea"||l==="republic of korea"?"KR":i.length<=3?i.toUpperCase():i},D=n=>{if(n==null)return null;if(typeof n=="number")return Number.isNaN(n)?null:n;const i=parseFloat(n);return Number.isNaN(i)?null:i},Ae=n=>{const i=D(n);return i==null?null:Math.round(i).toLocaleString()},sr=n=>{switch(n){case"from-friends":return"Friends’ picks";case"trending":return"Trending now";default:return"Matched for you"}},at=n=>{if(!n)return;const i=[];n.year&&i.push(String(n.year));const l=[];typeof n.imdbRating=="number"&&!Number.isNaN(n.imdbRating)&&l.push(`IMDb ${n.imdbRating.toFixed(1)}`),typeof n.rtTomatoMeter=="number"&&!Number.isNaN(n.rtTomatoMeter)&&l.push(`${n.rtTomatoMeter}% Rotten Tomatoes`);const f=[...i,...l].filter(Boolean).join(" · ");return f?`${n.title} (${f})`:n.title};function ir(n){return"combined"}function ar(n){return n?n==="for_you"?"for-you":n==="friends"?"from-friends":n==="trending"?"trending":n==="explore"?"explore":n==="combined"?"combined":null:null}function Bt(n){return n==="like"?"like":n==="dislike"?"dislike":"skip"}function Fe(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():$n()}function or(n,i){const l=Dn(n.tmdbPosterPath??n.tmdbBackdropPath,i??"w342"),f=n.posterUrl??l??null,w=(n.title??"").trim()||"Untitled";return{...n,posterUrl:f,title:w}}function lr(n,i){if(typeof window>"u"||i<=0||navigator.connection?.saveData)return;const w=window.requestIdleCallback??(C=>window.setTimeout(C,300)),M=n.slice(0,i);w(()=>{for(const C of M){if(!C.posterUrl)continue;const $=new Image;$.decoding="async",$.loading="lazy",$.src=C.posterUrl}})}function cr(n,i){const l=i?.limit,f=i?.prefetchImages??6,w=i?.tmdbPosterSize??"w342",M=i?.dwellThresholdMs??1200,C=i?.dwellDebounceMs??8e3,$=i?.invalidateHomeQueries??!1,U=Ht(),R=a.useMemo(()=>Fn(),[]),W=a.useMemo(()=>ir(),[n]),h=a.useRef(new Set),p=a.useRef(!1),y=a.useRef(new Set),Y=a.useRef(new Map),[b,r]=a.useState({status:"idle",cards:[],errorMessage:null}),[N,q]=a.useState(null),S=a.useCallback(d=>{r(m=>typeof d=="function"?d(m):d)},[]),be=a.useCallback(d=>{if(!d.length)return;const m=h.current,k=[];for(const j of d)m.has(j.id)||(m.add(j.id),k.push(or(j,w)));k.length&&S(j=>{const F={...j,status:"ready",cards:[...j.cards,...k],errorMessage:null};return lr(k,f),F})},[f,S,w]),O=a.useCallback(async(d=l)=>{if(!p.current){p.current=!0,S(m=>({...m,status:m.cards.length?"ready":"loading",errorMessage:null}));try{const m=await En({sessionId:R,mode:W,limit:d,seed:i?.seed??null},{timeoutMs:25e3}),k=m.deckId,j=(m.cards??[]).map((F,X)=>({...F,id:F.mediaItemId,deckId:k,position:X,source:ar(F.source??null)}));if(!j.length){S(F=>({...F,status:F.cards.length?"ready":"exhausted",errorMessage:null}));return}be(j)}catch(m){const k=m instanceof Error?m.message:typeof m=="string"?m:"We couldn't load swipe cards.";S(j=>({...j,status:"error",errorMessage:k}))}finally{p.current=!1}}},[be,l,W,i?.seed,R,S]);a.useEffect(()=>{h.current=new Set,y.current=new Set,Y.current=new Map,p.current=!1,S({status:"loading",cards:[],errorMessage:null}),O(l)},[O,n,l,S]);const ge=a.useCallback(()=>{h.current=new Set,y.current=new Set,Y.current=new Map,p.current=!1,S({status:"loading",cards:[],errorMessage:null}),O(l)},[O,l,S]),we=a.useCallback(d=>{d<=0||S(m=>({...m,cards:m.cards.slice(Math.min(d,m.cards.length))}))},[S]),A=Vt({mutationFn:async d=>Kt(d,{timeoutMs:2e4}),onError:(d,m)=>{const k=d instanceof Error?d.message:typeof d=="string"?d:"We couldn't save that action.";q({payload:m,message:k})},onSuccess:()=>{q(null),$&&(U.invalidateQueries({queryKey:ot.homeFeed(null)}),U.invalidateQueries({queryKey:ot.homeForYou(null)}))}}),De=a.useCallback((d,m)=>{if(!d)return;const k=`${d.deckId}:${d.id}`;y.current.has(k)||(y.current.add(k),A.mutate({sessionId:R,deckId:d.deckId,position:m??d.position,mediaItemId:d.id,eventType:"impression",source:d.source??null,clientEventId:Fe()}))},[A,R]),ye=a.useCallback((d,m,k)=>{if(!d||!Number.isFinite(m)||m<M)return;const j=`${d.deckId}:${d.id}`,F=Date.now(),X=Y.current.get(j)??0;F-X<C||(Y.current.set(j,F),A.mutate({sessionId:R,deckId:d.deckId,position:k??d.position,mediaItemId:d.id,eventType:"dwell",dwellMs:Math.round(m),source:d.source??null,clientEventId:Fe()}))},[C,M,A,R]),ve=a.useCallback(d=>{const m=d.card;A.mutate({sessionId:R,deckId:m.deckId,position:m.position,mediaItemId:m.id,eventType:Bt(d.direction),source:m.source??null,clientEventId:Fe()})},[A,R]),je=a.useCallback(async d=>{const m=d.card;return A.mutateAsync({sessionId:R,deckId:m.deckId,position:m.position,mediaItemId:m.id,eventType:Bt(d.direction),source:m.source??null,clientEventId:Fe()})},[A,R]);return{sessionId:R,mode:W,cards:b.cards,status:b.status,isLoading:b.status==="loading",isError:b.status==="error",isExhausted:b.status==="exhausted",deckError:b.errorMessage??null,fetchMore:O,refresh:ge,trimConsumed:we,trackImpression:De,trackDwell:ye,swipe:ve,swipeAsync:je,swipeSyncError:N?.message??null,retryFailedSwipe:()=>{N&&A.mutate(N.payload)},isRetryingSwipe:A.isPending&&!!N}}const dr=({message:n,onRetry:i,isRetrying:l})=>n?e.jsx("div",{className:"mx-3 mb-3 rounded-md border border-amber-500/60 bg-amber-500/10 px-3 py-2 text-xs text-amber-50",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(On,{className:"mt-0.5 h-3.5 w-3.5 flex-shrink-0","aria-hidden":!0}),e.jsxs("div",{className:"flex flex-1 flex-col gap-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"leading-snug",children:n}),e.jsxs(Ln,{type:"button",variant:"outline",size:"sm",onClick:i,disabled:l,children:[e.jsx(Qn,{className:"h-3.5 w-3.5","aria-hidden":!0}),l?"Retrying…":"Retry"]})]})]})}):null,ur=({card:n,metaLine:i,highlightLabel:l})=>e.jsxs("div",{className:"space-y-2 text-left leading-relaxed","aria-label":"Swipe card summary",children:[e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"min-w-0 space-y-1",children:[e.jsx("h2",{className:"line-clamp-2 text-2xl font-heading font-semibold text-foreground",children:n.title}),i&&e.jsx("p",{className:"truncate text-xs text-muted-foreground/90",children:i}),l&&e.jsx("p",{className:"text-xs font-medium text-primary/90",children:l})]})}),n.tagline&&!n.tagline.trim().startsWith("Plot")&&e.jsx("p",{className:"line-clamp-2 text-xs text-muted-foreground/90",children:n.tagline})]}),Yt=({title:n})=>e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-background via-card to-background text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-card/70 shadow-md",children:e.jsx(Hn,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("span",{className:"text-[12px] font-semibold",children:"Artwork unavailable"}),n&&e.jsxs("span",{className:"max-w-[240px] truncate text-xs text-muted-foreground/80",children:["for ",n]})]})}),Ee="mn_swipe_onboarding_seen",qt=88,Ot=.32,zt=220,mr=16,fr=360,Wt=14,Xt=32,xr=n=>{if(n==null)return null;const i=String(n).trim();if(!i)return null;const l=i.replace(/%/g,""),f=Number(l);return Number.isFinite(f)?f:null},pr=n=>{if(n==null)return null;const i=typeof n=="number"?n:Number(String(n).trim());if(!Number.isFinite(i))return null;const l=Math.round(i/2);return l<=0?null:Math.min(5,Math.max(1,l))},hr=n=>{if(n==null)return null;const i=Math.round(n);return i<=0?null:Math.min(10,Math.max(2,i*2))},br=n=>{const i=n?.source==="for-you"||n?.source==="from-friends"||n?.source==="trending"?n.source:void 0,l=n?.kind==="series"?"series":"movie",f=typeof n?.releaseYear=="number"?n.releaseYear:n?.releaseYear!=null?Number(n.releaseYear):null,w=typeof n?.runtimeMinutes=="number"?n.runtimeMinutes:n?.runtimeMinutes!=null?Number(n.runtimeMinutes):null;return{id:String(n?.id??""),title:String(n?.title??"Untitled"),year:Number.isFinite(f)?f:null,type:l,runtimeMinutes:Number.isFinite(w)?w:null,posterUrl:n?.posterUrl??null,tmdbPosterPath:n?.tmdbPosterPath??null,tmdbBackdropPath:n?.tmdbBackdropPath??null,source:i,why:n?.why??null,overview:n?.overview??null}},J="want_to_watch",ee="watched",Pr=()=>{const{cards:n,sessionId:i,isLoading:l,isError:f,swipe:w,fetchMore:M,trimConsumed:C,swipeSyncError:$,retryFailedSwipe:U,isRetryingSwipe:R,trackImpression:W,trackDwell:h}=cr("combined",{limit:72}),p=a.useMemo(()=>n.map(br),[n]),[y,Y]=a.useState(0),b=n[y];n[y+1];const r=p[y],N=p[y+1],[q,S]=a.useState(!1),[be,O]=a.useState(()=>typeof window>"u"?!1:!localStorage.getItem(Ee)),[ge,we]=a.useState(!1),[A,De]=a.useState([]),ye=(t,s)=>{t&&De(o=>{const c=o.includes(t);return s?c?o:[...o,t]:c?o.filter(x=>x!==t):o})},ve=t=>ye(r?.id,t),je=t=>ye(N?.id,t),d=!!r?.id&&A.includes(r.id),m=!!N?.id&&A.includes(N.id),[k,j]=a.useState(null),[F,X]=a.useState(0),[B,ct]=a.useState(!1),[Ne,$e]=a.useState(!1),[ke,Le]=a.useState(!1),[oe,dt]=a.useState(null),[Zt,Pe]=a.useState(!1),H=a.useRef(null),[ut,mt]=a.useState(null),le=a.useRef(null),[kr,Jt]=a.useState(0),[en,ft]=a.useState(0),Ue=a.useRef(null),xt=a.useRef(!1),[_r,tn]=a.useState(!1),[nn,pt]=a.useState(!1),L=r?.id??null,{user:te}=Gt(),rn=Ht(),ht=["mediaFeedback",{userId:te?.id??null,mediaItemId:L}],{data:Be}=Dt({queryKey:ht,enabled:!!(te?.id&&L),staleTime:1e3*30,gcTime:1e3*60*10,refetchOnWindowFocus:!1,queryFn:async()=>{if(!te?.id||!L)return null;const{data:t,error:s}=await Lt.from("media_feedback").select("in_watchlist, rating_0_10, last_action").eq("user_id",te.id).eq("media_item_id",L).maybeSingle();if(s)throw s;return t??null}}),bt=Be?.in_watchlist?J:Be?.last_action==="like"?ee:null,sn=pr(Be?.rating_0_10),[an,Ye]=a.useState(null),[gt,qe]=a.useState(null),Oe={status:an??bt,rating:gt??sn},ce=Vt({mutationFn:async t=>{if(!te?.id||!b)return;const s={sessionId:i,deckId:b.deckId??null,position:b.position??null,mediaItemId:b.id,source:b.source??null,payload:{ui:"SwipePage",action:t.status?"status":t.ratingStars!=null?"rating":"feedback"}},o=[];if(t.status!==void 0&&(t.status===ee?o.push({...s,eventType:"like"}):o.push({...s,eventType:"watchlist",inWatchlist:t.status===J})),t.ratingStars!==void 0&&o.push({...s,eventType:"rating",rating0_10:hr(t.ratingStars)}),!!o.length)for(const c of o)await Kt(c)},onSuccess:()=>{rn.invalidateQueries({queryKey:ht})}}),P=a.useRef(null),de=a.useRef(!1),ue=a.useRef(null),_e=a.useRef({x:0,y:0}),wt=()=>{if(typeof window>"u")return null;if(ue.current)return ue.current;const t=window.AudioContext||window.webkitAudioContext;if(!t)return null;const s=new t;return ue.current=s,s},ze=t=>{typeof navigator>"u"||typeof navigator.vibrate!="function"||navigator.vibrate(t)},yt=(t,s)=>{const o=wt();if(!o)return;o.state==="suspended"&&o.resume().catch(()=>{});const c=o.createOscillator(),x=o.createGain();let v=440,_=440;t==="like"?(v=420,_=660):t==="dislike"?(v=280,_=190):(v=360,_=320);const E=o.currentTime,g=.08+s*.07;c.type="triangle",c.frequency.setValueAtTime(v,E),c.frequency.linearRampToValueAtTime(_,E+g);const T=.18+s*.18;x.gain.setValueAtTime(T,E),x.gain.exponentialRampToValueAtTime(.001,E+g),c.connect(x),x.connect(o.destination),c.start(E),c.stop(E+g+.02)},{data:u}=Dt({queryKey:ot.titleDetail(L),enabled:!!(L&&B),staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>{if(!L)return null;const{data:t,error:s}=await Lt.from("media_items").select("id, kind, omdb_plot, tmdb_overview, omdb_director, omdb_writer, omdb_actors, omdb_genre, omdb_language, tmdb_original_language, omdb_country, omdb_imdb_rating, omdb_imdb_votes, omdb_metascore, omdb_rating_rotten_tomatoes, omdb_poster, tmdb_poster_path, tmdb_backdrop_path, omdb_awards, omdb_box_office, omdb_released, tmdb_vote_average, tmdb_vote_count, tmdb_popularity, omdb_rated, omdb_runtime").eq("id",L).maybeSingle();if(s)throw s;if(!t)return null;const o=t.omdb_genre!=null?String(t.omdb_genre).split(",").map(x=>x.trim()).filter(Boolean):null,c=xr(t.omdb_rating_rotten_tomatoes);return{title_id:t.id,content_type:t.kind??null,plot:t.omdb_plot??null,tmdb_overview:t.tmdb_overview??null,tagline:null,omdb_director:t.omdb_director??null,omdb_writer:t.omdb_writer??null,omdb_actors:t.omdb_actors??null,genres:o,tmdb_genre_names:null,language:null,omdb_language:t.omdb_language??null,tmdb_original_language:t.tmdb_original_language??null,country:null,omdb_country:t.omdb_country??null,imdb_rating:t.omdb_imdb_rating??null,imdb_votes:t.omdb_imdb_votes??null,metascore:t.omdb_metascore??null,rt_tomato_pct:c,poster_url:t.omdb_poster??null,tmdb_poster_path:t.tmdb_poster_path??null,backdrop_url:t.tmdb_backdrop_path??null,omdb_awards:t.omdb_awards??null,omdb_box_office_str:t.omdb_box_office??null,omdb_box_office:null,omdb_released:t.omdb_released??null,tmdb_vote_average:t.tmdb_vote_average??null,tmdb_vote_count:t.tmdb_vote_count??null,tmdb_popularity:t.tmdb_popularity??null,tmdb_episode_run_time:null,omdb_rated:t.omdb_rated??null}}}),vt=I(u?.plot)??I(u?.tmdb_overview)??I(r?.overview)??null,z=u?.tmdb_genre_names??u?.genres??r?.genres??null,on=u?.language??u?.omdb_language??u?.tmdb_original_language??r?.language??null;I(on);const ln=u?.country??u?.omdb_country??r?.country??null,cn=I(ln),jt=rr(cn),We=I(u?.omdb_director),Xe=I(u?.omdb_writer),ne=I(u?.omdb_actors),He=u?.imdb_rating??r?.imdbRating??null;u?.rt_tomato_pct??r?.rtTomatoMeter;const Se=u?.metascore??null,Me=u?.imdb_votes??null,Ce=u?.tmdb_vote_average??null,Re=u?.tmdb_vote_count??null,Te=u?.tmdb_popularity??null,Ke=I(u?.omdb_awards),Ge=I(u?.omdb_box_office_str),Ve=I(u?.omdb_released),Qe=u?.content_type==="movie"||u?.content_type==="series"?u.content_type:r?.type??null,Nt=r,dn=Nt?.certification??Nt?.rated??u?.omdb_rated??null,kt=I(dn),_t=(Array.isArray(z)?z:z?String(z).split(",").map(t=>t.trim()):[])??[],Ze=_t.length>3?_t.slice(3).filter(Boolean):[],un=[u?.language??null,u?.omdb_language??null,u?.tmdb_original_language??null,r?.language??null],Je=Array.from(new Set(un.map(t=>I(t)).filter(t=>!!t)));let me=null;Array.isArray(u?.tmdb_episode_run_time)?u.tmdb_episode_run_time.length>0&&(me=D(u.tmdb_episode_run_time[0])??null):u?.tmdb_episode_run_time!=null&&(me=D(u.tmdb_episode_run_time));const St=()=>te?!0:(alert("Sign in to save this title, rate it, or add it to your watchlist."),!1),Mt=t=>{if(!(!L||!b||!St()||ce.isPending)){if(t===J){const s=Oe.status===J?null:J;Ye(s),ce.mutate({status:s});return}t===ee&&(Ye(ee),ce.mutate({status:ee}))}},mn=t=>{!L||!b||!St()||ce.isPending||(qe(t),ce.mutate({ratingStars:t}))},Ct=t=>Oe?.status===t,Rt=Oe?.rating??null,et=gt??Rt;a.useEffect(()=>{qe(null),Ye(null)},[L,Rt,bt]);const fn=t=>{const s=et===t?null:t;qe(s),mn(s)},Tt=()=>typeof window<"u"?`${window.location.origin}/title/${r?.id??""}`:`/title/${r?.id??""}`,xn=Tt(),pn=async t=>{if(!r||!b)return;const s=Tt(),o=`Check this out: ${r.title}`,c=t??o;try{navigator.share?await navigator.share({title:r.title,text:c,url:s}):navigator.clipboard?.writeText?(await navigator.clipboard.writeText(`${c}

${s}`),alert("Link copied to clipboard")):alert(`${c}

${s}`)}catch{}},hn=!!(r?.posterUrl&&!d),bn=!!(N?.posterUrl&&!m),re=a.useRef(null),se=a.useRef(null),K=a.useRef(0),fe=a.useRef(),V=a.useRef(null),Q=a.useRef(null),G=a.useRef(0),tt=a.useRef(null),nt=a.useRef(null),xe=a.useRef(null);a.useEffect(()=>{if(typeof window>"u")return;const t=localStorage.getItem(Ee);O(!t)},[]),a.useEffect(()=>{ve(!1),Le(!1),ct(!1),$e(!1),tn(!1)},[r?.id]),a.useEffect(()=>{je(!1)},[N?.id]),a.useEffect(()=>{if(!b)return;const t=performance.now();if(xe.current&&nt.current&&nt.current!==b.id){const s=tt.current;if(s!=null){const o=Math.max(0,Math.round(t-s));h(xe.current,o)}}W(b),xe.current=b,nt.current=b.id,tt.current=t},[b?.id,h,W]),a.useEffect(()=>()=>{if(!xe.current)return;const t=tt.current;if(t==null)return;const s=Math.max(0,Math.round(performance.now()-t));h(xe.current,s)},[]),a.useEffect(()=>{if(typeof window>"u")return;(window.requestIdleCallback??(s=>window.setTimeout(s,180)))(()=>{const s=p.slice(y+1,y+4);for(const o of s){if(!o?.posterUrl)continue;const c=new Image;c.loading="lazy",c.decoding="async",c.src=o.posterUrl}})},[p,y]),a.useEffect(()=>()=>{fe.current&&cancelAnimationFrame(fe.current),P.current!=null&&window.clearTimeout(P.current),H.current!=null&&window.clearTimeout(H.current),le.current!=null&&window.clearTimeout(le.current),ue.current&&ue.current.close().catch(()=>{})},[]),a.useEffect(()=>{if(!N)return;we(!1);const t=window.setTimeout(()=>we(!0),16);return()=>window.clearTimeout(t)},[N?.id]),a.useEffect(()=>{const t=p.length-y;t<3&&M(Math.max(24,t+12))},[p.length,y,M]),a.useEffect(()=>{if(y<=10)return;const t=Math.min(Math.max(y-6,0),p.length);t>0&&(C(t),Y(s=>Math.max(4,s-t)))},[p.length,y,C]);const pe=(t,s=!1)=>{const o=re.current;if(!o)return;const c=Ie(t,-zt,zt),x=Ie(c/Wt,-12,12),v=Ie(c/26,-10,10),_=1.02,E=Math.min(Math.abs(c)/900,.04),g=_+E,T=_e.current,ie=T.y*-4,In=T.x*5,An=T.y*-4;o.style.transition=s?"transform 260ms cubic-bezier(0.22,0.61,0.36,1)":"none",o.style.transform=`
      perspective(1400px)
      translateX(${c}px)
      translateY(${An}px)
      rotateX(${ie}deg)
      rotateY(${v+In}deg)
      rotateZ(${x}deg)
      scale(${g})
    `,K.current=c},rt=()=>{_e.current={x:0,y:0},pe(0,!0),K.current=0,se.current=null,V.current=null,Q.current=null,G.current=0,j(null),X(0)},gn=(t,s)=>{dt({card:t,direction:s}),Pe(!0),H.current!=null&&window.clearTimeout(H.current),H.current=window.setTimeout(()=>Pe(!1),2800)},wn=()=>{Pe(!1),dt(null),H.current!=null&&(window.clearTimeout(H.current),H.current=null)},yn=()=>{oe&&(Y(t=>{const s=t-1;if(s<0)return t;const o=p[s];return o&&o.id===oe.card.id?s:t}),wn())},It=t=>{mt(t),le.current!=null&&window.clearTimeout(le.current),t&&(le.current=window.setTimeout(()=>mt(null),3200))},vn=(t,s)=>{const o=t.runtimeMinutes??0,c=z??t.genres??[],x=Qe==="series"||t.type==="series",v=c.map(_=>_.toLowerCase());return s==="like"?v.some(_=>_.includes("horror")||_.includes("thriller"))?"We’ll show more intense picks like this.":v.some(_=>_.includes("comedy"))?"We’ll show more light and funny picks like this.":x?"Nice — we’ll bring in more series that match this vibe.":He!=null&&D(He)!=null&&D(He)>=7.5?"Nice pick — we’ll show more highly rated titles like this.":t.friendLikesCount&&t.friendLikesCount>=3?"Your friends are into this — we’ll pull in more friend-favorites.":"Got it — we’ll keep tuning around this kind of title.":s==="dislike"?x?"Looks like this series isn’t your thing — we’ll dial down similar shows.":o>130&&en+1>=3?"You’ve skipped a few long movies — we’ll lean toward shorter runtimes.":o>130?"Noted — we’ll be more careful with super long movies.":"Okay, we’ll dial down similar titles in your feed.":s==="skip"?"We’ll move this out of your way and keep the feed feeling fresh.":null},Z=(t,s=0)=>{if(!r||!b)return;if(O(!1),typeof window<"u"&&localStorage.setItem(Ee,"1"),gn(r,t),w({card:b,direction:t}),j(null),X(0),t==="dislike"&&(r.runtimeMinutes??0)>130?ft(g=>g+1):ft(0),Jt(g=>{const T=g+1,ie=vn(r,t);return ie&&T>=4&&T%4===0?It(ie):It(null),T}),t==="skip"){const g=re.current;g&&(g.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",g.style.transform="perspective(1400px) translateX(0px) translateY(4px) scale(1.03) rotateZ(-1deg)",window.setTimeout(()=>{g.style.transform="perspective(1400px) translateX(0px) translateY(24px) scale(0.95)"},16),g.style.opacity="0");const T=.4;ze(16+T*40),yt(t,T),window.setTimeout(()=>{Y(ie=>Math.min(ie+1,p.length)),g&&(g.style.transition="none",g.style.transform="translateX(0px) translateY(0px) scale(1)",g.style.opacity="1")},220);return}const o=t==="like"?1:-1,c=Math.max(fr,Math.abs(K.current)+Math.abs(s)*mr),x=c*o,v=re.current;if(v){const g=Ie(x/Wt,-18,18),T=o*12;v.style.transition="transform 260ms cubic-bezier(0.22,0.61,0.36,1)",v.style.transform=`
        perspective(1400px)
        translateX(${x}px)
        translateY(-4px)
        rotateZ(${g}deg)
        rotateY(${T}deg)
        scale(1.04)
      `}const _=Math.abs(c),E=Math.min(1,_/520);ze(22+E*60),yt(t,E),window.setTimeout(()=>{Y(g=>Math.min(g+1,p.length)),rt()},260)},jn=(t,s,o)=>{if(!r||!b)return;S(!0),se.current=t,K.current=0,V.current=t,Q.current=performance.now(),G.current=0,j(null),X(0),wt(),P.current!=null&&window.clearTimeout(P.current),de.current=!1,P.current=window.setTimeout(()=>{de.current=!0,S(!1),rt(),ze(20),ct(v=>!v),$e(!1)},550);const c=B&&Ue.current&&Ue.current.contains(o);xt.current=c;const x=re.current;if(x)try{x.setPointerCapture(s)}catch{}},Nn=t=>{if(!q||se.current===null)return;const s=performance.now(),o=t-se.current;P.current!=null&&Math.abs(o)>10&&!de.current&&(window.clearTimeout(P.current),P.current=null),pe(o),X(-o*.06);let c=null;if(o>Xt?c="like":o<-Xt&&(c="dislike"),j(c),V.current!==null&&Q.current!==null){const x=s-Q.current;if(x>0){const v=(t-V.current)/x;G.current=v}}V.current=t,Q.current=s,fe.current&&cancelAnimationFrame(fe.current),fe.current=window.requestAnimationFrame(()=>pe(K.current))},At=()=>{if(P.current!=null&&(window.clearTimeout(P.current),P.current=null),de.current){de.current=!1,se.current=null,V.current=null,Q.current=null,G.current=0;return}if(!q)return;S(!1);const s=K.current+G.current*180,o=B&&xt.current,c=o?qt*1.6:qt,x=o?Ot*1.4:Ot;if(Math.abs(s)>=c||Math.abs(G.current)>=x){Z(s>=0?"like":"dislike",G.current),se.current=null,V.current=null,Q.current=null,G.current=0;return}rt()},kn=sr(r?.source),he=!r||l||f;a.useEffect(()=>{const t=s=>{!r||he||q||(s.key==="ArrowLeft"?(s.preventDefault(),Z("dislike")):s.key==="ArrowRight"?(s.preventDefault(),Z("like")):(s.key==="ArrowDown"||s.key===" ")&&(s.preventDefault(),Z("skip")))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[r,he,q]);const _n=()=>{if(!p.length)return null;const s=Math.min(p.length,8),o=Math.floor(s/2);let c=Math.max(0,y-o);return c+s>p.length&&(c=Math.max(0,p.length-s)),e.jsx("div",{className:"mb-3 flex justify-center","aria-hidden":"true",children:e.jsx("div",{className:"flex items-center gap-1.5",children:Array.from({length:s}).map((x,v)=>{const _=c+v,E=_===y;return e.jsx("span",{className:`h-1.5 rounded-md transition-all ${E?"w-4 bg-primary":"w-2 bg-border/70"}`},_)})})})},Sn=()=>{if(!Zt||!oe)return null;const t=oe.direction==="like"?"Loved it":oe.direction==="dislike"?"Marked as ‘No thanks’":"Saved for ‘Not now’";return e.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-4 z-40 flex justify-center px-4 sm:px-0",children:e.jsxs("div",{className:"pointer-events-auto inline-flex items-center gap-3 rounded-md border border-border bg-background/95 px-3 py-2 text-[12px] text-foreground shadow-lg backdrop-blur",children:[e.jsx("span",{children:t}),e.jsx("button",{type:"button",onClick:yn,className:"text-xs font-semibold uppercase tracking-[0.14em] text-primary hover:text-primary/80",children:"Undo"})]})})},Mn=()=>ut?e.jsx("div",{className:"pointer-events-none absolute inset-x-0 top-2 z-30 flex justify-center px-4 sm:px-0",children:e.jsxs("div",{className:"pointer-events-auto inline-flex max-w-md items-start gap-2 rounded-md border border-border bg-background/95 px-3 py-2 text-xs text-muted-foreground shadow-lg backdrop-blur",children:[e.jsx(it,{className:"mt-0.5 h-3.5 w-3.5 text-primary"}),e.jsx("span",{children:ut})]})}):null,Ft=typeof r?.imdbRating=="number"&&!Number.isNaN(r.imdbRating)?r.imdbRating:typeof u?.imdb_rating=="number"&&!Number.isNaN(u.imdb_rating)?u.imdb_rating:D(u?.imdb_rating),Et=typeof r?.rtTomatoMeter=="number"&&!Number.isNaN(r.rtTomatoMeter)?r.rtTomatoMeter:typeof u?.rt_tomato_pct=="number"&&!Number.isNaN(u.rt_tomato_pct)?u.rt_tomato_pct:D(u?.rt_tomato_pct),st=r?(()=>{const t=[];r.year&&t.push(String(r.year));const s=(Qe??r.type)==="series"?"Series":"Movie";return t.push(s),Ft!=null&&t.push(`IMDb ${Ft.toFixed(1)}`),Et!=null&&t.push(`RT ${Et}%`),typeof r.runtimeMinutes=="number"&&r.runtimeMinutes>0&&t.push(`${r.runtimeMinutes} min`),t.join(" · ")})():"",Cn=r?r.why?r.why:r.friendLikesCount&&r.friendLikesCount>=3?"Friends love this":null:null,Rn=t=>{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||q)return;const s=re.current;if(!s)return;const o=s.getBoundingClientRect(),c=(t.clientX-o.left)/o.width,x=(t.clientY-o.top)/o.height;_e.current={x:(c-.5)*2,y:(x-.5)*2},pe(K.current)},Tn=()=>{q||(_e.current={x:0,y:0},pe(K.current,!0))};return e.jsxs("div",{className:"flex min-h-[calc(100vh-6rem)] flex-1 flex-col gap-4 pb-4",children:[e.jsx(Yn,{title:"Swipe",subtitle:"Combined For You, friends, and trending picks"}),e.jsx(dr,{message:$,onRetry:U,isRetrying:R}),e.jsxs("div",{className:"relative mt-2 flex flex-1 flex-col overflow-visible",children:[_n(),e.jsxs("div",{className:"relative flex flex-1 items-center justify-center overflow-visible [perspective:1400px]","aria-live":"polite",children:[l&&!r&&!f&&e.jsx(Pn,{}),f&&!l&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(zn,{className:"h-8 w-8 text-amber-400"}),e.jsx("p",{children:"We couldn't load your swipe deck."}),e.jsx("button",{type:"button",onClick:()=>M(32),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Retry"})]}),!l&&!f&&!r&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(it,{className:"h-8 w-8 text-primary"}),e.jsx("p",{children:"All caught up. New cards will appear soon."}),e.jsx("button",{type:"button",onClick:()=>M(36),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Refresh deck"})]}),!l&&r&&e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 mx-auto flex h-[72%] max-h-[480px] w-full max-w-md items-center justify-center rounded-2xl transition-all duration-300 ease-out",style:{transform:`${ge?"translateY(-40px) scale(0.9)":"translateY(-10px) scale(0.84)"} translateX(${F}px)`,opacity:ge?1:0},children:e.jsx("div",{className:"relative h-full w-full overflow-hidden rounded-2xl border border-border/40 shadow-lg",children:bn&&N.posterUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:N.posterUrl,alt:at(N)??N.title,className:"h-full w-full object-cover blur-[7px] brightness-[0.8]",loading:"lazy",draggable:!1,onError:()=>je(!0)}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-background/0 via-background/30 to-background/90"})]}):e.jsx(Yt,{title:N?.title})})}),e.jsxs("article",{ref:re,role:"group","aria-roledescription":"Movie card","aria-label":at(r),className:`relative z-10 mx-auto flex h-[72%] max-h-[480px] w-full max-w-md select-none flex-col overflow-hidden rounded-2xl bg-gradient-to-br from-card/95 via-background/95 to-card/90 shadow-[0_28px_80px_rgba(0,0,0,0.85)] backdrop-blur transform-gpu will-change-transform ${B?"ring-1 ring-primary/40":"border border-white/5"}`,onPointerDown:t=>{t.pointerType==="mouse"&&t.button!==0||jn(t.clientX,t.pointerId,t.target)},onPointerMove:t=>Nn(t.clientX),onPointerUp:At,onPointerCancel:At,onMouseMove:Rn,onMouseLeave:Tn,style:{touchAction:"pan-y"},children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 mix-blend-screen opacity-[0.14]"}),e.jsxs("div",{className:`relative overflow-hidden bg-gradient-to-br from-background/90 via-background/85 to-background/95 transition-all duration-300 ease-out ${B?"h-[40%]":"h-[58%]"}`,children:[hn&&r.posterUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r.posterUrl,alt:at(r)??`${r.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>ve(!0),style:{filter:B?"blur(4px) brightness(0.65)":"none",transform:B?"scale(1.12)":"scale(1)",transition:"filter 260ms cubic-bezier(0.22,0.61,0.36,1), transform 260ms cubic-bezier(0.22,0.61,1)"}}),B&&e.jsx("div",{className:"pointer-events-none absolute left-3 flex items-start",style:{top:"3.4rem"},children:e.jsx("div",{className:"overflow-hidden rounded-2xl border border-border bg-background shadow-[0_14px_40px_rgba(0,0,0,0.85)]",style:{height:"clamp(120px, 22vh, 220px)",aspectRatio:"2 / 3"},children:e.jsx("img",{src:r.posterUrl,alt:r.title,className:"h-full w-full object-cover",draggable:!1})})})]}):e.jsx(Yt,{title:r.title}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-background/95"}),k==="like"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pointer-events-none absolute inset-x-8 bottom-3 flex justify-start",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-emerald-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-emerald-200 shadow-md backdrop-blur-sm",children:[e.jsx(Pt,{className:"h-4 w-4 text-emerald-300"}),e.jsx("span",{children:"Love it"})]})}),e.jsx("div",{className:"pointer-events-none absolute inset-y-8 right-2 w-1 rounded-full bg-gradient-to-b from-emerald-400/0 via-emerald-400/40 to-emerald-400/0"})]}),k==="dislike"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pointer-events-none absolute inset-x-8 bottom-3 flex justify-end",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-rose-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-rose-200 shadow-md backdrop-blur-sm",children:[e.jsx(Ut,{className:"h-4 w-4 text-rose-300"}),e.jsx("span",{children:"No thanks"})]})}),e.jsx("div",{className:"pointer-events-none absolute inset-y-8 left-2 w-1 rounded-full bg-gradient-to-b from-rose-400/0 via-rose-400/40 to-rose-400/0"})]}),e.jsxs("div",{className:"absolute left-3 right-3 top-3 flex flex-wrap items-center justify-between gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md bg-background/80 px-2 py-1 text-xs font-semibold text-foreground shadow-md",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-sm bg-primary"}),kn]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md bg-background/70 px-2 py-1 text-xs font-medium text-muted-foreground/85 shadow-md",children:[e.jsx(it,{className:"h-3 w-3 text-primary/80"}),y+1," / ",p.length||1]})]})]}),e.jsxs("div",{className:"relative flex flex-1 flex-col bg-gradient-to-b from-background/92 via-background/96 to-background px-4 pb-4 pt-3 backdrop-blur-md",children:[!B&&e.jsxs(e.Fragment,{children:[e.jsx(ur,{card:r,metaLine:st,highlightLabel:Cn}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-start gap-2 text-xs text-muted-foreground",children:[typeof r.friendLikesCount=="number"&&r.friendLikesCount>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx($t,{className:"h-4 w-4 text-primary/80"}),r.friendLikesCount===1?"1 friend likes this":`${r.friendLikesCount} friends like this`]}),r.topFriendName&&r.topFriendReviewSnippet&&e.jsxs("button",{type:"button",onClick:()=>Le(t=>!t),className:"inline-flex flex-1 items-start gap-2 rounded-2xl bg-card/80 px-3 py-2 text-left text-foreground shadow-md hover:bg-card",children:[e.jsx(lt,{className:"mt-0.5 h-4 w-4 text-primary"}),e.jsx("div",{className:`overflow-hidden transition-all duration-200 ${ke?"max-h-32":"max-h-10"}`,children:e.jsxs("span",{className:`block text-xs ${ke?"":"line-clamp-2"}`,children:[r.topFriendName,": “",r.topFriendReviewSnippet,"”"]})})]})]})]}),B&&r&&e.jsxs("div",{ref:Ue,id:"swipe-detail-panel","aria-label":Ne?"Full details":"Details summary","aria-live":"polite",className:"mt-2 flex flex-1 flex-col text-left text-xs text-muted-foreground",children:[e.jsx("div",{className:"flex-1 overflow-hidden pr-1",children:Ne?e.jsxs("div",{className:"h-full space-y-3 text-xs leading-relaxed text-muted-foreground/90",children:[(Ze.length>0||Je.length>0||me)&&e.jsxs("section",{"aria-label":"Detailed info",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground/80",children:"Info"}),e.jsxs("div",{className:"mt-1 grid gap-1.5 rounded-2xl bg-background/60 px-3 py-2 text-[10.5px]",children:[Ze.length>0&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"More genres:"})," ",e.jsx("span",{children:Ze.join(", ")})]}),Je.length>0&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Languages:"})," ",e.jsx("span",{children:Je.join(", ")})]}),me&&Qe==="series"&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Episode runtime:"})," ",e.jsx("span",{children:nr(me)})]})]})]}),(Me||Se||Ce||Re||Te)&&e.jsxs("section",{"aria-label":"Ratings breakdown",className:"mt-1",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground/80",children:"Ratings"}),e.jsxs("div",{className:"mt-1 grid gap-1.5",children:[Me&&Ae(Me)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground/90",children:"IMDb votes"}),e.jsx("span",{className:"font-medium text-foreground/90",children:Ae(Me)})]}),Se&&D(Se)!=null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground/90",children:"Metascore"}),e.jsx("span",{className:"font-medium text-foreground/90",children:D(Se)})]}),Ce&&D(Ce)!=null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground/90",children:"TMDB score"}),e.jsx("span",{className:"font-medium text-foreground/90",children:D(Ce)?.toFixed(1)})]}),Re&&Ae(Re)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground/90",children:"TMDB votes"}),e.jsx("span",{className:"font-medium text-foreground/90",children:Ae(Re)})]}),Te&&D(Te)!=null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground/90",children:"TMDB popularity"}),e.jsx("span",{className:"font-medium text-foreground/90",children:D(Te)?.toFixed(1)})]})]})]}),ne||Xe?e.jsxs("section",{"aria-label":"Credits",className:"mt-1",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground/80",children:"Credits"}),e.jsxs("div",{className:"mt-1 space-y-1.5 text-xs",children:[Xe&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Writers:"})," ",e.jsx("span",{children:Xe})]}),ne&&(()=>{const s=ne.split(",").map(o=>o.trim()).filter(Boolean).slice(3);return s.length?e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"More cast:"})," ",e.jsx("span",{children:s.join(", ")})]}):null})()]})]}):null,(Ve||Ke||Ge)&&e.jsxs("section",{"aria-label":"Release and production",className:"mt-1",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground/80",children:"Release & production"}),e.jsxs("div",{className:"mt-1 space-y-1.5 text-xs",children:[Ve&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Released:"})," ",e.jsx("span",{children:Ve})]}),Ke&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Awards:"})," ",e.jsx("span",{children:Ke})]}),Ge&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Box office:"})," ",e.jsx("span",{children:Ge})]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"line-clamp-2 text-base font-semibold text-foreground sm:text-lg",children:r.title}),st&&e.jsx("p",{className:"text-xs text-muted-foreground/90",children:st}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-1.5 text-xs text-muted-foreground/90",children:[z&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Genres"}),e.jsx("span",{className:"truncate max-w-[180px]",children:Array.isArray(z)?z.slice(0,3).join(", "):String(z).split(",").map(t=>t.trim()).slice(0,3).join(", ")})]}),kt&&e.jsx("span",{className:"rounded-full bg-card/80 px-2 py-0.5 text-xs font-medium text-foreground/90",children:kt}),jt&&e.jsx("span",{className:"rounded-full bg-card/80 px-2 py-0.5 text-xs text-muted-foreground/90",children:jt})]})]}),vt&&e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground/70",children:"Overview"}),e.jsx("p",{className:"line-clamp-3 text-xs leading-relaxed text-muted-foreground/90",children:vt})]}),(We||ne)&&e.jsxs("div",{className:"space-y-1.5 text-[10.5px]",children:[We&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Director:"})," ",e.jsx("span",{children:We})]}),ne&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Cast:"})," ",e.jsx("span",{children:ne.split(",").map(t=>t.trim()).filter(Boolean).slice(0,3).join(", ")})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:[e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full bg-card/80 px-2.5 py-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground/80",children:"Your rating"}),e.jsx("div",{className:"flex items-center gap-0.5","aria-label":"Your rating",children:Array.from({length:5}).map((t,s)=>{const o=s+1,c=et!=null&&et>=o;return e.jsx("button",{type:"button",onClick:()=>fn(o),className:"flex h-5 w-5 items-center justify-center rounded-full hover:scale-105 focus-visible:outline-none",children:e.jsx(Wn,{className:`h-3.5 w-3.5 ${c?"fill-yellow-400 text-yellow-400":"text-muted-foreground"}`})},o)})})]}),e.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{type:"button",onClick:()=>Mt(J),className:`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium transition-colors ${Ct(J)?"bg-primary/90 text-primary-foreground":"border border-border bg-card/80 text-muted-foreground hover:border-primary/70 hover:text-primary"}`,children:"Watchlist"}),e.jsx("button",{type:"button",onClick:()=>Mt(ee),className:`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium transition-colors ${Ct(ee)?"bg-emerald-500/90 text-primary-foreground":"border border-border bg-card/80 text-muted-foreground hover:border-emerald-400/80 hover:text-emerald-300"}`,children:"Watched"}),e.jsxs("button",{type:"button",onClick:()=>pt(!0),className:"inline-flex items-center gap-1 rounded-full border border-border bg-card/80 px-2.5 py-1 text-xs font-medium text-muted-foreground hover:border-primary/70 hover:text-primary",children:[e.jsx(Qt,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Share"})]})]})]}),typeof r.friendLikesCount=="number"&&r.friendLikesCount>0||r.topFriendName&&r.topFriendReviewSnippet?e.jsxs("div",{className:"space-y-1.5 rounded-2xl bg-card/80 px-3 py-2 text-xs text-foreground shadow-md",children:[typeof r.friendLikesCount=="number"&&r.friendLikesCount>0&&e.jsxs("div",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx($t,{className:"h-4 w-4 text-primary/80"}),r.friendLikesCount===1?"1 friend likes this":`${r.friendLikesCount} friends like this`]}),r.topFriendName&&r.topFriendReviewSnippet&&e.jsxs("button",{type:"button",onClick:()=>Le(t=>!t),className:"mt-1 inline-flex w-full items-start gap-2 text-left",children:[e.jsx(lt,{className:"mt-0.5 h-4 w-4 text-primary"}),e.jsx("div",{className:`overflow-hidden transition-all duration-200 ${ke?"max-h-32":"max-h-10"}`,children:e.jsxs("span",{className:`block text-xs ${ke?"":"line-clamp-2"}`,children:[r.topFriendName,": “",r.topFriendReviewSnippet,"”"]})})]})]}):null]})}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>$e(t=>!t),"aria-expanded":Ne,"aria-controls":"swipe-detail-panel",className:"inline-flex items-center gap-1 rounded-full border border-border px-2.5 py-1 text-xs font-medium text-foreground hover:border-primary/70 hover:text-primary",children:e.jsx("span",{children:Ne?"Collapse":"Full details"})})})]})]})]}),be&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center bg-gradient-to-b from-background/70 via-background/50 to-background/80",children:e.jsxs("div",{className:"pointer-events-auto max-w-xs rounded-2xl border border-border bg-background/95 p-4 text-center shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Swipe to decide"}),e.jsx("p",{className:"mt-1 text-[12px] text-muted-foreground",children:"Swipe left to pass, right to save what you love."}),e.jsx("button",{type:"button",className:"mt-3 w-full rounded-xl bg-primary px-3 py-2 text-sm font-semibold text-white shadow-md",onClick:()=>{O(!1),typeof window<"u"&&localStorage.setItem(Ee,"1")},children:"Got it"})]})})]}),Mn()]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-3","aria-label":"Swipe actions",children:[e.jsxs("button",{type:"button",onClick:()=>Z("dislike"),disabled:he,className:"flex min-h-[44px] items-center justify-center gap-2 rounded-xl border border-border bg-background px-3 py-3 text-sm font-semibold text-rose-400 shadow-md disabled:cursor-not-allowed disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300 focus-visible:ring-offset-2 focus-visible:ring-offset-background active:translate-y-[1px] active:scale-[0.99] active:shadow-none transition-all duration-150","aria-label":"No thanks",children:[e.jsx(Ut,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"No thanks"})]}),e.jsxs("button",{type:"button",onClick:()=>Z("skip"),disabled:he,className:"flex min-h-[44px] items-center justify-center gap-2 rounded-xl border border-border bg-background px-3 py-3 text-sm font-semibold text-muted-foreground shadow-md disabled:cursor-not-allowed disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-border focus-visible:ring-offset-2 focus-visible:ring-offset-background active:translate-y-[1px] active:scale-[0.99] active:shadow-none transition-all duration-150","aria-label":"Not now",children:[e.jsx(er,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Not now"})]}),e.jsxs("button",{type:"button",onClick:()=>Z("like"),disabled:he,className:"flex min-h-[44px] items-center justify-center gap-2 rounded-xl border border-transparent bg-primary/95 px-3 py-3 text-sm font-semibold text-primary-foreground shadow-md disabled:cursor-not-allowed disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background active:translate-y-[1px] active:scale-[0.99] active:shadow-none transition-all duration-150","aria-label":"Love it",children:[e.jsx(Pt,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Love it"})]})]}),e.jsx(gr,{isOpen:nn,onClose:()=>pt(!1),activeCard:r,shareUrl:xn,onShareExternal:pn}),Sn()]})]})},gr=({isOpen:n,onClose:i,activeCard:l,shareUrl:f,onShareExternal:w})=>{const{user:M}=Gt(),{data:C=[],isLoading:$}=Un();if(a.useEffect(()=>{if(!n)return;const h=p=>{p.key==="Escape"&&i()};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[n,i]),!n||!l)return null;const U=`Check this out: ${l.title}

${f}`,R=h=>{h.target===h.currentTarget&&i()},W=h=>{(h.key==="Enter"||h.key===" ")&&i()};return e.jsx("div",{role:"button",tabIndex:0,className:"fixed inset-0 z-[9999] flex flex-col justify-end bg-black/55",onClick:R,onKeyDown:W,children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"pointer-events-auto mb-[72px] w-full max-w-md self-center rounded-t-2xl bg-card pb-3 pt-2 shadow-[0_-18px_45px_rgba(0,0,0,0.65)]",onClick:h=>h.stopPropagation(),onKeyDown:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[e.jsx("button",{type:"button",className:"rounded-full p-1 text-muted-foreground hover:bg-background/80",children:e.jsx(Bn,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Send to"}),e.jsx("button",{type:"button",onClick:i,className:"rounded-full p-1 text-muted-foreground hover:bg-background/80",children:e.jsx("span",{className:"text-[18px] leading-none",children:"×"})})]}),e.jsxs("section",{className:"border-t border-border px-4 pt-3 pb-2",children:[e.jsx("h2",{className:"mb-2 text-[12px] font-medium uppercase tracking-[0.08em] text-muted-foreground/90",children:"Send to"}),$?e.jsx("div",{className:"flex gap-3 overflow-hidden",children:Array.from({length:4}).map((h,p)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"h-11 w-11 animate-pulse rounded-full bg-border/50"}),e.jsx("div",{className:"h-2.5 w-12 animate-pulse rounded bg-border/40"})]},p))}):M?C.length===0?e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"No conversations yet. Start a chat from a profile or the Messages tab."}):e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:C.map(h=>e.jsx(wr,{conversation:h,text:U},h.id))}):e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"Sign in to share via messages."})]}),e.jsx("section",{className:"border-t border-border px-4 pt-3 pb-3",children:e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:[e.jsx(vr,{shareUrl:f,title:l.title}),e.jsx(jr,{shareUrl:f,title:l.title}),e.jsx(Nr,{onShareExternal:w}),e.jsx(yr,{shareUrl:f})]})})]})})},wr=({conversation:n,text:i})=>{const l=n.isGroup?null:n.participants?.find(U=>!U.isSelf)??n.participants?.[0],f=l?.displayName??n.title??"Conversation",w=l?.avatarUrl,M=qn(n.id),C=()=>{M.isPending||M.mutate({text:i})},$=f.split(" ").map(U=>U.charAt(0).toUpperCase()).slice(0,2).join("");return e.jsxs("button",{type:"button",onClick:C,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center overflow-hidden rounded-full bg-muted text-xs text-muted-foreground",children:w?e.jsx("img",{src:w,alt:f,className:"h-full w-full object-cover"}):e.jsx("span",{children:$})}),M.isSuccess&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-emerald-500",children:e.jsx(lt,{className:"h-3 w-3 text-primary-foreground"})})]}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:f})]})},yr=({shareUrl:n})=>{const i=async()=>{if(navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(n)}catch{}};return e.jsxs("button",{type:"button",onClick:i,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx(Gn,{className:"h-4 w-4 text-primary-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Copy link"})]})},vr=({shareUrl:n,title:i})=>{const l=()=>{if(typeof window>"u")return;const f=`Check this out: ${i}

${n}`,w=`https://api.whatsapp.com/send?text=${encodeURIComponent(f)}`;window.open(w,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:l,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"W"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"WhatsApp"})]})},jr=({shareUrl:n,title:i})=>{const l=()=>{if(typeof window>"u")return;const f=`Check this out: ${i}

${n}`,w=`https://t.me/share/url?url=${encodeURIComponent(n)}&text=${encodeURIComponent(f)}`;window.open(w,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:l,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"T"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Telegram"})]})},Nr=({onShareExternal:n})=>{const i=async()=>{await n()};return e.jsxs("button",{type:"button",onClick:i,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full border border-border bg-muted",children:e.jsx(Qt,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"More"})]})};export{Pr as default};
