import{c as ee,b as Oe,d as Le,e as Et,s as T,V as Re,O as je,r as u,T as _t,U as At,R as Fe,j as i,I as X,P as Nt,W as Tt,C as kt,J as Ue,K as M}from"./index-C9fHGWeV.js";import{u as ce}from"./useMutation-Cbgapksf.js";import{b as Dt,a as Mt}from"./format-DMUSBM01.js";import{C as It}from"./circle-alert-C2ornUjM.js";import{a as $t,u as Ot,c as R,P as H,d as Lt,h as Ft,R as Ut,e as Wt,F as Bt,D as Ht,b as L,f as Yt}from"./index-DDwuZX7F.js";import{c as We,R as zt,A as Be,C as Vt,a as Xt,u as qt}from"./index-DBHTwg8d.js";import"./index-B5ogGJIu.js";const Gt=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Ee=ee("check-check",Gt);const Kt=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Qt=ee("check",Kt);const Zt=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Jt=ee("pen-line",Zt);const er=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],tr=ee("trash-2",er);async function He(e,t,r){const{data:n,error:o}=await e.from("blocked_users").select("blocker_id, blocked_id").or(`and(blocker_id.eq.${t},blocked_id.eq.${r}),and(blocker_id.eq.${r},blocked_id.eq.${t})`);if(o)throw o;const s=n??[],a=s.some(c=>c.blocker_id===t&&c.blocked_id===r),l=s.some(c=>c.blocker_id===r&&c.blocked_id===t);return{youBlocked:a,blockedYou:l}}const jo=e=>{const{user:t}=Oe(),r=t?.id??null,n=Le(),o=["block-status",r,e],s=Et({queryKey:o,enabled:!!(r&&e&&r!==e),staleTime:3e4,queryFn:async()=>{if(!r||!e||r===e)return{youBlocked:!1,blockedYou:!1};try{return await He(T,r,e)}catch(p){console.error("[useBlockStatus] Failed to load block status",p);const h=p;throw new Error(h.message??"Failed to load block status")}}}),a=ce({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for block operation.");const{error:p}=await T.from("blocked_users").upsert({blocker_id:r,blocked_id:e,created_at:new Date().toISOString()},{onConflict:"blocker_id,blocked_id"});if(p)throw console.error("[useBlockStatus] Failed to block user",p),new Error(p.message)},onSuccess:()=>{n.invalidateQueries({queryKey:o})}}),l=ce({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for unblock operation.");const{error:p}=await T.from("blocked_users").delete().eq("blocker_id",r).eq("blocked_id",e);if(p)throw console.error("[useBlockStatus] Failed to unblock user",p),new Error(p.message)},onSuccess:()=>{n.invalidateQueries({queryKey:o})}}),c=s.data?.youBlocked??!1,d=s.data?.blockedYou??!1,f=c||d,m=a.isPending||l.isPending;return{youBlocked:c,blockedYou:d,isBlocked:f,isLoading:s.isLoading||m,isError:s.isError,error:s.error??null,block:a,unblock:l}},rr=({isSelf:e,isDeleted:t})=>({bubbleColors:t?"bg-muted text-muted-foreground border border-dashed border-border":e?"bg-primary text-primary-foreground":"bg-muted text-foreground",bubbleShape:e?"rounded-tr-3xl rounded-tl-3xl rounded-bl-3xl rounded-br-2xl":"rounded-tr-3xl rounded-tl-3xl rounded-br-3xl rounded-bl-2xl"}),le=e=>{const t=new Date(e);return Number.isNaN(t.getTime())?"":Dt(t,{hour:"numeric",minute:"2-digit",hour12:!0})},ue=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),_e=e=>{const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const r=new Date,n=new Date;return n.setDate(r.getDate()-1),ue(t,r)?"Today":ue(t,n)?"Yesterday":Mt(t,{day:"numeric",month:"short",year:"numeric"})},Ae=(e,t,r=180*1e3)=>{const n=new Date(e),o=new Date(t);return Number.isNaN(n.getTime())||Number.isNaN(o.getTime())?!1:o.getTime()-n.getTime()<=r},or=e=>({id:e.id,conversationId:e.conversation_id,senderId:e.user_id,body:e.body??null,attachmentUrl:e.attachment_url??null,createdAt:e.created_at??new Date().toISOString()}),Eo=e=>({userId:e.user_id,lastReadAt:e.last_read_at??null,lastReadMessageId:e.last_read_message_id??null}),_o=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,deliveredAt:e.delivered_at??e.created_at??new Date().toISOString()}),Ao=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,emoji:e.emoji,createdAt:e.created_at}),nr=["conversations"],ie=e=>["conversation",e,"messages"],No=e=>["conversation",e,"readReceipts"],To=(e,t)=>["conversation",e,"deliveryReceipts","messageIds",t],ko=e=>["conversation",e,"reactions"],te="temp-",me=e=>e.startsWith(te),sr=e=>me(e)?e:`${te}${e}`,Do=(e=Date.now())=>`${te}${e}`,ar=(e=Date.now())=>`${te}${e}-${Math.random().toString(36).slice(2,8)}`,Mo=(e,t={})=>{const{dedupe:r=!0,excludeTemp:n=!1,sort:o=!1}=t,s=e.filter(l=>typeof l=="string").map(l=>l.trim()).filter(Boolean).filter(l=>n?!me(l):!0),a=r?Array.from(new Set(s)):s;return o&&a.sort(),a},Ne=()=>({pages:[{items:[],hasMore:!0,cursor:null}],pageParams:[null]}),V=e=>[...e].sort((t,r)=>{const n=je(t.createdAt),o=je(r.createdAt);return n!==o?n-o:t.id.localeCompare(r.id)}),Y=e=>!e||!Array.isArray(e.pages)||!Array.isArray(e.pageParams)?Ne():e,q=e=>{const t=(e.pages??[]).map(r=>({...r,items:Array.isArray(r.items)?[...r.items]:[]}));return t.length>0?t:[{items:[],hasMore:!0,cursor:null}]},Te=(e,t)=>{const r=Y(e),n=q(r),o=n[n.length-1],s=new Map;for(const a of o.items??[])s.set(a.id,a);return s.set(t.id,t),o.items=V(Array.from(s.values())),{...r,pages:n}},Io=(e,t)=>{const r=Y(e),n=q(r).map(o=>({...o,items:(o.items??[]).map(s=>s.id===t.id?t:s)}));return{...r,pages:n}},$o=(e,t)=>{const r=Y(e),n=q(r).map(o=>({...o,items:(o.items??[]).filter(s=>s.id!==t)}));return{...r,pages:n}},lr=(e,t)=>{const r=Y(e),n=q(r),o=t.tempId??null,s=t.row;if(o)for(const l of n)l.items=(l.items??[]).filter(c=>c.id!==o);let a=!1;for(const l of n){const c=(l.items??[]).findIndex(d=>d.id===s.id);if(c>=0){l.items[c]=s,l.items=V(l.items),a=!0;break}}if(!a){const l=n[n.length-1];l.items=V([...l.items??[],s])}return{...r,pages:n}},Oo=(e,t)=>{const r=or(t),n=Re(r.body),o=Y(e),s=q(o);if(n)for(const l of s){const c=(l.items??[]).findIndex(d=>me(d.id)&&Re(d.body)===n);if(c>=0){l.items.splice(c,1);break}}for(const l of s){const c=(l.items??[]).findIndex(d=>d.id===r.id);if(c>=0)return l.items[c]=r,l.items=V(l.items),{...o,pages:s}}const a=s[s.length-1];return a.items=V([...a.items??[],r]),{...o,pages:s}},ir="id, conversation_id, user_id, body, message_type, text, client_id, meta, attachment_url, created_at",F="chat-media",de=(e=()=>String(Date.now()))=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():e(),fe=new Map,Ye=()=>Date.now(),ze=e=>{if(!e)return null;const t=fe.get(e);return t?t.expiresAt<=Ye()?(fe.delete(e),null):t.url:null},cr=(e,t,r)=>{if(!e||!t)return;const o=Math.max(0,r*1e3-6e4);fe.set(e,{url:t,expiresAt:Ye()+o})},he=3600,U=e=>/^https?:\/\//i.test(e),Ve=(e,t)=>t&&T.storage.from(e).getPublicUrl(t).data.publicUrl||null,Xe=async(e,t,r=he)=>{if(!t)return null;const{data:n,error:o}=await T.storage.from(e).createSignedUrl(t,r);return o||!n?.signedUrl?null:(cr(`${e}:${t}`,n.signedUrl,r),n.signedUrl)};async function ke(e,t,r){if(!t)return null;if(U(t))return r?.allowHttp?t:null;const n=r?.ttlSeconds??he,o=r?.allowPublicFallback??!1;if(!(r?.forceRefresh??!1)){const a=ze(`${e}:${t}`);if(a)return a}try{const a=await Xe(e,t,n);if(a)return a}catch{}if(!o)return null;try{return Ve(e,t)}catch{return null}}async function ur(e,t,r=he){if(t&&!U(t)&&!ze(`${e}:${t}`))try{await Xe(e,t,r)}catch{}}const De=async e=>{if(!e||U(e))return;const{error:t}=await T.storage.from(F).remove([e]);if(t)throw t},dr=10*1024*1024,pe={"image/jpg":"jpg","image/jpeg":"jpg","image/pjpeg":"jpg","image/png":"png","image/webp":"webp","image/gif":"gif","image/avif":"avif","image/heic":"heic","image/heif":"heif"},fr=new Set(Object.keys(pe)),Me=e=>{if(e.type&&pe[e.type])return pe[e.type];const t=e.name.split(".").pop()?.toLowerCase()??null;return t?t==="jpeg"?"jpg":["jpg","png","webp","gif","avif","heic","heif"].includes(t)?t:null:null},pr=(e,t,r)=>{const n=de(()=>String(Date.now()));return`message_attachments/${e}/${t}/${Date.now()}-${n}.${r}`};function Lo(e){const{conversationId:t,userId:r,isBlocked:n,blockedYou:o,attemptSend:s}=e,[a,l]=u.useState(null),[c,d]=u.useState(!1),f=u.useRef(0),m=u.useRef(null),p=u.useCallback(()=>l(null),[]),h=u.useCallback(()=>{f.current+=1,d(!1)},[]),g=u.useCallback(()=>{!t||!r||n||o||m.current?.click()},[o,t,n,r]),b=u.useCallback(async y=>{if(!t||!r||n||o)return;l(null);const w=f.current+=1;d(!0);const A=Me(y);if(!A){l("Unsupported image format."),d(!1);return}const P=pr(t,r,A);try{const{error:E}=await T.storage.from(F).upload(P,y,{cacheControl:"3600",upsert:!1});if(w!==f.current){try{await De(P)}catch{}return}if(E){console.error("[useAttachmentUpload] image upload error",E),l("Upload failed. Please try another image.");return}if(ur(F,P),w!==f.current){try{await De(P)}catch{}return}s({text:"",attachmentPath:P})}catch(E){console.error("[useAttachmentUpload] sendImageFile failed",E),l("Something went wrong while sending your image.")}finally{w===f.current&&d(!1)}},[s,o,t,n,r]),S=u.useCallback(async y=>{const w=y.target.files?.[0];if(y.target.value="",!(!w||!t||!r)&&!c&&!(n||o)){if(w.type){if(!w.type.startsWith("image/")){l("Please choose an image file.");return}if(!fr.has(w.type)){l("Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image.");return}}else if(!Me(w)){l("Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image.");return}if(w.size>dr){l("That image is too large (max 10MB). Try a smaller file.");return}await b(w)}},[o,t,n,c,b,r]);return{fileInputRef:m,openFilePicker:g,handleImageSelected:S,sendImageFile:b,isUploadingImage:c,uploadError:a,clearUploadError:p,cancelImageUpload:h}}const mr=(e,t,r,n)=>{if(!t||!Array.isArray(e))return e;const o=e,s=o.findIndex(d=>d.id===t);if(s<0)return e;const a=o[s],l=r(a);if(!l||l===a)return e;const c=[...o];return n?.moveToTop&&s>0?(c.splice(s,1),c.unshift(l),c):(c[s]=l,c)},hr=(e,t,r,n)=>{e.setQueriesData({queryKey:nr},o=>mr(o,t,r,n))},Ie=(e,t,r)=>{const n=e.trim();return!t&&!n?{payload:null,trimmed:n}:t&&n?{payload:{type:"text+image",text:n,clientId:r},trimmed:n}:t?{payload:{type:"image",text:"",clientId:r},trimmed:n}:{payload:{type:"text",text:n,clientId:r},trimmed:n}},Fo=(e,t)=>{const{user:r}=Oe(),n=r?.id??null,o=Le();return ce({mutationFn:async({text:s,attachmentPath:a,clientId:l})=>{if(!e)throw new Error("Missing conversation id.");if(!n)throw new Error("You must be signed in to send messages.");if(t?.otherUserId){const h=await He(T,n,t.otherUserId);if(h.youBlocked)throw new Error("You have blocked this user. Unblock them to send messages.");if(h.blockedYou)throw new Error("You cannot send messages because this user blocked you.")}const c=l??de(),{payload:d}=Ie(s,a??null,c);if(!d)throw new Error("Cannot send an empty message.");const{data:f,error:m}=await T.from("messages").insert({conversation_id:e,user_id:n,sender_id:n,body:d,message_type:d.type,text:d.text??null,client_id:d.clientId??null,meta:d,attachment_url:a??null}).select(ir).single();if(m)throw console.error("[useSendMessage] Failed to send message",m),new Error(m.message);return{id:f.id,conversationId:f.conversation_id,senderId:f.user_id,body:f.body??null,attachmentUrl:f.attachment_url??null,createdAt:f.created_at}},onMutate:async s=>{if(!e||!n)return{previous:void 0,tempId:null};const{text:a,attachmentPath:l}=s,c=s.clientId??de();s.clientId=c;const{payload:d,trimmed:f}=Ie(a,l??null,c);if(!d)throw new Error("Cannot send an empty message.");const m=s.tempId,p=typeof m=="string"&&m.length?sr(m):ar(),h=new Date().toISOString(),g={id:p,conversationId:e,senderId:n,body:d,attachmentUrl:l??null,createdAt:h},b=ie(e);await o.cancelQueries({queryKey:b});const S=o.getQueryData(b);return o.setQueryData(b,y=>Te(y,g)),{previous:S,tempId:p,optimistic:g,payload:{text:f,attachmentPath:l??null,clientId:c}}},onError:(s,a,l)=>{if(console.error("[useSendMessage] sendMessage error",s),!e)return;const{previous:c,optimistic:d,payload:f,tempId:m}=l??{previous:void 0,tempId:null},p=ie(e);o.setQueryData(p,h=>d?Te(c??h,d):Y(c??h)),m&&f&&t?.onFailed&&t.onFailed(m,f)},onSuccess:(s,a,l)=>{if(!e)return;const c=l?.tempId,d=ie(e);o.setQueryData(d,f=>lr(f,{tempId:c,row:s})),hr(o,e,f=>({...f,lastMessagePreview:At(s.body)??f.lastMessagePreview,lastMessageAt:s.createdAt??f.lastMessageAt,lastMessageAtLabel:_t(s.createdAt??null),hasUnread:!1,lastMessageIsFromSelf:!0,lastMessageSeenByOthers:!1}),{moveToTop:!0}),t?.onRecovered&&t.onRecovered(l?.tempId??null)}})},gr=Fe.memo(function({isSelf:t,isDeleted:r,children:n,className:o="",role:s,tabIndex:a,...l}){const{bubbleColors:c,bubbleShape:d}=rr({isSelf:t,isDeleted:r});return i.jsx("div",{role:s??"button",tabIndex:a??0,className:X("inline-flex max-w-[80%] px-4 py-2.5 text-sm transition-transform duration-150 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",d,c,o),...l,children:i.jsx("div",{className:"flex flex-col gap-1 text-left leading-relaxed",children:n})})}),xr=/((?:https?:\/\/|www\.)[^\s<]+[^<.,:;"')\]\s])/gi,br=/([A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,})/gi,vr=/(\+?\d[\d\s().-]{7,}\d)/g,wr=e=>/^https?:\/\//i.test(e)?e:/^www\./i.test(e)?`https://${e}`:e,qe=e=>e.replace(/\D/g,""),yr=e=>{const t=e.trim(),r=t.startsWith("+"),n=qe(t);return`${r?"+":""}${n}`},Sr=({text:e})=>{const t=a=>{a.stopPropagation()},r=[],n=(a,l)=>{const c=new RegExp(a);let d;for(;(d=c.exec(e))!==null;)r.push({start:d.index,end:d.index+d[0].length,kind:l,raw:d[0]})};n(xr,"url"),n(br,"email"),n(vr,"phone"),r.sort((a,l)=>a.start-l.start||l.end-a.end);const o=[];let s=0;for(const a of r)if(!(a.start<s)&&!(a.kind==="phone"&&qe(a.raw).length<10)){if(a.start>s&&o.push(e.slice(s,a.start)),a.kind==="url"){const l=wr(a.raw);o.push(i.jsx("a",{href:l,target:"_blank",rel:"noreferrer noopener",className:"underline underline-offset-2",onMouseDown:t,onClick:t,onTouchStart:t,children:a.raw},`${a.start}-${a.raw}`))}else if(a.kind==="email")o.push(i.jsx("a",{href:`mailto:${a.raw}`,className:"underline underline-offset-2",onMouseDown:t,onClick:t,onTouchStart:t,children:a.raw},`${a.start}-${a.raw}`));else{const l=yr(a.raw);o.push(i.jsx("a",{href:`tel:${l}`,className:"underline underline-offset-2",onMouseDown:t,onClick:t,onTouchStart:t,children:a.raw},`${a.start}-${a.raw}`))}s=a.end}return s<e.length&&o.push(e.slice(s)),i.jsx(i.Fragment,{children:o})},Cr=({path:e})=>{const[t,r]=u.useState(null),[n,o]=u.useState(!1),s=u.useRef(!0),a=u.useRef(null),l=u.useRef(!1);return u.useEffect(()=>()=>{s.current=!1},[]),u.useEffect(()=>{let c=!1;return a.current=e||null,l.current=!1,r(null),o(!1),e?U(e)?(o(!0),()=>{c=!0}):((async()=>{try{const d=await ke(F,e,{allowPublicFallback:!0,forceRefresh:!0});if(c||a.current!==e||!s.current)return;if(!d){o(!0);return}r(d)}catch{!c&&s.current&&a.current===e&&o(!0)}})(),()=>{c=!0}):(o(!0),()=>{c=!0})},[e]),n?e&&U(e)?i.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["External image link:"," ",i.jsx("a",{href:e,target:"_blank",rel:"noreferrer",className:"underline underline-offset-2",children:"open"})]}):i.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Image unavailable."}):t?i.jsx("div",{className:"mt-1 overflow-hidden rounded-xl border border-border bg-background/80",children:i.jsx("img",{src:t,alt:"Attachment",className:"max-h-64 w-full object-cover",loading:"lazy",onError:async()=>{if(!(!s.current||a.current!==e)){if(U(e)){o(!0);return}try{const c=Ve(F,e);if(c&&t===c){o(!0);return}if(l.current){o(!0);return}l.current=!0;const d=await ke(F,e,{allowPublicFallback:!0,forceRefresh:!0});if(!d||d===t){o(!0);return}if(!s.current||a.current!==e)return;r(d)}catch{s.current&&a.current===e&&o(!0)}}}})}):i.jsx("div",{className:"mt-1 h-32 w-40 animate-pulse rounded-xl bg-border/40"})},Pr=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ”¥","ðŸ˜"],Uo=Fe.memo(function({message:t,meta:r,sender:n,isSelf:o,deliveryStatus:s,showDeliveryStatus:a,reactions:l,index:c,previousMessage:d,nextMessage:f,firstUnreadIndex:m,activeActionMessageId:p,longPressTriggeredRef:h,onOpenMessageActions:g,onCloseMessageActions:b,onOpenEditDialog:S,onOpenDeleteDialog:y,onToggleReaction:w,onRetryMessage:A,onDiscardFailedMessage:P,onBubbleTouchStart:E,onBubbleTouchEndOrCancel:k}){const $=d!=null&&d.senderId===t.senderId,O=f!=null&&f.senderId===t.senderId,v=$&&Ae(d.createdAt,t.createdAt),C=O&&Ae(t.createdAt,f.createdAt),N=!($&&v),ye=!(O&&C),St=m!=null&&c===m,Se=c===0||d!=null&&!ue(new Date(d.createdAt),new Date(t.createdAt)),Ct=c===0||Se?"mt-0":N?"mt-3":"mt-1.5",D=r.deleted===!0,Ce=r.editedAt,Pe=r.deletedAt,se=le(t.createdAt),z=n?.displayName??(o?"You":"Someone"),Q=D?"This message was deleted":Nt(t.body),Pt=(()=>{const x=o?"You":z;return D?`${x} deleted a message`:Q?`${x} said: ${Q}`:t.attachmentUrl?`${x} sent an attachment`:`${x} sent a message`})(),Rt=!o&&ye,ae=()=>{if(h.current){h.current=!1;return}p===t.id?b():g(t)};return i.jsxs("div",{className:"px-0",children:[Se&&i.jsx("div",{className:"my-4 flex items-center justify-center",children:i.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-muted-foreground",children:[i.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),i.jsx("span",{className:"rounded-full bg-muted px-3 py-0.5 text-xs font-medium text-muted-foreground",children:_e(t.createdAt)}),i.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),St&&i.jsx("div",{className:"my-4 flex items-center justify-center",role:"separator","aria-label":"New messages",children:i.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-primary",children:[i.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),i.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-0.5 text-xs font-semibold text-primary",children:"New messages"}),i.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),N&&i.jsx("div",{className:`mb-1 flex ${o?"justify-end pr-1":"justify-start pl-9"}`,children:i.jsxs("div",{className:"inline-flex max-w-full items-center gap-2 rounded-full border border-border bg-muted/80 px-2.5 py-1 text-[11px] text-muted-foreground shadow-sm","aria-label":`Start of new message from ${o?"You":z} at ${se}`,title:`${o?"You":z} Â· ${_e(t.createdAt)} ${se}`,children:[i.jsx("span",{className:"max-w-[10rem] truncate text-foreground",children:o?"You":z}),i.jsx("span",{className:"h-1 w-1 rounded-full bg-border","aria-hidden":!0}),i.jsx("span",{children:se})]})}),i.jsxs("div",{className:`flex w-full flex-col gap-0.5 ${Ct}`,children:[i.jsxs("div",{className:`flex w-full items-end gap-2 ${o?"justify-end":"justify-start"}`,children:[!o&&i.jsx(i.Fragment,{children:Rt?i.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0 overflow-hidden rounded-full bg-muted",children:n?.avatarUrl?i.jsx("img",{src:n.avatarUrl,alt:n.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):i.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs font-medium text-muted-foreground",children:z.slice(0,2).toUpperCase()})}):i.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0"})}),i.jsxs(gr,{isSelf:o,isDeleted:D,onClick:ae,onContextMenu:x=>{x.preventDefault(),ae()},onKeyDown:x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),ae())},onTouchStart:()=>E(t),onTouchEnd:k,onTouchCancel:k,"aria-label":Pt,children:[Q&&i.jsx("p",{className:"whitespace-pre-wrap break-words [overflow-wrap:anywhere] text-sm leading-snug",children:i.jsx(Sr,{text:Q})}),!D&&t.attachmentUrl&&i.jsx(Cr,{path:t.attachmentUrl})]})]}),l.length>0&&i.jsx("div",{className:`mt-0.5 flex w-full ${o?"justify-end pr-6":"justify-start pl-6"}`,children:i.jsx("div",{className:"inline-flex flex-wrap items-center gap-1 rounded-full bg-muted px-1.5 py-0.5 text-xs text-foreground",children:l.map(x=>i.jsxs("button",{type:"button",onClick:()=>w(t.id,x.emoji),className:`inline-flex items-center gap-1 rounded-full px-1.5 py-0.5 transition hover:bg-background ${x.reactedBySelf?"bg-primary/10":""}`,children:[i.jsx("span",{className:"text-[17px]",children:x.emoji}),x.count>1&&i.jsx("span",{className:"text-xs text-muted-foreground",children:x.count})]},x.emoji))})}),p===t.id&&!D&&i.jsx("div",{className:`mt-1 flex w-full ${o?"justify-end pr-6":"justify-start pl-6"}`,children:i.jsxs("div",{className:"inline-flex flex-col items-stretch gap-1 rounded-2xl bg-muted px-2.5 py-1.5 text-xs text-foreground select-none",children:[i.jsx("div",{className:"flex items-center justify-center gap-1",children:Pr.map(x=>i.jsx("button",{type:"button",onClick:()=>{w(t.id,x),b()},className:"flex h-7 w-7 items-center justify-center rounded-full transition hover:bg-background",children:i.jsx("span",{className:"text-[17px]",children:x})},x))}),o&&i.jsxs("div",{className:"mt-1 flex items-center justify-end gap-2",children:[(()=>{if(t.attachmentUrl||D)return null;const x=Tt(t.body);return x!=="text"&&x!=="unknown"?null:i.jsxs("button",{type:"button",onClick:jt=>S(t,jt.currentTarget),className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-muted-foreground hover:bg-background",children:[i.jsx(Jt,{className:"h-3.5 w-3.5","aria-hidden":!0}),i.jsx("span",{children:"Edit"})]})})(),i.jsxs("button",{type:"button",onClick:()=>y(t),className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-destructive hover:bg-destructive/10",children:[i.jsx(tr,{className:"h-3.5 w-3.5","aria-hidden":!0}),i.jsx("span",{children:"Delete"})]})]})]})}),a&&s&&i.jsx("div",{className:`flex items-center gap-1 text-xs text-muted-foreground ${o?"justify-end pr-1":"justify-start pl-7"}`,children:s.status==="failed"?i.jsxs(i.Fragment,{children:[i.jsx(It,{className:"h-3 w-3 text-destructive","aria-hidden":!0}),i.jsx("span",{children:"Failed to send."}),i.jsx("button",{type:"button",className:"text-destructive underline",onClick:()=>A(t),children:"Retry"}),i.jsx("span",{"aria-hidden":"true",children:"Â·"}),i.jsx("button",{type:"button",className:"text-destructive underline",onClick:()=>P(t),children:"Discard"})]}):s.status==="sending"?i.jsxs(i.Fragment,{children:[i.jsx(kt,{className:"h-3 w-3 animate-spin","aria-hidden":!0}),i.jsx("span",{children:"Sendingâ€¦"})]}):s.status==="sent"?i.jsxs(i.Fragment,{children:[i.jsx(Qt,{className:"h-3 w-3","aria-hidden":!0}),i.jsx("span",{children:"Sent"})]}):s.status==="delivered"?i.jsxs(i.Fragment,{children:[i.jsx(Ee,{className:"h-3 w-3","aria-hidden":!0}),i.jsx("span",{children:"Delivered"})]}):i.jsxs(i.Fragment,{children:[i.jsx(Ee,{className:"h-3 w-3","aria-hidden":!0}),i.jsx("span",{children:"Seen"})]})}),D&&Pe&&i.jsxs("p",{className:`text-xs text-muted-foreground ${o?"text-right pr-1":"text-left pl-7"}`,children:["Deleted ",le(Pe)]}),!D&&Ce&&i.jsxs("p",{className:`text-xs text-muted-foreground ${o?"text-right pr-1":"text-left pl-7"}`,children:["Edited ",le(Ce)]})]})]},t.id)}),Rr=u.forwardRef(({className:e,...t},r)=>i.jsx("textarea",{className:X("flex min-h-[80px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));Rr.displayName="Textarea";function jr(e,t=[]){let r=[];function n(s,a){const l=u.createContext(a),c=r.length;r=[...r,a];const d=m=>{const{scope:p,children:h,...g}=m,b=p?.[e]?.[c]||l,S=u.useMemo(()=>g,Object.values(g));return i.jsx(b.Provider,{value:S,children:h})};d.displayName=s+"Provider";function f(m,p){const h=p?.[e]?.[c]||l,g=u.useContext(h);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${m}\` must be used within \`${s}\``)}return[d,f]}const o=()=>{const s=r.map(a=>u.createContext(a));return function(l){const c=l?.[e]||s;return u.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return o.scopeName=e,[n,Er(o,...t)]}function Er(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const a=n.reduce((l,{useScope:c,scopeName:d})=>{const m=c(s)[`__scope${d}`];return{...l,...m}},{});return u.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return r.scopeName=t.scopeName,r}function Ge(e){const t=_r(e),r=u.forwardRef((n,o)=>{const{children:s,...a}=n,l=u.Children.toArray(s),c=l.find(Nr);if(c){const d=c.props.children,f=l.map(m=>m===c?u.Children.count(d)>1?u.Children.only(null):u.isValidElement(d)?d.props.children:null:m);return i.jsx(t,{...a,ref:o,children:u.isValidElement(d)?u.cloneElement(d,void 0,f):null})}return i.jsx(t,{...a,ref:o,children:s})});return r.displayName=`${e}.Slot`,r}function _r(e){const t=u.forwardRef((r,n)=>{const{children:o,...s}=r;if(u.isValidElement(o)){const a=kr(o),l=Tr(s,o.props);return o.type!==u.Fragment&&(l.ref=n?Ue(n,a):a),u.cloneElement(o,l)}return u.Children.count(o)>1?u.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Ar=Symbol("radix.slottable");function Nr(e){return u.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Ar}function Tr(e,t){const r={...t};for(const n in t){const o=e[n],s=t[n];/^on[A-Z]/.test(n)?o&&s?r[n]=(...l)=>{const c=s(...l);return o(...l),c}:o&&(r[n]=o):n==="style"?r[n]={...o,...s}:n==="className"&&(r[n]=[o,s].filter(Boolean).join(" "))}return{...e,...r}}function kr(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var Dr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ke=Dr.reduce((e,t)=>{const r=Ge(`Primitive.${t}`),n=u.forwardRef((o,s)=>{const{asChild:a,...l}=o,c=a?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:s})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{}),re="Popover",[Qe]=jr(re,[We]),G=We(),[Mr,I]=Qe(re),Ze=e=>{const{__scopePopover:t,children:r,open:n,defaultOpen:o,onOpenChange:s,modal:a=!1}=e,l=G(t),c=u.useRef(null),[d,f]=u.useState(!1),[m,p]=$t({prop:n,defaultProp:o??!1,onChange:s,caller:re});return i.jsx(zt,{...l,children:i.jsx(Mr,{scope:t,contentId:Ot(),triggerRef:c,open:m,onOpenChange:p,onOpenToggle:u.useCallback(()=>p(h=>!h),[p]),hasCustomAnchor:d,onCustomAnchorAdd:u.useCallback(()=>f(!0),[]),onCustomAnchorRemove:u.useCallback(()=>f(!1),[]),modal:a,children:r})})};Ze.displayName=re;var Je="PopoverAnchor",Ir=u.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=I(Je,r),s=G(r),{onCustomAnchorAdd:a,onCustomAnchorRemove:l}=o;return u.useEffect(()=>(a(),()=>l()),[a,l]),i.jsx(Be,{...s,...n,ref:t})});Ir.displayName=Je;var et="PopoverTrigger",tt=u.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=I(et,r),s=G(r),a=M(t,o.triggerRef),l=i.jsx(Ke.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":at(o.open),...n,ref:a,onClick:R(e.onClick,o.onOpenToggle)});return o.hasCustomAnchor?l:i.jsx(Be,{asChild:!0,...s,children:l})});tt.displayName=et;var ge="PopoverPortal",[$r,Or]=Qe(ge,{forceMount:void 0}),rt=e=>{const{__scopePopover:t,forceMount:r,children:n,container:o}=e,s=I(ge,t);return i.jsx($r,{scope:t,forceMount:r,children:i.jsx(H,{present:r||s.open,children:i.jsx(Lt,{asChild:!0,container:o,children:n})})})};rt.displayName=ge;var W="PopoverContent",ot=u.forwardRef((e,t)=>{const r=Or(W,e.__scopePopover),{forceMount:n=r.forceMount,...o}=e,s=I(W,e.__scopePopover);return i.jsx(H,{present:n||s.open,children:s.modal?i.jsx(Fr,{...o,ref:t}):i.jsx(Ur,{...o,ref:t})})});ot.displayName=W;var Lr=Ge("PopoverContent.RemoveScroll"),Fr=u.forwardRef((e,t)=>{const r=I(W,e.__scopePopover),n=u.useRef(null),o=M(t,n),s=u.useRef(!1);return u.useEffect(()=>{const a=n.current;if(a)return Ft(a)},[]),i.jsx(Ut,{as:Lr,allowPinchZoom:!0,children:i.jsx(nt,{...e,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:R(e.onCloseAutoFocus,a=>{a.preventDefault(),s.current||r.triggerRef.current?.focus()}),onPointerDownOutside:R(e.onPointerDownOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;s.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:R(e.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),Ur=u.forwardRef((e,t)=>{const r=I(W,e.__scopePopover),n=u.useRef(!1),o=u.useRef(!1);return i.jsx(nt,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{e.onCloseAutoFocus?.(s),s.defaultPrevented||(n.current||r.triggerRef.current?.focus(),s.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:s=>{e.onInteractOutside?.(s),s.defaultPrevented||(n.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const a=s.target;r.triggerRef.current?.contains(a)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),nt=u.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:f,...m}=e,p=I(W,r),h=G(r);return Wt(),i.jsx(Bt,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:s,children:i.jsx(Ht,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:f,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>p.onOpenChange(!1),children:i.jsx(Vt,{"data-state":at(p.open),role:"dialog",id:p.contentId,...h,...m,ref:t,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),st="PopoverClose",Wr=u.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=I(st,r);return i.jsx(Ke.button,{type:"button",...n,ref:t,onClick:R(e.onClick,()=>o.onOpenChange(!1))})});Wr.displayName=st;var Br="PopoverArrow",Hr=u.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=G(r);return i.jsx(Xt,{...o,...n,ref:t})});Hr.displayName=Br;function at(e){return e?"open":"closed"}var Yr=Ze,zr=tt,Vr=rt,lt=ot;const Wo=Yr,Bo=zr,Xr=u.forwardRef(({className:e,align:t="center",sideOffset:r=4,...n},o)=>i.jsx(Vr,{children:i.jsx(lt,{ref:o,align:t,sideOffset:r,className:X("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=open]:zoom-in-95 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));Xr.displayName=lt.displayName;function qr(e){const t=Gr(e),r=u.forwardRef((n,o)=>{const{children:s,...a}=n,l=u.Children.toArray(s),c=l.find(Qr);if(c){const d=c.props.children,f=l.map(m=>m===c?u.Children.count(d)>1?u.Children.only(null):u.isValidElement(d)?d.props.children:null:m);return i.jsx(t,{...a,ref:o,children:u.isValidElement(d)?u.cloneElement(d,void 0,f):null})}return i.jsx(t,{...a,ref:o,children:s})});return r.displayName=`${e}.Slot`,r}function Gr(e){const t=u.forwardRef((r,n)=>{const{children:o,...s}=r;if(u.isValidElement(o)){const a=Jr(o),l=Zr(s,o.props);return o.type!==u.Fragment&&(l.ref=n?Ue(n,a):a),u.cloneElement(o,l)}return u.Children.count(o)>1?u.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Kr=Symbol("radix.slottable");function Qr(e){return u.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Kr}function Zr(e,t){const r={...t};for(const n in t){const o=e[n],s=t[n];/^on[A-Z]/.test(n)?o&&s?r[n]=(...l)=>{const c=s(...l);return o(...l),c}:o&&(r[n]=o):n==="style"?r[n]={...o,...s}:n==="className"&&(r[n]=[o,s].filter(Boolean).join(" "))}return{...e,...r}}function Jr(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var eo=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],K=eo.reduce((e,t)=>{const r=qr(`Primitive.${t}`),n=u.forwardRef((o,s)=>{const{asChild:a,...l}=o,c=a?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:s})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function to(e,t=[]){let r=[];function n(s,a){const l=u.createContext(a),c=r.length;r=[...r,a];const d=m=>{const{scope:p,children:h,...g}=m,b=p?.[e]?.[c]||l,S=u.useMemo(()=>g,Object.values(g));return i.jsx(b.Provider,{value:S,children:h})};d.displayName=s+"Provider";function f(m,p){const h=p?.[e]?.[c]||l,g=u.useContext(h);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${m}\` must be used within \`${s}\``)}return[d,f]}const o=()=>{const s=r.map(a=>u.createContext(a));return function(l){const c=l?.[e]||s;return u.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return o.scopeName=e,[n,ro(o,...t)]}function ro(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const a=n.reduce((l,{useScope:c,scopeName:d})=>{const m=c(s)[`__scope${d}`];return{...l,...m}},{});return u.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return r.scopeName=t.scopeName,r}function oo(e,[t,r]){return Math.min(r,Math.max(t,e))}function no(e,t){return u.useReducer((r,n)=>t[r][n]??r,e)}var xe="ScrollArea",[it]=to(xe),[so,j]=it(xe),ct=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:n="hover",dir:o,scrollHideDelay:s=600,...a}=e,[l,c]=u.useState(null),[d,f]=u.useState(null),[m,p]=u.useState(null),[h,g]=u.useState(null),[b,S]=u.useState(null),[y,w]=u.useState(0),[A,P]=u.useState(0),[E,k]=u.useState(!1),[$,O]=u.useState(!1),v=M(t,N=>c(N)),C=qt(o);return i.jsx(so,{scope:r,type:n,dir:C,scrollHideDelay:s,scrollArea:l,viewport:d,onViewportChange:f,content:m,onContentChange:p,scrollbarX:h,onScrollbarXChange:g,scrollbarXEnabled:E,onScrollbarXEnabledChange:k,scrollbarY:b,onScrollbarYChange:S,scrollbarYEnabled:$,onScrollbarYEnabledChange:O,onCornerWidthChange:w,onCornerHeightChange:P,children:i.jsx(K.div,{dir:C,...a,ref:v,style:{position:"relative","--radix-scroll-area-corner-width":y+"px","--radix-scroll-area-corner-height":A+"px",...e.style}})})});ct.displayName=xe;var ut="ScrollAreaViewport",dt=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:n,nonce:o,...s}=e,a=j(ut,r),l=u.useRef(null),c=M(t,l,a.onViewportChange);return i.jsxs(i.Fragment,{children:[i.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),i.jsx(K.div,{"data-radix-scroll-area-viewport":"",...s,ref:c,style:{overflowX:a.scrollbarXEnabled?"scroll":"hidden",overflowY:a.scrollbarYEnabled?"scroll":"hidden",...e.style},children:i.jsx("div",{ref:a.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});dt.displayName=ut;var _="ScrollAreaScrollbar",be=u.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=j(_,e.__scopeScrollArea),{onScrollbarXEnabledChange:s,onScrollbarYEnabledChange:a}=o,l=e.orientation==="horizontal";return u.useEffect(()=>(l?s(!0):a(!0),()=>{l?s(!1):a(!1)}),[l,s,a]),o.type==="hover"?i.jsx(ao,{...n,ref:t,forceMount:r}):o.type==="scroll"?i.jsx(lo,{...n,ref:t,forceMount:r}):o.type==="auto"?i.jsx(ft,{...n,ref:t,forceMount:r}):o.type==="always"?i.jsx(ve,{...n,ref:t}):null});be.displayName=_;var ao=u.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=j(_,e.__scopeScrollArea),[s,a]=u.useState(!1);return u.useEffect(()=>{const l=o.scrollArea;let c=0;if(l){const d=()=>{window.clearTimeout(c),a(!0)},f=()=>{c=window.setTimeout(()=>a(!1),o.scrollHideDelay)};return l.addEventListener("pointerenter",d),l.addEventListener("pointerleave",f),()=>{window.clearTimeout(c),l.removeEventListener("pointerenter",d),l.removeEventListener("pointerleave",f)}}},[o.scrollArea,o.scrollHideDelay]),i.jsx(H,{present:r||s,children:i.jsx(ft,{"data-state":s?"visible":"hidden",...n,ref:t})})}),lo=u.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=j(_,e.__scopeScrollArea),s=e.orientation==="horizontal",a=ne(()=>c("SCROLL_END"),100),[l,c]=no("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return u.useEffect(()=>{if(l==="idle"){const d=window.setTimeout(()=>c("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(d)}},[l,o.scrollHideDelay,c]),u.useEffect(()=>{const d=o.viewport,f=s?"scrollLeft":"scrollTop";if(d){let m=d[f];const p=()=>{const h=d[f];m!==h&&(c("SCROLL"),a()),m=h};return d.addEventListener("scroll",p),()=>d.removeEventListener("scroll",p)}},[o.viewport,s,c,a]),i.jsx(H,{present:r||l!=="hidden",children:i.jsx(ve,{"data-state":l==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:R(e.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:R(e.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),ft=u.forwardRef((e,t)=>{const r=j(_,e.__scopeScrollArea),{forceMount:n,...o}=e,[s,a]=u.useState(!1),l=e.orientation==="horizontal",c=ne(()=>{if(r.viewport){const d=r.viewport.offsetWidth<r.viewport.scrollWidth,f=r.viewport.offsetHeight<r.viewport.scrollHeight;a(l?d:f)}},10);return B(r.viewport,c),B(r.content,c),i.jsx(H,{present:n||s,children:i.jsx(ve,{"data-state":s?"visible":"hidden",...o,ref:t})})}),ve=u.forwardRef((e,t)=>{const{orientation:r="vertical",...n}=e,o=j(_,e.__scopeScrollArea),s=u.useRef(null),a=u.useRef(0),[l,c]=u.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=xt(l.viewport,l.content),f={...n,sizes:l,onSizesChange:c,hasThumb:d>0&&d<1,onThumbChange:p=>s.current=p,onThumbPointerUp:()=>a.current=0,onThumbPointerDown:p=>a.current=p};function m(p,h){return mo(p,a.current,l,h)}return r==="horizontal"?i.jsx(io,{...f,ref:t,onThumbPositionChange:()=>{if(o.viewport&&s.current){const p=o.viewport.scrollLeft,h=$e(p,l,o.dir);s.current.style.transform=`translate3d(${h}px, 0, 0)`}},onWheelScroll:p=>{o.viewport&&(o.viewport.scrollLeft=p)},onDragScroll:p=>{o.viewport&&(o.viewport.scrollLeft=m(p,o.dir))}}):r==="vertical"?i.jsx(co,{...f,ref:t,onThumbPositionChange:()=>{if(o.viewport&&s.current){const p=o.viewport.scrollTop,h=$e(p,l);s.current.style.transform=`translate3d(0, ${h}px, 0)`}},onWheelScroll:p=>{o.viewport&&(o.viewport.scrollTop=p)},onDragScroll:p=>{o.viewport&&(o.viewport.scrollTop=m(p))}}):null}),io=u.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...o}=e,s=j(_,e.__scopeScrollArea),[a,l]=u.useState(),c=u.useRef(null),d=M(t,c,s.onScrollbarXChange);return u.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),i.jsx(mt,{"data-orientation":"horizontal",...o,ref:d,sizes:r,style:{bottom:0,left:s.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:s.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":oe(r)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.x),onDragScroll:f=>e.onDragScroll(f.x),onWheelScroll:(f,m)=>{if(s.viewport){const p=s.viewport.scrollLeft+f.deltaX;e.onWheelScroll(p),vt(p,m)&&f.preventDefault()}},onResize:()=>{c.current&&s.viewport&&a&&n({content:s.viewport.scrollWidth,viewport:s.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:J(a.paddingLeft),paddingEnd:J(a.paddingRight)}})}})}),co=u.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...o}=e,s=j(_,e.__scopeScrollArea),[a,l]=u.useState(),c=u.useRef(null),d=M(t,c,s.onScrollbarYChange);return u.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),i.jsx(mt,{"data-orientation":"vertical",...o,ref:d,sizes:r,style:{top:0,right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":oe(r)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.y),onDragScroll:f=>e.onDragScroll(f.y),onWheelScroll:(f,m)=>{if(s.viewport){const p=s.viewport.scrollTop+f.deltaY;e.onWheelScroll(p),vt(p,m)&&f.preventDefault()}},onResize:()=>{c.current&&s.viewport&&a&&n({content:s.viewport.scrollHeight,viewport:s.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:J(a.paddingTop),paddingEnd:J(a.paddingBottom)}})}})}),[uo,pt]=it(_),mt=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:o,onThumbChange:s,onThumbPointerUp:a,onThumbPointerDown:l,onThumbPositionChange:c,onDragScroll:d,onWheelScroll:f,onResize:m,...p}=e,h=j(_,r),[g,b]=u.useState(null),S=M(t,v=>b(v)),y=u.useRef(null),w=u.useRef(""),A=h.viewport,P=n.content-n.viewport,E=L(f),k=L(c),$=ne(m,10);function O(v){if(y.current){const C=v.clientX-y.current.left,N=v.clientY-y.current.top;d({x:C,y:N})}}return u.useEffect(()=>{const v=C=>{const N=C.target;g?.contains(N)&&E(C,P)};return document.addEventListener("wheel",v,{passive:!1}),()=>document.removeEventListener("wheel",v,{passive:!1})},[A,g,P,E]),u.useEffect(k,[n,k]),B(g,$),B(h.content,$),i.jsx(uo,{scope:r,scrollbar:g,hasThumb:o,onThumbChange:L(s),onThumbPointerUp:L(a),onThumbPositionChange:k,onThumbPointerDown:L(l),children:i.jsx(K.div,{...p,ref:S,style:{position:"absolute",...p.style},onPointerDown:R(e.onPointerDown,v=>{v.button===0&&(v.target.setPointerCapture(v.pointerId),y.current=g.getBoundingClientRect(),w.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",h.viewport&&(h.viewport.style.scrollBehavior="auto"),O(v))}),onPointerMove:R(e.onPointerMove,O),onPointerUp:R(e.onPointerUp,v=>{const C=v.target;C.hasPointerCapture(v.pointerId)&&C.releasePointerCapture(v.pointerId),document.body.style.webkitUserSelect=w.current,h.viewport&&(h.viewport.style.scrollBehavior=""),y.current=null})})})}),Z="ScrollAreaThumb",ht=u.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=pt(Z,e.__scopeScrollArea);return i.jsx(H,{present:r||o.hasThumb,children:i.jsx(fo,{ref:t,...n})})}),fo=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:n,...o}=e,s=j(Z,r),a=pt(Z,r),{onThumbPositionChange:l}=a,c=M(t,m=>a.onThumbChange(m)),d=u.useRef(void 0),f=ne(()=>{d.current&&(d.current(),d.current=void 0)},100);return u.useEffect(()=>{const m=s.viewport;if(m){const p=()=>{if(f(),!d.current){const h=ho(m,l);d.current=h,l()}};return l(),m.addEventListener("scroll",p),()=>m.removeEventListener("scroll",p)}},[s.viewport,f,l]),i.jsx(K.div,{"data-state":a.hasThumb?"visible":"hidden",...o,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:R(e.onPointerDownCapture,m=>{const h=m.target.getBoundingClientRect(),g=m.clientX-h.left,b=m.clientY-h.top;a.onThumbPointerDown({x:g,y:b})}),onPointerUp:R(e.onPointerUp,a.onThumbPointerUp)})});ht.displayName=Z;var we="ScrollAreaCorner",gt=u.forwardRef((e,t)=>{const r=j(we,e.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?i.jsx(po,{...e,ref:t}):null});gt.displayName=we;var po=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,...n}=e,o=j(we,r),[s,a]=u.useState(0),[l,c]=u.useState(0),d=!!(s&&l);return B(o.scrollbarX,()=>{const f=o.scrollbarX?.offsetHeight||0;o.onCornerHeightChange(f),c(f)}),B(o.scrollbarY,()=>{const f=o.scrollbarY?.offsetWidth||0;o.onCornerWidthChange(f),a(f)}),d?i.jsx(K.div,{...n,ref:t,style:{width:s,height:l,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function J(e){return e?parseInt(e,10):0}function xt(e,t){const r=e/t;return isNaN(r)?0:r}function oe(e){const t=xt(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-r)*t;return Math.max(n,18)}function mo(e,t,r,n="ltr"){const o=oe(r),s=o/2,a=t||s,l=o-a,c=r.scrollbar.paddingStart+a,d=r.scrollbar.size-r.scrollbar.paddingEnd-l,f=r.content-r.viewport,m=n==="ltr"?[0,f]:[f*-1,0];return bt([c,d],m)(e)}function $e(e,t,r="ltr"){const n=oe(t),o=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,s=t.scrollbar.size-o,a=t.content-t.viewport,l=s-n,c=r==="ltr"?[0,a]:[a*-1,0],d=oo(e,c);return bt([0,a],[0,l])(d)}function bt(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function vt(e,t){return e>0&&e<t}var ho=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return(function o(){const s={left:e.scrollLeft,top:e.scrollTop},a=r.left!==s.left,l=r.top!==s.top;(a||l)&&t(),r=s,n=window.requestAnimationFrame(o)})(),()=>window.cancelAnimationFrame(n)};function ne(e,t){const r=L(e),n=u.useRef(0);return u.useEffect(()=>()=>window.clearTimeout(n.current),[]),u.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function B(e,t){const r=L(t);Yt(()=>{let n=0;if(e){const o=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return o.observe(e),()=>{window.cancelAnimationFrame(n),o.unobserve(e)}}},[e,r])}var wt=ct,go=dt,xo=gt;const bo=u.forwardRef(({className:e,children:t,...r},n)=>i.jsxs(wt,{ref:n,className:X("relative overflow-hidden",e),...r,children:[i.jsx(go,{className:"h-full w-full rounded-[inherit]",children:t}),i.jsx(yt,{}),i.jsx(xo,{})]}));bo.displayName=wt.displayName;const yt=u.forwardRef(({className:e,orientation:t="vertical",...r},n)=>i.jsx(be,{ref:n,orientation:t,className:X("flex touch-none select-none transition-colors data-[orientation=vertical]:h-full data-[orientation=vertical]:w-2 data-[orientation=horizontal]:h-2 data-[orientation=horizontal]:w-full",e),...r,children:i.jsx(ht,{className:"relative flex-1 rounded-full bg-border"})}));yt.displayName=be.displayName;export{F as C,ir as M,Wo as P,bo as S,Rr as T,Oo as a,Ao as b,ie as c,Eo as d,_o as e,ko as f,Do as g,No as h,me as i,To as j,hr as k,nr as l,or as m,Mo as n,De as o,U as p,$o as q,Io as r,V as s,Bo as t,Fo as u,Xr as v,tr as w,jo as x,Lo as y,Uo as z};
