import{c as O,r as v,j as e,f as V,t as X,d as Q,s as I,e as ee,R as k,L as H,g as W,h as te,u as ae,M as re,i as se,k as ne}from"./index-D8UbFo8l.js";import{c as le,B as N,S as R}from"./Button-B47nkF3R.js";import{P as ie}from"./PageChrome-BL71Rgrf.js";import{T as oe}from"./TopBar-ClKHHvFp.js";import{q as de}from"./index-WHzSfndh.js";import{F as G}from"./film-E5LDX5VI.js";import{S as me}from"./star-dR1loror.js";import{u as ce,U as ue,a as xe}from"./useToggleFollow-Bad84SvB.js";import{U as pe}from"./users-CgaclyYW.js";import{U as be}from"./user-ByAEhhbu.js";import{X as E}from"./x-DI5KpeLJ.js";import"./brand-DTIDtbc4.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=O("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=O("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]),Y=v.forwardRef(({className:t,type:a,...d},u)=>e.jsx("input",{type:a,className:le("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:u,...d}));Y.displayName="Input";const K=v.createContext(null),ge=({value:t,defaultValue:a,onValueChange:d,className:u="",children:n})=>{const[x,o]=v.useState(a??""),m=v.useId(),b=t??x,f=l=>{t===void 0&&o(l),d==null||d(l)};return e.jsx(K.Provider,{value:{value:b,setValue:f,idBase:m},children:e.jsx("div",{className:u,children:n})})};function Z(){const t=v.useContext(K);if(!t)throw new Error("Tabs.* components must be used within <Tabs>");return t}const fe=({className:t="",children:a})=>{const d="flex max-w-full gap-1.5 overflow-x-auto rounded-full border border-mn-border-subtle/60 bg-mn-bg-elevated/70 p-1.5 backdrop-blur "+t;return e.jsx("div",{role:"tablist",className:d,children:a})},A=({value:t,icon:a,className:d="",children:u,...n})=>{const{value:x,setValue:o,idBase:m}=Z(),b=x===t,f=`${m}-tab-${t}`,c=["inline-flex items-center gap-1.5 whitespace-nowrap rounded-full px-3 py-1.5 text-[11px] font-medium outline-none transition",b?"bg-mn-primary text-mn-bg shadow-mn-soft":"bg-transparent text-mn-text-secondary hover:bg-mn-bg-elevated/70",d].filter(Boolean).join(" ");return e.jsxs("button",{type:"button",role:"tab","aria-selected":b,"aria-controls":`${m}-tabpanel-${t}`,id:f,className:c,onClick:()=>o(t),...n,children:[a&&e.jsx("span",{className:"inline-flex h-3.5 w-3.5",children:a}),e.jsx("span",{children:u})]})},q=({value:t,className:a="",children:d})=>{const{value:u,idBase:n}=Z();return u!==t?null:e.jsx("div",{role:"tabpanel",id:`${n}-tabpanel-${t}`,"aria-labelledby":`${n}-tab-${t}`,className:a,children:d})},ye=(t,a)=>{const[d,u]=v.useState(t);return v.useEffect(()=>{const n=window.setTimeout(()=>{u(t)},a);return()=>{window.clearTimeout(n)}},[t,a]),d},z=t=>{if(t!=null&&t.aborted)throw t.reason??new DOMException("Aborted","AbortError")};async function ve(t,a=1,d){const u=t.trim();if(!u)return{results:[],hasMore:!1};z(d);const n=await V("/search/multi",{query:u,include_adult:"false",page:a},d);z(d);const x=Array.isArray(n==null?void 0:n.results)?n.results:[];if(!x.length)return{results:[],hasMore:!1};const o=typeof(n==null?void 0:n.total_pages)=="number"?n.total_pages:1;return{results:x.filter(m=>!!(m&&typeof m.id=="number"&&(m.media_type==="movie"||m.media_type==="tv"))).slice(0,20).map(m=>{const b=m.media_type==="tv"?"tv":"movie",f=m.release_date??m.first_air_date??null,l=f?Number(String(f).slice(0,4)):null;return{tmdbId:Number(m.id),imdbId:m.imdb_id??null,title:m.title??m.name??"Untitled",year:Number.isNaN(l)?null:l,type:b,posterUrl:X(m.poster_path??null)}}),hasMore:a<o}}const T=t=>{if(t!=null&&t.aborted)throw t.reason??new DOMException("Aborted","AbortError")},je=t=>{const a=t.poster_url??t.backdrop_url??null;return{id:t.title_id,title:t.primary_title??t.original_title??"Untitled",year:t.release_year,type:t.content_type,source:"library",posterUrl:a,originalLanguage:t.language,ageRating:t.omdb_rated,imdbRating:t.imdb_rating,rtTomatoMeter:t.rt_tomato_pct,imdbId:t.omdb_imdb_id,tmdbId:t.tmdb_id}},M=20,we=5,Ne=async(t,a,d,u)=>{var s,g;T(u);const n=`
    title_id,
    primary_title,
    original_title,
    release_year,
    content_type,
    poster_url,
    backdrop_url,
    language,
    omdb_rated,
    omdb_imdb_id,
    tmdb_id,
    imdb_rating,
    rt_tomato_pct
  `,x=(d-1)*M;let o=I.from("titles").select(n,{count:"exact"});if((s=a==null?void 0:a.genreIds)!=null&&s.length&&(o=o.select(`${n}, title_genres!inner(genre_id, genres(id, name))`)),o=o.order("release_year",{ascending:!1}).range(x,x+M-1),u&&(o=o.abortSignal(u)),t){const i=`%${t}%`;o=o.or(`primary_title.ilike.${i},original_title.ilike.${i}`)}a!=null&&a.type&&a.type!=="all"&&(o=o.eq("content_type",a.type)),typeof(a==null?void 0:a.minYear)=="number"&&(o=o.gte("release_year",a.minYear)),typeof(a==null?void 0:a.maxYear)=="number"&&(o=o.lte("release_year",a.maxYear)),a!=null&&a.originalLanguage&&(o=o.eq("language",a.originalLanguage)),(g=a==null?void 0:a.genreIds)!=null&&g.length&&(o=o.in("title_genres.genre_id",a.genreIds));const{data:m,error:b,count:f}=await o;if(b)throw new Error(b.message);T(u);const l=m??[],p=typeof f=="number"?f:void 0,c=p?x+l.length<p:l.length===M;return{results:l.map(je),hasMore:c}},_e=async t=>{const{query:a,filters:d,page:u=1,signal:n}=t,x=a.trim();T(n);let o=[],m=!1;try{const{results:i,hasMore:h}=await Ne(x,d,u,n);o=i,m=h}catch(i){console.warn("[search.service] Supabase search failed, falling back to TMDb",i)}const{results:b,hasMore:f}=await ve(x,u,n);if(T(n),!b.length&&o.length>0)return{results:o,hasMore:m};const l=new Set;for(const i of o)i.tmdbId&&l.add(i.tmdbId);const p=b.filter(i=>i.tmdbId&&!l.has(i.tmdbId)).slice(0,we),c=new Map;if(p.length)try{const i=await Q("catalog-sync-batch",{items:p.map(y=>({tmdbId:y.tmdbId,imdbId:y.imdbId??void 0,mediaType:y.type==="tv"?"tv":"movie"})),options:{syncOmdb:!0,syncYoutube:!0,forceRefresh:!1}},{signal:n}),h=(i==null?void 0:i.results)??[];for(const y of h)y.tmdbId&&y.titleId&&c.set(y.tmdbId,y.titleId)}catch(i){console.warn("[search.service] catalog-sync-batch failed",i)}const s=await Promise.all(b.map(async i=>{if(T(n),i.tmdbId&&l.has(i.tmdbId))return null;const h=i.type==="tv"?"series":"movie",y=i.tmdbId&&c.get(i.tmdbId)?c.get(i.tmdbId):`tmdb-${i.tmdbId}`,j=y.startsWith("tmdb-")===!1;return{id:y,title:i.title,year:i.year??null,type:h,source:j?"external-synced":"external-only",posterUrl:i.posterUrl,originalLanguage:null,ageRating:null,imdbRating:null,rtTomatoMeter:null,imdbId:i.imdbId??null,tmdbId:i.tmdbId}}));return{results:[...o,...s.filter(i=>!!i)],hasMore:m||f}},Se=t=>{const{query:a,filters:d}=t,u=a.trim();return ee({queryKey:["search","titles",{query:u,filters:d}],enabled:u.length>0,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:(n,x)=>n.hasMore?x.length+1:void 0,queryFn:({signal:n,pageParam:x})=>_e({query:u,filters:d,page:x??1,signal:n})})},Fe=({item:t})=>{const a=[];t.year&&a.push(String(t.year)),t.type==="movie"&&a.push("Movie"),t.type==="series"&&a.push("Series"),t.originalLanguage&&a.push(`Language: ${t.originalLanguage}`),t.ageRating&&a.push(t.ageRating),t.imdbRating&&a.push(`IMDb ${t.imdbRating.toFixed(1)}`),t.rtTomatoMeter&&a.push(`RT ${t.rtTomatoMeter}%`);const d={library:"Library","external-synced":"Synced","external-only":"External"},u={library:"bg-mn-primary/10 text-mn-primary border-mn-primary/40","external-synced":"bg-emerald-500/10 text-emerald-400 border-emerald-500/30","external-only":"bg-mn-bg-elevated text-mn-text-muted border-mn-border-subtle"};return e.jsx("div",{children:e.jsxs(H,{to:`/title/${t.id}`,className:"flex gap-3 rounded-mn-card border border-mn-border-subtle bg-mn-bg/60 p-2 hover:bg-mn-bg-elevated/80",children:[t.posterUrl?e.jsx("img",{src:t.posterUrl,alt:t.title,className:"h-20 w-14 rounded-mn-card object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-20 w-14 items-center justify-center rounded-mn-card bg-mn-surface-muted",children:e.jsx(G,{className:"h-5 w-5 text-mn-text-muted","aria-hidden":"true"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-[12px] font-medium text-mn-text-primary",children:t.title}),e.jsx("span",{className:`shrink-0 rounded-full border px-2 py-0.5 text-[10px] font-medium ${u[t.source]}`,children:d[t.source]})]}),a.length>0&&e.jsx("p",{className:"text-[11px] text-mn-text-secondary",children:a.join(" • ")})]})]})})},Ye=({query:t,filters:a,onResetFilters:d})=>{const u=t.trim(),{data:n,isLoading:x,isError:o,error:m,fetchNextPage:b,hasNextPage:f,isFetchingNextPage:l}=Se({query:u,filters:a}),p=(n==null?void 0:n.results)??[],c=p.length,s=[];a.type&&a.type!=="all"&&s.push(a.type==="movie"?"Movies":"Series"),typeof a.minYear=="number"&&s.push(`From ${a.minYear}`),typeof a.maxYear=="number"&&s.push(`Up to ${a.maxYear}`),a.originalLanguage&&s.push(`Language: ${a.originalLanguage==="en"?"English":a.originalLanguage}`);const g=s.length?s.join(" • "):"No filters applied",i=k.useRef(new Set);return k.useEffect(()=>{if(!p||!Array.isArray(p))return;const h=i.current;p.filter(j=>!(h.has(j.id)||!j.imdbId&&!j.tmdbId||j.imdbRating||j.rtTomatoMeter)).slice(0,3).forEach(j=>{h.add(j.id),I.functions.invoke("catalog-sync",{body:{external:{tmdbId:j.tmdbId??void 0,imdbId:j.imdbId??void 0,type:j.type==="series"?"tv":"movie"},options:{syncOmdb:!0,forceRefresh:!1}}}).catch(S=>{console.warn("[SearchTitlesTab] catalog-sync failed for",j.id,S)})})},[n]),u?x?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-mn-text-secondary",children:["Searching for ",e.jsx("span",{className:"font-semibold text-mn-text-primary",children:u}),"…"]}),e.jsx("p",{className:"text-[11px] text-mn-text-muted",children:"Fetching matching titles from your catalog and external sources."}),e.jsx("div",{className:"space-y-2",children:[0,1,2].map(h=>e.jsxs("div",{className:"flex gap-3 rounded-mn-card border border-mn-border-subtle bg-mn-bg/60 p-2",children:[e.jsx("div",{className:"h-16 w-11 animate-pulse rounded-xl bg-mn-bg-elevated/60"}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center space-y-1.5",children:[e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-mn-bg-elevated/60"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-mn-bg-elevated/40"})]})]},h))})]}):o?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-mn-text-destructive",children:"Something went wrong while searching for titles."}),m&&e.jsxs("p",{className:"text-[11px] text-mn-text-muted",children:[e.jsx("span",{className:"font-semibold",children:"Details: "}),m.message]})]}):c?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-[11px] text-mn-text-secondary",children:["Showing ",e.jsx("span",{className:"font-semibold text-mn-text-primary",children:c})," result",c===1?"":"s"," across your catalog and external sources for"," ",e.jsx("span",{className:"font-semibold text-mn-text-primary",children:u}),"."]}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",className:"h-auto rounded-full border-mn-border-subtle px-2 py-1 text-[10px] text-mn-text-muted hover:border-mn-border-strong hover:text-mn-text-primary",onClick:d,children:[e.jsx(R,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Reset filters"})]})]}),e.jsx("div",{className:"rounded-mn-card border border-mn-border-subtle bg-mn-bg/60 p-3",children:e.jsxs("p",{className:"flex items-center gap-2 text-[11px] text-mn-text-secondary",children:[e.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-mn-surface-muted text-[10px] font-medium text-mn-text-muted",children:e.jsx(R,{className:"h-3 w-3","aria-hidden":"true"})}),e.jsx("span",{className:"truncate",children:g})]})}),e.jsx(de,{style:{height:"70vh"},data:p,endReached:()=>{f&&!l&&b()},computeItemKey:(h,y)=>y.id,components:{List:k.forwardRef(function(y,j){return e.jsx("div",{ref:j,className:"space-y-2",...y})}),Footer:()=>f?e.jsx("div",{className:"flex justify-center py-3",children:e.jsx(N,{type:"button",className:"inline-flex items-center justify-center gap-2 rounded-full bg-mn-primary px-4 py-2 text-[11px] font-medium text-white shadow-mn-soft transition hover:bg-mn-primary/90 disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>b(),disabled:l,children:l?"Loading more…":"Load more results"})}):null},itemContent:(h,y)=>e.jsx(Fe,{item:y})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-mn-text-secondary",children:["No titles found matching"," ",e.jsx("span",{className:"font-semibold text-mn-text-primary",children:u}),"."]}),e.jsx("p",{className:"text-[11px] text-mn-text-muted",children:"Try adjusting your search or removing some filters to see more results."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-mn-text-secondary",children:"Start typing a title, director, or genre to search the catalog. As you wire Supabase search, results will appear here."}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-[11px] font-medium text-mn-text-primary",children:"Try searching for"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-[11px]",children:["Sci-fi romance","Feel-good comedies","Films from 2020s","Cozy rainy-day movies"].map(h=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-mn-border-subtle px-2 py-1 text-mn-text-muted",children:[e.jsx(G,{className:"mr-1 h-3 w-3 text-mn-text-muted","aria-hidden":"true"}),h]},h))})]}),e.jsxs("div",{className:"space-y-1.5 rounded-mn-card border border-mn-border-subtle bg-mn-bg/60 p-3",children:[e.jsxs("p",{className:"flex items-center gap-1 text-[11px] font-medium text-mn-text-primary",children:[e.jsx(me,{className:"h-3.5 w-3.5 text-mn-primary","aria-hidden":"true"}),e.jsx("span",{children:"Trending this week"})]}),e.jsx("p",{className:"text-[11px] text-mn-text-muted",children:"Once analytics are wired up, you can show what your friends and the community are watching the most here."})]})]})},Ie=t=>{const a=t.trim(),{user:d}=W();return te({queryKey:["search","people",{query:a,userId:(d==null?void 0:d.id)??null}],enabled:a.length>0,queryFn:async()=>{const u=a.replace(/%/g,"\\%").replace(/_/g,"\\_"),n=await I.from("profiles").select("id, username, display_name, avatar_url, bio").or(`username.ilike.%${u}%,display_name.ilike.%${u}%`).limit(20);if(n.error)throw new Error(n.error.message);const x=n.data??[],o=x.map(l=>l.id);let m=new Map;if(o.length){const l=await I.from("user_stats").select("user_id, followers_count, following_count").in("user_id",o);l.error?console.warn("[useSearchPeople] Failed to load user_stats",l.error.message):m=new Map((l.data??[]).map(p=>[p.user_id,{followersCount:p.followers_count??0,followingCount:p.following_count??0}]))}if(!(d!=null&&d.id))return x.map(l=>{const p=m.get(l.id);return{id:l.id,username:l.username,displayName:l.display_name,avatarUrl:l.avatar_url,bio:l.bio,followersCount:(p==null?void 0:p.followersCount)??null,followingCount:(p==null?void 0:p.followingCount)??null,isFollowing:!1}});const b=await I.from("follows").select("followed_id").eq("follower_id",d.id);b.error&&console.warn("[useSearchPeople] Failed to load follows for current user",b.error.message);const f=new Set((b.data??[]).map(l=>l.followed_id));return x.map(l=>{const p=m.get(l.id);return{id:l.id,username:l.username,displayName:l.display_name,avatarUrl:l.avatar_url,bio:l.bio,followersCount:(p==null?void 0:p.followersCount)??null,followingCount:(p==null?void 0:p.followingCount)??null,isFollowing:f.has(l.id)}})}})},Te=({query:t})=>{const a=t.trim(),{data:d,isLoading:u,isError:n,error:x}=Ie(a),o=ce(),m=ae(),{user:b}=W(),[f,l]=v.useState(null),p=d??[],c=async s=>{if(!(b!=null&&b.id)){alert("You need to be signed in to start a conversation.");return}if(b.id===s){alert("You can't start a conversation with yourself.");return}l(s);try{const g=await Q("create-direct-conversation",{targetUserId:s},{timeoutMs:25e3});if(!(g!=null&&g.ok)||!g.conversationId){const i=g==null?void 0:g.errorCode;let h=(g==null?void 0:g.error)??"Failed to get conversation id. Please try again.";i==="UNAUTHORIZED"?h="You need to be signed in to start a conversation.":i==="BAD_REQUEST_SELF_TARGET"?h="You can't start a conversation with yourself.":i==="SERVER_MISCONFIGURED"&&(h="Messaging is temporarily unavailable due to a server issue. Please try again later.");const y=new Error(h);throw y.code=i,y}m(`/messages/${g.conversationId}`)}catch(g){console.error("[SearchPeopleTab] Failed to start conversation",g);const i=g instanceof Error?g.message:"Something went wrong while starting the conversation. Please try again.";alert(i)}finally{l(null)}};return a?u?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-mn-text-secondary",children:"Searching for people…"}),e.jsx("div",{className:"rounded-mn-card border border-mn-border-subtle bg-mn-bg-elevated/80 px-3 py-4 text-[11px] text-mn-text-muted",children:"We'll show matching profiles here as soon as the results come back."})]}):n?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-mn-text-primary",children:"Something went wrong."}),e.jsx("p",{className:"text-[11px] text-mn-text-muted",children:(x==null?void 0:x.message)??"We couldn&apos;t search for people right now. Please try again."})]}):!p||p.length===0?e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{className:"text-[12px] text-mn-text-secondary",children:["No people found for"," ",e.jsxs("span",{className:"rounded border border-mn-border-subtle bg-mn-bg-elevated px-1.5 py-0.5 text-[11px] font-medium text-mn-text-primary",children:["“",a,"”"]}),". Try a different name or username."]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("p",{className:"text-[11px] text-mn-text-secondary",children:["Showing ",p.length," profile",p.length===1?"":"s"," for"," ",e.jsxs("span",{className:"rounded border border-mn-border-subtle bg-mn-bg-elevated px-1.5 py-0.5 text-[11px] font-medium text-mn-text-primary",children:["“",a,"”"]})]})}),e.jsx("ul",{className:"divide-y divide-mn-border-subtle/60 rounded-mn-card border border-mn-border-subtle bg-mn-bg-elevated/80",children:p.map(s=>{var h;const g=s.displayName??s.username??"Unknown user",i=s.username?`@${s.username}`:null;return e.jsxs("li",{className:"flex items-center justify-between gap-3 px-3 py-2 hover:bg-mn-bg-elevated/80",children:[e.jsxs(H,{to:s.username?`/u/${s.username}`:`/u/${s.id}`,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-mn-bg-elevated/80 text-[14px] font-semibold text-mn-text-primary",children:s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:g,className:"h-8 w-8 rounded-full object-cover",loading:"lazy"}):g?(h=g[0])==null?void 0:h.toUpperCase():e.jsx(be,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-[13px] font-medium text-mn-text-primary",children:g}),i&&e.jsx("p",{className:"mt-0.5 text-[11px] text-mn-text-muted",children:i}),s.bio&&e.jsx("p",{className:"mt-0.5 line-clamp-2 text-[11px] text-mn-text-secondary",children:s.bio}),(typeof s.followersCount=="number"||typeof s.followingCount=="number")&&e.jsxs("p",{className:"mt-0.5 text-[10px] text-mn-text-muted",children:[typeof s.followersCount=="number"&&e.jsxs("span",{children:[s.followersCount," follower",s.followersCount===1?"":"s"]}),typeof s.followersCount=="number"&&typeof s.followingCount=="number"&&e.jsx("span",{children:" · "}),typeof s.followingCount=="number"&&e.jsxs("span",{children:["following ",s.followingCount]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{type:"button",onClick:()=>o.mutate({targetUserId:s.id,currentlyFollowing:s.isFollowing}),disabled:o.isPending,variant:s.isFollowing?"outline":"default",size:"sm",className:`h-auto rounded-full px-2.5 py-1.5 text-[10px] font-medium ${s.isFollowing?"border-mn-border-subtle/80 bg-mn-bg-elevated/80 text-mn-text-primary hover:border-mn-primary/70 hover:text-mn-text-primary disabled:opacity-60":"border border-transparent bg-mn-primary text-mn-bg hover:bg-mn-primary/90 disabled:opacity-60"}`,children:s.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}),(b==null?void 0:b.id)!==s.id&&e.jsx(N,{type:"button",onClick:()=>c(s.id),disabled:f===s.id,variant:"outline",size:"sm",className:"h-auto rounded-full border-mn-border-subtle/80 bg-mn-bg-elevated/80 px-2.5 py-1.5 text-[10px] font-medium text-mn-text-primary shadow-mn-soft hover:border-mn-primary/70 hover:text-mn-text-primary disabled:cursor-not-allowed disabled:opacity-60",children:f===s.id?e.jsx("span",{children:"Starting…"}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Message"})]})})]})]},s.id)})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-mn-text-secondary",children:"Start typing a name or @username to find people. Once the social graph is wired up, you'll be able to follow friends and start conversations from here."}),e.jsxs("div",{className:"flex items-center gap-2 rounded-mn-card border border-dashed border-mn-border-subtle bg-mn-bg-elevated/60 px-3 py-2 text-[11px] text-mn-text-muted",children:[e.jsx(pe,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Search for people you know, then follow or message them."})]})]})},Ce=["all","movie","series","anime"],B=t=>t.get("tab")==="people"?"people":"titles",C=t=>{if(typeof t!="number")return;const a=new Date().getFullYear();return Math.min(Math.max(t,1900),a)},D=t=>{const a=t.get("type"),d=Ce.includes(a)?a:"all",u=m=>{if(!m)return;const b=Number(m);return Number.isFinite(b)?b:void 0},n=C(u(t.get("minYear"))),x=C(u(t.get("maxYear"))),o=t.get("lang")||void 0;return n&&x&&n>x?{type:d,minYear:x,maxYear:n,originalLanguage:o}:{type:d,minYear:n,maxYear:x,originalLanguage:o}},ke=(t,a)=>t.type===a.type&&t.minYear===a.minYear&&t.maxYear===a.maxYear&&t.originalLanguage===a.originalLanguage,Oe=()=>{const[t,a]=se(),d=B(t),u=t.get("q")??"",n=v.useMemo(()=>D(t),[t]),[x,o]=v.useState(d),[m,b]=v.useState(!1),[f,l]=v.useState(u),p=ye(f,300),[c,s]=v.useState(n);v.useEffect(()=>{x!=="titles"&&b(!1)},[x]),v.useEffect(()=>{!p.trim()&&m&&b(!1)},[p,m]);const g=v.useMemo(()=>{const r=new URLSearchParams(t);return r.set("tab",x),f.trim()?r.set("q",f.trim()):r.delete("q"),x==="titles"&&f.trim()?(r.set("type",c.type??"all"),c.minYear?r.set("minYear",String(c.minYear)):r.delete("minYear"),c.maxYear?r.set("maxYear",String(c.maxYear)):r.delete("maxYear"),c.originalLanguage?r.set("lang",c.originalLanguage):r.delete("lang")):(r.delete("type"),r.delete("minYear"),r.delete("maxYear"),r.delete("lang")),r},[x,f,t,c]);v.useEffect(()=>{g.toString()!==t.toString()&&a(g,{replace:!0})},[g,t,a]),v.useEffect(()=>{const r=B(t),w=t.get("q")??"",_=D(t);o(r),l(w),s($=>ke($,_)?$:_)},[t]),v.useEffect(()=>{const r=C(c.minYear),w=C(c.maxYear);if(r&&w&&r>w){s(_=>({..._,minYear:w,maxYear:r}));return}(r!==c.minYear||w!==c.maxYear)&&s(_=>({..._,minYear:r,maxYear:w}))},[c.maxYear,c.minYear]);const i=()=>{l(""),b(!1)},h=v.useCallback(r=>{s(w=>({...w,...r}))},[]),y=()=>{s({type:"all",minYear:void 0,maxYear:void 0,originalLanguage:void 0}),b(!1)},j=v.useMemo(()=>{const r=[];if(c.type&&c.type!=="all"&&r.push({label:`Type: ${c.type.charAt(0).toUpperCase()}${c.type.slice(1)}`,onRemove:()=>h({type:"all"})}),c.minYear||c.maxYear){const w=c.minYear??"Any",_=c.maxYear??"Now";r.push({label:`Year: ${w} – ${_}`,onRemove:()=>h({minYear:void 0,maxYear:void 0})})}return c.originalLanguage&&r.push({label:`Language: ${c.originalLanguage.toUpperCase()}`,onRemove:()=>h({originalLanguage:void 0})}),r},[c,h]),S=j.length,L=S>0?`Filters (${S} active)`:"Filters (none applied)",F=x==="titles"&&(!!f.trim()||S>0),P=F?L:"Filters are locked until you start typing a title",J=r=>{r.preventDefault()};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-2 pt-1",children:[e.jsx(oe,{title:"Search without the clutter",subtitle:"Find titles, filmmakers, or friends instantly. Switch tabs to move between movies and people."}),e.jsxs(ie,{tone:"default",padded:!0,children:[e.jsxs("form",{onSubmit:J,className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 rounded-full border border-mn-border-subtle bg-mn-bg px-3 py-2 text-[13px] shadow-mn-soft focus-within:border-mn-primary/70",children:[e.jsx(ne,{className:"h-3.5 w-3.5 text-mn-text-muted","aria-hidden":"true"}),e.jsx(Y,{type:"search",value:f,onChange:r=>l(r.target.value),placeholder:"Search for movies, shows, or people...",className:"h-8 flex-1 border-none bg-transparent p-0 text-[13px] text-mn-text-primary shadow-none outline-none ring-0 placeholder:text-mn-text-muted focus-visible:ring-0",autoCorrect:"off",autoCapitalize:"none"}),f?e.jsx(N,{type:"button",onClick:i,variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full text-[10px] text-mn-text-muted hover:bg-mn-border-subtle/60 hover:text-mn-text-primary","aria-label":"Clear search",children:e.jsx(E,{className:"h-3 w-3","aria-hidden":"true"})}):null]}),e.jsxs(N,{type:"button",onClick:()=>{F&&b(r=>!r)},variant:"outline",size:"sm",className:`inline-flex items-center justify-center gap-1 rounded-full px-3 py-2 text-[11px] font-medium shadow-mn-soft ${F?"border-mn-border-subtle bg-mn-bg text-mn-text-secondary hover:border-mn-primary/70 hover:text-mn-text-primary":"cursor-not-allowed border-mn-border-subtle/60 bg-mn-bg/70 text-mn-text-muted"} ${m?"border-mn-primary/70 text-mn-text-primary":""}`,disabled:!F,"aria-pressed":F&&m,"aria-expanded":F&&m,"aria-controls":"search-title-filters","aria-label":P,title:P,children:[e.jsx(R,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:m?"Hide filters":"Filters"}),S>0?e.jsx("span",{className:"inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-mn-primary/15 px-1 text-[10px] font-semibold text-mn-primary",children:S}):null]}),F?e.jsxs("span",{className:"sr-only","aria-live":"polite",children:["Filters are available. ",L]}):e.jsx("span",{className:"text-[10px] text-mn-text-muted sm:ml-1 sm:inline","aria-live":"polite",children:"Start typing to enable title filters."})]}),x==="titles"&&e.jsx("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[11px] text-mn-text-secondary",children:j.length?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg-elevated/60 px-2 py-1 text-[10px] font-semibold uppercase tracking-wide text-mn-text-muted",children:"Active filters"}),j.map(r=>e.jsxs(N,{type:"button",onClick:r.onRemove,variant:"outline",size:"sm",className:"h-auto rounded-full border-mn-border-subtle bg-mn-bg px-2 py-1 text-[11px] text-mn-text-primary shadow-sm hover:border-mn-primary/70 hover:text-mn-text-primary",children:[e.jsx("span",{children:r.label}),e.jsx(E,{className:"h-3 w-3 text-mn-text-muted","aria-hidden":!0})]},r.label)),e.jsx(N,{type:"button",onClick:y,variant:"ghost",size:"sm",className:"h-auto rounded-full bg-mn-primary/10 px-3 py-1 text-[10px] font-semibold uppercase tracking-wide text-mn-primary hover:bg-mn-primary/15",children:"Reset all"})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg-elevated/50 px-2.5 py-1 text-[10px] font-medium text-mn-text-muted",children:[e.jsx(U,{className:"h-3 w-3","aria-hidden":!0}),"No filters applied"]})}),x==="titles"&&m&&e.jsxs("div",{id:"search-title-filters",className:"mt-3 space-y-3 rounded-xl border border-dashed border-mn-border-subtle/80 bg-mn-bg/70 p-3 text-[11px] text-mn-text-secondary",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-medium text-mn-text-primary",children:[e.jsx(U,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Filter titles"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-[1.4fr_1fr_1fr]",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.16em] text-mn-text-muted",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{key:"all",label:"All"},{key:"movie",label:"Movies"},{key:"series",label:"Series"},{key:"anime",label:"Anime"}].map(r=>{const w=c.type===r.key;return e.jsx(N,{type:"button",variant:w?"default":"outline",size:"sm",className:`h-auto rounded-full px-2.5 py-1 text-[10px] font-medium ${w?"bg-mn-primary text-mn-bg shadow-mn-soft":"border-mn-border-subtle bg-mn-bg/80 text-mn-text-secondary hover:border-mn-primary/60 hover:text-mn-text-primary"}`,onClick:()=>h({type:r.key}),"aria-pressed":w,children:r.label},r.key)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.16em] text-mn-text-muted",children:"Years"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsx(Y,{type:"number",min:1900,max:new Date().getFullYear(),value:c.minYear??"",onChange:r=>h({minYear:r.target.value?Number(r.target.value):void 0}),placeholder:"Min",className:"h-9 w-full border-mn-border-subtle bg-mn-bg px-2 py-1.5 text-[11px] text-mn-text-primary shadow-sm","aria-label":"Minimum year"}),e.jsx(Y,{type:"number",min:1900,max:new Date().getFullYear(),value:c.maxYear??"",onChange:r=>h({maxYear:r.target.value?Number(r.target.value):void 0}),placeholder:"Max",className:"h-9 w-full border-mn-border-subtle bg-mn-bg px-2 py-1.5 text-[11px] text-mn-text-primary shadow-sm","aria-label":"Maximum year"})]}),e.jsx("p",{className:"text-[10px] text-mn-text-muted",children:"Use a minimum, maximum, or both."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.16em] text-mn-text-muted",children:"Original language"}),e.jsxs("div",{className:"flex items-center gap-1.5 rounded-md border border-mn-border-subtle bg-mn-bg px-2 py-1.5 shadow-sm",children:[e.jsx(he,{className:"h-3.5 w-3.5 text-mn-text-muted","aria-hidden":"true"}),e.jsx(Y,{type:"text",value:c.originalLanguage??"",onChange:r=>h({originalLanguage:r.target.value||void 0}),placeholder:"e.g. en, ja",className:"h-8 w-full border-none bg-transparent p-0 text-[11px] text-mn-text-primary shadow-none placeholder:text-mn-text-muted focus-visible:ring-0"})]}),e.jsx("p",{className:"text-[10px] text-mn-text-muted",children:"Two-letter codes keep things simple."})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"flex items-center gap-1 text-[10px] text-mn-text-muted",children:[e.jsx("span",{className:"inline-flex h-1.5 w-1.5 rounded-full bg-mn-primary/80"}),"Filters shape the recommendations shown below."]}),e.jsx(N,{type:"button",variant:"link",size:"sm",className:"h-auto p-0 text-[10px] font-semibold text-mn-text-primary hover:text-mn-primary",onClick:y,children:"Reset filters"})]})]})]}),e.jsx("section",{className:"flex flex-1 flex-col gap-3",children:e.jsxs(ge,{value:x,onValueChange:r=>o(r),children:[e.jsxs(fe,{className:"inline-flex items-center gap-1 rounded-full border border-mn-border-subtle bg-mn-bg-elevated/80 p-1 text-[11px] shadow-mn-soft",children:[e.jsx(A,{value:"titles",children:"Titles"}),e.jsx(A,{value:"people",children:"People"})]}),e.jsxs("div",{"aria-live":"polite",className:"flex-1 rounded-mn-card border border-dashed border-mn-border-subtle/80 bg-mn-bg-elevated/60 px-3 py-3 text-[12px] text-mn-text-secondary",children:[e.jsx(q,{value:"titles",children:e.jsx(Ye,{query:p,filters:c,onResetFilters:y})}),e.jsx(q,{value:"people",children:e.jsx(Te,{query:p})})]})]})})]})};export{Oe as default};
