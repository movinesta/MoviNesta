import{C as H,b as Ie,e as $e,c as bt,w as ue,s as M,aC as V,aq as J,r as f,an as le,N as yt,ax as wt,R as D,j as o,i as ge,F as vt,al as Y,ag as St,B as jt,au as Ct,aD as Nt,E as kt,O as Et,P as W,_ as te,U as L,W as $,aE as Pt}from"./index-DuL1-P9A.js";import{u as At,C as _t}from"./conversationsCache-B1vzQYCS.js";import{a as Rt,b as Tt}from"./format-BXv9LLlt.js";import{D as Le,a as Fe,f as Mt,b as Dt,c as It,d as $t}from"./dialog-ClweDY8b.js";import{P as Lt}from"./plus-BSK9vxg7.js";import{X as Ft}from"./x-C4D7SPeX.js";import{C as Ot}from"./copy-x_fNLkwl.js";import{C as Ut}from"./circle-alert-DvC6vhnp.js";import{u as Bt}from"./index-CCS_L2cZ.js";const Ht=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Ee=H("check-check",Ht);const Wt=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],zt=H("external-link",Wt);const Yt=[["path",{d:"M5 12h14",key:"1ays0h"}]],Vt=H("minus",Yt);const Xt=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],qt=H("pen-line",Xt);const Gt=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Qt=H("rotate-ccw",Gt);const Kt=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Jt=H("trash-2",Kt);async function Oe(e,t,r){const{data:s,error:n}=await e.from("blocked_users").select("blocker_id, blocked_id").or(`and(blocker_id.eq.${t},blocked_id.eq.${r}),and(blocker_id.eq.${r},blocked_id.eq.${t})`);if(n)throw n;const a=s??[],c=a.some(i=>i.blocker_id===t&&i.blocked_id===r),l=a.some(i=>i.blocker_id===r&&i.blocked_id===t);return{youBlocked:c,blockedYou:l}}const ln=e=>{const{user:t}=Ie(),r=t?.id??null,s=$e(),n=["block-status",r,e],a=bt({queryKey:n,enabled:!!(r&&e&&r!==e),staleTime:3e4,queryFn:async()=>{if(!r||!e||r===e)return{youBlocked:!1,blockedYou:!1};try{return await Oe(M,r,e)}catch(p){console.error("[useBlockStatus] Failed to load block status",p);const h=p;throw new Error(h.message??"Failed to load block status")}}}),c=ue({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for block operation.");const{error:p}=await M.from("blocked_users").upsert({blocker_id:r,blocked_id:e,created_at:new Date().toISOString()},{onConflict:"blocker_id,blocked_id"});if(p)throw console.error("[useBlockStatus] Failed to block user",p),new Error(p.message)},onSuccess:()=>{s.invalidateQueries({queryKey:n})}}),l=ue({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for unblock operation.");const{error:p}=await M.from("blocked_users").delete().eq("blocker_id",r).eq("blocked_id",e);if(p)throw console.error("[useBlockStatus] Failed to unblock user",p),new Error(p.message)},onSuccess:()=>{s.invalidateQueries({queryKey:n})}}),i=a.data?.youBlocked??!1,d=a.data?.blockedYou??!1,u=i||d,m=c.isPending||l.isPending;return{youBlocked:i,blockedYou:d,isBlocked:u,isLoading:a.isLoading||m,isError:a.isError,error:a.error??null,block:c,unblock:l}},Zt=({isSelf:e,isDeleted:t})=>({bubbleColors:t?"bg-muted text-muted-foreground border border-dashed border-border":e?"bg-primary text-white shadow-[0_0_20px_-6px_rgba(127,19,236,0.5)]":"bg-card text-foreground border border-border/60",bubbleShape:e?"rounded-2xl rounded-tr-sm":"rounded-2xl rounded-tl-sm"}),ie=e=>{const t=new Date(e);return Number.isNaN(t.getTime())?"":Tt(t,{hour:"numeric",minute:"2-digit",hour12:!0})},fe=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),er=e=>{const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const r=new Date,s=new Date;return s.setDate(r.getDate()-1),fe(t,r)?"Today":fe(t,s)?"Yesterday":Rt(t,{day:"numeric",month:"short",year:"numeric"})},Pe=(e,t,r=180*1e3)=>{const s=new Date(e),n=new Date(t);return Number.isNaN(s.getTime())||Number.isNaN(n.getTime())?!1:n.getTime()-s.getTime()<=r},tr=e=>({id:e.id,conversationId:e.conversation_id,senderId:e.user_id,body:e.body??null,attachmentUrl:e.attachment_url??null,createdAt:e.created_at??new Date().toISOString(),text:e.text??null,clientId:e.client_id??null,meta:e.meta??null}),cn=e=>({userId:e.user_id,lastReadAt:e.last_read_at??null,lastReadMessageId:e.last_read_message_id??null}),dn=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,deliveredAt:e.delivered_at??e.created_at??new Date().toISOString()}),un=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,emoji:e.emoji,createdAt:e.created_at}),re="temp-",G=e=>e.startsWith(re),rr=e=>G(e)?e:`${re}${e}`,fn=(e=Date.now())=>`${re}${e}`,nr=(e=Date.now())=>`${re}${e}-${Math.random().toString(36).slice(2,8)}`,mn=(e,t={})=>{const{dedupe:r=!0,excludeTemp:s=!1,sort:n=!1}=t,a=e.filter(l=>typeof l=="string").map(l=>l.trim()).filter(Boolean).filter(l=>s?!G(l):!0),c=r?Array.from(new Set(a)):a;return n&&c.sort(),c},Ae=()=>({pages:[{items:[],hasMore:!0,cursor:null}],pageParams:[null]}),Ue=e=>[...e].sort((t,r)=>{const s=J(t.createdAt),n=J(r.createdAt);return s!==n?s-n:t.id.localeCompare(r.id)}),X=e=>{const t=new Map;for(const a of e)t.set(a.id,a);const r=new Map,s=[];for(const a of t.values()){const c=a.clientId??V(a.body);if(!c){s.push(a);continue}const l=r.get(c);l?l.push(a):r.set(c,[a])}const n=[...s];for(const a of r.values()){if(a.length<=1){n.push(...a);continue}const c=a.filter(i=>!G(i.id));if(c.length>0){n.push(...c);continue}const l=a.reduce((i,d)=>{if(!i)return d;const u=J(i.createdAt),m=J(d.createdAt);return m!==u?m>u?d:i:d.id.localeCompare(i.id)>0?d:i},null);l&&n.push(l)}return Ue(n)},I=e=>!e||!Array.isArray(e.pages)||!Array.isArray(e.pageParams)?Ae():e,sr=e=>e.length?{createdAt:e[0].createdAt,id:e[0].id}:null,Q=e=>{const t=(e.pages??[]).map(r=>({...r,items:Array.isArray(r.items)?[...r.items]:[]}));return t.length>0?t:[{items:[],hasMore:!0,cursor:null}]},_e=(e,t)=>{const r=I(e),s=Q(r),n=s[s.length-1],a=new Map;for(const c of n.items??[])a.set(c.id,c);return a.set(t.id,t),n.items=X(Array.from(a.values())),{...r,pages:s}},hn=(e,t)=>{const r=I(e),s=Q(r).map(n=>({...n,items:(n.items??[]).map(a=>a.id===t.id?t:a)}));return{...r,pages:s}},pn=(e,t)=>{const r=I(e),s=Q(r).map(n=>({...n,items:(n.items??[]).filter(a=>a.id!==t)}));return{...r,pages:s}},or=(e,t)=>{const r=I(e),s=Q(r),n=t.tempId??null,a=t.row,c=a.clientId??V(a.body);if(n)for(const i of s)i.items=(i.items??[]).filter(d=>d.id!==n);if(c)for(const i of s)i.items=(i.items??[]).filter(d=>!(G(d.id)&&V(d.body)===c));let l=!1;for(const i of s){const d=(i.items??[]).findIndex(u=>u.id===a.id);if(d>=0){i.items[d]=a,i.items=X(i.items),l=!0;break}}if(!l){const i=s[s.length-1];i.items=X([...i.items??[],a])}return{...r,pages:s}},gn=(e,t)=>{const r=I(e),s=I(t),n=g=>{if(g==null)return"initial";if(typeof g=="string")return`s:${g}`;if(typeof g=="number")return`n:${g}`;if(typeof g=="boolean")return`b:${g}`;if(typeof g=="object")try{return`o:${JSON.stringify(g)}`}catch{return"o:[unserializable]"}return`u:${String(g)}`},a=new Map,c=r.pageParams??[];for(const[g,x]of r.pages.entries()){const w=c[g];a.set(n(w),x)}const l=new Map,i=s.pageParams??[];for(const[g,x]of s.pages.entries()){const w=i[g];l.set(n(w),x)}const d=[],u=[],m=(s.pages.length>=r.pages.length?i:c)??[],p=new Set;for(const g of m){const x=n(g);if(p.has(x))continue;p.add(x);const w=a.get(x),b=l.get(x);if(!w&&!b)continue;if(!w){d.push(b),u.push(g);continue}if(!b){w&&(d.push(w),u.push(g));continue}const v=new Map;for(const j of w.items??[])v.set(j.id,j);for(const j of b.items??[])v.set(j.id,j);const N=X(Array.from(v.values()));d.push({...b,items:N,cursor:sr(N),hasMore:b.hasMore??w.hasMore??!0}),u.push(g)}const h=(g,x)=>{for(const w of g){const b=n(w);if(p.has(b))continue;const v=x.get(b);v&&(p.add(b),d.push(v),u.push(w))}};return h(i,l),h(c,a),{...s,pages:d.length>0?d:[{items:[],hasMore:!0,cursor:null}],pageParams:u.length>0?u:s.pageParams??r.pageParams}},xn=(e,t,r)=>{const s=r?.allowAppend??!0,n=tr(t),a=n.clientId??V(n.body),c=I(e),l=Q(c);if(a)for(const i of l){const d=(i.items??[]).findIndex(u=>G(u.id)&&V(u.body)===a);if(d>=0){i.items.splice(d,1);break}}for(const i of l){const d=(i.items??[]).findIndex(u=>u.id===n.id);if(d>=0)return i.items[d]=n,i.items=Ue(i.items),{...c,pages:l}}if(s){const i=l[l.length-1];i.items=X([...i.items??[],n])}return{...c,pages:l}},ar="id, conversation_id, user_id, body, message_type, text, client_id, meta, attachment_url, created_at",U="chat-media",me=(e=()=>`${Date.now()}-${Math.random().toString(36).slice(2,10)}`)=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():e(),he=new Map,Be=()=>Date.now(),He=e=>{if(!e)return null;const t=he.get(e);return t?t.expiresAt<=Be()?(he.delete(e),null):t.url:null},lr=(e,t,r)=>{if(!e||!t)return;const n=Math.max(0,r*1e3-6e4);he.set(e,{url:t,expiresAt:Be()+n})},xe=3600,q=e=>/^https?:\/\//i.test(e),We=(e,t)=>t&&M.storage.from(e).getPublicUrl(t).data.publicUrl||null,ze=async(e,t,r=xe)=>{if(!t)return null;const{data:s,error:n}=await M.storage.from(e).createSignedUrl(t,r);return n||!s?.signedUrl?null:(lr(`${e}:${t}`,s.signedUrl,r),s.signedUrl)};async function Re(e,t,r){if(!t)return null;if(q(t))return r?.allowHttp?t:null;const s=r?.ttlSeconds??xe,n=r?.allowPublicFallback??!1;if(!(r?.forceRefresh??!1)){const c=He(`${e}:${t}`);if(c)return c}try{const c=await ze(e,t,s);if(c)return c}catch{}if(!n)return null;try{return We(e,t)}catch{return null}}async function ir(e,t,r=xe){if(t&&!q(t)&&!He(`${e}:${t}`))try{await ze(e,t,r)}catch{}}const Te=async e=>{if(!e||q(e))return;const{error:t}=await M.storage.from(U).remove([e]);if(t)throw t},cr=10*1024*1024,pe={"image/jpg":"jpg","image/jpeg":"jpg","image/pjpeg":"jpg","image/png":"png","image/webp":"webp","image/gif":"gif","image/avif":"avif","image/heic":"heic","image/heif":"heif"},dr=new Set(Object.keys(pe)),Ye=e=>{if(e.type&&pe[e.type])return pe[e.type];const t=e.name.split(".").pop()?.toLowerCase()??null;return t?t==="jpeg"?"jpg":["jpg","png","webp","gif","avif","heic","heif"].includes(t)?t:null:null},ur=e=>{if(e.type){if(!e.type.startsWith("image/"))return{ok:!1,error:"Please choose an image file."};if(!dr.has(e.type))return{ok:!1,error:"Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image."}}else if(!Ye(e))return{ok:!1,error:"Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image."};return e.size>cr?{ok:!1,error:"That image is too large (max 10MB). Try a smaller file."}:{ok:!0}},fr=(e,t,r)=>{const s=me(()=>String(Date.now()));return`message_attachments/${e}/${t}/${Date.now()}-${s}.${r}`};function bn(e){const{conversationId:t,userId:r,isBlocked:s,blockedYou:n,attemptSend:a}=e,[c,l]=f.useState(null),[i,d]=f.useState(!1),u=f.useRef(0),m=f.useRef(null),p=f.useCallback(()=>l(null),[]),h=f.useCallback(()=>{u.current+=1,d(!1)},[]),g=f.useCallback(()=>{!t||!r||s||n||m.current?.click()},[n,t,s,r]),x=f.useCallback(async b=>{if(!t||!r||s||n)return;l(null);const v=ur(b);if(!v.ok){l(v.error);return}const N=u.current+=1;d(!0);const j=Ye(b);if(!j){l("Unsupported image format."),d(!1);return}const C=fr(t,r,j);try{const{error:k}=await M.storage.from(U).upload(C,b,{cacheControl:"3600",upsert:!1});if(N!==u.current){try{await Te(C)}catch{}return}if(k){console.error("[useAttachmentUpload] image upload error",k),l("Upload failed. Please try another image.");return}if(ir(U,C),N!==u.current){try{await Te(C)}catch{}return}a({text:"",attachmentPath:C})}catch(k){console.error("[useAttachmentUpload] sendImageFile failed",k),l("Something went wrong while sending your image.")}finally{N===u.current&&d(!1)}},[a,n,t,s,r]),w=f.useCallback(async b=>{const v=b.target.files?.[0];b.target.value="",!(!v||!t||!r)&&(i||s||n||await x(v))},[n,t,s,i,x,r]);return{fileInputRef:m,openFilePicker:g,handleImageSelected:w,sendImageFile:x,isUploadingImage:i,uploadError:c,clearUploadError:p,cancelImageUpload:h}}const mr=e=>{if(!e)return"Unknown error.";if(typeof e=="string")return e;const t=e,r=t.message??(e instanceof Error?e.message:typeof e=="object"?JSON.stringify(e):String(e)),s=t.code?` (${t.code})`:"",n=t.details?` â€” ${t.details}`:"",a=t.hint?` Hint: ${t.hint}`:"";return`${r}${s}${n}${a}`.trim()},Me=(e,t,r)=>{const s=e.trim();return!t&&!s?{payload:null,trimmed:s}:t&&s?{payload:{type:"text+image",text:s,clientId:r},trimmed:s}:t?{payload:{type:"image",text:"",clientId:r},trimmed:s}:{payload:{type:"text",text:s,clientId:r},trimmed:s}},yn=(e,t)=>{const{user:r}=Ie(),s=r?.id??null,n=$e();return ue({mutationFn:async({text:a,attachmentPath:c,clientId:l})=>{if(!e)throw new Error("Missing conversation id.");if(!s)throw new Error("You must be signed in to send messages.");if(t?.otherUserId){const h=await Oe(M,s,t.otherUserId);if(h.youBlocked)throw new Error("You have blocked this user. Unblock them to send messages.");if(h.blockedYou)throw new Error("You cannot send messages because this user blocked you.")}const i=l??me(),{payload:d}=Me(a,c??null,i);if(!d)throw new Error("Cannot send an empty message.");const{data:u,error:m}=await M.from("messages").insert({conversation_id:e,user_id:s,sender_id:s,body:d,message_type:d.type,text:d.text??null,client_id:d.clientId??null,meta:d,attachment_url:c??null}).select(ar).single();if(m)throw console.error("[useSendMessage] Failed to send message",m),new Error(mr(m));if(!u)throw new Error("Failed to send message.");if(u.conversation_id!==e||u.user_id!==s)throw new Error("Unexpected message response.");return{id:u.id,conversationId:u.conversation_id,senderId:u.user_id,body:u.body??null,attachmentUrl:u.attachment_url??null,createdAt:u.created_at,meta:u.meta??null}},onMutate:async a=>{if(!e||!s)return{previous:void 0,tempId:null};const{text:c,attachmentPath:l}=a,i=a.clientId??me();a.clientId=i;const{payload:d,trimmed:u}=Me(c,l??null,i);if(!d)throw new Error("Cannot send an empty message.");const m=a.tempId,p=typeof m=="string"&&m.length?rr(m):nr(),h=le(e),g=n.getQueryData(h),x=g?.pages?.[g.pages.length-1]?.items,w=x&&x.length?x[x.length-1]?.createdAt:null,b=w?new Date(w).getTime():NaN,v=Number.isFinite(b),N=v?b:Date.now(),j=new Date(N+1).toISOString(),C={id:p,conversationId:e,senderId:s,body:d,attachmentUrl:l??null,createdAt:j,meta:d};await n.cancelQueries({queryKey:h});const k=n.getQueryData(h);return n.setQueryData(h,_=>_e(_,C)),{previous:k,tempId:p,optimistic:C,usedServerAnchor:v,payload:{text:u,attachmentPath:l??null,clientId:i}}},onError:(a,c,l)=>{if(console.error("[useSendMessage] sendMessage error",a),!e)return;const{previous:i,optimistic:d,payload:u,tempId:m}=l??{previous:void 0,tempId:null},p=le(e);n.setQueryData(p,h=>d?_e(i??h,d):I(i??h)),m&&u&&t?.onFailed&&t.onFailed(m,u,a)},onSuccess:(a,c,l)=>{if(!e)return;const i=l?.tempId,d=le(e),u=l?.optimistic?.createdAt??null;if(u&&l?.usedServerAnchor){const m=new Date(a.createdAt).getTime(),p=new Date(u).getTime();Number.isFinite(m)&&Number.isFinite(p)&&m<p&&(a={...a,createdAt:u})}n.setQueryData(d,m=>or(m,{tempId:i,row:a})),At(n,s,e,m=>({...m,lastMessagePreview:wt(a.body)??m.lastMessagePreview,lastMessageAt:a.createdAt??m.lastMessageAt,lastMessageAtLabel:yt(a.createdAt??null),hasUnread:!1,lastMessageIsFromSelf:!0,lastMessageSeenByOthers:!1}),{moveToTop:!0}),t?.onRecovered&&t.onRecovered(l?.tempId??null)}})};async function Ve(e){if(!e)return!1;try{if(typeof navigator<"u"&&navigator.clipboard?.writeText)return await navigator.clipboard.writeText(e),!0}catch{}try{if(typeof document>"u")return!1;const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.top="-9999px",t.style.left="-9999px",document.body.appendChild(t),t.select(),t.setSelectionRange(0,t.value.length);const r=document.execCommand("copy");return document.body.removeChild(t),r}catch{return!1}}const hr=D.memo(function({isSelf:t,isDeleted:r,children:s,className:n="",role:a,tabIndex:c,...l}){const{bubbleColors:i,bubbleShape:d}=Zt({isSelf:t,isDeleted:r});return o.jsx("div",{role:a??"button",tabIndex:c??0,className:ge("inline-flex max-w-[85%] px-5 py-3 text-[15px] leading-relaxed transition-transform duration-150 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",d,i,n),...l,children:o.jsx("div",{className:"flex flex-col gap-1 text-left leading-relaxed",children:s})})}),pr=/((?:https?:\/\/|www\.)[^\s<]+[^<.,:;"')\]\s])/gi,gr=/([A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,})/gi,xr=/(\+?\d[\d\s().-]{7,}\d)/g,br=e=>/^https?:\/\//i.test(e)?e:/^www\./i.test(e)?`https://${e}`:e,Xe=e=>e.replace(/\D/g,""),yr=e=>{const t=e.trim(),r=t.startsWith("+"),s=Xe(t);return`${r?"+":""}${s}`};function wr(e,t){const r=t.trim();if(!r)return[{text:e,match:!1}];const s=e.toLowerCase(),n=r.toLowerCase(),a=[];let c=0;for(;c<e.length;){const l=s.indexOf(n,c);if(l<0){a.push({text:e.slice(c),match:!1});break}l>c&&a.push({text:e.slice(c,l),match:!1}),a.push({text:e.slice(l,l+r.length),match:!0}),c=l+r.length}return a.length?a:[{text:e,match:!1}]}function z(e,t){const r=(t??"").trim();return r?wr(e,r).map((s,n)=>s.match?o.jsx("mark",{className:"rounded bg-primary/20 px-0.5 text-foreground",children:s.text},`${n}-${s.text}`):o.jsx(D.Fragment,{children:s.text},`${n}-${s.text}`)):e}const vr=({text:e,highlight:t})=>{const r=l=>{l.stopPropagation()},s=[],n=(l,i)=>{const d=new RegExp(l);let u;for(;(u=d.exec(e))!==null;)s.push({start:u.index,end:u.index+u[0].length,kind:i,raw:u[0]})};n(pr,"url"),n(gr,"email"),n(xr,"phone"),s.sort((l,i)=>l.start-i.start||i.end-l.end);const a=[];let c=0;for(const l of s)if(!(l.start<c)&&!(l.kind==="phone"&&Xe(l.raw).length<10)){if(l.start>c){const i=e.slice(c,l.start);a.push(z(i,t))}if(l.kind==="url"){const i=br(l.raw);a.push(o.jsx("a",{href:i,target:"_blank",rel:"noreferrer noopener",className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:z(l.raw,t)},`${l.start}-${l.raw}`))}else if(l.kind==="email")a.push(o.jsx("a",{href:`mailto:${l.raw}`,className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:z(l.raw,t)},`${l.start}-${l.raw}`));else{const i=yr(l.raw);a.push(o.jsx("a",{href:`tel:${i}`,className:"underline underline-offset-2",onMouseDown:r,onClick:r,onTouchStart:r,children:z(l.raw,t)},`${l.start}-${l.raw}`))}c=l.end}return c<e.length&&a.push(z(e.slice(c),t)),o.jsx(o.Fragment,{children:a})},Sr=({path:e})=>{const[t,r]=f.useState(null),[s,n]=f.useState(!1),[a,c]=f.useState(!1),l=f.useRef(!0),i=f.useRef(null),d=f.useRef(!1),u=f.useRef(null),m=f.useRef(!1),p=f.useMemo(()=>!!e,[e]);return f.useEffect(()=>()=>{l.current=!1},[]),f.useEffect(()=>{let h=!1;return i.current=e||null,d.current=!1,r(null),n(!1),e?q(e)?(r(e),()=>{h=!0}):((async()=>{try{const g=await Re(U,e,{allowPublicFallback:!0,forceRefresh:!1,allowHttp:!0});if(h||i.current!==e||!l.current)return;if(!g){n(!0);return}r(g)}catch{!h&&l.current&&i.current===e&&n(!0)}})(),()=>{h=!0}):(n(!0),()=>{h=!0})},[e]),s?o.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Image unavailable."}):t?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"mt-1 overflow-hidden rounded-xl border border-border bg-background/80",role:p?"button":void 0,tabIndex:p?0:void 0,onTouchStart:()=>{u.current=Date.now(),m.current=!1},onTouchEnd:()=>{if(u.current==null)return;const h=Date.now()-u.current;m.current=h>=450,u.current=null},onTouchCancel:()=>{u.current=null,m.current=!1},onClick:h=>{h.stopPropagation(),p&&(m.current||c(!0))},onKeyDown:h=>{p&&(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),h.stopPropagation(),c(!0))},onContextMenu:h=>{h.stopPropagation()},"aria-label":"Open image",children:o.jsx("img",{src:t,alt:"Attachment",className:"max-h-64 w-full cursor-zoom-in object-cover",loading:"lazy",onError:async()=>{if(!(!l.current||i.current!==e)){if(q(e)){n(!0);return}try{const h=We(U,e);if(h&&t===h){n(!0);return}if(d.current){n(!0);return}d.current=!0;const g=await Re(U,e,{allowPublicFallback:!0,forceRefresh:!0,allowHttp:!0});if(!g||g===t){n(!0);return}if(!l.current||i.current!==e)return;r(g)}catch{l.current&&i.current===e&&n(!0)}}}})}),o.jsx(jr,{open:a,onOpenChange:c,url:t})]}):o.jsx("div",{className:"mt-1 h-32 w-40 animate-pulse rounded-xl bg-border/40"})},ce=(e,t,r)=>Math.max(t,Math.min(r,e));function jr({open:e,onOpenChange:t,url:r}){const[s,n]=f.useState(1),[a,c]=f.useState({x:0,y:0}),[l,i]=f.useState(!1),d=f.useRef(!1),u=f.useRef({x:0,y:0}),m=f.useRef({x:0,y:0}),p=()=>{n(1),c({x:0,y:0})};return f.useEffect(()=>{e||p()},[e]),o.jsx(Le,{open:e,onOpenChange:t,children:o.jsx(Fe,{className:"max-w-none w-[calc(100%-1rem)] h-[calc(100%-1rem)] max-h-none p-0 overflow-hidden bg-black border-border/30","aria-label":"Image viewer",children:o.jsxs("div",{className:"relative h-full w-full",children:[o.jsxs("div",{className:"absolute left-0 top-0 z-10 flex w-full items-center justify-between gap-2 p-3",children:[o.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-black/40 px-3 py-1 text-xs text-white",children:[o.jsx("span",{className:"font-medium",children:"Image"}),o.jsx("span",{className:"opacity-75",children:"Â·"}),o.jsx("span",{className:"opacity-75",children:"Scroll to zoom"})]}),o.jsxs("div",{className:"inline-flex items-center gap-2",children:[o.jsxs("button",{type:"button",className:"inline-flex h-10 items-center gap-2 rounded-full bg-black/40 px-3 text-sm text-white hover:bg-black/55",onClick:()=>{try{window.open(r,"_blank","noopener,noreferrer")}catch{}},"aria-label":"Open image in new tab",children:[o.jsx(zt,{className:"h-4 w-4","aria-hidden":!0}),o.jsx("span",{className:"hidden sm:inline",children:"Open"})]}),o.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full bg-black/40 p-1 text-white",children:[o.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-white/10",onClick:()=>n(h=>ce(Number((h-.25).toFixed(2)),1,4)),"aria-label":"Zoom out",children:o.jsx(Vt,{className:"h-4 w-4","aria-hidden":!0})}),o.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-white/10",onClick:()=>n(h=>ce(Number((h+.25).toFixed(2)),1,4)),"aria-label":"Zoom in",children:o.jsx(Lt,{className:"h-4 w-4","aria-hidden":!0})}),o.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-white/10",onClick:p,"aria-label":"Reset view",children:o.jsx(Qt,{className:"h-4 w-4","aria-hidden":!0})})]}),o.jsx("button",{type:"button",className:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-black/40 text-white hover:bg-black/55",onClick:()=>t(!1),"aria-label":"Close",children:o.jsx(Ft,{className:"h-5 w-5","aria-hidden":!0})})]})]}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",onWheel:h=>{if(s<=1)return;h.preventDefault();const g=-h.deltaY,x=ce(Number((s+g*.002).toFixed(2)),1,4);n(x)},onDoubleClick:()=>{n(h=>h===1?2:1),c({x:0,y:0})},onPointerDown:h=>{s<=1||(d.current=!0,i(!0),u.current={x:h.clientX,y:h.clientY},m.current=a,h.currentTarget.setPointerCapture?.(h.pointerId))},onPointerMove:h=>{if(!d.current)return;const g=h.clientX-u.current.x,x=h.clientY-u.current.y;c({x:m.current.x+g,y:m.current.y+x})},onPointerUp:()=>{d.current=!1,i(!1)},onPointerCancel:()=>{d.current=!1,i(!1)},children:o.jsx("img",{src:r,alt:"Attachment",className:"max-h-full max-w-full select-none object-contain",draggable:!1,style:{transform:`translate3d(${a.x}px, ${a.y}px, 0) scale(${s})`,transformOrigin:"center",transition:l?"none":"transform 120ms ease-out",cursor:s>1?"grab":"zoom-in"}})})]})})})}function de(e){return typeof e=="string"&&e.trim().length>0}function Cr(e){return!e||typeof e!="object"?null:e}function Nr({ui:e,actions:t,onAction:r}){const s=f.useMemo(()=>Cr(e),[e]),n=f.useMemo(()=>Array.isArray(t)?t:[],[t]),a=f.useMemo(()=>{const d=new Map;for(const u of n)u&&typeof u=="object"&&de(u.id)&&d.set(String(u.id),u);return d},[n]),[c,l]=f.useState({});if(!s||(s.layout??"stacked")!=="stacked")return null;const i=Array.isArray(s.cards)?s.cards:[];return!s.heading&&i.length===0?null:o.jsxs("div",{className:"mt-2 space-y-2",children:[(s.heading||s.subheading)&&o.jsxs("div",{className:"rounded-2xl border border-border/60 bg-muted/20 p-3",children:[s.heading?o.jsx("div",{className:"text-sm font-semibold text-foreground",children:s.heading}):null,s.subheading?o.jsx("div",{className:"mt-0.5 text-xs text-muted-foreground",children:s.subheading}):null]}),i.map(d=>{const u=(Array.isArray(d.actionIds)?d.actionIds:[]).filter(de);return o.jsx("div",{className:"rounded-2xl border border-border/60 bg-card/60 p-3",children:o.jsxs("div",{className:"flex gap-3",children:[o.jsx("div",{className:"h-16 w-12 shrink-0 overflow-hidden rounded-xl bg-muted",children:d.poster?o.jsx("img",{src:d.poster,alt:d.title??"",className:"h-full w-full object-cover",loading:"lazy"}):null}),o.jsxs("div",{className:"min-w-0 flex-1",children:[o.jsx("div",{className:"flex items-start justify-between gap-2",children:o.jsxs("div",{className:"min-w-0",children:[o.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:d.title??""}),o.jsx("div",{className:"mt-0.5 truncate text-xs text-muted-foreground",children:[d.kind,d.year?String(d.year):null].filter(Boolean).join(" â€¢ ")})]})}),d.reason?o.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:d.reason}):null,Array.isArray(d.badges)&&d.badges.length?o.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:d.badges.slice(0,6).map(m=>o.jsx("span",{className:"rounded-full bg-muted/70 px-2 py-0.5 text-[11px] font-semibold text-muted-foreground",children:m},m))}):null,u.length?o.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:u.slice(0,4).map(m=>{const p=a.get(m);if(!p)return null;const h=de(p.label)?p.label:"Do",g=!!c[m];return o.jsx("button",{type:"button",onClick:async()=>{try{l(x=>({...x,[m]:!0})),await r(m)}finally{l(x=>({...x,[m]:!1}))}},disabled:g,className:"rounded-full px-3 py-1 text-xs font-semibold transition "+(g?"bg-muted text-muted-foreground opacity-70":"bg-primary text-primary-foreground hover:bg-primary/90"),children:g?"Workingâ€¦":h},m)})}):null]})]})},d.id)})]})}function kr({handles:e,className:t}){const r=Array.isArray(e)?e.map(m=>String(m)).filter(Boolean).slice(0,50):[],[s,n]=D.useState(r[0]??null),[a,c]=D.useState(!1),[l,i]=D.useState({}),d=D.useCallback(async m=>{if(m&&!Object.prototype.hasOwnProperty.call(l,m)){c(!0);try{const p=await vt("assistant-tool-result",{actionId:m});i(h=>({...h,[m]:p}))}catch(p){i(h=>({...h,[m]:null})),Y.error(p?.message??"Couldn't load evidence.")}finally{c(!1)}}},[l]);if(D.useEffect(()=>{s&&d(s)},[s,d]),r.length===0)return null;const u=s?l[s]:null;return o.jsx("div",{className:t,children:o.jsxs(Le,{children:[o.jsx(Mt,{asChild:!0,children:o.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-full border border-border bg-muted/40 px-3 py-1 text-xs font-medium text-muted-foreground hover:bg-muted",children:["Evidence",o.jsx(St,{variant:"outline",className:"px-2 py-0 text-[11px]",children:r.length})]})}),o.jsxs(Fe,{className:"max-w-2xl",children:[o.jsxs(Dt,{children:[o.jsx(It,{children:"Evidence"}),o.jsx($t,{children:"Tool results the assistant used while generating this reply."})]}),o.jsxs("div",{className:"mt-2 flex flex-col gap-3",children:[o.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(m=>o.jsx("button",{type:"button",onClick:()=>{n(m),d(m)},className:`rounded-full border px-3 py-1 text-xs transition ${m===s?"border-primary/50 bg-primary/15 text-primary":"border-border bg-background text-muted-foreground hover:bg-muted"}`,title:m,children:m},m))}),o.jsx("div",{className:"rounded-2xl border border-border bg-background p-4",children:a&&!u?o.jsx("div",{className:"text-sm text-muted-foreground",children:"Loadingâ€¦"}):u?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[o.jsx("div",{className:"text-sm font-medium text-foreground",children:u.actionType}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(u.createdAt).toLocaleString()}),o.jsx(jt,{variant:"ghost",size:"sm",onClick:async()=>{await Ve(JSON.stringify(u.payload,null,2))?Y.show("Evidence copied."):Y.error("Couldn't copy evidence.")},children:"Copy JSON"})]})]}),o.jsx("pre",{className:"mt-3 max-h-[55vh] overflow-auto whitespace-pre-wrap break-words rounded-xl bg-muted/30 p-3 text-xs text-foreground",children:JSON.stringify(u.payload,null,2)})]}):o.jsx("div",{className:"text-sm text-muted-foreground",children:"No details available."})})]})]})]})})}const Er=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ”¥","ðŸ˜"],wn=D.memo(function({message:t,meta:r,sender:s,isSelf:n,deliveryStatus:a,showDeliveryStatus:c,reactions:l,index:i,previousMessage:d,nextMessage:u,firstUnreadIndex:m,activeActionMessageId:p,longPressTriggeredRef:h,onOpenMessageActions:g,onCloseMessageActions:x,onOpenEditDialog:w,onOpenDeleteDialog:b,onToggleReaction:v,onRetryMessage:N,onDiscardFailedMessage:j,onAssistantAction:C,onBubbleTouchStart:k,onBubbleTouchEndOrCancel:_,searchQuery:F,isSearchMatch:S,isActiveSearchMatch:E}){const R=d!=null&&d.senderId===t.senderId,oe=u!=null&&u.senderId===t.senderId,it=R&&Pe(d.createdAt,t.createdAt),ct=oe&&Pe(t.createdAt,u.createdAt),dt=!(R&&it),ut=!(oe&&ct),ft=m!=null&&i===m,Se=i===0||d!=null&&!fe(new Date(d.createdAt),new Date(t.createdAt)),mt=i===0||Se?"mt-0":dt?"mt-3":"mt-1.5",T=r.deleted===!0,je=r.editedAt,Ce=r.deletedAt,Ne=s?.displayName??(n?"You":"Someone"),O=Ct(t.body),ke=(F??"").trim(),ht=!!(ke&&S&&!T),pt=(()=>{const y=n?"You":Ne;return T?`${y} deleted a message`:O?`${y} said: ${O}`:t.attachmentUrl?`${y} sent an attachment`:`${y} sent a message`})(),gt=!n&&ut,ae=()=>{if(h.current){h.current=!1;return}p===t.id?x():g(t)};return o.jsxs("div",{className:"px-0",children:[Se&&o.jsx("div",{className:"my-4 flex items-center justify-center",children:o.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-muted-foreground",children:[o.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),o.jsx("span",{className:"rounded-full bg-muted px-3 py-0.5 text-xs font-medium text-muted-foreground",children:er(t.createdAt)}),o.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),ft&&o.jsx("div",{className:"my-4 flex items-center justify-center",role:"separator","aria-label":"New messages",children:o.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-primary",children:[o.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),o.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-0.5 text-xs font-semibold text-primary",children:"New messages"}),o.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),o.jsxs("div",{className:`flex w-full flex-col gap-0.5 ${mt}`,children:[o.jsxs("div",{className:`flex w-full items-end gap-2 ${n?"justify-end":"justify-start"}`,children:[!n&&o.jsx(o.Fragment,{children:gt?o.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0 overflow-hidden rounded-full bg-muted",children:s?.avatarUrl?o.jsx("img",{src:s.avatarUrl,alt:s.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):o.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs font-medium text-muted-foreground",children:Ne.slice(0,2).toUpperCase()})}):o.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0"})}),o.jsxs(hr,{isSelf:n,isDeleted:T,"data-message-action-scope":t.id,className:T?"":E?"ring-2 ring-primary/60":S?"ring-2 ring-primary/25":"",onClick:ae,onContextMenu:y=>{y.preventDefault(),ae()},onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),ae())},onTouchStart:()=>k(t),onTouchEnd:_,onTouchCancel:_,"aria-label":pt,children:[O&&o.jsx("p",{className:"whitespace-pre-wrap break-words [overflow-wrap:anywhere] text-sm leading-snug",children:o.jsx(vr,{text:O,highlight:ht?ke:void 0})}),!T&&t.attachmentUrl&&o.jsx(Sr,{path:t.attachmentUrl})]})]}),l.length>0&&o.jsx("div",{className:`mt-0.5 flex w-full ${n?"justify-end pr-6":"justify-start pl-6"}`,children:o.jsx("div",{className:"inline-flex flex-wrap items-center gap-1 rounded-full bg-muted px-1.5 py-0.5 text-xs text-foreground",children:l.map(y=>o.jsxs("button",{type:"button",onClick:()=>v(t.id,y.emoji),className:`inline-flex items-center gap-1 rounded-full px-1.5 py-0.5 transition hover:bg-background ${y.reactedBySelf?"bg-primary/10":""}`,children:[o.jsx("span",{className:"text-[17px]",children:y.emoji}),y.count>1&&o.jsx("span",{className:"text-xs text-muted-foreground",children:y.count})]},y.emoji))})}),p===t.id&&!T&&o.jsx("div",{className:`mt-1 flex w-full ${n?"justify-end pr-6":"justify-start pl-6"}`,children:o.jsxs("div",{className:"inline-flex flex-col items-stretch gap-1 rounded-2xl bg-muted px-2.5 py-1.5 text-xs text-foreground select-none","data-message-action-scope":t.id,children:[o.jsx("div",{className:"flex items-center justify-center gap-1",children:Er.map(y=>o.jsx("button",{type:"button",onClick:()=>{v(t.id,y),x()},className:"flex h-7 w-7 items-center justify-center rounded-full transition hover:bg-background",children:o.jsx("span",{className:"text-[17px]",children:y})},y))}),o.jsxs("div",{className:`mt-1 flex flex-wrap items-center gap-2 ${n?"justify-end":"justify-start"}`,children:[O?o.jsxs("button",{type:"button",onClick:async()=>{await Ve(O)?Y.show("Copied to clipboard."):Y.error("Couldn't copy to clipboard."),x()},className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-muted-foreground hover:bg-background",children:[o.jsx(Ot,{className:"h-3.5 w-3.5","aria-hidden":!0}),o.jsx("span",{children:"Copy"})]}):null,n?(()=>{if(t.attachmentUrl||T)return null;const y=Nt(t.body);return y!=="text"&&y!=="unknown"?null:o.jsxs("button",{type:"button",onClick:xt=>w(t,xt.currentTarget),className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-muted-foreground hover:bg-background",children:[o.jsx(qt,{className:"h-3.5 w-3.5","aria-hidden":!0}),o.jsx("span",{children:"Edit"})]})})():null,n?o.jsxs("button",{type:"button",onClick:()=>b(t),className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-destructive hover:bg-destructive/10",children:[o.jsx(Jt,{className:"h-3.5 w-3.5","aria-hidden":!0}),o.jsx("span",{children:"Delete"})]}):null]})]})}),!n&&t?.meta?.ai?.ui?o.jsx("div",{className:"pl-7 pr-1",children:o.jsx(Nr,{ui:t.meta.ai.ui,actions:t.meta.ai.actions,onAction:async y=>{C&&await C(t.id,y)}})}):null,!n&&Array.isArray(t?.meta?.ai?.toolHandles)&&t.meta.ai.toolHandles.length>0?o.jsx("div",{className:"pl-7 pr-1",children:o.jsx(kr,{handles:t.meta.ai.toolHandles})}):null,c&&a&&o.jsx("div",{className:`flex items-center gap-1 text-xs text-muted-foreground ${n?"justify-end pr-1":"justify-start pl-7"}`,children:a.status==="failed"?o.jsxs(o.Fragment,{children:[o.jsx(Ut,{className:"h-3 w-3 text-destructive","aria-hidden":!0}),o.jsx("span",{children:"Failed to send."}),o.jsx("button",{type:"button",className:"text-destructive underline",onClick:()=>N(t),children:"Retry"}),o.jsx("span",{"aria-hidden":"true",children:"Â·"}),o.jsx("button",{type:"button",className:"text-destructive underline",onClick:()=>j(t),children:"Discard"})]}):a.status==="sending"?o.jsxs(o.Fragment,{children:[o.jsx(kt,{className:"h-3 w-3 animate-spin","aria-hidden":!0}),o.jsx("span",{children:"Sendingâ€¦"})]}):a.status==="sent"?o.jsxs(o.Fragment,{children:[o.jsx(_t,{className:"h-3 w-3","aria-hidden":!0}),o.jsx("span",{children:"Sent"})]}):a.status==="delivered"?o.jsxs(o.Fragment,{children:[o.jsx(Ee,{className:"h-3 w-3","aria-hidden":!0}),o.jsx("span",{children:"Delivered"})]}):o.jsxs(o.Fragment,{children:[o.jsx(Ee,{className:"h-3 w-3","aria-hidden":!0}),o.jsx("span",{children:a.seenAt?`Seen ${ie(a.seenAt)}`:"Seen"})]})}),T&&Ce&&o.jsxs("p",{className:`text-xs text-muted-foreground ${n?"text-right pr-1":"text-left pl-7"}`,children:["Deleted ",ie(Ce)]}),!T&&je&&o.jsxs("p",{className:`text-xs text-muted-foreground ${n?"text-right pr-1":"text-left pl-7"}`,children:["Edited ",ie(je)]})]})]},t.id)});function Pr(e){const t=Ar(e),r=f.forwardRef((s,n)=>{const{children:a,...c}=s,l=f.Children.toArray(a),i=l.find(Rr);if(i){const d=i.props.children,u=l.map(m=>m===i?f.Children.count(d)>1?f.Children.only(null):f.isValidElement(d)?d.props.children:null:m);return o.jsx(t,{...c,ref:n,children:f.isValidElement(d)?f.cloneElement(d,void 0,u):null})}return o.jsx(t,{...c,ref:n,children:a})});return r.displayName=`${e}.Slot`,r}function Ar(e){const t=f.forwardRef((r,s)=>{const{children:n,...a}=r;if(f.isValidElement(n)){const c=Mr(n),l=Tr(a,n.props);return n.type!==f.Fragment&&(l.ref=s?Et(s,c):c),f.cloneElement(n,l)}return f.Children.count(n)>1?f.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var _r=Symbol("radix.slottable");function Rr(e){return f.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===_r}function Tr(e,t){const r={...t};for(const s in t){const n=e[s],a=t[s];/^on[A-Z]/.test(s)?n&&a?r[s]=(...l)=>{const i=a(...l);return n(...l),i}:n&&(r[s]=n):s==="style"?r[s]={...n,...a}:s==="className"&&(r[s]=[n,a].filter(Boolean).join(" "))}return{...e,...r}}function Mr(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var Dr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],K=Dr.reduce((e,t)=>{const r=Pr(`Primitive.${t}`),s=f.forwardRef((n,a)=>{const{asChild:c,...l}=n,i=c?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),o.jsx(i,{...l,ref:a})});return s.displayName=`Primitive.${t}`,{...e,[t]:s}},{});function Ir(e,t=[]){let r=[];function s(a,c){const l=f.createContext(c),i=r.length;r=[...r,c];const d=m=>{const{scope:p,children:h,...g}=m,x=p?.[e]?.[i]||l,w=f.useMemo(()=>g,Object.values(g));return o.jsx(x.Provider,{value:w,children:h})};d.displayName=a+"Provider";function u(m,p){const h=p?.[e]?.[i]||l,g=f.useContext(h);if(g)return g;if(c!==void 0)return c;throw new Error(`\`${m}\` must be used within \`${a}\``)}return[d,u]}const n=()=>{const a=r.map(c=>f.createContext(c));return function(l){const i=l?.[e]||a;return f.useMemo(()=>({[`__scope${e}`]:{...l,[e]:i}}),[l,i])}};return n.scopeName=e,[s,$r(n,...t)]}function $r(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const s=e.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(a){const c=s.reduce((l,{useScope:i,scopeName:d})=>{const m=i(a)[`__scope${d}`];return{...l,...m}},{});return f.useMemo(()=>({[`__scope${t.scopeName}`]:c}),[c])}};return r.scopeName=t.scopeName,r}function Lr(e,[t,r]){return Math.min(r,Math.max(t,e))}function Fr(e,t){return f.useReducer((r,s)=>t[r][s]??r,e)}var be="ScrollArea",[qe]=Ir(be),[Or,P]=qe(be),Ge=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:s="hover",dir:n,scrollHideDelay:a=600,...c}=e,[l,i]=f.useState(null),[d,u]=f.useState(null),[m,p]=f.useState(null),[h,g]=f.useState(null),[x,w]=f.useState(null),[b,v]=f.useState(0),[N,j]=f.useState(0),[C,k]=f.useState(!1),[_,F]=f.useState(!1),S=W(t,R=>i(R)),E=Bt(n);return o.jsx(Or,{scope:r,type:s,dir:E,scrollHideDelay:a,scrollArea:l,viewport:d,onViewportChange:u,content:m,onContentChange:p,scrollbarX:h,onScrollbarXChange:g,scrollbarXEnabled:C,onScrollbarXEnabledChange:k,scrollbarY:x,onScrollbarYChange:w,scrollbarYEnabled:_,onScrollbarYEnabledChange:F,onCornerWidthChange:v,onCornerHeightChange:j,children:o.jsx(K.div,{dir:E,...c,ref:S,style:{position:"relative","--radix-scroll-area-corner-width":b+"px","--radix-scroll-area-corner-height":N+"px",...e.style}})})});Ge.displayName=be;var Qe="ScrollAreaViewport",Ke=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:s,nonce:n,...a}=e,c=P(Qe,r),l=f.useRef(null),i=W(t,l,c.onViewportChange);return o.jsxs(o.Fragment,{children:[o.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),o.jsx(K.div,{"data-radix-scroll-area-viewport":"",...a,ref:i,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...e.style},children:o.jsx("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:s})})]})});Ke.displayName=Qe;var A="ScrollAreaScrollbar",ye=f.forwardRef((e,t)=>{const{forceMount:r,...s}=e,n=P(A,e.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:c}=n,l=e.orientation==="horizontal";return f.useEffect(()=>(l?a(!0):c(!0),()=>{l?a(!1):c(!1)}),[l,a,c]),n.type==="hover"?o.jsx(Ur,{...s,ref:t,forceMount:r}):n.type==="scroll"?o.jsx(Br,{...s,ref:t,forceMount:r}):n.type==="auto"?o.jsx(Je,{...s,ref:t,forceMount:r}):n.type==="always"?o.jsx(we,{...s,ref:t}):null});ye.displayName=A;var Ur=f.forwardRef((e,t)=>{const{forceMount:r,...s}=e,n=P(A,e.__scopeScrollArea),[a,c]=f.useState(!1);return f.useEffect(()=>{const l=n.scrollArea;let i=0;if(l){const d=()=>{window.clearTimeout(i),c(!0)},u=()=>{i=window.setTimeout(()=>c(!1),n.scrollHideDelay)};return l.addEventListener("pointerenter",d),l.addEventListener("pointerleave",u),()=>{window.clearTimeout(i),l.removeEventListener("pointerenter",d),l.removeEventListener("pointerleave",u)}}},[n.scrollArea,n.scrollHideDelay]),o.jsx(te,{present:r||a,children:o.jsx(Je,{"data-state":a?"visible":"hidden",...s,ref:t})})}),Br=f.forwardRef((e,t)=>{const{forceMount:r,...s}=e,n=P(A,e.__scopeScrollArea),a=e.orientation==="horizontal",c=se(()=>i("SCROLL_END"),100),[l,i]=Fr("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return f.useEffect(()=>{if(l==="idle"){const d=window.setTimeout(()=>i("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(d)}},[l,n.scrollHideDelay,i]),f.useEffect(()=>{const d=n.viewport,u=a?"scrollLeft":"scrollTop";if(d){let m=d[u];const p=()=>{const h=d[u];m!==h&&(i("SCROLL"),c()),m=h};return d.addEventListener("scroll",p),()=>d.removeEventListener("scroll",p)}},[n.viewport,a,i,c]),o.jsx(te,{present:r||l!=="hidden",children:o.jsx(we,{"data-state":l==="hidden"?"hidden":"visible",...s,ref:t,onPointerEnter:L(e.onPointerEnter,()=>i("POINTER_ENTER")),onPointerLeave:L(e.onPointerLeave,()=>i("POINTER_LEAVE"))})})}),Je=f.forwardRef((e,t)=>{const r=P(A,e.__scopeScrollArea),{forceMount:s,...n}=e,[a,c]=f.useState(!1),l=e.orientation==="horizontal",i=se(()=>{if(r.viewport){const d=r.viewport.offsetWidth<r.viewport.scrollWidth,u=r.viewport.offsetHeight<r.viewport.scrollHeight;c(l?d:u)}},10);return B(r.viewport,i),B(r.content,i),o.jsx(te,{present:s||a,children:o.jsx(we,{"data-state":a?"visible":"hidden",...n,ref:t})})}),we=f.forwardRef((e,t)=>{const{orientation:r="vertical",...s}=e,n=P(A,e.__scopeScrollArea),a=f.useRef(null),c=f.useRef(0),[l,i]=f.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=nt(l.viewport,l.content),u={...s,sizes:l,onSizesChange:i,hasThumb:d>0&&d<1,onThumbChange:p=>a.current=p,onThumbPointerUp:()=>c.current=0,onThumbPointerDown:p=>c.current=p};function m(p,h){return Xr(p,c.current,l,h)}return r==="horizontal"?o.jsx(Hr,{...u,ref:t,onThumbPositionChange:()=>{if(n.viewport&&a.current){const p=n.viewport.scrollLeft,h=De(p,l,n.dir);a.current.style.transform=`translate3d(${h}px, 0, 0)`}},onWheelScroll:p=>{n.viewport&&(n.viewport.scrollLeft=p)},onDragScroll:p=>{n.viewport&&(n.viewport.scrollLeft=m(p,n.dir))}}):r==="vertical"?o.jsx(Wr,{...u,ref:t,onThumbPositionChange:()=>{if(n.viewport&&a.current){const p=n.viewport.scrollTop,h=De(p,l);a.current.style.transform=`translate3d(0, ${h}px, 0)`}},onWheelScroll:p=>{n.viewport&&(n.viewport.scrollTop=p)},onDragScroll:p=>{n.viewport&&(n.viewport.scrollTop=m(p))}}):null}),Hr=f.forwardRef((e,t)=>{const{sizes:r,onSizesChange:s,...n}=e,a=P(A,e.__scopeScrollArea),[c,l]=f.useState(),i=f.useRef(null),d=W(t,i,a.onScrollbarXChange);return f.useEffect(()=>{i.current&&l(getComputedStyle(i.current))},[i]),o.jsx(et,{"data-orientation":"horizontal",...n,ref:d,sizes:r,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":ne(r)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.x),onDragScroll:u=>e.onDragScroll(u.x),onWheelScroll:(u,m)=>{if(a.viewport){const p=a.viewport.scrollLeft+u.deltaX;e.onWheelScroll(p),ot(p,m)&&u.preventDefault()}},onResize:()=>{i.current&&a.viewport&&c&&s({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:i.current.clientWidth,paddingStart:ee(c.paddingLeft),paddingEnd:ee(c.paddingRight)}})}})}),Wr=f.forwardRef((e,t)=>{const{sizes:r,onSizesChange:s,...n}=e,a=P(A,e.__scopeScrollArea),[c,l]=f.useState(),i=f.useRef(null),d=W(t,i,a.onScrollbarYChange);return f.useEffect(()=>{i.current&&l(getComputedStyle(i.current))},[i]),o.jsx(et,{"data-orientation":"vertical",...n,ref:d,sizes:r,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":ne(r)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.y),onDragScroll:u=>e.onDragScroll(u.y),onWheelScroll:(u,m)=>{if(a.viewport){const p=a.viewport.scrollTop+u.deltaY;e.onWheelScroll(p),ot(p,m)&&u.preventDefault()}},onResize:()=>{i.current&&a.viewport&&c&&s({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:i.current.clientHeight,paddingStart:ee(c.paddingTop),paddingEnd:ee(c.paddingBottom)}})}})}),[zr,Ze]=qe(A),et=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:s,hasThumb:n,onThumbChange:a,onThumbPointerUp:c,onThumbPointerDown:l,onThumbPositionChange:i,onDragScroll:d,onWheelScroll:u,onResize:m,...p}=e,h=P(A,r),[g,x]=f.useState(null),w=W(t,S=>x(S)),b=f.useRef(null),v=f.useRef(""),N=h.viewport,j=s.content-s.viewport,C=$(u),k=$(i),_=se(m,10);function F(S){if(b.current){const E=S.clientX-b.current.left,R=S.clientY-b.current.top;d({x:E,y:R})}}return f.useEffect(()=>{const S=E=>{const R=E.target;g?.contains(R)&&C(E,j)};return document.addEventListener("wheel",S,{passive:!1}),()=>document.removeEventListener("wheel",S,{passive:!1})},[N,g,j,C]),f.useEffect(k,[s,k]),B(g,_),B(h.content,_),o.jsx(zr,{scope:r,scrollbar:g,hasThumb:n,onThumbChange:$(a),onThumbPointerUp:$(c),onThumbPositionChange:k,onThumbPointerDown:$(l),children:o.jsx(K.div,{...p,ref:w,style:{position:"absolute",...p.style},onPointerDown:L(e.onPointerDown,S=>{S.button===0&&(S.target.setPointerCapture(S.pointerId),b.current=g.getBoundingClientRect(),v.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",h.viewport&&(h.viewport.style.scrollBehavior="auto"),F(S))}),onPointerMove:L(e.onPointerMove,F),onPointerUp:L(e.onPointerUp,S=>{const E=S.target;E.hasPointerCapture(S.pointerId)&&E.releasePointerCapture(S.pointerId),document.body.style.webkitUserSelect=v.current,h.viewport&&(h.viewport.style.scrollBehavior=""),b.current=null})})})}),Z="ScrollAreaThumb",tt=f.forwardRef((e,t)=>{const{forceMount:r,...s}=e,n=Ze(Z,e.__scopeScrollArea);return o.jsx(te,{present:r||n.hasThumb,children:o.jsx(Yr,{ref:t,...s})})}),Yr=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:s,...n}=e,a=P(Z,r),c=Ze(Z,r),{onThumbPositionChange:l}=c,i=W(t,m=>c.onThumbChange(m)),d=f.useRef(void 0),u=se(()=>{d.current&&(d.current(),d.current=void 0)},100);return f.useEffect(()=>{const m=a.viewport;if(m){const p=()=>{if(u(),!d.current){const h=qr(m,l);d.current=h,l()}};return l(),m.addEventListener("scroll",p),()=>m.removeEventListener("scroll",p)}},[a.viewport,u,l]),o.jsx(K.div,{"data-state":c.hasThumb?"visible":"hidden",...n,ref:i,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:L(e.onPointerDownCapture,m=>{const h=m.target.getBoundingClientRect(),g=m.clientX-h.left,x=m.clientY-h.top;c.onThumbPointerDown({x:g,y:x})}),onPointerUp:L(e.onPointerUp,c.onThumbPointerUp)})});tt.displayName=Z;var ve="ScrollAreaCorner",rt=f.forwardRef((e,t)=>{const r=P(ve,e.__scopeScrollArea),s=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&s?o.jsx(Vr,{...e,ref:t}):null});rt.displayName=ve;var Vr=f.forwardRef((e,t)=>{const{__scopeScrollArea:r,...s}=e,n=P(ve,r),[a,c]=f.useState(0),[l,i]=f.useState(0),d=!!(a&&l);return B(n.scrollbarX,()=>{const u=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(u),i(u)}),B(n.scrollbarY,()=>{const u=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(u),c(u)}),d?o.jsx(K.div,{...s,ref:t,style:{width:a,height:l,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function ee(e){return e?parseInt(e,10):0}function nt(e,t){const r=e/t;return isNaN(r)?0:r}function ne(e){const t=nt(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,s=(e.scrollbar.size-r)*t;return Math.max(s,18)}function Xr(e,t,r,s="ltr"){const n=ne(r),a=n/2,c=t||a,l=n-c,i=r.scrollbar.paddingStart+c,d=r.scrollbar.size-r.scrollbar.paddingEnd-l,u=r.content-r.viewport,m=s==="ltr"?[0,u]:[u*-1,0];return st([i,d],m)(e)}function De(e,t,r="ltr"){const s=ne(t),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=t.scrollbar.size-n,c=t.content-t.viewport,l=a-s,i=r==="ltr"?[0,c]:[c*-1,0],d=Lr(e,i);return st([0,c],[0,l])(d)}function st(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const s=(t[1]-t[0])/(e[1]-e[0]);return t[0]+s*(r-e[0])}}function ot(e,t){return e>0&&e<t}var qr=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},s=0;return(function n(){const a={left:e.scrollLeft,top:e.scrollTop},c=r.left!==a.left,l=r.top!==a.top;(c||l)&&t(),r=a,s=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(s)};function se(e,t){const r=$(e),s=f.useRef(0);return f.useEffect(()=>()=>window.clearTimeout(s.current),[]),f.useCallback(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(r,t)},[r,t])}function B(e,t){const r=$(t);Pt(()=>{let s=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(r)});return n.observe(e),()=>{window.cancelAnimationFrame(s),n.unobserve(e)}}},[e,r])}var at=Ge,Gr=Ke,Qr=rt;const Kr=f.forwardRef(({className:e,children:t,...r},s)=>o.jsxs(at,{ref:s,className:ge("relative overflow-hidden",e),...r,children:[o.jsx(Gr,{className:"h-full w-full rounded-[inherit]",children:t}),o.jsx(lt,{}),o.jsx(Qr,{})]}));Kr.displayName=at.displayName;const lt=f.forwardRef(({className:e,orientation:t="vertical",...r},s)=>o.jsx(ye,{ref:s,orientation:t,className:ge("flex touch-none select-none transition-colors data-[orientation=vertical]:h-full data-[orientation=vertical]:w-2 data-[orientation=horizontal]:h-2 data-[orientation=horizontal]:w-full",e),...r,children:o.jsx(tt,{className:"relative flex-1 rounded-full bg-border"})}));lt.displayName=ye.displayName;export{U as C,ar as M,Kr as S,Jt as T,xn as a,gn as b,un as c,cn as d,dn as e,fn as f,Te as g,q as h,G as i,pn as j,hr as k,Ve as l,tr as m,mn as n,ln as o,bn as p,nr as q,hn as r,Ue as s,me as t,yn as u,wn as v};
