import{c as K,j as e,d as Q,e as G,L as U,s as x}from"./index-DhZ1aP8k.js";import{C as I}from"./Chip-BzWWSk8Y.js";import{S as C}from"./sparkles-BJZdJSJT.js";import{F as N}from"./film-CREplfjy.js";import{C as A,L as J}from"./list-checks-Dy_JIKOr.js";import{U as Y}from"./users-B9oifkuI.js";import{C as $}from"./chevron-right-3eUpivlq.js";const X=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Z=K("play",X),ee=()=>e.jsxs("section",{className:"animate-pulse rounded-2xl border border-border bg-card/90 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"h-4 w-32 rounded-full bg-border/60"}),e.jsx("div",{className:"h-4 w-16 rounded-full bg-border/40"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-28 w-20 rounded-2xl bg-border/60"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-2/3 rounded-full bg-border/60"}),e.jsx("div",{className:"h-3 w-full rounded-full bg-border/40"}),e.jsx("div",{className:"h-3 w-5/6 rounded-full bg-border/40"}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("div",{className:"h-7 w-28 rounded-full bg-border/50"}),e.jsx("div",{className:"h-7 w-28 rounded-full bg-border/40"})]})]})]})]}),te=()=>e.jsx("div",{className:"space-y-3",children:[0,1].map(t=>e.jsxs("section",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-40 rounded-full bg-border/60"}),e.jsx("div",{className:"-mx-1 overflow-x-hidden pb-1",children:e.jsx("div",{className:"flex gap-2 px-1",children:[0,1,2].map(a=>e.jsx("div",{className:"h-40 w-[160px] shrink-0 rounded-2xl border border-border bg-card/80"},a))})})]},t))}),se=()=>e.jsx("section",{className:"rounded-2xl border border-border bg-card/95 px-4 py-5 text-xs text-muted-foreground shadow-lg",children:e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center text-center",children:[e.jsx("div",{className:"mb-3 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-primary/15",children:e.jsx(C,{className:"h-4 w-4 text-primary","aria-hidden":!0})}),e.jsx("h2",{className:"text-sm font-heading font-semibold text-foreground",children:"Smart picks arrive as you watch"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Once you've logged a few titles and swiped through recommendations, MoviNesta will start surfacing a single “tonight's pick” tuned to your taste."}),e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:["For now, head to ",e.jsx("span",{className:"font-medium text-foreground",children:"Swipe"})," or"," ",e.jsx("span",{className:"font-medium text-foreground",children:"Diary"})," to teach the nest what you love."]})]})}),re=()=>e.jsx("section",{className:"rounded-2xl border border-border bg-card/95 px-4 py-4 text-xs text-muted-foreground shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"inline-flex h-8 w-8 items-center justify-center rounded-2xl bg-primary/15",children:e.jsx(N,{className:"h-4 w-4 text-primary","aria-hidden":!0})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-sm font-heading font-semibold text-foreground",children:"No personalized rows yet"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"As you rate, review, and follow friends, this tab will fill with eerily good recommendations."})]})]})}),ie=t=>{const i=(t?.message??"").toLowerCase();return i.includes("network")||i.includes("failed to fetch")||i.includes("fetch")?"We couldn’t reach the server to load your recommendations. Check your connection and try again.":i.includes("unauthorized")||i.includes("401")||i.includes("403")?"We couldn’t load your recommendations because your session may have expired. Try signing out and back in.":"Something went wrong while loading your recommendations. Please try again."},b=(t,a)=>t??a??null,ae=async t=>{const[a,i,d]=await Promise.all([x.from("follows").select("followed_id").eq("follower_id",t),x.from("ratings").select("title_id, rating, created_at").eq("user_id",t).order("created_at",{ascending:!1}).limit(40),x.from("library_entries").select("title_id, status, updated_at").eq("user_id",t).order("updated_at",{ascending:!1}).limit(40)]);let n=!1;if(i.error)throw new Error(i.error.message);if(d.error)throw new Error(d.error.message);const m=a.error;m&&(n=!0,console.warn("[HomeForYouTab] Failed to load follows",m.message));const h=i.data??[],v=d.data??[],E=(a.data??[]).map(s=>s.followed_id).filter(s=>!!s)??[],P=h.find(s=>(s.rating??0)>=4)??h[0]??null,o=P?.title_id??null;let y=[];if(E.length>0){const{data:s,error:r}=await x.from("ratings").select("title_id, user_id, created_at").in("user_id",E).order("created_at",{ascending:!1}).limit(30);r&&(n=!0,console.warn("[HomeForYouTab] Failed to load friend ratings",r.message)),y=s??[]}const j=[];y.forEach(s=>{s.title_id&&(j.includes(s.title_id)||j.push(s.title_id))});const g=[];o&&v.forEach(s=>{s.title_id&&s.title_id!==o&&(s.status==="want_to_watch"||s.status==="watching")&&(g.includes(s.title_id)||g.push(s.title_id))});const w=[];v.forEach(s=>{s.title_id&&(s.status==="watching"||s.status==="want_to_watch")&&(w.includes(s.title_id)||w.push(s.title_id))});const{data:H,error:L}=await x.from("anime").select("title_id").limit(16);L&&(n=!0,console.warn("[HomeForYouTab] Failed to load anime titles",L.message));const O=(H??[]).map(s=>s.title_id),_=await x.from("titles").select("id:title_id, title:primary_title, year:release_year, runtime_minutes, type:content_type, poster_url, backdrop_url, imdb_rating, rt_tomato_pct").in("title_id",O).order("release_year",{ascending:!1}).limit(16);_.error&&(n=!0,console.warn("[HomeForYouTab] Failed to load anime titles",_.error.message));const S=_.data??[],B=S.map(s=>s.id),W=Array.from(new Set([...o?[o]:[],...j,...g,...w,...B]));if(!W.length)return{tonightPick:null,sections:[],hasPartialData:n};const R=await x.from("titles").select("id:title_id, title:primary_title, year:release_year, runtime_minutes, type:content_type, poster_url, backdrop_url, imdb_rating, rt_tomato_pct").in("title_id",W);if(R.error)throw new Error(R.error.message);const q=R.data??[],f=new Map;q.forEach(s=>{f.set(s.id,s)});const u=new Set;let D=null;if(o&&f.has(o)){const s=f.get(o),r=P?.rating??null;D={id:s.id,name:s.title??"Untitled",year:s.year??new Date().getFullYear(),runtimeMinutes:s.runtime_minutes??void 0,matchReason:r&&r>=4?"Because you gave this a high rating.":"Based on your recent diary activity.",moodTag:s.type==="anime"?"Anime night":"Cinematic night",logline:void 0,moodLine:s.type==="anime"?"Animated, emotional, and perfect for a late-night binge.":"Feels like the right vibe for tonight based on your recent watches.",friendsWatchingCount:y.filter(c=>c.title_id===o).length,posterUrl:b(s.poster_url,s.backdrop_url),imdbRating:s.imdb_rating??null,rtTomatoMeter:s.omdb_rt_rating_pct??null},u.add(o)}const p=[],T=[];if(j.slice(0,12).forEach(s=>{const r=f.get(s);if(!r||u.has(s))return;const c=y.filter(l=>l.title_id===s).length;T.push({id:r.id,name:r.title??"Untitled",year:r.year??new Date().getFullYear(),friendsWatchingCount:c,moodTag:r.type==="anime"?"Anime night":"Friends love this",posterUrl:b(r.poster_url,r.backdrop_url),imdbRating:r.imdb_rating??null,rtTomatoMeter:r.omdb_rt_rating_pct??null}),u.add(s)}),T.length>0&&p.push({id:"friends-trending",kind:"friends-trending",title:"Trending with friends",subtitle:"What your circle has been rating and logging recently.",pillLabel:"Social picks",items:T}),o&&f.has(o)&&g.length>0){const s=f.get(o),r=[];g.slice(0,12).forEach(c=>{const l=f.get(c);!l||u.has(c)||(r.push({id:l.id,name:l.title??"Untitled",year:l.year??new Date().getFullYear(),matchReason:`On your watchlist after ${s.title??"that favorite"}.`,posterUrl:b(l.poster_url,l.backdrop_url),imdbRating:l.imdb_rating??null,rtTomatoMeter:l.omdb_rt_rating_pct??null}),u.add(c))}),r.length>0&&p.push({id:"because-you-liked",kind:"because-you-liked",title:`Because you liked ${s.title??"this"}`,subtitle:"Watchlist picks tuned by your recent favorites.",pillLabel:"Taste match",items:r})}const k=[];S.slice(0,12).forEach(s=>{u.has(s.id)||(k.push({id:s.id,name:s.title??"Untitled",year:s.year??new Date().getFullYear(),matchReason:"Anime in your catalog and trending in MoviNesta.",posterUrl:b(s.poster_url,s.backdrop_url),imdbRating:s.imdb_rating??null,rtTomatoMeter:s.omdb_rt_rating_pct??null}),u.add(s.id))}),k.length>0&&p.push({id:"popular-anime",kind:"anime",title:"Popular anime right now",subtitle:"Heart-punching stories, cozy vibes, and a bit of chaos.",pillLabel:"Anime corner",items:k});const F=[];return w.slice(0,12).forEach(s=>{const r=f.get(s);if(!r||u.has(s))return;const c=v.find(z=>z.title_id===s),l=r.imdb_rating??null,V=r.omdb_rt_rating_pct??null;let M;c?.status==="watching"?M="In progress — pick up where you left off.":c?.status==="want_to_watch"&&(M="On your Watchlist and waiting for a good night."),F.push({id:r.id,name:r.title??"Untitled",year:r.year??new Date().getFullYear(),runtimeMinutes:r.runtime_minutes??void 0,matchReason:M,posterUrl:b(r.poster_url,r.backdrop_url),imdbRating:l,rtTomatoMeter:V}),u.add(s)}),F.length>0&&p.push({id:"continue",kind:"continue",title:"Continue swiping / watching",subtitle:"Pick up right where your last movie night left off.",pillLabel:"On deck",items:F}),{tonightPick:D,sections:p,hasPartialData:n}},ne=()=>{const{user:t}=Q(),{data:a,isLoading:i,isFetching:d,error:n}=G({queryKey:["home-for-you",t?.id],enabled:!!t?.id,staleTime:1e3*20,refetchOnWindowFocus:!0,refetchOnReconnect:!0,queryFn:async()=>t?.id?ae(t.id):{tonightPick:null,sections:[],hasPartialData:!1}}),m=n?ie(n):null;return n&&console.error("[HomeForYouTab] Failed to load recommendations",n),{isLoading:i||!a&&d,error:m,tonightPick:a?.tonightPick??null,sections:a?.sections??[],hasPartialData:a?.hasPartialData??!1}},ye=()=>{const{isLoading:t,error:a,tonightPick:i,sections:d,hasPartialData:n}=ne(),m=!!i||d.length>0;return e.jsxs("div",{className:"space-y-4",children:[a&&e.jsx("div",{role:"alert",className:"rounded-2xl border border-destructive/60 bg-destructive/10 px-3 py-2 text-xs text-destructive",children:a}),t?e.jsx(ee,{}):i?e.jsx(oe,{pick:i}):e.jsx(se,{}),t&&e.jsx(te,{}),!t&&d.length>0&&e.jsx("div",{className:"space-y-3",children:d.map(h=>e.jsx(le,{section:h},h.id))}),!t&&n&&!a&&e.jsx("p",{className:"rounded-2xl border border-border-soft bg-muted px-3 py-2 text-xs text-muted-foreground",children:"Some rows might be missing while we catch up on your follows and anime data, but your main recommendations are still here."}),!t&&!m&&e.jsx(re,{})]})},oe=({pick:t})=>{const a=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)&&t.imdbRating>0,i=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)&&t.rtTomatoMeter>0;return e.jsxs("section",{className:"rounded-2xl border border-border bg-card/95 p-4 text-xs text-muted-foreground shadow-lg",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsxs(I,{variant:"accent",className:"gap-1 px-2.5 py-0.5 text-xs",children:[e.jsx(C,{className:"h-3.5 w-3.5","aria-hidden":!0}),e.jsx("span",{children:"Tonight's pick for you"})]}),t.runtimeMinutes?e.jsxs(I,{className:"gap-1 px-2 py-0.5 text-xs",children:[e.jsx(A,{className:"h-3 w-3","aria-hidden":!0}),e.jsxs("span",{children:[t.runtimeMinutes," min"]})]}):null]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(U,{to:`/title/${t.id}`,className:"relative flex h-28 w-20 shrink-0 overflow-hidden rounded-2xl bg-background/80 shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[t.posterUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.posterUrl,alt:t.name,className:"h-full w-full object-cover"}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-t from-black/65 via-black/20 to-transparent"})]}):e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-1 bg-gradient-to-br from-card/80 via-background to-primary/70 text-xs text-muted-foreground",children:[e.jsx(N,{className:"h-4 w-4 text-primary","aria-hidden":!0}),e.jsx("span",{children:"No poster yet"})]}),e.jsxs("div",{className:"pointer-events-none absolute bottom-1 left-1 right-1 space-y-0.5 px-1.5",children:[e.jsx("span",{className:"inline-flex items-center rounded-full bg-background/80 px-2 py-0.5 text-[9px] font-semibold uppercase tracking-[0.18em] text-primary",children:t.year}),e.jsx("span",{className:"block text-xs font-heading font-semibold text-primary-foreground line-clamp-3 drop-shadow",children:t.name})]})]}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-1",children:[e.jsxs("h2",{className:"text-sm font-heading font-semibold text-foreground",children:["Movie night mood: ",t.moodTag??"Surprise me"]}),t.logline&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3",children:t.logline}),t.moodLine&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.moodLine}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1.5 rounded-full bg-primary px-3 py-1.5 text-xs font-medium text-primary-foreground shadow-md hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[e.jsx(Z,{className:"h-3.5 w-3.5","aria-hidden":!0}),e.jsx("span",{children:"Add to Watchlist"})]}),e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1.5 rounded-full border border-border bg-background/80 px-3 py-1.5 text-xs text-muted-foreground hover:border-primary/70 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[e.jsx(J,{className:"h-3.5 w-3.5","aria-hidden":!0}),e.jsx("span",{children:"Why this pick?"})]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[t.friendsWatchingCount?e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3","aria-hidden":!0}),e.jsxs("span",{children:["Watched by ",t.friendsWatchingCount," friend(s)"]})]}):null,a&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-muted-foreground",children:"IMDb Rating"}),e.jsx("span",{children:t.imdbRating.toFixed(1)})]}),i&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-muted-foreground",children:"Tomatometer"}),e.jsxs("span",{children:[t.rtTomatoMeter,"%"]})]}),t.matchReason&&e.jsxs("span",{className:"line-clamp-1",children:[e.jsx("span",{className:"font-medium text-muted-foreground",children:"Because: "}),t.matchReason]})]})]})]})]})},le=({section:t})=>t.items.length?e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h3",{className:"text-[12px] font-heading font-semibold text-foreground",children:t.title}),t.pillLabel&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-card/80 px-2 py-0.5 text-[9px] text-muted-foreground",children:t.pillLabel})]}),t.subtitle&&e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground line-clamp-2",children:t.subtitle})]}),e.jsxs("button",{type:"button","aria-label":`See all for ${t.title}`,className:"inline-flex items-center gap-1 rounded-full border border-border bg-background/80 px-2.5 py-1 text-xs text-muted-foreground hover:border-primary/70 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[e.jsx("span",{children:"See all"}),e.jsx($,{className:"h-3 w-3","aria-hidden":"true"})]})]}),e.jsx("div",{className:"-mx-1 overflow-x-auto pb-1",children:e.jsx("div",{className:"flex snap-x snap-mandatory gap-2 px-1",children:t.items.map(a=>e.jsx(ce,{item:a,sectionKind:t.kind},a.id))})})]}):null,de={"friends-trending":{icon:Y,label:"Friends"},"because-you-liked":{icon:N,label:"Match"},anime:{icon:C,label:"Anime"},continue:{icon:A,label:"Continue"}},ce=({item:t,sectionKind:a})=>{const i=[];t.friendsWatchingCount&&i.push(`Watched by ${t.friendsWatchingCount} friend(s)`),t.runtimeMinutes&&i.push(`${t.runtimeMinutes} min`);const d=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)&&t.imdbRating>0,n=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)&&t.rtTomatoMeter>0;d&&i.push(`IMDb Rating ${t.imdbRating.toFixed(1)}`),n&&i.push(`Tomatometer ${t.rtTomatoMeter}%`);const m=de[a],h=m.icon;return e.jsxs(U,{to:`/title/${t.id}`,className:"group flex w-[160px] shrink-0 snap-start flex-col overflow-hidden rounded-2xl border border-border bg-card/90 text-xs text-muted-foreground shadow-md no-underline outline-none ring-offset-2 ring-offset-background focus-visible:ring-2 focus-visible:ring-primary",children:[e.jsxs("div",{className:"relative h-32 overflow-hidden",children:[t.posterUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.posterUrl,alt:t.name,className:"h-full w-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/45 via-background/40 to-primary/75"})]}):e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-1 bg-gradient-to-br from-card/80 via-background to-primary/70 text-xs text-muted-foreground",children:[e.jsx(N,{className:"h-4 w-4 text-primary","aria-hidden":!0}),e.jsx("span",{children:"Poster missing"})]}),e.jsx("div",{className:"relative flex h-full flex-col justify-between p-2.5",children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"line-clamp-2 text-xs font-heading font-semibold text-foreground",children:t.name}),t.matchReason&&e.jsx("p",{className:"line-clamp-2 text-[9px] text-muted-foreground",children:t.matchReason})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col justify-between gap-1 px-2.5 py-2",children:[i.length>0&&e.jsx("p",{className:"line-clamp-1 text-[9px] text-muted-foreground",children:i.join(" • ")}),e.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-muted-foreground",children:[e.jsx(h,{className:"h-3 w-3","aria-hidden":!0}),e.jsx("span",{children:m.label})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-primary group-hover:underline",children:[e.jsx("span",{className:"text-xs font-medium",children:"Open"}),e.jsx($,{className:"h-2.5 w-2.5","aria-hidden":"true"})]})]})]})]})};export{te as CarouselsSkeleton,ee as TonightPickSkeleton,ye as default};
