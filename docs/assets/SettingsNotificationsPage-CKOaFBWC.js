import{C as x,b as g,c as j,j as e,z as N,r as u,e as v,w,B as _,E as S,F as k,s as A}from"./index-DHFRnTo7.js";import{T as C}from"./TopBar-CUlPtX08.js";import{B as P}from"./bell-DVRPzCbj.js";import{C as E}from"./circle-check-DO3oUZ9s.js";import{C as R}from"./circle-alert-C1loB_9g.js";import"./arrow-left-ByB34Gn9.js";const M=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],F=x("inbox",M);const I=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],B=x("info",I);const L=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],T=x("thumbs-up",L),m={emailActivity:!0,emailRecommendations:!0,inAppSocial:!0,inAppSystem:!0},h=["notification-preferences"],q=({initialPrefs:n,user:i,onSave:p})=>{const[r,c]=u.useState(n),[d,o]=u.useState("idle"),t=v(),s=w({mutationFn:p,onSuccess:a=>{o("saved"),t.setQueryData(h,{user_id:i.id,email_activity:a.emailActivity,email_recommendations:a.emailRecommendations,in_app_social:a.inAppSocial,in_app_system:a.inAppSystem,updated_at:a.updatedAt})},onError:a=>{console.error("Failed to save notification preferences",a),o("error")}}),l=a=>y=>{c(b=>({...b,[a]:y.target.checked})),o("idle")},f=async()=>{s.isPending||await s.mutateAsync(r)};return e.jsxs("section",{className:"space-y-4 px-4 pb-24",children:[e.jsxs("div",{className:"space-y-3 rounded-2xl border border-border bg-card/80 p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-border/50",children:e.jsx(F,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h2",{className:"text-sm font-heading font-semibold text-foreground",children:"Email"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Occasional updates from MoviNesta in your inbox."})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 text-[12px]",children:[e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-foreground",children:"Activity on your content"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"New followers, comments, and reactions."})]}),e.jsx("input",{type:"checkbox",checked:r.emailActivity,onChange:l("emailActivity"),className:"mt-1 h-4 w-4 rounded border-border bg-background text-primary","aria-label":"Email activity notifications"})]}),e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-foreground",children:"Recommendations"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"Personalized movie picks and weekly digests."})]}),e.jsx("input",{type:"checkbox",checked:r.emailRecommendations,onChange:l("emailRecommendations"),className:"mt-1 h-4 w-4 rounded border-border bg-background text-primary","aria-label":"Email recommendations"})]})]})]}),e.jsxs("div",{className:"space-y-3 rounded-2xl border border-border bg-card/80 p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-border/50",children:e.jsx(P,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h2",{className:"text-sm font-heading font-semibold text-foreground",children:"In-app notifications"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"What shows up inside the app. Push and OS-level settings still apply."})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 text-[12px]",children:[e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-foreground",children:"Social activity"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"Follows, reactions, and friend activity."})]}),e.jsx("input",{type:"checkbox",checked:r.inAppSocial,onChange:l("inAppSocial"),className:"mt-1 h-4 w-4 rounded border-border bg-background text-primary","aria-label":"In-app social notifications"})]}),e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-foreground",children:"System messages"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"Account notices, billing, and other important updates."})]}),e.jsx("input",{type:"checkbox",checked:r.inAppSystem,onChange:l("inAppSystem"),className:"mt-1 h-4 w-4 rounded border-border bg-background text-primary","aria-label":"In-app system messages"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-1",children:[e.jsxs("div",{className:"min-h-[20px] flex-1 text-xs",children:[d==="saved"&&e.jsxs("div",{className:"flex items-center gap-1.5 text-emerald-400",children:[e.jsx(E,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Notification preferences saved to your account."})]}),d==="error"&&e.jsxs("div",{className:"flex items-center gap-1.5 text-destructive",children:[e.jsx(R,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Couldn't save preferences. Try again."})]})]}),e.jsxs(_,{type:"button",size:"sm",onClick:f,disabled:s.isPending,children:[s.isPending?e.jsx(S,{className:"h-3.5 w-3.5 animate-spin","aria-hidden":"true"}):e.jsx(T,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:s.isPending?"Saving…":"Save preferences"})]})]})]})},U=()=>{const{user:n}=g(),{data:i,isLoading:p,isError:r,error:c}=j({queryKey:h,enabled:!!n,queryFn:async()=>{const{data:t,error:s}=await A.from("notification_preferences").select("user_id, email_activity, email_recommendations, in_app_social, in_app_system, updated_at").eq("user_id",n.id).maybeSingle();if(s)throw s;return t||{user_id:n.id,email_activity:m.emailActivity,email_recommendations:m.emailRecommendations,in_app_social:m.inAppSocial,in_app_system:m.inAppSystem,updated_at:new Date().toISOString()}}}),d=async t=>{const s=await k("update-notification-prefs",{emailActivity:t.emailActivity,emailRecommendations:t.emailRecommendations,inAppSocial:t.inAppSocial,inAppSystem:t.inAppSystem});if(!s.ok)throw new Error(s.error??"Unable to save preferences");return s.preferences};if(!n)return e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md rounded-2xl border border-border bg-card/80 px-4 py-6 text-center text-sm text-foreground shadow-lg",children:[e.jsx("h1",{className:"text-base font-heading font-semibold",children:"You're signed out"}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Sign in to manage how MoviNesta contacts you."})]})});if(p)return e.jsx(N,{message:"Loading your notification preferences…"});if(r||!i)return e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md rounded-2xl border border-border bg-card/80 px-4 py-6 text-center text-sm text-foreground shadow-lg",children:[e.jsx("h1",{className:"text-base font-heading font-semibold",children:"Notifications unavailable"}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"We couldn't load your preferences right now."}),c&&e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Details:"})," ",c.message]})]})});const o={emailActivity:i.email_activity,emailRecommendations:i.email_recommendations,inAppSocial:i.in_app_social,inAppSystem:i.in_app_system};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-2 pt-1",children:[e.jsx(C,{title:"Notifications"}),e.jsxs("div",{className:"mx-4 flex items-start gap-2 rounded-md border border-border bg-card/70 p-3 text-[12px] text-muted-foreground shadow-lg",children:[e.jsx(B,{className:"mt-0.5 h-4 w-4 text-muted-foreground","aria-hidden":"true"}),e.jsx("p",{className:"leading-relaxed",children:"Notification preferences are saved to your MoviNesta account and sync across devices. These toggles control both in-app surfaces and any email digests you opt into."})]}),e.jsx(q,{initialPrefs:o,user:n,onSave:d},i.updated_at)]})};export{U as default};
