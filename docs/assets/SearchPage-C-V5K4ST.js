import{C as Ve,R as m,j as e,b as ae,r as Pe,c as ke,s as z,D as mt,E as se,L as xe,e as xt,u as Te,F as Me,h as Je,x as ft,q as De,B as k,M as ze,k as ht,l as gt,m as ve,t as pt,G as bt}from"./index-Cuvvv_Gr.js";import{D as yt,a as wt,b as jt,c as vt,e as Nt}from"./dialog-DqZkx-k-.js";import{I as Le}from"./input-BfNIPAJK.js";import{M as Ce}from"./material-icon-B8bKdWpA.js";import{h as _t,u as Ze,d as kt,s as Xe,a as Ct,p as St,b as Ft,c as It,e as Ge}from"./useSearchTitles-CjYRkNqv.js";import{u as et}from"./useSearchPeople-BaMGdwiu.js";import{Y as Lt}from"./index-Bi5j9LVW.js";import{u as Pt}from"./useDiaryLibrary-Bfx02BEK.js";import{i as tt}from"./catalogSync-i5cCA8pA.js";import{F as rt}from"./film-Tyuk0B2O.js";import{S as Oe,B as Ut}from"./star-BaL-rWM6.js";import{u as Rt}from"./useToggleFollow-BvN6w3HA.js";import{X as fe}from"./x-DXpiigCO.js";import{U as Qe,a as Ke}from"./user-plus-Bt1IvgWO.js";import{U as Tt}from"./user-JRG6sCX6.js";import{U as Mt}from"./users-_yUNfWzN.js";import{F as At}from"./FriendAvatarStack-NkEeYLR3.js";import{u as Et}from"./useSuggestedPeople-DImEIKRw.js";const $t=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]],Yt=Ve("bookmark-check",$t);const Bt=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],Ue=Ve("sliders-horizontal",Bt),qt=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),re=({text:t,query:n,className:a,highlightClassName:u,firstOnly:x=!1})=>{const c=(n??"").trim(),o=m.useMemo(()=>{if(!c)return[{chunk:t,hit:!1}];const y=qt(c),h=new RegExp(y,"ig"),l=[];let g=0,d,v=0;for(;(d=h.exec(t))!==null;){d.index>g&&l.push({chunk:t.slice(g,d.index),hit:!1});const i=d[0];if(l.push({chunk:i,hit:!0}),g=d.index+i.length,v+=1,x&&v>=1||i.length===0)break}return g<t.length&&l.push({chunk:t.slice(g),hit:!1}),l.length?l:[{chunk:t,hit:!1}]},[c,t,x]),j=u??"rounded bg-primary/20 px-0.5 text-foreground ring-1 ring-primary/20";return e.jsx("span",{className:a,children:o.map((y,h)=>y.hit?e.jsx("span",{className:j,children:y.chunk},h):e.jsx(m.Fragment,{children:y.chunk},h))})},Dt=t=>typeof t!="string"?!1:/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(t),zt=t=>{const n=[],a=new Set;for(const u of t)u&&(a.has(u)||(a.add(u),n.push(u)));return n},Gt=t=>{const{user:n}=ae(),a=n?.id??null,u=Pe.useMemo(()=>zt((t??[]).filter(o=>Dt(o))).slice(0,200),[t]),x=Pe.useMemo(()=>u.slice().sort().join(","),[u]);return ke({queryKey:["search","titleDiaryBulk",a,x],enabled:!!a&&u.length>0,staleTime:1e3*20,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>{if(!a||u.length===0)return new Map;const c=new Map,[{data:o,error:j},{data:y,error:h}]=await Promise.all([z.from("library_entries").select("title_id,status").eq("user_id",a).in("title_id",u),z.from("ratings").select("title_id,rating").eq("user_id",a).in("title_id",u)]);if(j)throw j;if(h)throw h;return(o??[]).forEach(l=>{const g=l?.title_id;g&&c.set(g,{status:l?.status??null,rating:null})}),(y??[]).forEach(l=>{const g=l?.title_id;if(!g)return;const d=mt(l?.rating??null),v=c.get(g)??{status:null,rating:null};c.set(g,{...v,rating:d})}),c}})},Re=({item:t,query:n,right:a,onSelect:u,disabled:x,loading:c})=>{const o=[];t.year&&o.push(String(t.year)),t.type==="movie"&&o.push("Movie"),t.type==="series"&&o.push("Series"),t.originalLanguage&&o.push(`Language: ${t.originalLanguage}`),t.ageRating&&o.push(t.ageRating),t.imdbRating&&o.push(`IMDb ${t.imdbRating.toFixed(1)}`),t.rtTomatoMeter&&o.push(`RT ${t.rtTomatoMeter}%`);const j={library:"Library","external-synced":"Synced","external-only":"External"},y={library:"bg-primary/10 text-primary border-primary/40","external-synced":"bg-emerald-500/10 text-emerald-400 border-emerald-500/30","external-only":"bg-card text-muted-foreground border-border"},h=e.jsxs(e.Fragment,{children:[t.posterUrl?e.jsx("img",{src:t.posterUrl,alt:t.title,className:"h-20 w-14 rounded-2xl object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-20 w-14 items-center justify-center rounded-2xl bg-muted",children:e.jsx(rt,{className:"h-5 w-5 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-[12px] font-medium text-foreground",children:e.jsx(re,{text:t.title,query:n,firstOnly:!0,className:"truncate"})}),e.jsx("span",{className:`shrink-0 rounded-full border px-2 py-0.5 text-xs font-medium ${y[t.source]}`,children:j[t.source]})]}),o.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:o.join(" • ")}),c?e.jsxs("span",{className:"mt-1 inline-flex items-center gap-1 text-[11px] text-muted-foreground",children:[e.jsx(se,{className:"h-3 w-3 animate-spin","aria-hidden":"true"}),"Syncing…"]}):null]})]});return e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-background/60 p-2 hover:bg-card/80 focus-within:ring-1 focus-within:ring-primary/50",children:[u?e.jsx("button",{type:"button",className:"flex min-w-0 flex-1 gap-3 text-left",onClick:()=>u(t),disabled:x,"aria-disabled":x,children:h}):e.jsx(xe,{to:`/title/${t.id}`,className:"flex min-w-0 flex-1 gap-3",children:h}),a?e.jsx("div",{className:"shrink-0 pr-1",children:a}):null]})},ie=t=>typeof t!="string"?!1:/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(t),Ot=({query:t,filters:n,sortKey:a,onChangeSort:u,onResetFilters:x})=>{const c=t.trim(),o=_t(n),j=!c&&o,y=c.length>0&&c.length<2&&!j,{data:h,isLoading:l,isError:g,error:d,fetchNextPage:v,hasNextPage:i,isFetching:w,isFetchingNextPage:C}=Ze({query:c,filters:n}),L=a??kt(c),N=m.useMemo(()=>(h?.pages??[]).flatMap(b=>Xe({items:b.results??[],query:c,sortKey:L})),[h,L,c]),{user:U}=ae(),T=xt(),q=Pt(),Z=Te(),[S,B]=m.useState({}),I=m.useRef(S);m.useEffect(()=>{I.current=S},[S]);const Q=m.useMemo(()=>{const p=[];for(const b of N){const A=S[b.id]??b.id;ie(A)&&p.push(A)}return p},[N,S]),$=Gt(Q),X=m.useMemo(()=>$.data??new Map,[$.data]),[ne,he]=m.useState(null),[G,K]=m.useState(null),W=m.useCallback(async p=>{const b=p.id;if(ie(b))return b;const A=I.current[b];if(A&&ie(A))return A;if(!p.tmdbId)return null;const _=p.type==="series"?"series":"movie";try{const R=await Me("catalog-sync",{tmdbId:p.tmdbId,contentType:_});if(!tt(R))return null;const D=R.media_item_id;if(D&&ie(D))return B(V=>V[b]?V:{...V,[b]:D}),D}catch(R){console.warn("[SearchTitlesTab] catalog-sync failed",R)}return null},[]),ge=m.useCallback(async p=>{if(U){he(p.id);try{const b=await W(p);if(!b)return;const _=X.get(b)?.status==="want_to_watch",R=Je();if(await ft({sessionId:R,mediaItemId:b,source:"search",eventType:"watchlist",inWatchlist:!_}),_){const{error:D}=await z.from("library_entries").delete().eq("user_id",U.id).eq("title_id",b).eq("status","want_to_watch");if(D)throw D}else await q.updateStatus.mutateAsync({titleId:b,status:"want_to_watch",type:p.type==="series"?"series":"movie",title:p.title,year:p.year,posterUrl:p.posterUrl});T.invalidateQueries({queryKey:["search","titleDiaryBulk",U.id]}),T.invalidateQueries({queryKey:De.diaryLibrary(U.id)}),T.invalidateQueries({queryKey:De.titleDiary(U.id,b)})}catch(b){console.warn("[SearchTitlesTab] watchlist toggle failed",b)}finally{he(null)}}},[X,q.updateStatus,W,T,U]),ee=N.length,pe=m.useCallback(async p=>{if(!G){K(p.id);try{const b=await W(p);if(!b)return;Z(`/title/${b}`)}finally{K(null)}}},[W,Z,G]),Y=[];if(n.type&&n.type!=="all"){const p={movie:"Movies",series:"Series"};Y.push(p[n.type]??"Titles")}typeof n.minYear=="number"&&Y.push(`From ${n.minYear}`),typeof n.maxYear=="number"&&Y.push(`Up to ${n.maxYear}`),n.originalLanguage&&Y.push(`Language: ${n.originalLanguage==="en"?"English":n.originalLanguage}`),n.genreIds?.length&&Y.push(`Genres: ${n.genreIds.length}`);const oe=Y.length?Y.join(" • "):"No filters applied",de=m.useRef(new Set);return m.useEffect(()=>{if(!N||!Array.isArray(N))return;const p=de.current,b=N.filter(_=>!(p.has(_.id)||!_.imdbId&&!_.tmdbId||_.imdbRating||_.rtTomatoMeter)).slice(0,3);(async()=>{for(const _ of b){p.add(_.id);try{const{error:R}=await z.from("media_items").upsert({tmdb_id:_.tmdbId??null,omdb_imdb_id:_.imdbId??null,kind:_.type==="series"?"series":_.type??"movie",tmdb_title:_.title,tmdb_release_date:_.year?`${_.year}-01-01`:null},{onConflict:"kind,tmdb_id"}).select("id");R&&console.warn("[SearchTitlesTab] media_items upsert failed for",_.id,R.message)}catch(R){console.warn("[SearchTitlesTab] media_items upsert threw for",_.id,R)}}})()},[N]),y?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["Keep typing to search titles — enter at least"," ",e.jsx("span",{className:"font-semibold text-foreground",children:"2 characters"}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tip: You can also browse without typing by using filters (genres, year, language)."})]}):!c&&!j?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a title, director, or genre to search the catalog. As you wire Supabase search, results will appear here."}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-xs font-medium text-foreground",children:"Try searching for"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-xs",children:["Sci-fi romance","Feel-good comedies","Films from 2020s","Cozy rainy-day movies"].map(p=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-border px-2 py-1 text-muted-foreground",children:[e.jsx(rt,{className:"mr-1 h-3 w-3 text-muted-foreground","aria-hidden":"true"}),p]},p))})]}),e.jsxs("div",{className:"space-y-1.5 rounded-2xl border border-border bg-background/60 p-3",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs font-medium text-foreground",children:[e.jsx(Oe,{className:"h-3.5 w-3.5 text-primary","aria-hidden":"true"}),e.jsx("span",{children:"Trending this week"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Once analytics are wired up, you can show what your friends and the community are watching the most here."})]})]}):l?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:c?e.jsxs(e.Fragment,{children:["Searching for ",e.jsx("span",{className:"font-semibold text-foreground",children:c}),"…"]}):e.jsx(e.Fragment,{children:"Browsing titles…"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Fetching matching titles from your catalog and external sources.":"Fetching titles that match your selected filters."}),e.jsx("div",{className:"space-y-2",children:[0,1,2].map(p=>e.jsxs("div",{className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2",children:[e.jsx("div",{className:"h-16 w-11 animate-pulse rounded-xl bg-card/60"}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center space-y-1.5",children:[e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-card/60"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-card/40"})]})]},p))})]}):g?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-destructive",children:["Something went wrong while ",c?"searching":"browsing"," titles."]}),d&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Details: "}),d.message]})]}):ee?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-semibold text-foreground",children:ee})," result",ee===1?"":"s"," ",c?"across your catalog and external sources for ":"in your catalog for ",c?e.jsx("span",{className:"font-semibold text-foreground",children:c}):e.jsx("span",{className:"font-semibold text-foreground",children:"your filters"}),"."]}),x?e.jsxs(k,{type:"button",variant:"outline",size:"sm",className:"h-auto rounded-full border-border px-2 py-1 text-muted-foreground hover:border-border hover:text-foreground",onClick:x,children:[e.jsx(Ue,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Reset filters"})]}):null]}),w&&!C?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(se,{className:"h-3.5 w-3.5 animate-spin","aria-hidden":"true"}),"Updating results…"]}):null,e.jsx("div",{className:"rounded-2xl border border-border bg-background/60 p-3",children:e.jsxs("p",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground",children:e.jsx(Ue,{className:"h-3 w-3","aria-hidden":"true"})}),e.jsx("span",{className:"truncate",children:oe})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Sort"}),[{key:"relevance",label:"Relevance"},{key:"newest",label:"Newest"},{key:"rating",label:"Rating"}].filter(p=>c?!0:p.key!=="relevance").map(p=>{const b=L===p.key;return e.jsx(k,{type:"button",size:"sm",variant:b?"default":"outline",className:"h-8 rounded-full px-3",onClick:()=>u?.(p.key),children:p.label},p.key)})]}),e.jsx(Lt,{style:{height:"calc(100dvh - 340px)"},data:N,overscan:200,increaseViewportBy:{top:200,bottom:700},endReached:()=>{i&&!C&&v()},components:{List:m.forwardRef(function(b,A){return e.jsx("div",{ref:A,className:"space-y-2",...b})}),Footer:()=>i?e.jsx("div",{className:"flex justify-center py-3",children:e.jsx(k,{type:"button",className:"inline-flex items-center justify-center rounded-full bg-primary/90 disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>v(),disabled:C,children:C?"Loading more…":"Load more results"})}):null},itemContent:(p,b)=>{const A=ie(b.id)?b.id:S[b.id]??null,_=A?X.get(A):null,R=_?.status==="want_to_watch",D=!!U&&(ie(b.id)||!!b.tmdbId),V=ne===b.id,Se=U?e.jsxs("div",{className:"flex items-center gap-2",children:[typeof _?.rating=="number"?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-border bg-card/50 px-2 py-1 text-[11px] text-muted-foreground",children:[e.jsx(Oe,{className:"h-3 w-3","aria-hidden":"true"}),_.rating]}):null,e.jsx(k,{type:"button",size:"icon",variant:R?"secondary":"outline",className:"h-9 w-9 rounded-full",onClick:()=>ge(b),disabled:!D||V||q.updateStatus.isPending,title:R?"Remove from watchlist":"Add to watchlist","aria-label":R?"Remove from watchlist":"Add to watchlist",children:V?e.jsx(se,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}):R?e.jsx(Yt,{className:"h-4 w-4","aria-hidden":"true"}):e.jsx(Ut,{className:"h-4 w-4","aria-hidden":"true"})})]}):null;return e.jsx(Re,{item:b,query:c,right:Se,onSelect:pe,disabled:!!G,loading:G===b.id})}})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:c?e.jsxs(e.Fragment,{children:["No titles found matching"," ",e.jsx("span",{className:"font-semibold text-foreground",children:c}),"."]}):e.jsx(e.Fragment,{children:"No titles match these filters."})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Try adjusting your search or removing some filters to see more results.":"Try removing a few filters to broaden the results."})]})},Qt=(t,n)=>{const a=(t??n??"").trim();if(!a)return"?";const u=a.split(/\s+/).filter(Boolean);return u.length===1?u[0].slice(0,2).toUpperCase():(u[0][0]+u[1][0]).toUpperCase()},Kt=({avatarUrl:t,displayName:n,username:a,sizePx:u})=>{const x=Qt(n,a);return t?e.jsx("img",{src:t,alt:n??a??"Profile",className:"shrink-0 rounded-full object-cover",style:{width:u,height:u},loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"flex shrink-0 items-center justify-center rounded-full bg-muted text-xs font-bold text-foreground",style:{width:u,height:u},"aria-label":"Profile initials",children:x})},je=({person:t,variant:n="full",showFollow:a=!0,showMessage:u=!0,showDismiss:x=!1,onDismiss:c,highlightQuery:o,className:j})=>{const y=Te(),{user:h}=ae(),l=Rt(),[g,d]=m.useState(!1),v=t.displayName??t.username??"Unknown",i=t.username?`@${t.username}`:null,w=!!(h?.id&&h.id===t.id),C=t.username?`/u/${t.username}`:`/u/${t.id}`,L=l.isPending&&l.variables?.targetUserId===t.id,N=async()=>{if(!h?.id){alert("You need to be signed in to start a conversation.");return}if(h.id===t.id){alert("You can't start a conversation with yourself.");return}d(!0);try{const S=await Me("create-direct-conversation",{targetUserId:t.id},{timeoutMs:25e3});if(!S?.ok||!S.conversationId){const B=S?.code;let I=S?.error??"Failed to start a conversation. Please try again.";B==="UNAUTHORIZED"?I="You need to be signed in to start a conversation.":B==="BAD_REQUEST_SELF_TARGET"?I="You can't start a conversation with yourself.":B==="SERVER_MISCONFIGURED"&&(I="Messaging is temporarily unavailable due to a server issue. Please try again later.");const Q=new Error(I);throw Q.code=B,Q}y(`/messages/${S.conversationId}`)}catch(S){console.error("[PeopleResultRow] Failed to start conversation",S);const B=S instanceof Error?S.message:"Something went wrong while starting the conversation. Please try again.";alert(B)}finally{d(!1)}},U=a&&!!h?.id&&!w,T=u&&!!h?.id&&!w,q=x&&!!h?.id&&!!c,Z=()=>!(typeof t.followersCount=="number"||typeof t.followingCount=="number")&&!t.matchPercent?null:e.jsxs("div",{className:"mt-0.5 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[typeof t.matchPercent=="number"?e.jsxs("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] font-medium text-foreground",children:["Match ",t.matchPercent,"%"]}):null,typeof t.followersCount=="number"?e.jsxs("span",{children:[t.followersCount," follower",t.followersCount===1?"":"s"]}):null,typeof t.followersCount=="number"&&typeof t.followingCount=="number"?e.jsx("span",{children:"·"}):null,typeof t.followingCount=="number"?e.jsxs("span",{children:["following ",t.followingCount]}):null]});if(n==="compact"){const S=!!t.bio&&x;return e.jsxs("div",{className:`flex items-center justify-between gap-3 rounded-2xl border border-border bg-card/70 px-3 py-2 hover:bg-card ${j??""}`,children:[e.jsxs(xe,{to:C,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx(Kt,{avatarUrl:t.avatarUrl,displayName:t.displayName,username:t.username,sizePx:36}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{text:v,query:o,firstOnly:!0,className:"block truncate text-sm font-semibold text-foreground"}),typeof t.matchPercent=="number"?e.jsxs("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] font-medium text-foreground",children:["Match ",t.matchPercent,"%"]}):null,w?e.jsx("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] text-muted-foreground",children:"You"}):null]}),i?e.jsx(re,{text:i,query:o,firstOnly:!0,className:"block truncate text-xs text-muted-foreground"}):null,S?e.jsx(re,{text:t.bio??"",query:o,firstOnly:!0,className:"mt-0.5 line-clamp-1 text-xs text-muted-foreground",highlightClassName:"rounded bg-primary/15 px-0.5 text-foreground ring-1 ring-primary/15"}):null]})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-2",children:[q?e.jsx("button",{type:"button",className:"rounded-full p-2 text-muted-foreground hover:bg-muted","aria-label":"Dismiss suggestion",onClick:c,children:e.jsx(fe,{className:"h-4 w-4"})}):null,T?e.jsx(k,{type:"button",variant:"outline",size:"sm",className:"h-8 rounded-full border-border bg-card/80 px-3 text-xs",onClick:N,disabled:g,children:e.jsx(ze,{className:"h-3.5 w-3.5","aria-hidden":"true"})}):null,U?e.jsx(k,{type:"button",onClick:()=>l.mutate({targetUserId:t.id,currentlyFollowing:!!t.isFollowing}),disabled:L,variant:t.isFollowing?"outline":"default",size:"sm",className:`h-8 rounded-full px-3 text-xs font-medium ${t.isFollowing?"border-border bg-card/80 text-foreground hover:border-primary/70":"bg-primary text-primary-foreground hover:bg-primary/90"}`,children:L?e.jsx("span",{children:"…"}):t.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}):null]})]})}return e.jsxs("div",{className:`flex items-center justify-between gap-3 rounded-2xl border border-border bg-card/80 px-3 py-2 hover:bg-card/80 ${j??""}`,children:[e.jsxs(xe,{to:C,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-card/80 text-[14px] font-semibold text-foreground",children:t.avatarUrl?e.jsx("img",{src:t.avatarUrl,alt:v,className:"h-9 w-9 rounded-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):v?v[0]?.toUpperCase():e.jsx(Tt,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{text:v,query:o,firstOnly:!0,className:"block truncate text-sm font-medium text-foreground"}),w?e.jsx("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] text-muted-foreground",children:"You"}):null]}),i?e.jsx(re,{text:i,query:o,firstOnly:!0,className:"mt-0.5 block truncate text-xs text-muted-foreground"}):null,t.bio?e.jsx(re,{text:t.bio,query:o,firstOnly:!0,className:"mt-0.5 line-clamp-2 text-xs text-muted-foreground",highlightClassName:"rounded bg-primary/15 px-0.5 text-foreground ring-1 ring-primary/15"}):null,Z()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[q?e.jsx("button",{type:"button",className:"rounded-full p-2 text-muted-foreground hover:bg-muted","aria-label":"Dismiss suggestion",onClick:c,children:e.jsx(fe,{className:"h-4 w-4"})}):null,U?e.jsx(k,{type:"button",onClick:()=>l.mutate({targetUserId:t.id,currentlyFollowing:!!t.isFollowing}),disabled:L,variant:t.isFollowing?"outline":"default",size:"sm",className:`h-auto rounded-full px-2.5 py-1.5 text-xs font-medium ${t.isFollowing?"border-border bg-card/80 text-foreground hover:border-primary/70 disabled:opacity-60":"border border-transparent bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-60"}`,children:L?e.jsx("span",{children:"Updating…"}):t.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}):null,T?e.jsx(k,{type:"button",onClick:N,disabled:g,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-card/80 px-2.5 py-1.5 text-xs font-medium text-foreground shadow-md hover:border-primary/70 hover:text-foreground disabled:cursor-not-allowed disabled:opacity-60",children:g?e.jsx("span",{children:"Starting…"}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Message"})]})}):null]})]})},Ht=({query:t})=>{const n=t.trim(),a=n.replace(/^@+/,""),u=a||n,x=a.length>0&&a.length<2,{data:c,isLoading:o,isFetching:j,isError:y,error:h}=et(a),l=c??[];if(x)return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["Keep typing to search people — enter at least"," ",e.jsx("span",{className:"font-semibold text-foreground",children:"2 characters"}),"."]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Tip: You can type ",e.jsx("span",{className:"font-semibold text-foreground",children:"@"})," to search usernames."]})]});if(!a)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a name or @username to find people. Once the social graph is wired up, you'll be able to follow friends and start conversations from here."}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-2 text-xs text-muted-foreground",children:[e.jsx(Mt,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Search for people you know, then follow or message them."})]})]});if(o)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Searching for people…"}),e.jsx("div",{className:"rounded-2xl border border-border bg-card/80 px-3 py-4 text-xs text-muted-foreground",children:"We'll show matching profiles here as soon as the results come back."})]});if(y)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-foreground",children:"Something went wrong."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h?.message??"We couldn&apos;t search for people right now. Please try again."})]});if(!l||l.length===0)return e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No people found for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",u,"”"]}),". Try a different name or username."]})});const g=l.map(d=>({id:d.id,username:d.username,displayName:d.displayName,avatarUrl:d.avatarUrl,bio:d.bio,followersCount:d.followersCount??null,followingCount:d.followingCount??null,isFollowing:d.isFollowing,matchPercent:d.matchPercent??null}));return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",l.length," profile",l.length===1?"":"s"," for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",u,"”"]})]})}),j?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(se,{className:"h-3.5 w-3.5 animate-spin","aria-hidden":"true"}),"Updating results…"]}):null,e.jsx("div",{className:"space-y-2",children:g.map(d=>e.jsx(je,{person:d,variant:"full",highlightQuery:a},d.id))})]})},st="movinesta.search.recent",Wt=t=>{if(!t)return[];try{const n=JSON.parse(t);return Array.isArray(n)?n.map(a=>({term:typeof a?.term=="string"?a.term:"",ts:typeof a?.ts=="number"?a.ts:0})).filter(a=>a.term.trim().length>0).slice(0,20):[]}catch{return[]}},Ae=t=>{try{localStorage.setItem(st,JSON.stringify(t))}catch{}},Ne=()=>{if(typeof window>"u")return[];try{return Wt(localStorage.getItem(st))}catch{return[]}},Vt=(t,n=10)=>{if(typeof window>"u")return;const a=t.trim();if(a.length<2)return;const u=Date.now(),x=Ne(),c=[{term:a,ts:u},...x.filter(o=>o.term.toLowerCase()!==a.toLowerCase())].slice(0,n);Ae(c),window.dispatchEvent(new CustomEvent("movinesta:recent-searches"))},Jt=t=>{if(typeof window>"u")return;const n=t.trim(),u=Ne().filter(x=>x.term.toLowerCase()!==n.toLowerCase());Ae(u),window.dispatchEvent(new CustomEvent("movinesta:recent-searches"))},Zt=()=>{typeof window>"u"||(Ae([]),window.dispatchEvent(new CustomEvent("movinesta:recent-searches")))};function _e(t){return typeof t!="number"||!Number.isFinite(t)?null:t.toFixed(1)}function Xt(t){const n=(t?.mediaItemId??"").toString(),a=(t?.title??"").toString().trim();if(!n||!a)return null;const u=(t?.posterUrl&&t.posterUrl.trim()?t.posterUrl:null)??(t?.tmdbPosterPath?pt(t.tmdbPosterPath,"w500"):null);return{id:n,title:a,imageUrl:u,ratingLabel:_e(t?.imdbRating??null),subtitle:t?.why?String(t.why):null,friendAvatarUrls:(t?.friendProfiles??[]).map(x=>x?.avatar_url?String(x.avatar_url):null).filter(x=>!!x).slice(0,3),friendExtraCount:Math.max(0,((t?.friendProfiles??[]).length||0)-3)}}function er(t,n){const a=ve(t.media_item),u=a.id;if(!u||!a.title)return null;const x=a.posterUrl??a.backdropUrl??null,c=_e(a.imdbRating??null);return{id:u,title:a.title,imageUrl:x,ratingLabel:c,subtitle:null,friendAvatarUrls:n?[n]:[],friendExtraCount:0}}function tr(t=10){const{user:n}=ae(),a=n?.id??null,u=async()=>{const x=`
      id,
      kind,
      tmdb_id,
      tmdb_title,
      tmdb_name,
      tmdb_original_title,
      tmdb_original_name,
      tmdb_release_date,
      tmdb_first_air_date,
      tmdb_poster_path,
      tmdb_backdrop_path,
      tmdb_original_language,
      tmdb_genre_ids,
      tmdb_vote_average,
      tmdb_vote_count,
      tmdb_popularity,
      omdb_title,
      omdb_year,
      omdb_language,
      omdb_imdb_id,
      omdb_imdb_rating,
      omdb_rating_rotten_tomatoes,
      omdb_poster,
      omdb_rated
    `,c=h=>{if(!h)return null;const l=String(h).trim();return l||null};try{const{data:h,error:l}=await z.from("media_item_trending_72h").select("media_item_id, trend_score").order("trend_score",{ascending:!1}).limit(Math.max(10,Math.min(t*6,80)));if(!l&&Array.isArray(h)&&h.length){const g=new Map,d=[];for(const v of h){const i=c(v?.media_item_id);if(!i)continue;const w=Number(v?.trend_score??0);if(g.has(i)||d.push(i),g.set(i,Number.isFinite(w)?w:0),d.length>=Math.max(10,Math.min(t*4,40)))break}if(d.length){const{data:v,error:i}=await z.from("media_items").select(x).in("id",d).in("kind",["movie","series"]).limit(d.length);if(!i&&Array.isArray(v)&&v.length){const C=v.map(L=>{const N=ve(L);return!N?.id||!N?.title?null:{id:N.id,title:N.title,imageUrl:N.posterUrl??N.backdropUrl??null,ratingLabel:_e(N.imdbRating??null),subtitle:null,friendAvatarUrls:[],friendExtraCount:0,_score:g.get(N.id)??0}}).filter(L=>L!==null);return C.sort((L,N)=>N._score-L._score),C.slice(0,Math.max(1,Math.min(t,24))).map(L=>{const{_score:N,...U}=L;return U})}i&&console.warn("[search.discover] trending view -> media_items lookup failed",i)}}l&&console.warn("[search.discover] trending view unavailable",l)}catch(h){console.warn("[search.discover] trending view fallback threw",h)}const{data:o,error:j}=await z.from("media_items").select(x).in("kind",["movie","series"]).order("tmdb_popularity",{ascending:!1,nullsFirst:!1}).order("tmdb_vote_count",{ascending:!1,nullsFirst:!1}).order("tmdb_vote_average",{ascending:!1,nullsFirst:!1}).order("tmdb_release_date",{ascending:!1,nullsFirst:!1}).order("tmdb_first_air_date",{ascending:!1,nullsFirst:!1}).limit(Math.max(1,Math.min(t,24)));return j?(console.warn("[search.discover] popularity fallback trending query failed",j),[]):(Array.isArray(o)?o:[]).map(h=>{const l=ve(h);return!l?.id||!l?.title?null:{id:l.id,title:l.title,imageUrl:l.posterUrl??l.backdropUrl??null,ratingLabel:_e(l.imdbRating??null),subtitle:null,friendAvatarUrls:[],friendExtraCount:0}}).filter(h=>h!==null)};return ke({queryKey:["search","discover","trending",a??"anon",t],enabled:!0,staleTime:1e3*60*10,retry:1,retryDelay:750,queryFn:async()=>{try{const x=Je(),c=ht(x,"trending",null),j=(await gt({sessionId:x,mode:"trending",limit:t,seed:c})).cards.map(Xt).filter(y=>!!y);if(j.length)return j}catch(x){console.warn("[search.discover] trending deck failed, falling back",x)}return await u()}})}function rr(t){const n=(t?.id??"").toString(),a=t?.avatar_url?String(t.avatar_url):null;return{id:n,avatarUrl:a}}function sr(t){if(!t||typeof t!="object")return!1;const n=t;return typeof n.id=="string"&&typeof n.created_at=="string"&&typeof n.user_id=="string"&&typeof n.event_type=="string"}function ar(t=8){const{user:n}=ae(),a=n?.id??null;return ke({queryKey:["search","discover","friends",a,t],enabled:!!a,staleTime:1e3*60*2,queryFn:async()=>{if(!a)return[];const{data:x,error:c}=await z.rpc("get_home_feed_v2",{p_user_id:a,p_limit:200,p_cursor_created_at:null,p_cursor_id:null});if(c)throw new Error(c.message);const j=(Array.isArray(x)?x:[]).filter(sr).filter(l=>l.user_id!==a&&typeof l.media_item_id=="string"&&l.media_item_id),y=new Map;for(const l of j){const g=l.media_item_id??"";if(!g)continue;const d=rr(l.actor_profile),v=d.id||l.user_id,i=y.get(g)??{row:l,users:new Map,watched:0,watchlist:0,rated:0};new Date(l.created_at).getTime()>new Date(i.row.created_at).getTime()&&(i.row=l),v&&i.users.set(v,d.avatarUrl??null),l.event_type==="watched"&&(i.watched+=1),l.event_type==="watchlist_added"&&(i.watchlist+=1),l.event_type==="rating_created"&&(i.rated+=1),y.set(g,i)}return Array.from(y.values()).map(l=>{const g=l.users.size,d=er(l.row,null);if(!d)return null;const v=Array.from(l.users.values()).filter(i=>typeof i=="string"&&i.trim().length>0);return d.friendAvatarUrls=v.slice(0,3),d.friendExtraCount=Math.max(0,g-3),l.watched>0?d.subtitle=`${l.watched} friend${l.watched===1?"":"s"} watched`:l.watchlist>0?d.subtitle=`${l.watchlist} friend${l.watchlist===1?"":"s"} added to watchlist`:l.rated>0?d.subtitle=`${l.rated} friend${l.rated===1?"":"s"} rated`:d.subtitle=`${g} friend${g===1?"":"s"} active`,{poster:d,total:g}}).filter(l=>!!l).sort((l,g)=>g.total-l.total).slice(0,t).map(l=>l.poster)}})}function nr(t=8){const{user:n}=ae(),a=!!n?.id;return ke({queryKey:["search","discover","curated_lists",t],enabled:a,staleTime:1e3*60*10,queryFn:async()=>{const{data:u,error:x}=await z.from("lists").select("id, name, description, user_id, updated_at").eq("is_public",!0).order("updated_at",{ascending:!1}).limit(t);if(x)throw new Error(x.message);const c=u??[],o=c.map(w=>w.id),j=Array.from(new Set(c.map(w=>w.user_id))),[{data:y,error:h},{data:l,error:g}]=await Promise.all([z.from("profiles_public").select("id, username, display_name, avatar_url").in("id",j),z.from("list_items").select(`list_id, title_id, position,
               media_items: title_id (
                 id,
                 omdb_poster,
                 tmdb_poster_path,
                 tmdb_backdrop_path,
                 tmdb_title,
                 tmdb_name,
                 tmdb_release_date,
                 tmdb_first_air_date,
                 tmdb_original_language,
                 kind,
                 omdb_imdb_rating,
                 omdb_rating_rotten_tomatoes
               )`).in("list_id",o).order("position",{ascending:!0}).limit(t*6)]);if(h)throw new Error(h.message);if(g)throw new Error(g.message);const d=new Map;for(const w of y??[])d.set(w.id,w);const v=new Map;for(const w of l??[]){const C=w.list_id;!C||v.has(C)||v.set(C,w)}return c.map(w=>{const C=d.get(w.user_id)??null,L=(C?.display_name?.toString().trim()||C?.username?.toString().trim())??"Someone",U=v.get(w.id)?.media_items??null,T=U?ve(U):null,q=T?.posterUrl??T?.backdropUrl??null;return{id:w.id,name:w.name,description:w.description,owner:{id:w.user_id,displayName:L,avatarUrl:C?.avatar_url?String(C.avatar_url):null},coverUrl:q}})}})}function lr(){return Pe.useMemo(()=>[{key:"action",label:"Action",tmdbGenreId:28},{key:"drama",label:"Drama",tmdbGenreId:18},{key:"horror",label:"Horror",tmdbGenreId:27},{key:"sci-fi",label:"Sci‑Fi",tmdbGenreId:878},{key:"comedy",label:"Comedy",tmdbGenreId:35},{key:"documentary",label:"Docu",tmdbGenreId:99}],[])}const He=t=>typeof t!="string"?!1:/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(t),we=({label:t,active:n,onClick:a})=>e.jsx("button",{type:"button",onClick:a,className:`flex h-9 shrink-0 items-center justify-center rounded-2xl px-5 text-sm font-medium transition-transform active:scale-95 ${n?"bg-primary text-primary-foreground":"bg-muted/70 text-foreground hover:bg-muted"}`,children:t}),me=({label:t,onClick:n,onClear:a})=>e.jsxs("div",{className:"inline-flex max-w-full items-center gap-1 rounded-full border border-border bg-card/70 pl-3 pr-1 py-1 text-xs font-semibold text-foreground",children:[e.jsx("button",{type:"button",onClick:n,className:"max-w-[220px] truncate text-left text-xs font-semibold",title:t,children:t}),a?e.jsx("button",{type:"button",onClick:a,className:"inline-flex h-6 w-6 items-center justify-center rounded-full text-muted-foreground hover:bg-muted/60 hover:text-foreground","aria-label":`Clear ${t}`,children:e.jsx(fe,{className:"h-3.5 w-3.5"})}):null]}),te=({title:t,actionLabel:n,onAction:a})=>e.jsxs("div",{className:"flex items-center justify-between px-4 pb-4",children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight tracking-tight",children:t}),n&&a?e.jsx("button",{type:"button",onClick:a,className:"text-sm font-medium text-primary hover:text-primary/80",children:n}):null]}),ir=({label:t})=>t?e.jsxs("div",{className:"absolute right-2 top-2 inline-flex items-center gap-1 rounded-full bg-black/60 px-2 py-0.5 text-xs font-bold text-white backdrop-blur-sm",children:[e.jsx(Ce,{name:"star",filled:!0,className:"text-[14px] text-yellow-400",ariaLabel:"Rating"}),e.jsx("span",{children:t})]}):null,We=({id:t,title:n,imageUrl:a,ratingLabel:u,subtitle:x,friendAvatarUrls:c,friendExtraCount:o})=>{const j=(c??[]).map((y,h)=>({id:`${t}_${h}`,username:null,display_name:null,avatar_url:y}));if(o&&o>0)for(let y=0;y<o;y+=1)j.push({id:`${t}_placeholder_${y}`,username:null,display_name:null,avatar_url:null});return e.jsxs(xe,{to:`/title/${t}`,className:"group flex flex-col gap-2",children:[e.jsxs("div",{className:"relative aspect-[2/3] w-full overflow-hidden rounded-[20px] bg-muted shadow-lg transition-transform duration-300 group-hover:scale-[1.02]",style:a?{backgroundImage:`url(${a})`,backgroundSize:"cover",backgroundPosition:"center"}:void 0,children:[a?null:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/25 via-background/10 to-primary/40"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/45 via-transparent to-transparent"}),e.jsx(ir,{label:u}),j.length?e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx(At,{profiles:j,max:3,size:32})}):null]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-base font-medium leading-tight",children:n}),x?e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs font-semibold text-muted-foreground",children:[e.jsx(Ce,{name:"group_add",className:"text-[14px]",ariaLabel:"Activity"}),e.jsx("span",{className:"truncate",children:x})]}):null]})]})},or=({id:t,name:n,description:a,coverUrl:u,ownerLabel:x,ownerAvatarUrl:c})=>e.jsxs(xe,{to:`/lists/${t}`,className:"flex items-center gap-3 rounded-3xl border border-border bg-card/70 p-3 shadow-sm transition-colors hover:bg-card",children:[e.jsx("div",{className:"h-16 w-14 overflow-hidden rounded-2xl bg-muted",children:u?e.jsx("img",{src:u,alt:n,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-br from-primary/25 via-muted to-primary/30"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:n}),e.jsx("p",{className:"mt-0.5 line-clamp-1 text-xs text-muted-foreground",children:a||"Curated collection"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 overflow-hidden rounded-full bg-muted",children:c?e.jsx("img",{src:c,alt:x,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"h-full w-full bg-primary/20"})}),e.jsx("p",{className:"truncate text-xs font-medium text-muted-foreground",children:x})]})]}),e.jsx(Ce,{name:"chevron_right",className:"text-[22px] text-muted-foreground",ariaLabel:"Open"})]});function dr(t,n){return t==="people"?"people":t==="titles"?n.type==="series"?"series":"movies":"all"}function cr(t){return t==="people"?{tab:"people"}:t==="movies"?{tab:"titles",nextFilters:{type:"movie"}}:t==="series"?{tab:"titles",nextFilters:{type:"series"}}:{tab:"all"}}const Ir=()=>{const t=Te(),{user:n}=ae(),a=Et(),u=m.useRef(""),x=m.useCallback(r=>{const s=r.trim();s.length<2||s!==u.current&&(u.current=s,Vt(s))},[]),[c,o]=bt(),j=(c.get("q")??"").toString(),[y,h]=m.useState(j),l=m.useRef(null);m.useEffect(()=>{h(j)},[j]);const g=Ct(y,250),d=g.trim(),v=St(c),i=Ft(c),w=It(c,d),C=!!c.get("sort"),L=w==="relevance"?"Relevance":w==="newest"?"Newest":"Rating",[N,U]=m.useState(()=>typeof window>"u"?[]:Ne()),[T,q]=m.useState(null);m.useEffect(()=>{if(typeof window>"u")return;const r=()=>U(Ne());return r(),window.addEventListener("movinesta:recent-searches",r),window.addEventListener("storage",r),()=>{window.removeEventListener("movinesta:recent-searches",r),window.removeEventListener("storage",r)}},[]);const Z=m.useCallback(async r=>{if(He(r.id))return r.id;if(!r.tmdbId)return null;const s=r.type==="series"?"series":"movie";try{const f=await Me("catalog-sync",{tmdbId:r.tmdbId,contentType:s});return tt(f)&&He(f.media_item_id)?f.media_item_id:null}catch(f){return console.warn("[SearchPage] catalog-sync failed",f),null}},[]),S=m.useCallback(async r=>{if(!T){q(r.id);try{const s=await Z(r);if(!s)return;t(`/title/${s}`)}finally{q(null)}}},[Z,t,T]),B=!!(typeof i.minYear=="number"||typeof i.maxYear=="number"||i.originalLanguage||i.genreIds?.length),I=v,Q=dr(I,i);m.useEffect(()=>{I==="titles"&&(i.type==="movie"||i.type==="series"||o(r=>{const s=new URLSearchParams(r);return s.set("type","movie"),s},{replace:!0}))},[I,i.type,o]),m.useEffect(()=>{g!==j&&o(r=>{const s=new URLSearchParams(r);return g.trim()?s.set("q",g):s.delete("q"),s},{replace:!0})},[g,j,o]);const $=m.useCallback(r=>{const{tab:s,nextFilters:f}=cr(r);o(F=>{const P=new URLSearchParams(F);return P.set("tab",s),s==="people"||s==="all"?(P.delete("minYear"),P.delete("maxYear"),P.delete("lang"),P.delete("genre"),P.delete("genres"),s==="people"?(P.delete("type"),P.delete("sort")):P.set("type","all")):f?.type&&P.set("type",f.type),P},{replace:!1})},[o]),X=m.useCallback(r=>{o(s=>{const f=new URLSearchParams(s);return f.set("sort",r),f},{replace:!1})},[o]),ne=m.useCallback(()=>{h(""),o(r=>{const s=new URLSearchParams(r);return s.delete("q"),s},{replace:!0})},[o]),he=m.useCallback(r=>{const s=r.trim();s&&(h(s),o(f=>{const F=new URLSearchParams(f);return F.set("q",s),F.get("tab")||F.set("tab","all"),F},{replace:!1}))},[o]),[G,K]=m.useState(!1),[W,ge]=m.useState(typeof i.minYear=="number"?String(i.minYear):""),[ee,pe]=m.useState(typeof i.maxYear=="number"?String(i.maxYear):""),[Y,oe]=m.useState(i.originalLanguage??""),[de,p]=m.useState(i.genreIds??[]),b=(i.genreIds??[]).join(",");m.useEffect(()=>{G&&(ge(typeof i.minYear=="number"?String(i.minYear):""),pe(typeof i.maxYear=="number"?String(i.maxYear):""),oe(i.originalLanguage??""),p(i.genreIds??[]))},[G,i.minYear,i.maxYear,i.originalLanguage,b]);const A=m.useCallback(()=>{const r=J=>{const M=Number(J);return Number.isFinite(M)?Math.floor(M):void 0};let s=Ge(r(W)),f=Ge(r(ee));if(s&&f&&s>f){const J=s;s=f,f=J}const F=Y.trim()?Y.trim().toLowerCase():void 0,P=(de??[]).filter(J=>Number.isFinite(J)&&J>0);o(J=>{const M=new URLSearchParams(J);M.set("tab","titles");const qe=M.get("type");return qe!=="movie"&&qe!=="series"&&M.set("type","movie"),typeof s=="number"?M.set("minYear",String(s)):M.delete("minYear"),typeof f=="number"?M.set("maxYear",String(f)):M.delete("maxYear"),F?M.set("lang",F):M.delete("lang"),M.delete("genre"),M.delete("genres"),P.length&&M.set("genres",P.join(",")),M},{replace:!1}),K(!1)},[de,Y,ee,W,o]),_=m.useCallback(()=>{o(r=>{const s=new URLSearchParams(r);s.set("tab","titles");const f=s.get("type");return f!=="movie"&&f!=="series"&&s.set("type","movie"),s.delete("minYear"),s.delete("maxYear"),s.delete("lang"),s.delete("genre"),s.delete("genres"),s},{replace:!1}),K(!1)},[o]),R=m.useCallback(()=>{o(r=>{const s=new URLSearchParams(r);return s.delete("minYear"),s.delete("maxYear"),s.delete("lang"),s.delete("genre"),s.delete("genres"),s},{replace:!1})},[o]),D=m.useCallback(()=>{o(r=>{const s=new URLSearchParams(r);return s.delete("sort"),s},{replace:!1})},[o]),V=m.useCallback(()=>{o(r=>{const s=new URLSearchParams(r);return s.delete("minYear"),s.delete("maxYear"),s},{replace:!1})},[o]),Se=m.useCallback(()=>{o(r=>{const s=new URLSearchParams(r);return s.delete("lang"),s},{replace:!1})},[o]),at=m.useCallback(()=>{o(r=>{const s=new URLSearchParams(r);return s.delete("genre"),s.delete("genres"),s},{replace:!1})},[o]),nt=m.useCallback(()=>{const r=d.length>0?["relevance","newest","rating"]:["newest","rating"],s=r.indexOf(w),f=s>=0?r[(s+1)%r.length]:r[0];X(f)},[X,w,d]),le=m.useCallback(()=>{I!=="people"&&(I==="all"&&o(r=>{const s=new URLSearchParams(r);return s.set("tab","titles"),s},{replace:!1}),K(!0))},[I,o]);m.useEffect(()=>{if(typeof window>"u")return;const r=f=>{const F=f;if(!F)return!1;const P=F.tagName?.toLowerCase?.();return P==="input"||P==="textarea"||P==="select"?!0:!!F.isContentEditable},s=f=>{if(!f.defaultPrevented){if(f.key==="/"&&!r(f.target)){f.preventDefault(),l.current?.focus();return}if(f.key==="Escape"&&!r(f.target)){if(G){f.preventDefault(),K(!1);return}f.preventDefault(),ne()}}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[ne,G]);const be=lr(),lt=m.useMemo(()=>{const r=new Map;for(const s of be)r.set(s.tmdbGenreId,s.label);return r},[be]),H=tr(10),Fe=ar(8),Ie=nr(6),Ee=I==="all",it=I==="all",E=Ze({query:Ee?d:"",filters:Ee?i:void 0}),O=et(it?d.replace(/^@+/,""):""),ye=m.useMemo(()=>{const r=E.data?.pages??[];return r.flatMap(F=>F.results??[]).length?r.flatMap(F=>Xe({items:F.results??[],query:d,sortKey:w})):[]},[w,E.data,d]),ce=m.useMemo(()=>ye.filter(r=>r.type==="movie"),[ye]),ue=m.useMemo(()=>ye.filter(r=>r.type==="series"),[ye]),ot=d.length===0&&I==="all",dt=m.useCallback(()=>{t("/swipe?mode=trending")},[t]),ct=m.useCallback(()=>{t("/activity")},[t]),$e=typeof i.minYear=="number"||typeof i.maxYear=="number"?`Year: ${typeof i.minYear=="number"&&typeof i.maxYear=="number"?`${i.minYear}-${i.maxYear}`:typeof i.minYear=="number"?`≥${i.minYear}`:`≤${i.maxYear}`}`:null,Ye=i.originalLanguage?`Lang: ${i.originalLanguage.toUpperCase()}`:null,Be=(i.genreIds?.length??0)>0?(()=>{const r=i.genreIds??[],s=r.map(P=>lt.get(P)).filter(Boolean);if(!s.length)return`Genres: ${r.length}`;const f=s[0],F=s.length-1;return F>0?`Genres: ${f} +${F}`:`Genres: ${f}`})():null,ut=I==="titles"&&(B||C);return e.jsxs("div",{className:"relative flex min-h-screen w-full flex-col overflow-x-hidden bg-background pb-24 text-foreground",children:[e.jsx("div",{className:"h-12 w-full"}),e.jsx(yt,{open:G,onOpenChange:K,children:e.jsxs(wt,{className:"max-w-lg",children:[e.jsx(jt,{children:e.jsx(vt,{children:"Filters"})}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Year range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(Le,{value:W,onChange:r=>ge(r.target.value.replace(/[^0-9]/g,"").slice(0,4)),placeholder:"From",inputMode:"numeric"}),e.jsx(Le,{value:ee,onChange:r=>pe(r.target.value.replace(/[^0-9]/g,"").slice(0,4)),placeholder:"To",inputMode:"numeric"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Language"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[["en","ar","ja","ko"].map(r=>{const s=Y.toLowerCase()===r;return e.jsx(k,{type:"button",size:"sm",variant:s?"default":"outline",className:"rounded-full",onClick:()=>oe(r),children:r.toUpperCase()},r)}),e.jsx(Le,{value:Y,onChange:r=>oe(r.target.value.replace(/\s/g,"").slice(0,8)),placeholder:"e.g. fr",className:"h-9 w-28"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use ISO-639-1 codes (en, ar...)."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Genres"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:be.map(r=>{const s=de.includes(r.tmdbGenreId);return e.jsx(k,{type:"button",size:"sm",variant:s?"default":"outline",className:"rounded-full",onClick:()=>p(f=>f.includes(r.tmdbGenreId)?f.filter(F=>F!==r.tmdbGenreId):[...f,r.tmdbGenreId]),children:r.label},r.tmdbGenreId)})})]})]}),e.jsxs(Nt,{className:"flex-col gap-2 sm:flex-row sm:justify-between",children:[e.jsx(k,{type:"button",variant:"outline",onClick:_,className:"rounded-full",children:"Reset"}),e.jsxs("div",{className:"flex w-full justify-end gap-2 sm:w-auto",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>K(!1),className:"rounded-full",children:"Cancel"}),e.jsx(k,{type:"button",onClick:A,className:"rounded-full",children:"Apply"})]})]})]})}),e.jsx("div",{className:"sticky top-0 z-30 bg-background/95 px-4 pb-2 pt-2 backdrop-blur-md",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("label",{className:"flex h-12 w-full items-center gap-3 rounded-2xl border border-input bg-card px-4 shadow-sm focus-within:ring-2 focus-within:ring-primary",children:[e.jsx(Ce,{name:"search",className:"text-[20px] text-muted-foreground",ariaLabel:"Search"}),e.jsx("input",{ref:l,value:y,onChange:r=>h(r.target.value),onKeyDown:r=>{if(r.key==="Escape"){r.preventDefault(),ne(),r.currentTarget.blur();return}r.key==="Enter"&&(x(y),r.currentTarget.blur())},onBlur:()=>x(y),placeholder:"Search movies, shows, people...",className:"h-full flex-1 bg-transparent text-base text-foreground outline-none placeholder:text-muted-foreground",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1}),y?e.jsx("button",{type:"button",onClick:ne,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground","aria-label":"Clear search",children:e.jsx(fe,{className:"h-4 w-4"})}):null,e.jsx("button",{type:"button",onClick:le,disabled:I==="people",className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground disabled:opacity-40","aria-label":"Filters",children:e.jsxs("span",{className:"relative inline-flex",children:[e.jsx(Ue,{className:"h-4 w-4"}),B?e.jsx("span",{className:"absolute -right-1 -top-1 h-2 w-2 rounded-full bg-primary","aria-hidden":"true"}):null]})})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:[e.jsx(we,{label:"All",active:Q==="all",onClick:()=>$("all")}),e.jsx(we,{label:"Movies",active:Q==="movies",onClick:()=>$("movies")}),e.jsx(we,{label:"Series",active:Q==="series",onClick:()=>$("series")}),e.jsx(we,{label:"People",active:Q==="people",onClick:()=>$("people")})]}),ut?e.jsxs("div",{className:"flex flex-wrap items-center gap-2 pb-1",children:[C?e.jsx(me,{label:`Sort: ${L}`,onClick:nt,onClear:D}):null,$e?e.jsx(me,{label:$e,onClick:le,onClear:V}):null,Ye?e.jsx(me,{label:Ye,onClick:le,onClear:Se}):null,Be?e.jsx(me,{label:Be,onClick:le,onClear:at}):null,B?e.jsx(me,{label:"Clear all",onClick:R}):null]}):null]})}),ot?e.jsxs("div",{className:"flex flex-col pt-6",children:[N.length?e.jsxs("div",{className:"flex flex-col pb-8",children:[e.jsx(te,{title:"Recent searches",actionLabel:"Clear",onAction:Zt}),e.jsx("div",{className:"flex flex-wrap gap-2 px-4",children:N.map(r=>e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-border bg-card/60 pl-3 pr-1 py-1 text-sm",children:[e.jsx("button",{type:"button",onClick:()=>he(r.term),className:"max-w-[220px] truncate text-sm font-medium text-foreground",title:r.term,children:r.term}),e.jsx("button",{type:"button",onClick:()=>Jt(r.term),className:"inline-flex h-7 w-7 items-center justify-center rounded-full text-muted-foreground hover:bg-muted/60 hover:text-foreground","aria-label":`Remove ${r.term}`,children:e.jsx(fe,{className:"h-4 w-4"})})]},r.term))})]}):null,e.jsx(te,{title:"Suggested People",actionLabel:"See All",onAction:()=>t("/suggested-people")}),e.jsx("div",{className:"px-4 pb-6",children:a.isLoading?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((r,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):a.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:"Couldn't load suggestions right now."}):(a.data??[]).length?e.jsx("div",{className:"space-y-3",children:(a.data??[]).slice(0,5).map(r=>{const s={id:r.id,username:r.username,displayName:r.displayName,avatarUrl:r.avatarUrl,bio:r.bio,followersCount:r.followersCount,followingCount:r.followingCount,isFollowing:r.isFollowing,matchPercent:r.matchPercent??null};return e.jsx(je,{person:s,variant:"compact",showMessage:!1,showDismiss:!0,onDismiss:()=>a.dismissPerson(r.id)},r.id)})}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:n?.id?"No suggestions right now.":"Sign in to get personalized people suggestions."})}),e.jsx(te,{title:"Friends Are Watching",actionLabel:"See All",onAction:ct}),e.jsx("div",{className:"grid grid-cols-2 gap-4 px-4",children:Fe.isLoading?Array.from({length:4}).map((r,s)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"aspect-[2/3] w-full animate-pulse rounded-[20px] bg-muted"}),e.jsx("div",{className:"h-4 w-3/4 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-muted"})]},s)):Fe.data?.length?Fe.data.map(r=>e.jsx(We,{...r},r.id)):e.jsx("div",{className:"col-span-2 rounded-3xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:n?.id?"Your friends’ activity will show up here once they start rating, watching, or adding to watchlists.":"Sign in to see what your friends are watching."})}),e.jsxs("div",{className:"flex flex-col pt-8",children:[e.jsx(te,{title:"Trending Now",actionLabel:"See All",onAction:dt}),e.jsx("div",{className:"flex gap-4 overflow-x-auto px-4 pb-2 [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:H.isLoading?Array.from({length:6}).map((r,s)=>e.jsxs("div",{className:"w-36 shrink-0",children:[e.jsx("div",{className:"aspect-[2/3] w-full animate-pulse rounded-[20px] bg-muted"}),e.jsx("div",{className:"mt-2 h-4 w-3/4 animate-pulse rounded bg-muted"})]},s)):H.isError?e.jsx("div",{className:"w-full shrink-0 rounded-3xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Trending is temporarily unavailable."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:H.error?.message??"Please try again."})]}),e.jsx(k,{type:"button",variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>H.refetch(),disabled:H.isFetching,children:"Retry"})]})}):H.data?.length?H.data.map(r=>e.jsx("div",{className:"w-36 shrink-0",children:e.jsx(We,{...r,friendAvatarUrls:[],friendExtraCount:0})},r.id)):e.jsx("div",{className:"w-full shrink-0 rounded-3xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.id?"No trending titles right now.":"No trending titles right now. (Sign in to personalize your feed.)"}),e.jsx(k,{type:"button",variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>H.refetch(),disabled:H.isFetching,children:"Refresh"})]})})})]}),e.jsxs("div",{className:"flex flex-col pt-8",children:[e.jsx(te,{title:"Curated by Experts & Friends"}),e.jsx("div",{className:"flex flex-col gap-3 px-4",children:Ie.isLoading?Array.from({length:3}).map((r,s)=>e.jsx("div",{className:"h-20 animate-pulse rounded-3xl bg-muted"},s)):Ie.data?.length?Ie.data.map(r=>e.jsx(or,{id:r.id,name:r.name,description:r.description,coverUrl:r.coverUrl,ownerLabel:`by ${r.owner.displayName}`,ownerAvatarUrl:r.owner.avatarUrl},r.id)):e.jsx("div",{className:"rounded-3xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:"Public lists will appear here once you or your friends publish them."})})]}),e.jsxs("div",{className:"flex flex-col pt-8",children:[e.jsx(te,{title:"Browse by Category"}),e.jsx("div",{className:"grid grid-cols-3 gap-3 px-4",children:be.map(r=>e.jsx("button",{type:"button",onClick:()=>{o(s=>{const f=new URLSearchParams(s);return f.set("tab","titles"),f.delete("genre"),f.delete("genres"),f.set("genres",String(r.tmdbGenreId)),f},{replace:!1})},className:"flex h-20 items-center justify-center rounded-3xl border border-border bg-card/70 text-sm font-semibold text-foreground shadow-sm transition-colors hover:bg-card",children:r.label},r.key))})]})]}):e.jsx("div",{className:"px-4 pt-4",children:I==="people"?d.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:"Type a name or @username to search, or browse suggested people below."}),e.jsxs("div",{children:[e.jsx(te,{title:"Suggested People",actionLabel:"See All",onAction:()=>t("/suggested-people")}),a.isLoading?e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((r,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):a.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:"Couldn't load suggestions right now."}):(a.data??[]).length?e.jsx("div",{className:"space-y-3",children:(a.data??[]).slice(0,8).map(r=>{const s={id:r.id,username:r.username,displayName:r.displayName,avatarUrl:r.avatarUrl,bio:r.bio,followersCount:r.followersCount,followingCount:r.followingCount,isFollowing:r.isFollowing,matchPercent:r.matchPercent??null};return e.jsx(je,{person:s,variant:"compact",showMessage:!1,showDismiss:!0,onDismiss:()=>a.dismissPerson(r.id)},r.id)})}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:n?.id?"No suggestions right now.":"Sign in to get personalized people suggestions."})]})]}):e.jsx(Ht,{query:d}):I==="all"?d.length>0&&d.length<2?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:["Keep typing to search — enter at least"," ",e.jsx("span",{className:"font-semibold text-foreground",children:"2 characters"}),"."]}),e.jsx("div",{className:"rounded-2xl border border-border bg-background/60 p-4 text-xs text-muted-foreground",children:"Tip: Use the filters button to browse without typing (genres, year, language)."})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Movies",ce.length?` (${ce.length})`:""]}),E.isFetching&&!E.isLoading?e.jsx(se,{className:"h-4 w-4 animate-spin text-muted-foreground","aria-hidden":"true"}):null]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>$("movies"),className:"h-8 rounded-full",children:"See all"})]}),E.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:4}).map((r,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):E.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Couldn't load movies"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:E.error?.message??"Please try again."})]}),e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>E.refetch(),children:"Retry"})]})}):ce.length?e.jsxs("div",{className:"space-y-2",children:[ce.slice(0,6).map(r=>e.jsx(Re,{item:r,query:d,onSelect:S,disabled:!!T,loading:T===r.id},r.id)),ce.length>6?e.jsx(k,{variant:"secondary",className:"w-full rounded-2xl",onClick:()=>$("movies"),children:"View more movies"}):null]}):e.jsxs("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-foreground",children:"No matching movies."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Try a different spelling, or use filters to browse by genre, year, or language."}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:le,children:"Open filters"}),d.startsWith("@")?e.jsx(k,{variant:"outline",size:"sm",className:"h-8 rounded-full",onClick:()=>$("people"),children:"Search people"}):null]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Series",ue.length?` (${ue.length})`:""]}),E.isFetching&&!E.isLoading?e.jsx(se,{className:"h-4 w-4 animate-spin text-muted-foreground","aria-hidden":"true"}):null]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>$("series"),className:"h-8 rounded-full",children:"See all"})]}),E.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:4}).map((r,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):E.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Couldn't load series"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:E.error?.message??"Please try again."})]}),e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>E.refetch(),children:"Retry"})]})}):ue.length?e.jsxs("div",{className:"space-y-2",children:[ue.slice(0,6).map(r=>e.jsx(Re,{item:r,query:d,onSelect:S,disabled:!!T,loading:T===r.id},r.id)),ue.length>6?e.jsx(k,{variant:"secondary",className:"w-full rounded-2xl",onClick:()=>$("series"),children:"View more series"}):null]}):e.jsxs("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-foreground",children:"No matching series."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Try a different spelling, or use filters to browse by genre, year, or language."}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:le,children:"Open filters"})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["People",O.data?.length?` (${O.data.length})`:""]}),O.isFetching&&!O.isLoading?e.jsx(se,{className:"h-4 w-4 animate-spin text-muted-foreground","aria-hidden":"true"}):null]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>$("people"),className:"h-8 rounded-full",children:"See all"})]}),O.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:4}).map((r,s)=>e.jsx("div",{className:"h-14 animate-pulse rounded-2xl bg-muted"},s))}):O.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Couldn't load people"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:O.error?.message??"Please try again."})]}),e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>O.refetch(),children:"Retry"})]})}):O.data?.length?e.jsx("div",{className:"space-y-2",children:O.data.slice(0,6).map(r=>{const s={id:r.id,username:r.username,displayName:r.displayName,avatarUrl:r.avatarUrl,bio:r.bio,followersCount:r.followersCount??null,followingCount:r.followingCount??null,isFollowing:r.isFollowing,matchPercent:r.matchPercent??null};return e.jsx(je,{person:s,variant:"compact",showFollow:!0,showMessage:!0,highlightQuery:d.replace(/^@+/,"")},r.id)})}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:"No matching people."})]})]}):e.jsx(Ot,{query:d,filters:i,sortKey:w,onChangeSort:X,onResetFilters:_})})]})};export{Ir as default};
