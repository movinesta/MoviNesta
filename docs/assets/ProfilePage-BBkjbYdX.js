import{c as P,j as e,w as F,u as S,r as x,k as T,m as E,B as m,x as b,M as A,o as I}from"./index-C0YC7Lqk.js";import{P as c}from"./PageChrome-BPZJeQO1.js";import{T as u}from"./TopBar-Cwkp26YK.js";import{u as D}from"./useProfile-C4HVQoZm.js";import{D as L,a as B}from"./DiaryLibraryTab-CLjHURZY.js";import{u as Y,U as _,a as M}from"./useToggleFollow-DyCy6kDb.js";import{S as $}from"./sparkles-BsAyD2aC.js";import{U as O}from"./users-CdKu7Qpk.js";import"./index-B38AejhK.js";import"./index-2QA0ZcLJ.js";import"./format-DWLSBLoY.js";import"./film-BhU7UJY3.js";import"./bookmark-plus-_9JyXP2f.js";import"./star-CUibpuuR.js";import"./diaryStatus-ZsNbGN5M.js";import"./useMutation-B6WiSsoN.js";const R=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],y=P("settings",R),z=({profileId:r,displayName:n,username:t,isCurrentUser:a=!1})=>e.jsx("div",{className:"mt-2",children:e.jsx(L,{userId:r,isOwnProfile:a,displayName:n,username:t})}),K=({profileId:r,displayName:n,username:t,isCurrentUser:a=!1})=>e.jsx("div",{className:"mt-2",children:e.jsx(B,{userId:r,isOwnProfile:a,displayName:n,username:t})}),j=r=>r>=1e6?`${(r/1e6).toFixed(1).replace(/\.0$/,"")}M`:r>=1e3?`${(r/1e3).toFixed(1).replace(/\.0$/,"")}K`:String(r??0),H=(r,n)=>{const a=(r||n||"").replace(/^@/,"").trim();if(!a)return"?";const o=a.split(/\s+/);return o.length===1?o[0].slice(0,2).toUpperCase():(o[0][0]+o[1][0]).toUpperCase()},le=()=>{const{username:r}=F(),n=S(),[t,a]=x.useState("activity"),[o,p]=x.useState(!1),{data:s,isLoading:w,isError:v,error:f}=D(r??null),{user:N}=T(),d=Y(),g=x.useMemo(()=>s?s.displayName||s.username||"Profile":r?`@${r}`:"Profile",[s,r]);if(!r)return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-3 pb-4 pt-2 sm:px-4 lg:px-6",children:[e.jsx(u,{title:"Profile",subtitle:"This route needs a username to show someone’s profile."}),e.jsx(c,{children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Make sure you are visiting a URL like",e.jsx("span",{className:"mx-1 rounded bg-card px-1.5 py-0.5 font-mono text-xs",children:"/u/<username>"}),"so we know whose profile to display."]})})]});if(w)return e.jsx(E,{message:"Fetching profile details…"});if(v||!s)return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-3 pb-4 pt-2 sm:px-4 lg:px-6",children:[e.jsx(u,{title:"Profile not found"}),e.jsxs(c,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["We couldn't find a profile for username",e.jsxs("span",{className:"mx-1 rounded bg-card px-1.5 py-0.5 font-mono text-xs",children:["@",r]}),"."]}),f?.message&&e.jsxs("p",{className:"mt-3 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Details:"})," ",f.message]})]})]});const h=async()=>{if(s){if(s.isCurrentUser){n("/settings");return}d.isPending||d.mutate({targetUserId:s.id,currentlyFollowing:s.isFollowing})}},k=async()=>{if(!(!s||s.isCurrentUser)){if(!N?.id){alert("You need to be signed in to message other members.");return}p(!0);try{const i=await I("create-direct-conversation",{targetUserId:s.id});if(!i?.ok||!i.conversationId){let l=i?.error??"Failed to get conversation id. Please try again.";throw i?.code==="UNAUTHORIZED"?l="You need to be signed in to message other members.":i?.code==="BAD_REQUEST_SELF_TARGET"?l="You can’t start a conversation with yourself.":i?.code==="BLOCKED_BY_SELF"?l="You have blocked this user. Unblock them to send messages.":i?.code==="BLOCKED_BY_OTHER"&&(l="You cannot send messages because this user blocked you."),new Error(l)}n(`/messages/${i.conversationId}`)}catch(i){console.error("[ProfilePage] Failed to start conversation",i),alert(i?.message??"Something went wrong while starting the conversation. Please try again.")}finally{p(!1)}}},C=s.isCurrentUser?"Edit profile":s.isFollowing?"Following":"Follow",U=s.isCurrentUser?y:s.isFollowing?_:M;return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-3 pb-6 pt-2 sm:px-4 lg:px-6",children:[e.jsx(u,{title:g,subtitle:s.bio||"See their diary entries, activity, and who they follow."}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-6 rounded-2xl border border-border bg-gradient-to-r from-background to-card/60 p-4 shadow-lg sm:p-5",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:gap-6",children:[e.jsxs("div",{className:"flex items-start gap-4 sm:gap-5",children:[e.jsxs("div",{className:"relative flex h-20 w-20 items-center justify-center rounded-[28px] bg-gradient-to-br from-primary/15 via-primary/20 to-background ring-1 ring-border/80",children:[s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:s.displayName||s.username||"Profile avatar",className:"h-20 w-20 rounded-[22px] object-cover"}):e.jsx("span",{className:"text-lg font-semibold text-primary","aria-hidden":"true",children:H(s.displayName,s.username)}),!s.isCurrentUser&&e.jsx("span",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 rounded-full bg-primary/10 px-2 py-0.5 text-xs font-semibold uppercase tracking-wide text-primary ring-1 ring-primary/30",children:s.isFollowing?"Following":"New"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-heading font-semibold text-foreground",children:g}),s.username&&e.jsxs("span",{className:"rounded-full bg-background px-2 py-0.5 text-xs font-mono text-muted-foreground ring-1 ring-border",children:["@",s.username]}),s.isCurrentUser&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-primary/10 px-2 py-0.5 text-xs font-semibold uppercase tracking-wide text-primary ring-1 ring-primary/30",children:[e.jsx($,{className:"h-3 w-3","aria-hidden":"true"}),"You"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-center text-[12px] text-muted-foreground",children:[e.jsxs("div",{className:"flex min-w-[80px] flex-col",children:[e.jsx("span",{className:"text-base font-semibold text-foreground",children:j(s.followersCount)}),e.jsx("span",{className:"text-xs uppercase tracking-wide",children:"Followers"})]}),e.jsxs("div",{className:"flex min-w-[80px] flex-col",children:[e.jsx("span",{className:"text-base font-semibold text-foreground",children:j(s.followingCount)}),e.jsx("span",{className:"text-xs uppercase tracking-wide",children:"Following"})]}),e.jsxs("div",{className:"flex min-w-[80px] flex-col",children:[e.jsx("span",{className:"text-base font-semibold text-foreground",children:t==="activity"?"Activity":"Diary"}),e.jsx("span",{className:"text-xs uppercase tracking-wide",children:"View"})]})]}),s.bio&&e.jsx("p",{className:"max-w-2xl whitespace-pre-line text-[12px] leading-snug text-muted-foreground",children:s.bio})]})]}),e.jsx("div",{className:"flex flex-1 flex-wrap items-start justify-end gap-2",children:s.isCurrentUser?e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:h,children:[e.jsx(y,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Edit profile"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(m,{type:"button",size:"sm",onClick:h,disabled:d.isPending,className:s.isFollowing?"border border-border bg-card text-foreground hover:bg-background":"",children:[d.isPending?e.jsx(b,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}):e.jsx(U,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:C})]}),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:k,disabled:o,children:[o?e.jsx(b,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}):e.jsx(A,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:o?"Starting…":"Message"})]})]})})]}),!s.isCurrentUser&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-xl border border-dashed border-border bg-background/70 px-3 py-2 text-xs text-muted-foreground shadow-md",children:[e.jsx(O,{className:"h-4 w-4 text-primary","aria-hidden":"true"}),e.jsx("p",{className:"font-medium text-foreground",children:"Follow to catch their latest reviews and diary logs."})]})]})}),e.jsx(c,{tone:"muted",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-xl bg-background/70 px-3 py-2 text-xs text-muted-foreground ring-1 ring-border/70",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"rounded-full bg-primary/10 px-2 py-0.5 text-xs font-semibold uppercase tracking-wide text-primary",children:"Profile view"}),e.jsxs("p",{className:"text-foreground",children:["You're browsing ",s.isCurrentUser?"your":"their"," latest activity and"," ","diary entries."]})]}),!s.isCurrentUser&&s.username&&e.jsxs("span",{className:"rounded-full bg-background px-2 py-0.5 font-mono text-xs text-muted-foreground ring-1 ring-border/70",children:["@",s.username]})]}),e.jsxs("nav",{className:"flex items-center gap-1.5 rounded-lg bg-muted p-1.5 text-xs text-muted-foreground","aria-label":"Profile tabs",children:[e.jsx("button",{type:"button",onClick:()=>a("activity"),className:`inline-flex flex-1 items-center justify-center rounded-md px-3 py-1.5 text-xs font-medium ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 transition-all ${t==="activity"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:bg-background/80"}`,"aria-pressed":t==="activity",children:"Activity"}),e.jsx("button",{type:"button",onClick:()=>a("diary"),className:`inline-flex flex-1 items-center justify-center rounded-md px-3 py-1.5 text-xs font-medium ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 transition-all ${t==="diary"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:bg-background/80"}`,"aria-pressed":t==="diary",children:"Diary"})]}),e.jsx("div",{"aria-live":"polite",className:"rounded-xl border border-border bg-card/60 px-3 py-3 shadow-md",children:t==="activity"?e.jsx(z,{profileId:s.id,displayName:s.displayName,username:s.username,isCurrentUser:s.isCurrentUser}):e.jsx(K,{profileId:s.id,displayName:s.displayName,username:s.username,isCurrentUser:s.isCurrentUser})})]})})]})};export{le as default};
