import{D as Ze,R as x,j as e,b as ae,r as Te,c as Ce,s as G,E as xt,F as se,L as xe,e as gt,u as Re,n as Me,h as Xe,G as ht,q as ze,B as k,M as Oe,k as pt,l as bt,H as yt,m as Ne,t as vt,I as wt}from"./index-BhYCkKJ1.js";import{D as jt,a as Nt,b as kt,c as _t,e as Ct}from"./dialog-DKXGxth9.js";import{I as Pe}from"./input-WYf2XWmQ.js";import{M as Se}from"./material-icon-DzJ3uwwf.js";import{h as St,u as et,d as Ft,s as tt,a as Lt,p as It,b as Pt,c as Tt,e as Ge}from"./useSearchTitles-DlKCyeKV.js";import{u as rt}from"./useSearchPeople-DfdiF1dA.js";import{Y as At}from"./index-CU6THGDM.js";import{u as Ut}from"./useDiaryLibrary-DjiZyGrD.js";import{i as st}from"./catalogSync-i5cCA8pA.js";import{F as at}from"./film-DzeGNKC8.js";import{S as Ve,B as Rt}from"./star-BI9e52uT.js";import{u as Mt}from"./useToggleFollow-DfXcO5k7.js";import{V as Qe}from"./VerifiedBadge-Bqpsp2OE.js";import{X as ge}from"./x-7msmISva.js";import{U as Ke,a as He}from"./user-plus-C5L0vSdA.js";import{U as Et}from"./user-DFAZFA4c.js";import{U as Bt}from"./users-BOZAcCjM.js";import{F as $t}from"./FriendAvatarStack-BsWxiBgE.js";import{u as Yt}from"./useSuggestedPeople-AvbYDKYw.js";const qt=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]],Dt=Ze("bookmark-check",qt);const zt=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],Ae=Ze("sliders-horizontal",zt),Ot=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),re=({text:t,query:n,className:a,highlightClassName:f,firstOnly:g=!1})=>{const d=(n??"").trim(),i=x.useMemo(()=>{if(!d)return[{chunk:t,hit:!1}];const o=Ot(d),u=new RegExp(o,"ig"),m=[];let y=0,l,_=0;for(;(l=u.exec(t))!==null;){l.index>y&&m.push({chunk:t.slice(y,l.index),hit:!1});const c=l[0];if(m.push({chunk:c,hit:!0}),y=l.index+c.length,_+=1,g&&_>=1||c.length===0)break}return y<t.length&&m.push({chunk:t.slice(y),hit:!1}),m.length?m:[{chunk:t,hit:!1}]},[d,t,g]),w=f??"rounded bg-primary/20 px-0.5 text-foreground ring-1 ring-primary/20";return e.jsx("span",{className:a,children:i.map((o,u)=>o.hit?e.jsx("span",{className:w,children:o.chunk},u):e.jsx(x.Fragment,{children:o.chunk},u))})},Gt=t=>typeof t!="string"?!1:/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(t),Vt=t=>{const n=[],a=new Set;for(const f of t)f&&(a.has(f)||(a.add(f),n.push(f)));return n},Qt=t=>{const{user:n}=ae(),a=n?.id??null,f=Te.useMemo(()=>Vt((t??[]).filter(i=>Gt(i))).slice(0,200),[t]),g=Te.useMemo(()=>f.slice().sort().join(","),[f]);return Ce({queryKey:["search","titleDiaryBulk",a,g],enabled:!!a&&f.length>0,staleTime:1e3*20,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>{if(!a||f.length===0)return new Map;const d=new Map,[{data:i,error:w},{data:o,error:u}]=await Promise.all([G.from("library_entries").select("title_id,status").eq("user_id",a).in("title_id",f),G.from("ratings").select("title_id,rating").eq("user_id",a).in("title_id",f)]);if(w)throw w;if(u)throw u;return(i??[]).forEach(m=>{const y=m?.title_id;y&&d.set(y,{status:m?.status??null,rating:null})}),(o??[]).forEach(m=>{const y=m?.title_id;if(!y)return;const l=xt(m?.rating??null),_=d.get(y)??{status:null,rating:null};d.set(y,{..._,rating:l})}),d}})},Ue=({item:t,query:n,right:a,onSelect:f,disabled:g,loading:d})=>{const i=[];t.year&&i.push(String(t.year)),t.type==="movie"&&i.push("Movie"),t.type==="series"&&i.push("Series"),t.originalLanguage&&i.push(`Language: ${t.originalLanguage}`),t.ageRating&&i.push(t.ageRating),t.imdbRating&&i.push(`IMDb ${t.imdbRating.toFixed(1)}`),t.rtTomatoMeter&&i.push(`RT ${t.rtTomatoMeter}%`);const w={library:"Library","external-synced":"Synced","external-only":"External"},o={library:"bg-primary/10 text-primary border-primary/40","external-synced":"bg-emerald-500/10 text-emerald-400 border-emerald-500/30","external-only":"bg-card text-muted-foreground border-border"},u=e.jsxs(e.Fragment,{children:[t.posterUrl?e.jsx("img",{src:t.posterUrl,alt:t.title,className:"h-20 w-14 rounded-2xl object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-20 w-14 items-center justify-center rounded-2xl bg-muted",children:e.jsx(at,{className:"h-5 w-5 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-[12px] font-medium text-foreground",children:e.jsx(re,{text:t.title,query:n,firstOnly:!0,className:"truncate"})}),e.jsx("span",{className:`shrink-0 rounded-full border px-2 py-0.5 text-xs font-medium ${o[t.source]}`,children:w[t.source]})]}),i.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:i.join(" • ")}),d?e.jsxs("span",{className:"mt-1 inline-flex items-center gap-1 text-[11px] text-muted-foreground",children:[e.jsx(se,{className:"h-3 w-3 animate-spin","aria-hidden":"true"}),"Syncing…"]}):null]})]});return e.jsxs("div",{className:"soft-row-card flex min-h-11 items-center gap-2 row-pad",children:[f?e.jsx("button",{type:"button",className:"flex min-w-0 flex-1 gap-3 text-left",onClick:()=>f(t),disabled:g,"aria-disabled":g,children:u}):e.jsx(xe,{to:`/title/${t.id}`,className:"flex min-w-0 flex-1 gap-3",children:u}),a?e.jsx("div",{className:"shrink-0 pr-1",children:a}):null]})},le=t=>typeof t!="string"?!1:/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(t),Kt=({query:t,filters:n,sortKey:a,onChangeSort:f,onResetFilters:g})=>{const d=t.trim(),i=St(n),w=!d&&i,o=d.length>0&&d.length<2&&!w,{data:u,isLoading:m,isError:y,error:l,fetchNextPage:_,hasNextPage:c,isFetching:v,isFetchingNextPage:C}=et({query:d,filters:n}),I=a??Ft(d),j=x.useMemo(()=>(u?.pages??[]).flatMap(b=>tt({items:b.results??[],query:d,sortKey:I})),[u,I,d]),{user:T}=ae(),U=gt(),q=Ut(),Z=Re(),[S,Y]=x.useState({}),L=x.useRef(S);x.useEffect(()=>{L.current=S},[S]);const V=x.useMemo(()=>{const p=[];for(const b of j){const M=S[b.id]??b.id;le(M)&&p.push(M)}return p},[j,S]),B=Qt(V),X=x.useMemo(()=>B.data??new Map,[B.data]),[ne,he]=x.useState(null),[z,Q]=x.useState(null),H=x.useCallback(async p=>{const b=p.id;if(le(b))return b;const M=L.current[b];if(M&&le(M))return M;if(!p.tmdbId)return null;const N=p.type==="series"?"series":"movie";try{const A=await Me("catalog-sync",{tmdbId:p.tmdbId,contentType:N});if(!st(A))return null;const D=A.media_item_id;if(D&&le(D))return Y(W=>W[b]?W:{...W,[b]:D}),D}catch(A){console.warn("[SearchTitlesTab] catalog-sync failed",A)}return null},[]),pe=x.useCallback(async p=>{if(T){he(p.id);try{const b=await H(p);if(!b)return;const N=X.get(b)?.status==="want_to_watch",A=Xe();if(await ht({sessionId:A,mediaItemId:b,source:"search",eventType:"watchlist",inWatchlist:!N}),N){const{error:D}=await G.from("library_entries").delete().eq("user_id",T.id).eq("title_id",b).eq("status","want_to_watch");if(D)throw D}else await q.updateStatus.mutateAsync({titleId:b,status:"want_to_watch",type:p.type==="series"?"series":"movie",title:p.title,year:p.year,posterUrl:p.posterUrl});U.invalidateQueries({queryKey:["search","titleDiaryBulk",T.id]}),U.invalidateQueries({queryKey:ze.diaryLibrary(T.id)}),U.invalidateQueries({queryKey:ze.titleDiary(T.id,b)})}catch(b){console.warn("[SearchTitlesTab] watchlist toggle failed",b)}finally{he(null)}}},[X,q.updateStatus,H,U,T]),ee=j.length,be=x.useCallback(async p=>{if(!z){Q(p.id);try{const b=await H(p);if(!b)return;Z(`/title/${b}`)}finally{Q(null)}}},[H,Z,z]),$=[];if(n.type&&n.type!=="all"){const p={movie:"Movies",series:"Series"};$.push(p[n.type]??"Titles")}typeof n.minYear=="number"&&$.push(`From ${n.minYear}`),typeof n.maxYear=="number"&&$.push(`Up to ${n.maxYear}`),n.originalLanguage&&$.push(`Language: ${n.originalLanguage==="en"?"English":n.originalLanguage}`),n.genreIds?.length&&$.push(`Genres: ${n.genreIds.length}`);const de=$.length?$.join(" • "):"No filters applied",ce=x.useRef(new Set);return x.useEffect(()=>{if(!j||!Array.isArray(j))return;const p=ce.current,b=j.filter(N=>!(p.has(N.id)||!N.imdbId&&!N.tmdbId||N.imdbRating||N.rtTomatoMeter)).slice(0,3);(async()=>{for(const N of b){p.add(N.id);try{const{error:A}=await G.from("media_items").upsert({tmdb_id:N.tmdbId??null,omdb_imdb_id:N.imdbId??null,kind:N.type==="series"?"series":N.type??"movie",tmdb_title:N.title,tmdb_release_date:N.year?`${N.year}-01-01`:null},{onConflict:"kind,tmdb_id"}).select("id");A&&console.warn("[SearchTitlesTab] media_items upsert failed for",N.id,A.message)}catch(A){console.warn("[SearchTitlesTab] media_items upsert threw for",N.id,A)}}})()},[j]),o?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["Keep typing to search titles — enter at least"," ",e.jsx("span",{className:"font-semibold text-foreground",children:"2 characters"}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tip: You can also browse without typing by using filters (genres, year, language)."})]}):!d&&!w?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a title, director, or genre to search the catalog. As you wire Supabase search, results will appear here."}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-xs font-medium text-foreground",children:"Try searching for"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-xs",children:["Sci-fi romance","Feel-good comedies","Films from 2020s","Cozy rainy-day movies"].map(p=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-border px-2 py-1 text-muted-foreground",children:[e.jsx(at,{className:"mr-1 h-3 w-3 text-muted-foreground","aria-hidden":"true"}),p]},p))})]}),e.jsxs("div",{className:"space-y-1.5 rounded-2xl border border-border bg-background/60 p-3",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs font-medium text-foreground",children:[e.jsx(Ve,{className:"h-3.5 w-3.5 text-primary","aria-hidden":"true"}),e.jsx("span",{children:"Trending this week"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Once analytics are wired up, you can show what your friends and the community are watching the most here."})]})]}):m?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:d?e.jsxs(e.Fragment,{children:["Searching for ",e.jsx("span",{className:"font-semibold text-foreground",children:d}),"…"]}):e.jsx(e.Fragment,{children:"Browsing titles…"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d?"Fetching matching titles from your catalog and external sources.":"Fetching titles that match your selected filters."}),e.jsx("div",{className:"space-y-2",children:[0,1,2].map(p=>e.jsxs("div",{className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2",children:[e.jsx("div",{className:"h-16 w-11 animate-pulse rounded-xl bg-card/60"}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center space-y-1.5",children:[e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-card/60"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-card/40"})]})]},p))})]}):y?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-destructive",children:["Something went wrong while ",d?"searching":"browsing"," titles."]}),l&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Details: "}),l.message]})]}):ee?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-semibold text-foreground",children:ee})," result",ee===1?"":"s"," ",d?"across your catalog and external sources for ":"in your catalog for ",d?e.jsx("span",{className:"font-semibold text-foreground",children:d}):e.jsx("span",{className:"font-semibold text-foreground",children:"your filters"}),"."]}),g?e.jsxs(k,{type:"button",variant:"outline",size:"sm",className:"h-auto rounded-full border-border px-2 py-1 text-muted-foreground hover:border-border hover:text-foreground",onClick:g,children:[e.jsx(Ae,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Reset filters"})]}):null]}),v&&!C?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(se,{className:"h-3.5 w-3.5 animate-spin","aria-hidden":"true"}),"Updating results…"]}):null,e.jsx("div",{className:"rounded-2xl border border-border bg-background/60 p-3",children:e.jsxs("p",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground",children:e.jsx(Ae,{className:"h-3 w-3","aria-hidden":"true"})}),e.jsx("span",{className:"truncate",children:de})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Sort"}),[{key:"relevance",label:"Relevance"},{key:"newest",label:"Newest"},{key:"rating",label:"Rating"}].filter(p=>d?!0:p.key!=="relevance").map(p=>{const b=I===p.key;return e.jsx(k,{type:"button",size:"sm",variant:b?"default":"outline",className:"h-8 rounded-full px-3",onClick:()=>f?.(p.key),children:p.label},p.key)})]}),e.jsx(At,{style:{height:"calc(100dvh - 340px)"},data:j,overscan:200,increaseViewportBy:{top:200,bottom:700},endReached:()=>{c&&!C&&_()},components:{List:x.forwardRef(function(b,M){return e.jsx("div",{ref:M,className:"space-y-2",...b})}),Footer:()=>c?e.jsx("div",{className:"flex justify-center py-3",children:e.jsx(k,{type:"button",className:"inline-flex items-center justify-center rounded-full bg-primary/90 disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>_(),disabled:C,children:C?"Loading more…":"Load more results"})}):null},itemContent:(p,b)=>{const M=le(b.id)?b.id:S[b.id]??null,N=M?X.get(M):null,A=N?.status==="want_to_watch",D=!!T&&(le(b.id)||!!b.tmdbId),W=ne===b.id,Fe=T?e.jsxs("div",{className:"flex items-center gap-2",children:[typeof N?.rating=="number"?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-border bg-card/50 px-2 py-1 text-[11px] text-muted-foreground",children:[e.jsx(Ve,{className:"h-3 w-3","aria-hidden":"true"}),N.rating]}):null,e.jsx(k,{type:"button",size:"icon",variant:A?"secondary":"outline",className:"rounded-full",onClick:()=>pe(b),disabled:!D||W||q.updateStatus.isPending,title:A?"Remove from watchlist":"Add to watchlist","aria-label":A?"Remove from watchlist":"Add to watchlist",children:W?e.jsx(se,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}):A?e.jsx(Dt,{className:"h-4 w-4","aria-hidden":"true"}):e.jsx(Rt,{className:"h-4 w-4","aria-hidden":"true"})})]}):null;return e.jsx(Ue,{item:b,query:d,right:Fe,onSelect:be,disabled:!!z,loading:z===b.id})}})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:d?e.jsxs(e.Fragment,{children:["No titles found matching"," ",e.jsx("span",{className:"font-semibold text-foreground",children:d}),"."]}):e.jsx(e.Fragment,{children:"No titles match these filters."})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d?"Try adjusting your search or removing some filters to see more results.":"Try removing a few filters to broaden the results."})]})},Ht=(t,n)=>{const a=(t??n??"").trim();if(!a)return"?";const f=a.split(/\s+/).filter(Boolean);return f.length===1?f[0].slice(0,2).toUpperCase():(f[0][0]+f[1][0]).toUpperCase()},Wt=({avatarUrl:t,displayName:n,username:a,sizePx:f})=>{const g=Ht(n,a);return t?e.jsx("img",{src:t,alt:n??a??"Profile",className:"shrink-0 rounded-full object-cover",style:{width:f,height:f},loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"flex shrink-0 items-center justify-center rounded-full bg-muted text-xs font-bold text-foreground",style:{width:f,height:f},"aria-label":"Profile initials",children:g})},je=({person:t,variant:n="full",showFollow:a=!0,showMessage:f=!0,showDismiss:g=!1,onDismiss:d,highlightQuery:i,className:w})=>{const o=Re(),{user:u}=ae(),m=Mt(),[y,l]=x.useState(!1),_=t.displayName??t.username??"Unknown",c=t.username?`@${t.username}`:null,v=!!(u?.id&&u.id===t.id),C=t.username?`/u/${t.username}`:`/u/${t.id}`,I=m.isPending&&m.variables?.targetUserId===t.id,j=async()=>{if(!u?.id){alert("You need to be signed in to start a conversation.");return}if(u.id===t.id){alert("You can't start a conversation with yourself.");return}l(!0);try{const S=await Me("create-direct-conversation",{targetUserId:t.id},{timeoutMs:25e3});if(!S?.ok||!S.conversationId){const Y=S?.code;let L=S?.error??"Failed to start a conversation. Please try again.";Y==="UNAUTHORIZED"?L="You need to be signed in to start a conversation.":Y==="BAD_REQUEST_SELF_TARGET"?L="You can't start a conversation with yourself.":Y==="SERVER_MISCONFIGURED"&&(L="Messaging is temporarily unavailable due to a server issue. Please try again later.");const V=new Error(L);throw V.code=Y,V}o(`/messages/${S.conversationId}`)}catch(S){console.error("[PeopleResultRow] Failed to start conversation",S);const Y=S instanceof Error?S.message:"Something went wrong while starting the conversation. Please try again.";alert(Y)}finally{l(!1)}},T=a&&!!u?.id&&!v,U=f&&!!u?.id&&!v,q=g&&!!u?.id&&!!d,Z=()=>!(typeof t.followersCount=="number"||typeof t.followingCount=="number")&&!t.matchPercent?null:e.jsxs("div",{className:"mt-0.5 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[typeof t.matchPercent=="number"?e.jsxs("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] font-medium text-foreground",children:["Match ",t.matchPercent,"%"]}):null,typeof t.followersCount=="number"?e.jsxs("span",{children:[t.followersCount," follower",t.followersCount===1?"":"s"]}):null,typeof t.followersCount=="number"&&typeof t.followingCount=="number"?e.jsx("span",{children:"·"}):null,typeof t.followingCount=="number"?e.jsxs("span",{children:["following ",t.followingCount]}):null]});if(n==="compact"){const S=!!t.bio&&g;return e.jsxs("div",{className:`soft-row-card flex min-h-11 items-center justify-between gap-3 row-pad ${w??""}`,children:[e.jsxs(xe,{to:C,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx(Wt,{avatarUrl:t.avatarUrl,displayName:t.displayName,username:t.username,sizePx:36}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{text:_,query:i,firstOnly:!0,className:"block truncate text-sm font-semibold text-foreground"}),t.isVerified?e.jsx(Qe,{isVerified:t.isVerified??null,type:t.verifiedType??null,label:t.verifiedLabel??null,verifiedAt:t.verifiedAt??null,org:t.verifiedByOrg??null}):null,typeof t.matchPercent=="number"?e.jsxs("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] font-medium text-foreground",children:["Match ",t.matchPercent,"%"]}):null,v?e.jsx("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] text-muted-foreground",children:"You"}):null]}),c?e.jsx(re,{text:c,query:i,firstOnly:!0,className:"block truncate text-xs text-muted-foreground"}):null,S?e.jsx(re,{text:t.bio??"",query:i,firstOnly:!0,className:"mt-0.5 line-clamp-1 text-xs text-muted-foreground",highlightClassName:"rounded bg-primary/15 px-0.5 text-foreground ring-1 ring-primary/15"}):null]})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-2",children:[q?e.jsx(k,{type:"button",variant:"ghost",size:"icon",className:"icon-hit","aria-label":"Dismiss suggestion",onClick:d,children:e.jsx(ge,{className:"h-4 w-4"})}):null,U?e.jsx(k,{type:"button",variant:"outline",size:"sm",className:"h-8 rounded-full border-border bg-card/80 px-3 text-xs",onClick:j,disabled:y,children:e.jsx(Oe,{className:"h-3.5 w-3.5","aria-hidden":"true"})}):null,T?e.jsx(k,{type:"button",onClick:()=>m.mutate({targetUserId:t.id,currentlyFollowing:!!t.isFollowing}),disabled:I,variant:t.isFollowing?"outline":"default",size:"sm",className:`h-8 rounded-full px-3 text-xs font-medium ${t.isFollowing?"border-border bg-card/80 text-foreground hover:border-primary/70":"bg-primary text-primary-foreground hover:bg-primary/90"}`,children:I?e.jsx("span",{children:"…"}):t.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}):null]})]})}return e.jsxs("div",{className:`soft-row-card flex min-h-11 items-center justify-between gap-3 row-pad ${w??""}`,children:[e.jsxs(xe,{to:C,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-card/80 text-[14px] font-semibold text-foreground",children:t.avatarUrl?e.jsx("img",{src:t.avatarUrl,alt:_,className:"h-9 w-9 rounded-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):_?_[0]?.toUpperCase():e.jsx(Et,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{text:_,query:i,firstOnly:!0,className:"block truncate text-sm font-medium text-foreground"}),t.isVerified?e.jsx(Qe,{isVerified:t.isVerified??null,type:t.verifiedType??null,label:t.verifiedLabel??null,verifiedAt:t.verifiedAt??null,org:t.verifiedByOrg??null}):null,v?e.jsx("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] text-muted-foreground",children:"You"}):null]}),c?e.jsx(re,{text:c,query:i,firstOnly:!0,className:"mt-0.5 block truncate text-xs text-muted-foreground"}):null,t.bio?e.jsx(re,{text:t.bio,query:i,firstOnly:!0,className:"mt-0.5 line-clamp-2 text-xs text-muted-foreground",highlightClassName:"rounded bg-primary/15 px-0.5 text-foreground ring-1 ring-primary/15"}):null,Z()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[q?e.jsx(k,{type:"button",variant:"ghost",size:"icon",className:"icon-hit","aria-label":"Dismiss suggestion",onClick:d,children:e.jsx(ge,{className:"h-4 w-4"})}):null,T?e.jsx(k,{type:"button",onClick:()=>m.mutate({targetUserId:t.id,currentlyFollowing:!!t.isFollowing}),disabled:I,variant:t.isFollowing?"outline":"default",size:"sm",className:`h-auto rounded-full px-2.5 py-1.5 text-xs font-medium ${t.isFollowing?"border-border bg-card/80 text-foreground hover:border-primary/70 disabled:opacity-60":"border border-transparent bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-60"}`,children:I?e.jsx("span",{children:"Updating…"}):t.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}):null,U?e.jsx(k,{type:"button",onClick:j,disabled:y,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-card/80 px-2.5 py-1.5 text-xs font-medium text-foreground shadow-md hover:border-primary/70 hover:text-foreground disabled:cursor-not-allowed disabled:opacity-60",children:y?e.jsx("span",{children:"Starting…"}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Message"})]})}):null]})]})},Jt=({query:t})=>{const n=t.trim(),a=n.replace(/^@+/,""),f=a||n,g=a.length>0&&a.length<2,{data:d,isLoading:i,isFetching:w,isError:o,error:u}=rt(a),m=d??[];if(g)return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["Keep typing to search people — enter at least"," ",e.jsx("span",{className:"font-semibold text-foreground",children:"2 characters"}),"."]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Tip: You can type ",e.jsx("span",{className:"font-semibold text-foreground",children:"@"})," to search usernames."]})]});if(!a)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a name or @username to find people. Once the social graph is wired up, you'll be able to follow friends and start conversations from here."}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-2 text-xs text-muted-foreground",children:[e.jsx(Bt,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Search for people you know, then follow or message them."})]})]});if(i)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Searching for people…"}),e.jsx("div",{className:"rounded-2xl border border-border bg-card/80 px-3 py-4 text-xs text-muted-foreground",children:"We'll show matching profiles here as soon as the results come back."})]});if(o)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-foreground",children:"Something went wrong."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:u?.message??"We couldn&apos;t search for people right now. Please try again."})]});if(!m||m.length===0)return e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No people found for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",f,"”"]}),". Try a different name or username."]})});const y=m.map(l=>({id:l.id,username:l.username,displayName:l.displayName,avatarUrl:l.avatarUrl,bio:l.bio,followersCount:l.followersCount??null,followingCount:l.followingCount??null,isFollowing:l.isFollowing,matchPercent:l.matchPercent??null,isVerified:l.isVerified??null,verifiedType:l.verifiedType??null,verifiedLabel:l.verifiedLabel??null,verifiedAt:l.verifiedAt??null,verifiedByOrg:l.verifiedByOrg??null}));return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",m.length," profile",m.length===1?"":"s"," for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",f,"”"]})]})}),w?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(se,{className:"h-3.5 w-3.5 animate-spin","aria-hidden":"true"}),"Updating results…"]}):null,e.jsx("div",{className:"space-y-2",children:y.map(l=>e.jsx(je,{person:l,variant:"full",highlightQuery:a},l.id))})]})},nt="movinesta.search.recent",Zt=t=>{if(!t)return[];try{const n=JSON.parse(t);return Array.isArray(n)?n.map(a=>({term:typeof a?.term=="string"?a.term:"",ts:typeof a?.ts=="number"?a.ts:0})).filter(a=>a.term.trim().length>0).slice(0,20):[]}catch{return[]}},Ee=t=>{try{localStorage.setItem(nt,JSON.stringify(t))}catch{}},ke=()=>{if(typeof window>"u")return[];try{return Zt(localStorage.getItem(nt))}catch{return[]}},Xt=(t,n=10)=>{if(typeof window>"u")return;const a=t.trim();if(a.length<2)return;const f=Date.now(),g=ke(),d=[{term:a,ts:f},...g.filter(i=>i.term.toLowerCase()!==a.toLowerCase())].slice(0,n);Ee(d),window.dispatchEvent(new CustomEvent("movinesta:recent-searches"))},er=t=>{if(typeof window>"u")return;const n=t.trim(),f=ke().filter(g=>g.term.toLowerCase()!==n.toLowerCase());Ee(f),window.dispatchEvent(new CustomEvent("movinesta:recent-searches"))},tr=()=>{typeof window>"u"||(Ee([]),window.dispatchEvent(new CustomEvent("movinesta:recent-searches")))};function _e(t){return typeof t!="number"||!Number.isFinite(t)?null:t.toFixed(1)}function rr(t){const n=(t?.mediaItemId??"").toString(),a=(t?.title??"").toString().trim();if(!n||!a)return null;const f=(t?.posterUrl&&t.posterUrl.trim()?t.posterUrl:null)??(t?.tmdbPosterPath?vt(t.tmdbPosterPath,"w500"):null);return{id:n,title:a,imageUrl:f,ratingLabel:_e(t?.imdbRating??null),subtitle:t?.why?String(t.why):null,friendAvatarUrls:(t?.friendProfiles??[]).map(g=>g?.avatar_url?String(g.avatar_url):null).filter(g=>!!g).slice(0,3),friendExtraCount:Math.max(0,((t?.friendProfiles??[]).length||0)-3)}}function sr(t,n){const a=Ne(t.media_item),f=a.id;if(!f||!a.title)return null;const g=a.posterUrl??a.backdropUrl??null,d=_e(a.imdbRating??null);return{id:f,title:a.title,imageUrl:g,ratingLabel:d,subtitle:null,friendAvatarUrls:n?[n]:[],friendExtraCount:0}}function ar(t=10){const{user:n}=ae(),a=n?.id??null,f=async()=>{const g=`
      id,
      kind,
      tmdb_id,
      tmdb_title,
      tmdb_name,
      tmdb_original_title,
      tmdb_original_name,
      tmdb_release_date,
      tmdb_first_air_date,
      tmdb_poster_path,
      tmdb_backdrop_path,
      tmdb_original_language,
      tmdb_genre_ids,
      tmdb_vote_average,
      tmdb_vote_count,
      tmdb_popularity,
      omdb_title,
      omdb_year,
      omdb_language,
      omdb_imdb_id,
      omdb_imdb_rating,
      omdb_rating_rotten_tomatoes,
      omdb_poster,
      omdb_rated
    `,d=u=>{if(!u)return null;const m=String(u).trim();return m||null};try{const{data:u,error:m}=await G.from("media_item_trending_72h").select("media_item_id, trend_score").order("trend_score",{ascending:!1}).limit(Math.max(10,Math.min(t*6,80)));if(!m&&Array.isArray(u)&&u.length){const y=new Map,l=[];for(const _ of u){const c=d(_?.media_item_id);if(!c)continue;const v=Number(_?.trend_score??0);if(y.has(c)||l.push(c),y.set(c,Number.isFinite(v)?v:0),l.length>=Math.max(10,Math.min(t*4,40)))break}if(l.length){const{data:_,error:c}=await G.from("media_items").select(g).in("id",l).in("kind",["movie","series"]).limit(l.length);if(!c&&Array.isArray(_)&&_.length){const C=_.map(I=>{const j=Ne(I);return!j?.id||!j?.title?null:{id:j.id,title:j.title,imageUrl:j.posterUrl??j.backdropUrl??null,ratingLabel:_e(j.imdbRating??null),subtitle:null,friendAvatarUrls:[],friendExtraCount:0,_score:y.get(j.id)??0}}).filter(I=>I!==null);return C.sort((I,j)=>j._score-I._score),C.slice(0,Math.max(1,Math.min(t,24))).map(I=>{const{_score:j,...T}=I;return T})}c&&console.warn("[search.discover] trending view -> media_items lookup failed",c)}}m&&console.warn("[search.discover] trending view unavailable",m)}catch(u){console.warn("[search.discover] trending view fallback threw",u)}const{data:i,error:w}=await G.from("media_items").select(g).in("kind",["movie","series"]).order("tmdb_popularity",{ascending:!1,nullsFirst:!1}).order("tmdb_vote_count",{ascending:!1,nullsFirst:!1}).order("tmdb_vote_average",{ascending:!1,nullsFirst:!1}).order("tmdb_release_date",{ascending:!1,nullsFirst:!1}).order("tmdb_first_air_date",{ascending:!1,nullsFirst:!1}).limit(Math.max(1,Math.min(t,24)));return w?(console.warn("[search.discover] popularity fallback trending query failed",w),[]):(Array.isArray(i)?i:[]).map(u=>{const m=Ne(u);return!m?.id||!m?.title?null:{id:m.id,title:m.title,imageUrl:m.posterUrl??m.backdropUrl??null,ratingLabel:_e(m.imdbRating??null),subtitle:null,friendAvatarUrls:[],friendExtraCount:0}}).filter(u=>u!==null)};return Ce({queryKey:["search","discover","trending",a??"anon",t],enabled:!0,staleTime:1e3*60*10,retry:1,retryDelay:750,queryFn:async()=>{try{const g=Xe(),d=pt(g,"trending",null),w=(await bt({sessionId:g,mode:"trending",limit:t,seed:d})).cards.map(rr).filter(o=>!!o);if(w.length)return w}catch(g){console.warn("[search.discover] trending deck failed, falling back",g)}return await f()}})}function nr(t){const n=(t?.id??"").toString(),a=t?.avatar_url?String(t.avatar_url):null;return{id:n,avatarUrl:a}}function ir(t=8){const{user:n}=ae(),a=n?.id??null;return Ce({queryKey:["search","discover","friends",a,t],enabled:!!a,staleTime:1e3*60*2,queryFn:async()=>{if(!a)return[];const{rows:g}=await yt({userId:a,limit:200,cursorCreatedAt:null,cursorId:null}),d=g.filter(o=>o.user_id!==a&&typeof o.media_item_id=="string"&&o.media_item_id),i=new Map;for(const o of d){const u=o.media_item_id??"";if(!u)continue;const m=nr(o.actor_profile),y=m.id||o.user_id,l=i.get(u)??{row:o,users:new Map,watched:0,watchlist:0,rated:0};new Date(o.created_at).getTime()>new Date(l.row.created_at).getTime()&&(l.row=o),y&&l.users.set(y,m.avatarUrl??null),o.event_type==="watched"&&(l.watched+=1),o.event_type==="watchlist_added"&&(l.watchlist+=1),o.event_type==="rating_created"&&(l.rated+=1),i.set(u,l)}return Array.from(i.values()).map(o=>{const u=o.users.size,m=sr(o.row,null);if(!m)return null;const y=Array.from(o.users.values()).filter(l=>typeof l=="string"&&l.trim().length>0);return m.friendAvatarUrls=y.slice(0,3),m.friendExtraCount=Math.max(0,u-3),o.watched>0?m.subtitle=`${o.watched} friend${o.watched===1?"":"s"} watched`:o.watchlist>0?m.subtitle=`${o.watchlist} friend${o.watchlist===1?"":"s"} added to watchlist`:o.rated>0?m.subtitle=`${o.rated} friend${o.rated===1?"":"s"} rated`:m.subtitle=`${u} friend${u===1?"":"s"} active`,{poster:m,total:u}}).filter(o=>!!o).sort((o,u)=>u.total-o.total).slice(0,t).map(o=>o.poster)}})}function lr(t=8){const{user:n}=ae(),a=!!n?.id;return Ce({queryKey:["search","discover","curated_lists",t],enabled:a,staleTime:1e3*60*10,queryFn:async()=>{const{data:f,error:g}=await G.from("lists").select("id, name, description, user_id, updated_at").eq("is_public",!0).order("updated_at",{ascending:!1}).limit(t);if(g)throw new Error(g.message);const d=f??[],i=d.map(v=>v.id),w=Array.from(new Set(d.map(v=>v.user_id))),[{data:o,error:u},{data:m,error:y}]=await Promise.all([G.from("profiles_public").select("id, username, display_name, avatar_url").in("id",w),G.from("list_items").select(`list_id, title_id, position,
               media_items: title_id (
                 id,
                 omdb_poster,
                 tmdb_poster_path,
                 tmdb_backdrop_path,
                 tmdb_title,
                 tmdb_name,
                 tmdb_release_date,
                 tmdb_first_air_date,
                 tmdb_original_language,
                 kind,
                 omdb_imdb_rating,
                 omdb_rating_rotten_tomatoes
               )`).in("list_id",i).order("position",{ascending:!0}).limit(t*6)]);if(u)throw new Error(u.message);if(y)throw new Error(y.message);const l=new Map;for(const v of o??[])l.set(v.id,v);const _=new Map;for(const v of m??[]){const C=v.list_id;!C||_.has(C)||_.set(C,v)}return d.map(v=>{const C=l.get(v.user_id)??null,I=(C?.display_name?.toString().trim()||C?.username?.toString().trim())??"Someone",T=_.get(v.id)?.media_items??null,U=T?Ne(T):null,q=U?.posterUrl??U?.backdropUrl??null;return{id:v.id,name:v.name,description:v.description,owner:{id:v.user_id,displayName:I,avatarUrl:C?.avatar_url?String(C.avatar_url):null},coverUrl:q}})}})}function or(){return Te.useMemo(()=>[{key:"action",label:"Action",tmdbGenreId:28},{key:"drama",label:"Drama",tmdbGenreId:18},{key:"horror",label:"Horror",tmdbGenreId:27},{key:"sci-fi",label:"Sci‑Fi",tmdbGenreId:878},{key:"comedy",label:"Comedy",tmdbGenreId:35},{key:"documentary",label:"Docu",tmdbGenreId:99}],[])}const We=t=>typeof t!="string"?!1:/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(t),we=({label:t,active:n,onClick:a})=>e.jsx("button",{type:"button",onClick:a,className:`flex h-9 shrink-0 items-center justify-center rounded-full px-5 text-sm font-semibold transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background active:scale-95 ${n?"bg-primary text-primary-foreground shadow-sm":"bg-muted/60 text-foreground hover:bg-muted"}`,children:t}),fe=({label:t,onClick:n,onClear:a})=>e.jsxs("div",{className:"inline-flex max-w-full items-center gap-1 rounded-full border border-border/70 bg-card/80 pl-3 pr-1 py-1 text-xs font-semibold text-foreground shadow-sm",children:[e.jsx("button",{type:"button",onClick:n,className:"max-w-[220px] truncate text-left text-xs font-semibold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",title:t,children:t}),a?e.jsx("button",{type:"button",onClick:a,className:"inline-flex h-6 w-6 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/60 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background","aria-label":`Clear ${t}`,children:e.jsx(ge,{className:"h-3.5 w-3.5"})}):null]}),te=({title:t,actionLabel:n,onAction:a})=>e.jsxs("div",{className:"flex items-center justify-between gap-3 pb-[var(--section-gap)]",children:[e.jsx("h2",{className:"text-lg font-semibold leading-tight tracking-tight text-foreground sm:text-xl",children:t}),n&&a?e.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full border border-transparent px-3 py-1 text-sm font-semibold text-primary transition-colors hover:bg-primary/10 hover:text-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:n}):null]}),oe=({children:t})=>e.jsx("section",{className:"rounded-2xl border border-border/60 bg-card/40 card-pad shadow-sm",children:t}),dr=({label:t})=>t?e.jsxs("div",{className:"absolute right-2 top-2 inline-flex items-center gap-1 rounded-full bg-black/60 px-2 py-0.5 text-xs font-bold text-white backdrop-blur-sm",children:[e.jsx(Se,{name:"star",filled:!0,className:"text-[14px] text-yellow-400",ariaLabel:"Rating"}),e.jsx("span",{children:t})]}):null,Je=({id:t,title:n,imageUrl:a,ratingLabel:f,subtitle:g,friendAvatarUrls:d,friendExtraCount:i})=>{const w=(d??[]).map((o,u)=>({id:`${t}_${u}`,username:null,display_name:null,avatar_url:o}));if(i&&i>0)for(let o=0;o<i;o+=1)w.push({id:`${t}_placeholder_${o}`,username:null,display_name:null,avatar_url:null});return e.jsxs(xe,{to:`/title/${t}`,className:"group flex flex-col gap-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[e.jsxs("div",{className:"relative aspect-[2/3] w-full overflow-hidden rounded-[20px] bg-muted shadow-sm ring-1 ring-border/50 transition-transform duration-300 group-hover:scale-[1.02] group-hover:shadow-lg",style:a?{backgroundImage:`url(${a})`,backgroundSize:"cover",backgroundPosition:"center"}:void 0,children:[a?null:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/25 via-background/10 to-primary/40"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/45 via-transparent to-transparent"}),e.jsx(dr,{label:f}),w.length?e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx($t,{profiles:w,max:3,size:32})}):null]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-base font-medium leading-tight",children:n}),g?e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs font-semibold text-muted-foreground",children:[e.jsx(Se,{name:"group_add",className:"text-[14px]",ariaLabel:"Activity"}),e.jsx("span",{className:"truncate",children:g})]}):null]})]})},cr=({id:t,name:n,description:a,coverUrl:f,ownerLabel:g,ownerAvatarUrl:d})=>e.jsxs(xe,{to:`/lists/${t}`,className:"flex items-center gap-3 rounded-3xl border border-border/70 bg-card/80 p-3 shadow-sm transition-all hover:bg-card hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[e.jsx("div",{className:"h-16 w-14 overflow-hidden rounded-2xl bg-muted",children:f?e.jsx("img",{src:f,alt:n,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-br from-primary/25 via-muted to-primary/30"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:n}),e.jsx("p",{className:"mt-0.5 line-clamp-1 text-xs text-muted-foreground",children:a||"Curated collection"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 overflow-hidden rounded-full bg-muted",children:d?e.jsx("img",{src:d,alt:g,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"h-full w-full bg-primary/20"})}),e.jsx("p",{className:"truncate text-xs font-medium text-muted-foreground",children:g})]})]}),e.jsx(Se,{name:"chevron_right",className:"text-[22px] text-muted-foreground",ariaLabel:"Open"})]});function ur(t,n){return t==="people"?"people":t==="titles"?n.type==="series"?"series":"movies":"all"}function mr(t){return t==="people"?{tab:"people"}:t==="movies"?{tab:"titles",nextFilters:{type:"movie"}}:t==="series"?{tab:"titles",nextFilters:{type:"series"}}:{tab:"all"}}const Tr=()=>{const t=Re(),{user:n}=ae(),a=Yt(),f=x.useRef(""),g=x.useCallback(r=>{const s=r.trim();s.length<2||s!==f.current&&(f.current=s,Xt(s))},[]),[d,i]=wt(),w=(d.get("q")??"").toString(),[o,u]=x.useState(w),m=x.useRef(null);x.useEffect(()=>{u(w)},[w]);const y=Lt(o,250),l=y.trim(),_=It(d),c=Pt(d),v=Tt(d,l),C=!!d.get("sort"),I=v==="relevance"?"Relevance":v==="newest"?"Newest":"Rating",[j,T]=x.useState(()=>typeof window>"u"?[]:ke()),[U,q]=x.useState(null);x.useEffect(()=>{if(typeof window>"u")return;const r=()=>T(ke());return r(),window.addEventListener("movinesta:recent-searches",r),window.addEventListener("storage",r),()=>{window.removeEventListener("movinesta:recent-searches",r),window.removeEventListener("storage",r)}},[]);const Z=x.useCallback(async r=>{if(We(r.id))return r.id;if(!r.tmdbId)return null;const s=r.type==="series"?"series":"movie";try{const h=await Me("catalog-sync",{tmdbId:r.tmdbId,contentType:s});return st(h)&&We(h.media_item_id)?h.media_item_id:null}catch(h){return console.warn("[SearchPage] catalog-sync failed",h),null}},[]),S=x.useCallback(async r=>{if(!U){q(r.id);try{const s=await Z(r);if(!s)return;t(`/title/${s}`)}finally{q(null)}}},[Z,t,U]),Y=!!(typeof c.minYear=="number"||typeof c.maxYear=="number"||c.originalLanguage||c.genreIds?.length),L=_,V=ur(L,c);x.useEffect(()=>{L==="titles"&&(c.type==="movie"||c.type==="series"||i(r=>{const s=new URLSearchParams(r);return s.set("type","movie"),s},{replace:!0}))},[L,c.type,i]),x.useEffect(()=>{y!==w&&i(r=>{const s=new URLSearchParams(r);return y.trim()?s.set("q",y):s.delete("q"),s},{replace:!0})},[y,w,i]);const B=x.useCallback(r=>{const{tab:s,nextFilters:h}=mr(r);i(F=>{const P=new URLSearchParams(F);return P.set("tab",s),s==="people"||s==="all"?(P.delete("minYear"),P.delete("maxYear"),P.delete("lang"),P.delete("genre"),P.delete("genres"),s==="people"?(P.delete("type"),P.delete("sort")):P.set("type","all")):h?.type&&P.set("type",h.type),P},{replace:!1})},[i]),X=x.useCallback(r=>{i(s=>{const h=new URLSearchParams(s);return h.set("sort",r),h},{replace:!1})},[i]),ne=x.useCallback(()=>{u(""),i(r=>{const s=new URLSearchParams(r);return s.delete("q"),s},{replace:!0})},[i]),he=x.useCallback(r=>{const s=r.trim();s&&(u(s),i(h=>{const F=new URLSearchParams(h);return F.set("q",s),F.get("tab")||F.set("tab","all"),F},{replace:!1}))},[i]),[z,Q]=x.useState(!1),[H,pe]=x.useState(typeof c.minYear=="number"?String(c.minYear):""),[ee,be]=x.useState(typeof c.maxYear=="number"?String(c.maxYear):""),[$,de]=x.useState(c.originalLanguage??""),[ce,p]=x.useState(c.genreIds??[]),b=(c.genreIds??[]).join(",");x.useEffect(()=>{z&&(pe(typeof c.minYear=="number"?String(c.minYear):""),be(typeof c.maxYear=="number"?String(c.maxYear):""),de(c.originalLanguage??""),p(c.genreIds??[]))},[z,c.minYear,c.maxYear,c.originalLanguage,b]);const M=x.useCallback(()=>{const r=J=>{const R=Number(J);return Number.isFinite(R)?Math.floor(R):void 0};let s=Ge(r(H)),h=Ge(r(ee));if(s&&h&&s>h){const J=s;s=h,h=J}const F=$.trim()?$.trim().toLowerCase():void 0,P=(ce??[]).filter(J=>Number.isFinite(J)&&J>0);i(J=>{const R=new URLSearchParams(J);R.set("tab","titles");const De=R.get("type");return De!=="movie"&&De!=="series"&&R.set("type","movie"),typeof s=="number"?R.set("minYear",String(s)):R.delete("minYear"),typeof h=="number"?R.set("maxYear",String(h)):R.delete("maxYear"),F?R.set("lang",F):R.delete("lang"),R.delete("genre"),R.delete("genres"),P.length&&R.set("genres",P.join(",")),R},{replace:!1}),Q(!1)},[ce,$,ee,H,i]),N=x.useCallback(()=>{i(r=>{const s=new URLSearchParams(r);s.set("tab","titles");const h=s.get("type");return h!=="movie"&&h!=="series"&&s.set("type","movie"),s.delete("minYear"),s.delete("maxYear"),s.delete("lang"),s.delete("genre"),s.delete("genres"),s},{replace:!1}),Q(!1)},[i]),A=x.useCallback(()=>{i(r=>{const s=new URLSearchParams(r);return s.delete("minYear"),s.delete("maxYear"),s.delete("lang"),s.delete("genre"),s.delete("genres"),s},{replace:!1})},[i]),D=x.useCallback(()=>{i(r=>{const s=new URLSearchParams(r);return s.delete("sort"),s},{replace:!1})},[i]),W=x.useCallback(()=>{i(r=>{const s=new URLSearchParams(r);return s.delete("minYear"),s.delete("maxYear"),s},{replace:!1})},[i]),Fe=x.useCallback(()=>{i(r=>{const s=new URLSearchParams(r);return s.delete("lang"),s},{replace:!1})},[i]),it=x.useCallback(()=>{i(r=>{const s=new URLSearchParams(r);return s.delete("genre"),s.delete("genres"),s},{replace:!1})},[i]),lt=x.useCallback(()=>{const r=l.length>0?["relevance","newest","rating"]:["newest","rating"],s=r.indexOf(v),h=s>=0?r[(s+1)%r.length]:r[0];X(h)},[X,v,l]),ie=x.useCallback(()=>{L!=="people"&&(L==="all"&&i(r=>{const s=new URLSearchParams(r);return s.set("tab","titles"),s},{replace:!1}),Q(!0))},[L,i]);x.useEffect(()=>{if(typeof window>"u")return;const r=h=>{const F=h;if(!F)return!1;const P=F.tagName?.toLowerCase?.();return P==="input"||P==="textarea"||P==="select"?!0:!!F.isContentEditable},s=h=>{if(!h.defaultPrevented){if(h.key==="/"&&!r(h.target)){h.preventDefault(),m.current?.focus();return}if(h.key==="Escape"&&!r(h.target)){if(z){h.preventDefault(),Q(!1);return}h.preventDefault(),ne()}}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[ne,z]);const ye=or(),ot=x.useMemo(()=>{const r=new Map;for(const s of ye)r.set(s.tmdbGenreId,s.label);return r},[ye]),K=ar(10),Le=ir(8),Ie=lr(6),Be=L==="all",dt=L==="all",E=et({query:Be?l:"",filters:Be?c:void 0}),O=rt(dt?l.replace(/^@+/,""):""),ve=x.useMemo(()=>{const r=E.data?.pages??[];return r.flatMap(F=>F.results??[]).length?r.flatMap(F=>tt({items:F.results??[],query:l,sortKey:v})):[]},[v,E.data,l]),ue=x.useMemo(()=>ve.filter(r=>r.type==="movie"),[ve]),me=x.useMemo(()=>ve.filter(r=>r.type==="series"),[ve]),ct=l.length===0&&L==="all",ut=x.useCallback(()=>{t("/swipe?mode=trending")},[t]),mt=x.useCallback(()=>{t("/activity")},[t]),$e=typeof c.minYear=="number"||typeof c.maxYear=="number"?`Year: ${typeof c.minYear=="number"&&typeof c.maxYear=="number"?`${c.minYear}-${c.maxYear}`:typeof c.minYear=="number"?`≥${c.minYear}`:`≤${c.maxYear}`}`:null,Ye=c.originalLanguage?`Lang: ${c.originalLanguage.toUpperCase()}`:null,qe=(c.genreIds?.length??0)>0?(()=>{const r=c.genreIds??[],s=r.map(P=>ot.get(P)).filter(Boolean);if(!s.length)return`Genres: ${r.length}`;const h=s[0],F=s.length-1;return F>0?`Genres: ${h} +${F}`:`Genres: ${h}`})():null,ft=L==="titles"&&(Y||C);return e.jsxs("div",{className:"relative flex min-h-screen w-full flex-col overflow-x-hidden bg-background pb-2 text-foreground",children:[e.jsx("div",{className:"h-12 w-full"}),e.jsx(jt,{open:z,onOpenChange:Q,children:e.jsxs(Nt,{className:"max-w-lg",children:[e.jsx(kt,{children:e.jsx(_t,{children:"Filters"})}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Year range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(Pe,{value:H,onChange:r=>pe(r.target.value.replace(/[^0-9]/g,"").slice(0,4)),placeholder:"From",inputMode:"numeric"}),e.jsx(Pe,{value:ee,onChange:r=>be(r.target.value.replace(/[^0-9]/g,"").slice(0,4)),placeholder:"To",inputMode:"numeric"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Language"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[["en","ar","ja","ko"].map(r=>{const s=$.toLowerCase()===r;return e.jsx(k,{type:"button",size:"sm",variant:s?"default":"outline",className:"rounded-full",onClick:()=>de(r),children:r.toUpperCase()},r)}),e.jsx(Pe,{value:$,onChange:r=>de(r.target.value.replace(/\s/g,"").slice(0,8)),placeholder:"e.g. fr",className:"h-9 w-28"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use ISO-639-1 codes (en, ar...)."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Genres"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ye.map(r=>{const s=ce.includes(r.tmdbGenreId);return e.jsx(k,{type:"button",size:"sm",variant:s?"default":"outline",className:"rounded-full",onClick:()=>p(h=>h.includes(r.tmdbGenreId)?h.filter(F=>F!==r.tmdbGenreId):[...h,r.tmdbGenreId]),children:r.label},r.tmdbGenreId)})})]})]}),e.jsxs(Ct,{className:"flex-col gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:N,className:"rounded-full",children:"Reset"}),e.jsxs("div",{className:"flex w-full justify-end gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>Q(!1),className:"rounded-full",children:"Cancel"}),e.jsx(k,{type:"button",onClick:M,className:"rounded-full",children:"Apply"})]})]})]})}),e.jsx("div",{className:"sticky top-0 z-30 full-bleed border-b border-border/60 bg-background/95 backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto flex w-full max-w-5xl flex-col gap-[var(--section-gap)] px-[var(--page-pad-x)] py-[var(--page-pad-y)] sm:px-[var(--page-pad-x)] sm:py-[var(--page-pad-y)]",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Discover"}),e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-foreground sm:text-3xl",children:"Search"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Find movies, series, and people with tailored recommendations."})]}),e.jsxs("div",{className:"hidden items-center gap-2 rounded-full border border-border/60 bg-card/70 px-3 py-1 text-xs font-medium text-muted-foreground sm:inline-flex",children:[e.jsx("span",{children:"Shortcut"}),e.jsx("span",{className:"rounded-full border border-border/70 bg-background px-2 py-0.5 font-mono text-[11px] text-foreground",children:"/"}),e.jsx("span",{children:"to search"})]})]}),e.jsxs("label",{className:"flex h-11 w-full items-center gap-3 rounded-2xl border border-border/70 bg-card/80 px-3 shadow-sm transition focus-within:border-primary/60 focus-within:ring-2 focus-within:ring-primary/30",children:[e.jsx(Se,{name:"search",className:"text-[20px] text-muted-foreground",ariaLabel:"Search"}),e.jsx("input",{ref:m,value:o,onChange:r=>u(r.target.value),onKeyDown:r=>{if(r.key==="Escape"){r.preventDefault(),ne(),r.currentTarget.blur();return}r.key==="Enter"&&(g(o),r.currentTarget.blur())},onBlur:()=>g(o),placeholder:"Search movies, shows, people...",className:"h-full flex-1 bg-transparent text-base text-foreground outline-none placeholder:text-muted-foreground",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1}),o?e.jsx("button",{type:"button",onClick:ne,className:"inline-flex h-11 w-11 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background","aria-label":"Clear search",children:e.jsx(ge,{className:"h-4 w-4"})}):null,e.jsx("button",{type:"button",onClick:ie,disabled:L==="people",className:"inline-flex h-11 w-11 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:opacity-40","aria-label":"Filters",children:e.jsxs("span",{className:"relative inline-flex",children:[e.jsx(Ae,{className:"h-4 w-4"}),Y?e.jsx("span",{className:"absolute -right-1 -top-1 h-2 w-2 rounded-full bg-primary","aria-hidden":"true"}):null]})})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:[e.jsx(we,{label:"All",active:V==="all",onClick:()=>B("all")}),e.jsx(we,{label:"Movies",active:V==="movies",onClick:()=>B("movies")}),e.jsx(we,{label:"Series",active:V==="series",onClick:()=>B("series")}),e.jsx(we,{label:"People",active:V==="people",onClick:()=>B("people")})]}),ft?e.jsxs("div",{className:"flex flex-wrap items-center gap-2 pb-1",children:[C?e.jsx(fe,{label:`Sort: ${I}`,onClick:lt,onClear:D}):null,$e?e.jsx(fe,{label:$e,onClick:ie,onClear:W}):null,Ye?e.jsx(fe,{label:Ye,onClick:ie,onClear:Fe}):null,qe?e.jsx(fe,{label:qe,onClick:ie,onClear:it}):null,Y?e.jsx(fe,{label:"Clear all",onClick:A}):null]}):null]})}),ct?e.jsxs("div",{className:"mx-auto flex w-full max-w-5xl flex-col gap-[var(--section-gap)] px-[var(--page-pad-x)] pb-6 pt-[var(--page-pad-y)] sm:px-[var(--page-pad-x)]",children:[j.length?e.jsxs(oe,{children:[e.jsx(te,{title:"Recent searches",actionLabel:"Clear",onAction:tr}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(r=>e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-border/70 bg-background/70 pl-3 pr-1 py-1 text-sm shadow-sm",children:[e.jsx("button",{type:"button",onClick:()=>he(r.term),className:"max-w-[220px] truncate text-sm font-semibold text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",title:r.term,children:r.term}),e.jsx("button",{type:"button",onClick:()=>er(r.term),className:"inline-flex h-7 w-7 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/60 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background","aria-label":`Remove ${r.term}`,children:e.jsx(ge,{className:"h-4 w-4"})})]},r.term))})]}):null,e.jsxs(oe,{children:[e.jsx(te,{title:"Suggested People",actionLabel:"See All",onAction:()=>t("/suggested-people")}),a.isLoading?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((r,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):a.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:"Couldn't load suggestions right now."}):(a.data??[]).length?e.jsx("div",{className:"space-y-3",children:(a.data??[]).slice(0,5).map(r=>{const s={id:r.id,username:r.username,displayName:r.displayName,avatarUrl:r.avatarUrl,bio:r.bio,followersCount:r.followersCount,followingCount:r.followingCount,isFollowing:r.isFollowing,matchPercent:r.matchPercent??null,isVerified:r.isVerified??null,verifiedType:r.verifiedType??null,verifiedLabel:r.verifiedLabel??null,verifiedAt:r.verifiedAt??null,verifiedByOrg:r.verifiedByOrg??null};return e.jsx(je,{person:s,variant:"compact",showMessage:!1,showDismiss:!0,onDismiss:()=>a.dismissPerson(r.id)},r.id)})}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:n?.id?"No suggestions right now.":"Sign in to get personalized people suggestions."})]}),e.jsxs(oe,{children:[e.jsx(te,{title:"Friends Are Watching",actionLabel:"See All",onAction:mt}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Le.isLoading?Array.from({length:4}).map((r,s)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"aspect-[2/3] w-full animate-pulse rounded-[20px] bg-muted"}),e.jsx("div",{className:"h-4 w-3/4 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-muted"})]},s)):Le.data?.length?Le.data.map(r=>e.jsx(Je,{...r},r.id)):e.jsx("div",{className:"col-span-2 rounded-3xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:n?.id?"Your friends’ activity will show up here once they start rating, watching, or adding to watchlists.":"Sign in to see what your friends are watching."})})]}),e.jsxs(oe,{children:[e.jsx(te,{title:"Trending Now",actionLabel:"See All",onAction:ut}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1 [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:K.isLoading?Array.from({length:6}).map((r,s)=>e.jsxs("div",{className:"w-36 shrink-0",children:[e.jsx("div",{className:"aspect-[2/3] w-full animate-pulse rounded-[20px] bg-muted"}),e.jsx("div",{className:"mt-2 h-4 w-3/4 animate-pulse rounded bg-muted"})]},s)):K.isError?e.jsx("div",{className:"w-full shrink-0 rounded-3xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Trending is temporarily unavailable."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:K.error?.message??"Please try again."})]}),e.jsx(k,{type:"button",variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>K.refetch(),disabled:K.isFetching,children:"Retry"})]})}):K.data?.length?K.data.map(r=>e.jsx("div",{className:"w-36 shrink-0",children:e.jsx(Je,{...r,friendAvatarUrls:[],friendExtraCount:0})},r.id)):e.jsx("div",{className:"w-full shrink-0 rounded-3xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.id?"No trending titles right now.":"No trending titles right now. (Sign in to personalize your feed.)"}),e.jsx(k,{type:"button",variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>K.refetch(),disabled:K.isFetching,children:"Refresh"})]})})})]}),e.jsxs(oe,{children:[e.jsx(te,{title:"Curated by Experts & Friends"}),e.jsx("div",{className:"flex flex-col gap-3",children:Ie.isLoading?Array.from({length:3}).map((r,s)=>e.jsx("div",{className:"h-20 animate-pulse rounded-3xl bg-muted"},s)):Ie.data?.length?Ie.data.map(r=>e.jsx(cr,{id:r.id,name:r.name,description:r.description,coverUrl:r.coverUrl,ownerLabel:`by ${r.owner.displayName}`,ownerAvatarUrl:r.owner.avatarUrl},r.id)):e.jsx("div",{className:"rounded-3xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:"Public lists will appear here once you or your friends publish them."})})]}),e.jsxs(oe,{children:[e.jsx(te,{title:"Browse by Category"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3",children:ye.map(r=>e.jsx("button",{type:"button",onClick:()=>{i(s=>{const h=new URLSearchParams(s);return h.set("tab","titles"),h.delete("genre"),h.delete("genres"),h.set("genres",String(r.tmdbGenreId)),h},{replace:!1})},className:"flex h-20 items-center justify-center rounded-3xl border border-border/70 bg-card/80 text-sm font-semibold text-foreground shadow-sm transition-all hover:bg-card hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:r.label},r.key))})]})]}):e.jsx("div",{className:"mx-auto w-full max-w-5xl px-[var(--page-pad-x)] pb-6 pt-[var(--page-pad-y)] sm:px-[var(--page-pad-x)]",children:L==="people"?l.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:"Type a name or @username to search, or browse suggested people below."}),e.jsxs("div",{children:[e.jsx(te,{title:"Suggested People",actionLabel:"See All",onAction:()=>t("/suggested-people")}),a.isLoading?e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((r,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):a.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:"Couldn't load suggestions right now."}):(a.data??[]).length?e.jsx("div",{className:"space-y-3",children:(a.data??[]).slice(0,8).map(r=>{const s={id:r.id,username:r.username,displayName:r.displayName,avatarUrl:r.avatarUrl,bio:r.bio,followersCount:r.followersCount,followingCount:r.followingCount,isFollowing:r.isFollowing,matchPercent:r.matchPercent??null,isVerified:r.isVerified??null,verifiedType:r.verifiedType??null,verifiedLabel:r.verifiedLabel??null,verifiedAt:r.verifiedAt??null,verifiedByOrg:r.verifiedByOrg??null};return e.jsx(je,{person:s,variant:"compact",showMessage:!1,showDismiss:!0,onDismiss:()=>a.dismissPerson(r.id)},r.id)})}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:n?.id?"No suggestions right now.":"Sign in to get personalized people suggestions."})]})]}):e.jsx(Jt,{query:l}):L==="all"?l.length>0&&l.length<2?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:["Keep typing to search — enter at least"," ",e.jsx("span",{className:"font-semibold text-foreground",children:"2 characters"}),"."]}),e.jsx("div",{className:"rounded-2xl border border-border bg-background/60 card-pad text-xs text-muted-foreground",children:"Tip: Use the filters button to browse without typing (genres, year, language)."})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Movies",ue.length?` (${ue.length})`:""]}),E.isFetching&&!E.isLoading?e.jsx(se,{className:"h-4 w-4 animate-spin text-muted-foreground","aria-hidden":"true"}):null]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>B("movies"),className:"h-8 rounded-full",children:"See all"})]}),E.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:4}).map((r,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):E.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Couldn't load movies"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:E.error?.message??"Please try again."})]}),e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>E.refetch(),children:"Retry"})]})}):ue.length?e.jsxs("div",{className:"space-y-2",children:[ue.slice(0,6).map(r=>e.jsx(Ue,{item:r,query:l,onSelect:S,disabled:!!U,loading:U===r.id},r.id)),ue.length>6?e.jsx(k,{variant:"secondary",className:"w-full rounded-2xl",onClick:()=>B("movies"),children:"View more movies"}):null]}):e.jsxs("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-foreground",children:"No matching movies."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Try a different spelling, or use filters to browse by genre, year, or language."}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:ie,children:"Open filters"}),l.startsWith("@")?e.jsx(k,{variant:"outline",size:"sm",className:"h-8 rounded-full",onClick:()=>B("people"),children:"Search people"}):null]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Series",me.length?` (${me.length})`:""]}),E.isFetching&&!E.isLoading?e.jsx(se,{className:"h-4 w-4 animate-spin text-muted-foreground","aria-hidden":"true"}):null]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>B("series"),className:"h-8 rounded-full",children:"See all"})]}),E.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:4}).map((r,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):E.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Couldn't load series"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:E.error?.message??"Please try again."})]}),e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>E.refetch(),children:"Retry"})]})}):me.length?e.jsxs("div",{className:"space-y-2",children:[me.slice(0,6).map(r=>e.jsx(Ue,{item:r,query:l,onSelect:S,disabled:!!U,loading:U===r.id},r.id)),me.length>6?e.jsx(k,{variant:"secondary",className:"w-full rounded-2xl",onClick:()=>B("series"),children:"View more series"}):null]}):e.jsxs("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-foreground",children:"No matching series."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Try a different spelling, or use filters to browse by genre, year, or language."}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:ie,children:"Open filters"})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["People",O.data?.length?` (${O.data.length})`:""]}),O.isFetching&&!O.isLoading?e.jsx(se,{className:"h-4 w-4 animate-spin text-muted-foreground","aria-hidden":"true"}):null]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>B("people"),className:"h-8 rounded-full",children:"See all"})]}),O.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:4}).map((r,s)=>e.jsx("div",{className:"h-14 animate-pulse rounded-2xl bg-muted"},s))}):O.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Couldn't load people"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:O.error?.message??"Please try again."})]}),e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>O.refetch(),children:"Retry"})]})}):O.data?.length?e.jsx("div",{className:"space-y-2",children:O.data.slice(0,6).map(r=>{const s={id:r.id,username:r.username,displayName:r.displayName,avatarUrl:r.avatarUrl,bio:r.bio,followersCount:r.followersCount??null,followingCount:r.followingCount??null,isFollowing:r.isFollowing,matchPercent:r.matchPercent??null,isVerified:r.isVerified??null,verifiedType:r.verifiedType??null,verifiedLabel:r.verifiedLabel??null,verifiedAt:r.verifiedAt??null,verifiedByOrg:r.verifiedByOrg??null};return e.jsx(je,{person:s,variant:"compact",showFollow:!0,showMessage:!0,highlightQuery:l.replace(/^@+/,"")},r.id)})}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:"No matching people."})]})]}):e.jsx(Kt,{query:l,filters:c,sortKey:v,onChangeSort:X,onResetFilters:N})})]})};export{Tr as default};
