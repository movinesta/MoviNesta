import{b as f,e as w,y as c,s as a}from"./index-BhYCkKJ1.js";const d=o=>typeof o=="object"&&o!==null&&"code"in o,h=()=>{const{user:o}=f(),n=w();return c({mutationFn:async({targetUserId:u,currentlyFollowing:s})=>{if(!o)throw new Error("You need to be signed in to follow people.");if(o.id===u)throw new Error("You canâ€™t follow yourself.");if(s){const{error:t}=await a.from("follows").delete().eq("follower_id",o.id).eq("followed_id",u);if(t)throw t;return{isFollowing:!1}}const{error:r}=await a.from("follows").insert({follower_id:o.id,followed_id:u,created_at:new Date().toISOString()});if(r&&(!d(r)||r.code!=="23505"))throw r;return{isFollowing:!0}},onSuccess:(u,s)=>{const{targetUserId:r}=s,{isFollowing:t}=u;n.setQueriesData({queryKey:["search","people"]},l=>l&&l.map(e=>{if(e.id!==r)return e;const i=Math.max(0,(e.followersCount??0)+(t?1:-1));return{...e,isFollowing:t,followersCount:i}})),n.setQueriesData({queryKey:["suggested-people"]},l=>l&&l.map(e=>{if(e.id!==r)return e;const i=Math.max(0,(e.followersCount??0)+(t?1:-1));return{...e,isFollowing:t,followersCount:i}})),n.invalidateQueries({queryKey:["profile"]})}})};export{h as u};
