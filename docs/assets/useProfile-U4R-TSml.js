import{h as c,i as m,s as i}from"./index-DwnuloBv.js";const f=o=>o?.code==="PGRST116",p=o=>{if(!o)return null;const r=o.trim();return r?r.startsWith("@")?r.slice(1):r:null},b=o=>{const{user:r}=c(),t=p(o);return m({queryKey:["profile","byUsername",t,r?.id??null],enabled:!!t,queryFn:async()=>{if(!t)return null;const{data:e,error:n}=await i.from("profiles").select("id, username, display_name, avatar_url, bio").eq("username",t).maybeSingle();if(n)throw f(n)?new Error("Profile not found"):n;if(!e)throw new Error("Profile not found");const l=e.id,[{count:a,error:s},{count:y,error:w}]=await Promise.all([i.from("follows").select("followed_id",{count:"exact",head:!0}).eq("followed_id",l),i.from("follows").select("follower_id",{count:"exact",head:!0}).eq("follower_id",l)]);if(s)throw s;if(w)throw w;let d=!1;if(r&&r.id!==l){const{data:_,error:u}=await i.from("follows").select("follower_id").eq("follower_id",r.id).eq("followed_id",l).maybeSingle();if(u&&!f(u))throw u;d=!!_}return{id:l,username:e.username,displayName:e.display_name,avatarUrl:e.avatar_url,bio:e.bio,followersCount:a??0,followingCount:y??0,isFollowing:d,isCurrentUser:!!r&&r.id===l}}})},g=()=>{const{user:o}=c();return m({queryKey:["profile","current",o?.id??null],enabled:!!o,queryFn:async()=>{if(!o)return null;const{data:r,error:t}=await i.from("profiles").select("id, username, display_name, avatar_url, bio").eq("id",o.id).maybeSingle();if(t)throw f(t)?new Error("Profile not found for current user"):t;if(!r)throw new Error("Profile not found for current user");const e=r.id,{data:n,error:l}=await i.from("user_stats").select("followers_count, following_count").eq("user_id",e).maybeSingle();if(l)throw l;const a=n?.followers_count??0,s=n?.following_count??0;return{id:e,username:r.username,displayName:r.display_name,avatarUrl:r.avatar_url,bio:r.bio,followersCount:a,followingCount:s,isFollowing:!1,isCurrentUser:!0}}})};export{g as a,b as u};
