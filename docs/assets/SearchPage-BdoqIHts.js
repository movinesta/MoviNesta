import{C as Ze,R as m,j as e,b as ae,r as Te,c as Ce,s as z,D as xr,E as se,L as xe,e as gr,u as Re,F as Me,h as Xe,x as hr,q as ze,B as k,M as Oe,k as pr,l as br,m as Ne,t as yr,G as vr}from"./index-Bghr9v56.js";import{D as wr,a as jr,b as Nr,c as _r,e as kr}from"./dialog-yVuVmark.js";import{I as Pe}from"./input-DfCZuzqY.js";import{M as Se}from"./material-icon-luDcVHzZ.js";import{h as Cr,u as er,d as Sr,s as rr,a as Fr,p as Lr,b as Ir,c as Pr,e as Ge}from"./useSearchTitles-BZGeTroe.js";import{u as tr}from"./useSearchPeople-BPZjD7AM.js";import{Y as Tr}from"./index-CHU0NQ6n.js";import{u as Ar}from"./useDiaryLibrary-BT-3O88y.js";import{i as sr}from"./catalogSync-i5cCA8pA.js";import{F as ar}from"./film-qRE4hhXC.js";import{S as Ve,B as Ur}from"./star-C9DFODSo.js";import{u as Rr}from"./useToggleFollow-DoOC9AzB.js";import{V as Qe}from"./VerifiedBadge-Dw8xsn8W.js";import{X as ge}from"./x-C_YReo_I.js";import{U as Ke,a as He}from"./user-plus-CXHnVd-K.js";import{U as Mr}from"./user-CR5PAUDg.js";import{U as Er}from"./users-B8Ae2k-1.js";import{F as Br}from"./FriendAvatarStack-BaTtzGkP.js";import{u as $r}from"./useSuggestedPeople-Dwynw9V8.js";const Yr=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]],qr=Ze("bookmark-check",Yr);const Dr=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],Ae=Ze("sliders-horizontal",Dr),zr=r=>r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),te=({text:r,query:n,className:a,highlightClassName:u,firstOnly:f=!1})=>{const c=(n??"").trim(),d=m.useMemo(()=>{if(!c)return[{chunk:r,hit:!1}];const y=zr(c),g=new RegExp(y,"ig"),i=[];let h=0,o,j=0;for(;(o=g.exec(r))!==null;){o.index>h&&i.push({chunk:r.slice(h,o.index),hit:!1});const l=o[0];if(i.push({chunk:l,hit:!0}),h=o.index+l.length,j+=1,f&&j>=1||l.length===0)break}return h<r.length&&i.push({chunk:r.slice(h),hit:!1}),i.length?i:[{chunk:r,hit:!1}]},[c,r,f]),w=u??"rounded bg-primary/20 px-0.5 text-foreground ring-1 ring-primary/20";return e.jsx("span",{className:a,children:d.map((y,g)=>y.hit?e.jsx("span",{className:w,children:y.chunk},g):e.jsx(m.Fragment,{children:y.chunk},g))})},Or=r=>typeof r!="string"?!1:/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(r),Gr=r=>{const n=[],a=new Set;for(const u of r)u&&(a.has(u)||(a.add(u),n.push(u)));return n},Vr=r=>{const{user:n}=ae(),a=n?.id??null,u=Te.useMemo(()=>Gr((r??[]).filter(d=>Or(d))).slice(0,200),[r]),f=Te.useMemo(()=>u.slice().sort().join(","),[u]);return Ce({queryKey:["search","titleDiaryBulk",a,f],enabled:!!a&&u.length>0,staleTime:1e3*20,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>{if(!a||u.length===0)return new Map;const c=new Map,[{data:d,error:w},{data:y,error:g}]=await Promise.all([z.from("library_entries").select("title_id,status").eq("user_id",a).in("title_id",u),z.from("ratings").select("title_id,rating").eq("user_id",a).in("title_id",u)]);if(w)throw w;if(g)throw g;return(d??[]).forEach(i=>{const h=i?.title_id;h&&c.set(h,{status:i?.status??null,rating:null})}),(y??[]).forEach(i=>{const h=i?.title_id;if(!h)return;const o=xr(i?.rating??null),j=c.get(h)??{status:null,rating:null};c.set(h,{...j,rating:o})}),c}})},Ue=({item:r,query:n,right:a,onSelect:u,disabled:f,loading:c})=>{const d=[];r.year&&d.push(String(r.year)),r.type==="movie"&&d.push("Movie"),r.type==="series"&&d.push("Series"),r.originalLanguage&&d.push(`Language: ${r.originalLanguage}`),r.ageRating&&d.push(r.ageRating),r.imdbRating&&d.push(`IMDb ${r.imdbRating.toFixed(1)}`),r.rtTomatoMeter&&d.push(`RT ${r.rtTomatoMeter}%`);const w={library:"Library","external-synced":"Synced","external-only":"External"},y={library:"bg-primary/10 text-primary border-primary/40","external-synced":"bg-emerald-500/10 text-emerald-400 border-emerald-500/30","external-only":"bg-card text-muted-foreground border-border"},g=e.jsxs(e.Fragment,{children:[r.posterUrl?e.jsx("img",{src:r.posterUrl,alt:r.title,className:"h-20 w-14 rounded-2xl object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-20 w-14 items-center justify-center rounded-2xl bg-muted",children:e.jsx(ar,{className:"h-5 w-5 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-[12px] font-medium text-foreground",children:e.jsx(te,{text:r.title,query:n,firstOnly:!0,className:"truncate"})}),e.jsx("span",{className:`shrink-0 rounded-full border px-2 py-0.5 text-xs font-medium ${y[r.source]}`,children:w[r.source]})]}),d.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:d.join(" • ")}),c?e.jsxs("span",{className:"mt-1 inline-flex items-center gap-1 text-[11px] text-muted-foreground",children:[e.jsx(se,{className:"h-3 w-3 animate-spin","aria-hidden":"true"}),"Syncing…"]}):null]})]});return e.jsxs("div",{className:"soft-row-card flex min-h-11 items-center gap-2 row-pad",children:[u?e.jsx("button",{type:"button",className:"flex min-w-0 flex-1 gap-3 text-left",onClick:()=>u(r),disabled:f,"aria-disabled":f,children:g}):e.jsx(xe,{to:`/title/${r.id}`,className:"flex min-w-0 flex-1 gap-3",children:g}),a?e.jsx("div",{className:"shrink-0 pr-1",children:a}):null]})},le=r=>typeof r!="string"?!1:/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(r),Qr=({query:r,filters:n,sortKey:a,onChangeSort:u,onResetFilters:f})=>{const c=r.trim(),d=Cr(n),w=!c&&d,y=c.length>0&&c.length<2&&!w,{data:g,isLoading:i,isError:h,error:o,fetchNextPage:j,hasNextPage:l,isFetching:v,isFetchingNextPage:C}=er({query:c,filters:n}),I=a??Sr(c),N=m.useMemo(()=>(g?.pages??[]).flatMap(b=>rr({items:b.results??[],query:c,sortKey:I})),[g,I,c]),{user:T}=ae(),U=gr(),q=Ar(),Z=Re(),[S,Y]=m.useState({}),L=m.useRef(S);m.useEffect(()=>{L.current=S},[S]);const V=m.useMemo(()=>{const p=[];for(const b of N){const M=S[b.id]??b.id;le(M)&&p.push(M)}return p},[N,S]),B=Vr(V),X=m.useMemo(()=>B.data??new Map,[B.data]),[ne,he]=m.useState(null),[O,Q]=m.useState(null),H=m.useCallback(async p=>{const b=p.id;if(le(b))return b;const M=L.current[b];if(M&&le(M))return M;if(!p.tmdbId)return null;const _=p.type==="series"?"series":"movie";try{const A=await Me("catalog-sync",{tmdbId:p.tmdbId,contentType:_});if(!sr(A))return null;const D=A.media_item_id;if(D&&le(D))return Y(W=>W[b]?W:{...W,[b]:D}),D}catch(A){console.warn("[SearchTitlesTab] catalog-sync failed",A)}return null},[]),pe=m.useCallback(async p=>{if(T){he(p.id);try{const b=await H(p);if(!b)return;const _=X.get(b)?.status==="want_to_watch",A=Xe();if(await hr({sessionId:A,mediaItemId:b,source:"search",eventType:"watchlist",inWatchlist:!_}),_){const{error:D}=await z.from("library_entries").delete().eq("user_id",T.id).eq("title_id",b).eq("status","want_to_watch");if(D)throw D}else await q.updateStatus.mutateAsync({titleId:b,status:"want_to_watch",type:p.type==="series"?"series":"movie",title:p.title,year:p.year,posterUrl:p.posterUrl});U.invalidateQueries({queryKey:["search","titleDiaryBulk",T.id]}),U.invalidateQueries({queryKey:ze.diaryLibrary(T.id)}),U.invalidateQueries({queryKey:ze.titleDiary(T.id,b)})}catch(b){console.warn("[SearchTitlesTab] watchlist toggle failed",b)}finally{he(null)}}},[X,q.updateStatus,H,U,T]),ee=N.length,be=m.useCallback(async p=>{if(!O){Q(p.id);try{const b=await H(p);if(!b)return;Z(`/title/${b}`)}finally{Q(null)}}},[H,Z,O]),$=[];if(n.type&&n.type!=="all"){const p={movie:"Movies",series:"Series"};$.push(p[n.type]??"Titles")}typeof n.minYear=="number"&&$.push(`From ${n.minYear}`),typeof n.maxYear=="number"&&$.push(`Up to ${n.maxYear}`),n.originalLanguage&&$.push(`Language: ${n.originalLanguage==="en"?"English":n.originalLanguage}`),n.genreIds?.length&&$.push(`Genres: ${n.genreIds.length}`);const de=$.length?$.join(" • "):"No filters applied",ce=m.useRef(new Set);return m.useEffect(()=>{if(!N||!Array.isArray(N))return;const p=ce.current,b=N.filter(_=>!(p.has(_.id)||!_.imdbId&&!_.tmdbId||_.imdbRating||_.rtTomatoMeter)).slice(0,3);(async()=>{for(const _ of b){p.add(_.id);try{const{error:A}=await z.from("media_items").upsert({tmdb_id:_.tmdbId??null,omdb_imdb_id:_.imdbId??null,kind:_.type==="series"?"series":_.type??"movie",tmdb_title:_.title,tmdb_release_date:_.year?`${_.year}-01-01`:null},{onConflict:"kind,tmdb_id"}).select("id");A&&console.warn("[SearchTitlesTab] media_items upsert failed for",_.id,A.message)}catch(A){console.warn("[SearchTitlesTab] media_items upsert threw for",_.id,A)}}})()},[N]),y?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["Keep typing to search titles — enter at least"," ",e.jsx("span",{className:"font-semibold text-foreground",children:"2 characters"}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tip: You can also browse without typing by using filters (genres, year, language)."})]}):!c&&!w?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a title, director, or genre to search the catalog. As you wire Supabase search, results will appear here."}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-xs font-medium text-foreground",children:"Try searching for"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-xs",children:["Sci-fi romance","Feel-good comedies","Films from 2020s","Cozy rainy-day movies"].map(p=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-border px-2 py-1 text-muted-foreground",children:[e.jsx(ar,{className:"mr-1 h-3 w-3 text-muted-foreground","aria-hidden":"true"}),p]},p))})]}),e.jsxs("div",{className:"space-y-1.5 rounded-2xl border border-border bg-background/60 p-3",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs font-medium text-foreground",children:[e.jsx(Ve,{className:"h-3.5 w-3.5 text-primary","aria-hidden":"true"}),e.jsx("span",{children:"Trending this week"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Once analytics are wired up, you can show what your friends and the community are watching the most here."})]})]}):i?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:c?e.jsxs(e.Fragment,{children:["Searching for ",e.jsx("span",{className:"font-semibold text-foreground",children:c}),"…"]}):e.jsx(e.Fragment,{children:"Browsing titles…"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Fetching matching titles from your catalog and external sources.":"Fetching titles that match your selected filters."}),e.jsx("div",{className:"space-y-2",children:[0,1,2].map(p=>e.jsxs("div",{className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2",children:[e.jsx("div",{className:"h-16 w-11 animate-pulse rounded-xl bg-card/60"}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center space-y-1.5",children:[e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-card/60"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-card/40"})]})]},p))})]}):h?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-destructive",children:["Something went wrong while ",c?"searching":"browsing"," titles."]}),o&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Details: "}),o.message]})]}):ee?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-semibold text-foreground",children:ee})," result",ee===1?"":"s"," ",c?"across your catalog and external sources for ":"in your catalog for ",c?e.jsx("span",{className:"font-semibold text-foreground",children:c}):e.jsx("span",{className:"font-semibold text-foreground",children:"your filters"}),"."]}),f?e.jsxs(k,{type:"button",variant:"outline",size:"sm",className:"h-auto rounded-full border-border px-2 py-1 text-muted-foreground hover:border-border hover:text-foreground",onClick:f,children:[e.jsx(Ae,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Reset filters"})]}):null]}),v&&!C?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(se,{className:"h-3.5 w-3.5 animate-spin","aria-hidden":"true"}),"Updating results…"]}):null,e.jsx("div",{className:"rounded-2xl border border-border bg-background/60 p-3",children:e.jsxs("p",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground",children:e.jsx(Ae,{className:"h-3 w-3","aria-hidden":"true"})}),e.jsx("span",{className:"truncate",children:de})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Sort"}),[{key:"relevance",label:"Relevance"},{key:"newest",label:"Newest"},{key:"rating",label:"Rating"}].filter(p=>c?!0:p.key!=="relevance").map(p=>{const b=I===p.key;return e.jsx(k,{type:"button",size:"sm",variant:b?"default":"outline",className:"h-8 rounded-full px-3",onClick:()=>u?.(p.key),children:p.label},p.key)})]}),e.jsx(Tr,{style:{height:"calc(100dvh - 340px)"},data:N,overscan:200,increaseViewportBy:{top:200,bottom:700},endReached:()=>{l&&!C&&j()},components:{List:m.forwardRef(function(b,M){return e.jsx("div",{ref:M,className:"space-y-2",...b})}),Footer:()=>l?e.jsx("div",{className:"flex justify-center py-3",children:e.jsx(k,{type:"button",className:"inline-flex items-center justify-center rounded-full bg-primary/90 disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>j(),disabled:C,children:C?"Loading more…":"Load more results"})}):null},itemContent:(p,b)=>{const M=le(b.id)?b.id:S[b.id]??null,_=M?X.get(M):null,A=_?.status==="want_to_watch",D=!!T&&(le(b.id)||!!b.tmdbId),W=ne===b.id,Fe=T?e.jsxs("div",{className:"flex items-center gap-2",children:[typeof _?.rating=="number"?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-border bg-card/50 px-2 py-1 text-[11px] text-muted-foreground",children:[e.jsx(Ve,{className:"h-3 w-3","aria-hidden":"true"}),_.rating]}):null,e.jsx(k,{type:"button",size:"icon",variant:A?"secondary":"outline",className:"rounded-full",onClick:()=>pe(b),disabled:!D||W||q.updateStatus.isPending,title:A?"Remove from watchlist":"Add to watchlist","aria-label":A?"Remove from watchlist":"Add to watchlist",children:W?e.jsx(se,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}):A?e.jsx(qr,{className:"h-4 w-4","aria-hidden":"true"}):e.jsx(Ur,{className:"h-4 w-4","aria-hidden":"true"})})]}):null;return e.jsx(Ue,{item:b,query:c,right:Fe,onSelect:be,disabled:!!O,loading:O===b.id})}})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:c?e.jsxs(e.Fragment,{children:["No titles found matching"," ",e.jsx("span",{className:"font-semibold text-foreground",children:c}),"."]}):e.jsx(e.Fragment,{children:"No titles match these filters."})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Try adjusting your search or removing some filters to see more results.":"Try removing a few filters to broaden the results."})]})},Kr=(r,n)=>{const a=(r??n??"").trim();if(!a)return"?";const u=a.split(/\s+/).filter(Boolean);return u.length===1?u[0].slice(0,2).toUpperCase():(u[0][0]+u[1][0]).toUpperCase()},Hr=({avatarUrl:r,displayName:n,username:a,sizePx:u})=>{const f=Kr(n,a);return r?e.jsx("img",{src:r,alt:n??a??"Profile",className:"shrink-0 rounded-full object-cover",style:{width:u,height:u},loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"flex shrink-0 items-center justify-center rounded-full bg-muted text-xs font-bold text-foreground",style:{width:u,height:u},"aria-label":"Profile initials",children:f})},je=({person:r,variant:n="full",showFollow:a=!0,showMessage:u=!0,showDismiss:f=!1,onDismiss:c,highlightQuery:d,className:w})=>{const y=Re(),{user:g}=ae(),i=Rr(),[h,o]=m.useState(!1),j=r.displayName??r.username??"Unknown",l=r.username?`@${r.username}`:null,v=!!(g?.id&&g.id===r.id),C=r.username?`/u/${r.username}`:`/u/${r.id}`,I=i.isPending&&i.variables?.targetUserId===r.id,N=async()=>{if(!g?.id){alert("You need to be signed in to start a conversation.");return}if(g.id===r.id){alert("You can't start a conversation with yourself.");return}o(!0);try{const S=await Me("create-direct-conversation",{targetUserId:r.id},{timeoutMs:25e3});if(!S?.ok||!S.conversationId){const Y=S?.code;let L=S?.error??"Failed to start a conversation. Please try again.";Y==="UNAUTHORIZED"?L="You need to be signed in to start a conversation.":Y==="BAD_REQUEST_SELF_TARGET"?L="You can't start a conversation with yourself.":Y==="SERVER_MISCONFIGURED"&&(L="Messaging is temporarily unavailable due to a server issue. Please try again later.");const V=new Error(L);throw V.code=Y,V}y(`/messages/${S.conversationId}`)}catch(S){console.error("[PeopleResultRow] Failed to start conversation",S);const Y=S instanceof Error?S.message:"Something went wrong while starting the conversation. Please try again.";alert(Y)}finally{o(!1)}},T=a&&!!g?.id&&!v,U=u&&!!g?.id&&!v,q=f&&!!g?.id&&!!c,Z=()=>!(typeof r.followersCount=="number"||typeof r.followingCount=="number")&&!r.matchPercent?null:e.jsxs("div",{className:"mt-0.5 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[typeof r.matchPercent=="number"?e.jsxs("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] font-medium text-foreground",children:["Match ",r.matchPercent,"%"]}):null,typeof r.followersCount=="number"?e.jsxs("span",{children:[r.followersCount," follower",r.followersCount===1?"":"s"]}):null,typeof r.followersCount=="number"&&typeof r.followingCount=="number"?e.jsx("span",{children:"·"}):null,typeof r.followingCount=="number"?e.jsxs("span",{children:["following ",r.followingCount]}):null]});if(n==="compact"){const S=!!r.bio&&f;return e.jsxs("div",{className:`soft-row-card flex min-h-11 items-center justify-between gap-3 row-pad ${w??""}`,children:[e.jsxs(xe,{to:C,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx(Hr,{avatarUrl:r.avatarUrl,displayName:r.displayName,username:r.username,sizePx:36}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{text:j,query:d,firstOnly:!0,className:"block truncate text-sm font-semibold text-foreground"}),r.isVerified?e.jsx(Qe,{isVerified:r.isVerified??null,type:r.verifiedType??null,label:r.verifiedLabel??null,verifiedAt:r.verifiedAt??null,org:r.verifiedByOrg??null}):null,typeof r.matchPercent=="number"?e.jsxs("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] font-medium text-foreground",children:["Match ",r.matchPercent,"%"]}):null,v?e.jsx("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] text-muted-foreground",children:"You"}):null]}),l?e.jsx(te,{text:l,query:d,firstOnly:!0,className:"block truncate text-xs text-muted-foreground"}):null,S?e.jsx(te,{text:r.bio??"",query:d,firstOnly:!0,className:"mt-0.5 line-clamp-1 text-xs text-muted-foreground",highlightClassName:"rounded bg-primary/15 px-0.5 text-foreground ring-1 ring-primary/15"}):null]})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-2",children:[q?e.jsx(k,{type:"button",variant:"ghost",size:"icon",className:"icon-hit","aria-label":"Dismiss suggestion",onClick:c,children:e.jsx(ge,{className:"h-4 w-4"})}):null,U?e.jsx(k,{type:"button",variant:"outline",size:"sm",className:"h-8 rounded-full border-border bg-card/80 px-3 text-xs",onClick:N,disabled:h,children:e.jsx(Oe,{className:"h-3.5 w-3.5","aria-hidden":"true"})}):null,T?e.jsx(k,{type:"button",onClick:()=>i.mutate({targetUserId:r.id,currentlyFollowing:!!r.isFollowing}),disabled:I,variant:r.isFollowing?"outline":"default",size:"sm",className:`h-8 rounded-full px-3 text-xs font-medium ${r.isFollowing?"border-border bg-card/80 text-foreground hover:border-primary/70":"bg-primary text-primary-foreground hover:bg-primary/90"}`,children:I?e.jsx("span",{children:"…"}):r.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}):null]})]})}return e.jsxs("div",{className:`soft-row-card flex min-h-11 items-center justify-between gap-3 row-pad ${w??""}`,children:[e.jsxs(xe,{to:C,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-card/80 text-[14px] font-semibold text-foreground",children:r.avatarUrl?e.jsx("img",{src:r.avatarUrl,alt:j,className:"h-9 w-9 rounded-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):j?j[0]?.toUpperCase():e.jsx(Mr,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{text:j,query:d,firstOnly:!0,className:"block truncate text-sm font-medium text-foreground"}),r.isVerified?e.jsx(Qe,{isVerified:r.isVerified??null,type:r.verifiedType??null,label:r.verifiedLabel??null,verifiedAt:r.verifiedAt??null,org:r.verifiedByOrg??null}):null,v?e.jsx("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] text-muted-foreground",children:"You"}):null]}),l?e.jsx(te,{text:l,query:d,firstOnly:!0,className:"mt-0.5 block truncate text-xs text-muted-foreground"}):null,r.bio?e.jsx(te,{text:r.bio,query:d,firstOnly:!0,className:"mt-0.5 line-clamp-2 text-xs text-muted-foreground",highlightClassName:"rounded bg-primary/15 px-0.5 text-foreground ring-1 ring-primary/15"}):null,Z()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[q?e.jsx(k,{type:"button",variant:"ghost",size:"icon",className:"icon-hit","aria-label":"Dismiss suggestion",onClick:c,children:e.jsx(ge,{className:"h-4 w-4"})}):null,T?e.jsx(k,{type:"button",onClick:()=>i.mutate({targetUserId:r.id,currentlyFollowing:!!r.isFollowing}),disabled:I,variant:r.isFollowing?"outline":"default",size:"sm",className:`h-auto rounded-full px-2.5 py-1.5 text-xs font-medium ${r.isFollowing?"border-border bg-card/80 text-foreground hover:border-primary/70 disabled:opacity-60":"border border-transparent bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-60"}`,children:I?e.jsx("span",{children:"Updating…"}):r.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}):null,U?e.jsx(k,{type:"button",onClick:N,disabled:h,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-card/80 px-2.5 py-1.5 text-xs font-medium text-foreground shadow-md hover:border-primary/70 hover:text-foreground disabled:cursor-not-allowed disabled:opacity-60",children:h?e.jsx("span",{children:"Starting…"}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Message"})]})}):null]})]})},Wr=({query:r})=>{const n=r.trim(),a=n.replace(/^@+/,""),u=a||n,f=a.length>0&&a.length<2,{data:c,isLoading:d,isFetching:w,isError:y,error:g}=tr(a),i=c??[];if(f)return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["Keep typing to search people — enter at least"," ",e.jsx("span",{className:"font-semibold text-foreground",children:"2 characters"}),"."]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Tip: You can type ",e.jsx("span",{className:"font-semibold text-foreground",children:"@"})," to search usernames."]})]});if(!a)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a name or @username to find people. Once the social graph is wired up, you'll be able to follow friends and start conversations from here."}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-2 text-xs text-muted-foreground",children:[e.jsx(Er,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Search for people you know, then follow or message them."})]})]});if(d)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Searching for people…"}),e.jsx("div",{className:"rounded-2xl border border-border bg-card/80 px-3 py-4 text-xs text-muted-foreground",children:"We'll show matching profiles here as soon as the results come back."})]});if(y)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-foreground",children:"Something went wrong."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g?.message??"We couldn&apos;t search for people right now. Please try again."})]});if(!i||i.length===0)return e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No people found for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",u,"”"]}),". Try a different name or username."]})});const h=i.map(o=>({id:o.id,username:o.username,displayName:o.displayName,avatarUrl:o.avatarUrl,bio:o.bio,followersCount:o.followersCount??null,followingCount:o.followingCount??null,isFollowing:o.isFollowing,matchPercent:o.matchPercent??null,isVerified:o.isVerified??null,verifiedType:o.verifiedType??null,verifiedLabel:o.verifiedLabel??null,verifiedAt:o.verifiedAt??null,verifiedByOrg:o.verifiedByOrg??null}));return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",i.length," profile",i.length===1?"":"s"," for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",u,"”"]})]})}),w?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(se,{className:"h-3.5 w-3.5 animate-spin","aria-hidden":"true"}),"Updating results…"]}):null,e.jsx("div",{className:"space-y-2",children:h.map(o=>e.jsx(je,{person:o,variant:"full",highlightQuery:a},o.id))})]})},nr="movinesta.search.recent",Jr=r=>{if(!r)return[];try{const n=JSON.parse(r);return Array.isArray(n)?n.map(a=>({term:typeof a?.term=="string"?a.term:"",ts:typeof a?.ts=="number"?a.ts:0})).filter(a=>a.term.trim().length>0).slice(0,20):[]}catch{return[]}},Ee=r=>{try{localStorage.setItem(nr,JSON.stringify(r))}catch{}},_e=()=>{if(typeof window>"u")return[];try{return Jr(localStorage.getItem(nr))}catch{return[]}},Zr=(r,n=10)=>{if(typeof window>"u")return;const a=r.trim();if(a.length<2)return;const u=Date.now(),f=_e(),c=[{term:a,ts:u},...f.filter(d=>d.term.toLowerCase()!==a.toLowerCase())].slice(0,n);Ee(c),window.dispatchEvent(new CustomEvent("movinesta:recent-searches"))},Xr=r=>{if(typeof window>"u")return;const n=r.trim(),u=_e().filter(f=>f.term.toLowerCase()!==n.toLowerCase());Ee(u),window.dispatchEvent(new CustomEvent("movinesta:recent-searches"))},et=()=>{typeof window>"u"||(Ee([]),window.dispatchEvent(new CustomEvent("movinesta:recent-searches")))};function ke(r){return typeof r!="number"||!Number.isFinite(r)?null:r.toFixed(1)}function rt(r){const n=(r?.mediaItemId??"").toString(),a=(r?.title??"").toString().trim();if(!n||!a)return null;const u=(r?.posterUrl&&r.posterUrl.trim()?r.posterUrl:null)??(r?.tmdbPosterPath?yr(r.tmdbPosterPath,"w500"):null);return{id:n,title:a,imageUrl:u,ratingLabel:ke(r?.imdbRating??null),subtitle:r?.why?String(r.why):null,friendAvatarUrls:(r?.friendProfiles??[]).map(f=>f?.avatar_url?String(f.avatar_url):null).filter(f=>!!f).slice(0,3),friendExtraCount:Math.max(0,((r?.friendProfiles??[]).length||0)-3)}}function tt(r,n){const a=Ne(r.media_item),u=a.id;if(!u||!a.title)return null;const f=a.posterUrl??a.backdropUrl??null,c=ke(a.imdbRating??null);return{id:u,title:a.title,imageUrl:f,ratingLabel:c,subtitle:null,friendAvatarUrls:n?[n]:[],friendExtraCount:0}}function st(r=10){const{user:n}=ae(),a=n?.id??null,u=async()=>{const f=`
      id,
      kind,
      tmdb_id,
      tmdb_title,
      tmdb_name,
      tmdb_original_title,
      tmdb_original_name,
      tmdb_release_date,
      tmdb_first_air_date,
      tmdb_poster_path,
      tmdb_backdrop_path,
      tmdb_original_language,
      tmdb_genre_ids,
      tmdb_vote_average,
      tmdb_vote_count,
      tmdb_popularity,
      omdb_title,
      omdb_year,
      omdb_language,
      omdb_imdb_id,
      omdb_imdb_rating,
      omdb_rating_rotten_tomatoes,
      omdb_poster,
      omdb_rated
    `,c=g=>{if(!g)return null;const i=String(g).trim();return i||null};try{const{data:g,error:i}=await z.from("media_item_trending_72h").select("media_item_id, trend_score").order("trend_score",{ascending:!1}).limit(Math.max(10,Math.min(r*6,80)));if(!i&&Array.isArray(g)&&g.length){const h=new Map,o=[];for(const j of g){const l=c(j?.media_item_id);if(!l)continue;const v=Number(j?.trend_score??0);if(h.has(l)||o.push(l),h.set(l,Number.isFinite(v)?v:0),o.length>=Math.max(10,Math.min(r*4,40)))break}if(o.length){const{data:j,error:l}=await z.from("media_items").select(f).in("id",o).in("kind",["movie","series"]).limit(o.length);if(!l&&Array.isArray(j)&&j.length){const C=j.map(I=>{const N=Ne(I);return!N?.id||!N?.title?null:{id:N.id,title:N.title,imageUrl:N.posterUrl??N.backdropUrl??null,ratingLabel:ke(N.imdbRating??null),subtitle:null,friendAvatarUrls:[],friendExtraCount:0,_score:h.get(N.id)??0}}).filter(I=>I!==null);return C.sort((I,N)=>N._score-I._score),C.slice(0,Math.max(1,Math.min(r,24))).map(I=>{const{_score:N,...T}=I;return T})}l&&console.warn("[search.discover] trending view -> media_items lookup failed",l)}}i&&console.warn("[search.discover] trending view unavailable",i)}catch(g){console.warn("[search.discover] trending view fallback threw",g)}const{data:d,error:w}=await z.from("media_items").select(f).in("kind",["movie","series"]).order("tmdb_popularity",{ascending:!1,nullsFirst:!1}).order("tmdb_vote_count",{ascending:!1,nullsFirst:!1}).order("tmdb_vote_average",{ascending:!1,nullsFirst:!1}).order("tmdb_release_date",{ascending:!1,nullsFirst:!1}).order("tmdb_first_air_date",{ascending:!1,nullsFirst:!1}).limit(Math.max(1,Math.min(r,24)));return w?(console.warn("[search.discover] popularity fallback trending query failed",w),[]):(Array.isArray(d)?d:[]).map(g=>{const i=Ne(g);return!i?.id||!i?.title?null:{id:i.id,title:i.title,imageUrl:i.posterUrl??i.backdropUrl??null,ratingLabel:ke(i.imdbRating??null),subtitle:null,friendAvatarUrls:[],friendExtraCount:0}}).filter(g=>g!==null)};return Ce({queryKey:["search","discover","trending",a??"anon",r],enabled:!0,staleTime:1e3*60*10,retry:1,retryDelay:750,queryFn:async()=>{try{const f=Xe(),c=pr(f,"trending",null),w=(await br({sessionId:f,mode:"trending",limit:r,seed:c})).cards.map(rt).filter(y=>!!y);if(w.length)return w}catch(f){console.warn("[search.discover] trending deck failed, falling back",f)}return await u()}})}function at(r){const n=(r?.id??"").toString(),a=r?.avatar_url?String(r.avatar_url):null;return{id:n,avatarUrl:a}}function nt(r){if(!r||typeof r!="object")return!1;const n=r;return typeof n.id=="string"&&typeof n.created_at=="string"&&typeof n.user_id=="string"&&typeof n.event_type=="string"}function it(r=8){const{user:n}=ae(),a=n?.id??null;return Ce({queryKey:["search","discover","friends",a,r],enabled:!!a,staleTime:1e3*60*2,queryFn:async()=>{if(!a)return[];const{data:f,error:c}=await z.rpc("get_home_feed_v2",{p_user_id:a,p_limit:200,p_cursor_created_at:null,p_cursor_id:null});if(c)throw new Error(c.message);const w=(Array.isArray(f)?f:[]).filter(nt).filter(i=>i.user_id!==a&&typeof i.media_item_id=="string"&&i.media_item_id),y=new Map;for(const i of w){const h=i.media_item_id??"";if(!h)continue;const o=at(i.actor_profile),j=o.id||i.user_id,l=y.get(h)??{row:i,users:new Map,watched:0,watchlist:0,rated:0};new Date(i.created_at).getTime()>new Date(l.row.created_at).getTime()&&(l.row=i),j&&l.users.set(j,o.avatarUrl??null),i.event_type==="watched"&&(l.watched+=1),i.event_type==="watchlist_added"&&(l.watchlist+=1),i.event_type==="rating_created"&&(l.rated+=1),y.set(h,l)}return Array.from(y.values()).map(i=>{const h=i.users.size,o=tt(i.row,null);if(!o)return null;const j=Array.from(i.users.values()).filter(l=>typeof l=="string"&&l.trim().length>0);return o.friendAvatarUrls=j.slice(0,3),o.friendExtraCount=Math.max(0,h-3),i.watched>0?o.subtitle=`${i.watched} friend${i.watched===1?"":"s"} watched`:i.watchlist>0?o.subtitle=`${i.watchlist} friend${i.watchlist===1?"":"s"} added to watchlist`:i.rated>0?o.subtitle=`${i.rated} friend${i.rated===1?"":"s"} rated`:o.subtitle=`${h} friend${h===1?"":"s"} active`,{poster:o,total:h}}).filter(i=>!!i).sort((i,h)=>h.total-i.total).slice(0,r).map(i=>i.poster)}})}function lt(r=8){const{user:n}=ae(),a=!!n?.id;return Ce({queryKey:["search","discover","curated_lists",r],enabled:a,staleTime:1e3*60*10,queryFn:async()=>{const{data:u,error:f}=await z.from("lists").select("id, name, description, user_id, updated_at").eq("is_public",!0).order("updated_at",{ascending:!1}).limit(r);if(f)throw new Error(f.message);const c=u??[],d=c.map(v=>v.id),w=Array.from(new Set(c.map(v=>v.user_id))),[{data:y,error:g},{data:i,error:h}]=await Promise.all([z.from("profiles_public").select("id, username, display_name, avatar_url").in("id",w),z.from("list_items").select(`list_id, title_id, position,
               media_items: title_id (
                 id,
                 omdb_poster,
                 tmdb_poster_path,
                 tmdb_backdrop_path,
                 tmdb_title,
                 tmdb_name,
                 tmdb_release_date,
                 tmdb_first_air_date,
                 tmdb_original_language,
                 kind,
                 omdb_imdb_rating,
                 omdb_rating_rotten_tomatoes
               )`).in("list_id",d).order("position",{ascending:!0}).limit(r*6)]);if(g)throw new Error(g.message);if(h)throw new Error(h.message);const o=new Map;for(const v of y??[])o.set(v.id,v);const j=new Map;for(const v of i??[]){const C=v.list_id;!C||j.has(C)||j.set(C,v)}return c.map(v=>{const C=o.get(v.user_id)??null,I=(C?.display_name?.toString().trim()||C?.username?.toString().trim())??"Someone",T=j.get(v.id)?.media_items??null,U=T?Ne(T):null,q=U?.posterUrl??U?.backdropUrl??null;return{id:v.id,name:v.name,description:v.description,owner:{id:v.user_id,displayName:I,avatarUrl:C?.avatar_url?String(C.avatar_url):null},coverUrl:q}})}})}function ot(){return Te.useMemo(()=>[{key:"action",label:"Action",tmdbGenreId:28},{key:"drama",label:"Drama",tmdbGenreId:18},{key:"horror",label:"Horror",tmdbGenreId:27},{key:"sci-fi",label:"Sci‑Fi",tmdbGenreId:878},{key:"comedy",label:"Comedy",tmdbGenreId:35},{key:"documentary",label:"Docu",tmdbGenreId:99}],[])}const We=r=>typeof r!="string"?!1:/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/.test(r),we=({label:r,active:n,onClick:a})=>e.jsx("button",{type:"button",onClick:a,className:`flex h-9 shrink-0 items-center justify-center rounded-full px-5 text-sm font-semibold transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background active:scale-95 ${n?"bg-primary text-primary-foreground shadow-sm":"bg-muted/60 text-foreground hover:bg-muted"}`,children:r}),fe=({label:r,onClick:n,onClear:a})=>e.jsxs("div",{className:"inline-flex max-w-full items-center gap-1 rounded-full border border-border/70 bg-card/80 pl-3 pr-1 py-1 text-xs font-semibold text-foreground shadow-sm",children:[e.jsx("button",{type:"button",onClick:n,className:"max-w-[220px] truncate text-left text-xs font-semibold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",title:r,children:r}),a?e.jsx("button",{type:"button",onClick:a,className:"inline-flex h-6 w-6 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/60 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background","aria-label":`Clear ${r}`,children:e.jsx(ge,{className:"h-3.5 w-3.5"})}):null]}),re=({title:r,actionLabel:n,onAction:a})=>e.jsxs("div",{className:"flex items-center justify-between gap-3 pb-[var(--section-gap)]",children:[e.jsx("h2",{className:"text-lg font-semibold leading-tight tracking-tight text-foreground sm:text-xl",children:r}),n&&a?e.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full border border-transparent px-3 py-1 text-sm font-semibold text-primary transition-colors hover:bg-primary/10 hover:text-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:n}):null]}),oe=({children:r})=>e.jsx("section",{className:"rounded-2xl border border-border/60 bg-card/40 card-pad shadow-sm",children:r}),dt=({label:r})=>r?e.jsxs("div",{className:"absolute right-2 top-2 inline-flex items-center gap-1 rounded-full bg-black/60 px-2 py-0.5 text-xs font-bold text-white backdrop-blur-sm",children:[e.jsx(Se,{name:"star",filled:!0,className:"text-[14px] text-yellow-400",ariaLabel:"Rating"}),e.jsx("span",{children:r})]}):null,Je=({id:r,title:n,imageUrl:a,ratingLabel:u,subtitle:f,friendAvatarUrls:c,friendExtraCount:d})=>{const w=(c??[]).map((y,g)=>({id:`${r}_${g}`,username:null,display_name:null,avatar_url:y}));if(d&&d>0)for(let y=0;y<d;y+=1)w.push({id:`${r}_placeholder_${y}`,username:null,display_name:null,avatar_url:null});return e.jsxs(xe,{to:`/title/${r}`,className:"group flex flex-col gap-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[e.jsxs("div",{className:"relative aspect-[2/3] w-full overflow-hidden rounded-[20px] bg-muted shadow-sm ring-1 ring-border/50 transition-transform duration-300 group-hover:scale-[1.02] group-hover:shadow-lg",style:a?{backgroundImage:`url(${a})`,backgroundSize:"cover",backgroundPosition:"center"}:void 0,children:[a?null:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/25 via-background/10 to-primary/40"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/45 via-transparent to-transparent"}),e.jsx(dt,{label:u}),w.length?e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx(Br,{profiles:w,max:3,size:32})}):null]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-base font-medium leading-tight",children:n}),f?e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs font-semibold text-muted-foreground",children:[e.jsx(Se,{name:"group_add",className:"text-[14px]",ariaLabel:"Activity"}),e.jsx("span",{className:"truncate",children:f})]}):null]})]})},ct=({id:r,name:n,description:a,coverUrl:u,ownerLabel:f,ownerAvatarUrl:c})=>e.jsxs(xe,{to:`/lists/${r}`,className:"flex items-center gap-3 rounded-3xl border border-border/70 bg-card/80 p-3 shadow-sm transition-all hover:bg-card hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:[e.jsx("div",{className:"h-16 w-14 overflow-hidden rounded-2xl bg-muted",children:u?e.jsx("img",{src:u,alt:n,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-br from-primary/25 via-muted to-primary/30"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:n}),e.jsx("p",{className:"mt-0.5 line-clamp-1 text-xs text-muted-foreground",children:a||"Curated collection"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 overflow-hidden rounded-full bg-muted",children:c?e.jsx("img",{src:c,alt:f,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"h-full w-full bg-primary/20"})}),e.jsx("p",{className:"truncate text-xs font-medium text-muted-foreground",children:f})]})]}),e.jsx(Se,{name:"chevron_right",className:"text-[22px] text-muted-foreground",ariaLabel:"Open"})]});function ut(r,n){return r==="people"?"people":r==="titles"?n.type==="series"?"series":"movies":"all"}function mt(r){return r==="people"?{tab:"people"}:r==="movies"?{tab:"titles",nextFilters:{type:"movie"}}:r==="series"?{tab:"titles",nextFilters:{type:"series"}}:{tab:"all"}}const Tt=()=>{const r=Re(),{user:n}=ae(),a=$r(),u=m.useRef(""),f=m.useCallback(t=>{const s=t.trim();s.length<2||s!==u.current&&(u.current=s,Zr(s))},[]),[c,d]=vr(),w=(c.get("q")??"").toString(),[y,g]=m.useState(w),i=m.useRef(null);m.useEffect(()=>{g(w)},[w]);const h=Fr(y,250),o=h.trim(),j=Lr(c),l=Ir(c),v=Pr(c,o),C=!!c.get("sort"),I=v==="relevance"?"Relevance":v==="newest"?"Newest":"Rating",[N,T]=m.useState(()=>typeof window>"u"?[]:_e()),[U,q]=m.useState(null);m.useEffect(()=>{if(typeof window>"u")return;const t=()=>T(_e());return t(),window.addEventListener("movinesta:recent-searches",t),window.addEventListener("storage",t),()=>{window.removeEventListener("movinesta:recent-searches",t),window.removeEventListener("storage",t)}},[]);const Z=m.useCallback(async t=>{if(We(t.id))return t.id;if(!t.tmdbId)return null;const s=t.type==="series"?"series":"movie";try{const x=await Me("catalog-sync",{tmdbId:t.tmdbId,contentType:s});return sr(x)&&We(x.media_item_id)?x.media_item_id:null}catch(x){return console.warn("[SearchPage] catalog-sync failed",x),null}},[]),S=m.useCallback(async t=>{if(!U){q(t.id);try{const s=await Z(t);if(!s)return;r(`/title/${s}`)}finally{q(null)}}},[Z,r,U]),Y=!!(typeof l.minYear=="number"||typeof l.maxYear=="number"||l.originalLanguage||l.genreIds?.length),L=j,V=ut(L,l);m.useEffect(()=>{L==="titles"&&(l.type==="movie"||l.type==="series"||d(t=>{const s=new URLSearchParams(t);return s.set("type","movie"),s},{replace:!0}))},[L,l.type,d]),m.useEffect(()=>{h!==w&&d(t=>{const s=new URLSearchParams(t);return h.trim()?s.set("q",h):s.delete("q"),s},{replace:!0})},[h,w,d]);const B=m.useCallback(t=>{const{tab:s,nextFilters:x}=mt(t);d(F=>{const P=new URLSearchParams(F);return P.set("tab",s),s==="people"||s==="all"?(P.delete("minYear"),P.delete("maxYear"),P.delete("lang"),P.delete("genre"),P.delete("genres"),s==="people"?(P.delete("type"),P.delete("sort")):P.set("type","all")):x?.type&&P.set("type",x.type),P},{replace:!1})},[d]),X=m.useCallback(t=>{d(s=>{const x=new URLSearchParams(s);return x.set("sort",t),x},{replace:!1})},[d]),ne=m.useCallback(()=>{g(""),d(t=>{const s=new URLSearchParams(t);return s.delete("q"),s},{replace:!0})},[d]),he=m.useCallback(t=>{const s=t.trim();s&&(g(s),d(x=>{const F=new URLSearchParams(x);return F.set("q",s),F.get("tab")||F.set("tab","all"),F},{replace:!1}))},[d]),[O,Q]=m.useState(!1),[H,pe]=m.useState(typeof l.minYear=="number"?String(l.minYear):""),[ee,be]=m.useState(typeof l.maxYear=="number"?String(l.maxYear):""),[$,de]=m.useState(l.originalLanguage??""),[ce,p]=m.useState(l.genreIds??[]),b=(l.genreIds??[]).join(",");m.useEffect(()=>{O&&(pe(typeof l.minYear=="number"?String(l.minYear):""),be(typeof l.maxYear=="number"?String(l.maxYear):""),de(l.originalLanguage??""),p(l.genreIds??[]))},[O,l.minYear,l.maxYear,l.originalLanguage,b]);const M=m.useCallback(()=>{const t=J=>{const R=Number(J);return Number.isFinite(R)?Math.floor(R):void 0};let s=Ge(t(H)),x=Ge(t(ee));if(s&&x&&s>x){const J=s;s=x,x=J}const F=$.trim()?$.trim().toLowerCase():void 0,P=(ce??[]).filter(J=>Number.isFinite(J)&&J>0);d(J=>{const R=new URLSearchParams(J);R.set("tab","titles");const De=R.get("type");return De!=="movie"&&De!=="series"&&R.set("type","movie"),typeof s=="number"?R.set("minYear",String(s)):R.delete("minYear"),typeof x=="number"?R.set("maxYear",String(x)):R.delete("maxYear"),F?R.set("lang",F):R.delete("lang"),R.delete("genre"),R.delete("genres"),P.length&&R.set("genres",P.join(",")),R},{replace:!1}),Q(!1)},[ce,$,ee,H,d]),_=m.useCallback(()=>{d(t=>{const s=new URLSearchParams(t);s.set("tab","titles");const x=s.get("type");return x!=="movie"&&x!=="series"&&s.set("type","movie"),s.delete("minYear"),s.delete("maxYear"),s.delete("lang"),s.delete("genre"),s.delete("genres"),s},{replace:!1}),Q(!1)},[d]),A=m.useCallback(()=>{d(t=>{const s=new URLSearchParams(t);return s.delete("minYear"),s.delete("maxYear"),s.delete("lang"),s.delete("genre"),s.delete("genres"),s},{replace:!1})},[d]),D=m.useCallback(()=>{d(t=>{const s=new URLSearchParams(t);return s.delete("sort"),s},{replace:!1})},[d]),W=m.useCallback(()=>{d(t=>{const s=new URLSearchParams(t);return s.delete("minYear"),s.delete("maxYear"),s},{replace:!1})},[d]),Fe=m.useCallback(()=>{d(t=>{const s=new URLSearchParams(t);return s.delete("lang"),s},{replace:!1})},[d]),ir=m.useCallback(()=>{d(t=>{const s=new URLSearchParams(t);return s.delete("genre"),s.delete("genres"),s},{replace:!1})},[d]),lr=m.useCallback(()=>{const t=o.length>0?["relevance","newest","rating"]:["newest","rating"],s=t.indexOf(v),x=s>=0?t[(s+1)%t.length]:t[0];X(x)},[X,v,o]),ie=m.useCallback(()=>{L!=="people"&&(L==="all"&&d(t=>{const s=new URLSearchParams(t);return s.set("tab","titles"),s},{replace:!1}),Q(!0))},[L,d]);m.useEffect(()=>{if(typeof window>"u")return;const t=x=>{const F=x;if(!F)return!1;const P=F.tagName?.toLowerCase?.();return P==="input"||P==="textarea"||P==="select"?!0:!!F.isContentEditable},s=x=>{if(!x.defaultPrevented){if(x.key==="/"&&!t(x.target)){x.preventDefault(),i.current?.focus();return}if(x.key==="Escape"&&!t(x.target)){if(O){x.preventDefault(),Q(!1);return}x.preventDefault(),ne()}}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[ne,O]);const ye=ot(),or=m.useMemo(()=>{const t=new Map;for(const s of ye)t.set(s.tmdbGenreId,s.label);return t},[ye]),K=st(10),Le=it(8),Ie=lt(6),Be=L==="all",dr=L==="all",E=er({query:Be?o:"",filters:Be?l:void 0}),G=tr(dr?o.replace(/^@+/,""):""),ve=m.useMemo(()=>{const t=E.data?.pages??[];return t.flatMap(F=>F.results??[]).length?t.flatMap(F=>rr({items:F.results??[],query:o,sortKey:v})):[]},[v,E.data,o]),ue=m.useMemo(()=>ve.filter(t=>t.type==="movie"),[ve]),me=m.useMemo(()=>ve.filter(t=>t.type==="series"),[ve]),cr=o.length===0&&L==="all",ur=m.useCallback(()=>{r("/swipe?mode=trending")},[r]),mr=m.useCallback(()=>{r("/activity")},[r]),$e=typeof l.minYear=="number"||typeof l.maxYear=="number"?`Year: ${typeof l.minYear=="number"&&typeof l.maxYear=="number"?`${l.minYear}-${l.maxYear}`:typeof l.minYear=="number"?`≥${l.minYear}`:`≤${l.maxYear}`}`:null,Ye=l.originalLanguage?`Lang: ${l.originalLanguage.toUpperCase()}`:null,qe=(l.genreIds?.length??0)>0?(()=>{const t=l.genreIds??[],s=t.map(P=>or.get(P)).filter(Boolean);if(!s.length)return`Genres: ${t.length}`;const x=s[0],F=s.length-1;return F>0?`Genres: ${x} +${F}`:`Genres: ${x}`})():null,fr=L==="titles"&&(Y||C);return e.jsxs("div",{className:"relative flex min-h-screen w-full flex-col overflow-x-hidden bg-background pb-2 text-foreground",children:[e.jsx("div",{className:"h-12 w-full"}),e.jsx(wr,{open:O,onOpenChange:Q,children:e.jsxs(jr,{className:"max-w-lg",children:[e.jsx(Nr,{children:e.jsx(_r,{children:"Filters"})}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Year range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(Pe,{value:H,onChange:t=>pe(t.target.value.replace(/[^0-9]/g,"").slice(0,4)),placeholder:"From",inputMode:"numeric"}),e.jsx(Pe,{value:ee,onChange:t=>be(t.target.value.replace(/[^0-9]/g,"").slice(0,4)),placeholder:"To",inputMode:"numeric"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Language"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[["en","ar","ja","ko"].map(t=>{const s=$.toLowerCase()===t;return e.jsx(k,{type:"button",size:"sm",variant:s?"default":"outline",className:"rounded-full",onClick:()=>de(t),children:t.toUpperCase()},t)}),e.jsx(Pe,{value:$,onChange:t=>de(t.target.value.replace(/\s/g,"").slice(0,8)),placeholder:"e.g. fr",className:"h-9 w-28"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use ISO-639-1 codes (en, ar...)."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Genres"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ye.map(t=>{const s=ce.includes(t.tmdbGenreId);return e.jsx(k,{type:"button",size:"sm",variant:s?"default":"outline",className:"rounded-full",onClick:()=>p(x=>x.includes(t.tmdbGenreId)?x.filter(F=>F!==t.tmdbGenreId):[...x,t.tmdbGenreId]),children:t.label},t.tmdbGenreId)})})]})]}),e.jsxs(kr,{className:"flex-col gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:_,className:"rounded-full",children:"Reset"}),e.jsxs("div",{className:"flex w-full justify-end gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>Q(!1),className:"rounded-full",children:"Cancel"}),e.jsx(k,{type:"button",onClick:M,className:"rounded-full",children:"Apply"})]})]})]})}),e.jsx("div",{className:"sticky top-0 z-30 full-bleed border-b border-border/60 bg-background/95 backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto flex w-full max-w-5xl flex-col gap-[var(--section-gap)] px-[var(--page-pad-x)] py-[var(--page-pad-y)] sm:px-[var(--page-pad-x)] sm:py-[var(--page-pad-y)]",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Discover"}),e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-foreground sm:text-3xl",children:"Search"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Find movies, series, and people with tailored recommendations."})]}),e.jsxs("div",{className:"hidden items-center gap-2 rounded-full border border-border/60 bg-card/70 px-3 py-1 text-xs font-medium text-muted-foreground sm:inline-flex",children:[e.jsx("span",{children:"Shortcut"}),e.jsx("span",{className:"rounded-full border border-border/70 bg-background px-2 py-0.5 font-mono text-[11px] text-foreground",children:"/"}),e.jsx("span",{children:"to search"})]})]}),e.jsxs("label",{className:"flex h-11 w-full items-center gap-3 rounded-2xl border border-border/70 bg-card/80 px-3 shadow-sm transition focus-within:border-primary/60 focus-within:ring-2 focus-within:ring-primary/30",children:[e.jsx(Se,{name:"search",className:"text-[20px] text-muted-foreground",ariaLabel:"Search"}),e.jsx("input",{ref:i,value:y,onChange:t=>g(t.target.value),onKeyDown:t=>{if(t.key==="Escape"){t.preventDefault(),ne(),t.currentTarget.blur();return}t.key==="Enter"&&(f(y),t.currentTarget.blur())},onBlur:()=>f(y),placeholder:"Search movies, shows, people...",className:"h-full flex-1 bg-transparent text-base text-foreground outline-none placeholder:text-muted-foreground",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1}),y?e.jsx("button",{type:"button",onClick:ne,className:"inline-flex h-11 w-11 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background","aria-label":"Clear search",children:e.jsx(ge,{className:"h-4 w-4"})}):null,e.jsx("button",{type:"button",onClick:ie,disabled:L==="people",className:"inline-flex h-11 w-11 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:opacity-40","aria-label":"Filters",children:e.jsxs("span",{className:"relative inline-flex",children:[e.jsx(Ae,{className:"h-4 w-4"}),Y?e.jsx("span",{className:"absolute -right-1 -top-1 h-2 w-2 rounded-full bg-primary","aria-hidden":"true"}):null]})})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:[e.jsx(we,{label:"All",active:V==="all",onClick:()=>B("all")}),e.jsx(we,{label:"Movies",active:V==="movies",onClick:()=>B("movies")}),e.jsx(we,{label:"Series",active:V==="series",onClick:()=>B("series")}),e.jsx(we,{label:"People",active:V==="people",onClick:()=>B("people")})]}),fr?e.jsxs("div",{className:"flex flex-wrap items-center gap-2 pb-1",children:[C?e.jsx(fe,{label:`Sort: ${I}`,onClick:lr,onClear:D}):null,$e?e.jsx(fe,{label:$e,onClick:ie,onClear:W}):null,Ye?e.jsx(fe,{label:Ye,onClick:ie,onClear:Fe}):null,qe?e.jsx(fe,{label:qe,onClick:ie,onClear:ir}):null,Y?e.jsx(fe,{label:"Clear all",onClick:A}):null]}):null]})}),cr?e.jsxs("div",{className:"mx-auto flex w-full max-w-5xl flex-col gap-[var(--section-gap)] px-[var(--page-pad-x)] pb-6 pt-[var(--page-pad-y)] sm:px-[var(--page-pad-x)]",children:[N.length?e.jsxs(oe,{children:[e.jsx(re,{title:"Recent searches",actionLabel:"Clear",onAction:et}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(t=>e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-border/70 bg-background/70 pl-3 pr-1 py-1 text-sm shadow-sm",children:[e.jsx("button",{type:"button",onClick:()=>he(t.term),className:"max-w-[220px] truncate text-sm font-semibold text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",title:t.term,children:t.term}),e.jsx("button",{type:"button",onClick:()=>Xr(t.term),className:"inline-flex h-7 w-7 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/60 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background","aria-label":`Remove ${t.term}`,children:e.jsx(ge,{className:"h-4 w-4"})})]},t.term))})]}):null,e.jsxs(oe,{children:[e.jsx(re,{title:"Suggested People",actionLabel:"See All",onAction:()=>r("/suggested-people")}),a.isLoading?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):a.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:"Couldn't load suggestions right now."}):(a.data??[]).length?e.jsx("div",{className:"space-y-3",children:(a.data??[]).slice(0,5).map(t=>{const s={id:t.id,username:t.username,displayName:t.displayName,avatarUrl:t.avatarUrl,bio:t.bio,followersCount:t.followersCount,followingCount:t.followingCount,isFollowing:t.isFollowing,matchPercent:t.matchPercent??null,isVerified:t.isVerified??null,verifiedType:t.verifiedType??null,verifiedLabel:t.verifiedLabel??null,verifiedAt:t.verifiedAt??null,verifiedByOrg:t.verifiedByOrg??null};return e.jsx(je,{person:s,variant:"compact",showMessage:!1,showDismiss:!0,onDismiss:()=>a.dismissPerson(t.id)},t.id)})}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:n?.id?"No suggestions right now.":"Sign in to get personalized people suggestions."})]}),e.jsxs(oe,{children:[e.jsx(re,{title:"Friends Are Watching",actionLabel:"See All",onAction:mr}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Le.isLoading?Array.from({length:4}).map((t,s)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"aspect-[2/3] w-full animate-pulse rounded-[20px] bg-muted"}),e.jsx("div",{className:"h-4 w-3/4 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-muted"})]},s)):Le.data?.length?Le.data.map(t=>e.jsx(Je,{...t},t.id)):e.jsx("div",{className:"col-span-2 rounded-3xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:n?.id?"Your friends’ activity will show up here once they start rating, watching, or adding to watchlists.":"Sign in to see what your friends are watching."})})]}),e.jsxs(oe,{children:[e.jsx(re,{title:"Trending Now",actionLabel:"See All",onAction:ur}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1 [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:K.isLoading?Array.from({length:6}).map((t,s)=>e.jsxs("div",{className:"w-36 shrink-0",children:[e.jsx("div",{className:"aspect-[2/3] w-full animate-pulse rounded-[20px] bg-muted"}),e.jsx("div",{className:"mt-2 h-4 w-3/4 animate-pulse rounded bg-muted"})]},s)):K.isError?e.jsx("div",{className:"w-full shrink-0 rounded-3xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Trending is temporarily unavailable."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:K.error?.message??"Please try again."})]}),e.jsx(k,{type:"button",variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>K.refetch(),disabled:K.isFetching,children:"Retry"})]})}):K.data?.length?K.data.map(t=>e.jsx("div",{className:"w-36 shrink-0",children:e.jsx(Je,{...t,friendAvatarUrls:[],friendExtraCount:0})},t.id)):e.jsx("div",{className:"w-full shrink-0 rounded-3xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.id?"No trending titles right now.":"No trending titles right now. (Sign in to personalize your feed.)"}),e.jsx(k,{type:"button",variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>K.refetch(),disabled:K.isFetching,children:"Refresh"})]})})})]}),e.jsxs(oe,{children:[e.jsx(re,{title:"Curated by Experts & Friends"}),e.jsx("div",{className:"flex flex-col gap-3",children:Ie.isLoading?Array.from({length:3}).map((t,s)=>e.jsx("div",{className:"h-20 animate-pulse rounded-3xl bg-muted"},s)):Ie.data?.length?Ie.data.map(t=>e.jsx(ct,{id:t.id,name:t.name,description:t.description,coverUrl:t.coverUrl,ownerLabel:`by ${t.owner.displayName}`,ownerAvatarUrl:t.owner.avatarUrl},t.id)):e.jsx("div",{className:"rounded-3xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:"Public lists will appear here once you or your friends publish them."})})]}),e.jsxs(oe,{children:[e.jsx(re,{title:"Browse by Category"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3",children:ye.map(t=>e.jsx("button",{type:"button",onClick:()=>{d(s=>{const x=new URLSearchParams(s);return x.set("tab","titles"),x.delete("genre"),x.delete("genres"),x.set("genres",String(t.tmdbGenreId)),x},{replace:!1})},className:"flex h-20 items-center justify-center rounded-3xl border border-border/70 bg-card/80 text-sm font-semibold text-foreground shadow-sm transition-all hover:bg-card hover:shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:t.label},t.key))})]})]}):e.jsx("div",{className:"mx-auto w-full max-w-5xl px-[var(--page-pad-x)] pb-6 pt-[var(--page-pad-y)] sm:px-[var(--page-pad-x)]",children:L==="people"?o.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:"Type a name or @username to search, or browse suggested people below."}),e.jsxs("div",{children:[e.jsx(re,{title:"Suggested People",actionLabel:"See All",onAction:()=>r("/suggested-people")}),a.isLoading?e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((t,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):a.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:"Couldn't load suggestions right now."}):(a.data??[]).length?e.jsx("div",{className:"space-y-3",children:(a.data??[]).slice(0,8).map(t=>{const s={id:t.id,username:t.username,displayName:t.displayName,avatarUrl:t.avatarUrl,bio:t.bio,followersCount:t.followersCount,followingCount:t.followingCount,isFollowing:t.isFollowing,matchPercent:t.matchPercent??null,isVerified:t.isVerified??null,verifiedType:t.verifiedType??null,verifiedLabel:t.verifiedLabel??null,verifiedAt:t.verifiedAt??null,verifiedByOrg:t.verifiedByOrg??null};return e.jsx(je,{person:s,variant:"compact",showMessage:!1,showDismiss:!0,onDismiss:()=>a.dismissPerson(t.id)},t.id)})}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:n?.id?"No suggestions right now.":"Sign in to get personalized people suggestions."})]})]}):e.jsx(Wr,{query:o}):L==="all"?o.length>0&&o.length<2?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:["Keep typing to search — enter at least"," ",e.jsx("span",{className:"font-semibold text-foreground",children:"2 characters"}),"."]}),e.jsx("div",{className:"rounded-2xl border border-border bg-background/60 card-pad text-xs text-muted-foreground",children:"Tip: Use the filters button to browse without typing (genres, year, language)."})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Movies",ue.length?` (${ue.length})`:""]}),E.isFetching&&!E.isLoading?e.jsx(se,{className:"h-4 w-4 animate-spin text-muted-foreground","aria-hidden":"true"}):null]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>B("movies"),className:"h-8 rounded-full",children:"See all"})]}),E.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:4}).map((t,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):E.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Couldn't load movies"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:E.error?.message??"Please try again."})]}),e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>E.refetch(),children:"Retry"})]})}):ue.length?e.jsxs("div",{className:"space-y-2",children:[ue.slice(0,6).map(t=>e.jsx(Ue,{item:t,query:o,onSelect:S,disabled:!!U,loading:U===t.id},t.id)),ue.length>6?e.jsx(k,{variant:"secondary",className:"w-full rounded-2xl",onClick:()=>B("movies"),children:"View more movies"}):null]}):e.jsxs("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-foreground",children:"No matching movies."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Try a different spelling, or use filters to browse by genre, year, or language."}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:ie,children:"Open filters"}),o.startsWith("@")?e.jsx(k,{variant:"outline",size:"sm",className:"h-8 rounded-full",onClick:()=>B("people"),children:"Search people"}):null]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["Series",me.length?` (${me.length})`:""]}),E.isFetching&&!E.isLoading?e.jsx(se,{className:"h-4 w-4 animate-spin text-muted-foreground","aria-hidden":"true"}):null]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>B("series"),className:"h-8 rounded-full",children:"See all"})]}),E.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:4}).map((t,s)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},s))}):E.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Couldn't load series"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:E.error?.message??"Please try again."})]}),e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>E.refetch(),children:"Retry"})]})}):me.length?e.jsxs("div",{className:"space-y-2",children:[me.slice(0,6).map(t=>e.jsx(Ue,{item:t,query:o,onSelect:S,disabled:!!U,loading:U===t.id},t.id)),me.length>6?e.jsx(k,{variant:"secondary",className:"w-full rounded-2xl",onClick:()=>B("series"),children:"View more series"}):null]}):e.jsxs("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-foreground",children:"No matching series."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Try a different spelling, or use filters to browse by genre, year, or language."}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:ie,children:"Open filters"})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:["People",G.data?.length?` (${G.data.length})`:""]}),G.isFetching&&!G.isLoading?e.jsx(se,{className:"h-4 w-4 animate-spin text-muted-foreground","aria-hidden":"true"}):null]}),e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>B("people"),className:"h-8 rounded-full",children:"See all"})]}),G.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:4}).map((t,s)=>e.jsx("div",{className:"h-14 animate-pulse rounded-2xl bg-muted"},s))}):G.isError?e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Couldn't load people"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:G.error?.message??"Please try again."})]}),e.jsx(k,{variant:"secondary",size:"sm",className:"h-8 rounded-full",onClick:()=>G.refetch(),children:"Retry"})]})}):G.data?.length?e.jsx("div",{className:"space-y-2",children:G.data.slice(0,6).map(t=>{const s={id:t.id,username:t.username,displayName:t.displayName,avatarUrl:t.avatarUrl,bio:t.bio,followersCount:t.followersCount??null,followingCount:t.followingCount??null,isFollowing:t.isFollowing,matchPercent:t.matchPercent??null,isVerified:t.isVerified??null,verifiedType:t.verifiedType??null,verifiedLabel:t.verifiedLabel??null,verifiedAt:t.verifiedAt??null,verifiedByOrg:t.verifiedByOrg??null};return e.jsx(je,{person:s,variant:"compact",showFollow:!0,showMessage:!0,highlightQuery:o.replace(/^@+/,"")},t.id)})}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 card-pad text-sm text-muted-foreground",children:"No matching people."})]})]}):e.jsx(Qr,{query:o,filters:l,sortKey:v,onChangeSort:X,onResetFilters:_})})]})};export{Tt as default};
