import{r as u,j as e,g as C,n as L,o as R,s as j}from"./index-DLcJPtaT.js";import{P as S}from"./PageChrome-DNNm9VG4.js";import{T as A}from"./TopBar-fWfwmUrG.js";import{a as T}from"./useProfile-bn-BZtjC.js";import{L as U}from"./loader-circle-MYGw9Oqr.js";import{U as q}from"./user-DNjHOuM-.js";import{C as D}from"./circle-alert-D3BN2XF-.js";import{C as Y}from"./circle-check-72lKqrQ8.js";import"./brand-DTIDtbc4.js";const $=({label:i="Avatar",description:t,initialUrl:x=null,disabled:b=!1,onFileChange:r,fallbackIcon:y,className:l})=>{const[o,s]=u.useState(x),p=u.useRef(null),d=u.useRef(null);u.useEffect(()=>{s(x)},[x]),u.useEffect(()=>()=>{d.current&&URL.revokeObjectURL(d.current)},[]);const h=()=>{var n;b||(n=p.current)==null||n.click()},a=n=>{var g;const m=((g=n.target.files)==null?void 0:g[0])??null;if(!m){r==null||r(null);return}d.current&&(URL.revokeObjectURL(d.current),d.current=null);const f=URL.createObjectURL(m);d.current=f,s(f),r==null||r(m)},c="pt-1"+(l?` ${l}`:"");return e.jsxs("div",{className:c,children:[i&&e.jsx("p",{className:"text-[11px] font-medium text-mn-text-secondary",children:i}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:h,disabled:b,className:"relative inline-flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border border-dashed border-mn-border bg-mn-bg-elevated/80 text-xs font-medium text-mn-text-secondary hover:border-mn-primary hover:bg-mn-primary/5 focus:outline-none focus:ring-2 focus:ring-mn-primary/40 disabled:cursor-not-allowed disabled:opacity-60","aria-label":"Upload avatar",children:o?e.jsx("img",{src:o,alt:"Avatar preview",className:"h-full w-full object-cover"}):e.jsx("span",{className:"select-none text-lg",children:y??"ðŸ“½ï¸"})}),t&&e.jsx("div",{className:"text-[11px] text-left text-mn-text-muted",children:t})]}),e.jsx("input",{ref:p,type:"file",accept:"image/*",className:"hidden",onChange:a})]})},H=()=>{var h;const{user:i}=C(),{data:t,isLoading:x,isError:b,error:r}=T(),y=L(),[l,o]=u.useState({displayName:"",bio:"",avatarFile:null});u.useEffect(()=>{t&&o({displayName:t.displayName??"",bio:t.bio??"",avatarFile:null})},[t]);const s=R({mutationFn:async({displayName:a,bio:c,avatarFile:n})=>{if(!i)throw new Error("You need to be signed in to update your profile.");let m=(t==null?void 0:t.avatarUrl)??null;if(n){const g=n.name.split(".").pop(),N=`${i.id}/${Date.now()}.${g??"jpg"}`,{error:w,data:v}=await j.storage.from("avatars").upload(N,n,{cacheControl:"3600",upsert:!0});if(w)throw w;const E=(v==null?void 0:v.path)??N,{data:k,error:P}=j.storage.from("avatars").getPublicUrl(E);if(P)throw P;m=k.publicUrl??m}const{error:f}=await j.from("profiles").update({display_name:a.trim()||null,bio:c.trim()||null,avatar_url:m}).eq("id",i.id);if(f)throw f},onSuccess:()=>{y.invalidateQueries({queryKey:["profile"]}),o(a=>({...a,avatarFile:null}))}}),p=a=>c=>{o(n=>({...n,[a]:c.target.value}))},d=async a=>{a.preventDefault(),!(!i||!t||s.isPending)&&await s.mutateAsync({displayName:l.displayName,bio:l.bio,avatarFile:l.avatarFile})};return i?x?e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center px-4",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-mn-card border border-mn-border-subtle/80 bg-mn-bg-elevated/80 px-4 py-3 text-sm text-mn-text-secondary shadow-mn-card",children:[e.jsx(U,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Loading your profileâ€¦"})]})}):b||!t?e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md rounded-mn-card border border-mn-border-subtle/80 bg-mn-bg-elevated/80 px-4 py-6 text-center text-sm text-mn-text-primary shadow-mn-card",children:[e.jsx("h1",{className:"text-base font-heading font-semibold",children:"Profile unavailable"}),e.jsx("p",{className:"mt-2 text-xs text-mn-text-secondary",children:"We couldn't load your profile right now."}),(r==null?void 0:r.message)&&e.jsxs("p",{className:"mt-2 text-[11px] text-mn-text-muted",children:[e.jsx("span",{className:"font-semibold",children:"Details:"})," ",r.message]})]})}):e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-2 pt-1",children:[e.jsx(A,{title:"Profile",subtitle:"Tune the essentials that shape how you appear across MoviNesta."}),e.jsx("section",{className:"px-1 pb-24",children:e.jsx(S,{children:e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"mb-2 flex items-start gap-3",children:[e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-mn-border-subtle/50",children:e.jsx(q,{className:"h-4 w-4 text-mn-text-secondary","aria-hidden":"true"})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h2",{className:"text-sm font-heading font-semibold text-mn-text-primary",children:"Public profile"}),e.jsx("p",{className:"text-[11px] text-mn-text-secondary",children:"Your profile is shown on your diary, reviews, and social features."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx($,{initialUrl:t.avatarUrl,description:"Upload a square image (PNG/JPG) to use across the app.",disabled:s.isPending,onFileChange:a=>o(c=>({...c,avatarFile:a}))}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{htmlFor:"displayName",className:"block text-[11px] font-medium uppercase tracking-[0.16em] text-mn-text-muted",children:"Display name"}),e.jsx("input",{id:"displayName",type:"text",value:l.displayName,onChange:p("displayName"),maxLength:80,className:"w-full rounded-md border border-mn-border-subtle bg-mn-bg px-3 py-2 text-sm text-mn-text-primary shadow-sm outline-none ring-0 placeholder:text-mn-text-muted focus:border-mn-border-strong focus:ring-2 focus:ring-mn-border-strong/40",placeholder:"How should we show your name?"}),e.jsx("p",{className:"text-[10px] text-mn-text-muted",children:"This is the name other people see on your profile and activity."})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{htmlFor:"bio",className:"block text-[11px] font-medium uppercase tracking-[0.16em] text-mn-text-muted",children:"Bio"}),e.jsx("textarea",{id:"bio",value:l.bio,onChange:p("bio"),rows:4,maxLength:280,className:"w-full resize-none rounded-md border border-mn-border-subtle bg-mn-bg px-3 py-2 text-sm text-mn-text-primary shadow-sm outline-none ring-0 placeholder:text-mn-text-muted focus:border-mn-border-strong focus:ring-2 focus:ring-mn-border-strong/40",placeholder:"Tell people a bit about your taste in movies."}),e.jsx("p",{className:"text-[10px] text-mn-text-muted",children:"You can use multiple lines. Keep it short and cinematic."})]})]}),(s.isError||s.isSuccess)&&e.jsxs("div",{className:"pt-1 text-[11px]",children:[s.isError&&e.jsxs("div",{className:"flex items-center gap-1.5 text-mn-error",children:[e.jsx(D,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:((h=s.error)==null?void 0:h.message)??"Couldnâ€™t save changes."})]}),s.isSuccess&&!s.isError&&e.jsxs("div",{className:"flex items-center gap-1.5 text-emerald-400",children:[e.jsx(Y,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Profile updated."})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"rounded-full border border-transparent px-3 py-1.5 text-xs font-medium text-mn-text-secondary hover:bg-mn-border-subtle/40",onClick:()=>{t&&(o({displayName:t.displayName??"",bio:t.bio??"",avatarFile:null}),s.reset())},children:"Reset"}),e.jsxs("button",{type:"submit",disabled:s.isPending,className:"inline-flex items-center gap-1.5 rounded-full bg-mn-accent/90 px-3.5 py-1.5 text-xs font-medium text-black shadow-mn-card transition hover:bg-mn-accent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-accent/70 focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg disabled:cursor-not-allowed disabled:opacity-70",children:[s.isPending&&e.jsx(U,{className:"h-3.5 w-3.5 animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Save changes"})]})]})]})})})]}):e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md rounded-mn-card border border-mn-border-subtle/80 bg-mn-bg-elevated/80 px-4 py-6 text-center text-sm text-mn-text-primary shadow-mn-card",children:[e.jsx("h1",{className:"text-base font-heading font-semibold",children:"You're signed out"}),e.jsx("p",{className:"mt-2 text-xs text-mn-text-secondary",children:"Sign in to edit your profile settings."})]})})};export{H as default};
