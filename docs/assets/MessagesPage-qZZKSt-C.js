import{j as e,B as v,u as C,n as U,r as p,m as L,M as g,L as S}from"./index-C0YC7Lqk.js";import{T as k}from"./TopBar-Cwkp26YK.js";import{S as M}from"./SearchField-BHMpLgMO.js";import{C as P}from"./Chip-svl2C2tY.js";import{T,a as $,b as j}from"./Tabs-DtBA6fE-.js";import{P as A}from"./plus-ra6tBtUy.js";import{U as B}from"./users-CdKu7Qpk.js";const b=({icon:a,title:l,subtitle:t,actionLabel:n,onAction:i})=>e.jsxs("div",{className:"flex min-h-[220px] flex-col items-center justify-center gap-3 rounded-2xl border border-border bg-background/90 p-6 text-center shadow-lg",children:[a?e.jsx("div",{className:"inline-flex h-12 w-12 items-center justify-center rounded-2xl bg-primary/10 text-primary",children:a}):null,e.jsx("h3",{className:"text-base font-semibold text-foreground",children:l}),t?e.jsx("p",{className:"max-w-md text-[12px] text-muted-foreground",children:t}):null,n?e.jsx(v,{size:"sm",onClick:i,className:"mt-1",children:n}):null]}),z=({conversation:a})=>{const l=a.participants??[],t=l.find(r=>!r.isSelf)??l[0]??null,n=t?.displayName?.[0]?.toUpperCase()??t?.username?.[0]?.toUpperCase()??"?",i=a.lastMessageAtLabel??"Now",c=a.isGroup,o=l.length,m="group flex items-center gap-3 rounded-xl px-3 py-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",x=a.hasUnread?"bg-muted border border-border":"hover:bg-muted/60";return e.jsx("li",{className:"py-1 sm:py-1.5",children:e.jsxs(S,{to:`/messages/${a.id}`,className:`${m} ${x}`,children:[e.jsxs("div",{className:"relative flex h-12 w-12 items-center justify-center",children:[c&&o>1?e.jsx("div",{className:"flex -space-x-2",children:l.slice(0,2).map((r,f)=>e.jsx("span",{className:"inline-flex h-10 w-10 items-center justify-center overflow-hidden rounded-full bg-card text-xs font-semibold text-foreground ring-2 ring-background",style:{zIndex:2-f},children:r.avatarUrl?e.jsx("img",{src:r.avatarUrl??"",alt:r.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):r.displayName?.[0]?.toUpperCase()??r.username?.[0]?.toUpperCase()??"?"},r.id))}):e.jsx("span",{className:`inline-flex h-11 w-11 items-center justify-center overflow-hidden rounded-full text-[12px] font-semibold text-foreground ${a.hasUnread?"bg-primary/20":"bg-muted"}`,children:t?.avatarUrl?e.jsx("img",{src:t.avatarUrl??"",alt:t.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):n}),a.hasUnread&&e.jsx("span",{className:"absolute -right-0.5 -top-0.5 h-2.5 w-2.5 rounded-full bg-primary"})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:`truncate text-sm ${a.hasUnread?"font-semibold text-foreground":"font-medium text-foreground"}`,children:a.title}),c&&e.jsxs("div",{className:"mt-0.5 flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(B,{className:"h-3 w-3","aria-hidden":"true"}),e.jsxs("span",{children:[o," participants"]})]})]}),e.jsx("span",{className:"shrink-0 text-xs text-muted-foreground",children:i})]}),e.jsx("p",{className:`truncate text-[12px] ${a.hasUnread?"text-foreground":"text-muted-foreground"}`,children:a.lastMessagePreview??"Start chatting"})]})]})})},D=()=>{const a=C(),{data:l,isLoading:t,isError:n,error:i,refetch:c,isFetching:o}=U(),[m,x]=p.useState(""),[r,f]=p.useState("all"),u=m.trim().toLowerCase(),N=u.length>0,y=p.useMemo(()=>(l??[]).filter(s=>s.hasUnread).length,[l]),h=p.useMemo(()=>(l??[]).filter(s=>r==="unread"?s.hasUnread:r==="groups"?s.isGroup:!0).filter(s=>u?[s.title,s.subtitle,s.lastMessagePreview??"",...s.participants.map(d=>d.displayName),...s.participants.map(d=>d.username).filter(d=>!!d)].join(" ").toLowerCase().includes(u):!0),[l,u,r]),w=()=>{a("/search?tab=people&from=messages")};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-4",children:[e.jsx(k,{title:"Messages",subtitle:"Chat with friends, plan movie nights",actions:e.jsx(v,{type:"button",onClick:w,className:"h-11 w-11 p-0","aria-label":"New conversation",children:e.jsx(A,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-muted px-2 py-1",children:[e.jsx("span",{className:"inline-flex h-2 w-2 rounded-full bg-emerald-500"}),e.jsx("span",{className:"font-medium",children:y>0?`${y} unread`:"Inbox is caught up"})]}),o&&!t&&e.jsx(P,{className:"px-2 py-1 text-xs",children:"Syncing…"})]}),e.jsx("div",{className:"w-full sm:max-w-xs",children:e.jsx(T,{value:r,onValueChange:s=>f(s),children:e.jsxs($,{className:"w-full",children:[e.jsx(j,{value:"all",children:"All"}),e.jsx(j,{value:"unread",children:"Unread"}),e.jsx(j,{value:"groups",children:"Groups"})]})})})]}),e.jsx(M,{placeholder:"Search chats or people…",value:m,onChange:s=>x(s.target.value)}),t&&e.jsx(L,{}),n&&!t&&e.jsx("div",{className:"flex flex-1 items-center justify-center",children:e.jsx(b,{icon:e.jsx(g,{className:"h-5 w-5"}),title:"Something went wrong",subtitle:i?.message??"Please try again in a moment.",actionLabel:o?"Retrying…":"Reload inbox",onAction:()=>c()})}),!t&&!n&&N&&h.length===0&&e.jsx(b,{icon:e.jsx(g,{className:"h-6 w-6"}),title:"No conversations match",subtitle:"Try a different name or clear your search to see all chats.",actionLabel:"Clear search",onAction:()=>x("")}),!t&&!n&&!N&&h.length===0&&e.jsx(b,{icon:e.jsx(g,{className:"h-6 w-6"}),title:"Plan together",subtitle:"Create a group chat to line up your next movie night.",actionLabel:"New conversation",onAction:w}),!t&&!n&&h.length>0&&e.jsx("div",{className:"rounded-xl border border-border bg-background",children:e.jsx("ul",{className:"divide-y divide-border px-2 py-1 sm:px-3",children:h.map(s=>e.jsx(z,{conversation:s},s.id))})})]})};export{D as default};
