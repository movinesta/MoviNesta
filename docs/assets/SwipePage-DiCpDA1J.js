import{s as kt,n as qe,o as jt,e as gr,r as i,h as hs,k as bs,l as ws,v as gs,w as yr,x as sr,q as rt,t as ir,y as ys,j as e,B as vs,u as vr,R as ar,b as jr,c as pn,z as js,A as Ns}from"./index-Bghr9v56.js";import{M as k}from"./material-icon-luDcVHzZ.js";import{b as ks}from"./useDiaryLibrary-BT-3O88y.js";import{u as _s}from"./scroll-area-DXrInyZQ.js";import"./textarea-BORwdyZC.js";import{D as Nr,a as kr,b as _r,c as Mr,d as Ms}from"./dialog-yVuVmark.js";import{a as Ss}from"./appUrl-BIFKGN0O.js";import{F as lr}from"./FriendAvatarStack-BaTtzGkP.js";import{V as Rs}from"./VerifiedBadge-Dw8xsn8W.js";import"./conversationsCache-DHt66mnz.js";import"./format-BXv9LLlt.js";import"./external-link-Bu_iGdda.js";import"./plus-BjSwKdJ7.js";import"./x-C_YReo_I.js";import"./copy-B55E5gjD.js";import"./circle-alert-D1byO0Jr.js";import"./index-CEiMMCKT.js";const Sr="mn_rec_experiment_assignments_v1";function Cs(){if(typeof window>"u")return null;try{const n=window.localStorage.getItem(Sr);if(!n)return null;const s=JSON.parse(n);return s?.v!==1||typeof s.ts!="number"||typeof s.assignments!="object"?null:s}catch{return null}}function Fs(n){if(!(typeof window>"u"))try{const s={v:1,ts:Date.now(),assignments:n};window.localStorage.setItem(Sr,JSON.stringify(s))}catch{}}async function Ts(n,s){const o=s?.ttlMs,x=[...new Set((n??[]).map(y=>String(y).trim()).filter(Boolean))].slice(0,20);if(!x.length)return{};const R=Cs();if(R&&Date.now()-R.ts<o){const y={};for(const F of x)R.assignments?.[F]&&(y[F]=R.assignments[F]);if(Object.keys(y).length===x.length)return y}const w=await kt.functions.invoke("experiment-assign",{body:{keys:x}});if(w.error)throw w.error;const _=w.data?.assignments??{};if(_&&typeof _=="object"){const y={...R?.assignments??{},..._};Fs(y)}return _}const bn="movi_swipe_event_queue_v1";function Is(n){if(!n)return[];try{const s=JSON.parse(n);return Array.isArray(s)?s.filter(Boolean):[]}catch{return[]}}function wn(){return Is(jt(bn))}function As(n){const s=wn();s.push({...n,queuedAt:Date.now()});const o=s.slice(-200);qe(bn,JSON.stringify(o))}function Es(n){if(!n.length)return;const s=new Set(n),o=wn().filter(x=>!x.clientEventId||!s.has(x.clientEventId));qe(bn,JSON.stringify(o))}function Ps(n){return"combined"}function Ls(n){if(!n)return null;const s=n.replace("-","_");return s==="for_you"?"for-you":s==="friends"?"from-friends":s==="trending"?"trending":s==="popular"?"popular":s==="explore"?"explore":s==="combined"?"combined":null}function or(n){return n==="like"?"like":n==="dislike"?"dislike":"skip"}function tt(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():ys()}function Ds(n){const s=typeof n.posterUrl=="string"?n.posterUrl.trim():"",o=(s&&s.toLowerCase()!=="n/a"?s:"")||(n.tmdbPosterPath?ir(n.tmdbPosterPath,"w500")??"":"")||(n.tmdbBackdropPath?ir(n.tmdbBackdropPath,"w780")??"":"");if(!o)return null;const x=(n.title??"").trim()||"Untitled";return{...n,posterUrl:o,title:x}}function Os(n,s){if(typeof window>"u"||s<=0||navigator.connection?.saveData)return;const R=window.requestIdleCallback??(j=>window.setTimeout(j,300)),w=n.slice(0,s);R(()=>{for(const j of w){if(!j.posterUrl)continue;const _=new Image;_.decoding="async",_.loading="lazy",_.src=j.posterUrl}})}function $s(n,s){const o=s?.limit??60,x=s?.prefetchImages??6,R=s?.dwellThresholdMs??1200,w=s?.dwellDebounceMs??8e3,j=s?.invalidateHomeQueries??!1,_=gr();i.useEffect(()=>{let d=!1;const m=async()=>{if(d)return;const D=wn();if(!D.length)return;const z=[];for(const ee of D)try{(await sr(ee)).ok&&ee.clientEventId&&z.push(ee.clientEventId)}catch{break}z.length&&Es(z)};m();const g=()=>{m()};return window.addEventListener("online",g),()=>{d=!0,window.removeEventListener("online",g)}},[]);const y=i.useRef({}),F=i.useMemo(()=>hs(),[]),A=i.useMemo(()=>Ps(),[n]);i.useEffect(()=>{let d=!1;return(async()=>{try{const m=await Ts(["swipe_pipeline_v1","swipe_rerank_v1","swipe_diversity_v1"],{ttlMs:216e5});d||(y.current=m)}catch{}})(),()=>{d=!0}},[]);const E=i.useRef(new Set),U=i.useRef(!1),ne=i.useRef(0),Te=i.useRef(null),q=i.useRef(new Set),ae=i.useRef(new Map),[je,ze]=i.useState({status:"idle",cards:[],errorMessage:null}),[Ie,_t]=i.useState(null),H=i.useCallback(d=>{ze(m=>typeof d=="function"?d(m):d)},[]),Mt=i.useCallback(d=>{if(!d.length)return 0;const m=E.current,g=[];for(const D of d){if(m.has(D.id))continue;const z=Ds(D);m.add(D.id),z&&g.push(z)}return g.length?(H(D=>{const z={...D,status:"ready",cards:[...D.cards,...g],errorMessage:null};return Os(g,x),z}),g.length):0},[x,H]),Ne=i.useCallback(async(d=o)=>{if(!U.current){U.current=!0,H(m=>({...m,status:m.cards.length?"ready":"loading",errorMessage:null}));try{const m=s?.kindFilter??null,g=s?.seed??bs(F,A,m);Te.current!==g&&(Te.current=g,ne.current=0);const D=3;let z=0,ee=0;for(;z<D&&ee===0;){const Ae=`${g}:${ne.current}`;ne.current+=1;const Ye=await ws({sessionId:F,mode:A,kindFilter:m??void 0,limit:d,seed:Ae,minImdbRating:s?.minImdbRating??null,genresAny:s?.genresAny??null,experiments:Object.keys(y.current??{}).length?y.current:null},{timeoutMs:25e3}),it=Ye.deckId,Kt=Ye.recRequestId??null,le=(Ye.cards??[]).map((_e,Ht)=>({..._e,id:_e.mediaItemId,deckId:it,recRequestId:Kt,position:Ht,source:Ls(_e.source??n)}));if(!le.length){H(_e=>({..._e,status:_e.cards.length?"ready":"exhausted",errorMessage:null}));return}if(ee=Mt(le),ee>0)break;z+=1,console.warn("[useMediaSwipeDeck] filtered out all cards (missing OMDb poster?). Retrying...",{attempt:z,mode:A,kind:n,batchSize:d})}ee===0&&H(Ae=>({...Ae,status:Ae.cards.length?"ready":"exhausted",errorMessage:null}))}catch(m){const g=m instanceof Error?m.message:typeof m=="string"?m:"We couldn't load swipe cards.";H(D=>({...D,status:"error",errorMessage:g}))}finally{U.current=!1}}},[Mt,o,A,s?.kindFilter,s?.minImdbRating,JSON.stringify(s?.genresAny??[]),s?.seed,F,H]);i.useEffect(()=>{E.current=new Set,q.current=new Set,ae.current=new Map,U.current=!1,H({status:"loading",cards:[],errorMessage:null}),Ne(o)},[Ne,n,o,s?.kindFilter,s?.minImdbRating,JSON.stringify(s?.genresAny??[]),H]);const st=i.useCallback(()=>{s?.seed==null&&gs(F,A,s?.kindFilter??null),ne.current=0,E.current=new Set,q.current=new Set,ae.current=new Map,U.current=!1,H({status:"loading",cards:[],errorMessage:null}),Ne(o)},[Ne,o,A,s?.kindFilter,s?.minImdbRating,JSON.stringify(s?.genresAny??[]),s?.seed,F,H]),Xt=i.useCallback(d=>{d<=0||H(m=>({...m,cards:m.cards.slice(Math.min(d,m.cards.length))}))},[H]),N=yr({mutationFn:async d=>sr(d,{timeoutMs:2e4}),onError:(d,m)=>{const g=d instanceof Error?d.message:typeof d=="string"?d:"We couldn't save that action.";As(m),_t({payload:m,message:g})},onSuccess:()=>{_t(null),j&&(_.invalidateQueries({queryKey:rt.homeFeed(null)}),_.invalidateQueries({queryKey:rt.homeForYou(null)}))}}),St=i.useCallback((d,m)=>{if(!d)return;const g=`${d.deckId}:${d.id}`;q.current.has(g)||(q.current.add(g),N.mutate({sessionId:F,deckId:d.deckId,recRequestId:d.recRequestId??null,position:m??d.position,mediaItemId:d.id,eventType:"impression",source:d.source??null,clientEventId:tt(),payload:Object.keys(y.current).length?{experiments:y.current}:null}))},[N,F]),Ue=i.useCallback((d,m,g)=>{if(!d||!Number.isFinite(m)||m<R)return;const D=`${d.deckId}:${d.id}`,z=Date.now(),ee=ae.current.get(D)??0;z-ee<w||(ae.current.set(D,z),N.mutate({sessionId:F,deckId:d.deckId,recRequestId:d.recRequestId??null,position:g??d.position,mediaItemId:d.id,eventType:"dwell",dwellMs:Math.round(m),source:d.source??null,clientEventId:tt(),payload:Object.keys(y.current).length?{experiments:y.current}:null}))},[w,R,N,F]),G=i.useCallback(d=>{const m=d.card,g=d.action??null,D={};g&&(D.action=g),N.mutate({sessionId:F,deckId:m.deckId,recRequestId:m.recRequestId??null,position:m.position,mediaItemId:m.id,eventType:or(d.direction),source:m.source??null,clientEventId:tt(),payload:Object.keys(y.current).length||Object.keys(D).length?{...D,...Object.keys(y.current).length?{experiments:y.current}:{}}:null})},[N,F]),ke=i.useCallback(async d=>{const m=d.card,g=d.action??null,D={};return g&&(D.action=g),N.mutateAsync({sessionId:F,deckId:m.deckId,recRequestId:m.recRequestId??null,position:m.position,mediaItemId:m.id,eventType:or(d.direction),source:m.source??null,clientEventId:tt(),payload:Object.keys(y.current).length||Object.keys(D).length?{...D,...Object.keys(y.current).length?{experiments:y.current}:{}}:null})},[N,F]),$=i.useCallback(d=>{const m={...d,sessionId:d.sessionId??F,clientEventId:d.clientEventId??tt()},g=Object.keys(y.current).length?{...m,payload:{...typeof m.payload=="object"&&m.payload?m.payload:{},experiments:y.current}}:m;N.mutate(g)},[N,F]),l=i.useCallback(async d=>{const m={...d,sessionId:d.sessionId??F,clientEventId:d.clientEventId??tt()},g=Object.keys(y.current).length?{...m,payload:{...typeof m.payload=="object"&&m.payload?m.payload:{},experiments:y.current}}:m;try{await N.mutateAsync(g)}catch{}},[N,F]);return{sessionId:F,mode:A,cards:je.cards,status:je.status,isLoading:je.status==="loading",isError:je.status==="error",isExhausted:je.status==="exhausted",deckError:je.errorMessage??null,fetchMore:Ne,refresh:st,trimConsumed:Xt,trackImpression:St,trackDwell:Ue,sendEvent:$,sendEventAsync:l,swipe:G,swipeAsync:ke,swipeSyncError:Ie?.message??null,retryFailedSwipe:()=>{Ie&&N.mutate(Ie.payload)},isRetryingSwipe:N.isPending&&!!Ie}}const f=(n,s,o)=>Math.min(o,Math.max(s,n)),te=n=>{if(!n)return null;const s=n.trim();return!s||s.toUpperCase()==="N/A"?null:s},cr=n=>{if(!n||n<=0)return null;const s=Math.floor(n/60),o=n%60;return s===0?`${o}m`:o===0?`${s}h`:`${s}h ${o}m`},Bs=n=>{const s=te(n);if(!s)return null;const o=s.toLowerCase();return o==="united states"||o==="united states of america"?"US":o==="united kingdom"||o==="great britain"?"UK":o==="canada"?"CA":o==="australia"?"AU":o==="germany"?"DE":o==="france"?"FR":o==="spain"?"ES":o==="italy"?"IT":o==="japan"?"JP":o==="south korea"||o==="republic of korea"?"KR":s.length<=3?s.toUpperCase():s},Q=n=>{if(n==null)return null;if(typeof n=="number")return Number.isNaN(n)?null:n;const s=parseFloat(n);return Number.isNaN(s)?null:s},dr=n=>{const s=Q(n);return s==null?null:Math.round(s).toLocaleString()},Wt=n=>{if(!n)return;const s=[];n.year&&s.push(String(n.year));const o=[];typeof n.imdbRating=="number"&&!Number.isNaN(n.imdbRating)&&o.push(`IMDb ${n.imdbRating.toFixed(1)}`),typeof n.rtTomatoMeter=="number"&&!Number.isNaN(n.rtTomatoMeter)&&o.push(`${n.rtTomatoMeter}% Rotten Tomatoes`);const x=[...s,...o].filter(Boolean).join(" · ");return x?`${n.title} (${x})`:n.title},qs=({message:n,onRetry:s,isRetrying:o})=>n?e.jsx("div",{className:"mx-3 mb-3 rounded-md border border-amber-500/60 bg-amber-500/10 px-3 py-2 text-xs text-amber-50",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(k,{name:"error",className:"mt-0.5 text-[18px]",ariaLabel:"Error"}),e.jsxs("div",{className:"flex flex-1 flex-col gap-1",children:[e.jsx("p",{className:"leading-snug",children:n}),e.jsxs(vs,{type:"button",variant:"outline",size:"sm",onClick:s,disabled:o,children:[e.jsx(k,{name:"refresh",className:"text-[18px]",ariaLabel:"Retry"}),o?"Retrying…":"Retry"]})]})]})}):null,fn=({title:n})=>e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-background via-card to-background text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-card/70 shadow-md",children:e.jsx(k,{name:"image_not_supported",className:"text-[24px] text-muted-foreground"})}),e.jsx("span",{className:"text-[12px] font-semibold",children:"Artwork unavailable"}),n&&e.jsxs("span",{className:"max-w-[240px] truncate text-xs text-muted-foreground/80",children:["for ",n]})]})});function zs(n){const s=n.trim().split(/\s+/).filter(Boolean);if(!s.length)return"?";const o=s[0]?.[0]??"?",x=s.length>1?s[s.length-1]?.[0]??"":"";return(o+x).toUpperCase()}function Us({open:n,onOpenChange:s,profiles:o,verb:x}){const R=vr(),w=Array.isArray(o)?o.filter(Boolean):[],j=i.useMemo(()=>w.map(A=>A.id).filter(Boolean),[w]),[_,y]=i.useState({});i.useEffect(()=>{let A=!1;async function E(){if(!n||j.length===0)return;const{data:U,error:ne}=await kt.from("profiles_public").select("id,is_verified,verified_type,verified_label,verified_at,verified_by_org").in("id",j);if(A||ne)return;const Te={};for(const q of U??[])q?.id&&(Te[q.id]={is_verified:q.is_verified??null,verified_type:q.verified_type??null,verified_label:q.verified_label??null,verified_at:q.verified_at??null,verified_by_org:q.verified_by_org??null});y(Te)}return E(),()=>{A=!0}},[n,j.join("|")]);const F=w.length?`Friends who ${x}`:`No friends ${x} yet`;return e.jsx(Nr,{open:n,onOpenChange:s,children:e.jsxs(kr,{className:"max-w-md border border-border/60 bg-card text-foreground",children:[e.jsx(_r,{children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx(Mr,{className:"text-base font-semibold text-foreground",children:F}),e.jsx("button",{type:"button",onClick:()=>s(!1),className:"-mr-2 icon-hit border border-border/60 bg-background/60 hover:bg-background/80","aria-label":"Close","data-swipe-interactive":"true",children:e.jsx(k,{name:"close",className:"text-[22px]"})})]})}),w.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Once friends interact with titles, they’ll show up here."}):e.jsx("div",{className:"mt-2 max-h-[60vh] overflow-y-auto pr-1",children:e.jsx("div",{className:"space-y-2",children:w.map(A=>{const E=(A.display_name??A.username??"Friend").trim()||"Friend",U=(A.username??"").trim(),ne=zs(E);return e.jsxs("button",{type:"button",className:"flex w-full items-center gap-3 rounded-2xl border border-border/60 bg-background/40 px-3 py-2.5 text-left transition hover:bg-background/70",onClick:()=>{U&&(s(!1),R(`/u/${U}`))},"aria-label":U?`Open ${E} profile`:E,"data-swipe-interactive":"true",children:[e.jsx("div",{className:"h-10 w-10 overflow-hidden rounded-full border border-border/60 bg-muted",children:A.avatar_url?e.jsx("img",{src:A.avatar_url,alt:E,className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"grid h-full w-full place-items-center text-xs font-semibold text-foreground/80",children:ne})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-1",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:E}),e.jsx(Rs,{isVerified:_[A.id]?.is_verified,type:_[A.id]?.verified_type,label:_[A.id]?.verified_label,verifiedAt:_[A.id]?.verified_at,org:_[A.id]?.verified_by_org,className:"shrink-0 rounded-full p-0.5 text-primary/90 hover:text-primary"})]}),U?e.jsxs("div",{className:"truncate text-xs text-muted-foreground",children:["@",U]}):e.jsx("div",{className:"truncate text-xs text-muted-foreground",children:"Profile unavailable"})]}),e.jsx("div",{className:"grid h-9 w-9 place-items-center rounded-full border border-border/60 bg-background/60 text-muted-foreground",children:e.jsx(k,{name:"chevron_right",className:"text-[22px]"})})]},A.id)})})})]})})}const yt="mn_swipe_onboarding_seen",ur="mn_swipe_sfx_enabled",mr="mn_swipe_haptics_enabled",Ys={floaty_gamey:{distanceWidthFactor:.22,distanceMin:86,distanceMax:140,intentFactor:.35,intentMin:30,intentMax:52,velocityThreshold:.55,velocityProjectionMs:220,dragFollowAlpha:.22,rotationFactor:15,rotateZCap:18,rotateYCap:14,rotateXCap:7,undercardTranslateY:8,undercardBlurMax:1.4,punchScale:1.015,punchDurationMs:140,burstBaseCount:12,burstDurationMs:520}},W=Ys.floaty_gamey,Ws=88,Nt=(n,s=1)=>{const o=typeof n=="number"&&Number.isFinite(n)&&n>0?n:typeof window<"u"?window.innerWidth:Ws;return f(o*W.distanceWidthFactor*s,W.distanceMin,W.distanceMax)},pr=(n,s=1)=>f(Math.round(Nt(n,s)*W.intentFactor),W.intentMin,W.intentMax),Xs=(n,s)=>{const o=Math.abs(n);if(o<=s)return n;const x=o-s;return Math.sign(n)*(s+x*.18)},xn=8,Ks=1.25,Hs=1.6,Gs=.25,fr=120,hn=14,Vs=70,xr=W.velocityThreshold,vt=220,Qs=360,hr=W.rotationFactor,Zs=`
@keyframes mn-swipe-burst {
  0% { transform: translate3d(0px,0px,0px) rotate(0deg) scale(1); opacity: 0.95; }
  100% { transform: translate3d(var(--dx, 0px), var(--dy, 0px), 0px) rotate(var(--rot, 0deg)) scale(var(--s, 1)); opacity: 0; }
}
.mn-swipe-burst-dot {
  position: absolute;
  left: var(--x, 0px);
  top: var(--y, 0px);
  width: var(--sz, 8px);
  height: var(--sz, 8px);
  border-radius: 9999px;
  filter: blur(0px);
  will-change: transform, opacity;
  animation: mn-swipe-burst var(--dur, 520ms) cubic-bezier(0.18, 0.78, 0.22, 1) forwards;
}
.mn-swipe-burst-dot[data-shape="square"] { border-radius: 6px; }
@media (prefers-reduced-motion: reduce) {
  .mn-swipe-burst-dot { animation: none !important; opacity: 0 !important; }
}
`,Js={"--mn-swipe-radius":"clamp(26px, min(6vw, 4.2vh), 44px)","--mn-swipe-pad":"clamp(12px, min(4.6vw, 3.2vh), 24px)","--mn-swipe-kicker":"clamp(10px, min(2.5vw, 1.45vh), 12px)","--mn-swipe-header":"clamp(1.05rem, min(4.2vw, 2.6vh), 1.35rem)","--mn-swipe-top-hit":"clamp(2.25rem, min(9vw, 5.2vh), 2.9rem)","--mn-swipe-top-icon":"clamp(22px, min(5.6vw, 3.2vh), 30px)","--mn-swipe-title":"clamp(1.6rem, min(6.6vw, 4.4vh), 2.6rem)","--mn-swipe-subtitle":"clamp(0.92rem, min(3.6vw, 2.2vh), 1.15rem)","--mn-swipe-meta":"clamp(0.88rem, min(3.2vw, 2.0vh), 1.08rem)","--mn-swipe-chip":"clamp(0.72rem, min(2.9vw, 1.75vh), 0.9rem)","--mn-swipe-hit":"clamp(2.25rem, min(9vw, 5.5vh), 2.85rem)","--mn-swipe-gap":"clamp(1.35rem, min(6.2vw, 3.7vh), 2.5rem)","--mn-swipe-action":"clamp(3.1rem, min(12.5vw, 7.0vh), 4.1rem)","--mn-swipe-action-primary":"clamp(4.4rem, min(17.5vw, 9.2vh), 6.1rem)","--mn-swipe-icon":"clamp(22px, min(5.5vw, 3.4vh), 30px)","--mn-swipe-icon-primary":"clamp(32px, min(8.5vw, 4.8vh), 46px)","--mn-swipe-star-hit":"clamp(18px, min(5vw, 2.8vh), 24px)","--mn-swipe-star-icon":"clamp(14px, min(3.8vw, 2.1vh), 19px)"},Rr=n=>{if(n==null)return null;const s=String(n).trim();if(!s)return null;const o=s.replace(/%/g,""),x=Number(o);return Number.isFinite(x)?x:null},ei=n=>{if(n==null)return null;const s=Math.round(n);return s<=0?null:Math.min(10,Math.max(2,s*2))},ti=n=>{const s=(()=>{const w=String(n?.source??"").trim();if(!w)return null;const j=w.replace("-","_");return j==="for_you"||j==="for-you"?"for-you":j==="friends"||j==="from_friends"||j==="from-friends"?"from-friends":j==="trending"?"trending":j==="popular"?"popular":j==="combined"?"combined":j==="explore"?"explore":null})(),o=n?.kind==="series"?"series":n?.kind==="anime"?"anime":"movie",x=typeof n?.releaseYear=="number"?n.releaseYear:n?.releaseYear!=null?Number(n.releaseYear):null,R=typeof n?.runtimeMinutes=="number"?n.runtimeMinutes:n?.runtimeMinutes!=null?Number(n.runtimeMinutes):null;return{id:String(n?.id??""),title:String(n?.title??"Untitled"),deckId:n?.deckId??null,position:typeof n?.position=="number"?n.position:n?.position!=null?Number(n.position):null,year:Number.isFinite(x)?x:null,type:o,runtimeMinutes:Number.isFinite(R)?R:null,tagline:n?.tagline??null,mood:n?.mood??null,vibeTag:n?.vibeTag??null,posterUrl:n?.posterUrl??null,tmdbPosterPath:n?.tmdbPosterPath??null,tmdbBackdropPath:n?.tmdbBackdropPath??null,source:s,why:n?.why??null,friendIds:Array.isArray(n?.friendIds)?n.friendIds:null,friendProfiles:Array.isArray(n?.friendProfiles)?n.friendProfiles:null,friendLikesCount:typeof n?.friendLikesCount=="number"?n.friendLikesCount:Array.isArray(n?.friendProfiles)?n.friendProfiles.length:Array.isArray(n?.friendIds)?n.friendIds.length:null,topFriendName:Array.isArray(n?.friendProfiles)&&n.friendProfiles[0]?String(n.friendProfiles[0].display_name??n.friendProfiles[0].username??""):n?.topFriendName??null,topFriendInitials:n?.topFriendInitials??null,topFriendReviewSnippet:n?.topFriendReviewSnippet??null,overview:n?.overview??null,genres:Array.isArray(n?.genres)?n.genres:null,language:n?.language??null,country:n?.country??null,initialRating:typeof n?.initialRating=="number"?n.initialRating:n?.initialRating!=null?Number(n.initialRating):null,initiallyInWatchlist:!!n?.initiallyInWatchlist,imdbRating:typeof n?.imdbRating=="number"?n.imdbRating:n?.imdbRating!=null?Number(n.imdbRating):null,rtTomatoMeter:typeof n?.rtTomatoMeter=="number"?n.rtTomatoMeter:n?.rtTomatoMeter!=null?Number(n.rtTomatoMeter):null}};function br(n){const{card:s,friendCount:o,imdb:x,rt:R}=n;let w=74;const j=s?.source??null;j==="for-you"&&(w+=10),j==="from-friends"&&(w+=7),j==="trending"&&(w+=4),j==="popular"&&(w+=2);const _=typeof s?.friendLikesCount=="number"?s.friendLikesCount:0;if(_>0){const F=o>0?_/Math.max(1,o)*18:Math.min(12,_*3);w+=F}x!=null&&(w+=(x-7)*4),R!=null&&(w+=(R-70)*.15),s?.why&&(w+=3);const y=Math.round(w);return Math.round(f(y,55,99))}const wr=async n=>{const{data:s,error:o}=await kt.from("media_items").select("id, kind, omdb_plot, omdb_director, omdb_writer, omdb_actors, omdb_genre, omdb_language, omdb_country, omdb_imdb_rating, omdb_imdb_votes, omdb_metascore, omdb_rating_rotten_tomatoes, omdb_poster, omdb_awards, omdb_box_office, omdb_released, omdb_rated, omdb_runtime, omdb_fetched_at, omdb_status, omdb_error").eq("id",n).maybeSingle();if(o)throw o;if(!s)return null;const x=s.omdb_genre!=null?String(s.omdb_genre).split(",").map(w=>w.trim()).filter(Boolean):null,R=Rr(s.omdb_rating_rotten_tomatoes);return{title_id:s.id,content_type:s.kind??null,plot:s.omdb_plot??null,omdb_director:s.omdb_director??null,omdb_writer:s.omdb_writer??null,omdb_actors:s.omdb_actors??null,genres:x,omdb_language:s.omdb_language??null,omdb_country:s.omdb_country??null,imdb_rating:s.omdb_imdb_rating??null,imdb_votes:s.omdb_imdb_votes??null,metascore:s.omdb_metascore??null,rt_tomato_pct:R,poster_url:s.omdb_poster??null,omdb_awards:s.omdb_awards??null,omdb_box_office_str:s.omdb_box_office??null,omdb_box_office:null,omdb_released:s.omdb_released??null,omdb_rated:s.omdb_rated??null,omdb_runtime:s.omdb_runtime??null,omdb_fetched_at:s.omdb_fetched_at??null,omdb_status:s.omdb_status??null,omdb_error:s.omdb_error??null}},Fe="want_to_watch",nt="watched",Mi=()=>{const n=vr(),[s,o]=i.useState(null),[x,R]=i.useState(!1),[w,j]=i.useState([]),[_,y]=i.useState(0),[F,A]=i.useState({w:0,h:0});i.useEffect(()=>{if(typeof window>"u")return;let t=0;const r=()=>{cancelAnimationFrame(t),t=requestAnimationFrame(()=>{A({w:window.innerWidth,h:window.innerHeight})})};return r(),window.addEventListener("resize",r,{passive:!0}),window.addEventListener("orientationchange",r,{passive:!0}),()=>{cancelAnimationFrame(t),window.removeEventListener("resize",r),window.removeEventListener("orientationchange",r)}},[]);const E=i.useMemo(()=>{const t=F.h||844;return t<640?4:t<720?5:t<820?6:t<920?7:8},[F.h]),U=i.useMemo(()=>f(E+2,6,10),[E]),{cards:ne,sessionId:Te,isLoading:q,isError:ae,swipe:je,fetchMore:ze,trimConsumed:Ie,swipeSyncError:_t,retryFailedSwipe:H,isRetryingSwipe:Mt,trackImpression:Ne,trackDwell:st,sendEventAsync:Xt}=$s("combined",{limit:72,kindFilter:s,minImdbRating:_>0?_:null,genresAny:w.length?w:null}),N=i.useMemo(()=>ne.map(ti),[ne]),St=i.useMemo(()=>{const t=new Set;for(const r of N){const a=r?.genres??[];for(const c of a){const u=String(c??"").trim();u&&t.add(u)}}return Array.from(t).sort((r,a)=>r.localeCompare(a))},[N]),Ue=ar.useCallback(t=>{if(!t)return!1;if(w.length){const r=Array.isArray(t.genres)?t.genres:[],a=new Set(r.map(u=>String(u).toLowerCase()));if(!w.some(u=>a.has(String(u).toLowerCase())))return!1}if(_>0){const r=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)?t.imdbRating:null;if(r!=null&&r<_)return!1}return!0},[w,_]),[G,ke]=i.useState(0),$=ne[G],l=N[G],[d,m]=i.useState(!1),g=i.useRef(!1);i.useEffect(()=>{g.current=d},[d]);const[D,z]=i.useState(()=>typeof window>"u"?!1:!jt(yt)),[ee,Ae]=i.useState([]),Ye=(t,r)=>{t&&Ae(a=>{const c=a.includes(t);return r?c?a:[...a,t]:c?a.filter(u=>u!==t):a})},it=t=>Ye(l?.id,t),Kt=!!l?.id&&ee.includes(l.id),le=N[G+1]??null,_e=!!le?.id&&ee.includes(le.id),Ht=!!(le?.posterUrl&&!_e);i.useEffect(()=>{if(typeof window>"u")return;const t=le?.posterUrl;if(!t)return;const r=new Image;r.decoding="async",r.src=t},[le?.posterUrl]);const[Cr,gn]=i.useState(!1),[Ee,Rt]=i.useState(!1),[Ct,Ft]=i.useState(!1),[at,yn]=i.useState(null),[Fr,Gt]=i.useState(!1),Me=i.useRef(null),vn=i.useRef(new Set),[jn,Nn]=i.useState(null),lt=i.useRef(null),[,Tr]=i.useState(0),[Ir,kn]=i.useState(0),Vt=i.useRef(null),Qt=i.useRef(!1),[Ar,_n]=i.useState(!1),re=l?.id??null,Tt=le?.id??null,{user:he}=jr(),ot=gr();i.useEffect(()=>{if(typeof window>"u"||N.length===0)return;const t=window.requestIdleCallback,r=()=>{const u=Math.min(Math.max(G+1,0),N.length),h=Math.min(N.length,u+8),p=N.slice(u,h).map(C=>{if(!C.id)return null;const B=rt.titleDetail(C.id);return ot.getQueryData(B)?null:ot.prefetchQuery({queryKey:B,queryFn:()=>wr(C.id),staleTime:1e3*60*30,gcTime:1e3*60*60})});Promise.allSettled(p.filter(Boolean))};if(t){const c=t(r);return()=>{typeof window<"u"&&"cancelIdleCallback"in window&&window.cancelIdleCallback?.(c)}}const a=window.setTimeout(r,280);return()=>window.clearTimeout(a)},[N,G,ot]);const{data:ct}=pn({queryKey:["title-preview",Tt],enabled:!!Tt,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>{if(!Tt)return null;const{data:t,error:r}=await kt.from("media_items").select("id, omdb_director, omdb_genre, omdb_rating_rotten_tomatoes, omdb_imdb_rating").eq("id",Tt).maybeSingle();if(r)throw r;return t?{omdb_director:t.omdb_director??null,omdb_genre:t.omdb_genre??null,omdb_rating_rotten_tomatoes:t.omdb_rating_rotten_tomatoes??null,omdb_imdb_rating:t.omdb_imdb_rating??null}:null}}),Mn=te(ct?.omdb_director),Er=Rr(ct?.omdb_rating_rotten_tomatoes),Pr=Q(ct?.omdb_imdb_rating),{data:Pe=0}=pn({queryKey:["friendCount",{userId:he?.id??null}],enabled:!!he?.id,staleTime:1e3*60*10,gcTime:1e3*60*30,refetchOnWindowFocus:!1,queryFn:async()=>{if(!he?.id)return 0;const{count:t,error:r}=await kt.from("follows").select("followed_id",{count:"exact",head:!0}).eq("follower_id",he.id);if(r)throw r;return t??0}}),Sn=ks(re),Rn=Sn.data?.status??null,Cn=Sn.data?.rating??null,[Lr,It]=i.useState(null),[Dr,Fn]=i.useState(null),Zt={status:Lr??Rn},At=yr({mutationFn:async t=>{if(!he?.id||!$)return;const r={sessionId:Te,deckId:$.deckId??null,position:$.position??null,mediaItemId:$.id,source:$.source??null,events:[]},a=[];if(t.status!==void 0)if(t.statusKind==="watched"){const c=t.status===nt;a.push({eventType:"like",payload:{ui:"SwipePage",action:"status",status:"watched",enabled:c}})}else{const c=t.status===Fe;a.push({eventType:"watchlist",inWatchlist:c,payload:{ui:"SwipePage",action:"status",status:"watchlist",enabled:c}})}t.ratingStars!==void 0&&a.push({eventType:"rating",rating0_10:ei(t.ratingStars),payload:{ui:"SwipePage",action:"rating"}}),a.length&&(r.events=a,await Xt(r))},onSuccess:()=>{he?.id&&re&&(ot.invalidateQueries({queryKey:rt.titleDiary(he.id,re)}),ot.invalidateQueries({queryKey:rt.diaryLibrary(he.id)}))}}),dt=i.useRef(null),Tn=i.useRef(null),Et=i.useRef(!1),[Or,$r]=i.useState(!1),[We,In]=i.useState(!0),[Xe,An]=i.useState(!0),Pt=i.useRef(!0),Lt=i.useRef(!0),En=i.useRef(0);i.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{Et.current=t.matches,$r(t.matches)};return r(),typeof t.addEventListener=="function"?t.addEventListener("change",r):t.addListener?.(r),()=>{typeof t.removeEventListener=="function"?t.removeEventListener("change",r):t.removeListener?.(r)}},[]),i.useEffect(()=>{if(!(typeof window>"u"))try{const t=jt(ur),r=jt(mr),a=t==null?!0:t==="1",c=r==null?!0:r==="1";In(a),An(c),Pt.current=a,Lt.current=c}catch{}},[]),i.useEffect(()=>{if(Pt.current=We,!(typeof window>"u"))try{qe(ur,We?"1":"0")}catch{}},[We]),i.useEffect(()=>{if(Lt.current=Xe,!(typeof window>"u"))try{qe(mr,Xe?"1":"0")}catch{}},[Xe]);const Ke=i.useRef({x:0,y:0});i.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const t=window.matchMedia("(pointer: coarse)"),r=()=>{Ge.current=t.matches};return r(),typeof t.addEventListener=="function"?t.addEventListener("change",r):t.addListener?.(r),()=>{typeof t.removeEventListener=="function"?t.removeEventListener("change",r):t.removeListener?.(r)}},[]);const Pn=()=>{if(typeof window>"u")return null;if(dt.current)return dt.current;const t=window.AudioContext||window.webkitAudioContext;if(!t)return null;const r=new t;return dt.current=r,r},Dt=t=>{Lt.current&&(typeof navigator>"u"||typeof navigator.vibrate!="function"||navigator.vibrate(t))},Ot=(t,r=1)=>{if(!Lt.current)return;const a=typeof performance<"u"?performance.now():Date.now(),c=En.current||0,u=t==="commit"?0:Vs;if(a-c<u)return;En.current=a;const h=f(r,.2,1);if(t==="threshold"){Dt(8);return}if(t==="snap"){Dt(6);return}if(t==="skip"){Dt(12);return}const b=Math.round(16+h*22);Dt(h>.7?[b,12,b+8]:b)},Ln=(t,r)=>{if(!Pt.current||typeof document<"u"&&document.visibilityState==="hidden")return;const a=Pn();if(!a)return;a.state==="suspended"&&a.resume().catch(()=>{});const c=1+(Math.random()*.06-.03),u=f(r,.2,1),h=a.currentTime,b=.11+u*.08,p=Math.max(1,Math.floor(a.sampleRate*b)),C=a.createBuffer(1,p,a.sampleRate),B=C.getChannelData(0);for(let Y=0;Y<p;Y+=1){const K=1-Y/p;B[Y]=(Math.random()*2-1)*K}const T=a.createBufferSource();T.buffer=C;const M=a.createBiquadFilter();M.type="bandpass";const P=t==="like"?760:t==="dislike"?520:640,S=t==="like"?1180:t==="dislike"?320:560;M.frequency.setValueAtTime(Math.max(80,P*c),h),M.frequency.exponentialRampToValueAtTime(Math.max(60,S*c),h+b);const v=a.createGain();v.gain.setValueAtTime(1e-4,h),v.gain.exponentialRampToValueAtTime(.09+u*.14,h+.012),v.gain.exponentialRampToValueAtTime(1e-4,h+b),T.connect(M),M.connect(v),v.connect(a.destination),T.start(h),T.stop(h+b+.02);const I=a.createOscillator(),O=a.createGain();I.type=t==="like"?"sine":"triangle";const J=t==="like"?520:t==="dislike"?210:360;I.frequency.setValueAtTime(J*c,h),I.frequency.linearRampToValueAtTime((J+(t==="like"?180:-40))*c,h+b),O.gain.setValueAtTime(1e-4,h),O.gain.exponentialRampToValueAtTime(.04+u*.05,h+.01),O.gain.exponentialRampToValueAtTime(1e-4,h+b),I.connect(O),O.connect(a.destination),I.start(h),I.stop(h+b+.02)},Br=(t,r=1)=>{if(Et.current)return;const a=Tn.current;if(!a)return;const c=a.getBoundingClientRect(),u=c.width,h=c.height;if(u<=0||h<=0)return;const b=W.burstDurationMs,p=Math.max(6,Math.round(W.burstBaseCount*f(r,.25,1))),C=t==="like"?Math.min(92,u*.28):Math.max(u-92,u*.72),B=Math.min(92,h*.14),T=t==="like"?"rgba(52,211,153,0.82)":"rgba(251,113,133,0.82)",M=t==="like"?"rgba(255,255,255,0.75)":"rgba(255,255,255,0.7)";for(let P=0;P<p;P++){const S=document.createElement("span"),v=P%5===0;S.className="mn-swipe-burst-dot",S.setAttribute("data-shape",v?"square":"dot");const I=(Math.random()*Math.PI*.9+Math.PI*.05)*(t==="like"?1:-1),O=62+Math.random()*98,J=Math.cos(I)*O,Y=-Math.abs(Math.sin(I))*O*(.85+Math.random()*.5),K=5+Math.random()*6,ie=(Math.random()*160-80).toFixed(1)+"deg",me=(.8+Math.random()*.9).toFixed(2);S.style.setProperty("--x",C.toFixed(1)+"px"),S.style.setProperty("--y",B.toFixed(1)+"px"),S.style.setProperty("--dx",J.toFixed(1)+"px"),S.style.setProperty("--dy",Y.toFixed(1)+"px"),S.style.setProperty("--rot",ie),S.style.setProperty("--s",me),S.style.setProperty("--sz",K.toFixed(1)+"px"),S.style.setProperty("--dur",b+"ms"),S.style.background=P%3===0?M:T,a.appendChild(S),window.setTimeout(()=>S.remove(),b+60)}},{data:L}=pn({queryKey:rt.titleDetail(re),enabled:!!re,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>re?wr(re):null}),$t=te(L?.plot)??te(l?.overview)??null,oe=L?.genres??l?.genres??null,qr=L?.omdb_country??l?.country??null,zr=te(qr),Dn=Bs(zr),Le=te(L?.omdb_director),On=te(L?.omdb_writer),ut=te(L?.omdb_actors),He=L?.imdb_rating??l?.imdbRating??null,Jt=L?.rt_tomato_pct??l?.rtTomatoMeter??null,en=L?.metascore??null,tn=L?.imdb_votes??null,$n=te(L?.omdb_awards),Bn=te(L?.omdb_box_office_str),qn=te(L?.omdb_released),nn=L?.content_type==="movie"||L?.content_type==="series"||L?.content_type==="anime"?L.content_type:l?.type??null,zn=l,Ur=zn?.certification??zn?.rated??L?.omdb_rated??null,Un=te(Ur),Yn=(Array.isArray(oe)?oe:oe?String(oe).split(",").map(t=>t.trim()):[])??[],Wn=Yn.length>3?Yn.slice(3).filter(Boolean):[],Yr=[L?.omdb_language??null,l?.language??null],Xn=Array.from(new Set(Yr.map(t=>te(t)).filter(t=>!!t))),rn=()=>he?!0:(alert("Sign in to save this title, rate it, or add it to your watchlist."),!1),Kn=t=>{if(!(!re||!$||!rn())){if(t===Fe){const r=Zt.status===Fe?null:Fe;It(r),At.mutate({status:r,statusKind:"watchlist"});return}if(t===nt){const r=Zt.status===nt?null:nt;It(r),At.mutate({status:r,statusKind:"watched"})}}},Wr=()=>{!re||!$||!rn()||(It(Fe),At.mutate({status:Fe,statusKind:"watchlist"}),Vr())},Xr=t=>{!re||!$||!rn()||(Fn(t),At.mutate({ratingStars:t}))},Hn=t=>Zt?.status===t,sn=Dr??(Cn??null);i.useEffect(()=>{Fn(null),It(null)},[re,Cn,Rn]);const Kr=t=>{Xr(sn===t?null:t)},Gn=()=>typeof window<"u"?Ss(`/title/${l?.id??""}`):`/title/${l?.id??""}`,Hr=Gn(),Gr=async t=>{if(!l||!$)return;const r=Gn(),a=`Check this out: ${l.title}`,c=t??a;try{navigator.share?await navigator.share({title:l.title,text:c,url:r}):navigator.clipboard?.writeText?(await navigator.clipboard.writeText(`${c}

${r}`),alert("Link copied to clipboard")):alert(`${c}

${r}`)}catch{}},Vn=!!(l?.posterUrl&&!Kt),ce=i.useRef(null),Qn=i.useRef(null),Se=i.useRef({w:0,h:0}),Ge=i.useRef(!1),de=i.useRef(null),ue=i.useRef(null),Ve=i.useRef(0),De=i.useRef(0),Re=i.useRef(0),Oe=i.useRef(!1),xe=i.useRef(null),Zn=i.useRef(!1),be=i.useRef(null),$e=i.useRef(0),mt=i.useRef(null),we=i.useRef(null),se=i.useRef(null),Z=i.useRef(0),ge=i.useRef(null),ye=i.useRef(.5),ve=i.useRef(.5),pt=i.useRef(null),ft=i.useRef(null),Bt=i.useRef(null),qt=i.useRef(null),Qe=i.useRef(null);i.useEffect(()=>{const t=()=>{const r=ce.current;if(!r)return;const a=r.getBoundingClientRect();!a.width||!a.height||(Se.current={w:a.width,h:a.height})};if(t(),!(typeof window>"u"))return window.addEventListener("resize",t,{passive:!0}),()=>window.removeEventListener("resize",t)},[l?.id]);const Vr=()=>{if(!l)return;z(!1),typeof window<"u"&&qe(yt,"1");const t=ce.current;t&&(t.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",t.style.transform="perspective(1400px) translateX(0px) translateY(6px) scale(1.02) rotateZ(-1deg)",window.setTimeout(()=>{t.style.transform="perspective(1400px) translateX(0px) translateY(26px) scale(0.95)"},16),t.style.opacity="0"),window.setTimeout(()=>{Jn(0,!0),ke(r=>Math.min(r+1,N.length)),t&&(t.style.transition="none",t.style.transform="translateX(0px) translateY(0px) scale(1)",t.style.opacity="1")},220)};i.useEffect(()=>{if(typeof window>"u")return;const t=jt(yt);z(!t)},[]),i.useEffect(()=>{it(!1),Rt(!1),Ft(!1)},[l?.id]),i.useEffect(()=>{!$||!l||q||ae||Ue(l)||(Rt(!1),Ft(!1),ke(t=>Math.min(t+1,N.length)))},[$?.id,l?.id,q,ae,Ue]),i.useEffect(()=>{if(!$)return;const t=performance.now();if(Qe.current&&qt.current&&qt.current!==$.id){const r=Bt.current;if(r!=null){const a=Math.max(0,Math.round(t-r));st(Qe.current,a)}}if(!Ue(l)){Qe.current=null,qt.current=null,Bt.current=null;return}Ne($),Qe.current=$,qt.current=$.id,Bt.current=t},[$?.id,l?.id,Ue,st,Ne]),i.useEffect(()=>()=>{if(!Qe.current)return;const t=Bt.current;if(t==null)return;const r=Math.max(0,Math.round(performance.now()-t));st(Qe.current,r)},[]),i.useEffect(()=>{if(typeof window>"u")return;(window.requestIdleCallback??(r=>window.setTimeout(r,180)))(()=>{const r=N.slice(G+1,G+4);for(const a of r){if(!a?.posterUrl)continue;const c=new Image;c.loading="lazy",c.decoding="async",c.src=a.posterUrl}})},[N,G]),i.useEffect(()=>()=>{be.current&&cancelAnimationFrame(be.current),Me.current!=null&&window.clearTimeout(Me.current),lt.current!=null&&window.clearTimeout(lt.current),dt.current&&dt.current.close().catch(()=>{})},[]),i.useEffect(()=>{const t=N.length-G;t<12&&ze(Math.max(60,t+24))},[N.length,G,ze]),i.useEffect(()=>{if(G<=10)return;const t=Math.min(Math.max(G-6,0),N.length);t>0&&(Ie(t),ke(r=>Math.max(4,r-t)))},[N.length,G,Ie]);const Jn=i.useCallback((t,r=!1,a)=>{const c=Qn.current;if(!c)return;const u=Ge.current?.96:1,h=Nt(Se.current.w,u),b=f(Math.abs(t)/Math.max(1,h),0,1),p=f(t/Math.max(1,h),-1,1),C=.68+b*.32+p*b*.03,B=.9+b*.1+p*b*.02,T=.985+b*.015,M=(1-b)*W.undercardTranslateY,P=(1-b)*W.undercardBlurMax,S=1-b,v=(f(-t*.02,-10,10)+p*b*8)*S,I=f(-t/220,-2.2,2.2)*S,O=a??200;c.style.transition=r?`filter ${O}ms cubic-bezier(0.22,0.61,0.36,1), transform ${O}ms cubic-bezier(0.22,0.61,0.36,1)`:"none",c.style.transform=`translate3d(${v.toFixed(2)}px, ${M.toFixed(2)}px, 0px) rotateZ(${I.toFixed(3)}deg) scale(${T.toFixed(4)})`,c.style.filter=`brightness(${C.toFixed(3)}) saturate(${B.toFixed(3)}) blur(${P.toFixed(2)}px)`},[]),Qr=()=>{typeof performance>"u"||(mt.current=performance.now())},Zr=()=>{if(typeof performance>"u")return 1;const t=mt.current;if(t==null)return 1;const r=(performance.now()-t)/Math.max(1,W.punchDurationMs);if(r>=1)return mt.current=null,1;const a=Math.sin(Math.PI*r);return 1+(W.punchScale-1)*a},xt=(t,r=!1,a,c)=>{const u=ce.current;if(!u)return;const h=Et.current,b=Ge.current?.96:1,p=Nt(Se.current.w,b),C=pr(Se.current.w,b),T=(wt=>{const Yt=Math.abs(wt),gt=Math.max(1,p)*.7;if(Yt<=gt)return wt;const mn=Yt-gt;return Math.sign(wt)*(gt+mn*.38)})(t),M=f(T,-vt,vt),P=Xs(T,vt),S=Math.abs(T)>.5&&xe.current==="x";u.style.transformOrigin=S?`${(ve.current*100).toFixed(1)}% ${(ye.current*100).toFixed(1)}%`:"50% 50%";const v=Math.abs(M),I=C*.6,O=f((v-I)/Math.max(1,p-I),0,1),J=M>0?O:0,Y=M<0?O:0;u.style.setProperty("--mn-swipe-like-opacity",String(J)),u.style.setProperty("--mn-swipe-nope-opacity",String(Y)),u.style.setProperty("--mn-swipe-like-scale",String(.96+J*.04)),u.style.setProperty("--mn-swipe-nope-scale",String(.96+Y*.04));const K=f(Math.abs(M)/Math.max(1,p),0,1),ie=f((.5-ye.current)*2,-1,1),me=ie<0?-1:1,pe=.55+.45*Math.abs(ie),et=f((ve.current-.5)*2,-1,1),X=f(Math.abs(Z.current)/1.35,0,1),V=M/hr*pe*me,fe=f(V*(1+X*.28),-18,W.rotateZCap),on=f(M/24+Math.sign(M)*X*2.8+-et*K*4.5,-14,W.rotateYCap),Ut=f(ie*(1.8+X*2.2)*K,-7,W.rotateXCap);if(h)u.style.setProperty("--mn-swipe-spec-o","0"),u.style.setProperty("--mn-swipe-poster-parallax","0px"),u.style.setProperty("--mn-swipe-poster-parallax-y","0px"),u.style.setProperty("--mn-swipe-bg-parallax","0px"),u.style.boxShadow="0 30px 90px rgba(0,0,0,0.62)",u.style.backdropFilter="blur(8px)";else{const wt=f(.08+K*.22+X*.12,0,.42),Yt=f(50+M/Math.max(1,p)*18+Ke.current.x*12,24,76),gt=f(28+-Re.current/Math.max(1,p)*12+Ke.current.y*10,16,66);u.style.setProperty("--mn-swipe-spec-o",wt.toFixed(3)),u.style.setProperty("--mn-swipe-spec-x",`${Yt.toFixed(1)}%`),u.style.setProperty("--mn-swipe-spec-y",`${gt.toFixed(1)}%`),u.style.setProperty("--mn-swipe-poster-parallax",`${(-M*.035).toFixed(2)}px`),u.style.setProperty("--mn-swipe-poster-parallax-y",`${(Re.current*.02).toFixed(2)}px`),u.style.setProperty("--mn-swipe-bg-parallax",`${(M*.02).toFixed(2)}px`);const mn=f(.46+K*.22+X*.14,.35,.78);u.style.boxShadow=`0 30px 92px rgba(0,0,0,${mn.toFixed(3)})`,u.style.backdropFilter=`blur(${(8+K*8).toFixed(1)}px)`}const cn=h?0:f(Re.current*.18,-14,14),dn=-K*(3.2+X*1.6),ds=Zr(),us=(1+K*.006+X*.004)*ds,un=h?{x:0,y:0}:Ke.current,ms=un.y*-4,ps=un.x*5,fs=un.y*-4,rr=a??320,xs=c??"cubic-bezier(0.16, 1, 0.3, 1)";u.style.transition=r?`transform ${rr}ms ${xs}`:"none",u.style.transform=`
      perspective(1400px)
      translate3d(${P}px, ${fs+dn+cn}px, 0px)
      rotateX(${h?0:ms+Ut}deg)
      rotateY(${h?0:on+ps}deg)
      rotateZ(${h?0:fe}deg)
      scale(${us})
    `,Ve.current=M,Jn(M,r,rr)},zt=(t=!0,r=0)=>{Ke.current={x:0,y:0};const a=Math.abs(r),c=f(a/1.35,0,1),u=t?f(Math.round(320-c*140),170,320):void 0,h=t&&a<.45?"cubic-bezier(0.22, 1.2, 0.36, 1)":"cubic-bezier(0.16, 1, 0.3, 1)";xt(0,t,u,h),Ve.current=0,de.current=null,ue.current=null,we.current=null,se.current=null,Z.current=0,De.current=0,Re.current=0,Oe.current=!1,xe.current=null,ve.current=.5,ye.current=.5,pt.current=null},Jr=(t,r)=>{yn({card:t,direction:r}),Gt(!0),Me.current!=null&&window.clearTimeout(Me.current),Me.current=window.setTimeout(()=>Gt(!1),2800)},es=()=>{Gt(!1),yn(null),Me.current!=null&&(window.clearTimeout(Me.current),Me.current=null)},ts=()=>{at&&(ke(t=>{const r=t-1;if(r<0)return t;const a=N[r];return a&&a.id===at.card.id?r:t}),Ze("Reviewing previous card. Swipe actions are already saved."),typeof window<"u"&&window.requestAnimationFrame(()=>zt(!1)),es())},Ze=t=>{Nn(t),lt.current!=null&&window.clearTimeout(lt.current),t&&(lt.current=window.setTimeout(()=>Nn(null),3200))},ns=(t,r)=>{const a=t.runtimeMinutes??0,c=oe??t.genres??[],u=nn==="series"||t.type==="series",h=c.map(b=>b.toLowerCase());return r==="like"?h.some(b=>b.includes("horror")||b.includes("thriller"))?"We’ll show more intense picks like this.":h.some(b=>b.includes("comedy"))?"We’ll show more light and funny picks like this.":u?"Nice — we’ll bring in more series that match this vibe.":He!=null&&Q(He)!=null&&Q(He)>=7.5?"Nice pick — we’ll show more highly rated titles like this.":t.friendLikesCount&&t.friendLikesCount>=3?"Your friends are into this — we’ll pull in more friend-favorites.":"Got it — we’ll keep tuning around this kind of title.":r==="dislike"?u?"Looks like this series isn’t your thing — we’ll dial down similar shows.":a>130&&Ir+1>=3?"You’ve skipped a few long movies — we’ll lean toward shorter runtimes.":a>130?"Noted — we’ll be more careful with super long movies.":"Okay, we’ll dial down similar titles in your feed.":r==="skip"?"We’ll move this out of your way and keep the feed feeling fresh.":null},Ce=(t,r=0,a=null)=>{if(!l||!$)return;const c=`${$.deckId??"unknown"}:${$.id}`;if(vn.current.has(c)){Ze("That swipe was already saved. Back is for review only."),zt(!0);return}if(vn.current.add(c),z(!1),typeof window<"u"&&qe(yt,"1"),Jr(l,t),je({card:$,direction:t,action:a}),a==="more_like_this"?Ze("Locked in — we’ll prioritize more picks like this."):a==="not_interested"&&Ze("Noted — we’ll keep this out of your deck for a while."),t==="dislike"&&(l.runtimeMinutes??0)>130?kn(v=>v+1):kn(0),Tr(v=>{const I=v+1,O=ns(l,t);return O&&I>=4&&I%4===0?Ze(O):Ze(null),I}),t==="skip"){const v=ce.current;v&&(v.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",v.style.transform="perspective(1400px) translateX(0px) translateY(4px) scale(1.03) rotateZ(-1deg)",window.setTimeout(()=>{v.style.transform="perspective(1400px) translateX(0px) translateY(24px) scale(0.95)"},16),v.style.opacity="0");const I=.4;Ot("skip",I),Ln(t,I),window.setTimeout(()=>{ke(O=>Math.min(O+1,N.length)),v&&(v.style.transition="none",v.style.transform="translateX(0px) translateY(0px) scale(1)",v.style.opacity="1")},220);return}const u=t==="like"?1:-1,h=typeof window<"u"?window.innerWidth+240:Qs,b=Math.abs(r),p=f(b/1.35,0,1),C=f(b*260,0,280),B=(h+C)*u,T=f(Math.round(260-p*110),140,260),M=ce.current;if(M){const v=f((.5-ye.current)*2,-1,1),I=v<0?-1:1,O=.55+.45*Math.abs(v),J=f((ve.current-.5)*2,-1,1);M.style.transformOrigin=`${(ve.current*100).toFixed(1)}% ${(ye.current*100).toFixed(1)}%`;const Y=Et.current,K=B/hr*O*I,ie=Y?0:f(K*(1+p*.12),-24,24),me=Y?0:f(u*(10+p*12)+-J*(4+p*3),-22,22),pe=Y?0:f(v*(4+p*2),-8,8),et=-4-p*14,X=1.04+p*.04,V=Y?1:1+p*.025,fe=Y?1:1-p*.018;M.style.transition=`transform ${T}ms cubic-bezier(0.22,0.61,0.36,1)`,M.style.transform=`
        perspective(1400px)
        translate3d(${B}px, ${et}px, 0px)
        rotateX(${pe}deg)
        rotateY(${me}deg)
        rotateZ(${ie}deg)
        scale3d(${(X*V).toFixed(4)}, ${(X*fe).toFixed(4)}, 1)
      `}const P=Math.abs(Ve.current)+Math.abs(r)*220,S=f(P/520,.25,1);Br(t,S),Ot("commit",S),Ln(t,S),window.setTimeout(()=>{ke(v=>Math.min(v+1,N.length)),window.requestAnimationFrame(()=>zt(!1))},T)},rs=(t,r,a,c,u,h,b,p)=>{if(!l||!$||ge.current!=null||u==="touch"&&!h||u==="touch"&&typeof b=="number"&&typeof p=="number"&&b>55&&p>55)return;const B=c instanceof HTMLElement&&!!c.closest('button, a, input, textarea, select, [data-swipe-interactive="true"][role="button"], [data-swipe-interactive="true"][tabindex]:not([tabindex="-1"])');if(Zn.current=B,B)return;Oe.current=!0,ge.current=a,xe.current=null;try{ce.current?.setPointerCapture(a)}catch{}de.current=t,ue.current=r;const T=ce.current;if(T){const P=T.getBoundingClientRect();P.width>0&&P.height>0?(Se.current={w:P.width,h:P.height},ve.current=f((t-P.left)/P.width,0,1),ye.current=f((r-P.top)/P.height,0,1)):(ve.current=.5,ye.current=.5)}else ve.current=.5,ye.current=.5;De.current=0,Re.current=0,Ve.current=0,$e.current=0,mt.current=null,we.current=t,se.current=performance.now(),ft.current=se.current,Z.current=0;const M=Ee&&Vt.current&&Vt.current.contains(c);Qt.current=!!M},ss=(t,r,a,c,u,h,b)=>{if(ge.current!=null&&a!==ge.current||!Oe.current||de.current===null||ue.current===null||c==="touch"&&!u||c==="touch"&&typeof h=="number"&&typeof b=="number"&&h>55&&b>55)return;const p=performance.now(),C=t-de.current,B=r-ue.current;if(!g.current&&xe.current==null){const X=Math.abs(C),V=Math.abs(B);if(X<xn&&V<xn)return;if(V>X*Ks){Oe.current=!1,ge.current=null,xe.current="y",de.current=null,ue.current=null,we.current=null,se.current=null,Z.current=0;return}xe.current="x",m(!0),g.current=!0,de.current=t-Math.sign(C)*xn,ue.current=r,we.current=t,se.current=p,Z.current=0,Pt.current&&Pn();const fe=ce.current;if(fe)try{fe.setPointerCapture(a)}catch{}}if(!g.current||de.current===null)return;const T=t-de.current,M=Ge.current?.96:1,P=Nt(Se.current.w,M),S=pr(Se.current.w,M),v=ue.current!=null?r-ue.current:0,I=Math.abs(T),O=Math.abs(v),J=f((I-O*Hs)/Math.max(1,S),0,1),Y=f(1-J*.75-I/Math.max(1,P)*.22,Gs,1),K=v*Y,ie=f((I-S*.55)/Math.max(1,S*.75),0,1),me=T+Math.sign(T)*hn*.18*ie;De.current=me,Re.current=f(K,-70,70);let pe=null;if(me>S?pe="like":me<-S&&(pe="dislike"),pe&&pe!==pt.current&&(Ot("threshold",.6),Qr()),pt.current=pe,we.current!==null&&se.current!==null){const X=p-se.current;if(X>0){const V=(t-we.current)/X,fe=f(V,-2.5,2.5);Z.current=Z.current*.75+fe*.25}}if(we.current=t,se.current=p,be.current!=null)return;const et=()=>{be.current=null;const X=f(W.dragFollowAlpha,.08,1);let V=De.current;if(Oe.current&&g.current&&se.current!=null){const fe=(typeof performance<"u"?performance.now():Date.now())-se.current;if(fe>fr){const on=f((fe-fr)/260,0,1),Ut=Math.abs(V);if(Ut>S*.45&&Ut<P*.86){const cn=Math.sign(V)*Math.min(S*.92,P*.84),dn=f(cn-V,-hn,hn);V=V+dn*on}}}$e.current=$e.current+(V-$e.current)*X,xt($e.current),Oe.current&&g.current&&xe.current==="x"&&(be.current=window.requestAnimationFrame(et))};be.current=window.requestAnimationFrame(et)},er=(t,r,a)=>{if(ge.current!=null&&t!==ge.current)return;const c=g.current;m(!1),g.current=!1,Oe.current=!1;const u=ge.current;ge.current=null,be.current!=null&&(cancelAnimationFrame(be.current),be.current=null,xt($e.current));const h=t??u;if(h!=null)try{ce.current?.releasePointerCapture(h)}catch{}if(!c){const I=xe.current==="y",O=de.current,J=ue.current,Y=O!=null&&r!=null?r-O:0,K=J!=null&&a!=null?a-J:0,ie=ft.current!=null?performance.now()-ft.current:null,me=!I&&Math.abs(Y)<10&&Math.abs(K)<10&&(ie==null||ie<280)&&!Zn.current;de.current=null,ue.current=null,we.current=null,se.current=null,Z.current=0,ft.current=null,De.current=0,Re.current=0,xe.current=null,ve.current=.5,ye.current=.5,pt.current=null,me&&!(Ee&&Qt.current)&&(Rt(pe=>!pe),Ft(!1));return}ft.current=null;const p=f(Ve.current,-vt,vt)+Z.current*W.velocityProjectionMs,C=Ee&&Qt.current,B=Ge.current?.96:1,T=Nt(Se.current.w,B),M=C?T*1.6:T,P=Ge.current?xr*.92:xr,S=C?P*1.4:P,v=Math.abs(p)>=M||Math.abs(Z.current)>=S;if(de.current=null,ue.current=null,we.current=null,se.current=null,De.current=0,Re.current=0,$e.current=0,mt.current=null,xe.current=null,v){Ce(p>=0?"like":"dislike",Z.current),pt.current=null,Z.current=0;return}Ot("snap",f(Math.abs(Z.current)/1.35,.25,.9)),zt(!0,Z.current)},Be=!l||q||ae||d,tr=typeof l?.friendLikesCount=="number"?l.friendLikesCount:0,is=Pe>0?Math.round(tr/Math.max(1,Pe)*100):0;i.useEffect(()=>{const t=r=>{!l||Be||d||(r.key==="ArrowLeft"?(r.preventDefault(),Ce("dislike")):r.key==="ArrowRight"?(r.preventDefault(),Ce("like")):(r.key==="ArrowDown"||r.key===" ")&&(r.preventDefault(),Ce("skip")))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[l,Be,d]);const as=()=>{if(!Fr||!at)return null;const t=at.direction==="like"?"Loved it":at.direction==="dislike"?"Marked as ‘No thanks’":"Saved for ‘Not now’";return e.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-4 z-40 flex justify-center page-pad",children:e.jsxs("div",{className:"pointer-events-auto inline-flex items-center gap-3 rounded-md border border-border bg-background/95 px-3 py-2 text-[12px] text-foreground shadow-lg backdrop-blur",children:[e.jsx("span",{children:t}),e.jsx("button",{type:"button","aria-label":"Back to previous card",onClick:ts,className:"text-xs font-semibold uppercase tracking-[0.14em] text-primary hover:text-primary/80",children:"Back"})]})})},ls=()=>jn?e.jsx("div",{className:"pointer-events-none absolute inset-x-0 top-2 z-30 flex justify-center page-pad",children:e.jsxs("div",{className:"pointer-events-auto inline-flex max-w-md items-start gap-2 rounded-md border border-border bg-background/95 px-3 py-2 text-xs text-muted-foreground shadow-lg backdrop-blur",children:[e.jsx(k,{name:"auto_awesome",className:"mt-0.5 text-[18px] text-primary"}),e.jsx("span",{children:jn})]})}):null,ht=typeof l?.imdbRating=="number"&&!Number.isNaN(l.imdbRating)?l.imdbRating:typeof L?.imdb_rating=="number"&&!Number.isNaN(L.imdb_rating)?L.imdb_rating:Q(L?.imdb_rating),bt=typeof l?.rtTomatoMeter=="number"&&!Number.isNaN(l.rtTomatoMeter)?l.rtTomatoMeter:typeof L?.rt_tomato_pct=="number"&&!Number.isNaN(L.rt_tomato_pct)?L.rt_tomato_pct:Q(L?.rt_tomato_pct),an=i.useMemo(()=>br({card:l??null,friendCount:Pe,imdb:ht??null,rt:bt??null}),[l,Pe,ht,bt]),Je=l?(()=>{const t=[];if(l.year&&t.push(String(l.year)),ht!=null&&Q(ht)!=null&&t.push(`IMDb ${String(Q(ht)?.toFixed(1))}`),bt!=null&&Q(bt)!=null&&t.push(`RT ${Math.round(Number(bt))}%`),typeof l.runtimeMinutes=="number"&&l.runtimeMinutes>0){const r=cr(l.runtimeMinutes);r&&t.push(r)}return t.join(" • ")})():"",ln=i.useMemo(()=>{const t=nn??l?.type??null;return t==="series"?"SERIES":t==="anime"?"ANIME":"MOVIE"},[nn,l?.type]),nr=i.useMemo(()=>{const t=oe??l?.genres??null;return(Array.isArray(t)?t:t?String(t).split(",").map(a=>a.trim()).filter(Boolean):[]).map(a=>String(a??"").trim()).filter(Boolean).slice(0,3)},[oe,l?.genres]),os=t=>{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||d)return;const r=ce.current;if(!r)return;const a=r.getBoundingClientRect(),c=(t.clientX-a.left)/a.width,u=(t.clientY-a.top)/a.height;Ke.current={x:(c-.5)*2,y:(u-.5)*2},xt(De.current)},cs=()=>{d||(Ke.current={x:0,y:0},xt(Ve.current,!0))};return e.jsxs("div",{"data-reduce-motion":Or?"1":"0",className:"relative flex flex-1 min-h-0 flex-col overflow-hidden overscroll-none h-[calc(100dvh-(5.5rem+env(safe-area-inset-bottom)))]",style:Js,children:[e.jsx("style",{children:Zs}),l?.posterUrl&&e.jsxs("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 -z-10",style:{backgroundImage:`url(${l.posterUrl})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-background/40 via-background/70 to-background"}),e.jsx("div",{className:"absolute inset-0 backdrop-blur-2xl"})]}),ls(),e.jsxs("div",{className:"relative z-10 flex shrink-0 flex-col gap-[calc(var(--mn-swipe-pad)*0.75)] px-[var(--mn-swipe-pad)] pt-[calc(env(safe-area-inset-top)+var(--mn-swipe-pad)*0.75)]",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:()=>R(!0),className:"inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center text-muted-foreground/90 transition-colors hover:text-foreground","aria-label":"Filters",children:e.jsx(k,{name:"tune",className:"text-[length:var(--mn-swipe-top-icon)]"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold tracking-[0.25em] text-primary/90",children:"DISCOVERY"}),e.jsx("div",{className:"text-[length:var(--mn-swipe-header)] font-semibold text-foreground",children:"For You"})]}),e.jsxs("button",{type:"button",onClick:()=>n("/activity"),className:"relative inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center text-muted-foreground/90 transition-colors hover:text-foreground","aria-label":"Activity",children:[e.jsx(k,{name:"notifications",className:"text-[length:var(--mn-swipe-top-icon)]"}),e.jsx("span",{"aria-hidden":"true",className:"absolute right-[8px] top-[8px] h-2 w-2 rounded-full bg-primary"})]})]}),e.jsx(qs,{message:_t,onRetry:H,isRetrying:Mt})]}),e.jsxs("div",{className:"relative z-10 flex flex-1 min-h-0 flex-col overflow-visible px-[var(--mn-swipe-pad)]",children:[e.jsxs("div",{className:"relative flex flex-1 min-h-0 items-center justify-center overflow-visible [perspective:1400px]","aria-live":"polite",children:[q&&!l&&!ae&&e.jsx(js,{}),ae&&!q&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(k,{name:"info",className:"text-[32px] text-amber-400"}),e.jsx("p",{children:"We couldn't load your swipe deck."}),e.jsx("button",{type:"button",onClick:()=>ze(32),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Retry"})]}),!q&&!ae&&!l&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(k,{name:"auto_awesome",className:"text-[32px] text-primary"}),e.jsx("p",{children:"All caught up. New cards will appear soon."}),e.jsx("button",{type:"button",onClick:()=>ze(36),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Refresh deck"})]}),!q&&l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative z-10 mx-auto h-full max-h-[720px] w-full max-w-md",children:[le&&e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0",children:(()=>{const t=le;if(!t)return null;const r=typeof t.friendLikesCount=="number"?t.friendLikesCount:Array.isArray(t.friendProfiles)?t.friendProfiles.length:0,a=Pe>0?Math.round(r/Math.max(1,Pe)*100):0,c=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)?t.imdbRating:Pr??null,u=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)?t.rtTomatoMeter:Er??null,h=br({card:t,friendCount:Pe,imdb:c,rt:u}),b=(()=>{const p=Array.isArray(t.genres)?t.genres:[],C=ct?.omdb_genre!=null?String(ct.omdb_genre).split(",").map(T=>T.trim()).filter(Boolean):[];return(p.length>0?p:C).map(T=>String(T??"").trim()).filter(Boolean).slice(0,3)})();return e.jsx("div",{ref:Qn,className:"absolute inset-0",style:{filter:"brightness(0.68) saturate(0.9)",willChange:"filter"},children:e.jsx("div",{className:"relative h-full w-full rounded-[var(--mn-swipe-radius)] bg-gradient-to-b from-white/10 via-primary/25 to-white/10 p-[1.25px] shadow-[0_30px_90px_rgba(0,0,0,0.75)]",children:e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-[var(--mn-swipe-radius)] bg-background/20 backdrop-blur-sm",children:[Ht&&t.posterUrl?e.jsx("img",{src:t.posterUrl,alt:Wt(t)??`${t.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>Ye(t.id,!0)}):e.jsx("div",{className:"h-full w-full",children:e.jsx(fn,{title:t.title})}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/20 to-black/70"}),t.source==="from-friends"&&e.jsx("div",{className:"absolute left-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)]",children:(()=>{const p=t.topFriendName??t.friendProfiles?.[0]?.display_name??t.friendProfiles?.[0]?.username??"",C=Math.max(0,r-1),B=!!p,T=(p.trim().charAt(0)||"F").toUpperCase();return e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-black/30 px-2.5 py-2 shadow-sm backdrop-blur-md",children:[e.jsx("div",{className:"grid h-10 w-10 place-items-center overflow-hidden rounded-full border border-white/20 bg-white/10 text-sm font-semibold text-white/90",children:B&&t.friendProfiles?.[0]?.avatar_url?e.jsx("img",{src:t.friendProfiles[0].avatar_url,alt:p||"Friend",className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("span",{children:T})}),C>0&&e.jsxs("div",{className:"grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-white/10 text-sm font-semibold text-white/90",children:["+",C]}),e.jsx("div",{className:"pr-1 text-sm font-semibold text-white/90",children:B?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary",children:p}),e.jsxs("span",{className:"text-white/80",children:[" ","& others watched"]})]}):e.jsx("span",{className:"text-white/80",children:"From friends"})})]})})()}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-x-0 bottom-0 h-[72%] bg-gradient-to-t from-black/85 via-black/40 to-transparent"}),e.jsxs("div",{className:"relative",children:[(()=>{const p=t.source??"for-you",C=p==="trending"?{label:"Trending",icon:"local_fire_department"}:p==="popular"?{label:"Popular",icon:"stars"}:p==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-primary/25 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-primary-foreground backdrop-blur",children:[e.jsx(k,{name:C.icon,filled:!0,className:"text-[18px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:C.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[h,"% Match"]})]})})(),e.jsx("h2",{className:"line-clamp-2 text-[length:var(--mn-swipe-title)] font-extrabold leading-[1.02] text-white",children:t.title}),Mn&&e.jsxs("p",{className:"mt-1 text-[length:var(--mn-swipe-subtitle)] font-semibold text-white/60",children:["Directed by ",Mn.split(",")[0]]}),e.jsx("div",{className:"mt-4 text-[length:var(--mn-swipe-meta)] text-white/70 whitespace-nowrap overflow-hidden text-ellipsis",children:[t.year?e.jsx("span",{children:t.year},"y"):null,c!=null?e.jsxs("span",{className:"text-white/70",children:["IMDb ",String(c.toFixed(1))]},"i"):null,u!=null?e.jsxs("span",{className:"text-white/70",children:["RT ",Math.round(u),"%"]},"r"):null,typeof t.runtimeMinutes=="number"&&t.runtimeMinutes>0?e.jsx("span",{children:cr(t.runtimeMinutes)},"t"):null].filter(Boolean).map((p,C)=>e.jsxs(ar.Fragment,{children:[C>0&&e.jsx("span",{className:"mx-1 text-white/30",children:"•"}),p]},C))}),Array.isArray(t.friendProfiles)&&t.friendProfiles.length>0&&e.jsxs("div",{className:"mt-5 flex w-full items-center justify-between gap-3 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-left backdrop-blur-md","aria-label":"Friends summary",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(lr,{profiles:t.friendProfiles,max:3,size:32}),e.jsxs("div",{className:"leading-tight",children:[e.jsxs("p",{className:"text-[length:var(--mn-swipe-subtitle)] font-extrabold text-white",children:[f(Math.round(a),0,100),"% of friends"]}),e.jsxs("p",{className:"text-sm font-semibold text-white/60",children:[t.source==="from-friends"?"watched":"liked"," ","this title"]})]})]}),e.jsx("div",{className:"grid h-[var(--mn-swipe-hit)] w-[var(--mn-swipe-hit)] place-items-center rounded-full border border-white/10 bg-white/10 text-white/70",children:e.jsx(k,{name:"chevron_right",className:"text-[length:var(--mn-swipe-top-icon)]"})})]}),b.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:b.map(p=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/10 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-white/75",children:["#",p]},p))})]})]})]})})})})()}),e.jsx("div",{className:"relative h-full w-full rounded-[var(--mn-swipe-radius)] bg-gradient-to-b from-white/10 via-primary/25 to-white/10 p-[1.25px] shadow-[0_30px_90px_rgba(0,0,0,0.75)]",children:e.jsxs("article",{ref:ce,role:"group","aria-roledescription":"Movie card","aria-label":Wt(l),className:`relative h-full w-full select-none overflow-hidden rounded-[var(--mn-swipe-radius)] bg-background/20 backdrop-blur-sm transform-gpu will-change-transform ${Ee?"ring-1 ring-primary/40":""}`,onPointerDown:t=>{t.pointerType==="mouse"&&t.button!==0||rs(t.clientX,t.clientY,t.pointerId,t.target,t.pointerType,t.isPrimary,t.width,t.height)},onPointerMove:t=>ss(t.clientX,t.clientY,t.pointerId,t.pointerType,t.isPrimary,t.width,t.height),onPointerUp:t=>er(t.pointerId,t.clientX,t.clientY),onPointerCancel:t=>er(t.pointerId,t.clientX,t.clientY),onMouseMove:os,onMouseLeave:cs,style:{touchAction:Ee?"pan-y":"none",overscrollBehavior:"contain",userSelect:"none",WebkitUserSelect:"none"},children:[e.jsx("div",{ref:Tn,"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-20 overflow-hidden"}),e.jsxs("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-[-48px] z-[1]",children:[e.jsx("div",{className:"absolute inset-0 blur-3xl bg-emerald-400/30",style:{opacity:"var(--mn-swipe-like-opacity, 0)"}}),e.jsx("div",{className:"absolute inset-0 blur-3xl bg-rose-400/30",style:{opacity:"var(--mn-swipe-nope-opacity, 0)"}})]}),e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-[19]",style:{background:"radial-gradient(circle at var(--mn-swipe-spec-x, 50%) var(--mn-swipe-spec-y, 30%), rgba(255,255,255,0.35), rgba(255,255,255,0) 55%)",opacity:"var(--mn-swipe-spec-o, 0)",mixBlendMode:"soft-light"}}),!Ee&&e.jsxs("div",{className:"relative z-[2] h-full w-full",children:[Vn&&l.posterUrl?e.jsx("img",{src:l.posterUrl,alt:Wt(l)??`${l.title} poster`,className:"h-full w-full object-cover",style:{transform:"translate3d(var(--mn-swipe-poster-parallax, 0px), var(--mn-swipe-poster-parallax-y, 0px), 0) scale(1.035)",willChange:"transform"},draggable:!1,loading:"lazy",onError:()=>it(!0)}):e.jsx("div",{className:"h-full w-full",style:{transform:"translate3d(var(--mn-swipe-poster-parallax, 0px), var(--mn-swipe-poster-parallax-y, 0px), 0) scale(1.02)",willChange:"transform"},children:e.jsx(fn,{title:l.title})}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/20 to-black/70",style:{transform:"translate3d(var(--mn-swipe-bg-parallax, 0px), 0, 0)",willChange:"transform"}}),e.jsx("div",{className:"pointer-events-none absolute inset-x-[calc(var(--mn-swipe-pad)*1.2)] top-[calc(var(--mn-swipe-pad)*0.8)] flex justify-start",children:e.jsxs("div",{className:`flex items-center gap-2 rounded-md bg-emerald-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-emerald-200 shadow-md backdrop-blur-sm ${d?"":"transition-[opacity,transform] duration-200"}`,style:{opacity:"var(--mn-swipe-like-opacity, 0)",transform:"translate3d(0,0,0) scale(var(--mn-swipe-like-scale, 0.96))"},children:[e.jsx(k,{name:"favorite",filled:!0,className:"text-[18px] text-emerald-300"}),e.jsx("span",{children:"Love it"})]})}),e.jsx("div",{className:"pointer-events-none absolute inset-x-[calc(var(--mn-swipe-pad)*1.2)] top-[calc(var(--mn-swipe-pad)*0.8)] flex justify-end",children:e.jsxs("div",{className:`flex items-center gap-2 rounded-md bg-rose-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-rose-200 shadow-md backdrop-blur-sm ${d?"":"transition-[opacity,transform] duration-200"}`,style:{opacity:"var(--mn-swipe-nope-opacity, 0)",transform:"translate3d(0,0,0) scale(var(--mn-swipe-nope-scale, 0.96))"},children:[e.jsx(k,{name:"close",className:"text-[18px] text-rose-300"}),e.jsx("span",{children:"No thanks"})]})}),l.source==="from-friends"&&e.jsx("div",{className:"absolute left-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)]",children:(()=>{const t=l.topFriendName??l.friendProfiles?.[0]?.display_name??l.friendProfiles?.[0]?.username??"",r=Math.max(0,tr-1),a=!!t,c=(t.trim().charAt(0)||"F").toUpperCase();return e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-black/30 px-2.5 py-2 shadow-sm backdrop-blur-md",children:[e.jsx("div",{className:"grid h-10 w-10 place-items-center overflow-hidden rounded-full border border-white/20 bg-white/10 text-sm font-semibold text-white/90",children:a&&l.friendProfiles?.[0]?.avatar_url?e.jsx("img",{src:l.friendProfiles[0].avatar_url,alt:t||"Friend",className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("span",{children:c})}),r>0&&e.jsxs("div",{className:"grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-white/10 text-sm font-semibold text-white/90",children:["+",r]}),e.jsx("div",{className:"pr-1 text-sm font-semibold text-white/90",children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary",children:t}),e.jsx("span",{className:"text-white/80",children:" & others watched"})]}):e.jsx("span",{className:"text-white/80",children:"From friends"})})]})})()}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-x-0 bottom-0 h-[72%] bg-gradient-to-t from-black/85 via-black/40 to-transparent"}),e.jsxs("div",{className:"relative",children:[(()=>{const t=l.source??"for-you",r=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-primary/25 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-primary-foreground backdrop-blur",children:[e.jsx(k,{name:r.icon,filled:!0,className:"text-[18px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:r.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[an,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h2",{className:"min-w-0 line-clamp-2 text-[length:var(--mn-swipe-title)] font-extrabold leading-[1.02] text-white",children:l.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:ln})]}),Le&&e.jsxs("p",{className:"mt-1 text-[length:var(--mn-swipe-subtitle)] font-semibold text-white/60",children:["Directed by ",Le.split(",")[0]]}),Je&&e.jsx("div",{className:"mt-4 text-[length:var(--mn-swipe-meta)] text-white/70 whitespace-nowrap overflow-hidden text-ellipsis",children:Je}),Array.isArray(l.friendProfiles)&&l.friendProfiles.length>0&&e.jsxs("button",{type:"button",onClick:()=>gn(!0),className:"mt-5 flex w-full items-center justify-between gap-3 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-left backdrop-blur-md","aria-label":"See friends","data-swipe-interactive":"true",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(lr,{profiles:l.friendProfiles,max:3,size:32}),e.jsxs("div",{className:"leading-tight",children:[e.jsxs("p",{className:"text-[length:var(--mn-swipe-subtitle)] font-extrabold text-white",children:[f(Math.round(is),0,100),"% of friends"]}),e.jsxs("p",{className:"text-sm font-semibold text-white/60",children:[l.source==="from-friends"?"watched":"liked"," ","this title"]})]})]}),e.jsx("div",{className:"grid h-[var(--mn-swipe-hit)] w-[var(--mn-swipe-hit)] place-items-center rounded-full border border-white/10 bg-white/10 text-white/70",children:e.jsx(k,{name:"chevron_right",className:"text-[length:var(--mn-swipe-top-icon)]"})})]}),nr.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:nr.map(t=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/10 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-white/75",children:["#",t]},t))})]})]})]}),Ee&&l&&e.jsxs("div",{className:"absolute inset-0 z-10 flex h-full flex-col",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden bg-[#261933]",children:[Vn&&l.posterUrl?e.jsx("img",{src:l.posterUrl,alt:Wt(l)??`${l.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>it(!0),style:{filter:"blur(6px) brightness(0.60)",transform:"scale(1.14)"}}):e.jsx(fn,{title:l.title}),e.jsx("div",{className:"pointer-events-none absolute inset-0 z-0 bg-gradient-to-b from-black/10 via-black/60 to-[#261933]"})]}),e.jsx("button",{type:"button",onClick:()=>Rt(!1),className:"absolute right-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)] z-20 inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/80 backdrop-blur hover:bg-white/15","aria-label":"Close details","data-swipe-interactive":"true",children:e.jsx(k,{name:"close",className:"text-[length:var(--mn-swipe-top-icon)]"})}),e.jsxs("div",{className:"relative z-10 flex min-h-0 flex-1 flex-col px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)] pt-[calc(var(--mn-swipe-top-hit)+var(--mn-swipe-pad)*0.75)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-0 bg-gradient-to-b from-[#261933]/35 via-[#261933]/90 to-[#261933]"}),e.jsxs("div",{ref:Vt,id:"swipe-detail-panel","aria-label":Ct?"Full details":"Details summary","aria-live":"polite",className:"relative z-10 mt-1 flex min-h-0 flex-1 flex-col text-left text-[13px] text-white/70",children:[e.jsx("div",{"data-swipe-interactive":"true",className:"flex min-h-0 flex-1 flex-col overflow-hidden",children:Ct?e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[e.jsxs("div",{className:"shrink-0 space-y-2",children:[(()=>{const t=l.source??"for-you",r=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.25)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/80",children:[e.jsx(k,{name:r.icon,filled:!0,className:"text-[length:calc(var(--mn-swipe-chip)+0.25rem)]"}),e.jsx("span",{className:"tracking-[0.12em]",children:r.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[an,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"min-w-0 line-clamp-1 text-[clamp(1.05rem,4.6vw,1.35rem)] font-extrabold text-white",children:l.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.7)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:ln})]}),Je&&e.jsx("p",{className:"text-[length:var(--mn-swipe-meta)] text-white/55 whitespace-nowrap overflow-hidden text-ellipsis",children:Je})]}),e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-2 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 grid grid-cols-2 gap-x-3 gap-y-2 rounded-2xl border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.5)] text-[length:var(--mn-swipe-chip)] leading-snug text-white/75",children:(()=>{const t=[];if(Wn.length>0&&t.push({label:"Genres",value:Wn.slice(0,6).join(", ")}),Xn.length>0&&t.push({label:"Languages",value:Xn.slice(0,4).join(", ")}),Le&&t.push({label:"Director",value:Le}),On&&t.push({label:"Writers",value:On}),ut){const a=ut.split(",").map(c=>c.trim()).filter(Boolean).slice(3);a.length>0&&t.push({label:"More cast",value:a.slice(0,8).join(", ")})}return qn&&t.push({label:"Released",value:qn}),$n&&t.push({label:"Awards",value:$n}),Bn&&t.push({label:"Box office",value:Bn}),He&&Q(He)!=null&&t.push({label:"IMDb",value:String(Q(He)?.toFixed(1))}),Jt&&Q(Jt)!=null&&t.push({label:"RT",value:`${String(Q(Jt))}%`}),tn&&dr(tn)&&t.push({label:"IMDb votes",value:String(dr(tn))}),en&&Q(en)!=null&&t.push({label:"Metascore",value:String(Q(en))}),t.slice(0,10).map(r=>e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.14em] text-white/45",children:r.label}),e.jsx("p",{className:"line-clamp-2",children:r.value})]},r.label))})()}),e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden rounded-2xl border border-white/10 bg-white/10 px-3 py-2",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.14em] text-white/45",children:"Overview"}),$t?e.jsx("p",{className:"mt-1 min-h-0 flex-1 overflow-hidden text-[length:var(--mn-swipe-meta)] leading-relaxed text-white/70",style:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:U,overflow:"hidden"},children:$t}):e.jsx("p",{className:"mt-1 text-[length:var(--mn-swipe-meta)] text-white/40",children:"No overview available."})]})]})]}):e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[e.jsxs("div",{className:"shrink-0 space-y-2",children:[(()=>{const t=l.source??"for-you",r=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.25)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/80",children:[e.jsx(k,{name:r.icon,filled:!0,className:"text-[length:calc(var(--mn-swipe-chip)+0.25rem)]"}),e.jsx("span",{className:"tracking-[0.12em]",children:r.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[an,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"min-w-0 line-clamp-2 text-[clamp(1.25rem,5vw,1.75rem)] font-extrabold leading-[1.06] text-white",children:l.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.7)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:ln})]}),Je&&e.jsx("p",{className:"text-[clamp(0.78rem,2.8vw,0.95rem)] text-white/60 whitespace-nowrap overflow-hidden text-ellipsis",children:Je}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 text-[clamp(0.70rem,2.6vw,0.8rem)] text-white/65",children:[oe&&e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[e.jsx("span",{className:"shrink-0 font-semibold text-white/75",children:"Genres"}),e.jsx("span",{className:"min-w-0 flex-1 truncate",children:Array.isArray(oe)?oe.slice(0,3).join(", "):String(oe).split(",").map(t=>t.trim()).slice(0,3).join(", ")})]}),Un&&e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 font-semibold text-white/85",children:Un}),Dn&&e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 font-semibold text-white/70",children:Dn})]})]}),$t?e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden rounded-2xl border border-white/10 bg-white/10 px-3 py-2",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.16em] text-white/45",children:"Overview"}),e.jsx("p",{className:"mt-1 min-h-0 flex-1 overflow-hidden text-[clamp(0.82rem,2.9vw,0.95rem)] leading-relaxed text-white/70",style:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:E,overflow:"hidden"},children:$t})]}):e.jsx("div",{className:"min-h-0 flex-1"}),Le||ut?e.jsxs("div",{className:"shrink-0 min-w-0 space-y-1 text-[clamp(0.70rem,2.6vw,0.78rem)] text-white/70",children:[Le&&e.jsxs("p",{className:"line-clamp-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-white/75",children:"Director:"})," ",e.jsx("span",{className:"min-w-0",children:Le})]}),ut&&e.jsxs("p",{className:"line-clamp-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-white/75",children:"Cast:"})," ",e.jsx("span",{className:"min-w-0",children:ut.split(",").map(t=>t.trim()).filter(Boolean).slice(0,4).join(", ")})]})]}):null,e.jsxs("div",{className:"shrink-0 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1.5",children:[e.jsx("span",{className:"text-[length:var(--mn-swipe-chip)] font-semibold text-white/50",children:"Your rating"}),e.jsx("div",{className:"flex items-center gap-0.5","aria-label":"Your rating",children:Array.from({length:5}).map((t,r)=>{const a=r+1,c=sn!=null&&sn>=a;return e.jsx("button",{type:"button",onClick:()=>Kr(a),className:"flex h-[var(--mn-swipe-star-hit)] w-[var(--mn-swipe-star-hit)] items-center justify-center rounded-full hover:scale-105 focus-visible:outline-none",children:e.jsx(k,{name:"star",filled:c,className:`text-[length:var(--mn-swipe-star-icon)] ${c?"text-yellow-400":"text-white/30"}`})},a)})})]}),e.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{type:"button",onClick:()=>Kn(Fe),className:`inline-flex items-center rounded-full px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold transition-colors ${Hn(Fe)?"bg-primary/90 text-primary-foreground":"border border-white/10 bg-white/10 text-white/75 hover:bg-white/15"}`,children:"Watchlist"}),e.jsx("button",{type:"button",onClick:()=>Kn(nt),className:`inline-flex items-center rounded-full px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold transition-colors ${Hn(nt)?"bg-emerald-500/90 text-primary-foreground":"border border-white/10 bg-white/10 text-white/75 hover:bg-white/15"}`,children:"Watched"}),e.jsxs("button",{type:"button",onClick:()=>_n(!0),className:"inline-flex items-center gap-1 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/75 hover:bg-white/15",children:[e.jsx(k,{name:"share",className:"text-[length:calc(var(--mn-swipe-chip)+0.2rem)]"}),e.jsx("span",{children:"Share"})]})]})]}),typeof l.friendLikesCount=="number"&&l.friendLikesCount>0||l.topFriendName&&l.topFriendReviewSnippet?e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.5)] text-[length:var(--mn-swipe-chip)] text-white/80 shadow-md",children:[typeof l.friendLikesCount=="number"&&l.friendLikesCount>0&&e.jsxs("div",{className:"inline-flex items-center gap-1 text-[length:var(--mn-swipe-chip)] text-white/60",children:[e.jsx(k,{name:"local_fire_department",filled:!0,className:"text-[16px] text-primary/80"}),l.friendLikesCount===1?"1 friend likes this":`${l.friendLikesCount} friends like this`]}),l.topFriendName&&l.topFriendReviewSnippet&&e.jsxs("div",{className:"mt-1 inline-flex w-full items-start gap-2 text-left",children:[e.jsx(k,{name:"check_circle",filled:!0,className:"mt-0.5 text-[16px] text-primary"}),e.jsxs("span",{className:"block line-clamp-2 text-[length:var(--mn-swipe-chip)]",children:[l.topFriendName,": “",l.topFriendReviewSnippet,"”"]})]})]}):null]})]})}),e.jsx("div",{className:"mt-2 flex shrink-0 justify-end",children:e.jsx("button",{type:"button",onClick:()=>Ft(t=>!t),"aria-expanded":Ct,"aria-controls":"swipe-detail-panel",className:"inline-flex items-center gap-1 rounded-full border border-white/15 bg-white/5 px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/70 hover:bg-white/10 hover:text-white",children:e.jsx("span",{children:Ct?"Collapse":"Full details"})})})]})]})]})]},re??"empty")})]}),D&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center bg-gradient-to-b from-background/70 via-background/50 to-background/80",children:e.jsxs("div",{className:"pointer-events-auto max-w-xs rounded-2xl border border-border bg-background/95 p-4 text-center shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Swipe to decide"}),e.jsx("p",{className:"mt-1 text-[12px] text-muted-foreground",children:"Swipe left to pass, right to save what you love."}),e.jsx("button",{type:"button",className:"mt-3 w-full rounded-xl bg-primary px-3 py-2 text-sm font-semibold text-white shadow-md",onClick:()=>{z(!1),typeof window<"u"&&qe(yt,"1")},children:"Got it"})]})})]})]}),e.jsxs("div",{className:"mt-3 flex shrink-0 items-center justify-center gap-2","aria-label":"Recommendation feedback",children:[e.jsxs("button",{type:"button",onClick:()=>Ce("dislike",0,"not_interested"),disabled:Be,className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1.5 text-xs font-semibold text-white/70 shadow-sm backdrop-blur transition-all duration-150 hover:bg-white/10 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Not interested",children:[e.jsx(k,{name:"thumb_down",filled:!0,className:"text-[16px]"}),"Not interested"]}),e.jsxs("button",{type:"button",onClick:()=>Ce("like",0,"more_like_this"),disabled:Be,className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1.5 text-xs font-semibold text-white/70 shadow-sm backdrop-blur transition-all duration-150 hover:bg-white/10 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"More like this",children:[e.jsx(k,{name:"auto_awesome",filled:!0,className:"text-[16px]"}),"More like this"]})]}),e.jsxs("div",{className:"mt-2 flex shrink-0 items-center justify-center gap-[var(--mn-swipe-gap)]","aria-label":"Swipe actions",children:[e.jsx("button",{type:"button",onClick:()=>Ce("dislike"),disabled:Be,className:"inline-flex h-[var(--mn-swipe-action)] w-[var(--mn-swipe-action)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/60 shadow-md backdrop-blur transition-all duration-150 hover:bg-white/15 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Dislike",children:e.jsx(k,{name:"close",className:"text-[length:var(--mn-swipe-icon)]"})}),e.jsx("button",{type:"button",onClick:Wr,disabled:Be,className:"relative inline-flex h-[var(--mn-swipe-action-primary)] w-[var(--mn-swipe-action-primary)] items-center justify-center rounded-full bg-primary text-primary-foreground shadow-[0_22px_55px_rgba(0,0,0,0.55)] transition-all duration-150 hover:brightness-110 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Add to watchlist",children:e.jsx(k,{name:"bookmark_add",filled:!0,className:"text-[length:var(--mn-swipe-icon-primary)]"})}),e.jsx("button",{type:"button",onClick:()=>Ce("like"),disabled:Be,className:"inline-flex h-[var(--mn-swipe-action)] w-[var(--mn-swipe-action)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/60 shadow-md backdrop-blur transition-all duration-150 hover:bg-white/15 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Like",children:e.jsx(k,{name:"favorite",filled:!0,className:"text-[length:var(--mn-swipe-icon)]"})})]}),e.jsx(ni,{isOpen:Ar,onClose:()=>_n(!1),activeCard:l,shareUrl:Hr,onShareExternal:Gr}),e.jsx(Us,{open:Cr,onOpenChange:gn,profiles:l?.friendProfiles??[],verb:l?.source==="from-friends"?"watched":"liked"}),e.jsx(Nr,{open:x,onOpenChange:R,children:e.jsxs(kr,{className:"max-w-md border border-border/60 bg-card text-foreground",children:[e.jsxs(_r,{children:[e.jsx(Mr,{children:"Filters"}),e.jsx(Ms,{className:"text-muted-foreground",children:"Fine-tune what shows up in your Discovery deck."})]}),e.jsxs("div",{className:"mt-2 space-y-5",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs font-semibold tracking-wide text-muted-foreground",children:"Feedback"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>An(t=>!t),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",Xe?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[e.jsx(k,{name:"vibration",filled:!0,className:"text-[18px] "+(Xe?"text-primary":"text-muted-foreground")}),"Haptics"]}),e.jsxs("button",{type:"button",onClick:()=>In(t=>!t),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",We?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[e.jsx(k,{name:We?"volume_up":"volume_off",filled:!0,className:"text-[18px] "+(We?"text-primary":"text-muted-foreground")}),"Sound"]})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Turn these off if you prefer silent, minimal feedback."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs font-semibold tracking-wide text-muted-foreground",children:"Content type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{label:"All",value:null},{label:"Movies",value:"movie"},{label:"Series",value:"series"},{label:"Anime",value:"anime"}].map(t=>{const r=s===t.value;return e.jsxs("button",{type:"button",onClick:()=>o(t.value),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",r?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[r?e.jsx(k,{name:"check_circle",filled:!0,className:"text-[18px] text-primary"}):e.jsx("span",{className:"h-4 w-4"}),t.label]},t.label)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide text-muted-foreground",children:"Genres"}),w.length>0&&e.jsx("button",{type:"button",onClick:()=>j([]),className:"text-xs font-semibold text-primary hover:underline",children:"Clear"})]}),St.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Load a few cards to unlock genre filters."}):e.jsx("div",{className:"max-h-40 overflow-auto rounded-xl border border-border/60 bg-background/20 p-2",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:St.map(t=>{const r=w.some(a=>a.toLowerCase()===t.toLowerCase());return e.jsx("button",{type:"button",onClick:()=>j(a=>r?a.filter(c=>c.toLowerCase()!==t.toLowerCase()):[...a,t]),className:["rounded-full border px-3 py-1 text-xs font-semibold transition",r?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-card/40 text-muted-foreground hover:bg-card/55"].join(" "),children:t},t)})})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide text-muted-foreground",children:"Minimum rating"}),e.jsx("div",{className:"text-xs font-semibold text-foreground",children:_<=0?"Any":_.toFixed(1)})]}),e.jsx("input",{type:"range",min:0,max:10,step:.5,value:_,onChange:t=>y(Number(t.target.value)),className:"w-full"}),e.jsxs("div",{className:"mt-1 flex justify-between text-[11px] text-muted-foreground",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"10"})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{o(null),j([]),y(0)},className:"flex-1 rounded-xl border border-border/60 bg-background/20 px-4 py-2 text-sm font-semibold text-muted-foreground hover:bg-background/35",children:"Reset"}),e.jsx("button",{type:"button",onClick:()=>R(!1),className:"flex-1 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground hover:opacity-90",children:"Done"})]})]})]})}),as()]})]})},ni=({isOpen:n,onClose:s,activeCard:o,shareUrl:x,onShareExternal:R})=>{const{user:w}=jr(),{data:j=[],isLoading:_}=Ns();if(i.useEffect(()=>{if(!n)return;const E=U=>{U.key==="Escape"&&s()};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[n,s]),!n||!o)return null;const y=`Check this out: ${o.title}

${x}`,F=E=>{E.target===E.currentTarget&&s()},A=E=>{(E.key==="Enter"||E.key===" ")&&s()};return e.jsx("div",{role:"button",tabIndex:0,className:"fixed inset-0 z-[9999] flex flex-col justify-end bg-black/55",onClick:F,onKeyDown:A,children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"pointer-events-auto mb-[72px] w-full max-w-md self-center rounded-t-2xl bg-card pb-3 pt-2 shadow-[0_-18px_45px_rgba(0,0,0,0.65)]",children:[e.jsxs("div",{className:"flex items-center justify-between px-[var(--page-pad-x)] pb-2",children:[e.jsx("button",{type:"button","aria-hidden":"true",tabIndex:-1,className:"inline-flex h-11 w-11 items-center justify-center rounded-full text-muted-foreground",children:e.jsx(k,{name:"search",className:"text-[18px]"})}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Send to"}),e.jsx("button",{type:"button",onClick:s,"aria-label":"Close",className:"inline-flex h-11 w-11 items-center justify-center rounded-full text-muted-foreground transition hover:bg-background/80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:e.jsx("span",{className:"text-[18px] leading-none",children:"×"})})]}),e.jsxs("section",{className:"border-t border-border px-[var(--page-pad-x)] pt-3 pb-2",children:[e.jsx("h2",{className:"mb-2 text-[12px] font-medium uppercase tracking-[0.08em] text-muted-foreground/90",children:"Send to"}),_?e.jsx("div",{className:"flex gap-3 overflow-hidden",children:Array.from({length:4}).map((E,U)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"h-11 w-11 animate-pulse rounded-full bg-border/50"}),e.jsx("div",{className:"h-2.5 w-12 animate-pulse rounded bg-border/40"})]},U))}):w?j.length===0?e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"No conversations yet. Start a chat from a profile or the Messages tab."}):e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:j.map(E=>e.jsx(ri,{conversation:E,text:y},E.id))}):e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"Sign in to share via messages."})]}),e.jsx("section",{className:"border-t border-border px-[var(--page-pad-x)] pt-3 pb-3",children:e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:[e.jsx(ii,{shareUrl:x,title:o.title}),e.jsx(ai,{shareUrl:x,title:o.title}),e.jsx(li,{onShareExternal:R}),e.jsx(si,{shareUrl:x})]})})]})})},ri=({conversation:n,text:s})=>{const o=n.isGroup?null:n.participants?.find(y=>!y.isSelf)??n.participants?.[0],x=o?.displayName??n.title??"Conversation",R=o?.avatarUrl,w=_s(n.id),j=()=>{w.isPending||w.mutate({text:s})},_=x.split(" ").map(y=>y.charAt(0).toUpperCase()).slice(0,2).join("");return e.jsxs("button",{type:"button",onClick:j,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center overflow-hidden rounded-full bg-muted text-xs text-muted-foreground",children:R?e.jsx("img",{src:R,alt:x,className:"h-full w-full object-cover"}):e.jsx("span",{children:_})}),w.isSuccess&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-emerald-500",children:e.jsx(k,{name:"check",filled:!0,className:"text-[14px] text-primary-foreground"})})]}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:x})]})},si=({shareUrl:n})=>{const s=async()=>{if(navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(n)}catch{}};return e.jsxs("button",{type:"button",onClick:s,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx(k,{name:"link",className:"text-[18px] text-primary-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Copy link"})]})},ii=({shareUrl:n,title:s})=>{const o=()=>{if(typeof window>"u")return;const x=`Check this out: ${s}

${n}`,R=`https://api.whatsapp.com/send?text=${encodeURIComponent(x)}`;window.open(R,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:o,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"W"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"WhatsApp"})]})},ai=({shareUrl:n,title:s})=>{const o=()=>{if(typeof window>"u")return;const x=`Check this out: ${s}

${n}`,R=`https://t.me/share/url?url=${encodeURIComponent(n)}&text=${encodeURIComponent(x)}`;window.open(R,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:o,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"T"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Telegram"})]})},li=({onShareExternal:n})=>{const s=async()=>{await n()};return e.jsxs("button",{type:"button",onClick:s,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full border border-border bg-muted",children:e.jsx(k,{name:"more_horiz",className:"text-[18px] text-muted-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"More"})]})};export{Mi as default};
