import{j as e,S as U,b as L,a8 as E,s as _,d as S,J as k,u as T,K as $,R as F,L as q,B as A}from"./index-n01z0Q-I.js";import{Y as M}from"./index-BFhhJZnO.js";import{T as P}from"./TopBar-CK7Fj6a4.js";import{V as R}from"./VerifiedBadge-BK7Fjn_d.js";import{u as V}from"./useToggleFollow-BHNH-TO0.js";import{U as O,a as z}from"./user-plus-ot4xISeF.js";const I=({className:r="",...t})=>e.jsxs("div",{className:`flex h-11 flex-1 items-center gap-2 rounded-full border border-border/60 bg-background/80 px-3 text-sm shadow-sm transition focus-within:border-primary/60 focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2 focus-within:ring-offset-background ${r}`,children:[e.jsx(U,{className:"h-3.5 w-3.5 text-muted-foreground","aria-hidden":"true"}),e.jsx("input",{...t,className:"h-full flex-1 border-none bg-transparent p-0 text-sm text-foreground outline-none placeholder:text-muted-foreground focus-visible:outline-none"})]}),B=25,Q=r=>{if(!r)return null;const t=r.trim();return t?t.startsWith("@")?t:`@${t}`:null};function Y(r,t){const{user:i}=L(),m=i?.id??null;return E({queryKey:["connections",r??null,t,m],enabled:!!r,initialPageParam:0,getNextPageParam:s=>s.nextOffset,queryFn:async({pageParam:s})=>{const c=typeof s=="number"?s:0;if(!r)return{items:[]};const w=_.from("follows").select("follower_id, followed_id, created_at").order("created_at",{ascending:!1}),{data:n,error:u}=await(t==="followers"?w.eq("followed_id",r):w.eq("follower_id",r)).range(c,c+B-1);if(u)throw new Error(u.message);const v=n??[],f=v.map(a=>t==="followers"?a.follower_id:a.followed_id);if(f.length===0)return{items:[]};const{data:p,error:x}=await _.from("profiles_public").select("id, username, display_name, avatar_url, bio, is_verified, verified_type, verified_label, verified_at, verified_by_org").in("id",f);if(x)throw new Error(x.message);const j=p??[],g=new Map(j.map(a=>[a.id,a])),y=await Promise.all(f.map(a=>S(typeof g.get(a)?.avatar_url=="string"?g.get(a).avatar_url:null)));let b=new Set;if(m){const{data:a,error:N}=await _.from("follows").select("followed_id").eq("follower_id",m).in("followed_id",f);N||(b=new Set((a??[]).map(d=>d.followed_id)))}const l=f.map((a,N)=>{const d=g.get(a);return{id:a,username:d?.username??null,displayName:d?.display_name??null,avatarUrl:y[N]??null,bio:d?.bio??null,isVerified:d?.is_verified??null,verifiedType:d?.verified_type??null,verifiedLabel:d?.verified_label??null,verifiedAt:d?.verified_at??null,verifiedByOrg:d?.verified_by_org??null,isFollowing:b.has(a)}}),o=v.length===B?c+B:void 0;return{items:l,nextOffset:o}}})}const C=Q,H=(r,t)=>{const i=(r??t??"?").replace(/^@/,"").trim();return i?i[0]?.toUpperCase():"?"};function K({person:r,viewerId:t,onToggleFollow:i,isToggling:m}){const s=r.displayName??r.username??"Unknown user",c=C(r.username),h=!!(t&&t===r.id);return e.jsxs("div",{className:"soft-row-card mx-2 my-1 flex min-h-11 items-center justify-between gap-3 row-pad",children:[e.jsxs(q,{to:r.username?`/u/${r.username}`:`/u/${r.id}`,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center overflow-hidden rounded-full bg-card/80 text-[14px] font-semibold text-foreground",children:r.avatarUrl?e.jsx("img",{src:r.avatarUrl,alt:s,className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx("span",{children:H(r.displayName,r.username)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",children:s}),r.isVerified?e.jsx(R,{isVerified:r.isVerified??null,type:r.verifiedType??null,label:r.verifiedLabel??null,verifiedAt:r.verifiedAt??null,org:r.verifiedByOrg??null}):null,h&&e.jsx("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] text-muted-foreground",children:"You"})]}),c&&e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:c}),r.bio&&e.jsx("p",{className:"mt-0.5 line-clamp-2 text-xs text-muted-foreground",children:r.bio})]})]}),!h&&e.jsx(A,{type:"button",size:"sm",variant:r.isFollowing?"outline":"default",className:"h-10 rounded-full px-3 text-xs",onClick:()=>i(r.id,r.isFollowing),disabled:m,children:m?e.jsx("span",{children:"…"}):r.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})})]})}const ee=({mode:r})=>{const{username:t}=k(),i=T(),{user:m}=L(),s=V(),{data:c,isLoading:h,isError:w}=$(t??""),n=Y(c?.id??null,r),[u,v]=F.useState(""),f=F.useMemo(()=>(n.data?.pages??[]).flatMap(l=>l.items),[n.data?.pages]),p=F.useMemo(()=>{const l=u.trim().toLowerCase();return l?f.filter(o=>[o.displayName,o.username,C(o.username),o.bio].filter(Boolean).join(" ").toLowerCase().includes(l)):f},[f,u]),x=r==="followers"?"Followers":"Following",j=(l,o)=>{s.mutate({targetUserId:l,currentlyFollowing:o})},g=s.isPending?s.variables?.targetUserId:null,y=!!(n.hasNextPage&&!n.isFetchingNextPage),b=()=>{y&&(u.trim()||n.fetchNextPage())};return h?e.jsxs("div",{className:"flex flex-1 flex-col gap-[var(--section-gap)] pb-[var(--page-pad-y)]",children:[e.jsx(P,{title:x,onBack:()=>i(-1)}),e.jsx("div",{className:"px-3 text-xs text-muted-foreground",children:"Loading connections…"})]}):w||!c?e.jsxs("div",{className:"flex flex-1 flex-col gap-[var(--section-gap)] pb-[var(--page-pad-y)]",children:[e.jsx(P,{title:x,onBack:()=>i(-1)}),e.jsx("div",{className:"px-3 text-xs text-muted-foreground",children:"We couldn't load this profile."})]}):e.jsxs("div",{className:"flex flex-1 flex-col gap-[var(--section-gap)] pb-[var(--page-pad-y)]",children:[e.jsx(P,{title:x,onBack:()=>i(-1)}),e.jsx("div",{className:"page-pad",children:e.jsx(I,{placeholder:`Search ${x.toLowerCase()}…`,value:u,onChange:l=>v(l.target.value)})}),e.jsx("div",{className:"flex-1 page-pad",children:e.jsx("div",{className:"overflow-hidden rounded-2xl border border-border/40 bg-background/40",children:n.isLoading?e.jsx("div",{className:"p-[var(--card-pad)] text-xs text-muted-foreground",children:"Loading…"}):p.length===0?e.jsx("div",{className:"p-[var(--card-pad)] text-xs text-muted-foreground",children:u.trim()?`No ${x.toLowerCase()} match “${u.trim()}”.`:r==="followers"?"No followers yet.":"Not following anyone yet."}):e.jsx(M,{style:{height:"100%"},data:p,endReached:b,itemContent:(l,o)=>e.jsx(K,{person:o,viewerId:m?.id??null,isToggling:!!(g&&g===o.id),onToggleFollow:j}),components:{Footer:()=>n.isFetchingNextPage?e.jsx("div",{className:"p-[var(--card-pad)] text-center text-xs text-muted-foreground",children:"Loading more…"}):n.hasNextPage?e.jsx("div",{className:"p-[var(--card-pad)] text-center text-xs text-muted-foreground",children:"Scroll for more"}):e.jsx("div",{className:"p-[var(--card-pad)] text-center text-xs text-muted-foreground",children:"End"})}})})})]})};export{ee as C};
