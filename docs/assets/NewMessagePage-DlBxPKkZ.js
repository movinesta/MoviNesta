import{u as j,b as y,r as l,j as t,C as v}from"./index-CuXsBKB-.js";import{M as r}from"./material-icon-sbzzvxfS.js";import{u as w}from"./useSearchPeople-CDP-an1K.js";import{u as k}from"./useSuggestedPeople-BEg748pz.js";const $=()=>{const d=j(),{user:o}=y(),[c,b]=l.useState(""),[s,f]=l.useState([]),[m,u]=l.useState(!1),{data:i=[]}=k(),{data:x=[]}=w(c.trim()),g=l.useMemo(()=>i.slice(0,5).map(e=>({id:e.id,displayName:e.displayName??e.username??"Unknown",subtitle:e.bio,avatarUrl:e.avatarUrl,matchLabel:typeof e.matchPercent=="number"&&e.matchPercent>0?`${e.matchPercent}% Match`:"Online"})),[i]),p=l.useMemo(()=>c.trim()?x.map(e=>({id:e.id,displayName:e.displayName??e.username??"Unknown",subtitle:e.username?`@${e.username}`:null,avatarUrl:e.avatarUrl,matchLabel:typeof e.matchPercent=="number"&&e.matchPercent>0?`${e.matchPercent}% Match`:null})):i.map(e=>({id:e.id,displayName:e.displayName??e.username??"Unknown",subtitle:e.username?`@${e.username}`:null,avatarUrl:e.avatarUrl,matchLabel:typeof e.matchPercent=="number"&&e.matchPercent>0?`${e.matchPercent}% Match`:"Available"})),[c,x,i]),h=e=>{f(a=>a.includes(e)?a.filter(n=>n!==e):[...a,e])},N=async()=>{if(!o?.id){alert("You need to be signed in to start a conversation.");return}if(s.length===0){alert("Pick someone to start a chat.");return}if(s.length>1){alert("Group chats are coming soon. Please select one person for now.");return}const e=s[0];if(o.id===e){alert("You can't start a conversation with yourself.");return}u(!0);try{const a=await v("create-direct-conversation",{targetUserId:e},{timeoutMs:25e3});if(!a?.ok||!a.conversationId){const n=a?.error??"Failed to start the conversation.";throw new Error(n)}d(`/messages/${a.conversationId}`)}catch(a){console.error("[NewMessagePage] Failed to start conversation",a),alert(a instanceof Error?a.message:"Something went wrong while starting the conversation.")}finally{u(!1)}};return t.jsx("div",{className:"min-h-screen bg-background text-foreground",children:t.jsxs("div",{className:"mx-auto flex min-h-screen w-full max-w-md flex-col border-x border-border shadow-2xl shadow-black/10",children:[t.jsxs("div",{className:"sticky top-0 z-50 flex items-center justify-between border-b border-border bg-background/90 p-4 pb-2 backdrop-blur-md",children:[t.jsx("button",{type:"button",onClick:()=>d(-1),className:"flex h-10 w-10 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/60 hover:text-foreground","aria-label":"Close",children:t.jsx(r,{name:"close",className:"text-[24px]"})}),t.jsx("h2",{className:"flex-1 text-center text-lg font-bold",children:"New Message"}),t.jsx("button",{type:"button",onClick:N,className:"flex items-center justify-center rounded-full bg-primary/10 px-4 py-2 text-sm font-bold text-primary transition-colors hover:bg-primary/20 disabled:cursor-not-allowed disabled:opacity-70",disabled:m,children:m?"Starting":"Chat"})]}),t.jsx("div",{className:"bg-background px-4 py-3",children:t.jsx("label",{htmlFor:"new-message-search",className:"flex h-12 w-full flex-col","aria-label":"Search contacts",children:t.jsxs("div",{className:"flex h-full flex-1 items-stretch rounded-xl border border-input bg-card shadow-sm",children:[t.jsx("div",{className:"flex items-center justify-center rounded-l-xl px-4 text-muted-foreground",children:t.jsx(r,{name:"search",className:"text-[24px]"})}),t.jsx("input",{id:"new-message-search",className:"h-full w-full rounded-xl rounded-l-none border-none bg-transparent px-4 pl-2 text-base text-foreground placeholder:text-muted-foreground focus:outline-none",placeholder:"Search friends or username",value:c,onChange:e=>b(e.target.value)})]})})}),t.jsx("div",{className:"pt-4",children:t.jsxs("button",{type:"button",disabled:!0,className:"group/item flex w-full items-center justify-between gap-4 px-4 py-3 text-left transition-colors hover:bg-muted/60 disabled:cursor-not-allowed disabled:opacity-60","aria-label":"Create a new group (coming soon)",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-primary/10 text-primary shadow-sm",children:t.jsx(r,{name:"group_add",className:"text-[24px]"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-base font-medium",children:"Create a new group"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Start a watch party"}),t.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Coming soon"})]})]}),t.jsx(r,{name:"chevron_right",className:"text-[24px] text-muted-foreground"})]})}),t.jsx("div",{className:"px-4 pb-2 pt-4",children:t.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider text-muted-foreground",children:"Suggested"})}),t.jsx("div",{className:"flex flex-col",children:g.map(e=>{const a=`new-message-suggested-${e.id}`;return t.jsxs("label",{htmlFor:a,"aria-label":`Select ${e.displayName}`,className:"flex min-h-16 cursor-pointer items-center justify-between gap-4 border-b border-border/60 px-4 py-3 transition-colors hover:bg-muted/60",children:[t.jsxs("div",{className:"flex flex-1 items-center gap-4 overflow-hidden",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"h-12 w-12 overflow-hidden rounded-full bg-muted shadow-sm",children:e.avatarUrl?t.jsx("img",{src:e.avatarUrl,alt:e.displayName,className:"h-full w-full object-cover"}):t.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs font-semibold text-foreground",children:e.displayName.slice(0,1).toUpperCase()})}),t.jsx("span",{className:"absolute bottom-0 right-0 h-3 w-3 rounded-full border-2 border-background bg-green-500"})]}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"truncate text-base font-medium",children:e.displayName}),e.matchLabel&&t.jsx("span",{className:"text-sm font-semibold text-primary",children:e.matchLabel})]}),e.subtitle&&t.jsx("p",{className:"mt-1 truncate text-sm text-muted-foreground",children:e.subtitle})]})]}),t.jsx("div",{className:"pl-4",children:t.jsxs("div",{className:"relative flex h-7 w-7 items-center justify-center",children:[t.jsx("input",{id:a,type:"checkbox",checked:s.includes(e.id),onChange:()=>h(e.id),className:"h-6 w-6 cursor-pointer appearance-none rounded-full border-2 border-border bg-transparent checked:border-primary checked:bg-primary"}),t.jsx(r,{name:"check",className:`absolute text-[16px] text-primary-foreground transition-opacity ${s.includes(e.id)?"opacity-100":"opacity-0"}`})]})})]},e.id)})}),t.jsx("div",{className:"px-4 pb-2 pt-6",children:t.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider text-muted-foreground",children:"All Contacts"})}),t.jsx("div",{className:"flex flex-col pb-20",children:p.map(e=>{const a=`new-message-contact-${e.id}`;return t.jsxs("label",{htmlFor:a,"aria-label":`Select ${e.displayName}`,className:"flex min-h-16 cursor-pointer items-center justify-between gap-4 border-b border-border/60 px-4 py-3 transition-colors hover:bg-muted/60",children:[t.jsxs("div",{className:"flex flex-1 items-center gap-4 overflow-hidden",children:[t.jsx("div",{className:"h-12 w-12 overflow-hidden rounded-full bg-muted shadow-sm",children:e.avatarUrl?t.jsx("img",{src:e.avatarUrl,alt:e.displayName,className:"h-full w-full object-cover"}):t.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs font-semibold text-foreground",children:e.displayName.slice(0,1).toUpperCase()})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"truncate text-base font-medium",children:e.displayName}),e.matchLabel&&t.jsx("span",{className:"text-sm font-semibold text-primary",children:e.matchLabel})]}),e.subtitle&&t.jsx("p",{className:"mt-1 truncate text-sm text-muted-foreground",children:e.subtitle})]})]}),t.jsx("div",{className:"pl-4",children:t.jsxs("div",{className:"relative flex h-7 w-7 items-center justify-center",children:[t.jsx("input",{id:a,type:"checkbox",checked:s.includes(e.id),onChange:()=>h(e.id),className:"h-6 w-6 cursor-pointer appearance-none rounded-full border-2 border-border bg-transparent checked:border-primary checked:bg-primary"}),t.jsx(r,{name:"check",className:`absolute text-[16px] text-primary-foreground transition-opacity ${s.includes(e.id)?"opacity-100":"opacity-0"}`})]})})]},e.id)})})]})})};export{$ as default};
