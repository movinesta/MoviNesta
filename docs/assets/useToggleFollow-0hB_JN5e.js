import{b as f,d as w,s as u}from"./index-C9fHGWeV.js";import{u as c}from"./useMutation-Cbgapksf.js";const d=o=>typeof o=="object"&&o!==null&&"code"in o,h=()=>{const{user:o}=f(),s=w();return c({mutationFn:async({targetUserId:r,currentlyFollowing:i})=>{if(!o)throw new Error("You need to be signed in to follow people.");if(o.id===r)throw new Error("You canâ€™t follow yourself.");if(i){const{error:t}=await u.from("follows").delete().eq("follower_id",o.id).eq("followed_id",r);if(t)throw t;return{isFollowing:!1}}const{error:e}=await u.from("follows").insert({follower_id:o.id,followed_id:r,created_at:new Date().toISOString()});if(e&&(!d(e)||e.code!=="23505"))throw e;return{isFollowing:!0}},onSuccess:(r,i)=>{const{targetUserId:e}=i,{isFollowing:t}=r;s.setQueriesData({queryKey:["search","people"]},n=>n&&n.map(l=>{if(l.id!==e)return l;const a=Math.max(0,(l.followersCount??0)+(t?1:-1));return{...l,isFollowing:t,followersCount:a}})),s.invalidateQueries({queryKey:["profile"]})}})};export{h as u};
