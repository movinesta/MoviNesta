import{u as wr,r as l,R as dn,b as yn,d as yr,e as He,j as e,f as vr,q as un,g as jr,s as Ve,h as Nr}from"./index-C9fHGWeV.js";import{u as kr,c as P,s as T,a as _r,f as mn,M as v,S as Sr,b as Ke,P as wt,F as fn,d as p,e as pn}from"./FriendAvatarStack-HjrY3RCv.js";import{u as Mr}from"./useMutation-Cbgapksf.js";import{u as Rr}from"./scroll-area-CnoFzb4R.js";import{D as Cr,a as Tr,b as Fr,c as Ir,d as Ar}from"./dialog-DjKMkZCg.js";import"./TopBar-C-VicUv8.js";import"./format-DMUSBM01.js";import"./circle-alert-C2ornUjM.js";import"./index-DDwuZX7F.js";import"./index-B5ogGJIu.js";import"./index-DBHTwg8d.js";const Pe="mn_swipe_onboarding_seen",Pr=88,Ze=()=>typeof window>"u"?Pr:p(window.innerWidth*.18,72,120),xn=()=>p(Math.round(Ze()*.36),28,44),Dr=(r,o)=>{const f=Math.abs(r);if(f<=o)return r;const h=f-o;return Math.sign(r)*(o+h*.18)},yt=8,Lr=1.25,hn=.32,vt=220,$r=360,bn=10,Er={"--mn-swipe-radius":"clamp(28px, 6vw, 44px)","--mn-swipe-pad":"clamp(14px, 4.5vw, 24px)","--mn-swipe-title":"clamp(1.75rem, 6.4vw, 2.5rem)","--mn-swipe-subtitle":"clamp(0.95rem, 3.4vw, 1.125rem)","--mn-swipe-meta":"clamp(0.95rem, 3.2vw, 1.125rem)","--mn-swipe-chip":"clamp(0.75rem, 2.8vw, 0.875rem)","--mn-swipe-hit":"clamp(2.25rem, 9vw, 2.75rem)","--mn-swipe-gap":"clamp(1.75rem, 7vw, 2.5rem)","--mn-swipe-action":"clamp(3.25rem, 13vw, 4rem)","--mn-swipe-action-primary":"clamp(4.5rem, 18vw, 6rem)","--mn-swipe-icon":"clamp(22px, 5.5vw, 30px)","--mn-swipe-icon-primary":"clamp(32px, 8.5vw, 44px)"},vn=r=>{if(r==null)return null;const o=String(r).trim();if(!o)return null;const f=o.replace(/%/g,""),h=Number(f);return Number.isFinite(h)?h:null},Or=r=>{if(!r)return null;const o=Date.now()-new Date(r).getTime();if(!Number.isFinite(o))return null;const f=Math.max(0,Math.floor(o/1e3));if(f<60)return`${f}s ago`;const h=Math.floor(f/60);if(h<60)return`${h}m ago`;const N=Math.floor(h/60);if(N<48)return`${N}h ago`;const b=Math.floor(N/24);if(b<60)return`${b}d ago`;const y=Math.floor(b/30);return y<24?`${y}mo ago`:`${Math.floor(y/12)}y ago`},Yr=r=>{if(r==null)return null;const o=typeof r=="number"?r:Number(String(r).trim());if(!Number.isFinite(o))return null;const f=Math.round(o/2);return f<=0?null:Math.min(5,Math.max(1,f))},Ur=r=>{if(r==null)return null;const o=Math.round(r);return o<=0?null:Math.min(10,Math.max(2,o*2))},Br=r=>{const o=(()=>{const b=String(r?.source??"").trim();if(!b)return null;const y=b.replace("-","_");return y==="for_you"||y==="for-you"?"for-you":y==="friends"||y==="from_friends"||y==="from-friends"?"from-friends":y==="trending"?"trending":y==="popular"?"popular":y==="combined"?"combined":y==="explore"?"explore":null})(),f=r?.kind==="series"?"series":r?.kind==="anime"?"anime":"movie",h=typeof r?.releaseYear=="number"?r.releaseYear:r?.releaseYear!=null?Number(r.releaseYear):null,N=typeof r?.runtimeMinutes=="number"?r.runtimeMinutes:r?.runtimeMinutes!=null?Number(r.runtimeMinutes):null;return{id:String(r?.id??""),title:String(r?.title??"Untitled"),deckId:r?.deckId??null,position:typeof r?.position=="number"?r.position:r?.position!=null?Number(r.position):null,year:Number.isFinite(h)?h:null,type:f,runtimeMinutes:Number.isFinite(N)?N:null,tagline:r?.tagline??null,mood:r?.mood??null,vibeTag:r?.vibeTag??null,posterUrl:r?.posterUrl??null,tmdbPosterPath:r?.tmdbPosterPath??null,tmdbBackdropPath:r?.tmdbBackdropPath??null,source:o,why:r?.why??null,friendIds:Array.isArray(r?.friendIds)?r.friendIds:null,friendProfiles:Array.isArray(r?.friendProfiles)?r.friendProfiles:null,friendLikesCount:typeof r?.friendLikesCount=="number"?r.friendLikesCount:Array.isArray(r?.friendProfiles)?r.friendProfiles.length:Array.isArray(r?.friendIds)?r.friendIds.length:null,topFriendName:Array.isArray(r?.friendProfiles)&&r.friendProfiles[0]?String(r.friendProfiles[0].display_name??r.friendProfiles[0].username??""):r?.topFriendName??null,topFriendInitials:r?.topFriendInitials??null,topFriendReviewSnippet:r?.topFriendReviewSnippet??null,overview:r?.overview??null,genres:Array.isArray(r?.genres)?r.genres:null,language:r?.language??null,country:r?.country??null,initialRating:typeof r?.initialRating=="number"?r.initialRating:r?.initialRating!=null?Number(r.initialRating):null,initiallyInWatchlist:!!r?.initiallyInWatchlist,imdbRating:typeof r?.imdbRating=="number"?r.imdbRating:r?.imdbRating!=null?Number(r.imdbRating):null,rtTomatoMeter:typeof r?.rtTomatoMeter=="number"?r.rtTomatoMeter:r?.rtTomatoMeter!=null?Number(r.rtTomatoMeter):null}};function gn(r){const{card:o,friendCount:f,imdb:h,rt:N}=r;let b=74;const y=o?.source??null;y==="for-you"&&(b+=10),y==="from-friends"&&(b+=7),y==="trending"&&(b+=4),y==="popular"&&(b+=2);const R=typeof o?.friendLikesCount=="number"?o.friendLikesCount:0;if(R>0){const se=f>0?R/Math.max(1,f)*18:Math.min(12,R*3);b+=se}h!=null&&(b+=(h-7)*4),N!=null&&(b+=(N-70)*.15),o?.why&&(b+=3);const Y=Math.round(b);return Math.round(p(Y,55,99))}const wn=async r=>{const{data:o,error:f}=await Ve.from("media_items").select("id, kind, omdb_plot, omdb_director, omdb_writer, omdb_actors, omdb_genre, omdb_language, omdb_country, omdb_imdb_rating, omdb_imdb_votes, omdb_metascore, omdb_rating_rotten_tomatoes, omdb_poster, omdb_awards, omdb_box_office, omdb_released, omdb_rated, omdb_runtime, omdb_fetched_at, omdb_status, omdb_error").eq("id",r).maybeSingle();if(f)throw f;if(!o)return null;const h=o.omdb_genre!=null?String(o.omdb_genre).split(",").map(b=>b.trim()).filter(Boolean):null,N=vn(o.omdb_rating_rotten_tomatoes);return{title_id:o.id,content_type:o.kind??null,plot:o.omdb_plot??null,omdb_director:o.omdb_director??null,omdb_writer:o.omdb_writer??null,omdb_actors:o.omdb_actors??null,genres:h,omdb_language:o.omdb_language??null,omdb_country:o.omdb_country??null,imdb_rating:o.omdb_imdb_rating??null,imdb_votes:o.omdb_imdb_votes??null,metascore:o.omdb_metascore??null,rt_tomato_pct:N,poster_url:o.omdb_poster??null,omdb_awards:o.omdb_awards??null,omdb_box_office_str:o.omdb_box_office??null,omdb_box_office:null,omdb_released:o.omdb_released??null,omdb_rated:o.omdb_rated??null,omdb_runtime:o.omdb_runtime??null,omdb_fetched_at:o.omdb_fetched_at??null,omdb_status:o.omdb_status??null,omdb_error:o.omdb_error??null}},J="want_to_watch",ce="watched",us=()=>{const r=wr(),[o,f]=l.useState(null),[h,N]=l.useState(!1),[b,y]=l.useState([]),[R,Y]=l.useState(0),{cards:se,sessionId:Qe,isLoading:k,isError:U,swipe:jn,fetchMore:De,trimConsumed:jt,swipeSyncError:Nn,retryFailedSwipe:kn,isRetryingSwipe:_n,trackImpression:Nt,trackDwell:Je}=kr("combined",{limit:72,kindFilter:o}),M=l.useMemo(()=>se.map(Br),[se]),kt=l.useMemo(()=>{const t=new Set;for(const n of M){const i=n?.genres??[];for(const a of i){const c=String(a??"").trim();c&&t.add(c)}}return Array.from(t).sort((n,i)=>n.localeCompare(i))},[M]),Le=dn.useCallback(t=>{if(!t)return!1;if(b.length){const n=Array.isArray(t.genres)?t.genres:[],i=new Set(n.map(c=>String(c).toLowerCase()));if(!b.some(c=>i.has(String(c).toLowerCase())))return!1}if(R>0){const n=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)?t.imdbRating:null;if(n!=null&&n<R)return!1}return!0},[b,R]),[L,de]=l.useState(0),_=se[L],s=M[L],[B,_t]=l.useState(!1),[Sn,$e]=l.useState(()=>typeof window>"u"?!1:!localStorage.getItem(Pe)),[St,Mn]=l.useState([]),Mt=(t,n)=>{t&&Mn(i=>{const a=i.includes(t);return n?a?i:[...i,t]:a?i.filter(c=>c!==t):i})},et=t=>Mt(s?.id,t),Rn=!!s?.id&&St.includes(s.id),ee=M[L+1]??null,Cn=!!ee?.id&&St.includes(ee.id),Tn=!!(ee?.posterUrl&&!Cn);l.useEffect(()=>{if(typeof window>"u")return;const t=ee?.posterUrl;if(!t)return;const n=new Image;n.decoding="async",n.src=t},[ee?.posterUrl]);const[Kr,ie]=l.useState(null),[Vr,Fn]=l.useState(!1),[ue,Ee]=l.useState(!1),[Oe,Ye]=l.useState(!1),[Zr,tt]=l.useState(!1),[we,Rt]=l.useState(null),[In,nt]=l.useState(!1),te=l.useRef(null),[Ct,Tt]=l.useState(null),ye=l.useRef(null),[Qr,An]=l.useState(0),[Pn,Ft]=l.useState(0),rt=l.useRef(null),st=l.useRef(!1),[Jr,Dn]=l.useState(!1),[Ln,It]=l.useState(!1),F=s?.id??null,Ue=ee?.id??null,{user:X}=yn(),Be=yr();l.useEffect(()=>{if(typeof window>"u"||M.length===0)return;const t=window.requestIdleCallback,n=()=>{const a=M.map(c=>{if(!c.id)return null;const d=un.titleDetail(c.id);return Be.getQueryData(d)?null:Be.prefetchQuery({queryKey:d,queryFn:()=>wn(c.id),staleTime:18e5,gcTime:36e5})});Promise.allSettled(a.filter(Boolean))};if(t){const a=t(n);return()=>{typeof window<"u"&&"cancelIdleCallback"in window&&window.cancelIdleCallback?.(a)}}const i=window.setTimeout(n,280);return()=>window.clearTimeout(i)},[M,Be]);const{data:ve}=He({queryKey:["title-preview",Ue],enabled:!!Ue,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>{if(!Ue)return null;const{data:t,error:n}=await Ve.from("media_items").select("id, omdb_director, omdb_genre, omdb_rating_rotten_tomatoes, omdb_imdb_rating").eq("id",Ue).maybeSingle();if(n)throw n;return t?{omdb_director:t.omdb_director??null,omdb_genre:t.omdb_genre??null,omdb_rating_rotten_tomatoes:t.omdb_rating_rotten_tomatoes??null,omdb_imdb_rating:t.omdb_imdb_rating??null}:null}}),At=P(ve?.omdb_director),$n=vn(ve?.omdb_rating_rotten_tomatoes),En=T(ve?.omdb_imdb_rating),{data:le=0}=He({queryKey:["friendCount",{userId:X?.id??null}],enabled:!!X?.id,staleTime:1e3*60*10,gcTime:1e3*60*30,refetchOnWindowFocus:!1,queryFn:async()=>{if(!X?.id)return 0;const{count:t,error:n}=await Ve.from("follows").select("followed_id",{count:"exact",head:!0}).eq("follower_id",X.id);if(n)throw n;return t??0}}),Pt=["mediaFeedback",{userId:X?.id??null,mediaItemId:F}],{data:it}=He({queryKey:Pt,enabled:!!(X?.id&&F),staleTime:1e3*30,gcTime:1e3*60*10,refetchOnWindowFocus:!1,queryFn:async()=>{if(!X?.id||!F)return null;const{data:t,error:n}=await Ve.from("media_feedback").select("in_watchlist, rating_0_10, last_action").eq("user_id",X.id).eq("media_item_id",F).maybeSingle();if(n)throw n;return t??null}}),Dt=it?.in_watchlist?J:it?.last_action==="like"?ce:null,On=Yr(it?.rating_0_10),[Yn,Xe]=l.useState(null),[Lt,lt]=l.useState(null),at={status:Yn??Dt,rating:Lt??On},ae=Mr({mutationFn:async t=>{if(!X?.id||!_)return;const n={sessionId:Qe,deckId:_.deckId??null,position:_.position??null,mediaItemId:_.id,source:_.source??null,payload:{ui:"SwipePage",action:t.status?"status":t.ratingStars!=null?"rating":"feedback"}},i=[];if(t.status!==void 0&&(t.status===ce?i.push({...n,eventType:"like"}):i.push({...n,eventType:"watchlist",inWatchlist:t.status===J})),t.ratingStars!==void 0&&i.push({...n,eventType:"rating",rating0_10:Ur(t.ratingStars)}),!!i.length)for(const a of i)await Nr(a)},onSuccess:()=>{Be.invalidateQueries({queryKey:Pt})}}),je=l.useRef(null),ze=l.useRef({x:0,y:0}),$t=()=>{if(typeof window>"u")return null;if(je.current)return je.current;const t=window.AudioContext||window.webkitAudioContext;if(!t)return null;const n=new t;return je.current=n,n},ot=t=>{typeof navigator>"u"||typeof navigator.vibrate!="function"||navigator.vibrate(t)},Et=(t,n)=>{const i=$t();if(!i)return;i.state==="suspended"&&i.resume().catch(()=>{});const a=i.createOscillator(),c=i.createGain();let d=440,w=440;t==="like"?(d=420,w=660):t==="dislike"?(d=280,w=190):(d=360,w=320);const u=i.currentTime,m=.08+n*.07;a.type="triangle",a.frequency.setValueAtTime(d,u),a.frequency.linearRampToValueAtTime(w,u+m);const j=.18+n*.18;c.gain.setValueAtTime(j,u),c.gain.exponentialRampToValueAtTime(.001,u+m),a.connect(c),c.connect(i.destination),a.start(u),a.stop(u+m+.02)},{data:g}=He({queryKey:un.titleDetail(F),enabled:!!F,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>F?wn(F):null}),We=P(g?.plot)??P(s?.overview)??null,$=g?.genres??s?.genres??null,Un=g?.omdb_language??s?.language??null;P(Un);const Bn=g?.omdb_country??s?.country??null,Xn=P(Bn),Ot=_r(Xn),Ne=P(g?.omdb_director),Yt=P(g?.omdb_writer),ke=P(g?.omdb_actors),me=g?.imdb_rating??s?.imdbRating??null,ct=g?.rt_tomato_pct??s?.rtTomatoMeter??null,dt=g?.metascore??null,ut=g?.imdb_votes??null,Ut=P(g?.omdb_awards),Bt=P(g?.omdb_box_office_str),Xt=P(g?.omdb_released),mt=g?.content_type==="movie"||g?.content_type==="series"||g?.content_type==="anime"?g.content_type:s?.type??null,zt=s,zn=zt?.certification??zt?.rated??g?.omdb_rated??null,Wt=P(zn),qt=(Array.isArray($)?$:$?String($).split(",").map(t=>t.trim()):[])??[],Gt=qt.length>3?qt.slice(3).filter(Boolean):[],Wn=[g?.omdb_language??null,s?.language??null],Ht=Array.from(new Set(Wn.map(t=>P(t)).filter(t=>!!t))),ft=()=>X?!0:(alert("Sign in to save this title, rate it, or add it to your watchlist."),!1),Kt=t=>{if(!(!F||!_||!ft()||ae.isPending)){if(t===J){const n=at.status===J?null:J;Xe(n),ae.mutate({status:n});return}t===ce&&(Xe(ce),ae.mutate({status:ce}))}},qn=()=>{!F||!_||!ft()||ae.isPending||(Xe(J),ae.mutate({status:J}),Zn())},Gn=t=>{!F||!_||!ft()||ae.isPending||(lt(t),ae.mutate({ratingStars:t}))},Vt=t=>at?.status===t,Zt=at?.rating??null,pt=Lt??Zt;l.useEffect(()=>{lt(null),Xe(null)},[F,Zt,Dt]);const Hn=t=>{const n=pt===t?null:t;lt(n),Gn(n)},Qt=()=>typeof window<"u"?`${window.location.origin}/title/${s?.id??""}`:`/title/${s?.id??""}`,Kn=Qt(),Vn=async t=>{if(!s||!_)return;const n=Qt(),i=`Check this out: ${s.title}`,a=t??i;try{navigator.share?await navigator.share({title:s.title,text:a,url:n}):navigator.clipboard?.writeText?(await navigator.clipboard.writeText(`${a}

${n}`),alert("Link copied to clipboard")):alert(`${a}

${n}`)}catch{}},Jt=!!(s?.posterUrl&&!Rn),W=l.useRef(null),en=l.useRef(null),E=l.useRef(null),O=l.useRef(null),fe=l.useRef(0),ne=l.useRef(0),pe=l.useRef(0),_e=l.useRef(!1),q=l.useRef(null),tn=l.useRef(!1),re=l.useRef(null),G=l.useRef(null),z=l.useRef(null),I=l.useRef(0),H=l.useRef(null),K=l.useRef(.5),V=l.useRef(.5),Se=l.useRef(null),Me=l.useRef(null),qe=l.useRef(null),Ge=l.useRef(null),xe=l.useRef(null),Zn=()=>{if(!s)return;$e(!1),typeof window<"u"&&localStorage.setItem(Pe,"1"),ie(null);const t=W.current;t&&(t.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",t.style.transform="perspective(1400px) translateX(0px) translateY(6px) scale(1.02) rotateZ(-1deg)",window.setTimeout(()=>{t.style.transform="perspective(1400px) translateX(0px) translateY(26px) scale(0.95)"},16),t.style.opacity="0"),window.setTimeout(()=>{nn(0,!0),de(n=>Math.min(n+1,M.length)),t&&(t.style.transition="none",t.style.transform="translateX(0px) translateY(0px) scale(1)",t.style.opacity="1")},220)};l.useEffect(()=>{if(typeof window>"u")return;const t=localStorage.getItem(Pe);$e(!t)},[]),l.useEffect(()=>{et(!1),tt(!1),Ee(!1),Ye(!1),Dn(!1)},[s?.id]),l.useEffect(()=>{!_||!s||k||U||Le(s)||(Ee(!1),Ye(!1),tt(!1),de(t=>Math.min(t+1,M.length)))},[_?.id,s?.id,k,U,Le]),l.useEffect(()=>{if(!_)return;const t=performance.now();if(xe.current&&Ge.current&&Ge.current!==_.id){const n=qe.current;if(n!=null){const i=Math.max(0,Math.round(t-n));Je(xe.current,i)}}if(!Le(s)){xe.current=null,Ge.current=null,qe.current=null;return}Nt(_),xe.current=_,Ge.current=_.id,qe.current=t},[_?.id,s?.id,Le,Je,Nt]),l.useEffect(()=>()=>{if(!xe.current)return;const t=qe.current;if(t==null)return;const n=Math.max(0,Math.round(performance.now()-t));Je(xe.current,n)},[]),l.useEffect(()=>{if(typeof window>"u")return;(window.requestIdleCallback??(n=>window.setTimeout(n,180)))(()=>{const n=M.slice(L+1,L+4);for(const i of n){if(!i?.posterUrl)continue;const a=new Image;a.loading="lazy",a.decoding="async",a.src=i.posterUrl}})},[M,L]),l.useEffect(()=>()=>{re.current&&cancelAnimationFrame(re.current),te.current!=null&&window.clearTimeout(te.current),ye.current!=null&&window.clearTimeout(ye.current),je.current&&je.current.close().catch(()=>{})},[]),l.useEffect(()=>{const t=M.length-L;t<12&&De(Math.max(60,t+24))},[M.length,L,De]),l.useEffect(()=>{if(L<=10)return;const t=Math.min(Math.max(L-6,0),M.length);t>0&&(jt(t),de(n=>Math.max(4,n-t)))},[M.length,L,jt]);const nn=l.useCallback((t,n=!1,i)=>{const a=en.current;if(!a)return;const c=p(Math.abs(t)/Ze(),0,1),d=.68+c*.32,w=.9+c*.1,u=.985+c*.015,m=(1-c)*6,j=1-c,S=p(-t*.02,-10,10)*j,C=p(-t/220,-2.2,2.2)*j,x=i??200;a.style.transition=n?`filter ${x}ms cubic-bezier(0.22,0.61,0.36,1), transform ${x}ms cubic-bezier(0.22,0.61,0.36,1)`:"none",a.style.transform=`translate3d(${S.toFixed(2)}px, ${m.toFixed(2)}px, 0px) rotateZ(${C.toFixed(3)}deg) scale(${u.toFixed(4)})`,a.style.filter=`brightness(${d.toFixed(3)}) saturate(${w.toFixed(3)})`},[]),Re=(t,n=!1,i,a)=>{const c=W.current;if(!c)return;const d=p(t,-vt,vt),w=Dr(t,vt),u=Math.abs(t)>.5&&q.current==="x";c.style.transformOrigin=u?`${(V.current*100).toFixed(1)}% ${(K.current*100).toFixed(1)}%`:"50% 50%";const m=Ze(),j=xn(),S=Math.abs(d),C=j*.6,x=p((S-C)/Math.max(1,m-C),0,1),A=d>0?x:0,D=d<0?x:0;c.style.setProperty("--mn-swipe-like-opacity",String(A)),c.style.setProperty("--mn-swipe-nope-opacity",String(D)),c.style.setProperty("--mn-swipe-like-scale",String(.96+A*.04)),c.style.setProperty("--mn-swipe-nope-scale",String(.96+D*.04));const Z=p(Math.abs(d)/m,0,1),oe=p((.5-K.current)*2,-1,1),Ie=oe<0?-1:1,ge=.55+.45*Math.abs(oe),Ae=p((V.current-.5)*2,-1,1),Q=p(Math.abs(I.current)/1.35,0,1),bt=d/bn*ge*Ie,cr=p(bt*(1+Q*.28),-22,22),dr=p(d/24+Math.sign(d)*Q*2.8+-Ae*Z*4.5,-18,18),ur=p(oe*(1.8+Q*2.2)*Z,-8,8),mr=p(pe.current*.18,-14,14),fr=-Z*(3.2+Q*1.6),pr=1+Z*.006+Q*.004,gt=ze.current,xr=gt.y*-4,hr=gt.x*5,br=gt.y*-4,cn=i??320,gr=a??"cubic-bezier(0.16, 1, 0.3, 1)";c.style.transition=n?`transform ${cn}ms ${gr}`:"none",c.style.transform=`
      perspective(1400px)
      translate3d(${w}px, ${br+fr+mr}px, 0px)
      rotateX(${xr+ur}deg)
      rotateY(${dr+hr}deg)
      rotateZ(${cr}deg)
      scale(${pr})
    `,fe.current=d,nn(d,n,cn)},rn=(t=!0,n=0)=>{ze.current={x:0,y:0};const i=Math.abs(n),a=p(i/1.35,0,1),c=t?p(Math.round(320-a*140),170,320):void 0,d=t&&i<.45?"cubic-bezier(0.22, 1.2, 0.36, 1)":"cubic-bezier(0.16, 1, 0.3, 1)";Re(0,t,c,d),fe.current=0,E.current=null,O.current=null,G.current=null,z.current=null,I.current=0,ne.current=0,pe.current=0,_e.current=!1,q.current=null,ie(null),V.current=.5,K.current=.5,Se.current=null},Qn=(t,n)=>{Rt({card:t,direction:n}),nt(!0),te.current!=null&&window.clearTimeout(te.current),te.current=window.setTimeout(()=>nt(!1),2800)},Jn=()=>{nt(!1),Rt(null),te.current!=null&&(window.clearTimeout(te.current),te.current=null)},er=()=>{we&&(de(t=>{const n=t-1;if(n<0)return t;const i=M[n];return i&&i.id===we.card.id?n:t}),Jn())},sn=t=>{Tt(t),ye.current!=null&&window.clearTimeout(ye.current),t&&(ye.current=window.setTimeout(()=>Tt(null),3200))},tr=(t,n)=>{const i=t.runtimeMinutes??0,a=$??t.genres??[],c=mt==="series"||t.type==="series",d=a.map(w=>w.toLowerCase());return n==="like"?d.some(w=>w.includes("horror")||w.includes("thriller"))?"We’ll show more intense picks like this.":d.some(w=>w.includes("comedy"))?"We’ll show more light and funny picks like this.":c?"Nice — we’ll bring in more series that match this vibe.":me!=null&&T(me)!=null&&T(me)>=7.5?"Nice pick — we’ll show more highly rated titles like this.":t.friendLikesCount&&t.friendLikesCount>=3?"Your friends are into this — we’ll pull in more friend-favorites.":"Got it — we’ll keep tuning around this kind of title.":n==="dislike"?c?"Looks like this series isn’t your thing — we’ll dial down similar shows.":i>130&&Pn+1>=3?"You’ve skipped a few long movies — we’ll lean toward shorter runtimes.":i>130?"Noted — we’ll be more careful with super long movies.":"Okay, we’ll dial down similar titles in your feed.":n==="skip"?"We’ll move this out of your way and keep the feed feeling fresh.":null},he=(t,n=0)=>{if(!s||!_)return;if($e(!1),typeof window<"u"&&localStorage.setItem(Pe,"1"),Qn(s,t),jn({card:_,direction:t}),ie(null),t==="dislike"&&(s.runtimeMinutes??0)>130?Ft(x=>x+1):Ft(0),An(x=>{const A=x+1,D=tr(s,t);return D&&A>=4&&A%4===0?sn(D):sn(null),A}),t==="skip"){const x=W.current;x&&(x.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",x.style.transform="perspective(1400px) translateX(0px) translateY(4px) scale(1.03) rotateZ(-1deg)",window.setTimeout(()=>{x.style.transform="perspective(1400px) translateX(0px) translateY(24px) scale(0.95)"},16),x.style.opacity="0");const A=.4;ot(16+A*40),Et(t,A),window.setTimeout(()=>{de(D=>Math.min(D+1,M.length)),x&&(x.style.transition="none",x.style.transform="translateX(0px) translateY(0px) scale(1)",x.style.opacity="1")},220);return}const i=t==="like"?1:-1,a=typeof window<"u"?window.innerWidth+240:$r,c=Math.abs(n),d=p(c/1.35,0,1),w=p(c*260,0,280),u=(a+w)*i,m=p(Math.round(260-d*110),140,260),j=W.current;if(j){const x=p((.5-K.current)*2,-1,1),A=x<0?-1:1,D=.55+.45*Math.abs(x),Z=p((V.current-.5)*2,-1,1);j.style.transformOrigin=`${(V.current*100).toFixed(1)}% ${(K.current*100).toFixed(1)}%`;const oe=u/bn*D*A,Ie=p(oe*(1+d*.12),-30,30),ge=p(i*(10+d*12)+-Z*(4+d*3),-28,28),Ae=p(x*(4+d*2),-9,9),Q=-4-d*14,bt=1.04+d*.04;j.style.transition=`transform ${m}ms cubic-bezier(0.22,0.61,0.36,1)`,j.style.transform=`
        perspective(1400px)
        translate3d(${u}px, ${Q}px, 0px)
        rotateX(${Ae}deg)
        rotateY(${ge}deg)
        rotateZ(${Ie}deg)
        scale(${bt})
      `}const S=Math.abs(fe.current)+Math.abs(n)*220,C=p(S/520,.25,1);ot(12+C*28),Et(t,C),window.setTimeout(()=>{de(x=>Math.min(x+1,M.length)),window.requestAnimationFrame(()=>rn(!1))},m)},nr=(t,n,i,a)=>{if(!s||!_||H.current!=null)return;const d=a instanceof HTMLElement&&!!a.closest('button, a, input, textarea, select, [data-swipe-interactive="true"][role="button"], [data-swipe-interactive="true"][tabindex]:not([tabindex="-1"])');if(tn.current=d,d)return;_e.current=!0,H.current=i,q.current=null,E.current=t,O.current=n;const w=W.current;if(w){const m=w.getBoundingClientRect();m.width>0&&m.height>0?(V.current=p((t-m.left)/m.width,0,1),K.current=p((n-m.top)/m.height,0,1)):(V.current=.5,K.current=.5)}else V.current=.5,K.current=.5;ne.current=0,pe.current=0,fe.current=0,G.current=t,z.current=performance.now(),Me.current=z.current,I.current=0,ie(null);const u=ue&&rt.current&&rt.current.contains(a);st.current=!!u},rr=(t,n,i)=>{if(H.current!=null&&i!==H.current||!_e.current||E.current===null||O.current===null)return;const a=performance.now(),c=t-E.current,d=n-O.current;if(!B&&q.current==null){const S=Math.abs(c),C=Math.abs(d);if(S<yt&&C<yt)return;if(C>S*Lr){_e.current=!1,H.current=null,q.current="y",E.current=null,O.current=null,G.current=null,z.current=null,I.current=0,ie(null);return}q.current="x",_t(!0),E.current=t-Math.sign(c)*yt,O.current=n,G.current=t,z.current=a,I.current=0,$t();const x=W.current;if(x)try{x.setPointerCapture(i)}catch{}}if(!B||E.current===null)return;const w=t-E.current;ne.current=w;const u=O.current!=null?n-O.current:0;pe.current=p(u,-70,70);const m=xn();let j=null;if(w>m?j="like":w<-m&&(j="dislike"),ie(j),j&&j!==Se.current&&ot(10),Se.current=j,G.current!==null&&z.current!==null){const S=a-z.current;if(S>0){const C=(t-G.current)/S,x=p(C,-2.5,2.5);I.current=I.current*.75+x*.25}}G.current=t,z.current=a,re.current==null&&(re.current=window.requestAnimationFrame(()=>{re.current=null,Re(ne.current)}))},ln=(t,n,i)=>{if(H.current!=null&&t!==H.current)return;const a=B;_t(!1),_e.current=!1;const c=H.current;H.current=null,re.current!=null&&(cancelAnimationFrame(re.current),re.current=null,Re(ne.current));const d=t??c;if(d!=null)try{W.current?.releasePointerCapture(d)}catch{}if(!a){const A=q.current==="y",D=E.current,Z=O.current,oe=D!=null&&n!=null?n-D:0,Ie=Z!=null&&i!=null?i-Z:0,ge=Me.current!=null?performance.now()-Me.current:null,Ae=!A&&Math.abs(oe)<10&&Math.abs(Ie)<10&&(ge==null||ge<280)&&!tn.current;E.current=null,O.current=null,G.current=null,z.current=null,I.current=0,Me.current=null,ne.current=0,pe.current=0,q.current=null,ie(null),V.current=.5,K.current=.5,Se.current=null,Ae&&!(ue&&st.current)&&(Ee(Q=>!Q),Ye(!1),tt(!1));return}Me.current=null;const u=fe.current+I.current*180,m=ue&&st.current,j=Ze(),S=m?j*1.6:j,C=m?hn*1.4:hn,x=Math.abs(u)>=S||Math.abs(I.current)>=C;if(E.current=null,O.current=null,G.current=null,z.current=null,ne.current=0,pe.current=0,q.current=null,x){he(u>=0?"like":"dislike",I.current),Se.current=null,I.current=0;return}rn(!0,I.current)},Ce=!s||k||U||B,an=typeof s?.friendLikesCount=="number"?s.friendLikesCount:0,sr=le>0?Math.round(an/Math.max(1,le)*100):0;l.useEffect(()=>{const t=n=>{!s||Ce||B||(n.key==="ArrowLeft"?(n.preventDefault(),he("dislike")):n.key==="ArrowRight"?(n.preventDefault(),he("like")):(n.key==="ArrowDown"||n.key===" ")&&(n.preventDefault(),he("skip")))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[s,Ce,B]);const ir=()=>{if(!In||!we)return null;const t=we.direction==="like"?"Loved it":we.direction==="dislike"?"Marked as ‘No thanks’":"Saved for ‘Not now’";return e.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-4 z-40 flex justify-center px-4 sm:px-0",children:e.jsxs("div",{className:"pointer-events-auto inline-flex items-center gap-3 rounded-md border border-border bg-background/95 px-3 py-2 text-[12px] text-foreground shadow-lg backdrop-blur",children:[e.jsx("span",{children:t}),e.jsx("button",{type:"button",onClick:er,className:"text-xs font-semibold uppercase tracking-[0.14em] text-primary hover:text-primary/80",children:"Undo"})]})})},lr=()=>Ct?e.jsx("div",{className:"pointer-events-none absolute inset-x-0 top-2 z-30 flex justify-center px-4 sm:px-0",children:e.jsxs("div",{className:"pointer-events-auto inline-flex max-w-md items-start gap-2 rounded-md border border-border bg-background/95 px-3 py-2 text-xs text-muted-foreground shadow-lg backdrop-blur",children:[e.jsx(v,{name:"auto_awesome",className:"mt-0.5 text-[18px] text-primary"}),e.jsx("span",{children:Ct})]})}):null,Te=typeof s?.imdbRating=="number"&&!Number.isNaN(s.imdbRating)?s.imdbRating:typeof g?.imdb_rating=="number"&&!Number.isNaN(g.imdb_rating)?g.imdb_rating:T(g?.imdb_rating),Fe=typeof s?.rtTomatoMeter=="number"&&!Number.isNaN(s.rtTomatoMeter)?s.rtTomatoMeter:typeof g?.rt_tomato_pct=="number"&&!Number.isNaN(g.rt_tomato_pct)?g.rt_tomato_pct:T(g?.rt_tomato_pct),xt=l.useMemo(()=>gn({card:s??null,friendCount:le,imdb:Te??null,rt:Fe??null}),[s,le,Te,Fe]),be=s?(()=>{const t=[];if(s.year&&t.push(String(s.year)),Te!=null&&T(Te)!=null&&t.push(`IMDb ${String(T(Te)?.toFixed(1))}`),Fe!=null&&T(Fe)!=null&&t.push(`RT ${Math.round(Number(Fe))}%`),typeof s.runtimeMinutes=="number"&&s.runtimeMinutes>0){const n=mn(s.runtimeMinutes);n&&t.push(n)}return t.join(" • ")})():"",ht=l.useMemo(()=>{const t=mt??s?.type??null;return t==="series"?"SERIES":t==="anime"?"ANIME":"MOVIE"},[mt,s?.type]),on=l.useMemo(()=>{const t=$??s?.genres??null;return(Array.isArray(t)?t:t?String(t).split(",").map(i=>i.trim()).filter(Boolean):[]).map(i=>String(i??"").trim()).filter(Boolean).slice(0,3)},[$,s?.genres]),ar=t=>{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||B)return;const n=W.current;if(!n)return;const i=n.getBoundingClientRect(),a=(t.clientX-i.left)/i.width,c=(t.clientY-i.top)/i.height;ze.current={x:(a-.5)*2,y:(c-.5)*2},Re(ne.current)},or=()=>{B||(ze.current={x:0,y:0},Re(fe.current,!0))};return e.jsxs("div",{className:"relative flex flex-1 min-h-0 flex-col overflow-hidden overscroll-none h-[calc(100dvh-(5.5rem+env(safe-area-inset-bottom)))] sm:h-[calc(100dvh-(6rem+env(safe-area-inset-bottom)))]",style:Er,children:[s?.posterUrl&&e.jsxs("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 -z-10",style:{backgroundImage:`url(${s.posterUrl})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-background/40 via-background/70 to-background"}),e.jsx("div",{className:"absolute inset-0 backdrop-blur-2xl"})]}),lr(),e.jsxs("div",{className:"relative z-10 flex shrink-0 flex-col gap-3 px-4 pt-[calc(env(safe-area-inset-top)+0.75rem)]",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:()=>N(!0),className:"inline-flex h-10 w-10 items-center justify-center text-muted-foreground/90 transition-colors hover:text-foreground","aria-label":"Filters",children:e.jsx(v,{name:"tune",className:"text-[26px]"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[11px] font-semibold tracking-[0.25em] text-primary/90",children:"DISCOVERY"}),e.jsx("div",{className:"text-xl font-semibold text-foreground",children:"For You"})]}),e.jsxs("button",{type:"button",onClick:()=>r("/activity"),className:"relative inline-flex h-10 w-10 items-center justify-center text-muted-foreground/90 transition-colors hover:text-foreground","aria-label":"Activity",children:[e.jsx(v,{name:"notifications",className:"text-[26px]"}),e.jsx("span",{"aria-hidden":"true",className:"absolute right-[8px] top-[8px] h-2 w-2 rounded-full bg-primary"})]})]}),e.jsx(Sr,{message:Nn,onRetry:kn,isRetrying:_n})]}),e.jsxs("div",{className:"relative z-10 flex flex-1 min-h-0 flex-col overflow-visible px-4",children:[e.jsxs("div",{className:"relative flex flex-1 min-h-0 items-center justify-center overflow-visible [perspective:1400px]","aria-live":"polite",children:[k&&!s&&!U&&e.jsx(vr,{}),U&&!k&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(v,{name:"info",className:"text-[32px] text-amber-400"}),e.jsx("p",{children:"We couldn't load your swipe deck."}),e.jsx("button",{type:"button",onClick:()=>De(32),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Retry"})]}),!k&&!U&&!s&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(v,{name:"auto_awesome",className:"text-[32px] text-primary"}),e.jsx("p",{children:"All caught up. New cards will appear soon."}),e.jsx("button",{type:"button",onClick:()=>De(36),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Refresh deck"})]}),!k&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative z-10 mx-auto h-full max-h-[720px] w-full max-w-md",children:[ee&&e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0",children:(()=>{const t=ee;if(!t)return null;const n=typeof t.friendLikesCount=="number"?t.friendLikesCount:Array.isArray(t.friendProfiles)?t.friendProfiles.length:0,i=le>0?Math.round(n/Math.max(1,le)*100):0,a=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)?t.imdbRating:En??null,c=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)?t.rtTomatoMeter:$n??null,d=gn({card:t,friendCount:le,imdb:a,rt:c}),w=(()=>{const u=Array.isArray(t.genres)?t.genres:[],m=ve?.omdb_genre!=null?String(ve.omdb_genre).split(",").map(S=>S.trim()).filter(Boolean):[];return(u.length>0?u:m).map(S=>String(S??"").trim()).filter(Boolean).slice(0,3)})();return e.jsx("div",{ref:en,className:"absolute inset-0",style:{filter:"brightness(0.68) saturate(0.9)",willChange:"filter"},children:e.jsx("div",{className:"relative h-full w-full rounded-[var(--mn-swipe-radius)] bg-gradient-to-b from-white/10 via-primary/25 to-white/10 p-[1.25px] shadow-[0_30px_90px_rgba(0,0,0,0.75)]",children:e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-[var(--mn-swipe-radius)] bg-background/20 backdrop-blur-sm",children:[Tn&&t.posterUrl?e.jsx("img",{src:t.posterUrl,alt:Ke(t)??`${t.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>Mt(t.id,!0)}):e.jsx("div",{className:"h-full w-full",children:e.jsx(wt,{title:t.title})}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/20 to-black/70"}),t.source==="from-friends"&&e.jsx("div",{className:"absolute left-5 top-5",children:(()=>{const u=t.topFriendName??t.friendProfiles?.[0]?.display_name??t.friendProfiles?.[0]?.username??"",m=Math.max(0,n-1),j=!!u,S=(u.trim().charAt(0)||"F").toUpperCase();return e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-black/30 px-2.5 py-2 shadow-sm backdrop-blur-md",children:[e.jsx("div",{className:"grid h-10 w-10 place-items-center overflow-hidden rounded-full border border-white/20 bg-white/10 text-sm font-semibold text-white/90",children:j&&t.friendProfiles?.[0]?.avatar_url?e.jsx("img",{src:t.friendProfiles[0].avatar_url,alt:u||"Friend",className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("span",{children:S})}),m>0&&e.jsxs("div",{className:"grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-white/10 text-sm font-semibold text-white/90",children:["+",m]}),e.jsx("div",{className:"pr-1 text-sm font-semibold text-white/90",children:j?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary",children:u}),e.jsx("span",{className:"text-white/80",children:" & others watched"})]}):e.jsx("span",{className:"text-white/80",children:"From friends"})})]})})()}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-x-0 bottom-0 h-[72%] bg-gradient-to-t from-black/85 via-black/40 to-transparent"}),e.jsxs("div",{className:"relative",children:[(()=>{const u=t.source??"for-you",m=u==="trending"?{label:"Trending",icon:"local_fire_department"}:u==="popular"?{label:"Popular",icon:"stars"}:u==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-primary/25 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-primary-foreground backdrop-blur",children:[e.jsx(v,{name:m.icon,filled:!0,className:"text-[18px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:m.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[d,"% Match"]})]})})(),e.jsx("h2",{className:"line-clamp-2 text-[length:var(--mn-swipe-title)] font-extrabold leading-[1.02] text-white",children:t.title}),At&&e.jsxs("p",{className:"mt-1 text-[length:var(--mn-swipe-subtitle)] font-semibold text-white/60",children:["Directed by ",At.split(",")[0]]}),e.jsx("div",{className:"mt-4 text-[length:var(--mn-swipe-meta)] text-white/70 whitespace-nowrap overflow-hidden text-ellipsis",children:[t.year?e.jsx("span",{children:t.year},"y"):null,a!=null?e.jsxs("span",{className:"text-white/70",children:["IMDb ",String(a.toFixed(1))]},"i"):null,c!=null?e.jsxs("span",{className:"text-white/70",children:["RT ",Math.round(c),"%"]},"r"):null,typeof t.runtimeMinutes=="number"&&t.runtimeMinutes>0?e.jsx("span",{children:mn(t.runtimeMinutes)},"t"):null].filter(Boolean).map((u,m)=>e.jsxs(dn.Fragment,{children:[m>0&&e.jsx("span",{className:"mx-1 text-white/30",children:"•"}),u]},m))}),Array.isArray(t.friendProfiles)&&t.friendProfiles.length>0&&e.jsxs("div",{className:"mt-5 flex w-full items-center justify-between gap-3 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-left backdrop-blur-md","aria-label":"Friends summary",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fn,{profiles:t.friendProfiles,max:3,size:32}),e.jsxs("div",{className:"leading-tight",children:[e.jsxs("p",{className:"text-[length:var(--mn-swipe-subtitle)] font-extrabold text-white",children:[p(Math.round(i),0,100),"% of friends"]}),e.jsxs("p",{className:"text-sm font-semibold text-white/60",children:[t.source==="from-friends"?"watched":"liked"," this title"]})]})]}),e.jsx("div",{className:"grid h-[var(--mn-swipe-hit)] w-[var(--mn-swipe-hit)] place-items-center rounded-full border border-white/10 bg-white/10 text-white/70",children:e.jsx(v,{name:"chevron_right",className:"text-[26px]"})})]}),w.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:w.map(u=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/10 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-white/75",children:["#",u]},u))})]})]})]})})})})()}),e.jsx("div",{className:"relative h-full w-full rounded-[var(--mn-swipe-radius)] bg-gradient-to-b from-white/10 via-primary/25 to-white/10 p-[1.25px] shadow-[0_30px_90px_rgba(0,0,0,0.75)]",children:e.jsxs("article",{ref:W,role:"group","aria-roledescription":"Movie card","aria-label":Ke(s),className:`relative h-full w-full select-none overflow-hidden rounded-[var(--mn-swipe-radius)] bg-background/20 backdrop-blur-sm transform-gpu will-change-transform ${ue?"ring-1 ring-primary/40":""}`,onPointerDown:t=>{t.pointerType==="mouse"&&t.button!==0||nr(t.clientX,t.clientY,t.pointerId,t.target)},onPointerMove:t=>rr(t.clientX,t.clientY,t.pointerId),onPointerUp:t=>ln(t.pointerId,t.clientX,t.clientY),onPointerCancel:t=>ln(t.pointerId,t.clientX,t.clientY),onMouseMove:ar,onMouseLeave:or,style:{touchAction:"pan-y"},children:[!ue&&e.jsxs("div",{className:"relative h-full w-full",children:[Jt&&s.posterUrl?e.jsx("img",{src:s.posterUrl,alt:Ke(s)??`${s.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>et(!0)}):e.jsx(wt,{title:s.title}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/20 to-black/70"}),e.jsx("div",{className:"pointer-events-none absolute inset-x-8 top-10 flex justify-start",children:e.jsxs("div",{className:`flex items-center gap-2 rounded-md bg-emerald-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-emerald-200 shadow-md backdrop-blur-sm ${B?"":"transition-[opacity,transform] duration-200"}`,style:{opacity:"var(--mn-swipe-like-opacity, 0)",transform:"translate3d(0,0,0) scale(var(--mn-swipe-like-scale, 0.96))"},children:[e.jsx(v,{name:"favorite",filled:!0,className:"text-[18px] text-emerald-300"}),e.jsx("span",{children:"Love it"})]})}),e.jsx("div",{className:"pointer-events-none absolute inset-x-8 top-10 flex justify-end",children:e.jsxs("div",{className:`flex items-center gap-2 rounded-md bg-rose-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-rose-200 shadow-md backdrop-blur-sm ${B?"":"transition-[opacity,transform] duration-200"}`,style:{opacity:"var(--mn-swipe-nope-opacity, 0)",transform:"translate3d(0,0,0) scale(var(--mn-swipe-nope-scale, 0.96))"},children:[e.jsx(v,{name:"close",className:"text-[18px] text-rose-300"}),e.jsx("span",{children:"No thanks"})]})}),s.source==="from-friends"&&e.jsx("div",{className:"absolute left-5 top-5",children:(()=>{const t=s.topFriendName??s.friendProfiles?.[0]?.display_name??s.friendProfiles?.[0]?.username??"",n=Math.max(0,an-1),i=!!t,a=(t.trim().charAt(0)||"F").toUpperCase();return e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-black/30 px-2.5 py-2 shadow-sm backdrop-blur-md",children:[e.jsx("div",{className:"grid h-10 w-10 place-items-center overflow-hidden rounded-full border border-white/20 bg-white/10 text-sm font-semibold text-white/90",children:i&&s.friendProfiles?.[0]?.avatar_url?e.jsx("img",{src:s.friendProfiles[0].avatar_url,alt:t||"Friend",className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("span",{children:a})}),n>0&&e.jsxs("div",{className:"grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-white/10 text-sm font-semibold text-white/90",children:["+",n]}),e.jsx("div",{className:"pr-1 text-sm font-semibold text-white/90",children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary",children:t}),e.jsx("span",{className:"text-white/80",children:" & others watched"})]}):e.jsx("span",{className:"text-white/80",children:"From friends"})})]})})()}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-x-0 bottom-0 h-[72%] bg-gradient-to-t from-black/85 via-black/40 to-transparent"}),e.jsxs("div",{className:"relative",children:[(()=>{const t=s.source??"for-you",n=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-primary/25 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-primary-foreground backdrop-blur",children:[e.jsx(v,{name:n.icon,filled:!0,className:"text-[18px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:n.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[xt,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h2",{className:"min-w-0 line-clamp-2 text-[length:var(--mn-swipe-title)] font-extrabold leading-[1.02] text-white",children:s.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:ht})]}),Ne&&e.jsxs("p",{className:"mt-1 text-[length:var(--mn-swipe-subtitle)] font-semibold text-white/60",children:["Directed by ",Ne.split(",")[0]]}),be&&e.jsx("div",{className:"mt-4 text-[length:var(--mn-swipe-meta)] text-white/70 whitespace-nowrap overflow-hidden text-ellipsis",children:be}),Array.isArray(s.friendProfiles)&&s.friendProfiles.length>0&&e.jsxs("button",{type:"button",onClick:()=>Fn(!0),className:"mt-5 flex w-full items-center justify-between gap-3 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-left backdrop-blur-md","aria-label":"See friends","data-swipe-interactive":"true",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fn,{profiles:s.friendProfiles,max:3,size:32}),e.jsxs("div",{className:"leading-tight",children:[e.jsxs("p",{className:"text-[length:var(--mn-swipe-subtitle)] font-extrabold text-white",children:[p(Math.round(sr),0,100),"% of friends"]}),e.jsxs("p",{className:"text-sm font-semibold text-white/60",children:[s.source==="from-friends"?"watched":"liked"," this title"]})]})]}),e.jsx("div",{className:"grid h-[var(--mn-swipe-hit)] w-[var(--mn-swipe-hit)] place-items-center rounded-full border border-white/10 bg-white/10 text-white/70",children:e.jsx(v,{name:"chevron_right",className:"text-[26px]"})})]}),on.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:on.map(t=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/10 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-white/75",children:["#",t]},t))})]})]})]}),ue&&s&&e.jsxs("div",{className:"absolute inset-0 z-10 flex h-full flex-col",children:[e.jsxs("div",{className:"relative h-[clamp(110px,32%,220px)] overflow-hidden bg-[#261933]",children:[Jt&&s.posterUrl?e.jsx(e.Fragment,{children:e.jsx("img",{src:s.posterUrl,alt:Ke(s)??`${s.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>et(!0),style:{filter:"blur(4px) brightness(0.65)",transform:"scale(1.12)"}})}):e.jsx(wt,{title:s.title}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/15 via-black/55 to-[#261933]"}),e.jsx("button",{type:"button",onClick:()=>Ee(!1),className:"absolute right-4 top-4 inline-flex h-10 w-10 items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/80 backdrop-blur hover:bg-white/15","aria-label":"Close details","data-swipe-interactive":"true",children:e.jsx(v,{name:"close",className:"text-[22px]"})})]}),e.jsx("div",{className:"relative flex min-h-0 flex-1 flex-col bg-[#261933] px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)] pt-[calc(var(--mn-swipe-pad)*0.75)]",children:e.jsxs("div",{ref:rt,id:"swipe-detail-panel","aria-label":Oe?"Full details":"Details summary","aria-live":"polite",className:"mt-1 flex min-h-0 flex-1 flex-col text-left text-[13px] text-white/70",children:[e.jsx("div",{"data-swipe-interactive":"true",className:"flex min-h-0 flex-1 flex-col overflow-hidden",children:Oe?e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[e.jsxs("div",{className:"shrink-0 space-y-2",children:[(()=>{const t=s.source??"for-you",n=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-[11px] font-semibold text-white/80",children:[e.jsx(v,{name:n.icon,filled:!0,className:"text-[16px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:n.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[xt,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"min-w-0 line-clamp-1 text-[clamp(1.05rem,4.6vw,1.35rem)] font-extrabold text-white",children:s.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-[11px] font-extrabold tracking-[0.14em] text-white/75",children:ht})]}),be&&e.jsx("p",{className:"text-[11px] text-white/55 whitespace-nowrap overflow-hidden text-ellipsis",children:be})]}),e.jsxs("div",{className:"min-h-0 flex-1 overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-2 gap-x-3 gap-y-2 rounded-2xl border border-white/10 bg-white/10 px-3 py-2 text-[11px] leading-snug text-white/75",children:(()=>{const t=[];if(Gt.length>0&&t.push({label:"Genres",value:Gt.slice(0,6).join(", ")}),Ht.length>0&&t.push({label:"Languages",value:Ht.slice(0,4).join(", ")}),Yt&&t.push({label:"Writers",value:Yt}),ke){const i=ke.split(",").map(a=>a.trim()).filter(Boolean).slice(3);i.length>0&&t.push({label:"More cast",value:i.slice(0,8).join(", ")})}return Xt&&t.push({label:"Released",value:Xt}),Ut&&t.push({label:"Awards",value:Ut}),Bt&&t.push({label:"Box office",value:Bt}),me&&T(me)!=null&&t.push({label:"IMDb",value:String(T(me)?.toFixed(1))}),ct&&T(ct)!=null&&t.push({label:"RT",value:`${String(T(ct))}%`}),ut&&pn(ut)&&t.push({label:"IMDb votes",value:String(pn(ut))}),dt&&T(dt)!=null&&t.push({label:"Metascore",value:String(T(dt))}),t.slice(0,8).map(n=>e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.14em] text-white/45",children:n.label}),e.jsx("p",{className:"line-clamp-2",children:n.value})]},n.label))})()}),We&&e.jsxs("div",{className:"mt-2 rounded-2xl border border-white/10 bg-white/10 px-3 py-2",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.14em] text-white/45",children:"Overview"}),e.jsx("p",{className:"mt-1 line-clamp-2 text-[11px] leading-relaxed text-white/70",children:We})]}),(()=>{const t=Or(g?.omdb_fetched_at),n=g?.omdb_status??null;if(!!!(t||n))return null;const a=[];return a.push(`OMDb: ${t??"—"}${n&&n!=="ok"?` (${n})`:""}`),e.jsxs("div",{className:"mt-2 rounded-2xl border border-white/10 bg-white/5 px-3 py-2",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.14em] text-white/45",children:"Data freshness"}),e.jsx("p",{className:"mt-1 text-[11px] leading-relaxed text-white/70",children:a.join(" • ")})]})})()]})]}):e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[e.jsxs("div",{className:"shrink-0 space-y-2",children:[(()=>{const t=s.source??"for-you",n=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-[11px] font-semibold text-white/80",children:[e.jsx(v,{name:n.icon,filled:!0,className:"text-[16px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:n.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[xt,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"min-w-0 line-clamp-2 text-[clamp(1.25rem,5vw,1.75rem)] font-extrabold leading-[1.06] text-white",children:s.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-[11px] font-extrabold tracking-[0.14em] text-white/75",children:ht})]}),be&&e.jsx("p",{className:"text-[clamp(0.78rem,2.8vw,0.95rem)] text-white/60 whitespace-nowrap overflow-hidden text-ellipsis",children:be}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 text-[clamp(0.70rem,2.6vw,0.8rem)] text-white/65",children:[$&&e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[e.jsx("span",{className:"shrink-0 font-semibold text-white/75",children:"Genres"}),e.jsx("span",{className:"min-w-0 flex-1 truncate",children:Array.isArray($)?$.slice(0,3).join(", "):String($).split(",").map(t=>t.trim()).slice(0,3).join(", ")})]}),Wt&&e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 font-semibold text-white/85",children:Wt}),Ot&&e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 font-semibold text-white/70",children:Ot})]})]}),We?e.jsxs("div",{className:"min-h-0 flex-1 space-y-1",children:[e.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-[0.16em] text-white/45",children:"Overview"}),e.jsx("p",{className:"line-clamp-4 sm:line-clamp-5 md:line-clamp-6 text-[clamp(0.82rem,2.9vw,0.95rem)] leading-relaxed text-white/70",children:We})]}):e.jsx("div",{className:"min-h-0 flex-1"}),Ne||ke?e.jsxs("div",{className:"shrink-0 space-y-1 text-[clamp(0.70rem,2.6vw,0.78rem)] text-white/70",children:[Ne&&e.jsxs("p",{className:"line-clamp-1",children:[e.jsx("span",{className:"font-semibold text-white/75",children:"Director:"})," ",e.jsx("span",{children:Ne})]}),ke&&e.jsxs("p",{className:"line-clamp-1",children:[e.jsx("span",{className:"font-semibold text-white/75",children:"Cast:"})," ",e.jsx("span",{children:ke.split(",").map(t=>t.trim()).filter(Boolean).slice(0,4).join(", ")})]})]}):null,e.jsxs("div",{className:"shrink-0 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1.5",children:[e.jsx("span",{className:"text-[11px] font-semibold text-white/50",children:"Your rating"}),e.jsx("div",{className:"flex items-center gap-0.5","aria-label":"Your rating",children:Array.from({length:5}).map((t,n)=>{const i=n+1,a=pt!=null&&pt>=i;return e.jsx("button",{type:"button",onClick:()=>Hn(i),className:"flex h-5 w-5 items-center justify-center rounded-full hover:scale-105 focus-visible:outline-none",children:e.jsx(v,{name:"star",filled:a,className:`text-[15px] ${a?"text-yellow-400":"text-white/30"}`})},i)})})]}),e.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{type:"button",onClick:()=>Kt(J),className:`inline-flex items-center rounded-full px-2.5 py-1 text-[11px] font-semibold transition-colors ${Vt(J)?"bg-primary/90 text-primary-foreground":"border border-white/10 bg-white/10 text-white/75 hover:bg-white/15"}`,children:"Watchlist"}),e.jsx("button",{type:"button",onClick:()=>Kt(ce),className:`inline-flex items-center rounded-full px-2.5 py-1 text-[11px] font-semibold transition-colors ${Vt(ce)?"bg-emerald-500/90 text-primary-foreground":"border border-white/10 bg-white/10 text-white/75 hover:bg-white/15"}`,children:"Watched"}),e.jsxs("button",{type:"button",onClick:()=>It(!0),className:"inline-flex items-center gap-1 rounded-full border border-white/10 bg-white/10 px-2.5 py-1 text-[11px] font-semibold text-white/75 hover:bg-white/15",children:[e.jsx(v,{name:"share",className:"text-[15px]"}),e.jsx("span",{className:"hidden sm:inline",children:"Share"})]})]})]}),typeof s.friendLikesCount=="number"&&s.friendLikesCount>0||s.topFriendName&&s.topFriendReviewSnippet?e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/10 px-3 py-2 text-[11px] text-white/80 shadow-md",children:[typeof s.friendLikesCount=="number"&&s.friendLikesCount>0&&e.jsxs("div",{className:"inline-flex items-center gap-1 text-[11px] text-white/60",children:[e.jsx(v,{name:"local_fire_department",filled:!0,className:"text-[16px] text-primary/80"}),s.friendLikesCount===1?"1 friend likes this":`${s.friendLikesCount} friends like this`]}),s.topFriendName&&s.topFriendReviewSnippet&&e.jsxs("div",{className:"mt-1 inline-flex w-full items-start gap-2 text-left",children:[e.jsx(v,{name:"check_circle",filled:!0,className:"mt-0.5 text-[16px] text-primary"}),e.jsxs("span",{className:"block line-clamp-2 text-[11px]",children:[s.topFriendName,": “",s.topFriendReviewSnippet,"”"]})]})]}):null]})]})}),e.jsx("div",{className:"mt-2 flex shrink-0 justify-end",children:e.jsx("button",{type:"button",onClick:()=>Ye(t=>!t),"aria-expanded":Oe,"aria-controls":"swipe-detail-panel",className:"inline-flex items-center gap-1 rounded-full border border-white/15 bg-white/5 px-2.5 py-1 text-[11px] font-semibold text-white/70 hover:bg-white/10 hover:text-white",children:e.jsx("span",{children:Oe?"Collapse":"Full details"})})})]})})]})]},F??"empty")})]}),Sn&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center bg-gradient-to-b from-background/70 via-background/50 to-background/80",children:e.jsxs("div",{className:"pointer-events-auto max-w-xs rounded-2xl border border-border bg-background/95 p-4 text-center shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Swipe to decide"}),e.jsx("p",{className:"mt-1 text-[12px] text-muted-foreground",children:"Swipe left to pass, right to save what you love."}),e.jsx("button",{type:"button",className:"mt-3 w-full rounded-xl bg-primary px-3 py-2 text-sm font-semibold text-white shadow-md",onClick:()=>{$e(!1),typeof window<"u"&&localStorage.setItem(Pe,"1")},children:"Got it"})]})})]})]}),e.jsxs("div",{className:"mt-2 flex shrink-0 items-center justify-center gap-[var(--mn-swipe-gap)]","aria-label":"Swipe actions",children:[e.jsx("button",{type:"button",onClick:()=>he("dislike"),disabled:Ce,className:"inline-flex h-[var(--mn-swipe-action)] w-[var(--mn-swipe-action)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/60 shadow-md backdrop-blur transition-all duration-150 hover:bg-white/15 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Dislike",children:e.jsx(v,{name:"close",className:"text-[length:var(--mn-swipe-icon)]"})}),e.jsx("button",{type:"button",onClick:qn,disabled:Ce,className:"relative inline-flex h-[var(--mn-swipe-action-primary)] w-[var(--mn-swipe-action-primary)] items-center justify-center rounded-full bg-primary text-primary-foreground shadow-[0_22px_55px_rgba(0,0,0,0.55)] transition-all duration-150 hover:brightness-110 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Add to watchlist",children:e.jsx(v,{name:"bookmark_add",filled:!0,className:"text-[length:var(--mn-swipe-icon-primary)]"})}),e.jsx("button",{type:"button",onClick:()=>he("like"),disabled:Ce,className:"inline-flex h-[var(--mn-swipe-action)] w-[var(--mn-swipe-action)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/60 shadow-md backdrop-blur transition-all duration-150 hover:bg-white/15 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Like",children:e.jsx(v,{name:"favorite",filled:!0,className:"text-[length:var(--mn-swipe-icon)]"})})]}),e.jsx(Xr,{isOpen:Ln,onClose:()=>It(!1),activeCard:s,shareUrl:Kn,onShareExternal:Vn}),e.jsx(Cr,{open:h,onOpenChange:N,children:e.jsxs(Tr,{className:"max-w-md border border-border/60 bg-card text-foreground",children:[e.jsxs(Fr,{children:[e.jsx(Ir,{children:"Filters"}),e.jsx(Ar,{className:"text-muted-foreground",children:"Fine-tune what shows up in your Discovery deck."})]}),e.jsxs("div",{className:"mt-2 space-y-5",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs font-semibold tracking-wide text-muted-foreground",children:"Content type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{label:"All",value:null},{label:"Movies",value:"movie"},{label:"Series",value:"series"},{label:"Anime",value:"anime"}].map(t=>{const n=o===t.value;return e.jsxs("button",{type:"button",onClick:()=>f(t.value),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",n?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[n?e.jsx(v,{name:"check_circle",filled:!0,className:"text-[18px] text-primary"}):e.jsx("span",{className:"h-4 w-4"}),t.label]},t.label)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide text-muted-foreground",children:"Genres"}),b.length>0&&e.jsx("button",{type:"button",onClick:()=>y([]),className:"text-xs font-semibold text-primary hover:underline",children:"Clear"})]}),kt.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Load a few cards to unlock genre filters."}):e.jsx("div",{className:"max-h-40 overflow-auto rounded-xl border border-border/60 bg-background/20 p-2",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:kt.map(t=>{const n=b.some(i=>i.toLowerCase()===t.toLowerCase());return e.jsx("button",{type:"button",onClick:()=>y(i=>n?i.filter(a=>a.toLowerCase()!==t.toLowerCase()):[...i,t]),className:["rounded-full border px-3 py-1 text-xs font-semibold transition",n?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-card/40 text-muted-foreground hover:bg-card/55"].join(" "),children:t},t)})})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide text-muted-foreground",children:"Minimum rating"}),e.jsx("div",{className:"text-xs font-semibold text-foreground",children:R<=0?"Any":R.toFixed(1)})]}),e.jsx("input",{type:"range",min:0,max:10,step:.5,value:R,onChange:t=>Y(Number(t.target.value)),className:"w-full"}),e.jsxs("div",{className:"mt-1 flex justify-between text-[11px] text-muted-foreground",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"10"})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{f(null),y([]),Y(0)},className:"flex-1 rounded-xl border border-border/60 bg-background/20 px-4 py-2 text-sm font-semibold text-muted-foreground hover:bg-background/35",children:"Reset"}),e.jsx("button",{type:"button",onClick:()=>N(!1),className:"flex-1 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground hover:opacity-90",children:"Done"})]})]})]})}),ir()]})]})},Xr=({isOpen:r,onClose:o,activeCard:f,shareUrl:h,onShareExternal:N})=>{const{user:b}=yn(),{data:y=[],isLoading:R}=jr();if(l.useEffect(()=>{if(!r)return;const k=U=>{U.key==="Escape"&&o()};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[r,o]),!r||!f)return null;const Y=`Check this out: ${f.title}

${h}`,se=k=>{k.target===k.currentTarget&&o()},Qe=k=>{(k.key==="Enter"||k.key===" ")&&o()};return e.jsx("div",{role:"button",tabIndex:0,className:"fixed inset-0 z-[9999] flex flex-col justify-end bg-black/55",onClick:se,onKeyDown:Qe,children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"pointer-events-auto mb-[72px] w-full max-w-md self-center rounded-t-2xl bg-card pb-3 pt-2 shadow-[0_-18px_45px_rgba(0,0,0,0.65)]",onClick:k=>k.stopPropagation(),onKeyDown:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[e.jsx("button",{type:"button","aria-hidden":"true",tabIndex:-1,className:"rounded-full p-1 text-muted-foreground",children:e.jsx(v,{name:"search",className:"text-[18px]"})}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Send to"}),e.jsx("button",{type:"button",onClick:o,className:"rounded-full p-1 text-muted-foreground hover:bg-background/80",children:e.jsx("span",{className:"text-[18px] leading-none",children:"×"})})]}),e.jsxs("section",{className:"border-t border-border px-4 pt-3 pb-2",children:[e.jsx("h2",{className:"mb-2 text-[12px] font-medium uppercase tracking-[0.08em] text-muted-foreground/90",children:"Send to"}),R?e.jsx("div",{className:"flex gap-3 overflow-hidden",children:Array.from({length:4}).map((k,U)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"h-11 w-11 animate-pulse rounded-full bg-border/50"}),e.jsx("div",{className:"h-2.5 w-12 animate-pulse rounded bg-border/40"})]},U))}):b?y.length===0?e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"No conversations yet. Start a chat from a profile or the Messages tab."}):e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:y.map(k=>e.jsx(zr,{conversation:k,text:Y},k.id))}):e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"Sign in to share via messages."})]}),e.jsx("section",{className:"border-t border-border px-4 pt-3 pb-3",children:e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:[e.jsx(qr,{shareUrl:h,title:f.title}),e.jsx(Gr,{shareUrl:h,title:f.title}),e.jsx(Hr,{onShareExternal:N}),e.jsx(Wr,{shareUrl:h})]})})]})})},zr=({conversation:r,text:o})=>{const f=r.isGroup?null:r.participants?.find(Y=>!Y.isSelf)??r.participants?.[0],h=f?.displayName??r.title??"Conversation",N=f?.avatarUrl,b=Rr(r.id),y=()=>{b.isPending||b.mutate({text:o})},R=h.split(" ").map(Y=>Y.charAt(0).toUpperCase()).slice(0,2).join("");return e.jsxs("button",{type:"button",onClick:y,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center overflow-hidden rounded-full bg-muted text-xs text-muted-foreground",children:N?e.jsx("img",{src:N,alt:h,className:"h-full w-full object-cover"}):e.jsx("span",{children:R})}),b.isSuccess&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-emerald-500",children:e.jsx(v,{name:"check",filled:!0,className:"text-[14px] text-primary-foreground"})})]}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:h})]})},Wr=({shareUrl:r})=>{const o=async()=>{if(navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(r)}catch{}};return e.jsxs("button",{type:"button",onClick:o,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx(v,{name:"link",className:"text-[18px] text-primary-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Copy link"})]})},qr=({shareUrl:r,title:o})=>{const f=()=>{if(typeof window>"u")return;const h=`Check this out: ${o}

${r}`,N=`https://api.whatsapp.com/send?text=${encodeURIComponent(h)}`;window.open(N,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:f,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"W"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"WhatsApp"})]})},Gr=({shareUrl:r,title:o})=>{const f=()=>{if(typeof window>"u")return;const h=`Check this out: ${o}

${r}`,N=`https://t.me/share/url?url=${encodeURIComponent(r)}&text=${encodeURIComponent(h)}`;window.open(N,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:f,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"T"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Telegram"})]})},Hr=({onShareExternal:r})=>{const o=async()=>{await r()};return e.jsxs("button",{type:"button",onClick:o,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full border border-border bg-muted",children:e.jsx(v,{name:"more_horiz",className:"text-[18px] text-muted-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"More"})]})};export{us as default};
