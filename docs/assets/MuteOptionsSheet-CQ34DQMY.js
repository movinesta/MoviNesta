import{C as m,s as n,j as e,B as f}from"./index-DHFRnTo7.js";import{D as p,a as x,c as h}from"./dialog-Bg-HG0JV.js";import{M as b}from"./material-icon-CCSOLX5B.js";import{C as g}from"./clock-CcMzpr3g.js";const _=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],v=m("bell-off",_),d=t=>t.code==="42P10"||/no unique or exclusion constraint matching the ON CONFLICT specification/i.test(t.message??""),u=t=>t.code==="23505"||/duplicate key value violates unique constraint/i.test(t.message??"");let l=null,c=null;const R=async t=>{if(l!==!1){const{error:s}=await n.from("message_delivery_receipts").upsert(t,{onConflict:"conversation_id,message_id,user_id"});if(!s){l=!0;return}if(d(s))l=!1;else{console.error("[writeDeliveryReceipt] Failed to write delivery receipt",s);return}}const{error:r}=await n.from("message_delivery_receipts").insert(t);r&&!u(r)&&console.error("[writeDeliveryReceipt] Failed to insert delivery receipt",r)},M=async t=>{if(c!==!1){const{error:s}=await n.from("message_read_receipts").upsert(t,{onConflict:"conversation_id,user_id"});if(!s){c=!0;return}if(d(s))c=!1;else{console.error("[writeReadReceipt] Failed to write read receipt",s);return}}const{error:r}=await n.from("message_read_receipts").insert(t);r&&!u(r)&&console.error("[writeReadReceipt] Failed to insert read receipt",r)},D=async(t,r)=>{const{error:s}=await n.from("message_read_receipts").delete().eq("conversation_id",t).eq("user_id",r);if(!s)return{ok:!0};const a={conversation_id:t,user_id:r,last_read_message_id:null,last_read_at:new Date(0).toISOString()},{error:o}=await n.from("message_read_receipts").upsert(a,{onConflict:"conversation_id,user_id"});if(!o)return{ok:!0};if(d(o)){const{error:i}=await n.from("message_read_receipts").insert(a);return!i||u(i)?{ok:!0}:{ok:!1,error:i}}return{ok:!1,error:o}},w=[{kind:"duration",minutes:60,label:"1 hour",description:"Mute notifications for 1 hour"},{kind:"duration",minutes:480,label:"8 hours",description:"Mute notifications for 8 hours"},{kind:"duration",minutes:1440,label:"24 hours",description:"Mute notifications for 24 hours"},{kind:"indefinite",label:"Until I turn it back on",description:"Mute notifications until you unmute manually"}],y=({icon:t,title:r,description:s,onClick:a})=>e.jsxs("button",{type:"button",onClick:a,className:"flex w-full items-center gap-3 rounded-2xl px-3 py-3 text-left transition hover:bg-muted/60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/30",children:[e.jsx("span",{className:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-muted/80",children:t}),e.jsxs("span",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"block truncate text-sm font-semibold",children:r}),e.jsx("span",{className:"block truncate text-xs text-muted-foreground",children:s})]})]}),E=({open:t,onOpenChange:r,conversationTitle:s,onSelect:a})=>{const o=()=>r(!1);return e.jsx(p,{open:t,onOpenChange:r,children:e.jsxs(x,{className:"left-0 right-0 top-auto bottom-0 w-full max-w-none translate-x-0 translate-y-0 rounded-t-3xl rounded-b-none border border-border bg-card p-4",children:[e.jsx("div",{className:"mx-auto mb-2 h-1.5 w-12 rounded-full bg-muted","aria-hidden":!0}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(h,{className:"text-center text-base text-foreground",children:"Mute notifications"}),e.jsx("p",{className:"mt-1 text-center text-xs text-muted-foreground",children:s||"Choose a duration"})]}),e.jsx("button",{type:"button",onClick:o,className:"rounded-full p-2 text-muted-foreground transition hover:bg-muted/60 hover:text-foreground","aria-label":"Close",children:e.jsx(b,{name:"close"})})]}),e.jsx("div",{className:"mt-3 space-y-1",children:w.map(i=>e.jsx(y,{icon:i.kind==="duration"?e.jsx(g,{className:"h-5 w-5 text-muted-foreground","aria-hidden":!0}):e.jsx(v,{className:"h-5 w-5 text-muted-foreground","aria-hidden":!0}),title:i.label,description:i.description,onClick:()=>{a(i),o()}},i.label))}),e.jsx("div",{className:"pt-3",children:e.jsx(f,{type:"button",variant:"ghost",className:"w-full rounded-2xl border border-border bg-muted/60 text-foreground hover:bg-muted",onClick:o,children:"Cancel"})})]})})};export{v as B,E as M,R as a,D as c,M as w};
