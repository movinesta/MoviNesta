import{n as Oe,o as gt,e as br,r as a,h as xs,k as hs,l as bs,v as ws,w as wr,x as nr,q as Je,t as rr,y as gs,j as e,B as vs,u as gr,s as Wt,R as sr,b as vr,c as un,z as ys,A as js}from"./index-BhQyicj1.js";import{M as j}from"./material-icon-s6Itatep.js";import{b as Ns}from"./useDiaryLibrary-BQmYZ8Sa.js";import{u as ks}from"./scroll-area-keIy_duf.js";import"./textarea-CD0PbG86.js";import{D as yr,a as jr,b as Nr,c as kr,d as _s}from"./dialog-CtOddV94.js";import{a as Ms}from"./appUrl-BIFKGN0O.js";import{F as ir}from"./FriendAvatarStack-CAUR3-s6.js";import{V as Ss}from"./VerifiedBadge-Mnb7GTth.js";import"./conversationsCache-D_5D90F9.js";import"./format-BXv9LLlt.js";import"./external-link-CQrupp72.js";import"./plus-DLHoHRQq.js";import"./x-mv29V4jj.js";import"./copy-5oWhKRql.js";import"./circle-alert-CS6usyAY.js";import"./index-DvH4qpt5.js";const xn="movi_swipe_event_queue_v1";function Rs(n){if(!n)return[];try{const i=JSON.parse(n);return Array.isArray(i)?i.filter(Boolean):[]}catch{return[]}}function hn(){return Rs(gt(xn))}function Cs(n){const i=hn();i.push({...n,queuedAt:Date.now()});const o=i.slice(-200);Oe(xn,JSON.stringify(o))}function Fs(n){if(!n.length)return;const i=new Set(n),o=hn().filter(b=>!b.clientEventId||!i.has(b.clientEventId));Oe(xn,JSON.stringify(o))}function Ts(n){return"combined"}function Is(n){if(!n)return null;const i=n.replace("-","_");return i==="for_you"?"for-you":i==="friends"?"from-friends":i==="trending"?"trending":i==="popular"?"popular":i==="explore"?"explore":i==="combined"?"combined":null}function ar(n){return n==="like"?"like":n==="dislike"?"dislike":"skip"}function Qe(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():gs()}function As(n){const i=typeof n.posterUrl=="string"?n.posterUrl.trim():"",o=(i&&i.toLowerCase()!=="n/a"?i:"")||(n.tmdbPosterPath?rr(n.tmdbPosterPath,"w500")??"":"")||(n.tmdbBackdropPath?rr(n.tmdbBackdropPath,"w780")??"":"");if(!o)return null;const b=(n.title??"").trim()||"Untitled";return{...n,posterUrl:o,title:b}}function Es(n,i){if(typeof window>"u"||i<=0||navigator.connection?.saveData)return;const R=window.requestIdleCallback??(g=>window.setTimeout(g,300)),w=n.slice(0,i);R(()=>{for(const g of w){if(!g.posterUrl)continue;const S=new Image;S.decoding="async",S.loading="lazy",S.src=g.posterUrl}})}function Ps(n,i){const o=i?.limit??60,b=i?.prefetchImages??6,R=i?.dwellThresholdMs??1200,w=i?.dwellDebounceMs??8e3,g=i?.invalidateHomeQueries??!1,S=br();a.useEffect(()=>{let s=!1;const u=async()=>{if(s)return;const T=hn();if(!T.length)return;const Y=[];for(const V of T)try{(await nr(V)).ok&&V.clientEventId&&Y.push(V.clientEventId)}catch{break}Y.length&&Fs(Y)};u();const P=()=>{u()};return window.addEventListener("online",P),()=>{s=!0,window.removeEventListener("online",P)}},[]);const N=a.useMemo(()=>xs(),[]),X=a.useMemo(()=>Ts(),[n]),A=a.useRef(new Set),_=a.useRef(!1),U=a.useRef(0),me=a.useRef(null),xe=a.useRef(new Set),O=a.useRef(new Map),[te,Xt]=a.useState({status:"idle",cards:[],errorMessage:null}),[he,et]=a.useState(null),K=a.useCallback(s=>{Xt(u=>typeof s=="function"?s(u):s)},[]),yt=a.useCallback(s=>{if(!s.length)return 0;const u=A.current,P=[];for(const T of s){if(u.has(T.id))continue;const Y=As(T);u.add(T.id),Y&&P.push(Y)}return P.length?(K(T=>{const Y={...T,status:"ready",cards:[...T.cards,...P],errorMessage:null};return Es(P,b),Y}),P.length):0},[b,K]),Te=a.useCallback(async(s=o)=>{if(!_.current){_.current=!0,K(u=>({...u,status:u.cards.length?"ready":"loading",errorMessage:null}));try{const u=i?.kindFilter??null,P=i?.seed??hs(N,X,u);me.current!==P&&(me.current=P,U.current=0);const T=3;let Y=0,V=0;for(;Y<T&&V===0;){const _e=`${P}:${U.current}`;U.current+=1;const kt=await bs({sessionId:N,mode:X,kindFilter:u??void 0,limit:s,seed:_e,minImdbRating:i?.minImdbRating??null,genresAny:i?.genresAny??null},{timeoutMs:25e3}),_t=kt.deckId,Ue=(kt.cards??[]).map((Me,pe)=>({...Me,id:Me.mediaItemId,deckId:_t,position:pe,source:Is(Me.source??n)}));if(!Ue.length){K(Me=>({...Me,status:Me.cards.length?"ready":"exhausted",errorMessage:null}));return}if(V=yt(Ue),V>0)break;Y+=1,console.warn("[useMediaSwipeDeck] filtered out all cards (missing OMDb poster?). Retrying...",{attempt:Y,mode:X,kind:n,batchSize:s})}V===0&&K(_e=>({..._e,status:_e.cards.length?"ready":"exhausted",errorMessage:null}))}catch(u){const P=u instanceof Error?u.message:typeof u=="string"?u:"We couldn't load swipe cards.";K(T=>({...T,status:"error",errorMessage:P}))}finally{_.current=!1}}},[yt,o,X,i?.kindFilter,i?.minImdbRating,JSON.stringify(i?.genresAny??[]),i?.seed,N,K]);a.useEffect(()=>{A.current=new Set,xe.current=new Set,O.current=new Map,_.current=!1,K({status:"loading",cards:[],errorMessage:null}),Te(o)},[Te,n,o,i?.kindFilter,i?.minImdbRating,JSON.stringify(i?.genresAny??[]),K]);const jt=a.useCallback(()=>{i?.seed==null&&ws(N,X,i?.kindFilter??null),U.current=0,A.current=new Set,xe.current=new Set,O.current=new Map,_.current=!1,K({status:"loading",cards:[],errorMessage:null}),Te(o)},[Te,o,X,i?.kindFilter,i?.minImdbRating,JSON.stringify(i?.genresAny??[]),i?.seed,N,K]),tt=a.useCallback(s=>{s<=0||K(u=>({...u,cards:u.cards.slice(Math.min(s,u.cards.length))}))},[K]),H=wr({mutationFn:async s=>nr(s,{timeoutMs:2e4}),onError:(s,u)=>{const P=s instanceof Error?s.message:typeof s=="string"?s:"We couldn't save that action.";Cs(u),et({payload:u,message:P})},onSuccess:()=>{et(null),g&&(S.invalidateQueries({queryKey:Je.homeFeed(null)}),S.invalidateQueries({queryKey:Je.homeForYou(null)}))}}),D=a.useCallback((s,u)=>{if(!s)return;const P=`${s.deckId}:${s.id}`;xe.current.has(P)||(xe.current.add(P),H.mutate({sessionId:N,deckId:s.deckId,position:u??s.position,mediaItemId:s.id,eventType:"impression",source:s.source??null,clientEventId:Qe()}))},[H,N]),Nt=a.useCallback((s,u,P)=>{if(!s||!Number.isFinite(u)||u<R)return;const T=`${s.deckId}:${s.id}`,Y=Date.now(),V=O.current.get(T)??0;Y-V<w||(O.current.set(T,Y),H.mutate({sessionId:N,deckId:s.deckId,position:P??s.position,mediaItemId:s.id,eventType:"dwell",dwellMs:Math.round(u),source:s.source??null,clientEventId:Qe()}))},[w,R,H,N]),Be=a.useCallback(s=>{const u=s.card;H.mutate({sessionId:N,deckId:u.deckId,position:u.position,mediaItemId:u.id,eventType:ar(s.direction),source:u.source??null,clientEventId:Qe()})},[H,N]),G=a.useCallback(async s=>{const u=s.card;return H.mutateAsync({sessionId:N,deckId:u.deckId,position:u.position,mediaItemId:u.id,eventType:ar(s.direction),source:u.source??null,clientEventId:Qe()})},[H,N]),ke=a.useCallback(s=>{const u={...s,sessionId:s.sessionId??N,clientEventId:s.clientEventId??Qe()};H.mutate(u)},[H,N]),E=a.useCallback(async s=>{const u={...s,sessionId:s.sessionId??N,clientEventId:s.clientEventId??Qe()};try{await H.mutateAsync(u)}catch{}},[H,N]);return{sessionId:N,mode:X,cards:te.cards,status:te.status,isLoading:te.status==="loading",isError:te.status==="error",isExhausted:te.status==="exhausted",deckError:te.errorMessage??null,fetchMore:Te,refresh:jt,trimConsumed:tt,trackImpression:D,trackDwell:Nt,sendEvent:ke,sendEventAsync:E,swipe:Be,swipeAsync:G,swipeSyncError:he?.message??null,retryFailedSwipe:()=>{he&&H.mutate(he.payload)},isRetryingSwipe:H.isPending&&!!he}}const x=(n,i,o)=>Math.min(o,Math.max(i,n)),ne=n=>{if(!n)return null;const i=n.trim();return!i||i.toUpperCase()==="N/A"?null:i},lr=n=>{if(!n||n<=0)return null;const i=Math.floor(n/60),o=n%60;return i===0?`${o}m`:o===0?`${i}h`:`${i}h ${o}m`},Ls=n=>{const i=ne(n);if(!i)return null;const o=i.toLowerCase();return o==="united states"||o==="united states of america"?"US":o==="united kingdom"||o==="great britain"?"UK":o==="canada"?"CA":o==="australia"?"AU":o==="germany"?"DE":o==="france"?"FR":o==="spain"?"ES":o==="italy"?"IT":o==="japan"?"JP":o==="south korea"||o==="republic of korea"?"KR":i.length<=3?i.toUpperCase():i},J=n=>{if(n==null)return null;if(typeof n=="number")return Number.isNaN(n)?null:n;const i=parseFloat(n);return Number.isNaN(i)?null:i},or=n=>{const i=J(n);return i==null?null:Math.round(i).toLocaleString()},qt=n=>{if(!n)return;const i=[];n.year&&i.push(String(n.year));const o=[];typeof n.imdbRating=="number"&&!Number.isNaN(n.imdbRating)&&o.push(`IMDb ${n.imdbRating.toFixed(1)}`),typeof n.rtTomatoMeter=="number"&&!Number.isNaN(n.rtTomatoMeter)&&o.push(`${n.rtTomatoMeter}% Rotten Tomatoes`);const b=[...i,...o].filter(Boolean).join(" · ");return b?`${n.title} (${b})`:n.title},Ds=({message:n,onRetry:i,isRetrying:o})=>n?e.jsx("div",{className:"mx-3 mb-3 rounded-md border border-amber-500/60 bg-amber-500/10 px-3 py-2 text-xs text-amber-50",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(j,{name:"error",className:"mt-0.5 text-[18px]",ariaLabel:"Error"}),e.jsxs("div",{className:"flex flex-1 flex-col gap-1",children:[e.jsx("p",{className:"leading-snug",children:n}),e.jsxs(vs,{type:"button",variant:"outline",size:"sm",onClick:i,disabled:o,children:[e.jsx(j,{name:"refresh",className:"text-[18px]",ariaLabel:"Retry"}),o?"Retrying…":"Retry"]})]})]})}):null,mn=({title:n})=>e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-background via-card to-background text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-card/70 shadow-md",children:e.jsx(j,{name:"image_not_supported",className:"text-[24px] text-muted-foreground"})}),e.jsx("span",{className:"text-[12px] font-semibold",children:"Artwork unavailable"}),n&&e.jsxs("span",{className:"max-w-[240px] truncate text-xs text-muted-foreground/80",children:["for ",n]})]})});function $s(n){const i=n.trim().split(/\s+/).filter(Boolean);if(!i.length)return"?";const o=i[0]?.[0]??"?",b=i.length>1?i[i.length-1]?.[0]??"":"";return(o+b).toUpperCase()}function Os({open:n,onOpenChange:i,profiles:o,verb:b}){const R=gr(),w=Array.isArray(o)?o.filter(Boolean):[],g=a.useMemo(()=>w.map(A=>A.id).filter(Boolean),[w]),[S,N]=a.useState({});a.useEffect(()=>{let A=!1;async function _(){if(!n||g.length===0)return;const{data:U,error:me}=await Wt.from("profiles_public").select("id,is_verified,verified_type,verified_label,verified_at,verified_by_org").in("id",g);if(A||me)return;const xe={};for(const O of U??[])O?.id&&(xe[O.id]={is_verified:O.is_verified??null,verified_type:O.verified_type??null,verified_label:O.verified_label??null,verified_at:O.verified_at??null,verified_by_org:O.verified_by_org??null});N(xe)}return _(),()=>{A=!0}},[n,g.join("|")]);const X=w.length?`Friends who ${b}`:`No friends ${b} yet`;return e.jsx(yr,{open:n,onOpenChange:i,children:e.jsxs(jr,{className:"max-w-md border border-border/60 bg-card text-foreground",children:[e.jsx(Nr,{children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx(kr,{className:"text-base font-semibold text-foreground",children:X}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"-mr-2 icon-hit border border-border/60 bg-background/60 hover:bg-background/80","aria-label":"Close","data-swipe-interactive":"true",children:e.jsx(j,{name:"close",className:"text-[22px]"})})]})}),w.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Once friends interact with titles, they’ll show up here."}):e.jsx("div",{className:"mt-2 max-h-[60vh] overflow-y-auto pr-1",children:e.jsx("div",{className:"space-y-2",children:w.map(A=>{const _=(A.display_name??A.username??"Friend").trim()||"Friend",U=(A.username??"").trim(),me=$s(_);return e.jsxs("button",{type:"button",className:"flex w-full items-center gap-3 rounded-2xl border border-border/60 bg-background/40 px-3 py-2.5 text-left transition hover:bg-background/70",onClick:()=>{U&&(i(!1),R(`/u/${U}`))},"aria-label":U?`Open ${_} profile`:_,"data-swipe-interactive":"true",children:[e.jsx("div",{className:"h-10 w-10 overflow-hidden rounded-full border border-border/60 bg-muted",children:A.avatar_url?e.jsx("img",{src:A.avatar_url,alt:_,className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"grid h-full w-full place-items-center text-xs font-semibold text-foreground/80",children:me})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-1",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:_}),e.jsx(Ss,{isVerified:S[A.id]?.is_verified,type:S[A.id]?.verified_type,label:S[A.id]?.verified_label,verifiedAt:S[A.id]?.verified_at,org:S[A.id]?.verified_by_org,className:"shrink-0 rounded-full p-0.5 text-primary/90 hover:text-primary"})]}),U?e.jsxs("div",{className:"truncate text-xs text-muted-foreground",children:["@",U]}):e.jsx("div",{className:"truncate text-xs text-muted-foreground",children:"Profile unavailable"})]}),e.jsx("div",{className:"grid h-9 w-9 place-items-center rounded-full border border-border/60 bg-background/60 text-muted-foreground",children:e.jsx(j,{name:"chevron_right",className:"text-[22px]"})})]},A.id)})})})]})})}const bt="mn_swipe_onboarding_seen",cr="mn_swipe_sfx_enabled",dr="mn_swipe_haptics_enabled",Bs={floaty_gamey:{distanceWidthFactor:.22,distanceMin:86,distanceMax:140,intentFactor:.35,intentMin:30,intentMax:52,velocityThreshold:.55,velocityProjectionMs:220,dragFollowAlpha:.22,rotationFactor:15,rotateZCap:18,rotateYCap:14,rotateXCap:7,undercardTranslateY:8,undercardBlurMax:1.4,punchScale:1.015,punchDurationMs:140,burstBaseCount:12,burstDurationMs:520}},B=Bs.floaty_gamey,Us=88,vt=(n,i=1)=>{const o=typeof n=="number"&&Number.isFinite(n)&&n>0?n:typeof window<"u"?window.innerWidth:Us;return x(o*B.distanceWidthFactor*i,B.distanceMin,B.distanceMax)},ur=(n,i=1)=>x(Math.round(vt(n,i)*B.intentFactor),B.intentMin,B.intentMax),zs=(n,i)=>{const o=Math.abs(n);if(o<=i)return n;const b=o-i;return Math.sign(n)*(i+b*.18)},pn=8,Ys=1.25,qs=1.6,Ws=.25,mr=120,fn=14,Xs=70,pr=B.velocityThreshold,wt=220,Hs=360,fr=B.rotationFactor,Ks=`
@keyframes mn-swipe-burst {
  0% { transform: translate3d(0px,0px,0px) rotate(0deg) scale(1); opacity: 0.95; }
  100% { transform: translate3d(var(--dx, 0px), var(--dy, 0px), 0px) rotate(var(--rot, 0deg)) scale(var(--s, 1)); opacity: 0; }
}
.mn-swipe-burst-dot {
  position: absolute;
  left: var(--x, 0px);
  top: var(--y, 0px);
  width: var(--sz, 8px);
  height: var(--sz, 8px);
  border-radius: 9999px;
  filter: blur(0px);
  will-change: transform, opacity;
  animation: mn-swipe-burst var(--dur, 520ms) cubic-bezier(0.18, 0.78, 0.22, 1) forwards;
}
.mn-swipe-burst-dot[data-shape="square"] { border-radius: 6px; }
@media (prefers-reduced-motion: reduce) {
  .mn-swipe-burst-dot { animation: none !important; opacity: 0 !important; }
}
`,Gs={"--mn-swipe-radius":"clamp(26px, min(6vw, 4.2vh), 44px)","--mn-swipe-pad":"clamp(12px, min(4.6vw, 3.2vh), 24px)","--mn-swipe-kicker":"clamp(10px, min(2.5vw, 1.45vh), 12px)","--mn-swipe-header":"clamp(1.05rem, min(4.2vw, 2.6vh), 1.35rem)","--mn-swipe-top-hit":"clamp(2.25rem, min(9vw, 5.2vh), 2.9rem)","--mn-swipe-top-icon":"clamp(22px, min(5.6vw, 3.2vh), 30px)","--mn-swipe-title":"clamp(1.6rem, min(6.6vw, 4.4vh), 2.6rem)","--mn-swipe-subtitle":"clamp(0.92rem, min(3.6vw, 2.2vh), 1.15rem)","--mn-swipe-meta":"clamp(0.88rem, min(3.2vw, 2.0vh), 1.08rem)","--mn-swipe-chip":"clamp(0.72rem, min(2.9vw, 1.75vh), 0.9rem)","--mn-swipe-hit":"clamp(2.25rem, min(9vw, 5.5vh), 2.85rem)","--mn-swipe-gap":"clamp(1.35rem, min(6.2vw, 3.7vh), 2.5rem)","--mn-swipe-action":"clamp(3.1rem, min(12.5vw, 7.0vh), 4.1rem)","--mn-swipe-action-primary":"clamp(4.4rem, min(17.5vw, 9.2vh), 6.1rem)","--mn-swipe-icon":"clamp(22px, min(5.5vw, 3.4vh), 30px)","--mn-swipe-icon-primary":"clamp(32px, min(8.5vw, 4.8vh), 46px)","--mn-swipe-star-hit":"clamp(18px, min(5vw, 2.8vh), 24px)","--mn-swipe-star-icon":"clamp(14px, min(3.8vw, 2.1vh), 19px)"},_r=n=>{if(n==null)return null;const i=String(n).trim();if(!i)return null;const o=i.replace(/%/g,""),b=Number(o);return Number.isFinite(b)?b:null},Vs=n=>{if(n==null)return null;const i=Math.round(n);return i<=0?null:Math.min(10,Math.max(2,i*2))},Qs=n=>{const i=(()=>{const w=String(n?.source??"").trim();if(!w)return null;const g=w.replace("-","_");return g==="for_you"||g==="for-you"?"for-you":g==="friends"||g==="from_friends"||g==="from-friends"?"from-friends":g==="trending"?"trending":g==="popular"?"popular":g==="combined"?"combined":g==="explore"?"explore":null})(),o=n?.kind==="series"?"series":n?.kind==="anime"?"anime":"movie",b=typeof n?.releaseYear=="number"?n.releaseYear:n?.releaseYear!=null?Number(n.releaseYear):null,R=typeof n?.runtimeMinutes=="number"?n.runtimeMinutes:n?.runtimeMinutes!=null?Number(n.runtimeMinutes):null;return{id:String(n?.id??""),title:String(n?.title??"Untitled"),deckId:n?.deckId??null,position:typeof n?.position=="number"?n.position:n?.position!=null?Number(n.position):null,year:Number.isFinite(b)?b:null,type:o,runtimeMinutes:Number.isFinite(R)?R:null,tagline:n?.tagline??null,mood:n?.mood??null,vibeTag:n?.vibeTag??null,posterUrl:n?.posterUrl??null,tmdbPosterPath:n?.tmdbPosterPath??null,tmdbBackdropPath:n?.tmdbBackdropPath??null,source:i,why:n?.why??null,friendIds:Array.isArray(n?.friendIds)?n.friendIds:null,friendProfiles:Array.isArray(n?.friendProfiles)?n.friendProfiles:null,friendLikesCount:typeof n?.friendLikesCount=="number"?n.friendLikesCount:Array.isArray(n?.friendProfiles)?n.friendProfiles.length:Array.isArray(n?.friendIds)?n.friendIds.length:null,topFriendName:Array.isArray(n?.friendProfiles)&&n.friendProfiles[0]?String(n.friendProfiles[0].display_name??n.friendProfiles[0].username??""):n?.topFriendName??null,topFriendInitials:n?.topFriendInitials??null,topFriendReviewSnippet:n?.topFriendReviewSnippet??null,overview:n?.overview??null,genres:Array.isArray(n?.genres)?n.genres:null,language:n?.language??null,country:n?.country??null,initialRating:typeof n?.initialRating=="number"?n.initialRating:n?.initialRating!=null?Number(n.initialRating):null,initiallyInWatchlist:!!n?.initiallyInWatchlist,imdbRating:typeof n?.imdbRating=="number"?n.imdbRating:n?.imdbRating!=null?Number(n.imdbRating):null,rtTomatoMeter:typeof n?.rtTomatoMeter=="number"?n.rtTomatoMeter:n?.rtTomatoMeter!=null?Number(n.rtTomatoMeter):null}};function xr(n){const{card:i,friendCount:o,imdb:b,rt:R}=n;let w=74;const g=i?.source??null;g==="for-you"&&(w+=10),g==="from-friends"&&(w+=7),g==="trending"&&(w+=4),g==="popular"&&(w+=2);const S=typeof i?.friendLikesCount=="number"?i.friendLikesCount:0;if(S>0){const X=o>0?S/Math.max(1,o)*18:Math.min(12,S*3);w+=X}b!=null&&(w+=(b-7)*4),R!=null&&(w+=(R-70)*.15),i?.why&&(w+=3);const N=Math.round(w);return Math.round(x(N,55,99))}const hr=async n=>{const{data:i,error:o}=await Wt.from("media_items").select("id, kind, omdb_plot, omdb_director, omdb_writer, omdb_actors, omdb_genre, omdb_language, omdb_country, omdb_imdb_rating, omdb_imdb_votes, omdb_metascore, omdb_rating_rotten_tomatoes, omdb_poster, omdb_awards, omdb_box_office, omdb_released, omdb_rated, omdb_runtime, omdb_fetched_at, omdb_status, omdb_error").eq("id",n).maybeSingle();if(o)throw o;if(!i)return null;const b=i.omdb_genre!=null?String(i.omdb_genre).split(",").map(w=>w.trim()).filter(Boolean):null,R=_r(i.omdb_rating_rotten_tomatoes);return{title_id:i.id,content_type:i.kind??null,plot:i.omdb_plot??null,omdb_director:i.omdb_director??null,omdb_writer:i.omdb_writer??null,omdb_actors:i.omdb_actors??null,genres:b,omdb_language:i.omdb_language??null,omdb_country:i.omdb_country??null,imdb_rating:i.omdb_imdb_rating??null,imdb_votes:i.omdb_imdb_votes??null,metascore:i.omdb_metascore??null,rt_tomato_pct:R,poster_url:i.omdb_poster??null,omdb_awards:i.omdb_awards??null,omdb_box_office_str:i.omdb_box_office??null,omdb_box_office:null,omdb_released:i.omdb_released??null,omdb_rated:i.omdb_rated??null,omdb_runtime:i.omdb_runtime??null,omdb_fetched_at:i.omdb_fetched_at??null,omdb_status:i.omdb_status??null,omdb_error:i.omdb_error??null}},Fe="want_to_watch",Ze="watched",ji=()=>{const n=gr(),[i,o]=a.useState(null),[b,R]=a.useState(!1),[w,g]=a.useState([]),[S,N]=a.useState(0),[X,A]=a.useState({w:0,h:0});a.useEffect(()=>{if(typeof window>"u")return;let t=0;const r=()=>{cancelAnimationFrame(t),t=requestAnimationFrame(()=>{A({w:window.innerWidth,h:window.innerHeight})})};return r(),window.addEventListener("resize",r,{passive:!0}),window.addEventListener("orientationchange",r,{passive:!0}),()=>{cancelAnimationFrame(t),window.removeEventListener("resize",r),window.removeEventListener("orientationchange",r)}},[]);const _=a.useMemo(()=>{const t=X.h||844;return t<640?4:t<720?5:t<820?6:t<920?7:8},[X.h]),U=a.useMemo(()=>x(_+2,6,10),[_]),{cards:me,sessionId:xe,isLoading:O,isError:te,swipe:Xt,fetchMore:he,trimConsumed:et,swipeSyncError:K,retryFailedSwipe:yt,isRetryingSwipe:Te,trackImpression:jt,trackDwell:tt,sendEventAsync:H}=Ps("combined",{limit:72,kindFilter:i,minImdbRating:S>0?S:null,genresAny:w.length?w:null}),D=a.useMemo(()=>me.map(Qs),[me]),Nt=a.useMemo(()=>{const t=new Set;for(const r of D){const l=r?.genres??[];for(const c of l){const d=String(c??"").trim();d&&t.add(d)}}return Array.from(t).sort((r,l)=>r.localeCompare(l))},[D]),Be=sr.useCallback(t=>{if(!t)return!1;if(w.length){const r=Array.isArray(t.genres)?t.genres:[],l=new Set(r.map(d=>String(d).toLowerCase()));if(!w.some(d=>l.has(String(d).toLowerCase())))return!1}if(S>0){const r=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)?t.imdbRating:null;if(r!=null&&r<S)return!1}return!0},[w,S]),[G,ke]=a.useState(0),E=me[G],s=D[G],[u,P]=a.useState(!1),T=a.useRef(!1);a.useEffect(()=>{T.current=u},[u]);const[Y,V]=a.useState(()=>typeof window>"u"?!1:!gt(bt)),[_e,kt]=a.useState([]),_t=(t,r)=>{t&&kt(l=>{const c=l.includes(t);return r?c?l:[...l,t]:c?l.filter(d=>d!==t):l})},Ue=t=>_t(s?.id,t),Me=!!s?.id&&_e.includes(s.id),pe=D[G+1]??null,Mr=!!pe?.id&&_e.includes(pe.id),Sr=!!(pe?.posterUrl&&!Mr);a.useEffect(()=>{if(typeof window>"u")return;const t=pe?.posterUrl;if(!t)return;const r=new Image;r.decoding="async",r.src=t},[pe?.posterUrl]);const[Rr,bn]=a.useState(!1),[Ie,Mt]=a.useState(!1),[St,Rt]=a.useState(!1),[nt,wn]=a.useState(null),[Cr,Ht]=a.useState(!1),Se=a.useRef(null),gn=a.useRef(new Set),[vn,yn]=a.useState(null),rt=a.useRef(null),[,Fr]=a.useState(0),[Tr,jn]=a.useState(0),Kt=a.useRef(null),Gt=a.useRef(!1),[Ir,Nn]=a.useState(!1),re=s?.id??null,Ct=pe?.id??null,{user:be}=vr(),st=br();a.useEffect(()=>{if(typeof window>"u"||D.length===0)return;const t=window.requestIdleCallback,r=()=>{const d=Math.min(Math.max(G+1,0),D.length),p=Math.min(D.length,d+8),h=D.slice(d,p).map(v=>{if(!v.id)return null;const L=Je.titleDetail(v.id);return st.getQueryData(L)?null:st.prefetchQuery({queryKey:L,queryFn:()=>hr(v.id),staleTime:1e3*60*30,gcTime:1e3*60*60})});Promise.allSettled(h.filter(Boolean))};if(t){const c=t(r);return()=>{typeof window<"u"&&"cancelIdleCallback"in window&&window.cancelIdleCallback?.(c)}}const l=window.setTimeout(r,280);return()=>window.clearTimeout(l)},[D,G,st]);const{data:it}=un({queryKey:["title-preview",Ct],enabled:!!Ct,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>{if(!Ct)return null;const{data:t,error:r}=await Wt.from("media_items").select("id, omdb_director, omdb_genre, omdb_rating_rotten_tomatoes, omdb_imdb_rating").eq("id",Ct).maybeSingle();if(r)throw r;return t?{omdb_director:t.omdb_director??null,omdb_genre:t.omdb_genre??null,omdb_rating_rotten_tomatoes:t.omdb_rating_rotten_tomatoes??null,omdb_imdb_rating:t.omdb_imdb_rating??null}:null}}),kn=ne(it?.omdb_director),Ar=_r(it?.omdb_rating_rotten_tomatoes),Er=J(it?.omdb_imdb_rating),{data:Ae=0}=un({queryKey:["friendCount",{userId:be?.id??null}],enabled:!!be?.id,staleTime:1e3*60*10,gcTime:1e3*60*30,refetchOnWindowFocus:!1,queryFn:async()=>{if(!be?.id)return 0;const{count:t,error:r}=await Wt.from("follows").select("followed_id",{count:"exact",head:!0}).eq("follower_id",be.id);if(r)throw r;return t??0}}),_n=Ns(re),Mn=_n.data?.status??null,Sn=_n.data?.rating??null,[Pr,Ft]=a.useState(null),[Lr,Rn]=a.useState(null),Vt={status:Pr??Mn},Tt=wr({mutationFn:async t=>{if(!be?.id||!E)return;const r={sessionId:xe,deckId:E.deckId??null,position:E.position??null,mediaItemId:E.id,source:E.source??null,events:[]},l=[];if(t.status!==void 0)if(t.statusKind==="watched"){const c=t.status===Ze;l.push({eventType:"like",payload:{ui:"SwipePage",action:"status",status:"watched",enabled:c}})}else{const c=t.status===Fe;l.push({eventType:"watchlist",inWatchlist:c,payload:{ui:"SwipePage",action:"status",status:"watchlist",enabled:c}})}t.ratingStars!==void 0&&l.push({eventType:"rating",rating0_10:Vs(t.ratingStars),payload:{ui:"SwipePage",action:"rating"}}),l.length&&(r.events=l,await H(r))},onSuccess:()=>{be?.id&&re&&(st.invalidateQueries({queryKey:Je.titleDiary(be.id,re)}),st.invalidateQueries({queryKey:Je.diaryLibrary(be.id)}))}}),at=a.useRef(null),Cn=a.useRef(null),It=a.useRef(!1),[Dr,$r]=a.useState(!1),[ze,Fn]=a.useState(!0),[Ye,Tn]=a.useState(!0),At=a.useRef(!0),Et=a.useRef(!0),In=a.useRef(0);a.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{It.current=t.matches,$r(t.matches)};return r(),typeof t.addEventListener=="function"?t.addEventListener("change",r):t.addListener?.(r),()=>{typeof t.removeEventListener=="function"?t.removeEventListener("change",r):t.removeListener?.(r)}},[]),a.useEffect(()=>{if(!(typeof window>"u"))try{const t=gt(cr),r=gt(dr),l=t==null?!0:t==="1",c=r==null?!0:r==="1";Fn(l),Tn(c),At.current=l,Et.current=c}catch{}},[]),a.useEffect(()=>{if(At.current=ze,!(typeof window>"u"))try{Oe(cr,ze?"1":"0")}catch{}},[ze]),a.useEffect(()=>{if(Et.current=Ye,!(typeof window>"u"))try{Oe(dr,Ye?"1":"0")}catch{}},[Ye]);const qe=a.useRef({x:0,y:0});a.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const t=window.matchMedia("(pointer: coarse)"),r=()=>{Xe.current=t.matches};return r(),typeof t.addEventListener=="function"?t.addEventListener("change",r):t.addListener?.(r),()=>{typeof t.removeEventListener=="function"?t.removeEventListener("change",r):t.removeListener?.(r)}},[]);const An=()=>{if(typeof window>"u")return null;if(at.current)return at.current;const t=window.AudioContext||window.webkitAudioContext;if(!t)return null;const r=new t;return at.current=r,r},Pt=t=>{Et.current&&(typeof navigator>"u"||typeof navigator.vibrate!="function"||navigator.vibrate(t))},Lt=(t,r=1)=>{if(!Et.current)return;const l=typeof performance<"u"?performance.now():Date.now(),c=In.current||0,d=t==="commit"?0:Xs;if(l-c<d)return;In.current=l;const p=x(r,.2,1);if(t==="threshold"){Pt(8);return}if(t==="snap"){Pt(6);return}if(t==="skip"){Pt(12);return}const m=Math.round(16+p*22);Pt(p>.7?[m,12,m+8]:m)},En=(t,r)=>{if(!At.current||typeof document<"u"&&document.visibilityState==="hidden")return;const l=An();if(!l)return;l.state==="suspended"&&l.resume().catch(()=>{});const c=1+(Math.random()*.06-.03),d=x(r,.2,1),p=l.currentTime,m=.11+d*.08,h=Math.max(1,Math.floor(l.sampleRate*m)),v=l.createBuffer(1,h,l.sampleRate),L=v.getChannelData(0);for(let Q=0;Q<h;Q+=1){const q=1-Q/h;L[Q]=(Math.random()*2-1)*q}const y=l.createBufferSource();y.buffer=v;const k=l.createBiquadFilter();k.type="bandpass";const M=t==="like"?760:t==="dislike"?520:640,f=t==="like"?1180:t==="dislike"?320:560;k.frequency.setValueAtTime(Math.max(80,M*c),p),k.frequency.exponentialRampToValueAtTime(Math.max(60,f*c),p+m);const I=l.createGain();I.gain.setValueAtTime(1e-4,p),I.gain.exponentialRampToValueAtTime(.09+d*.14,p+.012),I.gain.exponentialRampToValueAtTime(1e-4,p+m),y.connect(k),k.connect(I),I.connect(l.destination),y.start(p),y.stop(p+m+.02);const F=l.createOscillator(),$=l.createGain();F.type=t==="like"?"sine":"triangle";const z=t==="like"?520:t==="dislike"?210:360;F.frequency.setValueAtTime(z*c,p),F.frequency.linearRampToValueAtTime((z+(t==="like"?180:-40))*c,p+m),$.gain.setValueAtTime(1e-4,p),$.gain.exponentialRampToValueAtTime(.04+d*.05,p+.01),$.gain.exponentialRampToValueAtTime(1e-4,p+m),F.connect($),$.connect(l.destination),F.start(p),F.stop(p+m+.02)},Or=(t,r=1)=>{if(It.current)return;const l=Cn.current;if(!l)return;const c=l.getBoundingClientRect(),d=c.width,p=c.height;if(d<=0||p<=0)return;const m=B.burstDurationMs,h=Math.max(6,Math.round(B.burstBaseCount*x(r,.25,1))),v=t==="like"?Math.min(92,d*.28):Math.max(d-92,d*.72),L=Math.min(92,p*.14),y=t==="like"?"rgba(52,211,153,0.82)":"rgba(251,113,133,0.82)",k=t==="like"?"rgba(255,255,255,0.75)":"rgba(255,255,255,0.7)";for(let M=0;M<h;M++){const f=document.createElement("span"),I=M%5===0;f.className="mn-swipe-burst-dot",f.setAttribute("data-shape",I?"square":"dot");const F=(Math.random()*Math.PI*.9+Math.PI*.05)*(t==="like"?1:-1),$=62+Math.random()*98,z=Math.cos(F)*$,Q=-Math.abs(Math.sin(F))*$*(.85+Math.random()*.5),q=5+Math.random()*6,ie=(Math.random()*160-80).toFixed(1)+"deg",de=(.8+Math.random()*.9).toFixed(2);f.style.setProperty("--x",v.toFixed(1)+"px"),f.style.setProperty("--y",L.toFixed(1)+"px"),f.style.setProperty("--dx",z.toFixed(1)+"px"),f.style.setProperty("--dy",Q.toFixed(1)+"px"),f.style.setProperty("--rot",ie),f.style.setProperty("--s",de),f.style.setProperty("--sz",q.toFixed(1)+"px"),f.style.setProperty("--dur",m+"ms"),f.style.background=M%3===0?k:y,l.appendChild(f),window.setTimeout(()=>f.remove(),m+60)}},{data:C}=un({queryKey:Je.titleDetail(re),enabled:!!re,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>re?hr(re):null}),Dt=ne(C?.plot)??ne(s?.overview)??null,ae=C?.genres??s?.genres??null,Br=C?.omdb_country??s?.country??null,Ur=ne(Br),Pn=Ls(Ur),Ee=ne(C?.omdb_director),Ln=ne(C?.omdb_writer),lt=ne(C?.omdb_actors),We=C?.imdb_rating??s?.imdbRating??null,Qt=C?.rt_tomato_pct??s?.rtTomatoMeter??null,Zt=C?.metascore??null,Jt=C?.imdb_votes??null,Dn=ne(C?.omdb_awards),$n=ne(C?.omdb_box_office_str),On=ne(C?.omdb_released),en=C?.content_type==="movie"||C?.content_type==="series"||C?.content_type==="anime"?C.content_type:s?.type??null,Bn=s,zr=Bn?.certification??Bn?.rated??C?.omdb_rated??null,Un=ne(zr),zn=(Array.isArray(ae)?ae:ae?String(ae).split(",").map(t=>t.trim()):[])??[],Yn=zn.length>3?zn.slice(3).filter(Boolean):[],Yr=[C?.omdb_language??null,s?.language??null],qn=Array.from(new Set(Yr.map(t=>ne(t)).filter(t=>!!t))),tn=()=>be?!0:(alert("Sign in to save this title, rate it, or add it to your watchlist."),!1),Wn=t=>{if(!(!re||!E||!tn())){if(t===Fe){const r=Vt.status===Fe?null:Fe;Ft(r),Tt.mutate({status:r,statusKind:"watchlist"});return}if(t===Ze){const r=Vt.status===Ze?null:Ze;Ft(r),Tt.mutate({status:r,statusKind:"watched"})}}},qr=()=>{!re||!E||!tn()||(Ft(Fe),Tt.mutate({status:Fe,statusKind:"watchlist"}),Gr())},Wr=t=>{!re||!E||!tn()||(Rn(t),Tt.mutate({ratingStars:t}))},Xn=t=>Vt?.status===t,nn=Lr??(Sn??null);a.useEffect(()=>{Rn(null),Ft(null)},[re,Sn,Mn]);const Xr=t=>{Wr(nn===t?null:t)},Hn=()=>typeof window<"u"?Ms(`/title/${s?.id??""}`):`/title/${s?.id??""}`,Hr=Hn(),Kr=async t=>{if(!s||!E)return;const r=Hn(),l=`Check this out: ${s.title}`,c=t??l;try{navigator.share?await navigator.share({title:s.title,text:c,url:r}):navigator.clipboard?.writeText?(await navigator.clipboard.writeText(`${c}

${r}`),alert("Link copied to clipboard")):alert(`${c}

${r}`)}catch{}},Kn=!!(s?.posterUrl&&!Me),le=a.useRef(null),Gn=a.useRef(null),Re=a.useRef({w:0,h:0}),Xe=a.useRef(!1),oe=a.useRef(null),ce=a.useRef(null),He=a.useRef(0),Pe=a.useRef(0),Ce=a.useRef(0),Le=a.useRef(!1),fe=a.useRef(null),Vn=a.useRef(!1),we=a.useRef(null),De=a.useRef(0),ot=a.useRef(null),ge=a.useRef(null),se=a.useRef(null),ee=a.useRef(0),ve=a.useRef(null),ye=a.useRef(.5),je=a.useRef(.5),ct=a.useRef(null),dt=a.useRef(null),$t=a.useRef(null),Ot=a.useRef(null),Ke=a.useRef(null);a.useEffect(()=>{const t=()=>{const r=le.current;if(!r)return;const l=r.getBoundingClientRect();!l.width||!l.height||(Re.current={w:l.width,h:l.height})};if(t(),!(typeof window>"u"))return window.addEventListener("resize",t,{passive:!0}),()=>window.removeEventListener("resize",t)},[s?.id]);const Gr=()=>{if(!s)return;V(!1),typeof window<"u"&&Oe(bt,"1");const t=le.current;t&&(t.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",t.style.transform="perspective(1400px) translateX(0px) translateY(6px) scale(1.02) rotateZ(-1deg)",window.setTimeout(()=>{t.style.transform="perspective(1400px) translateX(0px) translateY(26px) scale(0.95)"},16),t.style.opacity="0"),window.setTimeout(()=>{Qn(0,!0),ke(r=>Math.min(r+1,D.length)),t&&(t.style.transition="none",t.style.transform="translateX(0px) translateY(0px) scale(1)",t.style.opacity="1")},220)};a.useEffect(()=>{if(typeof window>"u")return;const t=gt(bt);V(!t)},[]),a.useEffect(()=>{Ue(!1),Mt(!1),Rt(!1)},[s?.id]),a.useEffect(()=>{!E||!s||O||te||Be(s)||(Mt(!1),Rt(!1),ke(t=>Math.min(t+1,D.length)))},[E?.id,s?.id,O,te,Be]),a.useEffect(()=>{if(!E)return;const t=performance.now();if(Ke.current&&Ot.current&&Ot.current!==E.id){const r=$t.current;if(r!=null){const l=Math.max(0,Math.round(t-r));tt(Ke.current,l)}}if(!Be(s)){Ke.current=null,Ot.current=null,$t.current=null;return}jt(E),Ke.current=E,Ot.current=E.id,$t.current=t},[E?.id,s?.id,Be,tt,jt]),a.useEffect(()=>()=>{if(!Ke.current)return;const t=$t.current;if(t==null)return;const r=Math.max(0,Math.round(performance.now()-t));tt(Ke.current,r)},[]),a.useEffect(()=>{if(typeof window>"u")return;(window.requestIdleCallback??(r=>window.setTimeout(r,180)))(()=>{const r=D.slice(G+1,G+4);for(const l of r){if(!l?.posterUrl)continue;const c=new Image;c.loading="lazy",c.decoding="async",c.src=l.posterUrl}})},[D,G]),a.useEffect(()=>()=>{we.current&&cancelAnimationFrame(we.current),Se.current!=null&&window.clearTimeout(Se.current),rt.current!=null&&window.clearTimeout(rt.current),at.current&&at.current.close().catch(()=>{})},[]),a.useEffect(()=>{const t=D.length-G;t<12&&he(Math.max(60,t+24))},[D.length,G,he]),a.useEffect(()=>{if(G<=10)return;const t=Math.min(Math.max(G-6,0),D.length);t>0&&(et(t),ke(r=>Math.max(4,r-t)))},[D.length,G,et]);const Qn=a.useCallback((t,r=!1,l)=>{const c=Gn.current;if(!c)return;const d=Xe.current?.96:1,p=vt(Re.current.w,d),m=x(Math.abs(t)/Math.max(1,p),0,1),h=x(t/Math.max(1,p),-1,1),v=.68+m*.32+h*m*.03,L=.9+m*.1+h*m*.02,y=.985+m*.015,k=(1-m)*B.undercardTranslateY,M=(1-m)*B.undercardBlurMax,f=1-m,I=(x(-t*.02,-10,10)+h*m*8)*f,F=x(-t/220,-2.2,2.2)*f,$=l??200;c.style.transition=r?`filter ${$}ms cubic-bezier(0.22,0.61,0.36,1), transform ${$}ms cubic-bezier(0.22,0.61,0.36,1)`:"none",c.style.transform=`translate3d(${I.toFixed(2)}px, ${k.toFixed(2)}px, 0px) rotateZ(${F.toFixed(3)}deg) scale(${y.toFixed(4)})`,c.style.filter=`brightness(${v.toFixed(3)}) saturate(${L.toFixed(3)}) blur(${M.toFixed(2)}px)`},[]),Vr=()=>{typeof performance>"u"||(ot.current=performance.now())},Qr=()=>{if(typeof performance>"u")return 1;const t=ot.current;if(t==null)return 1;const r=(performance.now()-t)/Math.max(1,B.punchDurationMs);if(r>=1)return ot.current=null,1;const l=Math.sin(Math.PI*r);return 1+(B.punchScale-1)*l},ut=(t,r=!1,l,c)=>{const d=le.current;if(!d)return;const p=It.current,m=Xe.current?.96:1,h=vt(Re.current.w,m),v=ur(Re.current.w,m),y=(xt=>{const Yt=Math.abs(xt),ht=Math.max(1,h)*.7;if(Yt<=ht)return xt;const dn=Yt-ht;return Math.sign(xt)*(ht+dn*.38)})(t),k=x(y,-wt,wt),M=zs(y,wt),f=Math.abs(y)>.5&&fe.current==="x";d.style.transformOrigin=f?`${(je.current*100).toFixed(1)}% ${(ye.current*100).toFixed(1)}%`:"50% 50%";const I=Math.abs(k),F=v*.6,$=x((I-F)/Math.max(1,h-F),0,1),z=k>0?$:0,Q=k<0?$:0;d.style.setProperty("--mn-swipe-like-opacity",String(z)),d.style.setProperty("--mn-swipe-nope-opacity",String(Q)),d.style.setProperty("--mn-swipe-like-scale",String(.96+z*.04)),d.style.setProperty("--mn-swipe-nope-scale",String(.96+Q*.04));const q=x(Math.abs(k)/Math.max(1,h),0,1),ie=x((.5-ye.current)*2,-1,1),de=ie<0?-1:1,ue=.55+.45*Math.abs(ie),$e=x((je.current-.5)*2,-1,1),W=x(Math.abs(ee.current)/1.35,0,1),Z=k/fr*ue*de,Ne=x(Z*(1+W*.28),-18,B.rotateZCap),an=x(k/24+Math.sign(k)*W*2.8+-$e*q*4.5,-14,B.rotateYCap),zt=x(ie*(1.8+W*2.2)*q,-7,B.rotateXCap);if(p)d.style.setProperty("--mn-swipe-spec-o","0"),d.style.setProperty("--mn-swipe-poster-parallax","0px"),d.style.setProperty("--mn-swipe-poster-parallax-y","0px"),d.style.setProperty("--mn-swipe-bg-parallax","0px"),d.style.boxShadow="0 30px 90px rgba(0,0,0,0.62)",d.style.backdropFilter="blur(8px)";else{const xt=x(.08+q*.22+W*.12,0,.42),Yt=x(50+k/Math.max(1,h)*18+qe.current.x*12,24,76),ht=x(28+-Ce.current/Math.max(1,h)*12+qe.current.y*10,16,66);d.style.setProperty("--mn-swipe-spec-o",xt.toFixed(3)),d.style.setProperty("--mn-swipe-spec-x",`${Yt.toFixed(1)}%`),d.style.setProperty("--mn-swipe-spec-y",`${ht.toFixed(1)}%`),d.style.setProperty("--mn-swipe-poster-parallax",`${(-k*.035).toFixed(2)}px`),d.style.setProperty("--mn-swipe-poster-parallax-y",`${(Ce.current*.02).toFixed(2)}px`),d.style.setProperty("--mn-swipe-bg-parallax",`${(k*.02).toFixed(2)}px`);const dn=x(.46+q*.22+W*.14,.35,.78);d.style.boxShadow=`0 30px 92px rgba(0,0,0,${dn.toFixed(3)})`,d.style.backdropFilter=`blur(${(8+q*8).toFixed(1)}px)`}const ln=p?0:x(Ce.current*.18,-14,14),on=-q*(3.2+W*1.6),cs=Qr(),ds=(1+q*.006+W*.004)*cs,cn=p?{x:0,y:0}:qe.current,us=cn.y*-4,ms=cn.x*5,ps=cn.y*-4,tr=l??320,fs=c??"cubic-bezier(0.16, 1, 0.3, 1)";d.style.transition=r?`transform ${tr}ms ${fs}`:"none",d.style.transform=`
      perspective(1400px)
      translate3d(${M}px, ${ps+on+ln}px, 0px)
      rotateX(${p?0:us+zt}deg)
      rotateY(${p?0:an+ms}deg)
      rotateZ(${p?0:Ne}deg)
      scale(${ds})
    `,He.current=k,Qn(k,r,tr)},Bt=(t=!0,r=0)=>{qe.current={x:0,y:0};const l=Math.abs(r),c=x(l/1.35,0,1),d=t?x(Math.round(320-c*140),170,320):void 0,p=t&&l<.45?"cubic-bezier(0.22, 1.2, 0.36, 1)":"cubic-bezier(0.16, 1, 0.3, 1)";ut(0,t,d,p),He.current=0,oe.current=null,ce.current=null,ge.current=null,se.current=null,ee.current=0,Pe.current=0,Ce.current=0,Le.current=!1,fe.current=null,je.current=.5,ye.current=.5,ct.current=null},Zr=(t,r)=>{wn({card:t,direction:r}),Ht(!0),Se.current!=null&&window.clearTimeout(Se.current),Se.current=window.setTimeout(()=>Ht(!1),2800)},Jr=()=>{Ht(!1),wn(null),Se.current!=null&&(window.clearTimeout(Se.current),Se.current=null)},es=()=>{nt&&(ke(t=>{const r=t-1;if(r<0)return t;const l=D[r];return l&&l.id===nt.card.id?r:t}),Ut("Reviewing previous card. Swipe actions are already saved."),typeof window<"u"&&window.requestAnimationFrame(()=>Bt(!1)),Jr())},Ut=t=>{yn(t),rt.current!=null&&window.clearTimeout(rt.current),t&&(rt.current=window.setTimeout(()=>yn(null),3200))},ts=(t,r)=>{const l=t.runtimeMinutes??0,c=ae??t.genres??[],d=en==="series"||t.type==="series",p=c.map(m=>m.toLowerCase());return r==="like"?p.some(m=>m.includes("horror")||m.includes("thriller"))?"We’ll show more intense picks like this.":p.some(m=>m.includes("comedy"))?"We’ll show more light and funny picks like this.":d?"Nice — we’ll bring in more series that match this vibe.":We!=null&&J(We)!=null&&J(We)>=7.5?"Nice pick — we’ll show more highly rated titles like this.":t.friendLikesCount&&t.friendLikesCount>=3?"Your friends are into this — we’ll pull in more friend-favorites.":"Got it — we’ll keep tuning around this kind of title.":r==="dislike"?d?"Looks like this series isn’t your thing — we’ll dial down similar shows.":l>130&&Tr+1>=3?"You’ve skipped a few long movies — we’ll lean toward shorter runtimes.":l>130?"Noted — we’ll be more careful with super long movies.":"Okay, we’ll dial down similar titles in your feed.":r==="skip"?"We’ll move this out of your way and keep the feed feeling fresh.":null},Ge=(t,r=0)=>{if(!s||!E)return;const l=`${E.deckId??"unknown"}:${E.id}`;if(gn.current.has(l)){Ut("That swipe was already saved. Back is for review only."),Bt(!0);return}if(gn.current.add(l),V(!1),typeof window<"u"&&Oe(bt,"1"),Zr(s,t),Xt({card:E,direction:t}),t==="dislike"&&(s.runtimeMinutes??0)>130?jn(f=>f+1):jn(0),Fr(f=>{const I=f+1,F=ts(s,t);return F&&I>=4&&I%4===0?Ut(F):Ut(null),I}),t==="skip"){const f=le.current;f&&(f.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",f.style.transform="perspective(1400px) translateX(0px) translateY(4px) scale(1.03) rotateZ(-1deg)",window.setTimeout(()=>{f.style.transform="perspective(1400px) translateX(0px) translateY(24px) scale(0.95)"},16),f.style.opacity="0");const I=.4;Lt("skip",I),En(t,I),window.setTimeout(()=>{ke(F=>Math.min(F+1,D.length)),f&&(f.style.transition="none",f.style.transform="translateX(0px) translateY(0px) scale(1)",f.style.opacity="1")},220);return}const c=t==="like"?1:-1,d=typeof window<"u"?window.innerWidth+240:Hs,p=Math.abs(r),m=x(p/1.35,0,1),h=x(p*260,0,280),v=(d+h)*c,L=x(Math.round(260-m*110),140,260),y=le.current;if(y){const f=x((.5-ye.current)*2,-1,1),I=f<0?-1:1,F=.55+.45*Math.abs(f),$=x((je.current-.5)*2,-1,1);y.style.transformOrigin=`${(je.current*100).toFixed(1)}% ${(ye.current*100).toFixed(1)}%`;const z=It.current,Q=v/fr*F*I,q=z?0:x(Q*(1+m*.12),-24,24),ie=z?0:x(c*(10+m*12)+-$*(4+m*3),-22,22),de=z?0:x(f*(4+m*2),-8,8),ue=-4-m*14,$e=1.04+m*.04,W=z?1:1+m*.025,Z=z?1:1-m*.018;y.style.transition=`transform ${L}ms cubic-bezier(0.22,0.61,0.36,1)`,y.style.transform=`
        perspective(1400px)
        translate3d(${v}px, ${ue}px, 0px)
        rotateX(${de}deg)
        rotateY(${ie}deg)
        rotateZ(${q}deg)
        scale3d(${($e*W).toFixed(4)}, ${($e*Z).toFixed(4)}, 1)
      `}const k=Math.abs(He.current)+Math.abs(r)*220,M=x(k/520,.25,1);Or(t,M),Lt("commit",M),En(t,M),window.setTimeout(()=>{ke(f=>Math.min(f+1,D.length)),window.requestAnimationFrame(()=>Bt(!1))},L)},ns=(t,r,l,c,d,p,m,h)=>{if(!s||!E||ve.current!=null||d==="touch"&&!p||d==="touch"&&typeof m=="number"&&typeof h=="number"&&m>55&&h>55)return;const L=c instanceof HTMLElement&&!!c.closest('button, a, input, textarea, select, [data-swipe-interactive="true"][role="button"], [data-swipe-interactive="true"][tabindex]:not([tabindex="-1"])');if(Vn.current=L,L)return;Le.current=!0,ve.current=l,fe.current=null;try{le.current?.setPointerCapture(l)}catch{}oe.current=t,ce.current=r;const y=le.current;if(y){const M=y.getBoundingClientRect();M.width>0&&M.height>0?(Re.current={w:M.width,h:M.height},je.current=x((t-M.left)/M.width,0,1),ye.current=x((r-M.top)/M.height,0,1)):(je.current=.5,ye.current=.5)}else je.current=.5,ye.current=.5;Pe.current=0,Ce.current=0,He.current=0,De.current=0,ot.current=null,ge.current=t,se.current=performance.now(),dt.current=se.current,ee.current=0;const k=Ie&&Kt.current&&Kt.current.contains(c);Gt.current=!!k},rs=(t,r,l,c,d,p,m)=>{if(ve.current!=null&&l!==ve.current||!Le.current||oe.current===null||ce.current===null||c==="touch"&&!d||c==="touch"&&typeof p=="number"&&typeof m=="number"&&p>55&&m>55)return;const h=performance.now(),v=t-oe.current,L=r-ce.current;if(!T.current&&fe.current==null){const W=Math.abs(v),Z=Math.abs(L);if(W<pn&&Z<pn)return;if(Z>W*Ys){Le.current=!1,ve.current=null,fe.current="y",oe.current=null,ce.current=null,ge.current=null,se.current=null,ee.current=0;return}fe.current="x",P(!0),T.current=!0,oe.current=t-Math.sign(v)*pn,ce.current=r,ge.current=t,se.current=h,ee.current=0,At.current&&An();const Ne=le.current;if(Ne)try{Ne.setPointerCapture(l)}catch{}}if(!T.current||oe.current===null)return;const y=t-oe.current,k=Xe.current?.96:1,M=vt(Re.current.w,k),f=ur(Re.current.w,k),I=ce.current!=null?r-ce.current:0,F=Math.abs(y),$=Math.abs(I),z=x((F-$*qs)/Math.max(1,f),0,1),Q=x(1-z*.75-F/Math.max(1,M)*.22,Ws,1),q=I*Q,ie=x((F-f*.55)/Math.max(1,f*.75),0,1),de=y+Math.sign(y)*fn*.18*ie;Pe.current=de,Ce.current=x(q,-70,70);let ue=null;if(de>f?ue="like":de<-f&&(ue="dislike"),ue&&ue!==ct.current&&(Lt("threshold",.6),Vr()),ct.current=ue,ge.current!==null&&se.current!==null){const W=h-se.current;if(W>0){const Z=(t-ge.current)/W,Ne=x(Z,-2.5,2.5);ee.current=ee.current*.75+Ne*.25}}if(ge.current=t,se.current=h,we.current!=null)return;const $e=()=>{we.current=null;const W=x(B.dragFollowAlpha,.08,1);let Z=Pe.current;if(Le.current&&T.current&&se.current!=null){const Ne=(typeof performance<"u"?performance.now():Date.now())-se.current;if(Ne>mr){const an=x((Ne-mr)/260,0,1),zt=Math.abs(Z);if(zt>f*.45&&zt<M*.86){const ln=Math.sign(Z)*Math.min(f*.92,M*.84),on=x(ln-Z,-fn,fn);Z=Z+on*an}}}De.current=De.current+(Z-De.current)*W,ut(De.current),Le.current&&T.current&&fe.current==="x"&&(we.current=window.requestAnimationFrame($e))};we.current=window.requestAnimationFrame($e)},Zn=(t,r,l)=>{if(ve.current!=null&&t!==ve.current)return;const c=T.current;P(!1),T.current=!1,Le.current=!1;const d=ve.current;ve.current=null,we.current!=null&&(cancelAnimationFrame(we.current),we.current=null,ut(De.current));const p=t??d;if(p!=null)try{le.current?.releasePointerCapture(p)}catch{}if(!c){const F=fe.current==="y",$=oe.current,z=ce.current,Q=$!=null&&r!=null?r-$:0,q=z!=null&&l!=null?l-z:0,ie=dt.current!=null?performance.now()-dt.current:null,de=!F&&Math.abs(Q)<10&&Math.abs(q)<10&&(ie==null||ie<280)&&!Vn.current;oe.current=null,ce.current=null,ge.current=null,se.current=null,ee.current=0,dt.current=null,Pe.current=0,Ce.current=0,fe.current=null,je.current=.5,ye.current=.5,ct.current=null,de&&!(Ie&&Gt.current)&&(Mt(ue=>!ue),Rt(!1));return}dt.current=null;const h=x(He.current,-wt,wt)+ee.current*B.velocityProjectionMs,v=Ie&&Gt.current,L=Xe.current?.96:1,y=vt(Re.current.w,L),k=v?y*1.6:y,M=Xe.current?pr*.92:pr,f=v?M*1.4:M,I=Math.abs(h)>=k||Math.abs(ee.current)>=f;if(oe.current=null,ce.current=null,ge.current=null,se.current=null,Pe.current=0,Ce.current=0,De.current=0,ot.current=null,fe.current=null,I){Ge(h>=0?"like":"dislike",ee.current),ct.current=null,ee.current=0;return}Lt("snap",x(Math.abs(ee.current)/1.35,.25,.9)),Bt(!0,ee.current)},mt=!s||O||te||u,Jn=typeof s?.friendLikesCount=="number"?s.friendLikesCount:0,ss=Ae>0?Math.round(Jn/Math.max(1,Ae)*100):0;a.useEffect(()=>{const t=r=>{!s||mt||u||(r.key==="ArrowLeft"?(r.preventDefault(),Ge("dislike")):r.key==="ArrowRight"?(r.preventDefault(),Ge("like")):(r.key==="ArrowDown"||r.key===" ")&&(r.preventDefault(),Ge("skip")))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[s,mt,u]);const is=()=>{if(!Cr||!nt)return null;const t=nt.direction==="like"?"Loved it":nt.direction==="dislike"?"Marked as ‘No thanks’":"Saved for ‘Not now’";return e.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-4 z-40 flex justify-center page-pad",children:e.jsxs("div",{className:"pointer-events-auto inline-flex items-center gap-3 rounded-md border border-border bg-background/95 px-3 py-2 text-[12px] text-foreground shadow-lg backdrop-blur",children:[e.jsx("span",{children:t}),e.jsx("button",{type:"button","aria-label":"Back to previous card",onClick:es,className:"text-xs font-semibold uppercase tracking-[0.14em] text-primary hover:text-primary/80",children:"Back"})]})})},as=()=>vn?e.jsx("div",{className:"pointer-events-none absolute inset-x-0 top-2 z-30 flex justify-center page-pad",children:e.jsxs("div",{className:"pointer-events-auto inline-flex max-w-md items-start gap-2 rounded-md border border-border bg-background/95 px-3 py-2 text-xs text-muted-foreground shadow-lg backdrop-blur",children:[e.jsx(j,{name:"auto_awesome",className:"mt-0.5 text-[18px] text-primary"}),e.jsx("span",{children:vn})]})}):null,pt=typeof s?.imdbRating=="number"&&!Number.isNaN(s.imdbRating)?s.imdbRating:typeof C?.imdb_rating=="number"&&!Number.isNaN(C.imdb_rating)?C.imdb_rating:J(C?.imdb_rating),ft=typeof s?.rtTomatoMeter=="number"&&!Number.isNaN(s.rtTomatoMeter)?s.rtTomatoMeter:typeof C?.rt_tomato_pct=="number"&&!Number.isNaN(C.rt_tomato_pct)?C.rt_tomato_pct:J(C?.rt_tomato_pct),rn=a.useMemo(()=>xr({card:s??null,friendCount:Ae,imdb:pt??null,rt:ft??null}),[s,Ae,pt,ft]),Ve=s?(()=>{const t=[];if(s.year&&t.push(String(s.year)),pt!=null&&J(pt)!=null&&t.push(`IMDb ${String(J(pt)?.toFixed(1))}`),ft!=null&&J(ft)!=null&&t.push(`RT ${Math.round(Number(ft))}%`),typeof s.runtimeMinutes=="number"&&s.runtimeMinutes>0){const r=lr(s.runtimeMinutes);r&&t.push(r)}return t.join(" • ")})():"",sn=a.useMemo(()=>{const t=en??s?.type??null;return t==="series"?"SERIES":t==="anime"?"ANIME":"MOVIE"},[en,s?.type]),er=a.useMemo(()=>{const t=ae??s?.genres??null;return(Array.isArray(t)?t:t?String(t).split(",").map(l=>l.trim()).filter(Boolean):[]).map(l=>String(l??"").trim()).filter(Boolean).slice(0,3)},[ae,s?.genres]),ls=t=>{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||u)return;const r=le.current;if(!r)return;const l=r.getBoundingClientRect(),c=(t.clientX-l.left)/l.width,d=(t.clientY-l.top)/l.height;qe.current={x:(c-.5)*2,y:(d-.5)*2},ut(Pe.current)},os=()=>{u||(qe.current={x:0,y:0},ut(He.current,!0))};return e.jsxs("div",{"data-reduce-motion":Dr?"1":"0",className:"relative flex flex-1 min-h-0 flex-col overflow-hidden overscroll-none h-[calc(100dvh-(5.5rem+env(safe-area-inset-bottom)))]",style:Gs,children:[e.jsx("style",{children:Ks}),s?.posterUrl&&e.jsxs("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 -z-10",style:{backgroundImage:`url(${s.posterUrl})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-background/40 via-background/70 to-background"}),e.jsx("div",{className:"absolute inset-0 backdrop-blur-2xl"})]}),as(),e.jsxs("div",{className:"relative z-10 flex shrink-0 flex-col gap-[calc(var(--mn-swipe-pad)*0.75)] px-[var(--mn-swipe-pad)] pt-[calc(env(safe-area-inset-top)+var(--mn-swipe-pad)*0.75)]",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:()=>R(!0),className:"inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center text-muted-foreground/90 transition-colors hover:text-foreground","aria-label":"Filters",children:e.jsx(j,{name:"tune",className:"text-[length:var(--mn-swipe-top-icon)]"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold tracking-[0.25em] text-primary/90",children:"DISCOVERY"}),e.jsx("div",{className:"text-[length:var(--mn-swipe-header)] font-semibold text-foreground",children:"For You"})]}),e.jsxs("button",{type:"button",onClick:()=>n("/activity"),className:"relative inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center text-muted-foreground/90 transition-colors hover:text-foreground","aria-label":"Activity",children:[e.jsx(j,{name:"notifications",className:"text-[length:var(--mn-swipe-top-icon)]"}),e.jsx("span",{"aria-hidden":"true",className:"absolute right-[8px] top-[8px] h-2 w-2 rounded-full bg-primary"})]})]}),e.jsx(Ds,{message:K,onRetry:yt,isRetrying:Te})]}),e.jsxs("div",{className:"relative z-10 flex flex-1 min-h-0 flex-col overflow-visible px-[var(--mn-swipe-pad)]",children:[e.jsxs("div",{className:"relative flex flex-1 min-h-0 items-center justify-center overflow-visible [perspective:1400px]","aria-live":"polite",children:[O&&!s&&!te&&e.jsx(ys,{}),te&&!O&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(j,{name:"info",className:"text-[32px] text-amber-400"}),e.jsx("p",{children:"We couldn't load your swipe deck."}),e.jsx("button",{type:"button",onClick:()=>he(32),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Retry"})]}),!O&&!te&&!s&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(j,{name:"auto_awesome",className:"text-[32px] text-primary"}),e.jsx("p",{children:"All caught up. New cards will appear soon."}),e.jsx("button",{type:"button",onClick:()=>he(36),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Refresh deck"})]}),!O&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative z-10 mx-auto h-full max-h-[720px] w-full max-w-md",children:[pe&&e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0",children:(()=>{const t=pe;if(!t)return null;const r=typeof t.friendLikesCount=="number"?t.friendLikesCount:Array.isArray(t.friendProfiles)?t.friendProfiles.length:0,l=Ae>0?Math.round(r/Math.max(1,Ae)*100):0,c=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)?t.imdbRating:Er??null,d=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)?t.rtTomatoMeter:Ar??null,p=xr({card:t,friendCount:Ae,imdb:c,rt:d}),m=(()=>{const h=Array.isArray(t.genres)?t.genres:[],v=it?.omdb_genre!=null?String(it.omdb_genre).split(",").map(y=>y.trim()).filter(Boolean):[];return(h.length>0?h:v).map(y=>String(y??"").trim()).filter(Boolean).slice(0,3)})();return e.jsx("div",{ref:Gn,className:"absolute inset-0",style:{filter:"brightness(0.68) saturate(0.9)",willChange:"filter"},children:e.jsx("div",{className:"relative h-full w-full rounded-[var(--mn-swipe-radius)] bg-gradient-to-b from-white/10 via-primary/25 to-white/10 p-[1.25px] shadow-[0_30px_90px_rgba(0,0,0,0.75)]",children:e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-[var(--mn-swipe-radius)] bg-background/20 backdrop-blur-sm",children:[Sr&&t.posterUrl?e.jsx("img",{src:t.posterUrl,alt:qt(t)??`${t.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>_t(t.id,!0)}):e.jsx("div",{className:"h-full w-full",children:e.jsx(mn,{title:t.title})}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/20 to-black/70"}),t.source==="from-friends"&&e.jsx("div",{className:"absolute left-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)]",children:(()=>{const h=t.topFriendName??t.friendProfiles?.[0]?.display_name??t.friendProfiles?.[0]?.username??"",v=Math.max(0,r-1),L=!!h,y=(h.trim().charAt(0)||"F").toUpperCase();return e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-black/30 px-2.5 py-2 shadow-sm backdrop-blur-md",children:[e.jsx("div",{className:"grid h-10 w-10 place-items-center overflow-hidden rounded-full border border-white/20 bg-white/10 text-sm font-semibold text-white/90",children:L&&t.friendProfiles?.[0]?.avatar_url?e.jsx("img",{src:t.friendProfiles[0].avatar_url,alt:h||"Friend",className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("span",{children:y})}),v>0&&e.jsxs("div",{className:"grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-white/10 text-sm font-semibold text-white/90",children:["+",v]}),e.jsx("div",{className:"pr-1 text-sm font-semibold text-white/90",children:L?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary",children:h}),e.jsxs("span",{className:"text-white/80",children:[" ","& others watched"]})]}):e.jsx("span",{className:"text-white/80",children:"From friends"})})]})})()}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-x-0 bottom-0 h-[72%] bg-gradient-to-t from-black/85 via-black/40 to-transparent"}),e.jsxs("div",{className:"relative",children:[(()=>{const h=t.source??"for-you",v=h==="trending"?{label:"Trending",icon:"local_fire_department"}:h==="popular"?{label:"Popular",icon:"stars"}:h==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-primary/25 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-primary-foreground backdrop-blur",children:[e.jsx(j,{name:v.icon,filled:!0,className:"text-[18px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:v.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[p,"% Match"]})]})})(),e.jsx("h2",{className:"line-clamp-2 text-[length:var(--mn-swipe-title)] font-extrabold leading-[1.02] text-white",children:t.title}),kn&&e.jsxs("p",{className:"mt-1 text-[length:var(--mn-swipe-subtitle)] font-semibold text-white/60",children:["Directed by ",kn.split(",")[0]]}),e.jsx("div",{className:"mt-4 text-[length:var(--mn-swipe-meta)] text-white/70 whitespace-nowrap overflow-hidden text-ellipsis",children:[t.year?e.jsx("span",{children:t.year},"y"):null,c!=null?e.jsxs("span",{className:"text-white/70",children:["IMDb ",String(c.toFixed(1))]},"i"):null,d!=null?e.jsxs("span",{className:"text-white/70",children:["RT ",Math.round(d),"%"]},"r"):null,typeof t.runtimeMinutes=="number"&&t.runtimeMinutes>0?e.jsx("span",{children:lr(t.runtimeMinutes)},"t"):null].filter(Boolean).map((h,v)=>e.jsxs(sr.Fragment,{children:[v>0&&e.jsx("span",{className:"mx-1 text-white/30",children:"•"}),h]},v))}),Array.isArray(t.friendProfiles)&&t.friendProfiles.length>0&&e.jsxs("div",{className:"mt-5 flex w-full items-center justify-between gap-3 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-left backdrop-blur-md","aria-label":"Friends summary",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ir,{profiles:t.friendProfiles,max:3,size:32}),e.jsxs("div",{className:"leading-tight",children:[e.jsxs("p",{className:"text-[length:var(--mn-swipe-subtitle)] font-extrabold text-white",children:[x(Math.round(l),0,100),"% of friends"]}),e.jsxs("p",{className:"text-sm font-semibold text-white/60",children:[t.source==="from-friends"?"watched":"liked"," ","this title"]})]})]}),e.jsx("div",{className:"grid h-[var(--mn-swipe-hit)] w-[var(--mn-swipe-hit)] place-items-center rounded-full border border-white/10 bg-white/10 text-white/70",children:e.jsx(j,{name:"chevron_right",className:"text-[length:var(--mn-swipe-top-icon)]"})})]}),m.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:m.map(h=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/10 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-white/75",children:["#",h]},h))})]})]})]})})})})()}),e.jsx("div",{className:"relative h-full w-full rounded-[var(--mn-swipe-radius)] bg-gradient-to-b from-white/10 via-primary/25 to-white/10 p-[1.25px] shadow-[0_30px_90px_rgba(0,0,0,0.75)]",children:e.jsxs("article",{ref:le,role:"group","aria-roledescription":"Movie card","aria-label":qt(s),className:`relative h-full w-full select-none overflow-hidden rounded-[var(--mn-swipe-radius)] bg-background/20 backdrop-blur-sm transform-gpu will-change-transform ${Ie?"ring-1 ring-primary/40":""}`,onPointerDown:t=>{t.pointerType==="mouse"&&t.button!==0||ns(t.clientX,t.clientY,t.pointerId,t.target,t.pointerType,t.isPrimary,t.width,t.height)},onPointerMove:t=>rs(t.clientX,t.clientY,t.pointerId,t.pointerType,t.isPrimary,t.width,t.height),onPointerUp:t=>Zn(t.pointerId,t.clientX,t.clientY),onPointerCancel:t=>Zn(t.pointerId,t.clientX,t.clientY),onMouseMove:ls,onMouseLeave:os,style:{touchAction:Ie?"pan-y":"none",overscrollBehavior:"contain",userSelect:"none",WebkitUserSelect:"none"},children:[e.jsx("div",{ref:Cn,"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-20 overflow-hidden"}),e.jsxs("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-[-48px] z-[1]",children:[e.jsx("div",{className:"absolute inset-0 blur-3xl bg-emerald-400/30",style:{opacity:"var(--mn-swipe-like-opacity, 0)"}}),e.jsx("div",{className:"absolute inset-0 blur-3xl bg-rose-400/30",style:{opacity:"var(--mn-swipe-nope-opacity, 0)"}})]}),e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-[19]",style:{background:"radial-gradient(circle at var(--mn-swipe-spec-x, 50%) var(--mn-swipe-spec-y, 30%), rgba(255,255,255,0.35), rgba(255,255,255,0) 55%)",opacity:"var(--mn-swipe-spec-o, 0)",mixBlendMode:"soft-light"}}),!Ie&&e.jsxs("div",{className:"relative z-[2] h-full w-full",children:[Kn&&s.posterUrl?e.jsx("img",{src:s.posterUrl,alt:qt(s)??`${s.title} poster`,className:"h-full w-full object-cover",style:{transform:"translate3d(var(--mn-swipe-poster-parallax, 0px), var(--mn-swipe-poster-parallax-y, 0px), 0) scale(1.035)",willChange:"transform"},draggable:!1,loading:"lazy",onError:()=>Ue(!0)}):e.jsx("div",{className:"h-full w-full",style:{transform:"translate3d(var(--mn-swipe-poster-parallax, 0px), var(--mn-swipe-poster-parallax-y, 0px), 0) scale(1.02)",willChange:"transform"},children:e.jsx(mn,{title:s.title})}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/20 to-black/70",style:{transform:"translate3d(var(--mn-swipe-bg-parallax, 0px), 0, 0)",willChange:"transform"}}),e.jsx("div",{className:"pointer-events-none absolute inset-x-[calc(var(--mn-swipe-pad)*1.2)] top-[calc(var(--mn-swipe-pad)*0.8)] flex justify-start",children:e.jsxs("div",{className:`flex items-center gap-2 rounded-md bg-emerald-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-emerald-200 shadow-md backdrop-blur-sm ${u?"":"transition-[opacity,transform] duration-200"}`,style:{opacity:"var(--mn-swipe-like-opacity, 0)",transform:"translate3d(0,0,0) scale(var(--mn-swipe-like-scale, 0.96))"},children:[e.jsx(j,{name:"favorite",filled:!0,className:"text-[18px] text-emerald-300"}),e.jsx("span",{children:"Love it"})]})}),e.jsx("div",{className:"pointer-events-none absolute inset-x-[calc(var(--mn-swipe-pad)*1.2)] top-[calc(var(--mn-swipe-pad)*0.8)] flex justify-end",children:e.jsxs("div",{className:`flex items-center gap-2 rounded-md bg-rose-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-rose-200 shadow-md backdrop-blur-sm ${u?"":"transition-[opacity,transform] duration-200"}`,style:{opacity:"var(--mn-swipe-nope-opacity, 0)",transform:"translate3d(0,0,0) scale(var(--mn-swipe-nope-scale, 0.96))"},children:[e.jsx(j,{name:"close",className:"text-[18px] text-rose-300"}),e.jsx("span",{children:"No thanks"})]})}),s.source==="from-friends"&&e.jsx("div",{className:"absolute left-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)]",children:(()=>{const t=s.topFriendName??s.friendProfiles?.[0]?.display_name??s.friendProfiles?.[0]?.username??"",r=Math.max(0,Jn-1),l=!!t,c=(t.trim().charAt(0)||"F").toUpperCase();return e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-black/30 px-2.5 py-2 shadow-sm backdrop-blur-md",children:[e.jsx("div",{className:"grid h-10 w-10 place-items-center overflow-hidden rounded-full border border-white/20 bg-white/10 text-sm font-semibold text-white/90",children:l&&s.friendProfiles?.[0]?.avatar_url?e.jsx("img",{src:s.friendProfiles[0].avatar_url,alt:t||"Friend",className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("span",{children:c})}),r>0&&e.jsxs("div",{className:"grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-white/10 text-sm font-semibold text-white/90",children:["+",r]}),e.jsx("div",{className:"pr-1 text-sm font-semibold text-white/90",children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary",children:t}),e.jsx("span",{className:"text-white/80",children:" & others watched"})]}):e.jsx("span",{className:"text-white/80",children:"From friends"})})]})})()}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-x-0 bottom-0 h-[72%] bg-gradient-to-t from-black/85 via-black/40 to-transparent"}),e.jsxs("div",{className:"relative",children:[(()=>{const t=s.source??"for-you",r=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-primary/25 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-primary-foreground backdrop-blur",children:[e.jsx(j,{name:r.icon,filled:!0,className:"text-[18px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:r.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[rn,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h2",{className:"min-w-0 line-clamp-2 text-[length:var(--mn-swipe-title)] font-extrabold leading-[1.02] text-white",children:s.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:sn})]}),Ee&&e.jsxs("p",{className:"mt-1 text-[length:var(--mn-swipe-subtitle)] font-semibold text-white/60",children:["Directed by ",Ee.split(",")[0]]}),Ve&&e.jsx("div",{className:"mt-4 text-[length:var(--mn-swipe-meta)] text-white/70 whitespace-nowrap overflow-hidden text-ellipsis",children:Ve}),Array.isArray(s.friendProfiles)&&s.friendProfiles.length>0&&e.jsxs("button",{type:"button",onClick:()=>bn(!0),className:"mt-5 flex w-full items-center justify-between gap-3 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-left backdrop-blur-md","aria-label":"See friends","data-swipe-interactive":"true",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ir,{profiles:s.friendProfiles,max:3,size:32}),e.jsxs("div",{className:"leading-tight",children:[e.jsxs("p",{className:"text-[length:var(--mn-swipe-subtitle)] font-extrabold text-white",children:[x(Math.round(ss),0,100),"% of friends"]}),e.jsxs("p",{className:"text-sm font-semibold text-white/60",children:[s.source==="from-friends"?"watched":"liked"," ","this title"]})]})]}),e.jsx("div",{className:"grid h-[var(--mn-swipe-hit)] w-[var(--mn-swipe-hit)] place-items-center rounded-full border border-white/10 bg-white/10 text-white/70",children:e.jsx(j,{name:"chevron_right",className:"text-[length:var(--mn-swipe-top-icon)]"})})]}),er.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:er.map(t=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/10 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-white/75",children:["#",t]},t))})]})]})]}),Ie&&s&&e.jsxs("div",{className:"absolute inset-0 z-10 flex h-full flex-col",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden bg-[#261933]",children:[Kn&&s.posterUrl?e.jsx("img",{src:s.posterUrl,alt:qt(s)??`${s.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>Ue(!0),style:{filter:"blur(6px) brightness(0.60)",transform:"scale(1.14)"}}):e.jsx(mn,{title:s.title}),e.jsx("div",{className:"pointer-events-none absolute inset-0 z-0 bg-gradient-to-b from-black/10 via-black/60 to-[#261933]"})]}),e.jsx("button",{type:"button",onClick:()=>Mt(!1),className:"absolute right-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)] z-20 inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/80 backdrop-blur hover:bg-white/15","aria-label":"Close details","data-swipe-interactive":"true",children:e.jsx(j,{name:"close",className:"text-[length:var(--mn-swipe-top-icon)]"})}),e.jsxs("div",{className:"relative z-10 flex min-h-0 flex-1 flex-col px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)] pt-[calc(var(--mn-swipe-top-hit)+var(--mn-swipe-pad)*0.75)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-0 bg-gradient-to-b from-[#261933]/35 via-[#261933]/90 to-[#261933]"}),e.jsxs("div",{ref:Kt,id:"swipe-detail-panel","aria-label":St?"Full details":"Details summary","aria-live":"polite",className:"relative z-10 mt-1 flex min-h-0 flex-1 flex-col text-left text-[13px] text-white/70",children:[e.jsx("div",{"data-swipe-interactive":"true",className:"flex min-h-0 flex-1 flex-col overflow-hidden",children:St?e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[e.jsxs("div",{className:"shrink-0 space-y-2",children:[(()=>{const t=s.source??"for-you",r=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.25)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/80",children:[e.jsx(j,{name:r.icon,filled:!0,className:"text-[length:calc(var(--mn-swipe-chip)+0.25rem)]"}),e.jsx("span",{className:"tracking-[0.12em]",children:r.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[rn,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"min-w-0 line-clamp-1 text-[clamp(1.05rem,4.6vw,1.35rem)] font-extrabold text-white",children:s.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.7)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:sn})]}),Ve&&e.jsx("p",{className:"text-[length:var(--mn-swipe-meta)] text-white/55 whitespace-nowrap overflow-hidden text-ellipsis",children:Ve})]}),e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-2 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 grid grid-cols-2 gap-x-3 gap-y-2 rounded-2xl border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.5)] text-[length:var(--mn-swipe-chip)] leading-snug text-white/75",children:(()=>{const t=[];if(Yn.length>0&&t.push({label:"Genres",value:Yn.slice(0,6).join(", ")}),qn.length>0&&t.push({label:"Languages",value:qn.slice(0,4).join(", ")}),Ee&&t.push({label:"Director",value:Ee}),Ln&&t.push({label:"Writers",value:Ln}),lt){const l=lt.split(",").map(c=>c.trim()).filter(Boolean).slice(3);l.length>0&&t.push({label:"More cast",value:l.slice(0,8).join(", ")})}return On&&t.push({label:"Released",value:On}),Dn&&t.push({label:"Awards",value:Dn}),$n&&t.push({label:"Box office",value:$n}),We&&J(We)!=null&&t.push({label:"IMDb",value:String(J(We)?.toFixed(1))}),Qt&&J(Qt)!=null&&t.push({label:"RT",value:`${String(J(Qt))}%`}),Jt&&or(Jt)&&t.push({label:"IMDb votes",value:String(or(Jt))}),Zt&&J(Zt)!=null&&t.push({label:"Metascore",value:String(J(Zt))}),t.slice(0,10).map(r=>e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.14em] text-white/45",children:r.label}),e.jsx("p",{className:"line-clamp-2",children:r.value})]},r.label))})()}),e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden rounded-2xl border border-white/10 bg-white/10 px-3 py-2",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.14em] text-white/45",children:"Overview"}),Dt?e.jsx("p",{className:"mt-1 min-h-0 flex-1 overflow-hidden text-[length:var(--mn-swipe-meta)] leading-relaxed text-white/70",style:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:U,overflow:"hidden"},children:Dt}):e.jsx("p",{className:"mt-1 text-[length:var(--mn-swipe-meta)] text-white/40",children:"No overview available."})]})]})]}):e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[e.jsxs("div",{className:"shrink-0 space-y-2",children:[(()=>{const t=s.source??"for-you",r=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.25)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/80",children:[e.jsx(j,{name:r.icon,filled:!0,className:"text-[length:calc(var(--mn-swipe-chip)+0.25rem)]"}),e.jsx("span",{className:"tracking-[0.12em]",children:r.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[rn,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"min-w-0 line-clamp-2 text-[clamp(1.25rem,5vw,1.75rem)] font-extrabold leading-[1.06] text-white",children:s.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.7)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:sn})]}),Ve&&e.jsx("p",{className:"text-[clamp(0.78rem,2.8vw,0.95rem)] text-white/60 whitespace-nowrap overflow-hidden text-ellipsis",children:Ve}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 text-[clamp(0.70rem,2.6vw,0.8rem)] text-white/65",children:[ae&&e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[e.jsx("span",{className:"shrink-0 font-semibold text-white/75",children:"Genres"}),e.jsx("span",{className:"min-w-0 flex-1 truncate",children:Array.isArray(ae)?ae.slice(0,3).join(", "):String(ae).split(",").map(t=>t.trim()).slice(0,3).join(", ")})]}),Un&&e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 font-semibold text-white/85",children:Un}),Pn&&e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 font-semibold text-white/70",children:Pn})]})]}),Dt?e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden rounded-2xl border border-white/10 bg-white/10 px-3 py-2",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.16em] text-white/45",children:"Overview"}),e.jsx("p",{className:"mt-1 min-h-0 flex-1 overflow-hidden text-[clamp(0.82rem,2.9vw,0.95rem)] leading-relaxed text-white/70",style:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:_,overflow:"hidden"},children:Dt})]}):e.jsx("div",{className:"min-h-0 flex-1"}),Ee||lt?e.jsxs("div",{className:"shrink-0 min-w-0 space-y-1 text-[clamp(0.70rem,2.6vw,0.78rem)] text-white/70",children:[Ee&&e.jsxs("p",{className:"line-clamp-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-white/75",children:"Director:"})," ",e.jsx("span",{className:"min-w-0",children:Ee})]}),lt&&e.jsxs("p",{className:"line-clamp-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-white/75",children:"Cast:"})," ",e.jsx("span",{className:"min-w-0",children:lt.split(",").map(t=>t.trim()).filter(Boolean).slice(0,4).join(", ")})]})]}):null,e.jsxs("div",{className:"shrink-0 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1.5",children:[e.jsx("span",{className:"text-[length:var(--mn-swipe-chip)] font-semibold text-white/50",children:"Your rating"}),e.jsx("div",{className:"flex items-center gap-0.5","aria-label":"Your rating",children:Array.from({length:5}).map((t,r)=>{const l=r+1,c=nn!=null&&nn>=l;return e.jsx("button",{type:"button",onClick:()=>Xr(l),className:"flex h-[var(--mn-swipe-star-hit)] w-[var(--mn-swipe-star-hit)] items-center justify-center rounded-full hover:scale-105 focus-visible:outline-none",children:e.jsx(j,{name:"star",filled:c,className:`text-[length:var(--mn-swipe-star-icon)] ${c?"text-yellow-400":"text-white/30"}`})},l)})})]}),e.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{type:"button",onClick:()=>Wn(Fe),className:`inline-flex items-center rounded-full px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold transition-colors ${Xn(Fe)?"bg-primary/90 text-primary-foreground":"border border-white/10 bg-white/10 text-white/75 hover:bg-white/15"}`,children:"Watchlist"}),e.jsx("button",{type:"button",onClick:()=>Wn(Ze),className:`inline-flex items-center rounded-full px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold transition-colors ${Xn(Ze)?"bg-emerald-500/90 text-primary-foreground":"border border-white/10 bg-white/10 text-white/75 hover:bg-white/15"}`,children:"Watched"}),e.jsxs("button",{type:"button",onClick:()=>Nn(!0),className:"inline-flex items-center gap-1 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/75 hover:bg-white/15",children:[e.jsx(j,{name:"share",className:"text-[length:calc(var(--mn-swipe-chip)+0.2rem)]"}),e.jsx("span",{children:"Share"})]})]})]}),typeof s.friendLikesCount=="number"&&s.friendLikesCount>0||s.topFriendName&&s.topFriendReviewSnippet?e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.5)] text-[length:var(--mn-swipe-chip)] text-white/80 shadow-md",children:[typeof s.friendLikesCount=="number"&&s.friendLikesCount>0&&e.jsxs("div",{className:"inline-flex items-center gap-1 text-[length:var(--mn-swipe-chip)] text-white/60",children:[e.jsx(j,{name:"local_fire_department",filled:!0,className:"text-[16px] text-primary/80"}),s.friendLikesCount===1?"1 friend likes this":`${s.friendLikesCount} friends like this`]}),s.topFriendName&&s.topFriendReviewSnippet&&e.jsxs("div",{className:"mt-1 inline-flex w-full items-start gap-2 text-left",children:[e.jsx(j,{name:"check_circle",filled:!0,className:"mt-0.5 text-[16px] text-primary"}),e.jsxs("span",{className:"block line-clamp-2 text-[length:var(--mn-swipe-chip)]",children:[s.topFriendName,": “",s.topFriendReviewSnippet,"”"]})]})]}):null]})]})}),e.jsx("div",{className:"mt-2 flex shrink-0 justify-end",children:e.jsx("button",{type:"button",onClick:()=>Rt(t=>!t),"aria-expanded":St,"aria-controls":"swipe-detail-panel",className:"inline-flex items-center gap-1 rounded-full border border-white/15 bg-white/5 px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/70 hover:bg-white/10 hover:text-white",children:e.jsx("span",{children:St?"Collapse":"Full details"})})})]})]})]})]},re??"empty")})]}),Y&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center bg-gradient-to-b from-background/70 via-background/50 to-background/80",children:e.jsxs("div",{className:"pointer-events-auto max-w-xs rounded-2xl border border-border bg-background/95 p-4 text-center shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Swipe to decide"}),e.jsx("p",{className:"mt-1 text-[12px] text-muted-foreground",children:"Swipe left to pass, right to save what you love."}),e.jsx("button",{type:"button",className:"mt-3 w-full rounded-xl bg-primary px-3 py-2 text-sm font-semibold text-white shadow-md",onClick:()=>{V(!1),typeof window<"u"&&Oe(bt,"1")},children:"Got it"})]})})]})]}),e.jsxs("div",{className:"mt-2 flex shrink-0 items-center justify-center gap-[var(--mn-swipe-gap)]","aria-label":"Swipe actions",children:[e.jsx("button",{type:"button",onClick:()=>Ge("dislike"),disabled:mt,className:"inline-flex h-[var(--mn-swipe-action)] w-[var(--mn-swipe-action)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/60 shadow-md backdrop-blur transition-all duration-150 hover:bg-white/15 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Dislike",children:e.jsx(j,{name:"close",className:"text-[length:var(--mn-swipe-icon)]"})}),e.jsx("button",{type:"button",onClick:qr,disabled:mt,className:"relative inline-flex h-[var(--mn-swipe-action-primary)] w-[var(--mn-swipe-action-primary)] items-center justify-center rounded-full bg-primary text-primary-foreground shadow-[0_22px_55px_rgba(0,0,0,0.55)] transition-all duration-150 hover:brightness-110 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Add to watchlist",children:e.jsx(j,{name:"bookmark_add",filled:!0,className:"text-[length:var(--mn-swipe-icon-primary)]"})}),e.jsx("button",{type:"button",onClick:()=>Ge("like"),disabled:mt,className:"inline-flex h-[var(--mn-swipe-action)] w-[var(--mn-swipe-action)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/60 shadow-md backdrop-blur transition-all duration-150 hover:bg-white/15 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Like",children:e.jsx(j,{name:"favorite",filled:!0,className:"text-[length:var(--mn-swipe-icon)]"})})]}),e.jsx(Zs,{isOpen:Ir,onClose:()=>Nn(!1),activeCard:s,shareUrl:Hr,onShareExternal:Kr}),e.jsx(Os,{open:Rr,onOpenChange:bn,profiles:s?.friendProfiles??[],verb:s?.source==="from-friends"?"watched":"liked"}),e.jsx(yr,{open:b,onOpenChange:R,children:e.jsxs(jr,{className:"max-w-md border border-border/60 bg-card text-foreground",children:[e.jsxs(Nr,{children:[e.jsx(kr,{children:"Filters"}),e.jsx(_s,{className:"text-muted-foreground",children:"Fine-tune what shows up in your Discovery deck."})]}),e.jsxs("div",{className:"mt-2 space-y-5",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs font-semibold tracking-wide text-muted-foreground",children:"Feedback"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>Tn(t=>!t),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",Ye?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[e.jsx(j,{name:"vibration",filled:!0,className:"text-[18px] "+(Ye?"text-primary":"text-muted-foreground")}),"Haptics"]}),e.jsxs("button",{type:"button",onClick:()=>Fn(t=>!t),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",ze?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[e.jsx(j,{name:ze?"volume_up":"volume_off",filled:!0,className:"text-[18px] "+(ze?"text-primary":"text-muted-foreground")}),"Sound"]})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Turn these off if you prefer silent, minimal feedback."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs font-semibold tracking-wide text-muted-foreground",children:"Content type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{label:"All",value:null},{label:"Movies",value:"movie"},{label:"Series",value:"series"},{label:"Anime",value:"anime"}].map(t=>{const r=i===t.value;return e.jsxs("button",{type:"button",onClick:()=>o(t.value),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",r?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[r?e.jsx(j,{name:"check_circle",filled:!0,className:"text-[18px] text-primary"}):e.jsx("span",{className:"h-4 w-4"}),t.label]},t.label)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide text-muted-foreground",children:"Genres"}),w.length>0&&e.jsx("button",{type:"button",onClick:()=>g([]),className:"text-xs font-semibold text-primary hover:underline",children:"Clear"})]}),Nt.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Load a few cards to unlock genre filters."}):e.jsx("div",{className:"max-h-40 overflow-auto rounded-xl border border-border/60 bg-background/20 p-2",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Nt.map(t=>{const r=w.some(l=>l.toLowerCase()===t.toLowerCase());return e.jsx("button",{type:"button",onClick:()=>g(l=>r?l.filter(c=>c.toLowerCase()!==t.toLowerCase()):[...l,t]),className:["rounded-full border px-3 py-1 text-xs font-semibold transition",r?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-card/40 text-muted-foreground hover:bg-card/55"].join(" "),children:t},t)})})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide text-muted-foreground",children:"Minimum rating"}),e.jsx("div",{className:"text-xs font-semibold text-foreground",children:S<=0?"Any":S.toFixed(1)})]}),e.jsx("input",{type:"range",min:0,max:10,step:.5,value:S,onChange:t=>N(Number(t.target.value)),className:"w-full"}),e.jsxs("div",{className:"mt-1 flex justify-between text-[11px] text-muted-foreground",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"10"})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{o(null),g([]),N(0)},className:"flex-1 rounded-xl border border-border/60 bg-background/20 px-4 py-2 text-sm font-semibold text-muted-foreground hover:bg-background/35",children:"Reset"}),e.jsx("button",{type:"button",onClick:()=>R(!1),className:"flex-1 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground hover:opacity-90",children:"Done"})]})]})]})}),is()]})]})},Zs=({isOpen:n,onClose:i,activeCard:o,shareUrl:b,onShareExternal:R})=>{const{user:w}=vr(),{data:g=[],isLoading:S}=js();if(a.useEffect(()=>{if(!n)return;const _=U=>{U.key==="Escape"&&i()};return window.addEventListener("keydown",_),()=>window.removeEventListener("keydown",_)},[n,i]),!n||!o)return null;const N=`Check this out: ${o.title}

${b}`,X=_=>{_.target===_.currentTarget&&i()},A=_=>{(_.key==="Enter"||_.key===" ")&&i()};return e.jsx("div",{role:"button",tabIndex:0,className:"fixed inset-0 z-[9999] flex flex-col justify-end bg-black/55",onClick:X,onKeyDown:A,children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"pointer-events-auto mb-[72px] w-full max-w-md self-center rounded-t-2xl bg-card pb-3 pt-2 shadow-[0_-18px_45px_rgba(0,0,0,0.65)]",children:[e.jsxs("div",{className:"flex items-center justify-between px-[var(--page-pad-x)] pb-2",children:[e.jsx("button",{type:"button","aria-hidden":"true",tabIndex:-1,className:"inline-flex h-11 w-11 items-center justify-center rounded-full text-muted-foreground",children:e.jsx(j,{name:"search",className:"text-[18px]"})}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Send to"}),e.jsx("button",{type:"button",onClick:i,"aria-label":"Close",className:"inline-flex h-11 w-11 items-center justify-center rounded-full text-muted-foreground transition hover:bg-background/80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",children:e.jsx("span",{className:"text-[18px] leading-none",children:"×"})})]}),e.jsxs("section",{className:"border-t border-border px-[var(--page-pad-x)] pt-3 pb-2",children:[e.jsx("h2",{className:"mb-2 text-[12px] font-medium uppercase tracking-[0.08em] text-muted-foreground/90",children:"Send to"}),S?e.jsx("div",{className:"flex gap-3 overflow-hidden",children:Array.from({length:4}).map((_,U)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"h-11 w-11 animate-pulse rounded-full bg-border/50"}),e.jsx("div",{className:"h-2.5 w-12 animate-pulse rounded bg-border/40"})]},U))}):w?g.length===0?e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"No conversations yet. Start a chat from a profile or the Messages tab."}):e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:g.map(_=>e.jsx(Js,{conversation:_,text:N},_.id))}):e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"Sign in to share via messages."})]}),e.jsx("section",{className:"border-t border-border px-[var(--page-pad-x)] pt-3 pb-3",children:e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:[e.jsx(ti,{shareUrl:b,title:o.title}),e.jsx(ni,{shareUrl:b,title:o.title}),e.jsx(ri,{onShareExternal:R}),e.jsx(ei,{shareUrl:b})]})})]})})},Js=({conversation:n,text:i})=>{const o=n.isGroup?null:n.participants?.find(N=>!N.isSelf)??n.participants?.[0],b=o?.displayName??n.title??"Conversation",R=o?.avatarUrl,w=ks(n.id),g=()=>{w.isPending||w.mutate({text:i})},S=b.split(" ").map(N=>N.charAt(0).toUpperCase()).slice(0,2).join("");return e.jsxs("button",{type:"button",onClick:g,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center overflow-hidden rounded-full bg-muted text-xs text-muted-foreground",children:R?e.jsx("img",{src:R,alt:b,className:"h-full w-full object-cover"}):e.jsx("span",{children:S})}),w.isSuccess&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-emerald-500",children:e.jsx(j,{name:"check",filled:!0,className:"text-[14px] text-primary-foreground"})})]}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:b})]})},ei=({shareUrl:n})=>{const i=async()=>{if(navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(n)}catch{}};return e.jsxs("button",{type:"button",onClick:i,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx(j,{name:"link",className:"text-[18px] text-primary-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Copy link"})]})},ti=({shareUrl:n,title:i})=>{const o=()=>{if(typeof window>"u")return;const b=`Check this out: ${i}

${n}`,R=`https://api.whatsapp.com/send?text=${encodeURIComponent(b)}`;window.open(R,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:o,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"W"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"WhatsApp"})]})},ni=({shareUrl:n,title:i})=>{const o=()=>{if(typeof window>"u")return;const b=`Check this out: ${i}

${n}`,R=`https://t.me/share/url?url=${encodeURIComponent(n)}&text=${encodeURIComponent(b)}`;window.open(R,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:o,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"T"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Telegram"})]})},ri=({onShareExternal:n})=>{const i=async()=>{await n()};return e.jsxs("button",{type:"button",onClick:i,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full border border-border bg-muted",children:e.jsx(j,{name:"more_horiz",className:"text-[18px] text-muted-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"More"})]})};export{ji as default};
