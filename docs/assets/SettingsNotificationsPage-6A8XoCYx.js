import{D as h,b as v,e as j,c as N,j as e,A as S,r as x,B as w,F as A,n as k,s as _}from"./index-BhYCkKJ1.js";import{T as C}from"./TopBar-Bg4ZNmLN.js";import{C as f}from"./circle-alert-BzPyYlSk.js";import{B as T}from"./bell-p7JEW6s7.js";import{C as R}from"./circle-check-Bz691XLV.js";import"./arrow-left-BlxqK35Q.js";const E=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],P=h("inbox",E);const q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],B=h("info",q);const I=[["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}],["path",{d:"M7 10v12",key:"1qc93n"}]],L=h("thumbs-up",I),p={emailActivity:!0,emailRecommendations:!0,inAppSocial:!0,inAppSystem:!0},b=["settings","notifications"],M=({initialPrefs:t,onSave:l})=>{const[s,r]=x.useState(t),[n,d]=x.useState(!1),[m,o]=x.useState("idle"),a=g=>{r(y=>({...y,[g]:!y[g]}))},i=async()=>{d(!0),o("idle");try{await l(s),o("saved"),setTimeout(()=>o("idle"),2e3)}catch{o("error"),setTimeout(()=>o("idle"),3e3)}finally{d(!1)}},c=JSON.stringify(s)!==JSON.stringify(t);return e.jsxs("div",{className:"space-y-6 px-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{icon:e.jsx(T,{className:"h-4 w-4"}),title:"Email Activity",description:"Get notified about new followers and activity.",enabled:s.emailActivity,onToggle:()=>a("emailActivity")}),e.jsx(u,{icon:e.jsx(L,{className:"h-4 w-4"}),title:"Recommendations",description:"Periodic emails with personalized media picks.",enabled:s.emailRecommendations,onToggle:()=>a("emailRecommendations")}),e.jsx(u,{icon:e.jsx(P,{className:"h-4 w-4"}),title:"Social Notifications",description:"In-app alerts for likes, comments, and mentions.",enabled:s.inAppSocial,onToggle:()=>a("inAppSocial")}),e.jsx(u,{icon:e.jsx(f,{className:"h-4 w-4"}),title:"System Notifications",description:"Important updates about your account and the app.",enabled:s.inAppSystem,onToggle:()=>a("inAppSystem")})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsxs(w,{onClick:i,disabled:n||!c,className:"rounded-full px-6",children:[n&&e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}),n?"Saving...":"Save Changes"]}),m==="saved"&&e.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-emerald-500 font-medium",children:[e.jsx(R,{className:"h-4 w-4"}),"Saved successfully"]}),m==="error"&&e.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-destructive font-medium",children:[e.jsx(f,{className:"h-4 w-4"}),"Failed to save preferences"]})]})]})},u=({icon:t,title:l,description:s,enabled:r,onToggle:n})=>e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-xl border border-border/50 bg-card/60 p-4 shadow-sm transition-all hover:bg-card/80",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"mt-0.5 rounded-full bg-secondary/80 p-2 text-muted-foreground shadow-inner",children:t}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h3",{className:"text-sm font-heading font-semibold text-foreground leading-none",children:l}),e.jsx("p",{className:"text-[11px] leading-tight text-muted-foreground",children:s})]})]}),e.jsx("button",{type:"button",onClick:n,className:`relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 focus-visible:ring-offset-2 focus-visible:ring-offset-background ${r?"bg-primary shadow-[0_0_8px_rgba(var(--primary-rgb),0.3)]":"bg-muted shadow-inner"}`,children:e.jsx("span",{className:`pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow-sm ring-0 transition-transform ${r?"translate-x-6":"translate-x-1"}`})})]}),D=()=>{const{user:t}=v(),l=j(),{data:s,isLoading:r,isError:n,error:d}=N({queryKey:b,enabled:!!t,queryFn:async()=>{const{data:a,error:i}=await _.from("user_preferences").select("notifications, updated_at").eq("user_id",t.id).maybeSingle();if(i)throw i;const c=a?.notifications||{};return{emailActivity:c.emailActivity??p.emailActivity,emailRecommendations:c.emailRecommendations??p.emailRecommendations,inAppSocial:c.inAppSocial??p.inAppSocial,inAppSystem:c.inAppSystem??p.inAppSystem,updated_at:a?.updated_at||new Date().toISOString()}}}),m=async a=>{const i=await k("update-notification-prefs",a);if(!i.ok)throw new Error(i.error??"Unable to save preferences");return l.invalidateQueries({queryKey:b}),i.preferences};if(!t)return e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md rounded-2xl border border-border bg-card/80 px-4 py-6 text-center text-sm text-foreground shadow-sm",children:[e.jsx("h1",{className:"text-base font-heading font-semibold",children:"You're signed out"}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Sign in to manage how MoviNesta contacts you."})]})});if(r)return e.jsx(S,{message:"Loading settingsâ€¦"});if(n||!s)return e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md rounded-2xl border border-border bg-card/80 px-4 py-6 text-center text-sm text-foreground shadow-sm",children:[e.jsx(f,{className:"mx-auto mb-2 h-8 w-8 text-destructive opacity-80"}),e.jsx("h1",{className:"text-base font-heading font-semibold",children:"Error"}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"We couldn't load your preferences."}),d&&e.jsx("p",{className:"mt-1 text-[10px] text-muted-foreground font-mono opacity-60",children:d.message})]})});const o={emailActivity:s.emailActivity,emailRecommendations:s.emailRecommendations,inAppSocial:s.inAppSocial,inAppSystem:s.inAppSystem};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-12 pt-1",children:[e.jsx(C,{title:"Notifications"}),e.jsxs("div",{className:"mx-4 flex items-start gap-2 rounded-md border border-border/40 bg-card/40 p-3 text-[12px] text-muted-foreground shadow-sm backdrop-blur-sm",children:[e.jsx(B,{className:"mt-0.5 h-3.5 w-3.5 text-muted-foreground","aria-hidden":"true"}),e.jsx("p",{className:"leading-relaxed",children:"Notification preferences are saved to your account and sync across all devices."})]}),e.jsx(M,{initialPrefs:o,user:t,onSave:m},s.updated_at)]})};export{D as default};
