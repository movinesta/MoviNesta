import{c as $,j as e,m as L,u as M,r as y,g as D,S as q,M as R,s as p}from"./index-D8UbFo8l.js";import{P as f}from"./PageChrome-BL71Rgrf.js";import{T as h}from"./TopBar-ClKHHvFp.js";import{u as V}from"./useProfile-BHIva-OA.js";import{D as Y,a as z}from"./DiaryLibraryTab-CCVS7T3L.js";import{u as B,U as O,a as K}from"./useToggleFollow-Bad84SvB.js";import{L as v}from"./loader-circle-Dp3r3KYi.js";import{U as W}from"./users-CgaclyYW.js";import"./brand-DTIDtbc4.js";import"./index-WHzSfndh.js";import"./format-DWLSBLoY.js";import"./film-E5LDX5VI.js";import"./bookmark-plus-CSSRfPFt.js";import"./star-dR1loror.js";import"./diaryStatus-CEaO_AiJ.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=$("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),G=({profileId:t,displayName:a,username:r,isCurrentUser:i=!1})=>e.jsx("div",{className:"mt-2",children:e.jsx(Y,{userId:t,isOwnProfile:i,displayName:a,username:r})}),H=({profileId:t,displayName:a,username:r,isCurrentUser:i=!1})=>e.jsx("div",{className:"mt-2",children:e.jsx(z,{userId:t,isOwnProfile:i,displayName:a,username:r})}),_=t=>t>=1e6?`${(t/1e6).toFixed(1).replace(/\.0$/,"")}M`:t>=1e3?`${(t/1e3).toFixed(1).replace(/\.0$/,"")}K`:String(t??0),J=(t,a)=>{const i=(t||a||"").replace(/^@/,"").trim();if(!i)return"?";const n=i.split(/\s+/);return n.length===1?n[0].slice(0,2).toUpperCase():(n[0][0]+n[1][0]).toUpperCase()},xe=()=>{const{username:t}=L(),a=M(),[r,i]=y.useState("activity"),[n,j]=y.useState(!1),{data:s,isLoading:k,isError:I,error:u}=V(t??null),{user:g}=D(),b=B(),w=y.useMemo(()=>s?s.displayName||s.username||"Profile":t?`@${t}`:"Profile",[s,t]);if(!t)return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-3 pb-4 pt-2 sm:px-4 lg:px-6",children:[e.jsx(h,{title:"Profile",subtitle:"This route needs a username to show someone’s profile."}),e.jsx(f,{children:e.jsxs("p",{className:"text-sm text-mn-text-secondary",children:["Make sure you are visiting a URL like",e.jsx("span",{className:"mx-1 rounded bg-mn-bg-elevated px-1.5 py-0.5 font-mono text-[11px]",children:"/u/<username>"}),"so we know whose profile to display."]})})]});if(k)return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-3 pb-4 pt-2 sm:px-4 lg:px-6",children:[e.jsx(h,{title:"Loading profile"}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-mn-text-secondary",children:[e.jsx(v,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}),e.jsx("span",{children:"Fetching profile details…"})]})})]});if(I||!s)return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-3 pb-4 pt-2 sm:px-4 lg:px-6",children:[e.jsx(h,{title:"Profile not found"}),e.jsxs(f,{children:[e.jsxs("p",{className:"text-sm text-mn-text-secondary",children:["We couldn't find a profile for username",e.jsxs("span",{className:"mx-1 rounded bg-mn-bg-elevated px-1.5 py-0.5 font-mono text-[11px]",children:["@",t]}),"."]}),(u==null?void 0:u.message)&&e.jsxs("p",{className:"mt-3 text-[11px] text-mn-text-muted",children:[e.jsx("span",{className:"font-semibold",children:"Details:"})," ",u.message]})]})]});const N=async()=>{if(s){if(s.isCurrentUser){a("/settings");return}b.isPending||b.mutate({targetUserId:s.id,currentlyFollowing:s.isFollowing})}},S=async()=>{if(!(!s||s.isCurrentUser)){if(!(g!=null&&g.id)){alert("You need to be signed in to message other members.");return}j(!0);try{const l=g.id,{data:A,error:C}=await p.from("conversation_participants").select("conversation_id").eq("user_id",l);if(C)throw C;const P=(A??[]).map(d=>d.conversation_id);let c=null;if(P.length>0){const{data:d,error:x}=await p.from("conversation_participants").select("conversation_id").eq("user_id",s.id).in("conversation_id",P);if(x)throw x;const m=Array.from(new Set((d??[]).map(o=>o.conversation_id)));if(m.length>0){const{data:o,error:U}=await p.from("conversations").select("id, is_group, updated_at").in("id",m).eq("is_group",!1).order("updated_at",{ascending:!1}).limit(1);if(U)throw U;o&&o.length>0&&(c=o[0].id)}}if(!c){const{data:d,error:x}=await p.from("conversations").insert({is_group:!1,title:null,created_by:l}).select("id").single();if(x)throw x;const m=d==null?void 0:d.id,{error:o}=await p.from("conversation_participants").insert([{conversation_id:m,user_id:l,role:"member"},{conversation_id:m,user_id:s.id,role:"member"}]);if(o)throw o;c=m}if(!c)throw new Error("Failed to start a conversation.");a(`/messages/${c}`)}catch(l){console.error("[ProfilePage] Failed to start conversation",l),alert((l==null?void 0:l.message)??"Something went wrong while starting the conversation. Please try again.")}finally{j(!1)}}},T=s.isCurrentUser?"Edit profile":s.isFollowing?"Following":"Follow",E=s.isCurrentUser?F:s.isFollowing?O:K;return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 px-3 pb-6 pt-2 sm:px-4 lg:px-6",children:[e.jsx(h,{title:w,subtitle:s.bio||"See their diary entries, activity, and who they follow."}),e.jsx(f,{children:e.jsxs("div",{className:"flex flex-col gap-6 rounded-2xl border border-mn-border-subtle bg-gradient-to-r from-mn-bg to-mn-bg-elevated/60 p-4 shadow-mn-card sm:p-5",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:gap-6",children:[e.jsxs("div",{className:"flex items-start gap-4 sm:gap-5",children:[e.jsxs("div",{className:"relative flex h-20 w-20 items-center justify-center rounded-[28px] bg-gradient-to-br from-mn-primary/15 via-mn-accent-teal/20 to-mn-bg ring-1 ring-mn-border-subtle/80",children:[s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:s.displayName||s.username||"Profile avatar",className:"h-20 w-20 rounded-[22px] object-cover"}):e.jsx("span",{className:"text-lg font-semibold text-mn-accent-teal","aria-hidden":"true",children:J(s.displayName,s.username)}),!s.isCurrentUser&&e.jsx("span",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 rounded-full bg-mn-primary/10 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-mn-primary ring-1 ring-mn-primary/30",children:s.isFollowing?"Following":"New"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-heading font-semibold text-mn-text-primary",children:w}),s.username&&e.jsxs("span",{className:"rounded-full bg-mn-bg px-2 py-0.5 text-[11px] font-mono text-mn-text-secondary ring-1 ring-mn-border-subtle",children:["@",s.username]}),s.isCurrentUser&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-primary/10 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-mn-primary ring-1 ring-mn-primary/30",children:[e.jsx(q,{className:"h-3 w-3","aria-hidden":"true"}),"You"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-center text-[12px] text-mn-text-secondary",children:[e.jsxs("div",{className:"flex min-w-[80px] flex-col",children:[e.jsx("span",{className:"text-base font-semibold text-mn-text-primary",children:_(s.followersCount)}),e.jsx("span",{className:"text-[11px] uppercase tracking-wide",children:"Followers"})]}),e.jsxs("div",{className:"flex min-w-[80px] flex-col",children:[e.jsx("span",{className:"text-base font-semibold text-mn-text-primary",children:_(s.followingCount)}),e.jsx("span",{className:"text-[11px] uppercase tracking-wide",children:"Following"})]}),e.jsxs("div",{className:"flex min-w-[80px] flex-col",children:[e.jsx("span",{className:"text-base font-semibold text-mn-text-primary",children:r==="activity"?"Activity":"Diary"}),e.jsx("span",{className:"text-[11px] uppercase tracking-wide",children:"View"})]})]}),s.bio&&e.jsx("p",{className:"max-w-2xl whitespace-pre-line text-[12px] leading-snug text-mn-text-secondary",children:s.bio})]})]}),e.jsx("div",{className:"flex flex-1 flex-wrap items-start justify-end gap-2",children:s.isCurrentUser?e.jsxs("button",{type:"button",onClick:N,className:"inline-flex items-center gap-1.5 rounded-full border border-mn-border-subtle bg-mn-bg-elevated px-3 py-1.5 text-[12px] font-semibold text-mn-text-primary shadow-mn-card transition hover:bg-mn-bg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-primary focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg",children:[e.jsx(F,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Edit profile"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:N,disabled:b.isPending,className:`inline-flex items-center gap-1.5 rounded-full px-3 py-1.5 text-[12px] font-semibold shadow-mn-card transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-primary focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg disabled:opacity-60 ${s.isFollowing?"border border-mn-border-subtle bg-mn-bg-elevated text-mn-text-primary hover:bg-mn-bg":"border border-transparent bg-mn-primary text-mn-bg hover:bg-mn-primary/90"}`,children:[b.isPending?e.jsx(v,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}):e.jsx(E,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:T})]}),e.jsxs("button",{type:"button",onClick:S,disabled:n,className:"inline-flex items-center gap-1.5 rounded-full border border-mn-border-subtle bg-mn-bg-elevated px-3 py-1.5 text-[12px] font-semibold text-mn-text-primary shadow-mn-card transition hover:bg-mn-bg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-primary focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg disabled:cursor-not-allowed disabled:opacity-60",children:[n?e.jsx(v,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}):e.jsx(R,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:n?"Starting…":"Message"})]})]})})]}),!s.isCurrentUser&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-xl border border-dashed border-mn-border-subtle/80 bg-mn-bg/70 px-3 py-2 text-[11px] text-mn-text-secondary shadow-mn-soft",children:[e.jsx(W,{className:"h-4 w-4 text-mn-primary","aria-hidden":"true"}),e.jsx("p",{className:"font-medium text-mn-text-primary",children:"Follow to catch their latest reviews and diary logs."})]})]})}),e.jsx(f,{tone:"muted",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-xl bg-mn-bg/70 px-3 py-2 text-[11px] text-mn-text-secondary ring-1 ring-mn-border-subtle/70",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"rounded-full bg-mn-primary/10 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-mn-primary",children:"Profile view"}),e.jsxs("p",{className:"text-mn-text-primary",children:["You're browsing ",s.isCurrentUser?"your":"their"," latest activity and"," ","diary entries."]})]}),!s.isCurrentUser&&s.username&&e.jsxs("span",{className:"rounded-full bg-mn-bg px-2 py-0.5 font-mono text-[10px] text-mn-text-muted ring-1 ring-mn-border-subtle/70",children:["@",s.username]})]}),e.jsxs("nav",{className:"flex items-center gap-2 rounded-full bg-mn-bg/80 p-1 text-[11px]","aria-label":"Profile tabs",children:[e.jsx("button",{type:"button",onClick:()=>i("activity"),className:`flex-1 rounded-full px-3 py-1.5 text-center font-medium ${r==="activity"?"bg-mn-bg-elevated shadow-mn-card text-mn-text-primary":"text-mn-text-secondary hover:text-mn-text-primary"}`,"aria-pressed":r==="activity",children:"Activity"}),e.jsx("button",{type:"button",onClick:()=>i("diary"),className:`flex-1 rounded-full px-3 py-1.5 text-center font-medium ${r==="diary"?"bg-mn-bg-elevated shadow-mn-card text-mn-text-primary":"text-mn-text-secondary hover:text-mn-text-primary"}`,"aria-pressed":r==="diary",children:"Diary"})]}),e.jsx("div",{"aria-live":"polite",className:"rounded-xl border border-mn-border-subtle/60 bg-mn-bg-elevated/60 px-3 py-3 shadow-mn-soft",children:r==="activity"?e.jsx(G,{profileId:s.id,displayName:s.displayName,username:s.username,isCurrentUser:s.isCurrentUser}):e.jsx(H,{profileId:s.id,displayName:s.displayName,username:s.username,isCurrentUser:s.isCurrentUser})})]})})]})};export{xe as default};
