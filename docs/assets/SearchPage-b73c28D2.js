import{c as P,r as j,j as e,m as K,n as O,t as Z,s as M,o as J,p as X,R as A,B as C,L as H,h as W,i as ee,u as te,M as re,v as ae,w as se}from"./index-DwnuloBv.js";import{C as ne}from"./Chip-BVsegoci.js";import{T as oe,a as le,b as z}from"./Tabs-CXPj4u9c.js";import{S as ie}from"./SearchField-DvgmgaxY.js";import{P as de}from"./PageChrome-CQ7wV0I-.js";import{T as ce}from"./TopBar-Cwkp26YK.js";import{Y as ue}from"./index-CMqS6xLq.js";import{F as V}from"./film-aQTmEE-c.js";import{S as me}from"./star-kR1agmaq.js";import{u as xe,U as fe,a as pe}from"./useToggleFollow-Jo2pwVod.js";import{U as ge}from"./users-DG0f3SAW.js";import{U as he}from"./user-RbUQQS8N.js";import"./index-DNaqzluz.js";import"./useMutation-DKHT9dyE.js";const be=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],B=P("funnel",be);const ye=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],ve=P("languages",ye);const we=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],q=P("sliders-horizontal",we);const je=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],D=P("x",je),L=j.forwardRef(({className:a,type:r,...c},s)=>e.jsx("input",{type:r,className:K("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s,...c}));L.displayName="Input";const Ne=(a,r)=>{const[c,s]=j.useState(a);return j.useEffect(()=>{const i=window.setTimeout(()=>{s(a)},r);return()=>{window.clearTimeout(i)}},[a,r]),c},_e=["all","movie","series","anime"],Q=a=>a.get("tab")==="people"?"people":"titles",R=a=>{if(typeof a!="number")return;const r=new Date().getFullYear();return Math.min(Math.max(a,1900),r)},ke=a=>{const r=a.get("type"),c=_e.includes(r)?r:"all",s=u=>{if(!u)return;const y=Number(u);return Number.isFinite(y)?y:void 0},i=R(s(a.get("minYear"))),x=R(s(a.get("maxYear"))),d=a.get("lang")||void 0;return i&&x&&i>x?{type:c,minYear:x,maxYear:i,originalLanguage:d}:{type:c,minYear:i,maxYear:x,originalLanguage:d}},$=a=>{if(a?.aborted)throw a.reason??new DOMException("Aborted","AbortError")};async function Se(a,r){const c=a.map(async s=>{if(s.imdbId||!s.tmdbId)return s;$(r);try{const i=await O(`/${s.type==="tv"?"tv":"movie"}/${s.tmdbId}/external_ids`,{},r);return $(r),{...s,imdbId:i?.imdb_id??null}}catch(i){return console.warn("[externalMovieSearch] Failed to fetch external ids for",s.tmdbId,i),s}});return Promise.all(c)}async function Ce(a,r=1,c){const s=a.trim();if(!s)return{results:[],hasMore:!1};$(c);const i=await O("/search/multi",{query:s,include_adult:!1,page:r},c);$(c);const x=Array.isArray(i?.results)?i.results:[];if(!x.length)return{results:[],hasMore:!1};const d=typeof i?.total_pages=="number"?i.total_pages:1,u=x.filter(f=>!!(f&&typeof f.id=="number"&&(f.media_type==="movie"||f.media_type==="tv"))).slice(0,20).map(f=>{const g=f.media_type==="tv"?"tv":"movie",h=f.release_date??f.first_air_date??null,w=h?Number(String(h).slice(0,4)):null;return{tmdbId:Number(f.id),imdbId:f.imdb_id??null,title:f.title??f.name??"Untitled",year:Number.isNaN(w)?null:w,type:g,posterUrl:Z(f.poster_path??null)}});return{results:await Se(u,c),hasMore:r<d}}const T=a=>{if(a?.aborted)throw a.reason??new DOMException("Aborted","AbortError")},Ie=a=>{const r=J(a);return{id:r.id,title:r.title,year:r.year,type:r.type,source:"library",posterUrl:r.posterUrl??r.backdropUrl,originalLanguage:r.originalLanguage,ageRating:r.ageRating,imdbRating:r.imdbRating,rtTomatoMeter:r.rtTomatoMeter,imdbId:r.imdbId,tmdbId:r.tmdbId}},E=20,Me=5,Fe=async(a,r,c,s)=>{T(s);const i=`
    id,
    kind,
    tmdb_id,
    tmdb_title,
    tmdb_name,
    tmdb_original_title,
    tmdb_original_name,
    tmdb_release_date,
    tmdb_first_air_date,
    tmdb_poster_path,
    tmdb_backdrop_path,
    tmdb_original_language,
    tmdb_genre_ids,
    omdb_title,
    omdb_year,
    omdb_language,
    omdb_imdb_id,
    omdb_imdb_rating,
    omdb_rating_rotten_tomatoes,
    omdb_poster,
    omdb_rated
  `,x=(c-1)*E;let d=M.from("media_items").select(i,{count:"exact"});if(d=d.range(x,x+E-1),s&&(d=d.abortSignal(s)),a){const p=`%${a}%`;d=d.or(`tmdb_title.ilike.${p},tmdb_name.ilike.${p},omdb_title.ilike.${p}`)}if(r?.type&&r.type!=="all"&&(d=d.eq("kind",r.type==="series"?"series":r.type)),r?.genreIds?.length&&(d=d.overlaps("tmdb_genre_ids",r.genreIds)),typeof r?.minYear=="number"){const p=`${r.minYear}-01-01`;d=d.or(`tmdb_release_date.gte.${p},tmdb_first_air_date.gte.${p}`)}if(typeof r?.maxYear=="number"){const p=`${r.maxYear}-12-31`;d=d.or(`tmdb_release_date.lte.${p},tmdb_first_air_date.lte.${p}`)}r?.originalLanguage&&(d=d.eq("tmdb_original_language",r.originalLanguage)),d=d.order("tmdb_release_date",{ascending:!1,nullsLast:!0}).order("tmdb_first_air_date",{ascending:!1,nullsLast:!0}).order("tmdb_title",{ascending:!0,nullsLast:!1});const{data:u,error:y,count:f}=await d;if(y)throw new Error(y.message);T(s);const g=u??[],h=typeof f=="number"?f:void 0,w=h?x+g.length<h:g.length===E;return{results:g.map(Ie),hasMore:w}},Te=async a=>{const{query:r,filters:c,page:s=1,signal:i}=a,x=r.trim();T(i);let d=[],u=!1;try{const{results:t,hasMore:l}=await Fe(x,c,s,i);d=t,u=l}catch(t){console.warn("[search.service] Supabase search failed, falling back to TMDb",t)}const{results:y,hasMore:f}=await Ce(x,s,i);if(T(i),!y.length&&d.length>0)return{results:d,hasMore:u};const g=new Set,h=new Set;for(const t of d)t.tmdbId&&g.add(t.tmdbId),t.imdbId&&h.add(t.imdbId);const w=y.filter(t=>!(t.tmdbId&&g.has(t.tmdbId)||t.imdbId&&h.has(t.imdbId))),p=new Map;if(w.length)try{const{data:t,error:l}=await M.from("media_items").upsert(w.slice(0,Me).map(m=>({tmdb_id:m.tmdbId,omdb_imdb_id:m.imdbId??null,kind:m.type==="tv"?"series":"movie",tmdb_title:m.title,tmdb_release_date:m.year?`${m.year}-01-01`:null})),{onConflict:"tmdb_id"}).select("id, tmdb_id");l&&console.warn("[search.service] Failed to upsert media_items",l.message),(t??[]).forEach(m=>{m.tmdb_id!=null&&m.id&&p.set(Number(m.tmdb_id),m.id)})}catch(t){console.warn("[search.service] media_items upsert failed",t)}const S=await Promise.all(w.map(async t=>{T(i);const l=t.type==="tv"?"series":"movie",m=t.tmdbId&&p.get(t.tmdbId)?p.get(t.tmdbId):`tmdb-${t.tmdbId??Math.random()}`,b=!m.startsWith("tmdb-");return t.tmdbId&&g.add(t.tmdbId),t.imdbId&&h.add(t.imdbId),{id:m,title:t.title,year:t.year??null,type:l,source:b?"external-synced":"external-only",posterUrl:t.posterUrl,originalLanguage:null,ageRating:null,imdbRating:null,rtTomatoMeter:null,imdbId:t.imdbId??null,tmdbId:t.tmdbId}}));return{results:[...d,...S.filter(t=>!!t)],hasMore:u||f}},Ye=a=>{const{query:r,filters:c}=a,s=r.trim();return X({queryKey:["search","titles",{query:s,filters:c}],enabled:s.length>0,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:(i,x)=>i.hasMore?x.length+1:void 0,queryFn:({signal:i,pageParam:x})=>Te({query:s,filters:c,page:x??1,signal:i})})},Le=({item:a})=>{const r=[];a.year&&r.push(String(a.year)),a.type==="movie"&&r.push("Movie"),a.type==="series"&&r.push("Series"),a.type==="anime"&&r.push("Anime"),a.originalLanguage&&r.push(`Language: ${a.originalLanguage}`),a.ageRating&&r.push(a.ageRating),a.imdbRating&&r.push(`IMDb ${a.imdbRating.toFixed(1)}`),a.rtTomatoMeter&&r.push(`RT ${a.rtTomatoMeter}%`);const c={library:"Library","external-synced":"Synced","external-only":"External"},s={library:"bg-primary/10 text-primary border-primary/40","external-synced":"bg-emerald-500/10 text-emerald-400 border-emerald-500/30","external-only":"bg-card text-muted-foreground border-border"};return e.jsx("div",{children:e.jsxs(H,{to:`/title/${a.id}`,className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2 hover:bg-card/80",children:[a.posterUrl?e.jsx("img",{src:a.posterUrl,alt:a.title,className:"h-20 w-14 rounded-2xl object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-20 w-14 items-center justify-center rounded-2xl bg-muted",children:e.jsx(V,{className:"h-5 w-5 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-[12px] font-medium text-foreground",children:a.title}),e.jsx("span",{className:`shrink-0 rounded-full border px-2 py-0.5 text-xs font-medium ${s[a.source]}`,children:c[a.source]})]}),r.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:r.join(" • ")})]})]})})},Re=({query:a,filters:r,onResetFilters:c})=>{const s=a.trim(),{data:i,isLoading:x,isError:d,error:u,fetchNextPage:y,hasNextPage:f,isFetchingNextPage:g}=Ye({query:s,filters:r}),h=i?.pages.flatMap(t=>t.results)??[],w=h.length,p=[];if(r.type&&r.type!=="all"){const t={movie:"Movies",series:"Series",anime:"Anime",all:"All"};p.push(t[r.type])}typeof r.minYear=="number"&&p.push(`From ${r.minYear}`),typeof r.maxYear=="number"&&p.push(`Up to ${r.maxYear}`),r.originalLanguage&&p.push(`Language: ${r.originalLanguage==="en"?"English":r.originalLanguage}`);const S=p.length?p.join(" • "):"No filters applied",o=A.useRef(new Set);return A.useEffect(()=>{if(!h||!Array.isArray(h))return;const t=o.current,l=h.filter(b=>!(t.has(b.id)||!b.imdbId&&!b.tmdbId||b.imdbRating||b.rtTomatoMeter)).slice(0,3);(async()=>{for(const b of l){t.add(b.id);try{const{error:N}=await M.from("media_items").upsert({tmdb_id:b.tmdbId??null,omdb_imdb_id:b.imdbId??null,kind:b.type==="series"?"series":b.type??"movie",tmdb_title:b.title,tmdb_release_date:b.year?`${b.year}-01-01`:null},{onConflict:"tmdb_id"}).select("id");N&&console.warn("[SearchTitlesTab] media_items upsert failed for",b.id,N.message)}catch(N){console.warn("[SearchTitlesTab] media_items upsert threw for",b.id,N)}}})()},[h]),s?x?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["Searching for ",e.jsx("span",{className:"font-semibold text-foreground",children:s}),"…"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fetching matching titles from your catalog and external sources."}),e.jsx("div",{className:"space-y-2",children:[0,1,2].map(t=>e.jsxs("div",{className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2",children:[e.jsx("div",{className:"h-16 w-11 animate-pulse rounded-xl bg-card/60"}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center space-y-1.5",children:[e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-card/60"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-card/40"})]})]},t))})]}):d?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-destructive",children:"Something went wrong while searching for titles."}),u&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Details: "}),u.message]})]}):w?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-semibold text-foreground",children:w})," result",w===1?"":"s"," across your catalog and external sources for"," ",e.jsx("span",{className:"font-semibold text-foreground",children:s}),"."]}),e.jsxs(C,{type:"button",variant:"outline",size:"sm",className:"h-auto rounded-full border-border px-2 py-1 text-muted-foreground hover:border-border hover:text-foreground",onClick:c,children:[e.jsx(q,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Reset filters"})]})]}),e.jsx("div",{className:"rounded-2xl border border-border bg-background/60 p-3",children:e.jsxs("p",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground",children:e.jsx(q,{className:"h-3 w-3","aria-hidden":"true"})}),e.jsx("span",{className:"truncate",children:S})]})}),e.jsx(ue,{style:{height:"70vh"},data:h,endReached:()=>{f&&!g&&y()},components:{List:A.forwardRef(function(l,m){return e.jsx("div",{ref:m,className:"space-y-2",...l})}),Footer:()=>f?e.jsx("div",{className:"flex justify-center py-3",children:e.jsx(C,{type:"button",className:"inline-flex items-center justify-center rounded-full bg-primary/90 disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>y(),disabled:g,children:g?"Loading more…":"Load more results"})}):null},itemContent:(t,l)=>e.jsx(Le,{item:l})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No titles found matching"," ",e.jsx("span",{className:"font-semibold text-foreground",children:s}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search or removing some filters to see more results."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a title, director, or genre to search the catalog. As you wire Supabase search, results will appear here."}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-xs font-medium text-foreground",children:"Try searching for"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-xs",children:["Sci-fi romance","Feel-good comedies","Films from 2020s","Cozy rainy-day movies"].map(t=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-border px-2 py-1 text-muted-foreground",children:[e.jsx(V,{className:"mr-1 h-3 w-3 text-muted-foreground","aria-hidden":"true"}),t]},t))})]}),e.jsxs("div",{className:"space-y-1.5 rounded-2xl border border-border bg-background/60 p-3",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs font-medium text-foreground",children:[e.jsx(me,{className:"h-3.5 w-3.5 text-primary","aria-hidden":"true"}),e.jsx("span",{children:"Trending this week"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Once analytics are wired up, you can show what your friends and the community are watching the most here."})]})]})},Y=a=>{if(a?.aborted)throw a.reason??new DOMException("Aborted","AbortError")},$e=a=>{const c=a.trim().replace(/^@+/,""),s=c.toLowerCase(),{user:i}=W();return ee({queryKey:["search","people",{query:c,userId:i?.id??null}],enabled:c.length>0,staleTime:1e3*60*15,gcTime:1e3*60*30,queryFn:async({signal:x})=>{Y(x);const d=c.replace(/%/g,"\\%").replace(/_/g,"\\_");let u=M.from("profiles").select("id, username, display_name, avatar_url, bio").or(`username.ilike.%${d}%,display_name.ilike.%${d}%`).limit(20);i?.id&&(u=u.neq("id",i.id)),x&&(u=u.abortSignal(x));const y=await u;if(Y(x),y.error)throw new Error(y.error.message);const f=y.data??[],g=f.map(t=>t.id);let h=new Map;if(g.length){let t=M.from("user_stats").select("user_id, followers_count, following_count").in("user_id",g);x&&(t=t.abortSignal(x));const l=await t;Y(x),l.error?console.warn("[useSearchPeople] Failed to load user_stats",l.error.message):h=new Map((l.data??[]).map(m=>[m.user_id,{followersCount:m.followers_count??0,followingCount:m.following_count??0}]))}if(!i?.id)return f.map(t=>{const l=h.get(t.id);return{id:t.id,username:t.username,displayName:t.display_name,avatarUrl:t.avatar_url,bio:t.bio,followersCount:l?.followersCount??null,followingCount:l?.followingCount??null,isFollowing:!1}});let w=M.from("follows").select("followed_id").eq("follower_id",i.id);x&&(w=w.abortSignal(x));const p=await w;Y(x),p.error&&console.warn("[useSearchPeople] Failed to load follows for current user",p.error.message);const S=new Set((p.data??[]).map(t=>t.followed_id));return f.map(t=>{const l=h.get(t.id),m=t.username??"",b=t.display_name??"",N=m.toLowerCase(),F=b.toLowerCase();let I=0;N===s?I+=100:N.startsWith(s)?I+=80:F.startsWith(s)?I+=60:N.includes(s)?I+=40:F.includes(s)&&(I+=30);const n=Math.min(15,Math.floor((l?.followersCount??0)/500));return{id:t.id,username:t.username,displayName:t.display_name,avatarUrl:t.avatar_url,bio:t.bio,followersCount:l?.followersCount??null,followingCount:l?.followingCount??null,isFollowing:S.has(t.id),relevance:I+n}}).sort((t,l)=>{if(l.relevance!==t.relevance)return l.relevance-t.relevance;const m=(t.displayName??t.username??"").toLowerCase(),b=(l.displayName??l.username??"").toLowerCase();return m.localeCompare(b)}).map(({relevance:t,...l})=>l)}})},Pe=({query:a})=>{const r=a.trim(),c=r.replace(/^@+/,""),s=c||r,{data:i,isLoading:x,isError:d,error:u}=$e(c),y=xe(),f=te(),{user:g}=W(),[h,w]=j.useState(null),p=i??[],S=async o=>{if(!g?.id){alert("You need to be signed in to start a conversation.");return}if(g.id===o){alert("You can't start a conversation with yourself.");return}w(o);try{const t=await ae("create-direct-conversation",{targetUserId:o},{timeoutMs:25e3});if(!t?.ok||!t.conversationId){const l=t?.errorCode;let m=t?.error??"Failed to get conversation id. Please try again.";l==="UNAUTHORIZED"?m="You need to be signed in to start a conversation.":l==="BAD_REQUEST_SELF_TARGET"?m="You can't start a conversation with yourself.":l==="SERVER_MISCONFIGURED"&&(m="Messaging is temporarily unavailable due to a server issue. Please try again later.");const b=new Error(m);throw b.code=l,b}f(`/messages/${t.conversationId}`)}catch(t){console.error("[SearchPeopleTab] Failed to start conversation",t);const l=t instanceof Error?t.message:"Something went wrong while starting the conversation. Please try again.";alert(l)}finally{w(null)}};return c?x?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Searching for people…"}),e.jsx("div",{className:"rounded-2xl border border-border bg-card/80 px-3 py-4 text-xs text-muted-foreground",children:"We'll show matching profiles here as soon as the results come back."})]}):d?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-foreground",children:"Something went wrong."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:u?.message??"We couldn&apos;t search for people right now. Please try again."})]}):!p||p.length===0?e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No people found for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",s,"”"]}),". Try a different name or username."]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",p.length," profile",p.length===1?"":"s"," for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",s,"”"]})]})}),e.jsx("ul",{className:"divide-y divide-border/60 rounded-2xl border border-border bg-card/80",children:p.map(o=>{const t=o.displayName??o.username??"Unknown user",l=o.username?`@${o.username}`:null,m=y.isPending&&y.variables?.targetUserId===o.id;return e.jsxs("li",{className:"flex items-center justify-between gap-3 px-3 py-2 hover:bg-card/80",children:[e.jsxs(H,{to:o.username?`/u/${o.username}`:`/u/${o.id}`,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-card/80 text-[14px] font-semibold text-foreground",children:o.avatarUrl?e.jsx("img",{src:o.avatarUrl,alt:t,className:"h-8 w-8 rounded-full object-cover",loading:"lazy"}):t?t[0]?.toUpperCase():e.jsx(he,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",children:t}),l&&e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:l}),o.bio&&e.jsx("p",{className:"mt-0.5 line-clamp-2 text-xs text-muted-foreground",children:o.bio}),(typeof o.followersCount=="number"||typeof o.followingCount=="number")&&e.jsxs("p",{className:"mt-0.5 text-xs text-muted-foreground",children:[typeof o.followersCount=="number"&&e.jsxs("span",{children:[o.followersCount," follower",o.followersCount===1?"":"s"]}),typeof o.followersCount=="number"&&typeof o.followingCount=="number"&&e.jsx("span",{children:" · "}),typeof o.followingCount=="number"&&e.jsxs("span",{children:["following ",o.followingCount]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{type:"button",onClick:()=>y.mutate({targetUserId:o.id,currentlyFollowing:o.isFollowing}),disabled:m,variant:o.isFollowing?"outline":"default",size:"sm",className:`h-auto rounded-full px-2.5 py-1.5 text-xs font-medium ${o.isFollowing?"border-border bg-card/80 text-foreground hover:border-primary/70 hover:text-foreground disabled:opacity-60":"border border-transparent bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-60"}`,children:m?e.jsx("span",{children:"Updating…"}):o.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}),g?.id!==o.id&&e.jsx(C,{type:"button",onClick:()=>S(o.id),disabled:h===o.id,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-card/80 px-2.5 py-1.5 text-xs font-medium text-foreground shadow-md hover:border-primary/70 hover:text-foreground disabled:cursor-not-allowed disabled:opacity-60",children:h===o.id?e.jsx("span",{children:"Starting…"}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Message"})]})})]})]},o.id)})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a name or @username to find people. Once the social graph is wired up, you'll be able to follow friends and start conversations from here."}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-2 text-xs text-muted-foreground",children:[e.jsx(ge,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Search for people you know, then follow or message them."})]})]})},Ze=()=>{const[a,r]=se(),c=j.useMemo(()=>Q(a),[a]),s=a.get("q")??"",[i,x]=j.useState(s),d=Ne(i,300),u=j.useMemo(()=>ke(a),[a]),[y,f]=j.useState(!1),g=j.useCallback(n=>{const v=new URLSearchParams(a);n(v),r(v,{replace:!0})},[a,r]),h=j.useCallback(n=>{n.delete("type"),n.delete("minYear"),n.delete("maxYear"),n.delete("lang")},[]),w=j.useCallback(n=>{const v=n;g(_=>{_.set("tab",v),_.get("q")||h(_)}),v!=="titles"&&f(!1)},[h,g]),p=()=>{x(""),g(n=>{n.delete("q"),h(n)}),f(!1)},S=j.useCallback(n=>{const v=n.trim();g(_=>{const U=Q(_);v?(_.set("q",v),_.set("tab",U)):(_.delete("q"),h(_))}),v||f(!1)},[h,g]);j.useEffect(()=>{S(d)},[d,S]),j.useEffect(()=>{s!==i&&x(s)},[s]);const o=j.useCallback(n=>{g(v=>{const _={...u,...n},U=R(_.minYear),G=R(_.maxYear),k={..._,minYear:U??void 0,maxYear:G??void 0};k.minYear&&k.maxYear&&k.minYear>k.maxYear&&([k.minYear,k.maxYear]=[k.maxYear,k.minYear]),v.set("tab","titles"),v.set("type",k.type??"all"),k.minYear?v.set("minYear",String(k.minYear)):v.delete("minYear"),k.maxYear?v.set("maxYear",String(k.maxYear)):v.delete("maxYear"),k.originalLanguage?v.set("lang",k.originalLanguage):v.delete("lang")})},[u,g]),t=()=>{g(n=>{n.set("tab","titles"),n.set("type","all"),n.delete("minYear"),n.delete("maxYear"),n.delete("lang")}),f(!1)},l=j.useMemo(()=>{const n=[];if(u.type&&u.type!=="all"&&n.push({label:`Type: ${u.type.charAt(0).toUpperCase()}${u.type.slice(1)}`,onRemove:()=>o({type:"all"})}),u.minYear||u.maxYear){const v=u.minYear??"Any",_=u.maxYear??"Now";n.push({label:`Year: ${v} – ${_}`,onRemove:()=>o({minYear:void 0,maxYear:void 0})})}return u.originalLanguage&&n.push({label:`Language: ${u.originalLanguage.toUpperCase()}`,onRemove:()=>o({originalLanguage:void 0})}),n},[u,o]),m=l.length,b=m>0?`Filters (${m} active)`:"Filters (none applied)",N=c==="titles"&&(!!s.trim()||m>0),F=N?b:"Filters are locked until you start typing a title",I=n=>{n.preventDefault()};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-4",children:[e.jsx(ce,{title:"Search without the clutter",subtitle:"Find titles, filmmakers, or friends instantly. Switch tabs to move between movies and people."}),e.jsxs(de,{tone:"default",padded:!0,children:[e.jsxs("form",{onSubmit:I,className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2",children:[e.jsx(ie,{placeholder:"Search for movies, shows, or people...",value:i,onChange:n=>x(n.target.value),autoCorrect:"off",autoCapitalize:"none",className:"flex-1"}),i?e.jsx(C,{type:"button",onClick:p,variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full text-xs text-muted-foreground hover:bg-border/60 hover:text-foreground","aria-label":"Clear search",children:e.jsx(D,{className:"h-3 w-3","aria-hidden":"true"})}):null]}),e.jsxs(C,{type:"button",onClick:()=>{N&&f(n=>!n)},variant:"outline",size:"sm",className:`inline-flex items-center justify-center gap-1 rounded-full px-3 py-2 text-xs font-medium shadow-md ${N?"border-border bg-background text-muted-foreground hover:border-primary/70 hover:text-foreground":"cursor-not-allowed border-border bg-background/70 text-muted-foreground"} ${y?"border-primary/70 text-foreground":""}`,disabled:!N,"aria-pressed":N&&y,"aria-expanded":N&&y,"aria-controls":"search-title-filters","aria-label":F,title:F,children:[e.jsx(q,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:y?"Hide filters":"Filters"}),m>0?e.jsx("span",{className:"inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-primary/15 px-1 text-xs font-semibold text-primary",children:m}):null]})]}),c==="titles"&&e.jsx("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:l.length?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"gap-1 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-muted-foreground",children:"Active filters"}),l.map(n=>e.jsxs(C,{type:"button",onClick:n.onRemove,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-background px-2 py-1 text-xs text-foreground shadow-sm hover:border-primary/70 hover:text-foreground",children:[e.jsx("span",{children:n.label}),e.jsx(D,{className:"h-3 w-3 text-muted-foreground","aria-hidden":!0})]},n.label)),e.jsx(C,{type:"button",onClick:t,variant:"ghost",size:"sm",className:"h-auto rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-primary hover:bg-primary/15",children:"Reset all"})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-card/50 px-2.5 py-1 text-xs font-medium text-muted-foreground",children:[e.jsx(B,{className:"h-3 w-3","aria-hidden":!0}),"No filters applied"]})}),c==="titles"&&y&&e.jsxs("div",{id:"search-title-filters",className:"mt-3 space-y-3 rounded-xl border border-dashed border-border bg-background/70 p-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-foreground",children:[e.jsx(B,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Filter titles"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-[1.4fr_1fr_1fr]",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{key:"all",label:"All"},{key:"movie",label:"Movies"},{key:"series",label:"Series"},{key:"anime",label:"Anime"}].map(n=>{const v=u.type===n.key;return e.jsx(C,{type:"button",variant:v?"default":"outline",size:"sm",className:`h-auto rounded-full px-2.5 py-1 text-xs font-medium ${v?"bg-primary text-primary-foreground shadow-md":"border-border bg-background/80 text-muted-foreground hover:border-primary/60 hover:text-foreground"}`,onClick:()=>o({type:n.key}),"aria-pressed":v,children:n.label},n.key)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Years"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsx(L,{type:"number",min:1900,max:new Date().getFullYear(),value:u.minYear??"",onChange:n=>o({minYear:n.target.value?Number(n.target.value):void 0}),placeholder:"Min",className:"h-9 w-full border-border bg-background px-2 py-1.5 text-xs text-foreground shadow-sm","aria-label":"Minimum year"}),e.jsx(L,{type:"number",min:1900,max:new Date().getFullYear(),value:u.maxYear??"",onChange:n=>o({maxYear:n.target.value?Number(n.target.value):void 0}),placeholder:"Max",className:"h-9 w-full border-border bg-background px-2 py-1.5 text-xs text-foreground shadow-sm","aria-label":"Maximum year"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use a minimum, maximum, or both."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Original language"}),e.jsxs("div",{className:"flex items-center gap-1.5 rounded-md border border-border bg-background px-2 py-1.5 shadow-sm",children:[e.jsx(ve,{className:"h-3.5 w-3.5 text-muted-foreground","aria-hidden":"true"}),e.jsx(L,{type:"text",value:u.originalLanguage??"",onChange:n=>o({originalLanguage:n.target.value||void 0}),placeholder:"e.g. en, ja",className:"h-8 w-full border-none bg-transparent p-0 text-xs text-foreground shadow-none placeholder:text-muted-foreground focus-visible:ring-0"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Two-letter codes keep things simple."})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-1.5 w-1.5 rounded-full bg-primary/80"}),"Filters shape the recommendations shown below."]}),e.jsx(C,{type:"button",variant:"link",size:"sm",className:"h-auto p-0 text-xs font-semibold text-foreground hover:text-primary",onClick:t,children:"Reset filters"})]})]})]}),e.jsxs("section",{className:"flex flex-1 flex-col gap-3",children:[e.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:e.jsx("div",{className:"w-full sm:max-w-lg",children:e.jsx(oe,{value:c,onValueChange:w,children:e.jsxs(le,{className:"w-full",children:[e.jsx(z,{value:"titles",children:"Titles"}),e.jsx(z,{value:"people",children:"People"})]})})})}),e.jsx("div",{"aria-live":"polite",className:"flex-1 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-3 text-[12px] text-muted-foreground",children:c==="titles"?e.jsx(Re,{query:d,filters:u,onResetFilters:t}):e.jsx(Pe,{query:d})})]})]})};export{Ze as default};
