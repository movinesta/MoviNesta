import{c as a,k as y,b as f,s as u}from"./index-C0YC7Lqk.js";import{u as w}from"./useMutation-B6WiSsoN.js";const d=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],x=a("user-minus",d);const h=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],_=a("user-plus",h),p=e=>typeof e=="object"&&e!==null&&"code"in e,q=()=>{const{user:e}=y(),i=f();return w({mutationFn:async({targetUserId:r,currentlyFollowing:n})=>{if(!e)throw new Error("You need to be signed in to follow people.");if(e.id===r)throw new Error("You canâ€™t follow yourself.");if(n){const{error:t}=await u.from("follows").delete().eq("follower_id",e.id).eq("followed_id",r);if(t)throw t;return{isFollowing:!1}}const{error:o}=await u.from("follows").insert({follower_id:e.id,followed_id:r,created_at:new Date().toISOString()});if(o&&(!p(o)||o.code!=="23505"))throw o;return{isFollowing:!0}},onSuccess:(r,n)=>{const{targetUserId:o}=n,{isFollowing:t}=r;i.setQueriesData({queryKey:["search","people"]},l=>l&&l.map(s=>{if(s.id!==o)return s;const c=Math.max(0,(s.followersCount??0)+(t?1:-1));return{...s,isFollowing:t,followersCount:c}})),i.invalidateQueries({queryKey:["profile"]})}})};export{x as U,_ as a,q as u};
