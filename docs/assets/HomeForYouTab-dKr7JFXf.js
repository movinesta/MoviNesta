import{c as H,j as e,g as q,h as V,S as C,L as U,s as p}from"./index-DLcJPtaT.js";import{C as D,L as z}from"./list-checks-B6YfRy6Y.js";import{F as N}from"./film-B1-3ac0G.js";import{U as I}from"./users-DO_B5-1n.js";import{C as A}from"./chevron-right-j_QgJnq5.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=H("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),Q=t=>{const a=((t==null?void 0:t.message)??"").toLowerCase();return a.includes("network")||a.includes("failed to fetch")||a.includes("fetch")?"We couldn’t reach the server to load your recommendations. Check your connection and try again.":a.includes("unauthorized")||a.includes("401")||a.includes("403")?"We couldn’t load your recommendations because your session may have expired. Try signing out and back in.":"Something went wrong while loading your recommendations. Please try again."},y=(t,n)=>t??n??null,G=async t=>{const[n,a,c]=await Promise.all([p.from("follows").select("followed_id").eq("follower_id",t),p.from("ratings").select("title_id, rating, created_at").eq("user_id",t).order("created_at",{ascending:!1}).limit(40),p.from("library_entries").select("title_id, status, updated_at").eq("user_id",t).order("updated_at",{ascending:!1}).limit(40)]);let r=!1;if(a.error)throw new Error(a.error.message);if(c.error)throw new Error(c.error.message);const m=n.error;m&&(r=!0,console.warn("[HomeForYouTab] Failed to load follows",m.message));const x=a.data??[],_=c.data??[],L=(n.data??[]).map(s=>s.followed_id).filter(s=>!!s)??[],f=x.find(s=>(s.rating??0)>=4)??x[0]??null,o=(f==null?void 0:f.title_id)??null;let j=[];if(L.length>0){const{data:s,error:i}=await p.from("ratings").select("title_id, user_id, created_at").in("user_id",L).order("created_at",{ascending:!1}).limit(30);i&&(r=!0,console.warn("[HomeForYouTab] Failed to load friend ratings",i.message)),j=s??[]}const w=[];j.forEach(s=>{s.title_id&&(w.includes(s.title_id)||w.push(s.title_id))});const g=[];o&&_.forEach(s=>{s.title_id&&s.title_id!==o&&(s.status==="want_to_watch"||s.status==="watching")&&(g.includes(s.title_id)||g.push(s.title_id))});const v=[];_.forEach(s=>{s.title_id&&(s.status==="watching"||s.status==="want_to_watch")&&(v.includes(s.title_id)||v.push(s.title_id))});const T=await p.from("titles").select("id:title_id, title:primary_title, year:release_year, runtime_minutes, type:content_type, poster_url, backdrop_url, imdb_rating, omdb_rt_rating_pct").eq("content_type","anime").order("release_year",{ascending:!1}).limit(16);T.error&&(r=!0,console.warn("[HomeForYouTab] Failed to load anime titles",T.error.message));const S=T.data??[],Y=S.map(s=>s.id),E=Array.from(new Set([...o?[o]:[],...w,...g,...v,...Y]));if(!E.length)return{tonightPick:null,sections:[],hasPartialData:r};const R=await p.from("titles").select("id:title_id, title:primary_title, year:release_year, runtime_minutes, type:content_type, poster_url, backdrop_url, imdb_rating, omdb_rt_rating_pct").in("title_id",E);if(R.error)throw new Error(R.error.message);const $=R.data??[],h=new Map;$.forEach(s=>{h.set(s.id,s)});const u=new Set;let W=null;if(o&&h.has(o)){const s=h.get(o),i=(f==null?void 0:f.rating)??null;W={id:s.id,name:s.title??"Untitled",year:s.year??new Date().getFullYear(),runtimeMinutes:s.runtime_minutes??void 0,matchReason:i&&i>=4?"Because you gave this a high rating.":"Based on your recent diary activity.",moodTag:s.type==="anime"?"Anime night":"Cinematic night",logline:void 0,moodLine:s.type==="anime"?"Animated, emotional, and perfect for a late-night binge.":"Feels like the right vibe for tonight based on your recent watches.",friendsWatchingCount:j.filter(l=>l.title_id===o).length,posterUrl:y(s.poster_url,s.backdrop_url),imdbRating:s.imdb_rating??null,rtTomatoMeter:s.omdb_rt_rating_pct??null},u.add(o)}const b=[],k=[];if(w.slice(0,12).forEach(s=>{const i=h.get(s);if(!i||u.has(s))return;const l=j.filter(d=>d.title_id===s).length;k.push({id:i.id,name:i.title??"Untitled",year:i.year??new Date().getFullYear(),friendsWatchingCount:l,moodTag:i.type==="anime"?"Anime night":"Friends love this",posterUrl:y(i.poster_url,i.backdrop_url),imdbRating:i.imdb_rating??null,rtTomatoMeter:i.omdb_rt_rating_pct??null}),u.add(s)}),k.length>0&&b.push({id:"friends-trending",kind:"friends-trending",title:"Trending with friends",subtitle:"What your circle has been rating and logging recently.",pillLabel:"Social picks",items:k}),o&&h.has(o)&&g.length>0){const s=h.get(o),i=[];g.slice(0,12).forEach(l=>{const d=h.get(l);!d||u.has(l)||(i.push({id:d.id,name:d.title??"Untitled",year:d.year??new Date().getFullYear(),matchReason:`On your watchlist after ${s.title??"that favorite"}.`,posterUrl:y(d.poster_url,d.backdrop_url),imdbRating:d.imdb_rating??null,rtTomatoMeter:d.omdb_rt_rating_pct??null}),u.add(l))}),i.length>0&&b.push({id:"because-you-liked",kind:"because-you-liked",title:`Because you liked ${s.title??"this"}`,subtitle:"Watchlist picks tuned by your recent favorites.",pillLabel:"Taste match",items:i})}const F=[];S.slice(0,12).forEach(s=>{u.has(s.id)||(F.push({id:s.id,name:s.title??"Untitled",year:s.year??new Date().getFullYear(),matchReason:"Anime in your catalog and trending in MoviNesta.",posterUrl:y(s.poster_url,s.backdrop_url),imdbRating:s.imdb_rating??null,rtTomatoMeter:s.omdb_rt_rating_pct??null}),u.add(s.id))}),F.length>0&&b.push({id:"popular-anime",kind:"anime",title:"Popular anime right now",subtitle:"Heart-punching stories, cozy vibes, and a bit of chaos.",pillLabel:"Anime corner",items:F});const M=[];return v.slice(0,12).forEach(s=>{const i=h.get(s);if(!i||u.has(s))return;const l=_.find(B=>B.title_id===s),d=i.imdb_rating??null,O=i.omdb_rt_rating_pct??null;let P;(l==null?void 0:l.status)==="watching"?P="In progress — pick up where you left off.":(l==null?void 0:l.status)==="want_to_watch"&&(P="On your Watchlist and waiting for a good night."),M.push({id:i.id,name:i.title??"Untitled",year:i.year??new Date().getFullYear(),runtimeMinutes:i.runtime_minutes??void 0,matchReason:P,posterUrl:y(i.poster_url,i.backdrop_url),imdbRating:d,rtTomatoMeter:O}),u.add(s)}),M.length>0&&b.push({id:"continue",kind:"continue",title:"Continue swiping / watching",subtitle:"Pick up right where your last movie night left off.",pillLabel:"On deck",items:M}),{tonightPick:W,sections:b,hasPartialData:r}},J=()=>{const{user:t}=q(),{data:n,isLoading:a,isFetching:c,error:r}=V({queryKey:["home-for-you",t==null?void 0:t.id],enabled:!!(t!=null&&t.id),staleTime:1e3*20,refetchOnWindowFocus:!0,refetchOnReconnect:!0,queryFn:async()=>t!=null&&t.id?G(t.id):{tonightPick:null,sections:[],hasPartialData:!1}}),m=r?Q(r):null;return r&&console.error("[HomeForYouTab] Failed to load recommendations",r),{isLoading:a||!n&&c,error:m,tonightPick:(n==null?void 0:n.tonightPick)??null,sections:(n==null?void 0:n.sections)??[],hasPartialData:(n==null?void 0:n.hasPartialData)??!1}},ue=()=>{const{isLoading:t,error:n,tonightPick:a,sections:c,hasPartialData:r}=J(),m=!!a||c.length>0;return e.jsxs("div",{className:"space-y-4",children:[n&&e.jsx("div",{role:"alert",className:"rounded-2xl border border-mn-error/60 bg-mn-error/10 px-3 py-2 text-[11px] text-mn-error",children:n}),t?e.jsx(se,{}):a?e.jsx(X,{pick:a}):e.jsx(ie,{}),t&&e.jsx(ne,{}),!t&&c.length>0&&e.jsx("div",{className:"space-y-3",children:c.map(x=>e.jsx(Z,{section:x},x.id))}),!t&&r&&!n&&e.jsx("p",{className:"rounded-2xl border border-mn-border-soft bg-mn-surface-soft px-3 py-2 text-[11px] text-mn-text-secondary",children:"Some rows might be missing while we catch up on your follows and anime data, but your main recommendations are still here."}),!t&&!m&&e.jsx(ae,{})]})},X=({pick:t})=>{const n=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)&&t.imdbRating>0,a=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)&&t.rtTomatoMeter>0;return e.jsxs("section",{className:"rounded-mn-card border border-mn-border-subtle bg-mn-bg-elevated/95 p-4 text-[11px] text-mn-text-secondary shadow-mn-card",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full bg-mn-primary/15 px-2.5 py-0.5 text-[10px] font-medium text-mn-primary",children:[e.jsx(C,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Tonight's pick for you"})]}),t.runtimeMinutes?e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg/80 px-2 py-0.5 text-[10px] text-mn-text-muted",children:[e.jsx(D,{className:"h-3 w-3","aria-hidden":"true"}),e.jsxs("span",{children:[t.runtimeMinutes," min"]})]}):null]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(U,{to:`/title/${t.id}`,className:"relative flex h-28 w-20 shrink-0 overflow-hidden rounded-mn-card bg-mn-bg/80 shadow-mn-card focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-primary focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg",children:[t.posterUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.posterUrl,alt:t.name,className:"h-full w-full object-cover"}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-t from-black/65 via-black/20 to-transparent"})]}):e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-1 bg-gradient-to-br from-mn-surface-elevated/80 via-mn-bg to-mn-primary/70 text-[10px] text-mn-text-muted",children:[e.jsx(N,{className:"h-4 w-4 text-mn-primary","aria-hidden":"true"}),e.jsx("span",{children:"No poster yet"})]}),e.jsxs("div",{className:"pointer-events-none absolute bottom-1 left-1 right-1 space-y-0.5 px-1.5",children:[e.jsx("span",{className:"inline-flex items-center rounded-full bg-mn-bg/80 px-2 py-0.5 text-[9px] font-semibold uppercase tracking-[0.18em] text-mn-primary-soft",children:t.year}),e.jsx("span",{className:"block text-[11px] font-heading font-semibold text-mn-bg line-clamp-3 drop-shadow",children:t.name})]})]}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-1",children:[e.jsxs("h2",{className:"text-[13px] font-heading font-semibold text-mn-text-primary",children:["Movie night mood: ",t.moodTag??"Surprise me"]}),t.logline&&e.jsx("p",{className:"text-[11px] text-mn-text-secondary line-clamp-3",children:t.logline}),t.moodLine&&e.jsx("p",{className:"text-[10px] text-mn-text-muted",children:t.moodLine}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1.5 rounded-full bg-mn-primary px-3 py-1.5 text-[11px] font-medium text-mn-bg shadow-mn-soft hover:bg-mn-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-primary focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg",children:[e.jsx(K,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Add to Watchlist"})]}),e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1.5 rounded-full border border-mn-border-subtle bg-mn-bg/80 px-3 py-1.5 text-[11px] text-mn-text-secondary hover:border-mn-primary/70 hover:text-mn-text-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-primary focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg",children:[e.jsx(z,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Why this pick?"})]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-[10px] text-mn-text-muted",children:[t.friendsWatchingCount?e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(I,{className:"h-3 w-3","aria-hidden":"true"}),e.jsxs("span",{children:["Watched by ",t.friendsWatchingCount," friend(s)"]})]}):null,n&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-mn-text-secondary",children:"IMDb Rating"}),e.jsx("span",{children:t.imdbRating.toFixed(1)})]}),a&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-mn-text-secondary",children:"Tomatometer"}),e.jsxs("span",{children:[t.rtTomatoMeter,"%"]})]}),t.matchReason&&e.jsxs("span",{className:"line-clamp-1",children:[e.jsx("span",{className:"font-medium text-mn-text-secondary",children:"Because: "}),t.matchReason]})]})]})]})]})},Z=({section:t})=>t.items.length?e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h3",{className:"text-[12px] font-heading font-semibold text-mn-text-primary",children:t.title}),t.pillLabel&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-mn-bg-elevated/80 px-2 py-0.5 text-[9px] text-mn-text-muted",children:t.pillLabel})]}),t.subtitle&&e.jsx("p",{className:"mt-0.5 text-[10px] text-mn-text-secondary line-clamp-2",children:t.subtitle})]}),e.jsxs("button",{type:"button","aria-label":`See all for ${t.title}`,className:"inline-flex items-center gap-1 rounded-full border border-mn-border-subtle/80 bg-mn-bg/80 px-2.5 py-1 text-[10px] text-mn-text-secondary hover:border-mn-primary/70 hover:text-mn-text-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-primary focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg",children:[e.jsx("span",{children:"See all"}),e.jsx(A,{className:"h-3 w-3","aria-hidden":"true"})]})]}),e.jsx("div",{className:"-mx-1 overflow-x-auto pb-1",children:e.jsx("div",{className:"flex snap-x snap-mandatory gap-2 px-1",children:t.items.map(n=>e.jsx(te,{item:n,sectionKind:t.kind},n.id))})})]}):null,ee={"friends-trending":{icon:I,label:"Friends"},"because-you-liked":{icon:N,label:"Match"},anime:{icon:C,label:"Anime"},continue:{icon:D,label:"Continue"}},te=({item:t,sectionKind:n})=>{const a=[];t.friendsWatchingCount&&a.push(`Watched by ${t.friendsWatchingCount} friend(s)`),t.runtimeMinutes&&a.push(`${t.runtimeMinutes} min`);const c=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)&&t.imdbRating>0,r=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)&&t.rtTomatoMeter>0;c&&a.push(`IMDb Rating ${t.imdbRating.toFixed(1)}`),r&&a.push(`Tomatometer ${t.rtTomatoMeter}%`);const m=ee[n],x=m.icon;return e.jsxs(U,{to:`/title/${t.id}`,className:"group flex w-[160px] shrink-0 snap-start flex-col overflow-hidden rounded-2xl border border-mn-border-subtle/80 bg-mn-bg-elevated/90 text-[11px] text-mn-text-secondary shadow-mn-soft no-underline outline-none ring-offset-2 ring-offset-mn-bg focus-visible:ring-2 focus-visible:ring-mn-primary",children:[e.jsxs("div",{className:"relative h-32 overflow-hidden",children:[t.posterUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.posterUrl,alt:t.name,className:"h-full w-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-mn-accent-violet/45 via-mn-bg/40 to-mn-primary/75"})]}):e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-1 bg-gradient-to-br from-mn-surface-elevated/80 via-mn-bg to-mn-primary/70 text-[10px] text-mn-text-muted",children:[e.jsx(N,{className:"h-4 w-4 text-mn-primary","aria-hidden":"true"}),e.jsx("span",{children:"Poster missing"})]}),e.jsx("div",{className:"relative flex h-full flex-col justify-between p-2.5",children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"line-clamp-2 text-[11px] font-heading font-semibold text-mn-text-primary",children:t.name}),t.matchReason&&e.jsx("p",{className:"line-clamp-2 text-[9px] text-mn-text-secondary",children:t.matchReason})]})})]}),e.jsxs("div",{className:"flex flex-1 flex-col justify-between gap-1 px-2.5 py-2",children:[a.length>0&&e.jsx("p",{className:"line-clamp-1 text-[9px] text-mn-text-muted",children:a.join(" • ")}),e.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2 text-[10px]",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-mn-text-muted",children:[e.jsx(x,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:m.label})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-mn-primary group-hover:underline",children:[e.jsx("span",{className:"text-[10px] font-medium",children:"Open"}),e.jsx(A,{className:"h-2.5 w-2.5","aria-hidden":"true"})]})]})]})]})},se=()=>e.jsxs("section",{className:"animate-pulse rounded-mn-card border border-mn-border-subtle/80 bg-mn-bg-elevated/90 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"h-4 w-32 rounded-full bg-mn-border-subtle/60"}),e.jsx("div",{className:"h-4 w-16 rounded-full bg-mn-border-subtle/40"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"h-28 w-20 rounded-2xl bg-mn-border-subtle/60"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-2/3 rounded-full bg-mn-border-subtle/60"}),e.jsx("div",{className:"h-3 w-full rounded-full bg-mn-border-subtle/40"}),e.jsx("div",{className:"h-3 w-5/6 rounded-full bg-mn-border-subtle/40"}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx("div",{className:"h-7 w-28 rounded-full bg-mn-border-subtle/50"}),e.jsx("div",{className:"h-7 w-28 rounded-full bg-mn-border-subtle/40"})]})]})]})]}),ne=()=>e.jsx("div",{className:"space-y-3",children:[0,1].map(t=>e.jsxs("section",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-40 rounded-full bg-mn-border-subtle/60"}),e.jsx("div",{className:"-mx-1 overflow-x-hidden pb-1",children:e.jsx("div",{className:"flex gap-2 px-1",children:[0,1,2].map(n=>e.jsx("div",{className:"h-40 w-[160px] shrink-0 rounded-2xl border border-mn-border-subtle/60 bg-mn-bg-elevated/80"},n))})})]},t))}),ie=()=>e.jsx("section",{className:"rounded-mn-card border border-mn-border-subtle/80 bg-mn-bg-elevated/95 px-4 py-5 text-[11px] text-mn-text-secondary shadow-mn-card",children:e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center text-center",children:[e.jsx("div",{className:"mb-3 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-mn-primary/15",children:e.jsx(C,{className:"h-4 w-4 text-mn-primary","aria-hidden":"true"})}),e.jsx("h2",{className:"text-sm font-heading font-semibold text-mn-text-primary",children:"Smart picks arrive as you watch"}),e.jsx("p",{className:"mt-1 text-[11px] text-mn-text-secondary",children:"Once you've logged a few titles and swiped through recommendations, MoviNesta will start surfacing a single “tonight's pick” tuned to your taste."}),e.jsxs("p",{className:"mt-2 text-[10px] text-mn-text-muted",children:["For now, head to ",e.jsx("span",{className:"font-medium text-mn-text-primary",children:"Swipe"})," or"," ",e.jsx("span",{className:"font-medium text-mn-text-primary",children:"Diary"})," to teach the nest what you love."]})]})}),ae=()=>e.jsx("section",{className:"rounded-mn-card border border-mn-border-subtle/80 bg-mn-bg-elevated/95 px-4 py-4 text-[11px] text-mn-text-secondary shadow-mn-card",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"inline-flex h-8 w-8 items-center justify-center rounded-2xl bg-mn-primary/15",children:e.jsx(N,{className:"h-4 w-4 text-mn-primary","aria-hidden":"true"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-sm font-heading font-semibold text-mn-text-primary",children:"No personalized rows yet"}),e.jsx("p",{className:"text-[11px] text-mn-text-secondary",children:"As you rate, review, and follow friends, this tab will fill with eerily good recommendations."})]})]})});export{ne as CarouselsSkeleton,se as TonightPickSkeleton,ue as default};
