import{c as R,j as e,r,S as D,F as W,b as ae}from"./index-DLcJPtaT.js";import{T as le}from"./TopBar-fWfwmUrG.js";import{C as oe}from"./circle-alert-D3BN2XF-.js";import{I as ce}from"./info-lkFNDLce.js";import{C as de}from"./circle-check-72lKqrQ8.js";import{T as me}from"./thumbs-up-i-F1NwAS.js";import"./PageChrome-DNNm9VG4.js";import"./brand-DTIDtbc4.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=R("ImageOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=R("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=R("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=R("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]),pe=({message:t,onRetry:a,isRetrying:i})=>t?e.jsx("div",{className:"mx-3 mb-3 rounded-md border border-amber-500/60 bg-amber-500/10 px-3 py-2 text-xs text-amber-50",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(oe,{className:"mt-0.5 h-3.5 w-3.5 flex-shrink-0","aria-hidden":!0}),e.jsxs("div",{className:"flex flex-1 flex-col gap-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"leading-snug",children:t}),e.jsxs("button",{type:"button",onClick:a,className:"inline-flex items-center gap-1 rounded-full border border-amber-400/80 px-2 py-0.5 text-[11px] font-medium text-amber-50 transition hover:bg-amber-500/30 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-400 focus-visible:ring-offset-1 focus-visible:ring-offset-mn-bg disabled:opacity-60",disabled:i,children:[e.jsx(fe,{className:"h-3.5 w-3.5","aria-hidden":!0}),i?"Retrying…":"Retry"]})]})]})}):null,F="mn_swipe_onboarding_seen",ge=88,he=.32,H=220,we=16,ye=360,Y=14,P=(t,a,i)=>Math.min(i,Math.max(a,t)),ve=t=>{if(!t||t<=0)return null;const a=Math.floor(t/60),i=t%60;return a===0?`${i}m`:i===0?`${a}h`:`${a}h ${i}m`},je=t=>{switch(t){case"from-friends":return"From friends";case"trending":return"Trending now";default:return"For you"}},A=t=>{if(!t)return;const a=[];t.year&&a.push(String(t.year));const i=[];typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)&&i.push(`IMDb ${t.imdbRating.toFixed(1)}`),typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)&&i.push(`${t.rtTomatoMeter}% Rotten Tomatoes`);const b=[...a,...i].filter(Boolean).join(" · ");return b?`${t.title} (${b})`:t.title},Ne=({card:t})=>{const a=ve(t.runtimeMinutes),i=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)&&t.imdbRating>0,b=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)&&t.rtTomatoMeter>0,u=[];return t.year&&u.push(String(t.year)),t.type&&u.push(t.type),a&&u.push(a),i&&u.push(`IMDb ${t.imdbRating.toFixed(1)}`),b&&u.push(`${t.rtTomatoMeter}% RT`),e.jsxs("div",{className:"space-y-3 text-left text-[12px] leading-relaxed",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 space-y-1",children:[e.jsx("h2",{className:"truncate text-2xl font-heading font-semibold text-mn-text-primary",children:t.title}),e.jsx("p",{className:"text-[12px] text-mn-text-secondary",children:u.join(" · ")})]}),e.jsx("span",{className:"mt-1 text-[10px]"})]}),t.tagline&&e.jsx("p",{className:"line-clamp-3 text-[12px] text-mn-text-secondary",children:t.tagline})]})},B=({title:t})=>e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-mn-bg via-mn-bg-elevated to-mn-bg text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-mn-text-secondary",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-mn-surface-elevated/70 shadow-mn-soft",children:e.jsx(ue,{className:"h-6 w-6 text-mn-text-secondary"})}),e.jsx("span",{className:"text-[12px] font-semibold",children:"Artwork unavailable"}),t&&e.jsxs("span",{className:"max-w-[240px] truncate text-[11px] text-mn-text-secondary/80",children:["for ",t]})]})}),ke=()=>{const[t,a]=r.useState(0),i=r.useRef(1);r.useEffect(()=>{const u=window.setInterval(()=>{i.current=i.current===1?-1:1;const k=i.current*14;a(k)},850);return()=>window.clearInterval(u)},[]);const b=t/5;return e.jsxs("article",{className:"relative z-10 mx-auto flex h-[72%] max-h-[480px] w-full max-w-md select-none flex-col overflow-hidden rounded-[30px] border border-mn-border-subtle/70 bg-gradient-to-br from-mn-bg-elevated/95 via-mn-bg/95 to-mn-bg-elevated/90 shadow-mn-card backdrop-blur",style:{transform:`translateX(${t}px) rotate(${b}deg)`,transition:"transform 480ms cubic-bezier(0.22,0.61,0.36,1)"},children:[e.jsxs("div",{className:"relative h-[58%] overflow-hidden bg-gradient-to-br from-mn-bg/90 via-mn-bg/85 to-mn-bg/95",children:[e.jsx("div",{className:"h-full w-full animate-pulse bg-gradient-to-br from-mn-border-subtle/40 via-mn-border-subtle/20 to-mn-border-subtle/50"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/25 via-black/10 to-mn-bg/85"}),e.jsxs("div",{className:"absolute left-3 right-3 top-3 flex flex-wrap items-center justify-between gap-2 text-[10px]",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg/80 px-2 py-1 font-semibold text-mn-text-muted shadow-mn-soft",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-mn-border-subtle"}),"Getting picks…"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg/80 px-2 py-1 text-[10px] text-mn-text-muted shadow-mn-soft",children:[e.jsx(D,{className:"h-3 w-3"}),"Warming up"]})]})]}),e.jsxs("div",{className:"flex flex-1 flex-col justify-between bg-gradient-to-b from-mn-bg/92 via-mn-bg/96 to-mn-bg px-4 pb-4 pt-3 backdrop-blur-md",children:[e.jsxs("div",{className:"space-y-3 text-left text-[12px] leading-relaxed",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 w-3/4 animate-pulse rounded-full bg-mn-border-subtle/60"}),e.jsx("div",{className:"h-3 w-1/2 animate-pulse rounded-full bg-mn-border-subtle/40"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("div",{className:"h-3 w-full animate-pulse rounded-full bg-mn-border-subtle/40"}),e.jsx("div",{className:"h-3 w-5/6 animate-pulse rounded-full bg-mn-border-subtle/30"})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"h-6 w-20 animate-pulse rounded-full bg-mn-border-subtle/40"}),e.jsx("div",{className:"h-6 w-16 animate-pulse rounded-full bg-mn-border-subtle/20"})]})]}),e.jsx("div",{className:"mt-4 flex flex-wrap items-center gap-2 text-[11px] text-mn-text-secondary",children:e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-surface-elevated/80 px-2 py-1 shadow-mn-soft",children:[e.jsx(W,{className:"h-4 w-4 text-mn-border-subtle"}),"Finding what friends like…"]})})]})]})},Ae=()=>{const{cards:t,isLoading:a,isError:i,swipe:b,fetchMore:u,trimConsumed:k,swipeSyncError:q,retryFailedSwipe:G,isRetryingSwipe:V}=ae("combined",{limit:72}),[f,M]=r.useState(0),[L,C]=r.useState(!1),[K,T]=r.useState(!1),[$,O]=r.useState(!1),[Z,X]=r.useState(!1),[J,_]=r.useState(!1),s=t[f],l=t[f+1],Q=!!(s!=null&&s.posterUrl&&!Z),ee=!!(l!=null&&l.posterUrl&&!J),y=r.useRef(null),v=r.useRef(null),g=r.useRef(0),j=r.useRef(),h=r.useRef(null),w=r.useRef(null),p=r.useRef(0);r.useEffect(()=>{const n=typeof window<"u"?localStorage.getItem(F):null;T(!n)},[]),r.useEffect(()=>{X(!1)},[s==null?void 0:s.id]),r.useEffect(()=>{_(!1)},[l==null?void 0:l.id]),r.useEffect(()=>{if(typeof window>"u")return;(window.requestIdleCallback??(c=>window.setTimeout(c,180)))(()=>{const c=t.slice(f+1,f+4);for(const d of c){if(!(d!=null&&d.posterUrl))continue;const m=new Image;m.loading="lazy",m.decoding="async",m.src=d.posterUrl}})},[t,f]),r.useEffect(()=>()=>{j.current&&cancelAnimationFrame(j.current)},[]),r.useEffect(()=>{if(!l)return;O(!1);const n=window.setTimeout(()=>{O(!0)},16);return()=>window.clearTimeout(n)},[l==null?void 0:l.id]),r.useEffect(()=>{const n=t.length-f;n<3&&u(Math.max(24,n+12))},[t.length,f,u]),r.useEffect(()=>{if(f<=10)return;const n=Math.min(f-6,t.length);n>0&&(k(n),M(o=>Math.max(4,o-n)))},[t.length,f,k]);const I=(n,{withTransition:o=!1,clampDrag:c=!0}={})=>{const d=y.current;if(!d)return;const m=c?P(n,-H,H):n,N=P(m/Y,-12,12);d.style.transition=o?"transform 260ms cubic-bezier(0.22,0.61,0.36,1)":"none",d.style.transform=`translateX(${m}px) rotate(${N}deg)`,g.current=m},z=()=>{I(0,{withTransition:!0}),g.current=0,v.current=null,h.current=null,w.current=null,p.current=0},te=()=>{typeof navigator<"u"&&typeof navigator.vibrate=="function"&&navigator.vibrate(8)},S=(n,o=0)=>{if(!s)return;if(T(!1),typeof window<"u"&&localStorage.setItem(F,"1"),b({cardId:s.id,direction:n,rating:s.initialRating??null,inWatchlist:s.initiallyInWatchlist??void 0,sourceOverride:s.source,title:s.title}),n==="skip"){const x=y.current;x&&(x.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",x.style.transform="translateX(0px) translateY(24px) scale(0.95)",x.style.opacity="0"),window.setTimeout(()=>{M(ie=>Math.min(ie+1,t.length)),x&&(x.style.transition="none",x.style.transform="translateX(0px) translateY(0px) scale(1)",x.style.opacity="1")},220);return}const c=n==="like"?1:-1,m=Math.max(ye,Math.abs(g.current)+Math.abs(o)*we)*c,N=y.current;N&&(N.style.transition="transform 260ms cubic-bezier(0.22,0.61,0.36,1)",N.style.transform=`translateX(${m}px) rotate(${P(m/Y,-18,18)}deg)`),te(),window.setTimeout(()=>{M(x=>Math.min(x+1,t.length)),z()},260)},se=(n,o)=>{if(!s)return;C(!0),v.current=n,g.current=0,h.current=n,w.current=performance.now(),p.current=0;const c=y.current;if(c)try{c.setPointerCapture(o)}catch{}},ne=n=>{if(!L||v.current===null)return;const o=performance.now(),c=n-v.current;if(I(c,{withTransition:!1}),h.current!==null&&w.current!==null){const d=o-w.current;if(d>0){const m=(n-h.current)/d;p.current=m}}h.current=n,w.current=o,j.current&&cancelAnimationFrame(j.current),j.current=window.requestAnimationFrame(()=>I(g.current))},U=()=>{if(!L)return;C(!1);const o=g.current+p.current*180;if(Math.abs(o)>=ge||Math.abs(p.current)>=he){S(o>=0?"like":"dislike",p.current),v.current=null,h.current=null,w.current=null,p.current=0;return}z()},re=je(s==null?void 0:s.source),E=!s||a||i;return e.jsxs("div",{className:"relative flex min-h-[calc(100vh-6rem)] flex-col overflow-hidden rounded-3xl border border-mn-border-subtle/70 bg-mn-bg-elevated/80 p-3 shadow-mn-card sm:p-5",children:[e.jsx(le,{title:"Swipe",subtitle:"Combined For You, friends, and trending picks"}),e.jsx(pe,{message:q,onRetry:G,isRetrying:V}),e.jsxs("div",{className:"relative mt-2 flex flex-1 flex-col overflow-hidden rounded-2xl border border-mn-border-subtle/60 bg-gradient-to-b from-mn-bg/90 via-mn-bg to-mn-bg-elevated/80 p-3",children:[e.jsxs("div",{className:"relative flex flex-1 items-center justify-center overflow-hidden","aria-live":"polite",children:[a&&!s&&!i&&e.jsx(ke,{}),i&&!a&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-mn-text-secondary",children:[e.jsx(ce,{className:"h-8 w-8 text-amber-400"}),e.jsx("p",{children:"We couldn't load your swipe deck. Please retry from the menu."})]}),!a&&!i&&!s&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-mn-text-secondary",children:[e.jsx(D,{className:"h-8 w-8 text-mn-primary"}),e.jsx("p",{children:"All caught up. New cards will appear soon."})]}),!a&&s&&e.jsxs(e.Fragment,{children:[l&&e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 mx-auto flex h-[72%] max-h-[480px] w-full max-w-md items-center justify-center rounded-[30px] transition-all duration-300 ease-out",style:{transform:$?"translateY(-40px) scale(0.9)":"translateY(-10px) scale(0.84)",opacity:$?1:0},children:e.jsx("div",{className:"relative h-full w-full overflow-hidden rounded-[30px] border border-mn-border-subtle/40 shadow-mn-card",children:ee?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:l.posterUrl,alt:A(l)??l.title,className:"h-full w-full object-cover blur-[7px] brightness-[0.8]",loading:"lazy",draggable:!1,onError:()=>_(!0)}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-mn-bg/0 via-mn-bg/30 to-mn-bg/90"})]}):e.jsx(B,{title:l==null?void 0:l.title})})}),e.jsxs("article",{ref:y,className:"relative z-10 mx-auto flex h-[72%] max-h-[480px] w-full max-w-md select-none flex-col overflow-hidden rounded-[30px] border border-mn-border-subtle/70 bg-gradient-to-br from-mn-bg-elevated/95 via-mn-bg/95 to-mn-bg-elevated/90 shadow-mn-card backdrop-blur",onPointerDown:n=>{n.pointerType==="mouse"&&n.button!==0||se(n.clientX,n.pointerId)},onPointerMove:n=>ne(n.clientX),onPointerUp:U,onPointerCancel:U,"aria-label":A(s),style:{touchAction:"pan-y"},children:[e.jsxs("div",{className:"relative h-[58%] overflow-hidden bg-gradient-to-br from-mn-bg/90 via-mn-bg/85 to-mn-bg/95",children:[Q?e.jsx("img",{src:s.posterUrl,alt:A(s)??`${s.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>X(!0)}):e.jsx(B,{title:s.title}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/25 via-black/10 to-mn-bg/85"}),e.jsxs("div",{className:"absolute left-3 right-3 top-3 flex flex-wrap items-center justify-between gap-2 text-[10px]",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg/80 px-2 py-1 font-semibold text-mn-text-primary shadow-mn-soft",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-mn-primary"}),re]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg/80 px-2 py-1 text-[10px] text-mn-text-secondary shadow-mn-soft",children:[e.jsx(D,{className:"h-3 w-3 text-mn-primary"}),"Card ",f+1," / ",t.length||1]})]})]}),e.jsxs("div",{className:"flex flex-1 flex-col justify-between bg-gradient-to-b from-mn-bg/92 via-mn-bg/96 to-mn-bg px-4 pb-4 pt-3 backdrop-blur-md",children:[e.jsx(Ne,{card:s}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-2 text-[11px] text-mn-text-secondary",children:[typeof s.friendLikesCount=="number"&&s.friendLikesCount>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-surface-elevated/80 px-2 py-1 shadow-mn-soft",children:[e.jsx(W,{className:"h-4 w-4 text-mn-primary"}),s.friendLikesCount===1?"1 friend likes this":`${s.friendLikesCount} friends like this`]}),s.topFriendName&&s.topFriendReviewSnippet&&e.jsxs("span",{className:"inline-flex flex-1 items-start gap-2 rounded-xl bg-mn-bg-elevated/80 px-3 py-2 text-left text-mn-text-primary shadow-mn-soft",children:[e.jsx(de,{className:"mt-0.5 h-4 w-4 text-mn-primary"}),e.jsxs("span",{className:"line-clamp-2",children:[s.topFriendName,": “",s.topFriendReviewSnippet,"”"]})]})]})]})]}),K&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center bg-gradient-to-b from-mn-bg/70 via-mn-bg/50 to-mn-bg/80",children:e.jsxs("div",{className:"pointer-events-auto max-w-xs rounded-2xl border border-mn-border-subtle/70 bg-mn-bg/95 p-4 text-center shadow-mn-card",children:[e.jsx("p",{className:"text-sm font-semibold text-mn-text-primary",children:"Swipe to decide"}),e.jsx("p",{className:"mt-1 text-[12px] text-mn-text-secondary",children:"Drag the card left to pass or right to like. You can also use the buttons below."}),e.jsx("button",{type:"button",className:"mt-3 w-full rounded-full bg-mn-primary px-3 py-2 text-sm font-semibold text-white shadow-mn-soft",onClick:()=>{T(!1),typeof window<"u"&&localStorage.setItem(F,"1")},children:"Got it"})]})})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>S("dislike"),disabled:E,className:"flex items-center justify-center gap-2 rounded-full border border-mn-border-subtle/70 bg-mn-bg px-3 py-3 text-sm font-semibold text-rose-400 shadow-mn-soft disabled:cursor-not-allowed disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300 focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg active:translate-y-[1px] active:scale-[0.99] active:shadow-none transition-all duration-150","aria-label":"Dislike",children:[e.jsx(be,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Dislike"})]}),e.jsxs("button",{type:"button",onClick:()=>S("skip"),disabled:E,className:"flex items-center justify-center gap-2 rounded-full border border-mn-border-subtle/70 bg-mn-bg px-3 py-3 text-sm font-semibold text-mn-text-secondary shadow-mn-soft disabled:cursor-not-allowed disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-border-subtle focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg active:translate-y-[1px] active:scale-[0.99] active:shadow-none transition-all duration-150","aria-label":"Skip",children:[e.jsx(xe,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Skip"})]}),e.jsxs("button",{type:"button",onClick:()=>S("like"),disabled:E,className:"flex items-center justify-center gap-2 rounded-full border border-transparent bg-mn-primary/95 px-3 py-3 text-sm font-semibold text-mn-bg shadow-mn-soft disabled:cursor-not-allowed disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-primary focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg active:translate-y-[1px] active:scale-[0.99] active:shadow-none transition-all duration-150","aria-label":"Like",children:[e.jsx(me,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Like"})]})]})]})]})};export{Ne as CardMetadata,ke as LoadingSwipeCard,B as PosterFallback,Ae as default};
