import{C as Y,j as e,B as me,u as fe,e as xe,b as he,ak as pe,r as o,A as ge,R as be,am as ve,an as je,ao as u,s as Ne,N as we,L as ye,ap as Q}from"./index-n01z0Q-I.js";import{M as j}from"./material-icon-ik9c9RPC.js";import{V as Me}from"./VerifiedBadge-BK7Fjn_d.js";import{B as Ce,u as ke,M as Ue,w as Pe,c as Se}from"./useAssistantCache-JffK51kj.js";import{C as Ie,u as p}from"./conversationsCache-D_XJbltN.js";import{D as Le,a as _e,c as Ae}from"./dialog-xEYVlW9E.js";import{M as Oe}from"./mail-86WxDn9v.js";import{B as He}from"./bell-BqWz5DRv.js";import"./clock-DfxzXIbJ.js";const Re=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Be=Y("eye-off",Re);const Te=[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]],De=Y("mail-open",Te),A=({icon:d,title:l,description:m,onClick:r,destructive:b})=>e.jsxs("button",{type:"button",onClick:r,className:"soft-row-card soft-row-card-interactive flex w-full items-center gap-3 row-pad text-left transition"+(b?" text-destructive":""),children:[e.jsx("span",{className:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-muted/80",children:d}),e.jsxs("span",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"block truncate text-sm font-semibold",children:l}),m?e.jsx("span",{className:"block truncate text-xs text-muted-foreground",children:m}):null]})]}),Ee=({open:d,onOpenChange:l,conversation:m,isMuted:r,isHidden:b,onToggleMute:M,onToggleHidden:v,onMarkRead:n,onMarkUnread:P,onOpenConversation:N})=>{const w=()=>l(!1),g=C=>{C(),w()},c=!!m?.lastMessageId;return e.jsx(Le,{open:d,onOpenChange:l,children:e.jsxs(_e,{className:"left-0 right-0 top-auto bottom-0 w-full max-w-none translate-x-0 translate-y-0 rounded-t-3xl rounded-b-none border border-border bg-card card-pad",children:[e.jsx("div",{className:"mx-auto mb-2 h-1.5 w-12 rounded-full bg-muted","aria-hidden":!0}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(Ae,{className:"text-center text-base text-foreground",children:m?.title??"Conversation"}),e.jsx("p",{className:"mt-1 text-center text-xs text-muted-foreground",children:"Quick actions"})]}),e.jsx("button",{type:"button",onClick:w,className:"icon-hit","aria-label":"Close",children:e.jsx(j,{name:"close"})})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsx(A,{icon:e.jsx(Ie,{className:"h-5 w-5 text-muted-foreground","aria-hidden":!0}),title:"Open chat",description:"Jump back into this conversation",onClick:()=>g(N)}),m?.hasUnread?e.jsx(A,{icon:e.jsx(De,{className:"h-5 w-5 text-muted-foreground","aria-hidden":!0}),title:"Mark as read",description:c?"Clear unread badge":"No messages yet",onClick:()=>g(n)}):e.jsx(A,{icon:e.jsx(Oe,{className:"h-5 w-5 text-muted-foreground","aria-hidden":!0}),title:"Mark as unread",description:"Bring it back to your attention",onClick:()=>g(P)}),e.jsx(A,{icon:r?e.jsx(He,{className:"h-5 w-5 text-muted-foreground","aria-hidden":!0}):e.jsx(Ce,{className:"h-5 w-5 text-muted-foreground","aria-hidden":!0}),title:r?"Unmute":"Mute",description:"Stops message notifications on all devices",onClick:()=>g(M)}),e.jsx(A,{icon:e.jsx(Be,{className:"h-5 w-5 text-muted-foreground","aria-hidden":!0}),title:b?"Unhide":"Hide",description:"Removes it from your inbox list",onClick:()=>g(v)})]}),e.jsx("div",{className:"pt-3",children:e.jsx(me,{type:"button",variant:"ghost",className:"w-full rounded-2xl border border-border bg-muted/60 text-foreground hover:bg-muted",onClick:w,children:"Cancel"})})]})})},Fe=()=>e.jsxs("div",{className:"flex min-h-screen flex-1 flex-col overflow-hidden bg-background text-foreground",children:[e.jsxs("header",{className:"sticky top-0 z-10 bg-background px-[var(--page-pad-x)] pb-2 pt-4 full-bleed",children:[e.jsxs("div",{className:"mb-3 mt-1.5 flex items-center justify-between",children:[e.jsx("div",{className:"h-9 w-40 rounded-xl bg-muted animate-pulse","aria-hidden":!0}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted animate-pulse","aria-hidden":!0})]}),e.jsx("div",{className:"relative mb-3",children:e.jsx("div",{className:"h-12 w-full rounded-full bg-muted animate-pulse","aria-hidden":!0})}),e.jsxs("div",{className:"-mt-1 mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-24 rounded-full bg-muted animate-pulse","aria-hidden":!0}),e.jsx("div",{className:"h-6 w-28 rounded-full bg-muted animate-pulse","aria-hidden":!0}),e.jsx("div",{className:"ml-auto h-4 w-12 rounded bg-muted animate-pulse","aria-hidden":!0})]}),e.jsx("div",{className:"full-bleed flex space-x-4 overflow-x-auto border-b border-border/60 pb-3 pl-[var(--page-pad-x)] pr-[var(--page-pad-x)] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:Array.from({length:7}).map((d,l)=>e.jsxs("div",{className:"flex shrink-0 flex-col items-center gap-1",children:[e.jsx("div",{className:"h-14 w-14 rounded-full bg-muted animate-pulse","aria-hidden":!0}),e.jsx("div",{className:"h-3 w-12 rounded bg-muted animate-pulse","aria-hidden":!0})]},l))})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto px-[var(--page-pad-x)] pb-32 pt-2",children:[e.jsx("div",{className:"py-2 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Recent Chats"}),e.jsx("ul",{className:"space-y-1",children:Array.from({length:8}).map((d,l)=>e.jsx("li",{className:"rounded-2xl p-2.5",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-14 w-14 rounded-full bg-muted animate-pulse","aria-hidden":!0}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[e.jsx("div",{className:"h-4 w-44 max-w-[70%] rounded bg-muted animate-pulse","aria-hidden":!0}),e.jsx("div",{className:"h-3 w-12 rounded bg-muted animate-pulse","aria-hidden":!0})]}),e.jsx("div",{className:"mt-2 h-3 w-64 max-w-[85%] rounded bg-muted animate-pulse","aria-hidden":!0})]})]})},l))})]})]}),Ve=450,X=({conversation:d,isMuted:l,onOpenActions:m,onOpenConversation:r,dimmed:b=!1})=>{const{getStatus:M}=we(),v=d.participants??[],n=v.find(i=>!i.isSelf)??v[0]??null,P=d.lastMessageAtLabel??"Now",N=d.isGroup,w=v.length,g=!N&&n?.id?M(n.id)==="online":!1,c=o.useRef({timeoutId:null,fired:!1}),C=i=>{i.pointerType&&i.pointerType!=="touch"||(c.current.fired=!1,c.current.timeoutId!=null&&window.clearTimeout(c.current.timeoutId),c.current.timeoutId=window.setTimeout(()=>{c.current.fired=!0,m(d)},Ve))},y=()=>{c.current.timeoutId!=null&&(window.clearTimeout(c.current.timeoutId),c.current.timeoutId=null)};return e.jsx("li",{children:e.jsxs(ye,{to:`/messages/${d.id}`,className:"soft-row-card soft-row-card-interactive group flex items-center gap-3 row-pad focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 focus-visible:ring-offset-2 focus-visible:ring-offset-background"+(b?" opacity-70":""),onPointerDown:C,onPointerUp:y,onPointerCancel:y,onPointerLeave:y,onContextMenu:i=>{i.preventDefault(),y(),m(d)},onClick:i=>{if(c.current.fired){i.preventDefault(),i.stopPropagation(),c.current.fired=!1;return}i.defaultPrevented||i.metaKey||i.ctrlKey||i.shiftKey||i.altKey||r(d)},children:[e.jsx("div",{className:"relative shrink-0",children:N&&w>1?e.jsx("div",{className:"grid h-14 w-14 grid-cols-2 gap-0.5 overflow-hidden rounded-full bg-muted",children:v.slice(0,4).map(i=>e.jsx("div",{className:"h-full w-full bg-cover bg-center",style:i.avatarUrl?{backgroundImage:`url(${i.avatarUrl})`}:void 0},i.id))}):e.jsxs("div",{className:"relative h-14 w-14 overflow-hidden rounded-full border-2 border-primary/50",children:[n?.avatarUrl?e.jsx("img",{src:n.avatarUrl,alt:n.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-sm font-semibold text-foreground",children:(n?.displayName??"?").slice(0,1).toUpperCase()}),g&&e.jsx("span",{className:"absolute bottom-0 right-0 h-3.5 w-3.5 rounded-full border-2 border-background bg-green-500",title:"Online"})]})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-baseline justify-between gap-2",children:[e.jsxs("h3",{className:"flex min-w-0 items-center gap-2 truncate text-base font-bold text-foreground",children:[e.jsx("span",{className:"truncate",children:d.title}),!N&&n?.isVerified?e.jsx(Me,{isVerified:n?.isVerified??null,type:n.verifiedType??null,label:n.verifiedLabel??null,verifiedAt:n.verifiedAt??null,org:n.verifiedByOrg??null}):null]}),e.jsx("span",{className:"whitespace-nowrap text-xs font-medium text-primary",children:P})]}),e.jsxs("div",{className:"mt-0.5 flex items-center gap-2",children:[e.jsxs("p",{className:"truncate text-sm text-muted-foreground",children:[g&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-green-500",children:"Online"}),e.jsx("span",{className:"mx-1",children:"•"})]}),d.lastMessagePreview??"Start chatting"]}),l&&e.jsx(j,{name:"notifications_off",className:"text-sm text-muted-foreground",ariaLabel:"Muted"}),d.hasUnread&&e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-primary"})]})]}),e.jsx("button",{type:"button",className:"ml-1 flex h-11 w-11 shrink-0 items-center justify-center rounded-full text-muted-foreground transition hover:bg-muted/70 hover:text-foreground","aria-label":"Conversation actions",onClick:i=>{i.preventDefault(),i.stopPropagation(),y(),m(d)},children:e.jsx(j,{name:"more_horiz",className:"text-xl",ariaLabel:"More"})})]})})},Xe=()=>{const d=fe(),l=xe(),{user:m}=he(),r=m?.id??null,b=ke(),{getString:M}=pe(),v=o.useMemo(()=>M("ux.assistant.username","movinesta").toLowerCase(),[M]),{data:n,isLoading:P,isError:N,error:w,refetch:g,isFetching:c}=ge(),[C,y]=o.useState(""),[i,z]=o.useState(!1),S=o.useCallback(s=>b?.conversationId&&s.id===b.conversationId?!0:s.participants.some(t=>!t.isSelf&&t.username?.toLowerCase()===v),[b?.conversationId,v]),k=o.useMemo(()=>(n??[]).find(s=>S(s))??null,[n,S]),[O,K]=o.useState(!1),ee=o.useCallback(async()=>{if(r&&!O){K(!0);try{d("/assistant")}finally{K(!1)}}},[O,d,r]);be.useEffect(()=>{ve(r).then(()=>{r&&l.invalidateQueries({queryKey:je(r)})}).catch(s=>{console.warn("[MessagesPage] Prefs migration failed",s)})},[r,l]);const U=C.trim().toLowerCase(),$=o.useMemo(()=>(n??[]).filter(s=>U?[s.title,s.subtitle,s.lastMessagePreview??"",...s.participants.map(a=>a.displayName),...s.participants.map(a=>a.username).filter(a=>!!a)].join(" ").toLowerCase().includes(U):!0),[n,U]),{visibleConversations:B,hiddenConversations:H}=o.useMemo(()=>{const s=[],t=[];$.forEach(x=>{x.isHidden?t.push(x):s.push(x)});const f=s.filter(x=>!S(x)),L=t.filter(x=>!S(x));return{visibleConversations:f,hiddenConversations:L}},[$,S]),q=o.useMemo(()=>(n??[]).filter(s=>s.isHidden).length,[n]),G=o.useMemo(()=>(n??[]).filter(s=>s.isMuted).length,[n]),T=o.useMemo(()=>!U,[U]),se=o.useMemo(()=>!!(T||B.length>0||i&&H.length>0),[T,B.length,i,H.length]),[te,D]=o.useState(!1),[I,ae]=o.useState(null),h=o.useMemo(()=>I?(n??[]).find(s=>s.id===I)??null:null,[I,n]),[re,J]=o.useState(!1),[E,ne]=o.useState(null),F=o.useMemo(()=>E?(n??[]).find(s=>s.id===E)??null:null,[E,n]),ie=s=>{ne(s.id),J(!0)},Z=s=>{ae(s.id),D(!0)},le=s=>{if(!r){u.error("Please sign in to manage messages.");return}if(s.isMuted){const t=s.mutedUntil??null;p(l,r,s.id,a=>({...a,isMuted:!1,mutedUntil:null})),u.show("Unmuted notifications."),Q(r,s.id,{muted:!1,hidden:s.isHidden,mutedUntil:null}).then(({ok:a})=>{a||(p(l,r,s.id,f=>({...f,isMuted:!0,mutedUntil:t})),u.error("Couldn't update preferences."))}).catch(a=>{console.warn("[MessagesPage] Failed to save conversation prefs (unmute)",a),p(l,r,s.id,f=>({...f,isMuted:!0,mutedUntil:t})),u.error("Couldn't update preferences.")});return}ie(s)},de=(s,t)=>{if(!r){u.error("Please sign in to manage messages.");return}const a=s.isMuted,f=s.mutedUntil??null;let L=!1,x=null;t.kind==="indefinite"?(L=!0,x=null):(L=!1,x=new Date(Date.now()+t.minutes*6e4).toISOString()),p(l,r,s.id,_=>({..._,isMuted:!0,mutedUntil:x})),u.show(`Muted notifications for ${t.label}.`),Q(r,s.id,{muted:L,hidden:s.isHidden,mutedUntil:x}).then(({ok:_})=>{_||(p(l,r,s.id,V=>({...V,isMuted:a,mutedUntil:f})),u.error("Couldn't update preferences."))}).catch(_=>{console.warn("[MessagesPage] Failed to save conversation prefs (mute preset)",_),p(l,r,s.id,V=>({...V,isMuted:a,mutedUntil:f})),u.error("Couldn't update preferences.")})},oe=s=>{if(!r){u.error("Please sign in to manage messages.");return}const t=!s.isHidden;p(l,r,s.id,a=>({...a,isHidden:t})),u.show(t?"Conversation hidden.":"Conversation restored."),Q(r,s.id,{muted:s.isMuted,hidden:t,mutedUntil:s.mutedUntil??null}).then(({ok:a})=>{a||(p(l,r,s.id,f=>({...f,isHidden:!t})),u.error("Couldn't update preferences."))}).catch(a=>{console.warn("[MessagesPage] Failed to save conversation prefs (toggle hidden)",a),p(l,r,s.id,f=>({...f,isHidden:!t})),u.error("Couldn't update preferences.")})},R=async s=>{if(!r){u.error("Please sign in to manage messages.");return}if(!s.lastMessageId){u.show("No messages to mark as read.");return}try{const{error:t}=await Ne.rpc("mark_conversation_read",{p_conversation_id:s.id,p_last_message_id:s.lastMessageId});t&&await Pe({conversation_id:s.id,user_id:r,last_read_message_id:s.lastMessageId,last_read_at:new Date().toISOString()}),p(l,r,s.id,a=>a.hasUnread?{...a,hasUnread:!1}:a)}catch(t){console.warn("[MessagesPage] Failed to mark conversation read",t),u.show("Couldn't mark as read. Please try again.")}},ue=async s=>{if(!r){u.error("Please sign in to manage messages.");return}const t=await Se(s.id,r);t.ok||(console.warn("[MessagesPage] Failed to clear read receipt (mark unread)",t.error),u.show("Marked as unread locally. Server update may have failed.")),p(l,r,s.id,a=>a.hasUnread?a:{...a,hasUnread:!0})},ce=o.useMemo(()=>{const s=new Map;return(n??[]).forEach(t=>{t.isHidden||t.participants.filter(a=>!a.isSelf).forEach(a=>{s.has(a.id)||s.set(a.id,{id:a.id,name:a.displayName,avatarUrl:a.avatarUrl,conversationId:t.id})})}),Array.from(s.values()).slice(0,8)},[n]),W=()=>{d("/messages/new")};return P?e.jsx(Fe,{}):N?e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center px-4 py-12 text-sm text-foreground",children:[e.jsx("p",{className:"font-semibold",children:"Unable to load messages."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:w?.message??"Please try again in a moment."}),e.jsx("button",{type:"button",onClick:()=>g(),className:"mt-4 rounded-full bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:"Try again"})]}):e.jsxs("div",{className:"flex min-h-screen flex-1 flex-col overflow-hidden bg-background text-foreground",children:[e.jsxs("header",{className:"sticky top-0 z-10 bg-background px-[var(--page-pad-x)] pb-2 pt-4 full-bleed",children:[e.jsxs("div",{className:"mb-3 mt-1.5 flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Messages"}),e.jsx("button",{type:"button",onClick:W,className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary/10 text-primary transition-colors hover:bg-primary/20 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 focus-visible:ring-offset-2 focus-visible:ring-offset-background","aria-label":"New message",children:e.jsx(j,{name:"edit_square",className:"text-xl",ariaLabel:"New message"})})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(j,{name:"search",className:"text-muted-foreground"})}),e.jsx("input",{className:"block w-full rounded-full border border-input bg-card py-3 pl-10 pr-3 text-sm text-foreground placeholder:text-muted-foreground shadow-sm focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Search friends or titles...",value:C,onChange:s=>y(s.target.value)})]}),e.jsxs("div",{className:"-mt-1 mb-3 flex items-center gap-2",children:[q>0&&e.jsxs("button",{type:"button",onClick:()=>z(s=>!s),className:"inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold transition "+(i?"bg-foreground text-background":"bg-muted/60 text-muted-foreground hover:bg-muted"),children:[e.jsx(j,{name:"visibility_off",className:"text-base",ariaLabel:"Hidden"}),"Hidden (",q,")"]}),G>0&&e.jsxs("span",{className:"ml-auto inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(j,{name:"notifications_off",className:"text-base",ariaLabel:"Muted"}),G]})]}),e.jsxs("div",{className:"full-bleed flex space-x-4 overflow-x-auto border-b border-border/60 pb-3 pl-[var(--page-pad-x)] pr-[var(--page-pad-x)] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:[e.jsxs("button",{type:"button",onClick:W,className:"flex shrink-0 flex-col items-center gap-1",children:[e.jsx("div",{className:"relative flex h-14 w-14 items-center justify-center rounded-full border-2 border-dashed border-primary/50",children:e.jsx(j,{name:"add",className:"text-3xl text-primary"})}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"New"})]}),ce.map(s=>e.jsxs("button",{type:"button",className:"flex shrink-0 flex-col items-center gap-1",onClick:()=>{const t=(n??[]).find(a=>a.id===s.conversationId);t?.hasUnread&&R(t),d(`/messages/${s.conversationId}`)},children:[e.jsx("div",{className:"relative h-14 w-14 overflow-hidden rounded-full border-2 border-primary/50",children:s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:s.name,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted text-xs font-semibold text-foreground",children:s.name.slice(0,1).toUpperCase()})}),e.jsx("span",{className:"max-w-[56px] truncate text-xs font-medium text-foreground",children:s.name})]},s.id))]})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto px-[var(--page-pad-x)] pb-32 pt-2",children:[e.jsx("div",{className:"py-2 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Recent Chats"}),se?e.jsxs(e.Fragment,{children:[e.jsxs("ul",{className:"flex flex-col gap-2",children:[T&&e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:ee,disabled:!r||O,className:"soft-row-card soft-row-card-interactive group flex w-full items-center gap-3 row-pad text-left focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 focus-visible:ring-offset-2 focus-visible:ring-offset-background "+(O?" opacity-70":""),children:[e.jsx("div",{className:"relative shrink-0",children:e.jsxs("div",{className:"relative h-14 w-14 overflow-hidden rounded-full border-2 border-primary/60",children:[k?.participants?.find(s=>!s.isSelf)?.avatarUrl?e.jsx("img",{src:k.participants.find(s=>!s.isSelf)?.avatarUrl??void 0,alt:"MoviNesta",className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted text-sm font-semibold text-foreground",children:"M"}),k?.hasUnread?e.jsx("span",{className:"absolute -right-0.5 -top-0.5 h-3 w-3 rounded-full bg-primary"}):null]})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:"MoviNesta Assistant"}),k?.lastMessageAtLabel?e.jsx("div",{className:"shrink-0 text-xs text-muted-foreground",children:k.lastMessageAtLabel}):null]}),e.jsx("div",{className:"mt-1 truncate text-xs text-muted-foreground",children:k?.lastMessagePreview??"Ask for recommendations, refine your taste, plan watch goals."})]})]})}),B.map(s=>e.jsx(X,{conversation:s,isMuted:s.isMuted,onOpenActions:Z,onOpenConversation:t=>{t.hasUnread&&R(t)}},s.id))]}),i&&H.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"py-2 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Hidden chats"}),e.jsx("button",{type:"button",onClick:()=>z(!1),className:"rounded-full bg-muted/60 px-3 py-1 text-xs font-semibold text-muted-foreground hover:bg-muted",children:"Hide"})]}),e.jsx("ul",{className:"mt-2 flex flex-col gap-2",children:H.map(s=>e.jsx(X,{conversation:s,isMuted:s.isMuted,onOpenActions:Z,onOpenConversation:t=>{t.hasUnread&&R(t)},dimmed:!0},s.id))})]})]}):e.jsx("div",{className:"mt-6 rounded-2xl border border-border/60 bg-card/60 p-4 text-center text-xs text-muted-foreground",children:U?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-semibold",children:"No matches."}),e.jsx("p",{className:"mt-1",children:"Try a different search."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-semibold",children:"No conversations yet."}),e.jsx("p",{className:"mt-1",children:"Start a chat with your crew."})]})})]}),e.jsx(Ee,{open:te,onOpenChange:D,conversation:h,isMuted:!!h?.isMuted,isHidden:!!h?.isHidden,onOpenConversation:()=>{I&&(D(!1),d(`/messages/${I}`))},onToggleMute:()=>{h&&le(h)},onToggleHidden:()=>{h&&oe(h)},onMarkRead:()=>{h&&R(h)},onMarkUnread:()=>{h&&ue(h)}}),e.jsx(Ue,{open:re,onOpenChange:J,conversationTitle:F?.title,onSelect:s=>{F&&de(F,s)}}),c&&e.jsxs("div",{className:"pointer-events-none fixed bottom-24 right-4 flex items-center gap-2 rounded-full border border-border bg-background/90 px-3 py-1 text-xs text-muted-foreground shadow-md",children:[e.jsx(j,{name:"sync",className:"text-base"}),"Syncing…"]})]})};export{Xe as default};
