import{c as L,j as e,B as U,L as M,u as S,g as P,r as d,v as T,s as C,f as _,M as g}from"./index-DlWPTL3h.js";import{T as R}from"./TopBar-Cwkp26YK.js";import{S as $}from"./SearchField-BRdgeVWB.js";import{C as E}from"./Chip-BH3yo9Vz.js";import{T as A,a as B,b}from"./Tabs-DEPbQ1Mw.js";import{U as I}from"./users-kMXw7pdl.js";const Q=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],z=L("plus",Q),j=({icon:a,title:t,subtitle:r,actionLabel:n,onAction:i})=>e.jsxs("div",{className:"flex min-h-[220px] flex-col items-center justify-center gap-3 rounded-2xl border border-border bg-background/90 p-6 text-center shadow-lg",children:[a?e.jsx("div",{className:"inline-flex h-12 w-12 items-center justify-center rounded-2xl bg-primary/10 text-primary",children:a}):null,e.jsx("h3",{className:"text-base font-semibold text-foreground",children:t}),r?e.jsx("p",{className:"max-w-md text-[12px] text-muted-foreground",children:r}):null,n?e.jsx(U,{size:"sm",onClick:i,className:"mt-1",children:n}):null]}),G=({conversation:a})=>{const t=a.participants.find(l=>!l.isSelf)??a.participants[0]??null,r=t?.displayName?.[0]?.toUpperCase()??t?.username?.[0]?.toUpperCase()??"?",n=a.lastMessageAtLabel??"Now",i=a.isGroup,m=a.participants.length,u="group flex items-center gap-3 rounded-2xl px-3 py-2 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",x=a.hasUnread?"bg-card/90 border border-primary/25 shadow-md":"hover:bg-card/70 hover:-translate-y-0.5 hover:shadow-md";return e.jsx("li",{className:"py-1 sm:py-1.5",children:e.jsxs(M,{to:`/messages/${a.id}`,className:`${u} ${x}`,children:[e.jsxs("div",{className:"relative flex h-12 w-12 items-center justify-center",children:[i&&m>1?e.jsx("div",{className:"flex -space-x-2",children:a.participants.slice(0,2).map((l,o)=>e.jsx("span",{className:"inline-flex h-10 w-10 items-center justify-center overflow-hidden rounded-full bg-card text-xs font-semibold text-foreground ring-2 ring-background",style:{zIndex:2-o},children:l.avatarUrl?e.jsx("img",{src:l.avatarUrl??"",alt:l.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):l.displayName?.[0]?.toUpperCase()??l.username?.[0]?.toUpperCase()??"?"},l.id))}):e.jsx("span",{className:`inline-flex h-11 w-11 items-center justify-center overflow-hidden rounded-full text-[12px] font-semibold text-foreground ${a.hasUnread?"bg-gradient-to-br from-primary/80 to-amber-400 text-primary-foreground":"bg-card"}`,children:t?.avatarUrl?e.jsx("img",{src:t.avatarUrl??"",alt:t.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):r}),a.hasUnread&&e.jsx("span",{className:"absolute -right-0.5 -top-0.5 h-2.5 w-2.5 rounded-full bg-primary shadow-md"})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:`truncate text-sm ${a.hasUnread?"font-semibold text-foreground":"font-medium text-foreground"}`,children:a.title}),i&&e.jsxs("div",{className:"mt-0.5 flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(I,{className:"h-3 w-3","aria-hidden":"true"}),e.jsxs("span",{children:[m," participants"]})]})]}),e.jsx("span",{className:"shrink-0 text-xs text-muted-foreground",children:n})]}),e.jsx("p",{className:`truncate text-[12px] ${a.hasUnread?"text-foreground":"text-muted-foreground"}`,children:a.lastMessagePreview??"Start chatting"})]})]})})},J=()=>{const a=S(),{data:t,isLoading:r,isError:n,error:i,refetch:m,isFetching:u}=P(),[x,l]=d.useState(""),[o,k]=d.useState("all"),y=T();d.useEffect(()=>{const s=C.channel("supabase_realtime_messages_publication:messages-list").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},f=>{console.log("[MessagesPage] Realtime message for list",f),y.invalidateQueries({queryKey:["conversations"]})});return s.subscribe(f=>{console.log("[MessagesPage] Realtime channel status (list)",f)}),()=>{C.removeChannel(s)}},[y]);const h=x.trim().toLowerCase(),N=h.length>0,w=d.useMemo(()=>(t??[]).filter(s=>s.hasUnread).length,[t]),p=d.useMemo(()=>(t??[]).filter(s=>o==="unread"?s.hasUnread:o==="groups"?s.isGroup:!0).filter(s=>h?[s.title,s.subtitle,s.lastMessagePreview??"",...s.participants.map(c=>c.displayName),...s.participants.map(c=>c.username).filter(c=>!!c)].join(" ").toLowerCase().includes(h):!0),[t,h,o]),v=()=>{a("/search?tab=people&from=messages")};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-4",children:[e.jsx(R,{title:"Messages",subtitle:"Chat with friends, plan movie nights",actions:e.jsx(U,{type:"button",onClick:v,className:"inline-flex h-11 w-11 items-center justify-center rounded-full bg-primary text-primary-foreground shadow-md transition hover:-translate-y-0.5","aria-label":"New conversation",children:e.jsx(z,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-card/80 px-2 py-1 shadow-md",children:[e.jsxs("span",{className:"relative flex h-2.5 w-2.5",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-400/60 opacity-75"}),e.jsx("span",{className:"relative inline-flex h-2.5 w-2.5 rounded-full bg-emerald-400"})]}),e.jsx("span",{className:"font-medium",children:w>0?`${w} unread`:"Inbox is caught up"})]}),u&&!r&&e.jsxs(E,{className:"gap-1 px-2 py-1 text-xs text-muted-foreground",children:[e.jsx("span",{className:"h-1.5 w-6 overflow-hidden rounded-full bg-border/40",children:e.jsx("span",{className:"block h-full w-1/3 animate-[shimmer_1.1s_linear_infinite] bg-primary/60"})}),"Syncing…"]})]}),e.jsx("div",{className:"w-full sm:max-w-xs",children:e.jsx(A,{value:o,onValueChange:s=>k(s),children:e.jsxs(B,{className:"w-full",children:[e.jsx(b,{value:"all",children:"All"}),e.jsx(b,{value:"unread",children:"Unread"}),e.jsx(b,{value:"groups",children:"Groups"})]})})})]}),e.jsx($,{placeholder:"Search chats or people…",value:x,onChange:s=>l(s.target.value)}),r&&e.jsx(_,{}),n&&!r&&e.jsx("div",{className:"flex flex-1 items-center justify-center",children:e.jsx(j,{icon:e.jsx(g,{className:"h-5 w-5"}),title:"Something went wrong",subtitle:i?.message??"Please try again in a moment.",actionLabel:u?"Retrying…":"Reload inbox",onAction:()=>m()})}),!r&&!n&&N&&p.length===0&&e.jsx(j,{icon:e.jsx(g,{className:"h-6 w-6"}),title:"No conversations match",subtitle:"Try a different name or clear your search to see all chats.",actionLabel:"Clear search",onAction:()=>l("")}),!r&&!n&&!N&&p.length===0&&e.jsx(j,{icon:e.jsx(g,{className:"h-6 w-6"}),title:"Plan together",subtitle:"Create a group chat to line up your next movie night.",actionLabel:"New conversation",onAction:v}),!r&&!n&&p.length>0&&e.jsx("div",{className:"rounded-2xl border border-border bg-background/90 shadow-lg",children:e.jsx("ul",{className:"divide-y divide-border/70 px-2 py-1 sm:px-3",children:p.map(s=>e.jsx(G,{conversation:s},s.id))})})]})};export{G as ConversationListRow,J as default};
