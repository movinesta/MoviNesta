import{A as K,j as e,L as T,R as k,B as C,s as P,u as Y,b as U,r as z,M as V,C as X,c as R,k as Z,l as J,m as q,t as ee,D as re}from"./index-CuXsBKB-.js";import{M as L}from"./material-icon-sbzzvxfS.js";import{u as B}from"./useSearchPeople-CDP-an1K.js";import{u as D}from"./useSearchTitles-yS8NEnQD.js";import{Y as te}from"./index-CWZRzMY7.js";import{F as G}from"./film-BC4pzuk3.js";import{S as se}from"./star-UbXg7u6d.js";import{u as ae}from"./useToggleFollow-QD-toqVT.js";import{U as ne}from"./users-D2vY3THq.js";import{U as le}from"./user-17PiglOz.js";import{U as ie,a as oe}from"./user-plus-Blo6babe.js";import{F as de}from"./FriendAvatarStack-0le-ybxn.js";import{X as ce}from"./x-DrKdDdus.js";import"./index-BxBFM2Tt.js";import"./useMutation-BhCO-uzT.js";const ue=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],I=K("sliders-horizontal",ue),Q=({item:r})=>{const t=[];r.year&&t.push(String(r.year)),r.type==="movie"&&t.push("Movie"),r.type==="series"&&t.push("Series"),r.type==="anime"&&t.push("Anime"),r.originalLanguage&&t.push(`Language: ${r.originalLanguage}`),r.ageRating&&t.push(r.ageRating),r.imdbRating&&t.push(`IMDb ${r.imdbRating.toFixed(1)}`),r.rtTomatoMeter&&t.push(`RT ${r.rtTomatoMeter}%`);const a={library:"Library","external-synced":"Synced","external-only":"External"},d={library:"bg-primary/10 text-primary border-primary/40","external-synced":"bg-emerald-500/10 text-emerald-400 border-emerald-500/30","external-only":"bg-card text-muted-foreground border-border"};return e.jsx("div",{children:e.jsxs(T,{to:`/title/${r.id}`,className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2 hover:bg-card/80",children:[r.posterUrl?e.jsx("img",{src:r.posterUrl,alt:r.title,className:"h-20 w-14 rounded-2xl object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-20 w-14 items-center justify-center rounded-2xl bg-muted",children:e.jsx(G,{className:"h-5 w-5 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-[12px] font-medium text-foreground",children:r.title}),e.jsx("span",{className:`shrink-0 rounded-full border px-2 py-0.5 text-xs font-medium ${d[r.source]}`,children:a[r.source]})]}),t.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.join(" • ")})]})]})})},me=({query:r,filters:t,onResetFilters:a})=>{const d=r.trim(),{data:c,isLoading:u,isError:v,error:b,fetchNextPage:o,hasNextPage:g,isFetchingNextPage:n}=D({query:d,filters:t}),x=c?.pages.flatMap(i=>i.results)??[],p=x.length,f=[];if(t.type&&t.type!=="all"){const i={movie:"Movies",series:"Series",anime:"Anime",episode:"Episodes",other:"Other",all:"All"};f.push(i[t.type])}typeof t.minYear=="number"&&f.push(`From ${t.minYear}`),typeof t.maxYear=="number"&&f.push(`Up to ${t.maxYear}`),t.originalLanguage&&f.push(`Language: ${t.originalLanguage==="en"?"English":t.originalLanguage}`);const y=f.length?f.join(" • "):"No filters applied",s=k.useRef(new Set);return k.useEffect(()=>{if(!x||!Array.isArray(x))return;const i=s.current,j=x.filter(m=>!(i.has(m.id)||!m.imdbId&&!m.tmdbId||m.imdbRating||m.rtTomatoMeter)).slice(0,3);(async()=>{for(const m of j){i.add(m.id);try{const{error:_}=await P.from("media_items").upsert({tmdb_id:m.tmdbId??null,omdb_imdb_id:m.imdbId??null,kind:m.type==="series"?"series":m.type??"movie",tmdb_title:m.title,tmdb_release_date:m.year?`${m.year}-01-01`:null},{onConflict:"kind,tmdb_id"}).select("id");_&&console.warn("[SearchTitlesTab] media_items upsert failed for",m.id,_.message)}catch(_){console.warn("[SearchTitlesTab] media_items upsert threw for",m.id,_)}}})()},[x]),d?u?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["Searching for ",e.jsx("span",{className:"font-semibold text-foreground",children:d}),"…"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fetching matching titles from your catalog and external sources."}),e.jsx("div",{className:"space-y-2",children:[0,1,2].map(i=>e.jsxs("div",{className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2",children:[e.jsx("div",{className:"h-16 w-11 animate-pulse rounded-xl bg-card/60"}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center space-y-1.5",children:[e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-card/60"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-card/40"})]})]},i))})]}):v?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-destructive",children:"Something went wrong while searching for titles."}),b&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Details: "}),b.message]})]}):p?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-semibold text-foreground",children:p})," result",p===1?"":"s"," across your catalog and external sources for"," ",e.jsx("span",{className:"font-semibold text-foreground",children:d}),"."]}),e.jsxs(C,{type:"button",variant:"outline",size:"sm",className:"h-auto rounded-full border-border px-2 py-1 text-muted-foreground hover:border-border hover:text-foreground",onClick:a,children:[e.jsx(I,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Reset filters"})]})]}),e.jsx("div",{className:"rounded-2xl border border-border bg-background/60 p-3",children:e.jsxs("p",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground",children:e.jsx(I,{className:"h-3 w-3","aria-hidden":"true"})}),e.jsx("span",{className:"truncate",children:y})]})}),e.jsx(te,{style:{height:"70vh"},data:x,endReached:()=>{g&&!n&&o()},components:{List:k.forwardRef(function(j,w){return e.jsx("div",{ref:w,className:"space-y-2",...j})}),Footer:()=>g?e.jsx("div",{className:"flex justify-center py-3",children:e.jsx(C,{type:"button",className:"inline-flex items-center justify-center rounded-full bg-primary/90 disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>o(),disabled:n,children:n?"Loading more…":"Load more results"})}):null},itemContent:(i,j)=>e.jsx(Q,{item:j})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No titles found matching"," ",e.jsx("span",{className:"font-semibold text-foreground",children:d}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search or removing some filters to see more results."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a title, director, or genre to search the catalog. As you wire Supabase search, results will appear here."}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-xs font-medium text-foreground",children:"Try searching for"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-xs",children:["Sci-fi romance","Feel-good comedies","Films from 2020s","Cozy rainy-day movies"].map(i=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-border px-2 py-1 text-muted-foreground",children:[e.jsx(G,{className:"mr-1 h-3 w-3 text-muted-foreground","aria-hidden":"true"}),i]},i))})]}),e.jsxs("div",{className:"space-y-1.5 rounded-2xl border border-border bg-background/60 p-3",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs font-medium text-foreground",children:[e.jsx(se,{className:"h-3.5 w-3.5 text-primary","aria-hidden":"true"}),e.jsx("span",{children:"Trending this week"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Once analytics are wired up, you can show what your friends and the community are watching the most here."})]})]})},xe=({query:r})=>{const t=r.trim(),a=t.replace(/^@+/,""),d=a||t,{data:c,isLoading:u,isError:v,error:b}=B(a),o=ae(),g=Y(),{user:n}=U(),[x,p]=z.useState(null),f=c??[],y=async s=>{if(!n?.id){alert("You need to be signed in to start a conversation.");return}if(n.id===s){alert("You can't start a conversation with yourself.");return}p(s);try{const i=await X("create-direct-conversation",{targetUserId:s},{timeoutMs:25e3});if(!i?.ok||!i.conversationId){const j=i?.code;let w=i?.error??"Failed to get conversation id. Please try again.";j==="UNAUTHORIZED"?w="You need to be signed in to start a conversation.":j==="BAD_REQUEST_SELF_TARGET"?w="You can't start a conversation with yourself.":j==="SERVER_MISCONFIGURED"&&(w="Messaging is temporarily unavailable due to a server issue. Please try again later.");const m=new Error(w);throw m.code=j,m}g(`/messages/${i.conversationId}`)}catch(i){console.error("[SearchPeopleTab] Failed to start conversation",i);const j=i instanceof Error?i.message:"Something went wrong while starting the conversation. Please try again.";alert(j)}finally{p(null)}};return a?u?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Searching for people…"}),e.jsx("div",{className:"rounded-2xl border border-border bg-card/80 px-3 py-4 text-xs text-muted-foreground",children:"We'll show matching profiles here as soon as the results come back."})]}):v?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-foreground",children:"Something went wrong."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:b?.message??"We couldn&apos;t search for people right now. Please try again."})]}):!f||f.length===0?e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No people found for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",d,"”"]}),". Try a different name or username."]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",f.length," profile",f.length===1?"":"s"," for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",d,"”"]})]})}),e.jsx("ul",{className:"divide-y divide-border/60 rounded-2xl border border-border bg-card/80",children:f.map(s=>{const i=s.displayName??s.username??"Unknown user",j=s.username?`@${s.username}`:null,w=o.isPending&&o.variables?.targetUserId===s.id,m=!!(n?.id&&n.id===s.id);return e.jsxs("li",{className:"flex items-center justify-between gap-3 px-3 py-2 hover:bg-card/80",children:[e.jsxs(T,{to:s.username?`/u/${s.username}`:`/u/${s.id}`,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-card/80 text-[14px] font-semibold text-foreground",children:s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:i,className:"h-8 w-8 rounded-full object-cover",loading:"lazy"}):i?i[0]?.toUpperCase():e.jsx(le,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",children:i}),m&&e.jsx("span",{className:"rounded-full border border-border bg-card px-2 py-0.5 text-[10px] text-muted-foreground",children:"You"})]}),j&&e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:j}),s.bio&&e.jsx("p",{className:"mt-0.5 line-clamp-2 text-xs text-muted-foreground",children:s.bio}),(typeof s.followersCount=="number"||typeof s.followingCount=="number")&&e.jsxs("p",{className:"mt-0.5 text-xs text-muted-foreground",children:[typeof s.followersCount=="number"&&e.jsxs("span",{children:[s.followersCount," follower",s.followersCount===1?"":"s"]}),typeof s.followersCount=="number"&&typeof s.followingCount=="number"&&e.jsx("span",{children:" · "}),typeof s.followingCount=="number"&&e.jsxs("span",{children:["following ",s.followingCount]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!m&&e.jsx(C,{type:"button",onClick:()=>o.mutate({targetUserId:s.id,currentlyFollowing:s.isFollowing}),disabled:w,variant:s.isFollowing?"outline":"default",size:"sm",className:`h-auto rounded-full px-2.5 py-1.5 text-xs font-medium ${s.isFollowing?"border-border bg-card/80 text-foreground hover:border-primary/70 hover:text-foreground disabled:opacity-60":"border border-transparent bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-60"}`,children:w?e.jsx("span",{children:"Updating…"}):s.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}),n?.id!==s.id&&e.jsx(C,{type:"button",onClick:()=>y(s.id),disabled:x===s.id,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-card/80 px-2.5 py-1.5 text-xs font-medium text-foreground shadow-md hover:border-primary/70 hover:text-foreground disabled:cursor-not-allowed disabled:opacity-60",children:x===s.id?e.jsx("span",{children:"Starting…"}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Message"})]})})]})]},s.id)})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a name or @username to find people. Once the social graph is wired up, you'll be able to follow friends and start conversations from here."}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-2 text-xs text-muted-foreground",children:[e.jsx(ne,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Search for people you know, then follow or message them."})]})]})},fe=["all","movie","series","anime"],pe=r=>{const t=r.get("tab");return t==="people"?"people":t==="titles"?"titles":t==="news"?"news":"all"},$=r=>{if(typeof r!="number")return;const t=new Date().getFullYear();return Math.min(Math.max(r,1900),t)},he=r=>{const t=r.get("type"),a=fe.includes(t)?t:"all",d=b=>{if(!b)return;const o=Number(b);return Number.isFinite(o)?o:void 0},c=$(d(r.get("minYear"))),u=$(d(r.get("maxYear"))),v=r.get("lang")||void 0;return c&&u&&c>u?{type:a,minYear:u,maxYear:c,originalLanguage:v}:{type:a,minYear:c,maxYear:u,originalLanguage:v}};function H(r){return typeof r!="number"||!Number.isFinite(r)?null:r.toFixed(1)}function ge(r){const t=(r?.mediaItemId??"").toString(),a=(r?.title??"").toString().trim();if(!t||!a)return null;const d=(r?.posterUrl&&r.posterUrl.trim()?r.posterUrl:null)??(r?.tmdbPosterPath?ee(r.tmdbPosterPath,"w500"):null);return{id:t,title:a,imageUrl:d,ratingLabel:H(r?.imdbRating??null),subtitle:r?.why?String(r.why):null,friendAvatarUrls:(r?.friendProfiles??[]).map(c=>c?.avatar_url?String(c.avatar_url):null).filter(c=>!!c).slice(0,3),friendExtraCount:Math.max(0,((r?.friendProfiles??[]).length||0)-3)}}function be(r,t){const a=q(r.media_item),d=a.id;if(!d||!a.title)return null;const c=a.posterUrl??a.backdropUrl??null,u=H(a.imdbRating??null);return{id:d,title:a.title,imageUrl:c,ratingLabel:u,subtitle:null,friendAvatarUrls:t?[t]:[],friendExtraCount:0}}function ye(r=10){const{user:t}=U(),a=t?.id??null;return R({queryKey:["search","discover","trending",a??"anon",r],enabled:!!a,staleTime:1e3*60*10,queryFn:async()=>{const d=`search_v2_${a??"anon"}`,c=Z(d,"trending",null);return(await J({sessionId:d,mode:"trending",limit:r,seed:c})).cards.map(ge).filter(v=>!!v)}})}function je(r){const t=(r?.id??"").toString(),a=r?.avatar_url?String(r.avatar_url):null;return{id:t,avatarUrl:a}}function ve(r){if(!r||typeof r!="object")return!1;const t=r;return typeof t.id=="string"&&typeof t.created_at=="string"&&typeof t.user_id=="string"&&typeof t.event_type=="string"}function we(r=8){const{user:t}=U(),a=t?.id??null;return R({queryKey:["search","discover","friends",a,r],enabled:!!a,staleTime:1e3*60*2,queryFn:async()=>{if(!a)return[];const{data:c,error:u}=await P.rpc("get_home_feed_v2",{p_user_id:a,p_limit:200,p_cursor_created_at:null,p_cursor_id:null});if(u)throw new Error(u.message);const b=(Array.isArray(c)?c:[]).filter(ve).filter(n=>n.user_id!==a&&typeof n.media_item_id=="string"&&n.media_item_id),o=new Map;for(const n of b){const x=n.media_item_id??"";if(!x)continue;const p=je(n.actor_profile),f=p.id||n.user_id,y=o.get(x)??{row:n,users:new Map,watched:0,watchlist:0,rated:0};new Date(n.created_at).getTime()>new Date(y.row.created_at).getTime()&&(y.row=n),f&&y.users.set(f,p.avatarUrl??null),n.event_type==="watched"&&(y.watched+=1),n.event_type==="watchlist_added"&&(y.watchlist+=1),n.event_type==="rating_created"&&(y.rated+=1),o.set(x,y)}return Array.from(o.values()).map(n=>{const x=n.users.size,p=be(n.row,null);if(!p)return null;const f=Array.from(n.users.values()).filter(y=>typeof y=="string"&&y.trim().length>0);return p.friendAvatarUrls=f.slice(0,3),p.friendExtraCount=Math.max(0,x-3),n.watched>0?p.subtitle=`${n.watched} friend${n.watched===1?"":"s"} watched`:n.watchlist>0?p.subtitle=`${n.watchlist} friend${n.watchlist===1?"":"s"} added to watchlist`:n.rated>0?p.subtitle=`${n.rated} friend${n.rated===1?"":"s"} rated`:p.subtitle=`${x} friend${x===1?"":"s"} active`,{poster:p,total:x}}).filter(n=>!!n).sort((n,x)=>x.total-n.total).slice(0,r).map(n=>n.poster)}})}function Ne(r=8){const{user:t}=U(),a=!!t?.id;return R({queryKey:["search","discover","curated_lists",r],enabled:a,staleTime:1e3*60*10,queryFn:async()=>{const{data:d,error:c}=await P.from("lists").select("id, name, description, user_id, updated_at").eq("is_public",!0).order("updated_at",{ascending:!1}).limit(r);if(c)throw new Error(c.message);const u=d??[],v=u.map(s=>s.id),b=Array.from(new Set(u.map(s=>s.user_id))),[{data:o,error:g},{data:n,error:x}]=await Promise.all([P.from("profiles_public").select("id, username, display_name, avatar_url").in("id",b),P.from("list_items").select(`list_id, title_id, position,
               media_items: title_id (
                 id,
                 omdb_poster,
                 tmdb_poster_path,
                 tmdb_backdrop_path,
                 tmdb_title,
                 tmdb_name,
                 tmdb_release_date,
                 tmdb_first_air_date,
                 tmdb_original_language,
                 kind,
                 omdb_imdb_rating,
                 omdb_rating_rotten_tomatoes
               )`).in("list_id",v).order("position",{ascending:!0}).limit(r*6)]);if(g)throw new Error(g.message);if(x)throw new Error(x.message);const p=new Map;for(const s of o??[])p.set(s.id,s);const f=new Map;for(const s of n??[]){const i=s.list_id;!i||f.has(i)||f.set(i,s)}return u.map(s=>{const i=p.get(s.user_id)??null,j=(i?.display_name?.toString().trim()||i?.username?.toString().trim())??"Someone",m=f.get(s.id)?.media_items??null,_=m?q(m):null,A=_?.posterUrl??_?.backdropUrl??null;return{id:s.id,name:s.name,description:s.description,owner:{id:s.user_id,displayName:j,avatarUrl:i?.avatar_url?String(i.avatar_url):null},coverUrl:A}})}})}function _e(){return z.useMemo(()=>[{key:"action",label:"Action",tmdbGenreId:28},{key:"drama",label:"Drama",tmdbGenreId:18},{key:"horror",label:"Horror",tmdbGenreId:27},{key:"sci-fi",label:"Sci‑Fi",tmdbGenreId:878},{key:"comedy",label:"Comedy",tmdbGenreId:35},{key:"documentary",label:"Docu",tmdbGenreId:99}],[])}const F=({label:r,active:t,onClick:a})=>e.jsx("button",{type:"button",onClick:a,className:`flex h-9 shrink-0 items-center justify-center rounded-2xl px-5 text-sm font-medium transition-transform active:scale-95 ${t?"bg-primary text-primary-foreground":"bg-muted/70 text-foreground hover:bg-muted"}`,children:r}),M=({title:r,actionLabel:t,onAction:a})=>e.jsxs("div",{className:"flex items-center justify-between px-4 pb-4",children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight tracking-tight",children:r}),t&&a?e.jsx("button",{type:"button",onClick:a,className:"text-sm font-medium text-primary hover:text-primary/80",children:t}):null]}),ke=({label:r})=>r?e.jsxs("div",{className:"absolute right-2 top-2 inline-flex items-center gap-1 rounded-full bg-black/60 px-2 py-0.5 text-xs font-bold text-white backdrop-blur-sm",children:[e.jsx(L,{name:"star",filled:!0,className:"text-[14px] text-yellow-400",ariaLabel:"Rating"}),e.jsx("span",{children:r})]}):null,E=({id:r,title:t,imageUrl:a,ratingLabel:d,subtitle:c,friendAvatarUrls:u,friendExtraCount:v})=>{const b=(u??[]).map((o,g)=>({id:`${r}_${g}`,username:null,display_name:null,avatar_url:o}));if(v&&v>0)for(let o=0;o<v;o+=1)b.push({id:`${r}_placeholder_${o}`,username:null,display_name:null,avatar_url:null});return e.jsxs(T,{to:`/title/${r}`,className:"group flex flex-col gap-2",children:[e.jsxs("div",{className:"relative aspect-[2/3] w-full overflow-hidden rounded-[20px] bg-muted shadow-lg transition-transform duration-300 group-hover:scale-[1.02]",style:a?{backgroundImage:`url(${a})`,backgroundSize:"cover",backgroundPosition:"center"}:void 0,children:[a?null:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/25 via-background/10 to-primary/40"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/45 via-transparent to-transparent"}),e.jsx(ke,{label:d}),b.length?e.jsx("div",{className:"absolute bottom-2 left-2",children:e.jsx(de,{profiles:b,max:3,size:32})}):null]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-base font-medium leading-tight",children:t}),c?e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs font-semibold text-muted-foreground",children:[e.jsx(L,{name:"group_add",className:"text-[14px]",ariaLabel:"Activity"}),e.jsx("span",{className:"truncate",children:c})]}):null]})]})},Se=({id:r,name:t,description:a,coverUrl:d,ownerLabel:c,ownerAvatarUrl:u})=>e.jsxs(T,{to:`/lists/${r}`,className:"flex items-center gap-3 rounded-3xl border border-border bg-card/70 p-3 shadow-sm transition-colors hover:bg-card",children:[e.jsx("div",{className:"h-16 w-14 overflow-hidden rounded-2xl bg-muted",children:d?e.jsx("img",{src:d,alt:t,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"h-full w-full bg-gradient-to-br from-primary/25 via-muted to-primary/30"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:t}),e.jsx("p",{className:"mt-0.5 line-clamp-1 text-xs text-muted-foreground",children:a||"Curated collection"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 overflow-hidden rounded-full bg-muted",children:u?e.jsx("img",{src:u,alt:c,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"h-full w-full bg-primary/20"})}),e.jsx("p",{className:"truncate text-xs font-medium text-muted-foreground",children:c})]})]}),e.jsx(L,{name:"chevron_right",className:"text-[22px] text-muted-foreground",ariaLabel:"Open"})]}),Ce=({person:r})=>{const t=r.displayName??r.username??"Unknown",a=r.username?`@${r.username}`:null;return e.jsxs(T,{to:r.username?`/u/${r.username}`:`/u/${r.id}`,className:"flex items-center gap-3 rounded-2xl border border-border bg-card/70 px-3 py-2 hover:bg-card",children:[e.jsx("div",{className:"h-9 w-9 overflow-hidden rounded-full bg-muted",children:r.avatarUrl?e.jsx("img",{src:r.avatarUrl,alt:t,className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"grid h-full w-full place-items-center text-xs font-semibold text-foreground",children:t[0]?.toUpperCase()??"?"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:t}),a?e.jsx("p",{className:"truncate text-xs text-muted-foreground",children:a}):null]}),e.jsx(L,{name:"chevron_right",className:"text-[22px] text-muted-foreground",ariaLabel:"Open"})]})};function Fe(r,t){return r==="news"?"news":r==="people"?"people":t.type==="movie"?"movies":t.type==="series"?"series":"all"}function Pe(r){return r==="news"?{tab:"news"}:r==="people"?{tab:"people"}:r==="movies"?{tab:"titles",nextFilters:{type:"movie"}}:r==="series"?{tab:"titles",nextFilters:{type:"series"}}:{tab:"all",nextFilters:{type:"all"}}}const Qe=()=>{const r=Y(),{user:t}=U(),[a,d]=re(),c=(a.get("q")??"").toString(),u=c.trim(),v=pe(a),b=he(a),o=Fe(v,b),g=k.useCallback(l=>{const{tab:h,nextFilters:N}=Pe(l);d(W=>{const S=new URLSearchParams(W);return S.set("tab",h),h==="people"||h==="news"?(S.delete("type"),S.delete("minYear"),S.delete("maxYear"),S.delete("lang")):N?.type&&S.set("type",N.type),S})},[d]),n=k.useCallback(l=>{d(h=>{const N=new URLSearchParams(h);return l.trim()?N.set("q",l):N.delete("q"),!l.trim()&&!N.get("tab")&&N.set("tab","all"),N})},[d]),x=_e(),p=ye(10),f=we(8),y=Ne(6),s=D({query:u,filters:b}),i=B(u.replace(/^@+/,"")),j=u.length===0&&o!=="news",w=o==="news",m=k.useCallback(()=>{!u||o==="news"||g(o==="people"?"all":o)},[o,g,u]),_=k.useCallback(()=>{n("")},[n]),A=k.useCallback(()=>{r("/swipe?mode=trending")},[r]),O=k.useCallback(()=>{r("/activity")},[r]);return e.jsxs("div",{className:"relative flex min-h-screen w-full flex-col overflow-x-hidden bg-background pb-24 text-foreground",children:[e.jsx("div",{className:"h-12 w-full"}),e.jsx("div",{className:"sticky top-0 z-30 bg-background/95 px-4 pb-2 pt-2 backdrop-blur-md",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("label",{className:"flex h-12 w-full items-center gap-3 rounded-2xl border border-input bg-card px-4 shadow-sm focus-within:ring-2 focus-within:ring-primary",children:[e.jsx(L,{name:"search",className:"text-[20px] text-muted-foreground",ariaLabel:"Search"}),e.jsx("input",{value:c,onChange:l=>n(l.target.value),placeholder:"Search movies, shows, people...",className:"h-full flex-1 bg-transparent text-base text-foreground outline-none placeholder:text-muted-foreground",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1}),c?e.jsx("button",{type:"button",onClick:_,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground","aria-label":"Clear search",children:e.jsx(ce,{className:"h-4 w-4"})}):null,e.jsx("button",{type:"button",onClick:m,disabled:!u||o==="people"||o==="news",className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-muted-foreground transition-colors hover:bg-muted/50 hover:text-foreground disabled:opacity-40","aria-label":"Filters",children:e.jsx(I,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:[e.jsx(F,{label:"All",active:o==="all",onClick:()=>g("all")}),e.jsx(F,{label:"Movies",active:o==="movies",onClick:()=>g("movies")}),e.jsx(F,{label:"Series",active:o==="series",onClick:()=>g("series")}),e.jsx(F,{label:"People",active:o==="people",onClick:()=>g("people")}),e.jsx(F,{label:"News",active:o==="news",onClick:()=>g("news")})]})]})}),w?e.jsx("div",{className:"px-4 pt-8",children:e.jsx("div",{className:"rounded-3xl border border-dashed border-border bg-card/50 p-6 text-center text-sm text-muted-foreground",children:"Movie news is on the way. Check back soon for fresh industry updates."})}):j?e.jsxs("div",{className:"flex flex-col pt-6",children:[e.jsx(M,{title:"Friends Are Watching",actionLabel:"See All",onAction:O}),e.jsx("div",{className:"grid grid-cols-2 gap-4 px-4",children:f.isLoading?Array.from({length:4}).map((l,h)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"aspect-[2/3] w-full animate-pulse rounded-[20px] bg-muted"}),e.jsx("div",{className:"h-4 w-3/4 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-muted"})]},h)):f.data?.length?f.data.map(l=>e.jsx(E,{...l},l.id)):e.jsx("div",{className:"col-span-2 rounded-3xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:t?.id?"Your friends’ activity will show up here once they start rating, watching, or adding to watchlists.":"Sign in to see what your friends are watching."})}),e.jsxs("div",{className:"flex flex-col pt-8",children:[e.jsx(M,{title:"Trending Now",actionLabel:"See All",onAction:A}),e.jsx("div",{className:"flex gap-4 overflow-x-auto px-4 pb-2 [scrollbar-width:none] [&::-webkit-scrollbar]:hidden",children:p.isLoading?Array.from({length:6}).map((l,h)=>e.jsxs("div",{className:"w-36 shrink-0",children:[e.jsx("div",{className:"aspect-[2/3] w-full animate-pulse rounded-[20px] bg-muted"}),e.jsx("div",{className:"mt-2 h-4 w-3/4 animate-pulse rounded bg-muted"})]},h)):(p.data??[]).map(l=>e.jsx("div",{className:"w-36 shrink-0",children:e.jsx(E,{...l,friendAvatarUrls:[],friendExtraCount:0})},l.id))})]}),e.jsxs("div",{className:"flex flex-col pt-8",children:[e.jsx(M,{title:"Curated by Experts & Friends"}),e.jsx("div",{className:"flex flex-col gap-3 px-4",children:y.isLoading?Array.from({length:3}).map((l,h)=>e.jsx("div",{className:"h-20 animate-pulse rounded-3xl bg-muted"},h)):y.data?.length?y.data.map(l=>e.jsx(Se,{id:l.id,name:l.name,description:l.description,coverUrl:l.coverUrl,ownerLabel:`by ${l.owner.displayName}`,ownerAvatarUrl:l.owner.avatarUrl},l.id)):e.jsx("div",{className:"rounded-3xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:"Public lists will appear here once you or your friends publish them."})})]}),e.jsxs("div",{className:"flex flex-col pt-8",children:[e.jsx(M,{title:"Browse by Category"}),e.jsx("div",{className:"grid grid-cols-3 gap-3 px-4",children:x.map(l=>e.jsx("button",{type:"button",onClick:()=>{d(h=>{const N=new URLSearchParams(h);return N.set("tab","titles"),N.set("genre",String(l.tmdbGenreId)),N})},className:"flex h-20 items-center justify-center rounded-3xl border border-border bg-card/70 text-sm font-semibold text-foreground shadow-sm transition-colors hover:bg-card",children:l.label},l.key))})]})]}):e.jsx("div",{className:"px-4 pt-4",children:o==="people"?e.jsx(xe,{query:u}):o==="all"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Titles"}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>g("movies"),className:"h-8 rounded-full",children:"Movies"})]}),s.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:6}).map((l,h)=>e.jsx("div",{className:"h-16 animate-pulse rounded-2xl bg-muted"},h))}):e.jsxs("div",{className:"space-y-2",children:[(s.data?.pages.flatMap(l=>l.results)??[]).slice(0,8).map(l=>e.jsx(Q,{item:l},l.id)),(s.data?.pages.flatMap(l=>l.results)??[]).length>8?e.jsx(C,{variant:"secondary",className:"w-full rounded-2xl",onClick:()=>g("movies"),children:"View more titles"}):null]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"People"}),e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>g("people"),className:"h-8 rounded-full",children:"View all"})]}),i.isLoading?e.jsx("div",{className:"space-y-2",children:Array.from({length:4}).map((l,h)=>e.jsx("div",{className:"h-14 animate-pulse rounded-2xl bg-muted"},h))}):i.data?.length?e.jsx("div",{className:"space-y-2",children:i.data.slice(0,6).map(l=>e.jsx(Ce,{person:l},l.id))}):e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-card/50 p-4 text-sm text-muted-foreground",children:"No matching people."})]})]}):e.jsx(me,{query:u,filters:b,onResetFilters:()=>{d(l=>{const h=new URLSearchParams(l);return h.delete("minYear"),h.delete("maxYear"),h.delete("lang"),h.set("type","all"),h})}})})]})};export{Qe as default};
