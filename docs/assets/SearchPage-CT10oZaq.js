import{c as P,r as w,j as e,m as K,n as O,t as Z,s as M,o as J,p as X,R as U,B as C,L as H,h as W,i as ee,u as te,M as re,v as ae,w as se}from"./index-BJNwabbL.js";import{C as ne}from"./Chip-CNb4YVPA.js";import{T as oe,a as le,b as z}from"./Tabs-DotftVeM.js";import{S as ie}from"./SearchField-BWmSy5K6.js";import{P as de}from"./PageChrome-DjRybs36.js";import{T as ce}from"./TopBar-Cwkp26YK.js";import{Y as ue}from"./index-CYeLqM6J.js";import{F as V}from"./film-TltTMGlh.js";import{S as me}from"./star-eAeRTQdR.js";import{u as xe,U as fe,a as pe}from"./useToggleFollow-Cz6IeGKv.js";import{U as ge}from"./users-CZPPKxh2.js";import{U as he}from"./user-Bd-35vPz.js";import"./index-DPjqayor.js";import"./useMutation-CiYMdxMt.js";const be=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],D=P("funnel",be);const ye=[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]],ve=P("languages",ye);const we=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],q=P("sliders-horizontal",we);const je=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],B=P("x",je),L=w.forwardRef(({className:a,type:r,...u},n)=>e.jsx("input",{type:r,className:K("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:n,...u}));L.displayName="Input";const Ne=(a,r)=>{const[u,n]=w.useState(a);return w.useEffect(()=>{const d=window.setTimeout(()=>{n(a)},r);return()=>{window.clearTimeout(d)}},[a,r]),u},_e=["all","movie","series","anime"],Q=a=>a.get("tab")==="people"?"people":"titles",R=a=>{if(typeof a!="number")return;const r=new Date().getFullYear();return Math.min(Math.max(a,1900),r)},ke=a=>{const r=a.get("type"),u=_e.includes(r)?r:"all",n=m=>{if(!m)return;const b=Number(m);return Number.isFinite(b)?b:void 0},d=R(n(a.get("minYear"))),x=R(n(a.get("maxYear"))),c=a.get("lang")||void 0;return d&&x&&d>x?{type:u,minYear:x,maxYear:d,originalLanguage:c}:{type:u,minYear:d,maxYear:x,originalLanguage:c}},$=a=>{if(a?.aborted)throw a.reason??new DOMException("Aborted","AbortError")};async function Se(a,r){const u=a.map(async n=>{if(n.imdbId||!n.tmdbId)return n;$(r);try{const d=await O(`/${n.type==="tv"?"tv":"movie"}/${n.tmdbId}/external_ids`,{},r);return $(r),{...n,imdbId:d?.imdb_id??null}}catch(d){return console.warn("[externalMovieSearch] Failed to fetch external ids for",n.tmdbId,d),n}});return Promise.all(u)}async function Ce(a,r=1,u){const n=a.trim();if(!n)return{results:[],hasMore:!1};$(u);const d=await O("/search/multi",{query:n,include_adult:!1,page:r},u);$(u);const x=Array.isArray(d?.results)?d.results:[];if(!x.length)return{results:[],hasMore:!1};const c=typeof d?.total_pages=="number"?d.total_pages:1,m=x.filter(f=>!!(f&&typeof f.id=="number"&&(f.media_type==="movie"||f.media_type==="tv"))).slice(0,20).map(f=>{const g=f.media_type==="tv"?"tv":"movie",h=f.release_date??f.first_air_date??null,v=h?Number(String(h).slice(0,4)):null;return{tmdbId:Number(f.id),imdbId:f.imdb_id??null,title:f.title??f.name??"Untitled",year:Number.isNaN(v)?null:v,type:g,posterUrl:Z(f.poster_path??null)}});return{results:await Se(m,u),hasMore:r<c}}const T=a=>{if(a?.aborted)throw a.reason??new DOMException("Aborted","AbortError")},Ie=a=>{const r=J(a);return{id:r.id,title:r.title,year:r.year,type:r.type,source:"library",posterUrl:r.posterUrl??r.backdropUrl,originalLanguage:r.originalLanguage,ageRating:r.ageRating,imdbRating:r.imdbRating,rtTomatoMeter:r.rtTomatoMeter,imdbId:r.imdbId,tmdbId:r.tmdbId}},A=20,Me=5,Fe=async(a,r,u,n)=>{T(n);const d=`
    id,
    kind,
    tmdb_id,
    tmdb_title,
    tmdb_name,
    tmdb_original_title,
    tmdb_original_name,
    tmdb_release_date,
    tmdb_first_air_date,
    tmdb_poster_path,
    tmdb_backdrop_path,
    tmdb_original_language,
    tmdb_genre_ids,
    omdb_title,
    omdb_year,
    omdb_language,
    omdb_imdb_id,
    omdb_imdb_rating,
    omdb_rating_rotten_tomatoes,
    omdb_poster,
    omdb_rated
  `,x=(u-1)*A;let c=M.from("media_items").select(d,{count:"exact"});if(c=c.range(x,x+A-1),n&&(c=c.abortSignal(n)),a){const p=`%${a}%`;c=c.or(`tmdb_title.ilike.${p},tmdb_name.ilike.${p},omdb_title.ilike.${p}`)}if(r?.type&&r.type!=="all"&&(c=c.eq("kind",r.type==="series"?"series":r.type)),r?.genreIds?.length&&(c=c.overlaps("tmdb_genre_ids",r.genreIds)),typeof r?.minYear=="number"){const p=`${r.minYear}-01-01`;c=c.or(`tmdb_release_date.gte.${p},tmdb_first_air_date.gte.${p}`)}if(typeof r?.maxYear=="number"){const p=`${r.maxYear}-12-31`;c=c.or(`tmdb_release_date.lte.${p},tmdb_first_air_date.lte.${p}`)}r?.originalLanguage&&(c=c.eq("tmdb_original_language",r.originalLanguage)),c=c.order("tmdb_release_date",{ascending:!1,nullsLast:!0}).order("tmdb_first_air_date",{ascending:!1,nullsLast:!0}).order("tmdb_title",{ascending:!0,nullsLast:!1});const{data:m,error:b,count:f}=await c;if(b)throw new Error(b.message);T(n);const g=m??[],h=typeof f=="number"?f:void 0,v=h?x+g.length<h:g.length===A;return{results:g.map(Ie),hasMore:v}},Te=async a=>{const{query:r,filters:u,page:n=1,signal:d}=a,x=r.trim();T(d);let c=[],m=!1;try{const{results:t,hasMore:i}=await Fe(x,u,n,d);c=t,m=i}catch(t){console.warn("[search.service] Supabase search failed, falling back to TMDb",t)}const{results:b,hasMore:f}=await Ce(x,n,d);if(T(d),!b.length&&c.length>0)return{results:c,hasMore:m};const g=new Set,h=new Set;for(const t of c)t.tmdbId&&g.add(t.tmdbId),t.imdbId&&h.add(t.imdbId);const v=b.filter(t=>!(t.tmdbId&&g.has(t.tmdbId)||t.imdbId&&h.has(t.imdbId))),p=new Map;if(v.length)try{const{data:t,error:i}=await M.from("media_items").upsert(v.slice(0,Me).map(s=>({tmdb_id:s.tmdbId,omdb_imdb_id:s.imdbId??null,kind:s.type==="tv"?"series":"movie",tmdb_title:s.title,tmdb_release_date:s.year?`${s.year}-01-01`:null})),{onConflict:"tmdb_id"}).select("id, tmdb_id");i&&console.warn("[search.service] Failed to upsert media_items",i.message),(t??[]).forEach(s=>{s.tmdb_id!=null&&s.id&&p.set(Number(s.tmdb_id),s.id)})}catch(t){console.warn("[search.service] media_items upsert failed",t)}const k=await Promise.all(v.map(async t=>{T(d);const i=t.type==="tv"?"series":"movie",s=t.tmdbId&&p.get(t.tmdbId)?p.get(t.tmdbId):`tmdb-${t.tmdbId??Math.random()}`,_=!s.startsWith("tmdb-");return t.tmdbId&&g.add(t.tmdbId),t.imdbId&&h.add(t.imdbId),{id:s,title:t.title,year:t.year??null,type:i,source:_?"external-synced":"external-only",posterUrl:t.posterUrl,originalLanguage:null,ageRating:null,imdbRating:null,rtTomatoMeter:null,imdbId:t.imdbId??null,tmdbId:t.tmdbId}}));return{results:[...c,...k.filter(t=>!!t)],hasMore:m||f}},Ye=a=>{const{query:r,filters:u}=a,n=r.trim();return X({queryKey:["search","titles",{query:n,filters:u}],enabled:n.length>0,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:(d,x)=>d.hasMore?x.length+1:void 0,queryFn:({signal:d,pageParam:x})=>Te({query:n,filters:u,page:x??1,signal:d})})},Le=({item:a})=>{const r=[];a.year&&r.push(String(a.year)),a.type==="movie"&&r.push("Movie"),a.type==="series"&&r.push("Series"),a.type==="anime"&&r.push("Anime"),a.originalLanguage&&r.push(`Language: ${a.originalLanguage}`),a.ageRating&&r.push(a.ageRating),a.imdbRating&&r.push(`IMDb ${a.imdbRating.toFixed(1)}`),a.rtTomatoMeter&&r.push(`RT ${a.rtTomatoMeter}%`);const u={library:"Library","external-synced":"Synced","external-only":"External"},n={library:"bg-primary/10 text-primary border-primary/40","external-synced":"bg-emerald-500/10 text-emerald-400 border-emerald-500/30","external-only":"bg-card text-muted-foreground border-border"};return e.jsx("div",{children:e.jsxs(H,{to:`/title/${a.id}`,className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2 hover:bg-card/80",children:[a.posterUrl?e.jsx("img",{src:a.posterUrl,alt:a.title,className:"h-20 w-14 rounded-2xl object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-20 w-14 items-center justify-center rounded-2xl bg-muted",children:e.jsx(V,{className:"h-5 w-5 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"truncate text-[12px] font-medium text-foreground",children:a.title}),e.jsx("span",{className:`shrink-0 rounded-full border px-2 py-0.5 text-xs font-medium ${n[a.source]}`,children:u[a.source]})]}),r.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:r.join(" • ")})]})]})})},Re=({query:a,filters:r,onResetFilters:u})=>{const n=a.trim(),{data:d,isLoading:x,isError:c,error:m,fetchNextPage:b,hasNextPage:f,isFetchingNextPage:g}=Ye({query:n,filters:r}),h=d?.pages.flatMap(t=>t.results)??[],v=h.length,p=[];if(r.type&&r.type!=="all"){const t={movie:"Movies",series:"Series",anime:"Anime",all:"All"};p.push(t[r.type])}typeof r.minYear=="number"&&p.push(`From ${r.minYear}`),typeof r.maxYear=="number"&&p.push(`Up to ${r.maxYear}`),r.originalLanguage&&p.push(`Language: ${r.originalLanguage==="en"?"English":r.originalLanguage}`);const k=p.length?p.join(" • "):"No filters applied",l=U.useRef(new Set);return U.useEffect(()=>{if(!h||!Array.isArray(h))return;const t=l.current;h.filter(s=>!(t.has(s.id)||!s.imdbId&&!s.tmdbId||s.imdbRating||s.rtTomatoMeter)).slice(0,3).forEach(s=>{t.add(s.id),M.from("media_items").upsert({tmdb_id:s.tmdbId??null,omdb_imdb_id:s.imdbId??null,kind:s.type==="series"?"series":s.type??"movie",tmdb_title:s.title,tmdb_release_date:s.year?`${s.year}-01-01`:null},{onConflict:"tmdb_id"}).catch(_=>{console.warn("[SearchTitlesTab] media_items upsert failed for",s.id,_)})})},[h]),n?x?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["Searching for ",e.jsx("span",{className:"font-semibold text-foreground",children:n}),"…"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fetching matching titles from your catalog and external sources."}),e.jsx("div",{className:"space-y-2",children:[0,1,2].map(t=>e.jsxs("div",{className:"flex gap-3 rounded-2xl border border-border bg-background/60 p-2",children:[e.jsx("div",{className:"h-16 w-11 animate-pulse rounded-xl bg-card/60"}),e.jsxs("div",{className:"flex flex-1 flex-col justify-center space-y-1.5",children:[e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-card/60"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-card/40"})]})]},t))})]}):c?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-destructive",children:"Something went wrong while searching for titles."}),m&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Details: "}),m.message]})]}):v?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-semibold text-foreground",children:v})," result",v===1?"":"s"," across your catalog and external sources for"," ",e.jsx("span",{className:"font-semibold text-foreground",children:n}),"."]}),e.jsxs(C,{type:"button",variant:"outline",size:"sm",className:"h-auto rounded-full border-border px-2 py-1 text-muted-foreground hover:border-border hover:text-foreground",onClick:u,children:[e.jsx(q,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Reset filters"})]})]}),e.jsx("div",{className:"rounded-2xl border border-border bg-background/60 p-3",children:e.jsxs("p",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-muted text-xs font-medium text-muted-foreground",children:e.jsx(q,{className:"h-3 w-3","aria-hidden":"true"})}),e.jsx("span",{className:"truncate",children:k})]})}),e.jsx(ue,{style:{height:"70vh"},data:h,endReached:()=>{f&&!g&&b()},components:{List:U.forwardRef(function(i,s){return e.jsx("div",{ref:s,className:"space-y-2",...i})}),Footer:()=>f?e.jsx("div",{className:"flex justify-center py-3",children:e.jsx(C,{type:"button",className:"inline-flex items-center justify-center rounded-full bg-primary/90 disabled:cursor-not-allowed disabled:opacity-70",onClick:()=>b(),disabled:g,children:g?"Loading more…":"Load more results"})}):null},itemContent:(t,i)=>e.jsx(Le,{item:i})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No titles found matching"," ",e.jsx("span",{className:"font-semibold text-foreground",children:n}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Try adjusting your search or removing some filters to see more results."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a title, director, or genre to search the catalog. As you wire Supabase search, results will appear here."}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"text-xs font-medium text-foreground",children:"Try searching for"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-xs",children:["Sci-fi romance","Feel-good comedies","Films from 2020s","Cozy rainy-day movies"].map(t=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-border px-2 py-1 text-muted-foreground",children:[e.jsx(V,{className:"mr-1 h-3 w-3 text-muted-foreground","aria-hidden":"true"}),t]},t))})]}),e.jsxs("div",{className:"space-y-1.5 rounded-2xl border border-border bg-background/60 p-3",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs font-medium text-foreground",children:[e.jsx(me,{className:"h-3.5 w-3.5 text-primary","aria-hidden":"true"}),e.jsx("span",{children:"Trending this week"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Once analytics are wired up, you can show what your friends and the community are watching the most here."})]})]})},Y=a=>{if(a?.aborted)throw a.reason??new DOMException("Aborted","AbortError")},$e=a=>{const u=a.trim().replace(/^@+/,""),n=u.toLowerCase(),{user:d}=W();return ee({queryKey:["search","people",{query:u,userId:d?.id??null}],enabled:u.length>0,staleTime:1e3*60*15,gcTime:1e3*60*30,queryFn:async({signal:x})=>{Y(x);const c=u.replace(/%/g,"\\%").replace(/_/g,"\\_");let m=M.from("profiles").select("id, username, display_name, avatar_url, bio").or(`username.ilike.%${c}%,display_name.ilike.%${c}%`).limit(20);d?.id&&(m=m.neq("id",d.id)),x&&(m=m.abortSignal(x));const b=await m;if(Y(x),b.error)throw new Error(b.error.message);const f=b.data??[],g=f.map(t=>t.id);let h=new Map;if(g.length){let t=M.from("user_stats").select("user_id, followers_count, following_count").in("user_id",g);x&&(t=t.abortSignal(x));const i=await t;Y(x),i.error?console.warn("[useSearchPeople] Failed to load user_stats",i.error.message):h=new Map((i.data??[]).map(s=>[s.user_id,{followersCount:s.followers_count??0,followingCount:s.following_count??0}]))}if(!d?.id)return f.map(t=>{const i=h.get(t.id);return{id:t.id,username:t.username,displayName:t.display_name,avatarUrl:t.avatar_url,bio:t.bio,followersCount:i?.followersCount??null,followingCount:i?.followingCount??null,isFollowing:!1}});let v=M.from("follows").select("followed_id").eq("follower_id",d.id);x&&(v=v.abortSignal(x));const p=await v;Y(x),p.error&&console.warn("[useSearchPeople] Failed to load follows for current user",p.error.message);const k=new Set((p.data??[]).map(t=>t.followed_id));return f.map(t=>{const i=h.get(t.id),s=t.username??"",_=t.display_name??"",S=s.toLowerCase(),F=_.toLowerCase();let I=0;S===n?I+=100:S.startsWith(n)?I+=80:F.startsWith(n)?I+=60:S.includes(n)?I+=40:F.includes(n)&&(I+=30);const o=Math.min(15,Math.floor((i?.followersCount??0)/500));return{id:t.id,username:t.username,displayName:t.display_name,avatarUrl:t.avatar_url,bio:t.bio,followersCount:i?.followersCount??null,followingCount:i?.followingCount??null,isFollowing:k.has(t.id),relevance:I+o}}).sort((t,i)=>{if(i.relevance!==t.relevance)return i.relevance-t.relevance;const s=(t.displayName??t.username??"").toLowerCase(),_=(i.displayName??i.username??"").toLowerCase();return s.localeCompare(_)}).map(({relevance:t,...i})=>i)}})},Pe=({query:a})=>{const r=a.trim(),u=r.replace(/^@+/,""),n=u||r,{data:d,isLoading:x,isError:c,error:m}=$e(u),b=xe(),f=te(),{user:g}=W(),[h,v]=w.useState(null),p=d??[],k=async l=>{if(!g?.id){alert("You need to be signed in to start a conversation.");return}if(g.id===l){alert("You can't start a conversation with yourself.");return}v(l);try{const t=await ae("create-direct-conversation",{targetUserId:l},{timeoutMs:25e3});if(!t?.ok||!t.conversationId){const i=t?.errorCode;let s=t?.error??"Failed to get conversation id. Please try again.";i==="UNAUTHORIZED"?s="You need to be signed in to start a conversation.":i==="BAD_REQUEST_SELF_TARGET"?s="You can't start a conversation with yourself.":i==="SERVER_MISCONFIGURED"&&(s="Messaging is temporarily unavailable due to a server issue. Please try again later.");const _=new Error(s);throw _.code=i,_}f(`/messages/${t.conversationId}`)}catch(t){console.error("[SearchPeopleTab] Failed to start conversation",t);const i=t instanceof Error?t.message:"Something went wrong while starting the conversation. Please try again.";alert(i)}finally{v(null)}};return u?x?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Searching for people…"}),e.jsx("div",{className:"rounded-2xl border border-border bg-card/80 px-3 py-4 text-xs text-muted-foreground",children:"We'll show matching profiles here as soon as the results come back."})]}):c?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-foreground",children:"Something went wrong."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:m?.message??"We couldn&apos;t search for people right now. Please try again."})]}):!p||p.length===0?e.jsx("div",{className:"space-y-3",children:e.jsxs("p",{className:"text-[12px] text-muted-foreground",children:["No people found for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",n,"”"]}),". Try a different name or username."]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Showing ",p.length," profile",p.length===1?"":"s"," for"," ",e.jsxs("span",{className:"rounded border border-border bg-card px-1.5 py-0.5 text-xs font-medium text-foreground",children:["“",n,"”"]})]})}),e.jsx("ul",{className:"divide-y divide-border/60 rounded-2xl border border-border bg-card/80",children:p.map(l=>{const t=l.displayName??l.username??"Unknown user",i=l.username?`@${l.username}`:null,s=b.isPending&&b.variables?.targetUserId===l.id;return e.jsxs("li",{className:"flex items-center justify-between gap-3 px-3 py-2 hover:bg-card/80",children:[e.jsxs(H,{to:l.username?`/u/${l.username}`:`/u/${l.id}`,className:"flex min-w-0 flex-1 items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-card/80 text-[14px] font-semibold text-foreground",children:l.avatarUrl?e.jsx("img",{src:l.avatarUrl,alt:t,className:"h-8 w-8 rounded-full object-cover",loading:"lazy"}):t?t[0]?.toUpperCase():e.jsx(he,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",children:t}),i&&e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:i}),l.bio&&e.jsx("p",{className:"mt-0.5 line-clamp-2 text-xs text-muted-foreground",children:l.bio}),(typeof l.followersCount=="number"||typeof l.followingCount=="number")&&e.jsxs("p",{className:"mt-0.5 text-xs text-muted-foreground",children:[typeof l.followersCount=="number"&&e.jsxs("span",{children:[l.followersCount," follower",l.followersCount===1?"":"s"]}),typeof l.followersCount=="number"&&typeof l.followingCount=="number"&&e.jsx("span",{children:" · "}),typeof l.followingCount=="number"&&e.jsxs("span",{children:["following ",l.followingCount]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{type:"button",onClick:()=>b.mutate({targetUserId:l.id,currentlyFollowing:l.isFollowing}),disabled:s,variant:l.isFollowing?"outline":"default",size:"sm",className:`h-auto rounded-full px-2.5 py-1.5 text-xs font-medium ${l.isFollowing?"border-border bg-card/80 text-foreground hover:border-primary/70 hover:text-foreground disabled:opacity-60":"border border-transparent bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-60"}`,children:s?e.jsx("span",{children:"Updating…"}):l.isFollowing?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Follow"})]})}),g?.id!==l.id&&e.jsx(C,{type:"button",onClick:()=>k(l.id),disabled:h===l.id,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-card/80 px-2.5 py-1.5 text-xs font-medium text-foreground shadow-md hover:border-primary/70 hover:text-foreground disabled:cursor-not-allowed disabled:opacity-60",children:h===l.id?e.jsx("span",{children:"Starting…"}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3","aria-hidden":"true"}),e.jsx("span",{children:"Message"})]})})]})]},l.id)})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-[12px] text-muted-foreground",children:"Start typing a name or @username to find people. Once the social graph is wired up, you'll be able to follow friends and start conversations from here."}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-2 text-xs text-muted-foreground",children:[e.jsx(ge,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:"Search for people you know, then follow or message them."})]})]})},Ze=()=>{const[a,r]=se(),u=w.useMemo(()=>Q(a),[a]),n=a.get("q")??"",[d,x]=w.useState(n),c=Ne(d,300),m=w.useMemo(()=>ke(a),[a]),[b,f]=w.useState(!1),g=w.useCallback(o=>{const y=new URLSearchParams(a);o(y),r(y,{replace:!0})},[a,r]),h=w.useCallback(o=>{o.delete("type"),o.delete("minYear"),o.delete("maxYear"),o.delete("lang")},[]),v=w.useCallback(o=>{const y=o;g(j=>{j.set("tab",y),j.get("q")||h(j)}),y!=="titles"&&f(!1)},[h,g]),p=()=>{x(""),g(o=>{o.delete("q"),h(o)}),f(!1)},k=w.useCallback(o=>{const y=o.trim();g(j=>{const E=Q(j);y?(j.set("q",y),j.set("tab",E)):(j.delete("q"),h(j))}),y||f(!1)},[h,g]);w.useEffect(()=>{k(c)},[c,k]),w.useEffect(()=>{n!==d&&x(n)},[n]);const l=w.useCallback(o=>{g(y=>{const j={...m,...o},E=R(j.minYear),G=R(j.maxYear),N={...j,minYear:E??void 0,maxYear:G??void 0};N.minYear&&N.maxYear&&N.minYear>N.maxYear&&([N.minYear,N.maxYear]=[N.maxYear,N.minYear]),y.set("tab","titles"),y.set("type",N.type??"all"),N.minYear?y.set("minYear",String(N.minYear)):y.delete("minYear"),N.maxYear?y.set("maxYear",String(N.maxYear)):y.delete("maxYear"),N.originalLanguage?y.set("lang",N.originalLanguage):y.delete("lang")})},[m,g]),t=()=>{g(o=>{o.set("tab","titles"),o.set("type","all"),o.delete("minYear"),o.delete("maxYear"),o.delete("lang")}),f(!1)},i=w.useMemo(()=>{const o=[];if(m.type&&m.type!=="all"&&o.push({label:`Type: ${m.type.charAt(0).toUpperCase()}${m.type.slice(1)}`,onRemove:()=>l({type:"all"})}),m.minYear||m.maxYear){const y=m.minYear??"Any",j=m.maxYear??"Now";o.push({label:`Year: ${y} – ${j}`,onRemove:()=>l({minYear:void 0,maxYear:void 0})})}return m.originalLanguage&&o.push({label:`Language: ${m.originalLanguage.toUpperCase()}`,onRemove:()=>l({originalLanguage:void 0})}),o},[m,l]),s=i.length,_=s>0?`Filters (${s} active)`:"Filters (none applied)",S=u==="titles"&&(!!n.trim()||s>0),F=S?_:"Filters are locked until you start typing a title",I=o=>{o.preventDefault()};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-4",children:[e.jsx(ce,{title:"Search without the clutter",subtitle:"Find titles, filmmakers, or friends instantly. Switch tabs to move between movies and people."}),e.jsxs(de,{tone:"default",padded:!0,children:[e.jsxs("form",{onSubmit:I,className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2",children:[e.jsx(ie,{placeholder:"Search for movies, shows, or people...",value:d,onChange:o=>x(o.target.value),autoCorrect:"off",autoCapitalize:"none",className:"flex-1"}),d?e.jsx(C,{type:"button",onClick:p,variant:"ghost",size:"icon",className:"h-7 w-7 rounded-full text-xs text-muted-foreground hover:bg-border/60 hover:text-foreground","aria-label":"Clear search",children:e.jsx(B,{className:"h-3 w-3","aria-hidden":"true"})}):null]}),e.jsxs(C,{type:"button",onClick:()=>{S&&f(o=>!o)},variant:"outline",size:"sm",className:`inline-flex items-center justify-center gap-1 rounded-full px-3 py-2 text-xs font-medium shadow-md ${S?"border-border bg-background text-muted-foreground hover:border-primary/70 hover:text-foreground":"cursor-not-allowed border-border bg-background/70 text-muted-foreground"} ${b?"border-primary/70 text-foreground":""}`,disabled:!S,"aria-pressed":S&&b,"aria-expanded":S&&b,"aria-controls":"search-title-filters","aria-label":F,title:F,children:[e.jsx(q,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:b?"Hide filters":"Filters"}),s>0?e.jsx("span",{className:"inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-primary/15 px-1 text-xs font-semibold text-primary",children:s}):null]})]}),u==="titles"&&e.jsx("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:i.length?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"gap-1 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-muted-foreground",children:"Active filters"}),i.map(o=>e.jsxs(C,{type:"button",onClick:o.onRemove,variant:"outline",size:"sm",className:"h-auto rounded-full border-border bg-background px-2 py-1 text-xs text-foreground shadow-sm hover:border-primary/70 hover:text-foreground",children:[e.jsx("span",{children:o.label}),e.jsx(B,{className:"h-3 w-3 text-muted-foreground","aria-hidden":!0})]},o.label)),e.jsx(C,{type:"button",onClick:t,variant:"ghost",size:"sm",className:"h-auto rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-primary hover:bg-primary/15",children:"Reset all"})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-card/50 px-2.5 py-1 text-xs font-medium text-muted-foreground",children:[e.jsx(D,{className:"h-3 w-3","aria-hidden":!0}),"No filters applied"]})}),u==="titles"&&b&&e.jsxs("div",{id:"search-title-filters",className:"mt-3 space-y-3 rounded-xl border border-dashed border-border bg-background/70 p-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-foreground",children:[e.jsx(D,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Filter titles"})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-[1.4fr_1fr_1fr]",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Type"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:[{key:"all",label:"All"},{key:"movie",label:"Movies"},{key:"series",label:"Series"},{key:"anime",label:"Anime"}].map(o=>{const y=m.type===o.key;return e.jsx(C,{type:"button",variant:y?"default":"outline",size:"sm",className:`h-auto rounded-full px-2.5 py-1 text-xs font-medium ${y?"bg-primary text-primary-foreground shadow-md":"border-border bg-background/80 text-muted-foreground hover:border-primary/60 hover:text-foreground"}`,onClick:()=>l({type:o.key}),"aria-pressed":y,children:o.label},o.key)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Years"}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsx(L,{type:"number",min:1900,max:new Date().getFullYear(),value:m.minYear??"",onChange:o=>l({minYear:o.target.value?Number(o.target.value):void 0}),placeholder:"Min",className:"h-9 w-full border-border bg-background px-2 py-1.5 text-xs text-foreground shadow-sm","aria-label":"Minimum year"}),e.jsx(L,{type:"number",min:1900,max:new Date().getFullYear(),value:m.maxYear??"",onChange:o=>l({maxYear:o.target.value?Number(o.target.value):void 0}),placeholder:"Max",className:"h-9 w-full border-border bg-background px-2 py-1.5 text-xs text-foreground shadow-sm","aria-label":"Maximum year"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use a minimum, maximum, or both."})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground",children:"Original language"}),e.jsxs("div",{className:"flex items-center gap-1.5 rounded-md border border-border bg-background px-2 py-1.5 shadow-sm",children:[e.jsx(ve,{className:"h-3.5 w-3.5 text-muted-foreground","aria-hidden":"true"}),e.jsx(L,{type:"text",value:m.originalLanguage??"",onChange:o=>l({originalLanguage:o.target.value||void 0}),placeholder:"e.g. en, ja",className:"h-8 w-full border-none bg-transparent p-0 text-xs text-foreground shadow-none placeholder:text-muted-foreground focus-visible:ring-0"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Two-letter codes keep things simple."})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx("span",{className:"inline-flex h-1.5 w-1.5 rounded-full bg-primary/80"}),"Filters shape the recommendations shown below."]}),e.jsx(C,{type:"button",variant:"link",size:"sm",className:"h-auto p-0 text-xs font-semibold text-foreground hover:text-primary",onClick:t,children:"Reset filters"})]})]})]}),e.jsxs("section",{className:"flex flex-1 flex-col gap-3",children:[e.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:e.jsx("div",{className:"w-full sm:max-w-lg",children:e.jsx(oe,{value:u,onValueChange:v,children:e.jsxs(le,{className:"w-full",children:[e.jsx(z,{value:"titles",children:"Titles"}),e.jsx(z,{value:"people",children:"People"})]})})})}),e.jsx("div",{"aria-live":"polite",className:"flex-1 rounded-2xl border border-dashed border-border bg-card/60 px-3 py-3 text-[12px] text-muted-foreground",children:u==="titles"?e.jsx(Re,{query:c,filters:m,onResetFilters:t}):e.jsx(Pe,{query:c})})]})]})};export{Ze as default};
