import{c as ae,b as Vt,r as a,g as En,d as $n,f as Dn,e as Ln,h as lt,t as Un,q as ct,i as qn,j as e,B as On,k as Qt,l as Lt,m as Bn,F as Ut,n as Yn,S as Wn,s as qt}from"./index-C0YC7Lqk.js";import{T as zn}from"./TopBar-Cwkp26YK.js";import{u as Zt}from"./useMutation-B6WiSsoN.js";import{u as Xn}from"./dialog-YBnO-OY2.js";import{C as Hn}from"./circle-alert-LlY99HjW.js";import{I as Kn,T as Ot}from"./thumbs-up-CEFPiTdp.js";import{S as ot}from"./sparkles-BsAyD2aC.js";import{C as dt}from"./circle-check-Bfzcbhqs.js";import{S as Gn}from"./star-CUibpuuR.js";import"./index-2QA0ZcLJ.js";import"./users-CdKu7Qpk.js";import"./format-DWLSBLoY.js";const Vn=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]],Qn=ae("image-off",Vn);const Zn=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Jn=ae("link-2",Zn);const er=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],tr=ae("rotate-cw",er);const nr=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Jt=ae("share-2",nr);const rr=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],sr=ae("skip-forward",rr);const ir=[["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}],["path",{d:"M17 14V2",key:"8ymqnk"}]],Bt=ae("thumbs-down",ir),Te=(n,s,o)=>Math.min(o,Math.max(s,n)),P=n=>{if(!n)return null;const s=n.trim();return!s||s.toUpperCase()==="N/A"?null:s},or=n=>{if(!n||n<=0)return null;const s=Math.floor(n/60),o=n%60;return s===0?`${o}m`:o===0?`${s}h`:`${s}h ${o}m`},ar=n=>{const s=P(n);if(!s)return null;const o=s.toLowerCase();return o==="united states"||o==="united states of america"?"US":o==="united kingdom"||o==="great britain"?"UK":o==="canada"?"CA":o==="australia"?"AU":o==="germany"?"DE":o==="france"?"FR":o==="spain"?"ES":o==="italy"?"IT":o==="japan"?"JP":o==="south korea"||o==="republic of korea"?"KR":s.length<=3?s.toUpperCase():s},$=n=>{if(n==null)return null;if(typeof n=="number")return Number.isNaN(n)?null:n;const s=parseFloat(n);return Number.isNaN(s)?null:s},Ae=n=>{const s=$(n);return s==null?null:Math.round(s).toLocaleString()},lr=n=>{switch(n){case"from-friends":return"Friends’ picks";case"trending":return"Trending now";case"popular":return"Popular now";default:return"Matched for you"}},at=n=>{if(!n)return;const s=[];n.year&&s.push(String(n.year));const o=[];typeof n.imdbRating=="number"&&!Number.isNaN(n.imdbRating)&&o.push(`IMDb ${n.imdbRating.toFixed(1)}`),typeof n.rtTomatoMeter=="number"&&!Number.isNaN(n.rtTomatoMeter)&&o.push(`${n.rtTomatoMeter}% Rotten Tomatoes`);const f=[...s,...o].filter(Boolean).join(" · ");return f?`${n.title} (${f})`:n.title},ut="movi_swipe_event_queue_v1";function cr(n){if(!n)return[];try{const s=JSON.parse(n);return Array.isArray(s)?s.filter(Boolean):[]}catch{return[]}}function mt(){return cr(typeof localStorage<"u"?localStorage.getItem(ut):null)}function dr(n){if(typeof localStorage>"u")return;const s=mt();s.push({...n,queuedAt:Date.now()});const o=s.slice(-200);localStorage.setItem(ut,JSON.stringify(o))}function ur(n){if(typeof localStorage>"u"||!n.length)return;const s=new Set(n),o=mt().filter(f=>!f.clientEventId||!s.has(f.clientEventId));localStorage.setItem(ut,JSON.stringify(o))}function mr(n){return"combined"}function fr(n){return n?n==="for_you"?"for-you":n==="friends"?"from-friends":n==="trending"?"trending":n==="popular"?"popular":n==="explore"?"explore":n==="combined"?"combined":null:null}function Yt(n){return n==="like"?"like":n==="dislike"?"dislike":"skip"}function Pe(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():qn()}function xr(n,s){const o=Un(n.tmdbPosterPath??n.tmdbBackdropPath,s??"w342"),f=n.posterUrl??o??null,g=(n.title??"").trim()||"Untitled";return{...n,posterUrl:f,title:g}}function pr(n,s){if(typeof window>"u"||s<=0||navigator.connection?.saveData)return;const g=window.requestIdleCallback??(x=>window.setTimeout(x,300)),y=n.slice(0,s);g(()=>{for(const x of y){if(!x.posterUrl)continue;const I=new Image;I.decoding="async",I.loading="lazy",I.src=x.posterUrl}})}function hr(n,s){const o=s?.limit,f=s?.prefetchImages??6,g=s?.tmdbPosterSize??"w342",y=s?.dwellThresholdMs??1200,x=s?.dwellDebounceMs??8e3,I=s?.invalidateHomeQueries??!1,D=Vt();a.useEffect(()=>{let u=!1;const d=async()=>{if(u)return;const j=mt();if(!j.length)return;const N=[];for(const q of j)try{(await lt(q)).ok&&q.clientEventId&&N.push(q.clientEventId)}catch{break}N.length&&ur(N)};d();const S=()=>void d();return window.addEventListener("online",S),()=>{u=!0,window.removeEventListener("online",S)}},[]);const C=a.useMemo(()=>En(),[]),U=a.useMemo(()=>mr(),[n]),b=a.useRef(new Set),h=a.useRef(!1),k=a.useRef(0),V=a.useRef(null),v=a.useRef(new Set),r=a.useRef(new Map),[_,W]=a.useState({status:"idle",cards:[],errorMessage:null}),[z,we]=a.useState(null),T=a.useCallback(u=>{W(d=>typeof u=="function"?u(d):u)},[]),le=a.useCallback(u=>{if(!u.length)return;const d=b.current,S=[];for(const j of u)d.has(j.id)||(d.add(j.id),S.push(xr(j,g)));S.length&&T(j=>{const N={...j,status:"ready",cards:[...j.cards,...S],errorMessage:null};return pr(S,f),N})},[f,T,g]),X=a.useCallback(async(u=o)=>{if(!h.current){h.current=!0,T(d=>({...d,status:d.cards.length?"ready":"loading",errorMessage:null}));try{const d=s?.seed??$n(C,U,void 0);V.current!==d&&(V.current=d,k.current=0);const S=`${d}:${k.current}`;k.current+=1;const j=await Dn({sessionId:C,mode:U,limit:u,seed:S},{timeoutMs:25e3}),N=j.deckId,q=(j.cards??[]).map((L,ce)=>({...L,id:L.mediaItemId,deckId:N,position:ce,source:fr(L.source??null)}));if(!q.length){T(L=>({...L,status:L.cards.length?"ready":"exhausted",errorMessage:null}));return}le(q)}catch(d){const S=d instanceof Error?d.message:typeof d=="string"?d:"We couldn't load swipe cards.";T(j=>({...j,status:"error",errorMessage:S}))}finally{h.current=!1}}},[le,o,U,s?.seed,C,T]);a.useEffect(()=>{b.current=new Set,v.current=new Set,r.current=new Map,h.current=!1,T({status:"loading",cards:[],errorMessage:null}),X(o)},[X,n,o,T]);const ve=a.useCallback(()=>{s?.seed==null&&Ln(C,U,void 0),k.current=0,b.current=new Set,v.current=new Set,r.current=new Map,h.current=!1,T({status:"loading",cards:[],errorMessage:null}),X(o)},[X,o,U,s?.seed,C,T]),Ee=a.useCallback(u=>{u<=0||T(d=>({...d,cards:d.cards.slice(Math.min(u,d.cards.length))}))},[T]),F=Zt({mutationFn:async u=>lt(u,{timeoutMs:2e4}),onError:(u,d)=>{const S=u instanceof Error?u.message:typeof u=="string"?u:"We couldn't save that action.";dr(d),we({payload:d,message:S})},onSuccess:()=>{we(null),I&&(D.invalidateQueries({queryKey:ct.homeFeed(null)}),D.invalidateQueries({queryKey:ct.homeForYou(null)}))}}),je=a.useCallback((u,d)=>{if(!u)return;const S=`${u.deckId}:${u.id}`;v.current.has(S)||(v.current.add(S),F.mutate({sessionId:C,deckId:u.deckId,position:d??u.position,mediaItemId:u.id,eventType:"impression",source:u.source??null,clientEventId:Pe()}))},[F,C]),Ne=a.useCallback((u,d,S)=>{if(!u||!Number.isFinite(d)||d<y)return;const j=`${u.deckId}:${u.id}`,N=Date.now(),q=r.current.get(j)??0;N-q<x||(r.current.set(j,N),F.mutate({sessionId:C,deckId:u.deckId,position:S??u.position,mediaItemId:u.id,eventType:"dwell",dwellMs:Math.round(d),source:u.source??null,clientEventId:Pe()}))},[x,y,F,C]),$e=a.useCallback(u=>{const d=u.card;F.mutate({sessionId:C,deckId:d.deckId,position:d.position,mediaItemId:d.id,eventType:Yt(u.direction),source:d.source??null,clientEventId:Pe()})},[F,C]),De=a.useCallback(async u=>{const d=u.card;return F.mutateAsync({sessionId:C,deckId:d.deckId,position:d.position,mediaItemId:d.id,eventType:Yt(u.direction),source:d.source??null,clientEventId:Pe()})},[F,C]);return{sessionId:C,mode:U,cards:_.cards,status:_.status,isLoading:_.status==="loading",isError:_.status==="error",isExhausted:_.status==="exhausted",deckError:_.errorMessage??null,fetchMore:X,refresh:ve,trimConsumed:Ee,trackImpression:je,trackDwell:Ne,swipe:$e,swipeAsync:De,swipeSyncError:z?.message??null,retryFailedSwipe:()=>{z&&F.mutate(z.payload)},isRetryingSwipe:F.isPending&&!!z}}const br=({message:n,onRetry:s,isRetrying:o})=>n?e.jsx("div",{className:"mx-3 mb-3 rounded-md border border-amber-500/60 bg-amber-500/10 px-3 py-2 text-xs text-amber-50",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Hn,{className:"mt-0.5 h-3.5 w-3.5 flex-shrink-0","aria-hidden":!0}),e.jsxs("div",{className:"flex flex-1 flex-col gap-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"leading-snug",children:n}),e.jsxs(On,{type:"button",variant:"outline",size:"sm",onClick:s,disabled:o,children:[e.jsx(tr,{className:"h-3.5 w-3.5","aria-hidden":!0}),o?"Retrying…":"Retry"]})]})]})}):null,gr=({card:n,metaLine:s,highlightLabel:o})=>e.jsxs("div",{className:"space-y-2 text-left leading-relaxed","aria-label":"Swipe card summary",children:[e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"min-w-0 space-y-1",children:[e.jsx("h2",{className:"line-clamp-2 text-2xl font-heading font-semibold text-foreground",children:n.title}),s&&e.jsx("p",{className:"truncate text-xs text-muted-foreground/90",children:s}),o&&e.jsx("p",{className:"text-xs font-medium text-primary/90",children:o})]})}),n.tagline&&!n.tagline.trim().startsWith("Plot")&&e.jsx("p",{className:"line-clamp-2 text-xs text-muted-foreground/90",children:n.tagline})]}),Wt=({title:n})=>e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-background via-card to-background text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-card/70 shadow-md",children:e.jsx(Qn,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("span",{className:"text-[12px] font-semibold",children:"Artwork unavailable"}),n&&e.jsxs("span",{className:"max-w-[240px] truncate text-xs text-muted-foreground/80",children:["for ",n]})]})});function yr(n){const s=n.trim().split(/\s+/).filter(Boolean);if(!s.length)return"?";const o=s[0]?.[0]??"?",f=s.length>1?s[s.length-1]?.[0]??"":"";return(o+f).toUpperCase()}function wr({profiles:n,max:s=3,size:o=28}){const f=Array.isArray(n)?n.filter(Boolean):[];if(!f.length)return null;const g=f.slice(0,Math.max(1,s)),y=f.length-g.length;return e.jsx("div",{className:"relative flex items-center",children:e.jsxs("div",{className:"flex -space-x-2",children:[g.map(x=>{const I=(x.display_name??x.username??"").trim(),D=yr(I||"friend");return e.jsx("div",{className:"grid place-items-center overflow-hidden rounded-full border border-background bg-muted text-[11px] font-semibold text-foreground shadow-sm",style:{width:o,height:o},title:I||"Friend","aria-label":I||"Friend",children:x.avatar_url?e.jsx("img",{src:x.avatar_url,alt:I||"Friend avatar",className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("span",{children:D})},x.id)}),y>0&&e.jsxs("div",{className:"grid place-items-center rounded-full border border-background bg-muted text-[11px] font-semibold text-foreground shadow-sm",style:{width:o,height:o},title:`${y} more`,"aria-label":`${y} more`,children:["+",y]})]})})}const Fe="mn_swipe_onboarding_seen",zt=88,Xt=.32,Ht=220,vr=16,jr=360,Kt=14,Gt=32,Nr=n=>{if(n==null)return null;const s=String(n).trim();if(!s)return null;const o=s.replace(/%/g,""),f=Number(o);return Number.isFinite(f)?f:null},kr=n=>{if(n==null)return null;const s=typeof n=="number"?n:Number(String(n).trim());if(!Number.isFinite(s))return null;const o=Math.round(s/2);return o<=0?null:Math.min(5,Math.max(1,o))},_r=n=>{if(n==null)return null;const s=Math.round(n);return s<=0?null:Math.min(10,Math.max(2,s*2))},Sr=n=>{const s=(()=>{const y=String(n?.source??"").trim();if(!y)return null;const x=y.replace("-","_");return x==="for_you"||x==="for-you"?"for-you":x==="friends"||x==="from_friends"||x==="from-friends"?"from-friends":x==="trending"?"trending":x==="popular"?"popular":x==="combined"?"combined":x==="explore"?"explore":null})(),o=n?.kind==="series"?"series":(n?.kind==="movie","movie"),f=typeof n?.releaseYear=="number"?n.releaseYear:n?.releaseYear!=null?Number(n.releaseYear):null,g=typeof n?.runtimeMinutes=="number"?n.runtimeMinutes:n?.runtimeMinutes!=null?Number(n.runtimeMinutes):null;return{id:String(n?.id??""),title:String(n?.title??"Untitled"),year:Number.isFinite(f)?f:null,type:o,runtimeMinutes:Number.isFinite(g)?g:null,posterUrl:n?.posterUrl??null,tmdbPosterPath:n?.tmdbPosterPath??null,tmdbBackdropPath:n?.tmdbBackdropPath??null,source:s,why:n?.why??null,friendIds:Array.isArray(n?.friendIds)?n.friendIds:null,friendProfiles:Array.isArray(n?.friendProfiles)?n.friendProfiles:null,friendLikesCount:typeof n?.friendLikesCount=="number"?n.friendLikesCount:Array.isArray(n?.friendProfiles)?n.friendProfiles.length:Array.isArray(n?.friendIds)?n.friendIds.length:null,topFriendName:Array.isArray(n?.friendProfiles)&&n.friendProfiles[0]?String(n.friendProfiles[0].display_name??n.friendProfiles[0].username??""):n?.topFriendName??null,overview:n?.overview??null}},ee="want_to_watch",te="watched",Hr=()=>{const{cards:n,sessionId:s,isLoading:o,isError:f,swipe:g,fetchMore:y,trimConsumed:x,swipeSyncError:I,retryFailedSwipe:D,isRetryingSwipe:C,trackImpression:U,trackDwell:b}=hr("combined",{limit:72}),h=a.useMemo(()=>n.map(Sr),[n]),[k,V]=a.useState(0),v=n[k];n[k+1];const r=h[k],_=h[k+1],[W,z]=a.useState(!1),[we,T]=a.useState(()=>typeof window>"u"?!1:!localStorage.getItem(Fe)),[le,X]=a.useState(!1),[ve,Ee]=a.useState([]),F=(t,i)=>{t&&Ee(l=>{const c=l.includes(t);return i?c?l:[...l,t]:c?l.filter(p=>p!==t):l})},je=t=>F(r?.id,t),Ne=t=>F(_?.id,t),$e=!!r?.id&&ve.includes(r.id),De=!!_?.id&&ve.includes(_.id),[u,d]=a.useState(null),[S,j]=a.useState(0),[N,q]=a.useState(!1),[L,ce]=a.useState(!1),[ke,Le]=a.useState(!1),[de,ft]=a.useState(null),[en,Ue]=a.useState(!1),H=a.useRef(null),[xt,pt]=a.useState(null),ue=a.useRef(null),[Pr,tn]=a.useState(0),[nn,ht]=a.useState(0),qe=a.useRef(null),bt=a.useRef(!1),[Fr,rn]=a.useState(!1),[sn,gt]=a.useState(!1),O=r?.id??null,{user:ne}=Qt(),on=Vt(),yt=["mediaFeedback",{userId:ne?.id??null,mediaItemId:O}],{data:Oe}=Lt({queryKey:yt,enabled:!!(ne?.id&&O),staleTime:1e3*30,gcTime:1e3*60*10,refetchOnWindowFocus:!1,queryFn:async()=>{if(!ne?.id||!O)return null;const{data:t,error:i}=await qt.from("media_feedback").select("in_watchlist, rating_0_10, last_action").eq("user_id",ne.id).eq("media_item_id",O).maybeSingle();if(i)throw i;return t??null}}),wt=Oe?.in_watchlist?ee:Oe?.last_action==="like"?te:null,an=kr(Oe?.rating_0_10),[ln,Be]=a.useState(null),[vt,Ye]=a.useState(null),We={status:ln??wt,rating:vt??an},me=Zt({mutationFn:async t=>{if(!ne?.id||!v)return;const i={sessionId:s,deckId:v.deckId??null,position:v.position??null,mediaItemId:v.id,source:v.source??null,payload:{ui:"SwipePage",action:t.status?"status":t.ratingStars!=null?"rating":"feedback"}},l=[];if(t.status!==void 0&&(t.status===te?l.push({...i,eventType:"like"}):l.push({...i,eventType:"watchlist",inWatchlist:t.status===ee})),t.ratingStars!==void 0&&l.push({...i,eventType:"rating",rating0_10:_r(t.ratingStars)}),!!l.length)for(const c of l)await lt(c)},onSuccess:()=>{on.invalidateQueries({queryKey:yt})}}),B=a.useRef(null),fe=a.useRef(!1),xe=a.useRef(null),_e=a.useRef({x:0,y:0}),jt=()=>{if(typeof window>"u")return null;if(xe.current)return xe.current;const t=window.AudioContext||window.webkitAudioContext;if(!t)return null;const i=new t;return xe.current=i,i},ze=t=>{typeof navigator>"u"||typeof navigator.vibrate!="function"||navigator.vibrate(t)},Nt=(t,i)=>{const l=jt();if(!l)return;l.state==="suspended"&&l.resume().catch(()=>{});const c=l.createOscillator(),p=l.createGain();let M=440,R=440;t==="like"?(M=420,R=660):t==="dislike"?(M=280,R=190):(M=360,R=320);const E=l.currentTime,w=.08+i*.07;c.type="triangle",c.frequency.setValueAtTime(M,E),c.frequency.linearRampToValueAtTime(R,E+w);const A=.18+i*.18;p.gain.setValueAtTime(A,E),p.gain.exponentialRampToValueAtTime(.001,E+w),c.connect(p),p.connect(l.destination),c.start(E),c.stop(E+w+.02)},{data:m}=Lt({queryKey:ct.titleDetail(O),enabled:!!(O&&N),staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>{if(!O)return null;const{data:t,error:i}=await qt.from("media_items").select("id, kind, omdb_plot, tmdb_overview, omdb_director, omdb_writer, omdb_actors, omdb_genre, omdb_language, tmdb_original_language, omdb_country, omdb_imdb_rating, omdb_imdb_votes, omdb_metascore, omdb_rating_rotten_tomatoes, omdb_poster, tmdb_poster_path, tmdb_backdrop_path, omdb_awards, omdb_box_office, omdb_released, tmdb_vote_average, tmdb_vote_count, tmdb_popularity, omdb_rated, omdb_runtime").eq("id",O).maybeSingle();if(i)throw i;if(!t)return null;const l=t.omdb_genre!=null?String(t.omdb_genre).split(",").map(p=>p.trim()).filter(Boolean):null,c=Nr(t.omdb_rating_rotten_tomatoes);return{title_id:t.id,content_type:t.kind??null,plot:t.omdb_plot??null,tmdb_overview:t.tmdb_overview??null,tagline:null,omdb_director:t.omdb_director??null,omdb_writer:t.omdb_writer??null,omdb_actors:t.omdb_actors??null,genres:l,tmdb_genre_names:null,language:null,omdb_language:t.omdb_language??null,tmdb_original_language:t.tmdb_original_language??null,country:null,omdb_country:t.omdb_country??null,imdb_rating:t.omdb_imdb_rating??null,imdb_votes:t.omdb_imdb_votes??null,metascore:t.omdb_metascore??null,rt_tomato_pct:c,poster_url:t.omdb_poster??null,tmdb_poster_path:t.tmdb_poster_path??null,backdrop_url:t.tmdb_backdrop_path??null,omdb_awards:t.omdb_awards??null,omdb_box_office_str:t.omdb_box_office??null,omdb_box_office:null,omdb_released:t.omdb_released??null,tmdb_vote_average:t.tmdb_vote_average??null,tmdb_vote_count:t.tmdb_vote_count??null,tmdb_popularity:t.tmdb_popularity??null,tmdb_episode_run_time:null,omdb_rated:t.omdb_rated??null}}}),kt=P(m?.plot)??P(m?.tmdb_overview)??P(r?.overview)??null,Y=m?.tmdb_genre_names??m?.genres??r?.genres??null,cn=m?.language??m?.omdb_language??m?.tmdb_original_language??r?.language??null;P(cn);const dn=m?.country??m?.omdb_country??r?.country??null,un=P(dn),_t=ar(un),Xe=P(m?.omdb_director),He=P(m?.omdb_writer),re=P(m?.omdb_actors),Ke=m?.imdb_rating??r?.imdbRating??null;m?.rt_tomato_pct??r?.rtTomatoMeter;const Se=m?.metascore??null,Me=m?.imdb_votes??null,Ce=m?.tmdb_vote_average??null,Re=m?.tmdb_vote_count??null,Ie=m?.tmdb_popularity??null,Ge=P(m?.omdb_awards),Ve=P(m?.omdb_box_office_str),Qe=P(m?.omdb_released),Ze=m?.content_type==="movie"||m?.content_type==="series"?m.content_type:r?.type??null,St=r,mn=St?.certification??St?.rated??m?.omdb_rated??null,Mt=P(mn),Ct=(Array.isArray(Y)?Y:Y?String(Y).split(",").map(t=>t.trim()):[])??[],Je=Ct.length>3?Ct.slice(3).filter(Boolean):[],fn=[m?.language??null,m?.omdb_language??null,m?.tmdb_original_language??null,r?.language??null],et=Array.from(new Set(fn.map(t=>P(t)).filter(t=>!!t)));let pe=null;Array.isArray(m?.tmdb_episode_run_time)?m.tmdb_episode_run_time.length>0&&(pe=$(m.tmdb_episode_run_time[0])??null):m?.tmdb_episode_run_time!=null&&(pe=$(m.tmdb_episode_run_time));const Rt=()=>ne?!0:(alert("Sign in to save this title, rate it, or add it to your watchlist."),!1),It=t=>{if(!(!O||!v||!Rt()||me.isPending)){if(t===ee){const i=We.status===ee?null:ee;Be(i),me.mutate({status:i});return}t===te&&(Be(te),me.mutate({status:te}))}},xn=t=>{!O||!v||!Rt()||me.isPending||(Ye(t),me.mutate({ratingStars:t}))},Tt=t=>We?.status===t,At=We?.rating??null,tt=vt??At;a.useEffect(()=>{Ye(null),Be(null)},[O,At,wt]);const pn=t=>{const i=tt===t?null:t;Ye(i),xn(i)},Pt=()=>typeof window<"u"?`${window.location.origin}/title/${r?.id??""}`:`/title/${r?.id??""}`,hn=Pt(),bn=async t=>{if(!r||!v)return;const i=Pt(),l=`Check this out: ${r.title}`,c=t??l;try{navigator.share?await navigator.share({title:r.title,text:c,url:i}):navigator.clipboard?.writeText?(await navigator.clipboard.writeText(`${c}

${i}`),alert("Link copied to clipboard")):alert(`${c}

${i}`)}catch{}},gn=!!(r?.posterUrl&&!$e),yn=!!(_?.posterUrl&&!De),se=a.useRef(null),ie=a.useRef(null),K=a.useRef(0),he=a.useRef(null),Q=a.useRef(null),Z=a.useRef(null),G=a.useRef(0),nt=a.useRef(null),rt=a.useRef(null),be=a.useRef(null);a.useEffect(()=>{if(typeof window>"u")return;const t=localStorage.getItem(Fe);T(!t)},[]),a.useEffect(()=>{je(!1),Le(!1),q(!1),ce(!1),rn(!1)},[r?.id]),a.useEffect(()=>{Ne(!1)},[_?.id]),a.useEffect(()=>{if(!v)return;const t=performance.now();if(be.current&&rt.current&&rt.current!==v.id){const i=nt.current;if(i!=null){const l=Math.max(0,Math.round(t-i));b(be.current,l)}}U(v),be.current=v,rt.current=v.id,nt.current=t},[v?.id,b,U]),a.useEffect(()=>()=>{if(!be.current)return;const t=nt.current;if(t==null)return;const i=Math.max(0,Math.round(performance.now()-t));b(be.current,i)},[]),a.useEffect(()=>{if(typeof window>"u")return;(window.requestIdleCallback??(i=>window.setTimeout(i,180)))(()=>{const i=h.slice(k+1,k+4);for(const l of i){if(!l?.posterUrl)continue;const c=new Image;c.loading="lazy",c.decoding="async",c.src=l.posterUrl}})},[h,k]),a.useEffect(()=>()=>{he.current&&cancelAnimationFrame(he.current),B.current!=null&&window.clearTimeout(B.current),H.current!=null&&window.clearTimeout(H.current),ue.current!=null&&window.clearTimeout(ue.current),xe.current&&xe.current.close().catch(()=>{})},[]),a.useEffect(()=>{if(!_)return;X(!1);const t=window.setTimeout(()=>X(!0),16);return()=>window.clearTimeout(t)},[_?.id]),a.useEffect(()=>{const t=h.length-k;t<12&&y(Math.max(60,t+24))},[h.length,k,y]),a.useEffect(()=>{if(k<=10)return;const t=Math.min(Math.max(k-6,0),h.length);t>0&&(x(t),V(i=>Math.max(4,i-t)))},[h.length,k,x]);const ge=(t,i=!1)=>{const l=se.current;if(!l)return;const c=Te(t,-Ht,Ht),p=Te(c/Kt,-12,12),M=Te(c/26,-10,10),R=1.02,E=Math.min(Math.abs(c)/900,.04),w=R+E,A=_e.current,oe=A.y*-4,Pn=A.x*5,Fn=A.y*-4;l.style.transition=i?"transform 260ms cubic-bezier(0.22,0.61,0.36,1)":"none",l.style.transform=`
      perspective(1400px)
      translateX(${c}px)
      translateY(${Fn}px)
      rotateX(${oe}deg)
      rotateY(${M+Pn}deg)
      rotateZ(${p}deg)
      scale(${w})
    `,K.current=c},st=()=>{_e.current={x:0,y:0},ge(0,!0),K.current=0,ie.current=null,Q.current=null,Z.current=null,G.current=0,d(null),j(0)},wn=(t,i)=>{ft({card:t,direction:i}),Ue(!0),H.current!=null&&window.clearTimeout(H.current),H.current=window.setTimeout(()=>Ue(!1),2800)},vn=()=>{Ue(!1),ft(null),H.current!=null&&(window.clearTimeout(H.current),H.current=null)},jn=()=>{de&&(V(t=>{const i=t-1;if(i<0)return t;const l=h[i];return l&&l.id===de.card.id?i:t}),vn())},Ft=t=>{pt(t),ue.current!=null&&window.clearTimeout(ue.current),t&&(ue.current=window.setTimeout(()=>pt(null),3200))},Nn=(t,i)=>{const l=t.runtimeMinutes??0,c=Y??t.genres??[],p=Ze==="series"||t.type==="series",M=c.map(R=>R.toLowerCase());return i==="like"?M.some(R=>R.includes("horror")||R.includes("thriller"))?"We’ll show more intense picks like this.":M.some(R=>R.includes("comedy"))?"We’ll show more light and funny picks like this.":p?"Nice — we’ll bring in more series that match this vibe.":Ke!=null&&$(Ke)!=null&&$(Ke)>=7.5?"Nice pick — we’ll show more highly rated titles like this.":t.friendLikesCount&&t.friendLikesCount>=3?"Your friends are into this — we’ll pull in more friend-favorites.":"Got it — we’ll keep tuning around this kind of title.":i==="dislike"?p?"Looks like this series isn’t your thing — we’ll dial down similar shows.":l>130&&nn+1>=3?"You’ve skipped a few long movies — we’ll lean toward shorter runtimes.":l>130?"Noted — we’ll be more careful with super long movies.":"Okay, we’ll dial down similar titles in your feed.":i==="skip"?"We’ll move this out of your way and keep the feed feeling fresh.":null},J=(t,i=0)=>{if(!r||!v)return;if(T(!1),typeof window<"u"&&localStorage.setItem(Fe,"1"),wn(r,t),g({card:v,direction:t}),d(null),j(0),t==="dislike"&&(r.runtimeMinutes??0)>130?ht(w=>w+1):ht(0),tn(w=>{const A=w+1,oe=Nn(r,t);return oe&&A>=4&&A%4===0?Ft(oe):Ft(null),A}),t==="skip"){const w=se.current;w&&(w.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",w.style.transform="perspective(1400px) translateX(0px) translateY(4px) scale(1.03) rotateZ(-1deg)",window.setTimeout(()=>{w.style.transform="perspective(1400px) translateX(0px) translateY(24px) scale(0.95)"},16),w.style.opacity="0");const A=.4;ze(16+A*40),Nt(t,A),window.setTimeout(()=>{V(oe=>Math.min(oe+1,h.length)),w&&(w.style.transition="none",w.style.transform="translateX(0px) translateY(0px) scale(1)",w.style.opacity="1")},220);return}const l=t==="like"?1:-1,c=Math.max(jr,Math.abs(K.current)+Math.abs(i)*vr),p=c*l,M=se.current;if(M){const w=Te(p/Kt,-18,18),A=l*12;M.style.transition="transform 260ms cubic-bezier(0.22,0.61,0.36,1)",M.style.transform=`
        perspective(1400px)
        translateX(${p}px)
        translateY(-4px)
        rotateZ(${w}deg)
        rotateY(${A}deg)
        scale(1.04)
      `}const R=Math.abs(c),E=Math.min(1,R/520);ze(22+E*60),Nt(t,E),window.setTimeout(()=>{V(w=>Math.min(w+1,h.length)),st()},260)},kn=(t,i,l)=>{if(!r||!v)return;z(!0),ie.current=t,K.current=0,Q.current=t,Z.current=performance.now(),G.current=0,d(null),j(0),jt(),B.current!=null&&window.clearTimeout(B.current),fe.current=!1,B.current=window.setTimeout(()=>{fe.current=!0,z(!1),st(),ze(20),q(M=>!M),ce(!1)},550);const c=N&&qe.current&&qe.current.contains(l);bt.current=!!c;const p=se.current;if(p)try{p.setPointerCapture(i)}catch{}},_n=t=>{if(!W||ie.current===null)return;const i=performance.now(),l=t-ie.current;B.current!=null&&Math.abs(l)>10&&!fe.current&&(window.clearTimeout(B.current),B.current=null),ge(l),j(-l*.06);let c=null;if(l>Gt?c="like":l<-Gt&&(c="dislike"),d(c),Q.current!==null&&Z.current!==null){const p=i-Z.current;if(p>0){const M=(t-Q.current)/p;G.current=M}}Q.current=t,Z.current=i,he.current&&cancelAnimationFrame(he.current),he.current=window.requestAnimationFrame(()=>ge(K.current))},Et=()=>{if(B.current!=null&&(window.clearTimeout(B.current),B.current=null),fe.current){fe.current=!1,ie.current=null,Q.current=null,Z.current=null,G.current=0;return}if(!W)return;z(!1);const i=K.current+G.current*180,l=N&&bt.current,c=l?zt*1.6:zt,p=l?Xt*1.4:Xt;if(Math.abs(i)>=c||Math.abs(G.current)>=p){J(i>=0?"like":"dislike",G.current),ie.current=null,Q.current=null,Z.current=null,G.current=0;return}st()},Sn=r?.why??lr(r?.source??void 0),ye=!r||o||f;a.useEffect(()=>{const t=i=>{!r||ye||W||(i.key==="ArrowLeft"?(i.preventDefault(),J("dislike")):i.key==="ArrowRight"?(i.preventDefault(),J("like")):(i.key==="ArrowDown"||i.key===" ")&&(i.preventDefault(),J("skip")))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[r,ye,W]);const Mn=()=>{if(!h.length)return null;const i=Math.min(h.length,8),l=Math.floor(i/2);let c=Math.max(0,k-l);return c+i>h.length&&(c=Math.max(0,h.length-i)),e.jsx("div",{className:"mb-3 flex justify-center","aria-hidden":"true",children:e.jsx("div",{className:"flex items-center gap-1.5",children:Array.from({length:i}).map((p,M)=>{const R=c+M,E=R===k;return e.jsx("span",{className:`h-1.5 rounded-md transition-all ${E?"w-4 bg-primary":"w-2 bg-border/70"}`},R)})})})},Cn=()=>{if(!en||!de)return null;const t=de.direction==="like"?"Loved it":de.direction==="dislike"?"Marked as ‘No thanks’":"Saved for ‘Not now’";return e.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-4 z-40 flex justify-center px-4 sm:px-0",children:e.jsxs("div",{className:"pointer-events-auto inline-flex items-center gap-3 rounded-md border border-border bg-background/95 px-3 py-2 text-[12px] text-foreground shadow-lg backdrop-blur",children:[e.jsx("span",{children:t}),e.jsx("button",{type:"button",onClick:jn,className:"text-xs font-semibold uppercase tracking-[0.14em] text-primary hover:text-primary/80",children:"Undo"})]})})},Rn=()=>xt?e.jsx("div",{className:"pointer-events-none absolute inset-x-0 top-2 z-30 flex justify-center px-4 sm:px-0",children:e.jsxs("div",{className:"pointer-events-auto inline-flex max-w-md items-start gap-2 rounded-md border border-border bg-background/95 px-3 py-2 text-xs text-muted-foreground shadow-lg backdrop-blur",children:[e.jsx(ot,{className:"mt-0.5 h-3.5 w-3.5 text-primary"}),e.jsx("span",{children:xt})]})}):null,$t=typeof r?.imdbRating=="number"&&!Number.isNaN(r.imdbRating)?r.imdbRating:typeof m?.imdb_rating=="number"&&!Number.isNaN(m.imdb_rating)?m.imdb_rating:$(m?.imdb_rating),Dt=typeof r?.rtTomatoMeter=="number"&&!Number.isNaN(r.rtTomatoMeter)?r.rtTomatoMeter:typeof m?.rt_tomato_pct=="number"&&!Number.isNaN(m.rt_tomato_pct)?m.rt_tomato_pct:$(m?.rt_tomato_pct),it=r?(()=>{const t=[];r.year&&t.push(String(r.year));const i=(Ze??r.type)==="series"?"Series":"Movie";return t.push(i),$t!=null&&t.push(`IMDb ${$t.toFixed(1)}`),Dt!=null&&t.push(`RT ${Dt}%`),typeof r.runtimeMinutes=="number"&&r.runtimeMinutes>0&&t.push(`${r.runtimeMinutes} min`),t.join(" · ")})():"",In=r?r.why?r.why:r.friendLikesCount&&r.friendLikesCount>=3?"Friends love this":null:null,Tn=t=>{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||W)return;const i=se.current;if(!i)return;const l=i.getBoundingClientRect(),c=(t.clientX-l.left)/l.width,p=(t.clientY-l.top)/l.height;_e.current={x:(c-.5)*2,y:(p-.5)*2},ge(K.current)},An=()=>{W||(_e.current={x:0,y:0},ge(K.current,!0))};return e.jsxs("div",{className:"flex min-h-[calc(100vh-6rem)] flex-1 flex-col gap-4 pb-4",children:[e.jsx(zn,{title:"Swipe",subtitle:"Combined For You, friends, and trending picks"}),e.jsx(br,{message:I,onRetry:D,isRetrying:C}),e.jsxs("div",{className:"relative mt-2 flex flex-1 flex-col overflow-visible",children:[Mn(),e.jsxs("div",{className:"relative flex flex-1 items-center justify-center overflow-visible [perspective:1400px]","aria-live":"polite",children:[o&&!r&&!f&&e.jsx(Bn,{}),f&&!o&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(Kn,{className:"h-8 w-8 text-amber-400"}),e.jsx("p",{children:"We couldn't load your swipe deck."}),e.jsx("button",{type:"button",onClick:()=>y(32),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Retry"})]}),!o&&!f&&!r&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(ot,{className:"h-8 w-8 text-primary"}),e.jsx("p",{children:"All caught up. New cards will appear soon."}),e.jsx("button",{type:"button",onClick:()=>y(36),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Refresh deck"})]}),!o&&r&&e.jsxs(e.Fragment,{children:[_&&e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 mx-auto flex h-[72%] max-h-[480px] w-full max-w-md items-center justify-center rounded-2xl transition-all duration-300 ease-out",style:{transform:`${le?"translateY(-40px) scale(0.9)":"translateY(-10px) scale(0.84)"} translateX(${S}px)`,opacity:le?1:0},children:e.jsx("div",{className:"relative h-full w-full overflow-hidden rounded-2xl border border-border/40 shadow-lg",children:yn&&_.posterUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:_.posterUrl,alt:at(_)??_.title,className:"h-full w-full object-cover blur-[7px] brightness-[0.8]",loading:"lazy",draggable:!1,onError:()=>Ne(!0)}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-background/0 via-background/30 to-background/90"})]}):e.jsx(Wt,{title:_?.title})})}),e.jsxs("article",{ref:se,role:"group","aria-roledescription":"Movie card","aria-label":at(r),className:`relative z-10 mx-auto flex h-[72%] max-h-[480px] w-full max-w-md select-none flex-col overflow-hidden rounded-2xl bg-gradient-to-br from-card/95 via-background/95 to-card/90 shadow-[0_28px_80px_rgba(0,0,0,0.85)] backdrop-blur transform-gpu will-change-transform ${N?"ring-1 ring-primary/40":"border border-white/5"}`,onPointerDown:t=>{t.pointerType==="mouse"&&t.button!==0||kn(t.clientX,t.pointerId,t.target)},onPointerMove:t=>_n(t.clientX),onPointerUp:Et,onPointerCancel:Et,onMouseMove:Tn,onMouseLeave:An,style:{touchAction:"pan-y"},children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 mix-blend-screen opacity-[0.14]"}),e.jsxs("div",{className:`relative overflow-hidden bg-gradient-to-br from-background/90 via-background/85 to-background/95 transition-all duration-300 ease-out ${N?"h-[40%]":"h-[58%]"}`,children:[gn&&r.posterUrl?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r.posterUrl,alt:at(r)??`${r.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>je(!0),style:{filter:N?"blur(4px) brightness(0.65)":"none",transform:N?"scale(1.12)":"scale(1)",transition:"filter 260ms cubic-bezier(0.22,0.61,0.36,1), transform 260ms cubic-bezier(0.22,0.61,1)"}}),N&&e.jsx("div",{className:"pointer-events-none absolute left-3 flex items-start",style:{top:"3.4rem"},children:e.jsx("div",{className:"overflow-hidden rounded-2xl border border-border bg-background shadow-[0_14px_40px_rgba(0,0,0,0.85)]",style:{height:"clamp(120px, 22vh, 220px)",aspectRatio:"2 / 3"},children:e.jsx("img",{src:r.posterUrl,alt:r.title,className:"h-full w-full object-cover",draggable:!1})})})]}):e.jsx(Wt,{title:r.title}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/40 to-background/95"}),u==="like"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pointer-events-none absolute inset-x-8 bottom-3 flex justify-start",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-emerald-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-emerald-200 shadow-md backdrop-blur-sm",children:[e.jsx(Ot,{className:"h-4 w-4 text-emerald-300"}),e.jsx("span",{children:"Love it"})]})}),e.jsx("div",{className:"pointer-events-none absolute inset-y-8 right-2 w-1 rounded-full bg-gradient-to-b from-emerald-400/0 via-emerald-400/40 to-emerald-400/0"})]}),u==="dislike"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pointer-events-none absolute inset-x-8 bottom-3 flex justify-end",children:e.jsxs("div",{className:"flex items-center gap-2 rounded-md bg-rose-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-rose-200 shadow-md backdrop-blur-sm",children:[e.jsx(Bt,{className:"h-4 w-4 text-rose-300"}),e.jsx("span",{children:"No thanks"})]})}),e.jsx("div",{className:"pointer-events-none absolute inset-y-8 left-2 w-1 rounded-full bg-gradient-to-b from-rose-400/0 via-rose-400/40 to-rose-400/0"})]}),e.jsxs("div",{className:"absolute left-3 right-3 top-3 flex flex-wrap items-center justify-between gap-2 text-xs",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md bg-background/80 px-2 py-1 text-xs font-semibold text-foreground shadow-md",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-sm bg-primary"}),Sn]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md bg-background/70 px-2 py-1 text-xs font-medium text-muted-foreground/85 shadow-md",children:[e.jsx(ot,{className:"h-3 w-3 text-primary/80"}),k+1," / ",h.length||1]})]})]}),e.jsxs("div",{className:"relative flex flex-1 flex-col bg-gradient-to-b from-background/92 via-background/96 to-background px-4 pb-4 pt-3 backdrop-blur-md",children:[!N&&e.jsxs(e.Fragment,{children:[e.jsx(gr,{card:r,metaLine:it,highlightLabel:In}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[Array.isArray(r.friendProfiles)&&r.friendProfiles.length>0&&e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx(wr,{profiles:r.friendProfiles,max:3}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r.friendProfiles.length===1?`Picked by ${r.friendProfiles[0].display_name??r.friendProfiles[0].username??"a friend"}`:`Picked by ${r.friendProfiles.length} friends`})]}),(!Array.isArray(r.friendProfiles)||r.friendProfiles.length===0)&&typeof r.friendLikesCount=="number"&&r.friendLikesCount>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Ut,{className:"h-4 w-4 text-primary/80"}),r.friendLikesCount===1?"1 friend likes this":`${r.friendLikesCount} friends like this`]}),r.topFriendName&&r.topFriendReviewSnippet&&e.jsxs("button",{type:"button",onClick:()=>Le(t=>!t),className:"inline-flex flex-1 items-start gap-2 rounded-xl border border-border/70 bg-card/80 px-3 py-2 text-left text-foreground shadow-md hover:bg-card",children:[e.jsx(dt,{className:"mt-0.5 h-4 w-4 text-primary"}),e.jsx("div",{className:`overflow-hidden transition-all duration-200 ${ke?"max-h-32":"max-h-10"}`,children:e.jsxs("span",{className:`block text-xs ${ke?"":"line-clamp-2"}`,children:[r.topFriendName,": “",r.topFriendReviewSnippet,"”"]})})]})]})]}),N&&r&&e.jsxs("div",{ref:qe,id:"swipe-detail-panel","aria-label":L?"Full details":"Details summary","aria-live":"polite",className:"mt-2 flex flex-1 flex-col text-left text-xs text-muted-foreground",children:[e.jsx("div",{className:"flex-1 overflow-hidden pr-1",children:L?e.jsxs("div",{className:"h-full space-y-3 text-xs leading-relaxed text-muted-foreground/90",children:[(Je.length>0||et.length>0||pe)&&e.jsxs("section",{"aria-label":"Detailed info",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground/80",children:"Info"}),e.jsxs("div",{className:"mt-1 grid gap-1.5 rounded-2xl bg-background/60 px-3 py-2 text-[10.5px]",children:[Je.length>0&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"More genres:"})," ",e.jsx("span",{children:Je.join(", ")})]}),et.length>0&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Languages:"})," ",e.jsx("span",{children:et.join(", ")})]}),pe&&Ze==="series"&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Episode runtime:"})," ",e.jsx("span",{children:or(pe)})]})]})]}),(Me||Se||Ce||Re||Ie)&&e.jsxs("section",{"aria-label":"Ratings breakdown",className:"mt-1",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground/80",children:"Ratings"}),e.jsxs("div",{className:"mt-1 grid gap-1.5",children:[Me&&Ae(Me)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground/90",children:"IMDb votes"}),e.jsx("span",{className:"font-medium text-foreground/90",children:Ae(Me)})]}),Se&&$(Se)!=null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground/90",children:"Metascore"}),e.jsx("span",{className:"font-medium text-foreground/90",children:$(Se)})]}),Ce&&$(Ce)!=null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground/90",children:"TMDB score"}),e.jsx("span",{className:"font-medium text-foreground/90",children:$(Ce)?.toFixed(1)})]}),Re&&Ae(Re)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground/90",children:"TMDB votes"}),e.jsx("span",{className:"font-medium text-foreground/90",children:Ae(Re)})]}),Ie&&$(Ie)!=null&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground/90",children:"TMDB popularity"}),e.jsx("span",{className:"font-medium text-foreground/90",children:$(Ie)?.toFixed(1)})]})]})]}),re||He?e.jsxs("section",{"aria-label":"Credits",className:"mt-1",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground/80",children:"Credits"}),e.jsxs("div",{className:"mt-1 space-y-1.5 text-xs",children:[He&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Writers:"})," ",e.jsx("span",{children:He})]}),re&&(()=>{const i=re.split(",").map(l=>l.trim()).filter(Boolean).slice(3);return i.length?e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"More cast:"})," ",e.jsx("span",{children:i.join(", ")})]}):null})()]})]}):null,(Qe||Ge||Ve)&&e.jsxs("section",{"aria-label":"Release and production",className:"mt-1",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground/80",children:"Release & production"}),e.jsxs("div",{className:"mt-1 space-y-1.5 text-xs",children:[Qe&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Released:"})," ",e.jsx("span",{children:Qe})]}),Ge&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Awards:"})," ",e.jsx("span",{children:Ge})]}),Ve&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Box office:"})," ",e.jsx("span",{children:Ve})]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h3",{className:"line-clamp-2 text-base font-semibold text-foreground sm:text-lg",children:r.title}),it&&e.jsx("p",{className:"text-xs text-muted-foreground/90",children:it}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-1.5 text-xs text-muted-foreground/90",children:[Y&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Genres"}),e.jsx("span",{className:"truncate max-w-[180px]",children:Array.isArray(Y)?Y.slice(0,3).join(", "):String(Y).split(",").map(t=>t.trim()).slice(0,3).join(", ")})]}),Mt&&e.jsx("span",{className:"rounded-full bg-card/80 px-2 py-0.5 text-xs font-medium text-foreground/90",children:Mt}),_t&&e.jsx("span",{className:"rounded-full bg-card/80 px-2 py-0.5 text-xs text-muted-foreground/90",children:_t})]})]}),kt&&e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.16em] text-muted-foreground/70",children:"Overview"}),e.jsx("p",{className:"line-clamp-3 text-xs leading-relaxed text-muted-foreground/90",children:kt})]}),(Xe||re)&&e.jsxs("div",{className:"space-y-1.5 text-[10.5px]",children:[Xe&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Director:"})," ",e.jsx("span",{children:Xe})]}),re&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-foreground/90",children:"Cast:"})," ",e.jsx("span",{children:re.split(",").map(t=>t.trim()).filter(Boolean).slice(0,3).join(", ")})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 pt-1",children:[e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full bg-card/80 px-2.5 py-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground/80",children:"Your rating"}),e.jsx("div",{className:"flex items-center gap-0.5","aria-label":"Your rating",children:Array.from({length:5}).map((t,i)=>{const l=i+1,c=tt!=null&&tt>=l;return e.jsx("button",{type:"button",onClick:()=>pn(l),className:"flex h-5 w-5 items-center justify-center rounded-full hover:scale-105 focus-visible:outline-none",children:e.jsx(Gn,{className:`h-3.5 w-3.5 ${c?"fill-yellow-400 text-yellow-400":"text-muted-foreground"}`})},l)})})]}),e.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{type:"button",onClick:()=>It(ee),className:`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium transition-colors ${Tt(ee)?"bg-primary/90 text-primary-foreground":"border border-border bg-card/80 text-muted-foreground hover:border-primary/70 hover:text-primary"}`,children:"Watchlist"}),e.jsx("button",{type:"button",onClick:()=>It(te),className:`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium transition-colors ${Tt(te)?"bg-emerald-500/90 text-primary-foreground":"border border-border bg-card/80 text-muted-foreground hover:border-emerald-400/80 hover:text-emerald-300"}`,children:"Watched"}),e.jsxs("button",{type:"button",onClick:()=>gt(!0),className:"inline-flex items-center gap-1 rounded-full border border-border bg-card/80 px-2.5 py-1 text-xs font-medium text-muted-foreground hover:border-primary/70 hover:text-primary",children:[e.jsx(Jt,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Share"})]})]})]}),typeof r.friendLikesCount=="number"&&r.friendLikesCount>0||r.topFriendName&&r.topFriendReviewSnippet?e.jsxs("div",{className:"space-y-1.5 rounded-2xl bg-card/80 px-3 py-2 text-xs text-foreground shadow-md",children:[typeof r.friendLikesCount=="number"&&r.friendLikesCount>0&&e.jsxs("div",{className:"inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Ut,{className:"h-4 w-4 text-primary/80"}),r.friendLikesCount===1?"1 friend likes this":`${r.friendLikesCount} friends like this`]}),r.topFriendName&&r.topFriendReviewSnippet&&e.jsxs("button",{type:"button",onClick:()=>Le(t=>!t),className:"mt-1 inline-flex w-full items-start gap-2 text-left",children:[e.jsx(dt,{className:"mt-0.5 h-4 w-4 text-primary"}),e.jsx("div",{className:`overflow-hidden transition-all duration-200 ${ke?"max-h-32":"max-h-10"}`,children:e.jsxs("span",{className:`block text-xs ${ke?"":"line-clamp-2"}`,children:[r.topFriendName,": “",r.topFriendReviewSnippet,"”"]})})]})]}):null]})}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>ce(t=>!t),"aria-expanded":L,"aria-controls":"swipe-detail-panel",className:"inline-flex items-center gap-1 rounded-full border border-border px-2.5 py-1 text-xs font-medium text-foreground hover:border-primary/70 hover:text-primary",children:e.jsx("span",{children:L?"Collapse":"Full details"})})})]})]})]}),we&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center bg-gradient-to-b from-background/70 via-background/50 to-background/80",children:e.jsxs("div",{className:"pointer-events-auto max-w-xs rounded-2xl border border-border bg-background/95 p-4 text-center shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Swipe to decide"}),e.jsx("p",{className:"mt-1 text-[12px] text-muted-foreground",children:"Swipe left to pass, right to save what you love."}),e.jsx("button",{type:"button",className:"mt-3 w-full rounded-xl bg-primary px-3 py-2 text-sm font-semibold text-white shadow-md",onClick:()=>{T(!1),typeof window<"u"&&localStorage.setItem(Fe,"1")},children:"Got it"})]})})]}),Rn()]}),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-3","aria-label":"Swipe actions",children:[e.jsxs("button",{type:"button",onClick:()=>J("dislike"),disabled:ye,className:"flex min-h-[44px] items-center justify-center gap-2 rounded-xl border border-border bg-background px-3 py-3 text-sm font-semibold text-rose-400 shadow-md disabled:cursor-not-allowed disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-rose-300 focus-visible:ring-offset-2 focus-visible:ring-offset-background active:translate-y-[1px] active:scale-[0.99] active:shadow-none transition-all duration-150","aria-label":"No thanks",children:[e.jsx(Bt,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"No thanks"})]}),e.jsxs("button",{type:"button",onClick:()=>J("skip"),disabled:ye,className:"flex min-h-[44px] items-center justify-center gap-2 rounded-xl border border-border bg-background px-3 py-3 text-sm font-semibold text-muted-foreground shadow-md disabled:cursor-not-allowed disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-border focus-visible:ring-offset-2 focus-visible:ring-offset-background active:translate-y-[1px] active:scale-[0.99] active:shadow-none transition-all duration-150","aria-label":"Not now",children:[e.jsx(sr,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Not now"})]}),e.jsxs("button",{type:"button",onClick:()=>J("like"),disabled:ye,className:"flex min-h-[44px] items-center justify-center gap-2 rounded-xl border border-transparent bg-primary/95 px-3 py-3 text-sm font-semibold text-primary-foreground shadow-md disabled:cursor-not-allowed disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background active:translate-y-[1px] active:scale-[0.99] active:shadow-none transition-all duration-150","aria-label":"Love it",children:[e.jsx(Ot,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Love it"})]})]}),e.jsx(Mr,{isOpen:sn,onClose:()=>gt(!1),activeCard:r,shareUrl:hn,onShareExternal:bn}),Cn()]})]})},Mr=({isOpen:n,onClose:s,activeCard:o,shareUrl:f,onShareExternal:g})=>{const{user:y}=Qt(),{data:x=[],isLoading:I}=Yn();if(a.useEffect(()=>{if(!n)return;const b=h=>{h.key==="Escape"&&s()};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[n,s]),!n||!o)return null;const D=`Check this out: ${o.title}

${f}`,C=b=>{b.target===b.currentTarget&&s()},U=b=>{(b.key==="Enter"||b.key===" ")&&s()};return e.jsx("div",{role:"button",tabIndex:0,className:"fixed inset-0 z-[9999] flex flex-col justify-end bg-black/55",onClick:C,onKeyDown:U,children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"pointer-events-auto mb-[72px] w-full max-w-md self-center rounded-t-2xl bg-card pb-3 pt-2 shadow-[0_-18px_45px_rgba(0,0,0,0.65)]",onClick:b=>b.stopPropagation(),onKeyDown:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[e.jsx("button",{type:"button",className:"rounded-full p-1 text-muted-foreground hover:bg-background/80",children:e.jsx(Wn,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Send to"}),e.jsx("button",{type:"button",onClick:s,className:"rounded-full p-1 text-muted-foreground hover:bg-background/80",children:e.jsx("span",{className:"text-[18px] leading-none",children:"×"})})]}),e.jsxs("section",{className:"border-t border-border px-4 pt-3 pb-2",children:[e.jsx("h2",{className:"mb-2 text-[12px] font-medium uppercase tracking-[0.08em] text-muted-foreground/90",children:"Send to"}),I?e.jsx("div",{className:"flex gap-3 overflow-hidden",children:Array.from({length:4}).map((b,h)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"h-11 w-11 animate-pulse rounded-full bg-border/50"}),e.jsx("div",{className:"h-2.5 w-12 animate-pulse rounded bg-border/40"})]},h))}):y?x.length===0?e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"No conversations yet. Start a chat from a profile or the Messages tab."}):e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:x.map(b=>e.jsx(Cr,{conversation:b,text:D},b.id))}):e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"Sign in to share via messages."})]}),e.jsx("section",{className:"border-t border-border px-4 pt-3 pb-3",children:e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:[e.jsx(Ir,{shareUrl:f,title:o.title}),e.jsx(Tr,{shareUrl:f,title:o.title}),e.jsx(Ar,{onShareExternal:g}),e.jsx(Rr,{shareUrl:f})]})})]})})},Cr=({conversation:n,text:s})=>{const o=n.isGroup?null:n.participants?.find(D=>!D.isSelf)??n.participants?.[0],f=o?.displayName??n.title??"Conversation",g=o?.avatarUrl,y=Xn(n.id),x=()=>{y.isPending||y.mutate({text:s})},I=f.split(" ").map(D=>D.charAt(0).toUpperCase()).slice(0,2).join("");return e.jsxs("button",{type:"button",onClick:x,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center overflow-hidden rounded-full bg-muted text-xs text-muted-foreground",children:g?e.jsx("img",{src:g,alt:f,className:"h-full w-full object-cover"}):e.jsx("span",{children:I})}),y.isSuccess&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-emerald-500",children:e.jsx(dt,{className:"h-3 w-3 text-primary-foreground"})})]}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:f})]})},Rr=({shareUrl:n})=>{const s=async()=>{if(navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(n)}catch{}};return e.jsxs("button",{type:"button",onClick:s,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx(Jn,{className:"h-4 w-4 text-primary-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Copy link"})]})},Ir=({shareUrl:n,title:s})=>{const o=()=>{if(typeof window>"u")return;const f=`Check this out: ${s}

${n}`,g=`https://api.whatsapp.com/send?text=${encodeURIComponent(f)}`;window.open(g,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:o,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"W"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"WhatsApp"})]})},Tr=({shareUrl:n,title:s})=>{const o=()=>{if(typeof window>"u")return;const f=`Check this out: ${s}

${n}`,g=`https://t.me/share/url?url=${encodeURIComponent(n)}&text=${encodeURIComponent(f)}`;window.open(g,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:o,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"T"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Telegram"})]})},Ar=({onShareExternal:n})=>{const s=async()=>{await n()};return e.jsxs("button",{type:"button",onClick:s,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full border border-border bg-muted",children:e.jsx(Jt,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"More"})]})};export{Hr as default};
