import{c as k,j as e,k as S,L as U,u as L,v as M,r as o,n as $,s as C,M as w,S as R}from"./index-D8UbFo8l.js";import{T as I}from"./TopBar-ClKHHvFp.js";import{S as _,B as z}from"./Button-B47nkF3R.js";import{U as E}from"./users-CgaclyYW.js";import"./PageChrome-BL71Rgrf.js";import"./brand-DTIDtbc4.js";/**
 * @license lucide-react v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=k("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),B=({onFilterClick:s,className:t="",...n})=>e.jsxs("div",{className:`flex items-center gap-2 rounded-full border border-mn-border-subtle/70 bg-mn-bg px-3 py-2 text-[13px] shadow-mn-soft ${t}`,children:[e.jsx(S,{className:"h-4 w-4 text-mn-text-muted","aria-hidden":"true"}),e.jsx("input",{...n,className:"flex-1 bg-transparent text-[13px] text-mn-text-primary placeholder:text-mn-text-muted focus:outline-none"}),s?e.jsx("button",{type:"button",onClick:s,className:"inline-flex h-8 w-8 items-center justify-center rounded-full text-mn-text-secondary hover:bg-mn-bg-elevated/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-primary focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg","aria-label":"Open filters",children:e.jsx(_,{className:"h-4 w-4","aria-hidden":"true"})}):null]}),N=({icon:s,title:t,subtitle:n,actionLabel:r,onAction:i})=>e.jsxs("div",{className:"flex min-h-[220px] flex-col items-center justify-center gap-3 rounded-2xl border border-mn-border-subtle/80 bg-mn-bg/90 p-6 text-center shadow-mn-card",children:[s?e.jsx("div",{className:"inline-flex h-12 w-12 items-center justify-center rounded-2xl bg-mn-primary/10 text-mn-primary",children:s}):null,e.jsx("h3",{className:"text-base font-semibold text-mn-text-primary",children:t}),n?e.jsx("p",{className:"max-w-md text-[12px] text-mn-text-muted",children:n}):null,r?e.jsx(z,{size:"sm",onClick:i,className:"mt-1",children:r}):null]}),Q=()=>{const[s,t]=o.useState(0),n=o.useRef(1);o.useEffect(()=>{if(typeof window>"u")return;const i=window.setInterval(()=>{n.current=n.current===1?-1:1;const c=n.current*14;t(c)},850);return()=>window.clearInterval(i)},[]);const r=s/5;return e.jsxs("article",{className:"relative z-10 mx-auto flex h-[72%] max-h-[480px] w-full max-w-md select-none flex-col overflow-hidden rounded-[30px] border border-mn-border-subtle/70 bg-gradient-to-br from-mn-bg-elevated/95 via-mn-bg/95 to-mn-bg-elevated/90 shadow-mn-card backdrop-blur",style:{transform:`translateX(${s}px) rotate(${r}deg)`,transition:"transform 480ms cubic-bezier(0.22,0.61,0.36,1)"},children:[e.jsxs("div",{className:"relative h-[58%] overflow-hidden bg-gradient-to-br from-mn-bg/90 via-mn-bg/85 to-mn-bg/95",children:[e.jsx("div",{className:"h-full w-full animate-pulse bg-gradient-to-br from-mn-border-subtle/40 via-mn-border-subtle/20 to-mn-border-subtle/50"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/25 via-black/10 to-mn-bg/85"}),e.jsxs("div",{className:"absolute left-3 right-3 top-3 flex flex-wrap items-center justify-between gap-2 text-[10px]",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg/80 px-2 py-1 font-semibold text-mn-text-muted shadow-mn-soft",children:[e.jsx("span",{className:"h-1.5 w-1.5 animate-pulse rounded-full bg-mn-border-subtle"}),"Loading your inbox…"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg/80 px-2 py-1 text-[10px] text-mn-text-muted shadow-mn-soft",children:[e.jsx(R,{className:"h-3 w-3"}),"Checking for new chats"]})]})]}),e.jsxs("div",{className:"flex flex-1 flex-col justify-between bg-gradient-to-b from-mn-bg/92 via-mn-bg/96 to-mn-bg px-4 pb-4 pt-3 backdrop-blur-md",children:[e.jsxs("div",{className:"space-y-3 text-left text-[12px] leading-relaxed",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 w-3/4 animate-pulse rounded-full bg-mn-border-subtle/60"}),e.jsx("div",{className:"h-3 w-1/2 animate-pulse rounded-full bg-mn-border-subtle/40"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("div",{className:"h-3 w-full animate-pulse rounded-full bg-mn-border-subtle/40"}),e.jsx("div",{className:"h-3 w-5/6 animate-pulse rounded-full bg-mn-border-subtle/30"})]}),e.jsxs("div",{className:"mt-2 space-y-1.5",children:[e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded-full bg-mn-border-subtle/35"}),e.jsx("div",{className:"h-3 w-1/2 animate-pulse rounded-full bg-mn-border-subtle/25"})]})]}),e.jsx("div",{className:"mt-4 flex flex-wrap items-center gap-2 text-[11px] text-mn-text-secondary",children:e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-surface-elevated/80 px-2 py-1 shadow-mn-soft",children:[e.jsx(w,{className:"h-4 w-4 text-mn-border-subtle"}),"Syncing conversations…"]})})]})]})},G=()=>e.jsx("div",{className:"rounded-2xl border border-mn-border-subtle/80 bg-mn-bg/90 shadow-mn-card",children:e.jsx("ul",{className:"divide-y divide-mn-border-subtle/70 px-2 py-1 sm:px-3",children:Array.from({length:5}).map((s,t)=>e.jsx("li",{className:"py-2 sm:py-2.5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex h-12 w-12 items-center justify-center",children:[e.jsx("span",{className:"inline-flex h-11 w-11 animate-pulse items-center justify-center rounded-full bg-mn-bg-elevated/80 text-[12px] font-semibold text-mn-text-primary"}),e.jsx("span",{className:"absolute -right-0.5 -top-0.5 h-2.5 w-2.5 animate-pulse rounded-full bg-mn-border-subtle"})]}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"block h-3 w-1/2 animate-pulse rounded-full bg-mn-bg-elevated/80"}),e.jsx("span",{className:"block h-3 w-10 animate-pulse rounded-full bg-mn-bg-elevated/60"})]}),e.jsx("span",{className:"block h-3 w-5/6 animate-pulse rounded-full bg-mn-bg-elevated/70"})]})]})},t))})}),P=({conversation:s})=>{var u,m,x,p;const t=s.participants.find(l=>!l.isSelf)??s.participants[0]??null,n=((m=(u=t==null?void 0:t.displayName)==null?void 0:u[0])==null?void 0:m.toUpperCase())??((p=(x=t==null?void 0:t.username)==null?void 0:x[0])==null?void 0:p.toUpperCase())??"?",r=s.lastMessageAtLabel??"Now",i=s.isGroup,c=s.participants.length,g="group flex items-center gap-3 rounded-2xl px-3 py-2 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-mn-primary focus-visible:ring-offset-2 focus-visible:ring-offset-mn-bg",j=s.hasUnread?"bg-mn-bg-elevated/90 border border-mn-primary/25 shadow-mn-soft":"hover:bg-mn-bg-elevated/70 hover:-translate-y-0.5 hover:shadow-mn-soft";return e.jsx("li",{className:"py-1 sm:py-1.5",children:e.jsxs(U,{to:`/messages/${s.id}`,className:`${g} ${j}`,children:[e.jsxs("div",{className:"relative flex h-12 w-12 items-center justify-center",children:[i&&c>1?e.jsx("div",{className:"flex -space-x-2",children:s.participants.slice(0,2).map((l,v)=>{var b,d,f,a;return e.jsx("span",{className:"inline-flex h-10 w-10 items-center justify-center overflow-hidden rounded-full bg-mn-bg-elevated text-[11px] font-semibold text-mn-text-primary ring-2 ring-mn-bg",style:{zIndex:2-v},children:l.avatarUrl?e.jsx("img",{src:l.avatarUrl??"",alt:l.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):((d=(b=l.displayName)==null?void 0:b[0])==null?void 0:d.toUpperCase())??((a=(f=l.username)==null?void 0:f[0])==null?void 0:a.toUpperCase())??"?"},l.id)})}):e.jsx("span",{className:`inline-flex h-11 w-11 items-center justify-center overflow-hidden rounded-full text-[12px] font-semibold text-mn-text-primary ${s.hasUnread?"bg-gradient-to-br from-mn-primary/80 to-amber-400 text-mn-bg":"bg-mn-bg-elevated"}`,children:t!=null&&t.avatarUrl?e.jsx("img",{src:t.avatarUrl??"",alt:t.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):n}),s.hasUnread&&e.jsx("span",{className:"absolute -right-0.5 -top-0.5 h-2.5 w-2.5 rounded-full bg-mn-primary shadow-mn-soft"})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:`truncate text-[13px] ${s.hasUnread?"font-semibold text-mn-text-primary":"font-medium text-mn-text-primary"}`,children:s.title}),i&&e.jsxs("div",{className:"mt-0.5 flex items-center gap-1 text-[10px] text-mn-text-muted",children:[e.jsx(E,{className:"h-3 w-3","aria-hidden":"true"}),e.jsxs("span",{children:[c," participants"]})]})]}),e.jsx("span",{className:"shrink-0 text-[11px] text-mn-text-muted",children:r})]}),e.jsx("p",{className:`truncate text-[12px] ${s.hasUnread?"text-mn-text-primary":"text-mn-text-secondary"}`,children:s.lastMessagePreview??"Start chatting"})]})]})})},X=()=>{const s=L(),{data:t,isLoading:n,isError:r,error:i,refetch:c,isFetching:g}=M(),[j,u]=o.useState(""),[m,x]=o.useState("all"),p=$();o.useEffect(()=>{const a=C.channel("supabase_realtime_messages_publication:messages-list").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},y=>{console.log("[MessagesPage] Realtime message for list",y),p.invalidateQueries({queryKey:["conversations"]})});return a.subscribe(y=>{console.log("[MessagesPage] Realtime channel status (list)",y)}),()=>{C.removeChannel(a)}},[p]);const l=j.trim().toLowerCase(),v=l.length>0,b=o.useMemo(()=>(t??[]).filter(a=>a.hasUnread).length,[t]),d=o.useMemo(()=>(t??[]).filter(a=>m==="unread"?a.hasUnread:m==="groups"?a.isGroup:!0).filter(a=>l?[a.title,a.subtitle,a.lastMessagePreview??"",...a.participants.map(h=>h.displayName),...a.participants.map(h=>h.username).filter(h=>!!h)].join(" ").toLowerCase().includes(l):!0),[t,l,m]),f=()=>{s("/search?tab=people&from=messages")};return e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-4",children:[e.jsx(I,{title:"Messages",subtitle:"Chat with friends, plan movie nights",actions:e.jsx("button",{type:"button",onClick:f,className:"inline-flex h-11 w-11 items-center justify-center rounded-full bg-mn-primary text-mn-bg shadow-mn-soft transition hover:-translate-y-0.5","aria-label":"New conversation",children:e.jsx(A,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-mn-text-secondary",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg-elevated/80 px-2 py-1 shadow-mn-soft",children:[e.jsxs("span",{className:"relative flex h-2.5 w-2.5",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-400/60 opacity-75"}),e.jsx("span",{className:"relative inline-flex h-2.5 w-2.5 rounded-full bg-emerald-400"})]}),e.jsx("span",{className:"font-medium",children:b>0?`${b} unread`:"Inbox is caught up"})]}),g&&!n&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-mn-bg-elevated/60 px-2 py-1 text-[10px] text-mn-text-muted",children:[e.jsx("span",{className:"h-1.5 w-6 overflow-hidden rounded-full bg-mn-border-subtle/40",children:e.jsx("span",{className:"block h-full w-1/3 animate-[shimmer_1.1s_linear_infinite] bg-mn-primary/60"})}),"Syncing…"]})]}),e.jsxs("div",{className:"flex max-w-full items-center overflow-x-auto rounded-full bg-mn-bg-elevated/60 p-1 text-[11px] shadow-mn-soft scrollbar-none",children:[e.jsx("button",{type:"button",onClick:()=>x("all"),className:`whitespace-nowrap rounded-full px-2.5 py-1 transition ${m==="all"?"bg-mn-primary text-mn-bg":"text-mn-text-secondary hover:text-mn-text-primary"}`,children:"All"}),e.jsx("button",{type:"button",onClick:()=>x("unread"),className:`whitespace-nowrap rounded-full px-2.5 py-1 transition ${m==="unread"?"bg-mn-primary text-mn-bg":"text-mn-text-secondary hover:text-mn-text-primary"}`,children:"Unread"}),e.jsx("button",{type:"button",onClick:()=>x("groups"),className:`whitespace-nowrap rounded-full px-2.5 py-1 transition ${m==="groups"?"bg-mn-primary text-mn-bg":"text-mn-text-secondary hover:text-mn-text-primary"}`,children:"Groups"})]})]}),e.jsx(B,{placeholder:"Search chats or people…",value:j,onChange:a=>u(a.target.value)}),n&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Q,{})}),e.jsx(G,{})]}),r&&!n&&e.jsx("div",{className:"flex flex-1 items-center justify-center",children:e.jsx(N,{icon:e.jsx(w,{className:"h-5 w-5"}),title:"Something went wrong",subtitle:(i==null?void 0:i.message)??"Please try again in a moment.",actionLabel:g?"Retrying…":"Reload inbox",onAction:()=>c()})}),!n&&!r&&v&&d.length===0&&e.jsx(N,{icon:e.jsx(w,{className:"h-6 w-6"}),title:"No conversations match",subtitle:"Try a different name or clear your search to see all chats.",actionLabel:"Clear search",onAction:()=>u("")}),!n&&!r&&!v&&d.length===0&&e.jsx(N,{icon:e.jsx(w,{className:"h-6 w-6"}),title:"Plan together",subtitle:"Create a group chat to line up your next movie night.",actionLabel:"New conversation",onAction:f}),!n&&!r&&d.length>0&&e.jsx("div",{className:"rounded-2xl border border-mn-border-subtle/80 bg-mn-bg/90 shadow-mn-card",children:e.jsx("ul",{className:"divide-y divide-mn-border-subtle/70 px-2 py-1 sm:px-3",children:d.map(a=>e.jsx(P,{conversation:a},a.id))})})]})};export{P as ConversationListRow,X as default};
