import{c as g,s as u,m as x,u as _,I as f,j as e}from"./index-B7GfpBhl.js";import{T as h}from"./TopBar-5RtuOZ5h.js";import{S as y}from"./share-2-Cd-sPzzq.js";import"./arrow-left-DB-_JOpl.js";const v=r=>g({queryKey:["lists","detail",r],enabled:!!r,queryFn:async()=>{if(!r)return null;const{data:a,error:i}=await u.from("lists").select("id, user_id, name, description, is_public").eq("id",r).maybeSingle();if(i)throw new Error(i.message);if(!a)return null;const{data:l,error:o}=await u.from("list_items").select("title_id, position, created_at").eq("list_id",r).order("position",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!0}).limit(300);if(o)throw new Error(o.message);const d=l??[],s=Array.from(new Set(d.map(t=>t.title_id).filter(t=>!!t))),p=new Map;if(s.length){const{data:t,error:m}=await u.from("media_items").select(`id,
             kind,
             tmdb_title,
             tmdb_name,
             tmdb_original_title,
             tmdb_original_name,
             tmdb_release_date,
             tmdb_first_air_date,
             tmdb_poster_path,
             tmdb_backdrop_path,
             tmdb_original_language,
             omdb_title,
             omdb_year,
             omdb_language,
             omdb_imdb_id,
             omdb_imdb_rating,
             omdb_rating_rotten_tomatoes,
             omdb_poster,
             omdb_rated,
             tmdb_id`).in("id",s);if(!m&&t)for(const c of t){const n=x(c);p.set(c.id,{titleId:c.id,title:n.title??null,year:n.year??null,posterUrl:n.posterUrl??n.backdropUrl??null})}else m&&console.warn("[useListDetail] Failed to load titles",m.message)}const b=d.map(t=>p.get(t.title_id)??{titleId:t.title_id,title:null,year:null,posterUrl:null}).filter(t=>!!t.titleId);return{id:a.id,userId:a.user_id,name:a.name,description:a.description??null,isPublic:!!a.is_public,items:b}}}),w=async r=>{try{if(typeof navigator<"u"&&"share"in navigator){await navigator.share({title:r});return}}catch{}try{await navigator.clipboard.writeText(window.location.href)}catch{}},E=()=>{const r=_(),{listId:a}=f(),{data:i,isLoading:l,isError:o,error:d}=v(a);return e.jsxs("div",{className:"flex flex-1 flex-col pb-24",children:[e.jsx(h,{title:i?.name??"List",actions:[{icon:y,label:"Share",onClick:()=>w(i?.name??"List")}]}),l&&e.jsx("div",{className:"px-4 py-6 text-xs text-muted-foreground",children:"Loading listâ€¦"}),o&&e.jsx("div",{className:"px-4 py-6",children:e.jsxs("div",{className:"rounded-2xl border border-destructive/40 bg-destructive/5 p-4 text-xs text-foreground shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:"Unable to load this list."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:d?.message??"Please try again in a moment."})]})}),!l&&!o&&i&&e.jsxs("div",{className:"px-3 py-4",children:[i.description&&e.jsx("p",{className:"mb-3 text-xs text-muted-foreground",children:i.description}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:i.items.map(s=>e.jsxs("button",{type:"button",className:"group relative overflow-hidden rounded-xl border border-border bg-muted/30",onClick:()=>r(`/title/${s.titleId}`),children:[s.posterUrl?e.jsx("img",{src:s.posterUrl,alt:s.title??"Title",className:"aspect-[2/3] w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"aspect-[2/3] w-full bg-muted"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-background/90 to-transparent px-2 pb-1 pt-6 opacity-0 transition group-hover:opacity-100",children:e.jsx("p",{className:"line-clamp-1 text-left text-[10px] font-semibold text-foreground",children:s.title??"Untitled"})})]},s.titleId))})]})]})};export{E as default};
