import{c as z,k as Xe,b as Ge,l as Kt,s as T,V as ke,O as Te,r as u,T as Qt,U as Zt,j as i,W as Jt,X as er,D as R,Y as tr,R as xe,B as Ie,G as Ke,P as rr,Z as nr,A as Qe,C as $}from"./index-DyWq_Gt8.js";import{u as fe}from"./useMutation-C5YwRx1y.js";import{d as D,k as J,e as Ze,b as or,R as sr,u as ar,c as j,A as Je,P as V,f as lr,h as ir,i as cr,g as ur,F as dr,D as fr,C as pr,j as mr,a as hr}from"./index-C2TJrRZm.js";import"./index-vAwoU-j0.js";import{U as gr}from"./users-D_v2v9Fg.js";import{b as xr,a as vr}from"./format-DMUSBM01.js";import{C as br}from"./circle-alert-CuBiG10P.js";const wr=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],yr=z("arrow-left",wr);const Sr=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],Me=z("check-check",Sr);const Cr=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Pr=z("check",Cr);const jr=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Er=z("pen-line",jr);const _r=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]],Rr=z("shield-x",_r);const Nr=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Ar=z("trash-2",Nr);async function et(e,t,r){const{data:o,error:n}=await e.from("blocked_users").select("blocker_id, blocked_id").or(`and(blocker_id.eq.${t},blocked_id.eq.${r}),and(blocker_id.eq.${r},blocked_id.eq.${t})`);if(n)throw n;const s=o??[],a=s.some(c=>c.blocker_id===t&&c.blocked_id===r),l=s.some(c=>c.blocker_id===r&&c.blocked_id===t);return{youBlocked:a,blockedYou:l}}const go=e=>{const{user:t}=Xe(),r=t?.id??null,o=Ge(),n=["block-status",r,e],s=Kt({queryKey:n,enabled:!!(r&&e&&r!==e),staleTime:3e4,queryFn:async()=>{if(!r||!e||r===e)return{youBlocked:!1,blockedYou:!1};try{return await et(T,r,e)}catch(m){console.error("[useBlockStatus] Failed to load block status",m);const h=m;throw new Error(h.message??"Failed to load block status")}}}),a=fe({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for block operation.");const{error:m}=await T.from("blocked_users").upsert({blocker_id:r,blocked_id:e,created_at:new Date().toISOString()},{onConflict:"blocker_id,blocked_id"});if(m)throw console.error("[useBlockStatus] Failed to block user",m),new Error(m.message)},onSuccess:()=>{o.invalidateQueries({queryKey:n})}}),l=fe({mutationFn:async()=>{if(!r||!e)throw new Error("Missing user ids for unblock operation.");const{error:m}=await T.from("blocked_users").delete().eq("blocker_id",r).eq("blocked_id",e);if(m)throw console.error("[useBlockStatus] Failed to unblock user",m),new Error(m.message)},onSuccess:()=>{o.invalidateQueries({queryKey:n})}}),c=s.data?.youBlocked??!1,d=s.data?.blockedYou??!1,f=c||d,p=a.isPending||l.isPending;return{youBlocked:c,blockedYou:d,isBlocked:f,isLoading:s.isLoading||p,isError:s.isError,error:s.error??null,block:a,unblock:l}},kr=({isSelf:e,isDeleted:t})=>({bubbleColors:t?"bg-muted text-muted-foreground border border-dashed border-border":e?"bg-primary text-primary-foreground":"bg-muted text-foreground",bubbleShape:e?"rounded-tr-3xl rounded-tl-3xl rounded-bl-3xl rounded-br-2xl":"rounded-tr-3xl rounded-tl-3xl rounded-br-3xl rounded-bl-2xl"}),ie=e=>{const t=new Date(e);return Number.isNaN(t.getTime())?"":xr(t,{hour:"numeric",minute:"2-digit",hour12:!0})},pe=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),De=e=>{const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const r=new Date,o=new Date;return o.setDate(r.getDate()-1),pe(t,r)?"Today":pe(t,o)?"Yesterday":vr(t,{day:"numeric",month:"short",year:"numeric"})},$e=(e,t,r=180*1e3)=>{const o=new Date(e),n=new Date(t);return Number.isNaN(o.getTime())||Number.isNaN(n.getTime())?!1:n.getTime()-o.getTime()<=r},Tr=e=>({id:e.id,conversationId:e.conversation_id,senderId:e.user_id,body:e.body??null,attachmentUrl:e.attachment_url??null,createdAt:e.created_at??new Date().toISOString()}),xo=e=>({userId:e.user_id,lastReadAt:e.last_read_at??null,lastReadMessageId:e.last_read_message_id??null}),vo=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,deliveredAt:e.delivered_at??e.created_at??new Date().toISOString()}),bo=e=>({id:e.id,conversationId:e.conversation_id,messageId:e.message_id,userId:e.user_id,emoji:e.emoji,createdAt:e.created_at}),Ir=["conversations"],ce=e=>["conversation",e,"messages"],wo=e=>["conversation",e,"readReceipts"],yo=(e,t)=>["conversation",e,"deliveryReceipts","messageIds",t],So=e=>["conversation",e,"reactions"],re="temp-",ve=e=>e.startsWith(re),Mr=e=>ve(e)?e:`${re}${e}`,Co=(e=Date.now())=>`${re}${e}`,Dr=(e=Date.now())=>`${re}${e}-${Math.random().toString(36).slice(2,8)}`,Po=(e,t={})=>{const{dedupe:r=!0,excludeTemp:o=!1,sort:n=!1}=t,s=e.filter(l=>typeof l=="string").map(l=>l.trim()).filter(Boolean).filter(l=>o?!ve(l):!0),a=r?Array.from(new Set(s)):s;return n&&a.sort(),a},Le=()=>({pages:[{items:[],hasMore:!0,cursor:null}],pageParams:[null]}),X=e=>[...e].sort((t,r)=>{const o=Te(t.createdAt),n=Te(r.createdAt);return o!==n?o-n:t.id.localeCompare(r.id)}),Y=e=>!e||!Array.isArray(e.pages)||!Array.isArray(e.pageParams)?Le():e,G=e=>{const t=(e.pages??[]).map(r=>({...r,items:Array.isArray(r.items)?[...r.items]:[]}));return t.length>0?t:[{items:[],hasMore:!0,cursor:null}]},Oe=(e,t)=>{const r=Y(e),o=G(r),n=o[o.length-1],s=new Map;for(const a of n.items??[])s.set(a.id,a);return s.set(t.id,t),n.items=X(Array.from(s.values())),{...r,pages:o}},jo=(e,t)=>{const r=Y(e),o=G(r).map(n=>({...n,items:(n.items??[]).map(s=>s.id===t.id?t:s)}));return{...r,pages:o}},Eo=(e,t)=>{const r=Y(e),o=G(r).map(n=>({...n,items:(n.items??[]).filter(s=>s.id!==t)}));return{...r,pages:o}},$r=(e,t)=>{const r=Y(e),o=G(r),n=t.tempId??null,s=t.row;if(n)for(const l of o)l.items=(l.items??[]).filter(c=>c.id!==n);let a=!1;for(const l of o){const c=(l.items??[]).findIndex(d=>d.id===s.id);if(c>=0){l.items[c]=s,l.items=X(l.items),a=!0;break}}if(!a){const l=o[o.length-1];l.items=X([...l.items??[],s])}return{...r,pages:o}},_o=(e,t)=>{const r=Tr(t),o=ke(r.body),n=Y(e),s=G(n);if(o)for(const l of s){const c=(l.items??[]).findIndex(d=>ve(d.id)&&ke(d.body)===o);if(c>=0){l.items.splice(c,1);break}}for(const l of s){const c=(l.items??[]).findIndex(d=>d.id===r.id);if(c>=0)return l.items[c]=r,l.items=X(l.items),{...n,pages:s}}const a=s[s.length-1];return a.items=X([...a.items??[],r]),{...n,pages:s}},Lr="id, conversation_id, user_id, body, message_type, text, client_id, meta, attachment_url, created_at",U="chat-media",me=(e=()=>String(Date.now()))=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():e(),he=new Map,tt=()=>Date.now(),rt=e=>{if(!e)return null;const t=he.get(e);return t?t.expiresAt<=tt()?(he.delete(e),null):t.url:null},Or=(e,t,r)=>{if(!e||!t)return;const n=Math.max(0,r*1e3-6e4);he.set(e,{url:t,expiresAt:tt()+n})},be=3600,B=e=>/^https?:\/\//i.test(e),nt=(e,t)=>t&&T.storage.from(e).getPublicUrl(t).data.publicUrl||null,ot=async(e,t,r=be)=>{if(!t)return null;const{data:o,error:n}=await T.storage.from(e).createSignedUrl(t,r);return n||!o?.signedUrl?null:(Or(`${e}:${t}`,o.signedUrl,r),o.signedUrl)};async function Fe(e,t,r){if(!t)return null;if(B(t))return r?.allowHttp?t:null;const o=r?.ttlSeconds??be,n=r?.allowPublicFallback??!1;if(!(r?.forceRefresh??!1)){const a=rt(`${e}:${t}`);if(a)return a}try{const a=await ot(e,t,o);if(a)return a}catch{}if(!n)return null;try{return nt(e,t)}catch{return null}}async function Fr(e,t,r=be){if(t&&!B(t)&&!rt(`${e}:${t}`))try{await ot(e,t,r)}catch{}}const Ue=async e=>{if(!e||B(e))return;const{error:t}=await T.storage.from(U).remove([e]);if(t)throw t},Ur=10*1024*1024,ge={"image/jpg":"jpg","image/jpeg":"jpg","image/pjpeg":"jpg","image/png":"png","image/webp":"webp","image/gif":"gif","image/avif":"avif","image/heic":"heic","image/heif":"heif"},Br=new Set(Object.keys(ge)),Be=e=>{if(e.type&&ge[e.type])return ge[e.type];const t=e.name.split(".").pop()?.toLowerCase()??null;return t?t==="jpeg"?"jpg":["jpg","png","webp","gif","avif","heic","heif"].includes(t)?t:null:null},Hr=(e,t,r)=>{const o=me(()=>String(Date.now()));return`message_attachments/${e}/${t}/${Date.now()}-${o}.${r}`};function Ro(e){const{conversationId:t,userId:r,isBlocked:o,blockedYou:n,attemptSend:s}=e,[a,l]=u.useState(null),[c,d]=u.useState(!1),f=u.useRef(0),p=u.useRef(null),m=u.useCallback(()=>l(null),[]),h=u.useCallback(()=>{f.current+=1,d(!1)},[]),g=u.useCallback(()=>{!t||!r||o||n||p.current?.click()},[n,t,o,r]),x=u.useCallback(async S=>{if(!t||!r||o||n)return;l(null);const y=f.current+=1;d(!0);const A=Be(S);if(!A){l("Unsupported image format."),d(!1);return}const P=Hr(t,r,A);try{const{error:_}=await T.storage.from(U).upload(P,S,{cacheControl:"3600",upsert:!1});if(y!==f.current){try{await Ue(P)}catch{}return}if(_){console.error("[useAttachmentUpload] image upload error",_),l("Upload failed. Please try another image.");return}if(Fr(U,P),y!==f.current){try{await Ue(P)}catch{}return}s({text:"",attachmentPath:P})}catch(_){console.error("[useAttachmentUpload] sendImageFile failed",_),l("Something went wrong while sending your image.")}finally{y===f.current&&d(!1)}},[s,n,t,o,r]),w=u.useCallback(async S=>{const y=S.target.files?.[0];if(S.target.value="",!(!y||!t||!r)&&!c&&!(o||n)){if(y.type){if(!y.type.startsWith("image/")){l("Please choose an image file.");return}if(!Br.has(y.type)){l("Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image.");return}}else if(!Be(y)){l("Unsupported image format. Please choose a JPG, PNG, WebP, GIF, HEIC/HEIF, or AVIF image.");return}if(y.size>Ur){l("That image is too large (max 10MB). Try a smaller file.");return}await x(y)}},[n,t,o,c,x,r]);return{fileInputRef:p,openFilePicker:g,handleImageSelected:w,sendImageFile:x,isUploadingImage:c,uploadError:a,clearUploadError:m,cancelImageUpload:h}}const Wr=(e,t,r,o)=>{if(!t||!Array.isArray(e))return e;const n=e,s=n.findIndex(d=>d.id===t);if(s<0)return e;const a=n[s],l=r(a);if(!l||l===a)return e;const c=[...n];return o?.moveToTop&&s>0?(c.splice(s,1),c.unshift(l),c):(c[s]=l,c)},zr=(e,t,r,o)=>{e.setQueriesData({queryKey:Ir},n=>Wr(n,t,r,o))},He=(e,t,r)=>{const o=e.trim();return!t&&!o?{payload:null,trimmed:o}:t&&o?{payload:{type:"text+image",text:o,clientId:r},trimmed:o}:t?{payload:{type:"image",text:"",clientId:r},trimmed:o}:{payload:{type:"text",text:o,clientId:r},trimmed:o}},No=(e,t)=>{const{user:r}=Xe(),o=r?.id??null,n=Ge();return fe({mutationFn:async({text:s,attachmentPath:a,clientId:l})=>{if(!e)throw new Error("Missing conversation id.");if(!o)throw new Error("You must be signed in to send messages.");if(t?.otherUserId){const h=await et(T,o,t.otherUserId);if(h.youBlocked)throw new Error("You have blocked this user. Unblock them to send messages.");if(h.blockedYou)throw new Error("You cannot send messages because this user blocked you.")}const c=l??me(),{payload:d}=He(s,a??null,c);if(!d)throw new Error("Cannot send an empty message.");const{data:f,error:p}=await T.from("messages").insert({conversation_id:e,user_id:o,sender_id:o,body:d,message_type:d.type,text:d.text??null,client_id:d.clientId??null,meta:d,attachment_url:a??null}).select(Lr).single();if(p)throw console.error("[useSendMessage] Failed to send message",p),new Error(p.message);return{id:f.id,conversationId:f.conversation_id,senderId:f.user_id,body:f.body??null,attachmentUrl:f.attachment_url??null,createdAt:f.created_at}},onMutate:async s=>{if(!e||!o)return{previous:void 0,tempId:null};const{text:a,attachmentPath:l}=s,c=s.clientId??me();s.clientId=c;const{payload:d,trimmed:f}=He(a,l??null,c);if(!d)throw new Error("Cannot send an empty message.");const p=s.tempId,m=typeof p=="string"&&p.length?Mr(p):Dr(),h=new Date().toISOString(),g={id:m,conversationId:e,senderId:o,body:d,attachmentUrl:l??null,createdAt:h},x=ce(e);await n.cancelQueries({queryKey:x});const w=n.getQueryData(x);return n.setQueryData(x,S=>Oe(S,g)),{previous:w,tempId:m,optimistic:g,payload:{text:f,attachmentPath:l??null,clientId:c}}},onError:(s,a,l)=>{if(console.error("[useSendMessage] sendMessage error",s),!e)return;const{previous:c,optimistic:d,payload:f,tempId:p}=l??{previous:void 0,tempId:null},m=ce(e);n.setQueryData(m,h=>d?Oe(c??h,d):Y(c??h)),p&&f&&t?.onFailed&&t.onFailed(p,f)},onSuccess:(s,a,l)=>{if(!e)return;const c=l?.tempId,d=ce(e);n.setQueryData(d,f=>$r(f,{tempId:c,row:s})),zr(n,e,f=>({...f,lastMessagePreview:Zt(s.body)??f.lastMessagePreview,lastMessageAt:s.createdAt??f.lastMessageAt,lastMessageAtLabel:Qt(s.createdAt??null),hasUnread:!1,lastMessageIsFromSelf:!0,lastMessageSeenByOthers:!1}),{moveToTop:!0}),t?.onRecovered&&t.onRecovered(l?.tempId??null)}})};function Vr(e,t=[]){let r=[];function o(s,a){const l=u.createContext(a);l.displayName=s+"Context";const c=r.length;r=[...r,a];const d=p=>{const{scope:m,children:h,...g}=p,x=m?.[e]?.[c]||l,w=u.useMemo(()=>g,Object.values(g));return i.jsx(x.Provider,{value:w,children:h})};d.displayName=s+"Provider";function f(p,m){const h=m?.[e]?.[c]||l,g=u.useContext(h);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${p}\` must be used within \`${s}\``)}return[d,f]}const n=()=>{const s=r.map(a=>u.createContext(a));return function(l){const c=l?.[e]||s;return u.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return n.scopeName=e,[o,Yr(n,...t)]}function Yr(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(s){const a=o.reduce((l,{useScope:c,scopeName:d})=>{const p=c(s)[`__scope${d}`];return{...l,...p}},{});return u.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return r.scopeName=t.scopeName,r}var qr=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],we=qr.reduce((e,t)=>{const r=Jt(`Primitive.${t}`),o=u.forwardRef((n,s)=>{const{asChild:a,...l}=n,c=a?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:s})});return o.displayName=`Primitive.${t}`,{...e,[t]:o}},{}),ue={exports:{}},de={};var We;function Xr(){if(We)return de;We=1;var e=er();function t(p,m){return p===m&&(p!==0||1/p===1/m)||p!==p&&m!==m}var r=typeof Object.is=="function"?Object.is:t,o=e.useState,n=e.useEffect,s=e.useLayoutEffect,a=e.useDebugValue;function l(p,m){var h=m(),g=o({inst:{value:h,getSnapshot:m}}),x=g[0].inst,w=g[1];return s(function(){x.value=h,x.getSnapshot=m,c(x)&&w({inst:x})},[p,h,m]),n(function(){return c(x)&&w({inst:x}),p(function(){c(x)&&w({inst:x})})},[p]),a(h),h}function c(p){var m=p.getSnapshot;p=p.value;try{var h=m();return!r(p,h)}catch{return!0}}function d(p,m){return m()}var f=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:l;return de.useSyncExternalStore=e.useSyncExternalStore!==void 0?e.useSyncExternalStore:f,de}var ze;function Gr(){return ze||(ze=1,ue.exports=Xr()),ue.exports}var Kr=Gr();function Qr(){return Kr.useSyncExternalStore(Zr,()=>!0,()=>!1)}function Zr(){return()=>{}}var ye="Avatar",[Jr]=Vr(ye),[en,st]=Jr(ye),at=u.forwardRef((e,t)=>{const{__scopeAvatar:r,...o}=e,[n,s]=u.useState("idle");return i.jsx(en,{scope:r,imageLoadingStatus:n,onImageLoadingStatusChange:s,children:i.jsx(we.span,{...o,ref:t})})});at.displayName=ye;var lt="AvatarImage",it=u.forwardRef((e,t)=>{const{__scopeAvatar:r,src:o,onLoadingStatusChange:n=()=>{},...s}=e,a=st(lt,r),l=tn(o,s),c=D(d=>{n(d),a.onImageLoadingStatusChange(d)});return J(()=>{l!=="idle"&&c(l)},[l,c]),l==="loaded"?i.jsx(we.img,{...s,ref:t,src:o}):null});it.displayName=lt;var ct="AvatarFallback",ut=u.forwardRef((e,t)=>{const{__scopeAvatar:r,delayMs:o,...n}=e,s=st(ct,r),[a,l]=u.useState(o===void 0);return u.useEffect(()=>{if(o!==void 0){const c=window.setTimeout(()=>l(!0),o);return()=>window.clearTimeout(c)}},[o]),a&&s.imageLoadingStatus!=="loaded"?i.jsx(we.span,{...n,ref:t}):null});ut.displayName=ct;function Ve(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function tn(e,{referrerPolicy:t,crossOrigin:r}){const o=Qr(),n=u.useRef(null),s=o?(n.current||(n.current=new window.Image),n.current):null,[a,l]=u.useState(()=>Ve(s,e));return J(()=>{l(Ve(s,e))},[s,e]),J(()=>{const c=p=>()=>{l(p)};if(!s)return;const d=c("loaded"),f=c("error");return s.addEventListener("load",d),s.addEventListener("error",f),t&&(s.referrerPolicy=t),typeof r=="string"&&(s.crossOrigin=r),()=>{s.removeEventListener("load",d),s.removeEventListener("error",f)}},[s,r,t]),a}var dt=at,ft=it,pt=ut;const mt=u.forwardRef(({className:e,...t},r)=>i.jsx(dt,{ref:r,className:R("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full border border-border bg-muted",e),...t}));mt.displayName=dt.displayName;const ht=u.forwardRef(({className:e,...t},r)=>i.jsx(ft,{ref:r,className:R("aspect-square h-full w-full object-cover",e),...t}));ht.displayName=ft.displayName;const gt=u.forwardRef(({className:e,...t},r)=>i.jsx(pt,{ref:r,className:R("flex h-full w-full items-center justify-center bg-muted text-sm font-medium text-muted-foreground",e),...t}));gt.displayName=pt.displayName;const rn=tr("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow",secondary:"border-transparent bg-secondary text-secondary-foreground",destructive:"border-transparent bg-destructive text-destructive-foreground shadow",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function nn({className:e,variant:t,...r}){return i.jsx("div",{className:R(rn({variant:t}),e),...r})}function Ye({className:e,...t}){return i.jsx("div",{className:R("animate-pulse rounded-md bg-muted",e),...t})}const on=xe.forwardRef(({conversation:e,isLoading:t,isGroupConversation:r,otherParticipant:o,onBack:n,onToggleBlock:s,blockPending:a,youBlocked:l,blockedYou:c},d)=>{const f=e?.title??o?.displayName??o?.username??"Conversation",p=e?.subtitle??(r?`${e?.participants?.length??""} participants`:o?.username?`@${o.username}`:"Direct message"),m=r?void 0:o?.avatarUrl,h=r?e?.title?.slice(0,2).toUpperCase()??"GM":(o?.displayName??o?.username??"?").slice(0,2).toUpperCase();return i.jsx("header",{ref:d,className:"fixed inset-x-0 top-0 z-30 w-full border-b border-border bg-card/90 px-4 py-3 backdrop-blur",children:i.jsxs("div",{className:"mx-auto flex w-full max-w-3xl items-center gap-3",children:[i.jsx(Ie,{variant:"ghost",size:"icon",onClick:n,"aria-label":"Back to messages",children:i.jsx(yr,{className:"h-4 w-4","aria-hidden":!0})}),i.jsxs(mt,{className:"h-11 w-11",children:[i.jsx(ht,{src:m??void 0,alt:f}),i.jsx(gt,{children:h})]}),i.jsx("div",{className:"min-w-0 flex-1",children:t?i.jsxs("div",{className:"space-y-2",children:[i.jsx(Ye,{className:"h-4 w-36"}),i.jsx(Ye,{className:"h-3 w-24"})]}):i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:f}),r&&i.jsxs(nn,{variant:"outline",className:"gap-1",children:[i.jsx(gr,{className:"h-3 w-3","aria-hidden":!0}),"Group chat"]})]}),i.jsx("p",{className:"truncate text-xs text-muted-foreground",children:p})]})}),s&&!r&&i.jsxs(Ie,{type:"button",variant:l?"destructive":"outline",size:"sm",className:"gap-2",disabled:a||t||c&&!l,onClick:s,children:[a&&i.jsx(Ke,{className:"h-4 w-4 animate-spin","aria-hidden":!0}),i.jsx(Rr,{className:"h-4 w-4","aria-hidden":!0}),l?"Unblock":c?"Blocked":"Block"]})]})})});on.displayName="ConversationHeader";const sn=xe.memo(function({isSelf:t,isDeleted:r,children:o,className:n="",role:s,tabIndex:a,...l}){const{bubbleColors:c,bubbleShape:d}=kr({isSelf:t,isDeleted:r});return i.jsx("div",{role:s??"button",tabIndex:a??0,className:R("inline-flex max-w-[80%] px-4 py-2.5 text-sm transition-transform duration-150 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",d,c,n),...l,children:i.jsx("div",{className:"flex flex-col gap-1 text-left leading-relaxed",children:o})})}),an=/((?:https?:\/\/|www\.)[^\s<]+[^<.,:;"')\]\s])/gi,ln=/([A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,})/gi,cn=/(\+?\d[\d\s().-]{7,}\d)/g,un=e=>/^https?:\/\//i.test(e)?e:/^www\./i.test(e)?`https://${e}`:e,xt=e=>e.replace(/\D/g,""),dn=e=>{const t=e.trim(),r=t.startsWith("+"),o=xt(t);return`${r?"+":""}${o}`},fn=({text:e})=>{const t=a=>{a.stopPropagation()},r=[],o=(a,l)=>{const c=new RegExp(a);let d;for(;(d=c.exec(e))!==null;)r.push({start:d.index,end:d.index+d[0].length,kind:l,raw:d[0]})};o(an,"url"),o(ln,"email"),o(cn,"phone"),r.sort((a,l)=>a.start-l.start||l.end-a.end);const n=[];let s=0;for(const a of r)if(!(a.start<s)&&!(a.kind==="phone"&&xt(a.raw).length<10)){if(a.start>s&&n.push(e.slice(s,a.start)),a.kind==="url"){const l=un(a.raw);n.push(i.jsx("a",{href:l,target:"_blank",rel:"noreferrer noopener",className:"underline underline-offset-2",onMouseDown:t,onClick:t,onTouchStart:t,children:a.raw},`${a.start}-${a.raw}`))}else if(a.kind==="email")n.push(i.jsx("a",{href:`mailto:${a.raw}`,className:"underline underline-offset-2",onMouseDown:t,onClick:t,onTouchStart:t,children:a.raw},`${a.start}-${a.raw}`));else{const l=dn(a.raw);n.push(i.jsx("a",{href:`tel:${l}`,className:"underline underline-offset-2",onMouseDown:t,onClick:t,onTouchStart:t,children:a.raw},`${a.start}-${a.raw}`))}s=a.end}return s<e.length&&n.push(e.slice(s)),i.jsx(i.Fragment,{children:n})},pn=({path:e})=>{const[t,r]=u.useState(null),[o,n]=u.useState(!1),s=u.useRef(!0),a=u.useRef(null),l=u.useRef(!1);return u.useEffect(()=>()=>{s.current=!1},[]),u.useEffect(()=>{let c=!1;return a.current=e||null,l.current=!1,r(null),n(!1),e?B(e)?(n(!0),()=>{c=!0}):((async()=>{try{const d=await Fe(U,e,{allowPublicFallback:!0,forceRefresh:!0});if(c||a.current!==e||!s.current)return;if(!d){n(!0);return}r(d)}catch{!c&&s.current&&a.current===e&&n(!0)}})(),()=>{c=!0}):(n(!0),()=>{c=!0})},[e]),o?e&&B(e)?i.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["External image link:"," ",i.jsx("a",{href:e,target:"_blank",rel:"noreferrer",className:"underline underline-offset-2",children:"open"})]}):i.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Image unavailable."}):t?i.jsx("div",{className:"mt-1 overflow-hidden rounded-xl border border-border bg-background/80",children:i.jsx("img",{src:t,alt:"Attachment",className:"max-h-64 w-full object-cover",loading:"lazy",onError:async()=>{if(!(!s.current||a.current!==e)){if(B(e)){n(!0);return}try{const c=nt(U,e);if(c&&t===c){n(!0);return}if(l.current){n(!0);return}l.current=!0;const d=await Fe(U,e,{allowPublicFallback:!0,forceRefresh:!0});if(!d||d===t){n(!0);return}if(!s.current||a.current!==e)return;r(d)}catch{s.current&&a.current===e&&n(!0)}}}})}):i.jsx("div",{className:"mt-1 h-32 w-40 animate-pulse rounded-xl bg-border/40"})},mn=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™","ðŸ”¥","ðŸ˜"],Ao=xe.memo(function({message:t,meta:r,sender:o,isSelf:n,deliveryStatus:s,showDeliveryStatus:a,reactions:l,index:c,previousMessage:d,nextMessage:f,firstUnreadIndex:p,activeActionMessageId:m,longPressTriggeredRef:h,onOpenMessageActions:g,onCloseMessageActions:x,onOpenEditDialog:w,onOpenDeleteDialog:S,onToggleReaction:y,onRetryMessage:A,onDiscardFailedMessage:P,onBubbleTouchStart:_,onBubbleTouchEndOrCancel:I}){const O=d!=null&&d.senderId===t.senderId,F=f!=null&&f.senderId===t.senderId,b=O&&$e(d.createdAt,t.createdAt),C=F&&$e(t.createdAt,f.createdAt),k=!(O&&b),_e=!(F&&C),Vt=p!=null&&c===p,Re=c===0||d!=null&&!pe(new Date(d.createdAt),new Date(t.createdAt)),Yt=c===0||Re?"mt-0":k?"mt-3":"mt-1.5",M=r.deleted===!0,Ne=r.editedAt,Ae=r.deletedAt,ae=ie(t.createdAt),q=o?.displayName??(n?"You":"Someone"),Z=M?"This message was deleted":rr(t.body),qt=(()=>{const v=n?"You":q;return M?`${v} deleted a message`:Z?`${v} said: ${Z}`:t.attachmentUrl?`${v} sent an attachment`:`${v} sent a message`})(),Xt=!n&&_e,le=()=>{if(h.current){h.current=!1;return}m===t.id?x():g(t)};return i.jsxs("div",{className:"px-0",children:[Re&&i.jsx("div",{className:"my-4 flex items-center justify-center",children:i.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-muted-foreground",children:[i.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),i.jsx("span",{className:"rounded-full bg-muted px-3 py-0.5 text-xs font-medium text-muted-foreground",children:De(t.createdAt)}),i.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),Vt&&i.jsx("div",{className:"my-4 flex items-center justify-center",role:"separator","aria-label":"New messages",children:i.jsxs("div",{className:"inline-flex items-center gap-3 text-xs text-primary",children:[i.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"}),i.jsx("span",{className:"rounded-full bg-primary/10 px-3 py-0.5 text-xs font-semibold text-primary",children:"New messages"}),i.jsx("span",{className:"h-px w-12 bg-border","aria-hidden":"true"})]})}),k&&i.jsx("div",{className:`mb-1 flex ${n?"justify-end pr-1":"justify-start pl-9"}`,children:i.jsxs("div",{className:"inline-flex max-w-full items-center gap-2 rounded-full border border-border bg-muted/80 px-2.5 py-1 text-[11px] text-muted-foreground shadow-sm","aria-label":`Start of new message from ${n?"You":q} at ${ae}`,title:`${n?"You":q} Â· ${De(t.createdAt)} ${ae}`,children:[i.jsx("span",{className:"max-w-[10rem] truncate text-foreground",children:n?"You":q}),i.jsx("span",{className:"h-1 w-1 rounded-full bg-border","aria-hidden":!0}),i.jsx("span",{children:ae})]})}),i.jsxs("div",{className:`flex w-full flex-col gap-0.5 ${Yt}`,children:[i.jsxs("div",{className:`flex w-full items-end gap-2 ${n?"justify-end":"justify-start"}`,children:[!n&&i.jsx(i.Fragment,{children:Xt?i.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0 overflow-hidden rounded-full bg-muted",children:o?.avatarUrl?i.jsx("img",{src:o.avatarUrl,alt:o.displayName??void 0,className:"h-full w-full object-cover",loading:"lazy"}):i.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs font-medium text-muted-foreground",children:q.slice(0,2).toUpperCase()})}):i.jsx("div",{className:"mt-auto h-7 w-7 flex-shrink-0"})}),i.jsxs(sn,{isSelf:n,isDeleted:M,onClick:le,onContextMenu:v=>{v.preventDefault(),le()},onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),le())},onTouchStart:()=>_(t),onTouchEnd:I,onTouchCancel:I,"aria-label":qt,children:[Z&&i.jsx("p",{className:"whitespace-pre-wrap break-words [overflow-wrap:anywhere] text-sm leading-snug",children:i.jsx(fn,{text:Z})}),!M&&t.attachmentUrl&&i.jsx(pn,{path:t.attachmentUrl})]})]}),l.length>0&&i.jsx("div",{className:`mt-0.5 flex w-full ${n?"justify-end pr-6":"justify-start pl-6"}`,children:i.jsx("div",{className:"inline-flex flex-wrap items-center gap-1 rounded-full bg-muted px-1.5 py-0.5 text-xs text-foreground",children:l.map(v=>i.jsxs("button",{type:"button",onClick:()=>y(t.id,v.emoji),className:`inline-flex items-center gap-1 rounded-full px-1.5 py-0.5 transition hover:bg-background ${v.reactedBySelf?"bg-primary/10":""}`,children:[i.jsx("span",{className:"text-[17px]",children:v.emoji}),v.count>1&&i.jsx("span",{className:"text-xs text-muted-foreground",children:v.count})]},v.emoji))})}),m===t.id&&!M&&i.jsx("div",{className:`mt-1 flex w-full ${n?"justify-end pr-6":"justify-start pl-6"}`,children:i.jsxs("div",{className:"inline-flex flex-col items-stretch gap-1 rounded-2xl bg-muted px-2.5 py-1.5 text-xs text-foreground select-none",children:[i.jsx("div",{className:"flex items-center justify-center gap-1",children:mn.map(v=>i.jsx("button",{type:"button",onClick:()=>{y(t.id,v),x()},className:"flex h-7 w-7 items-center justify-center rounded-full transition hover:bg-background",children:i.jsx("span",{className:"text-[17px]",children:v})},v))}),n&&i.jsxs("div",{className:"mt-1 flex items-center justify-end gap-2",children:[(()=>{if(t.attachmentUrl||M)return null;const v=nr(t.body);return v!=="text"&&v!=="unknown"?null:i.jsxs("button",{type:"button",onClick:Gt=>w(t,Gt.currentTarget),className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-muted-foreground hover:bg-background",children:[i.jsx(Er,{className:"h-3.5 w-3.5","aria-hidden":!0}),i.jsx("span",{children:"Edit"})]})})(),i.jsxs("button",{type:"button",onClick:()=>S(t),className:"inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs text-destructive hover:bg-destructive/10",children:[i.jsx(Ar,{className:"h-3.5 w-3.5","aria-hidden":!0}),i.jsx("span",{children:"Delete"})]})]})]})}),a&&s&&i.jsx("div",{className:`flex items-center gap-1 text-xs text-muted-foreground ${n?"justify-end pr-1":"justify-start pl-7"}`,children:s.status==="failed"?i.jsxs(i.Fragment,{children:[i.jsx(br,{className:"h-3 w-3 text-destructive","aria-hidden":!0}),i.jsx("span",{children:"Failed to send."}),i.jsx("button",{type:"button",className:"text-destructive underline",onClick:()=>A(t),children:"Retry"}),i.jsx("span",{"aria-hidden":"true",children:"Â·"}),i.jsx("button",{type:"button",className:"text-destructive underline",onClick:()=>P(t),children:"Discard"})]}):s.status==="sending"?i.jsxs(i.Fragment,{children:[i.jsx(Ke,{className:"h-3 w-3 animate-spin","aria-hidden":!0}),i.jsx("span",{children:"Sendingâ€¦"})]}):s.status==="sent"?i.jsxs(i.Fragment,{children:[i.jsx(Pr,{className:"h-3 w-3","aria-hidden":!0}),i.jsx("span",{children:"Sent"})]}):s.status==="delivered"?i.jsxs(i.Fragment,{children:[i.jsx(Me,{className:"h-3 w-3","aria-hidden":!0}),i.jsx("span",{children:"Delivered"})]}):i.jsxs(i.Fragment,{children:[i.jsx(Me,{className:"h-3 w-3","aria-hidden":!0}),i.jsx("span",{children:"Seen"})]})}),M&&Ae&&i.jsxs("p",{className:`text-xs text-muted-foreground ${n?"text-right pr-1":"text-left pl-7"}`,children:["Deleted ",ie(Ae)]}),!M&&Ne&&i.jsxs("p",{className:`text-xs text-muted-foreground ${n?"text-right pr-1":"text-left pl-7"}`,children:["Edited ",ie(Ne)]})]})]},t.id)}),hn=u.forwardRef(({className:e,...t},r)=>i.jsx("textarea",{className:R("flex min-h-[80px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));hn.displayName="Textarea";function gn(e,t=[]){let r=[];function o(s,a){const l=u.createContext(a),c=r.length;r=[...r,a];const d=p=>{const{scope:m,children:h,...g}=p,x=m?.[e]?.[c]||l,w=u.useMemo(()=>g,Object.values(g));return i.jsx(x.Provider,{value:w,children:h})};d.displayName=s+"Provider";function f(p,m){const h=m?.[e]?.[c]||l,g=u.useContext(h);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${p}\` must be used within \`${s}\``)}return[d,f]}const n=()=>{const s=r.map(a=>u.createContext(a));return function(l){const c=l?.[e]||s;return u.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return n.scopeName=e,[o,xn(n,...t)]}function xn(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(s){const a=o.reduce((l,{useScope:c,scopeName:d})=>{const p=c(s)[`__scope${d}`];return{...l,...p}},{});return u.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return r.scopeName=t.scopeName,r}function vt(e){const t=vn(e),r=u.forwardRef((o,n)=>{const{children:s,...a}=o,l=u.Children.toArray(s),c=l.find(wn);if(c){const d=c.props.children,f=l.map(p=>p===c?u.Children.count(d)>1?u.Children.only(null):u.isValidElement(d)?d.props.children:null:p);return i.jsx(t,{...a,ref:n,children:u.isValidElement(d)?u.cloneElement(d,void 0,f):null})}return i.jsx(t,{...a,ref:n,children:s})});return r.displayName=`${e}.Slot`,r}function vn(e){const t=u.forwardRef((r,o)=>{const{children:n,...s}=r;if(u.isValidElement(n)){const a=Sn(n),l=yn(s,n.props);return n.type!==u.Fragment&&(l.ref=o?Qe(o,a):a),u.cloneElement(n,l)}return u.Children.count(n)>1?u.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var bn=Symbol("radix.slottable");function wn(e){return u.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===bn}function yn(e,t){const r={...t};for(const o in t){const n=e[o],s=t[o];/^on[A-Z]/.test(o)?n&&s?r[o]=(...l)=>{const c=s(...l);return n(...l),c}:n&&(r[o]=n):o==="style"?r[o]={...n,...s}:o==="className"&&(r[o]=[n,s].filter(Boolean).join(" "))}return{...e,...r}}function Sn(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var Cn=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],bt=Cn.reduce((e,t)=>{const r=vt(`Primitive.${t}`),o=u.forwardRef((n,s)=>{const{asChild:a,...l}=n,c=a?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:s})});return o.displayName=`Primitive.${t}`,{...e,[t]:o}},{}),ne="Popover",[wt]=gn(ne,[Ze]),K=Ze(),[Pn,L]=wt(ne),yt=e=>{const{__scopePopover:t,children:r,open:o,defaultOpen:n,onOpenChange:s,modal:a=!1}=e,l=K(t),c=u.useRef(null),[d,f]=u.useState(!1),[p,m]=or({prop:o,defaultProp:n??!1,onChange:s,caller:ne});return i.jsx(sr,{...l,children:i.jsx(Pn,{scope:t,contentId:ar(),triggerRef:c,open:p,onOpenChange:m,onOpenToggle:u.useCallback(()=>m(h=>!h),[m]),hasCustomAnchor:d,onCustomAnchorAdd:u.useCallback(()=>f(!0),[]),onCustomAnchorRemove:u.useCallback(()=>f(!1),[]),modal:a,children:r})})};yt.displayName=ne;var St="PopoverAnchor",jn=u.forwardRef((e,t)=>{const{__scopePopover:r,...o}=e,n=L(St,r),s=K(r),{onCustomAnchorAdd:a,onCustomAnchorRemove:l}=n;return u.useEffect(()=>(a(),()=>l()),[a,l]),i.jsx(Je,{...s,...o,ref:t})});jn.displayName=St;var Ct="PopoverTrigger",Pt=u.forwardRef((e,t)=>{const{__scopePopover:r,...o}=e,n=L(Ct,r),s=K(r),a=$(t,n.triggerRef),l=i.jsx(bt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":Nt(n.open),...o,ref:a,onClick:j(e.onClick,n.onOpenToggle)});return n.hasCustomAnchor?l:i.jsx(Je,{asChild:!0,...s,children:l})});Pt.displayName=Ct;var Se="PopoverPortal",[En,_n]=wt(Se,{forceMount:void 0}),jt=e=>{const{__scopePopover:t,forceMount:r,children:o,container:n}=e,s=L(Se,t);return i.jsx(En,{scope:t,forceMount:r,children:i.jsx(V,{present:r||s.open,children:i.jsx(lr,{asChild:!0,container:n,children:o})})})};jt.displayName=Se;var H="PopoverContent",Et=u.forwardRef((e,t)=>{const r=_n(H,e.__scopePopover),{forceMount:o=r.forceMount,...n}=e,s=L(H,e.__scopePopover);return i.jsx(V,{present:o||s.open,children:s.modal?i.jsx(Nn,{...n,ref:t}):i.jsx(An,{...n,ref:t})})});Et.displayName=H;var Rn=vt("PopoverContent.RemoveScroll"),Nn=u.forwardRef((e,t)=>{const r=L(H,e.__scopePopover),o=u.useRef(null),n=$(t,o),s=u.useRef(!1);return u.useEffect(()=>{const a=o.current;if(a)return ir(a)},[]),i.jsx(cr,{as:Rn,allowPinchZoom:!0,children:i.jsx(_t,{...e,ref:n,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:j(e.onCloseAutoFocus,a=>{a.preventDefault(),s.current||r.triggerRef.current?.focus()}),onPointerDownOutside:j(e.onPointerDownOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;s.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:j(e.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),An=u.forwardRef((e,t)=>{const r=L(H,e.__scopePopover),o=u.useRef(!1),n=u.useRef(!1);return i.jsx(_t,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{e.onCloseAutoFocus?.(s),s.defaultPrevented||(o.current||r.triggerRef.current?.focus(),s.preventDefault()),o.current=!1,n.current=!1},onInteractOutside:s=>{e.onInteractOutside?.(s),s.defaultPrevented||(o.current=!0,s.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const a=s.target;r.triggerRef.current?.contains(a)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&n.current&&s.preventDefault()}})}),_t=u.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:o,onOpenAutoFocus:n,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:f,...p}=e,m=L(H,r),h=K(r);return ur(),i.jsx(dr,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:n,onUnmountAutoFocus:s,children:i.jsx(fr,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:f,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>m.onOpenChange(!1),children:i.jsx(pr,{"data-state":Nt(m.open),role:"dialog",id:m.contentId,...h,...p,ref:t,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Rt="PopoverClose",kn=u.forwardRef((e,t)=>{const{__scopePopover:r,...o}=e,n=L(Rt,r);return i.jsx(bt.button,{type:"button",...o,ref:t,onClick:j(e.onClick,()=>n.onOpenChange(!1))})});kn.displayName=Rt;var Tn="PopoverArrow",In=u.forwardRef((e,t)=>{const{__scopePopover:r,...o}=e,n=K(r);return i.jsx(mr,{...n,...o,ref:t})});In.displayName=Tn;function Nt(e){return e?"open":"closed"}var Mn=yt,Dn=Pt,$n=jt,At=Et;const ko=Mn,To=Dn,Ln=u.forwardRef(({className:e,align:t="center",sideOffset:r=4,...o},n)=>i.jsx($n,{children:i.jsx(At,{ref:n,align:t,sideOffset:r,className:R("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=open]:zoom-in-95 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...o})}));Ln.displayName=At.displayName;function On(e){const t=Fn(e),r=u.forwardRef((o,n)=>{const{children:s,...a}=o,l=u.Children.toArray(s),c=l.find(Bn);if(c){const d=c.props.children,f=l.map(p=>p===c?u.Children.count(d)>1?u.Children.only(null):u.isValidElement(d)?d.props.children:null:p);return i.jsx(t,{...a,ref:n,children:u.isValidElement(d)?u.cloneElement(d,void 0,f):null})}return i.jsx(t,{...a,ref:n,children:s})});return r.displayName=`${e}.Slot`,r}function Fn(e){const t=u.forwardRef((r,o)=>{const{children:n,...s}=r;if(u.isValidElement(n)){const a=Wn(n),l=Hn(s,n.props);return n.type!==u.Fragment&&(l.ref=o?Qe(o,a):a),u.cloneElement(n,l)}return u.Children.count(n)>1?u.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Un=Symbol("radix.slottable");function Bn(e){return u.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Un}function Hn(e,t){const r={...t};for(const o in t){const n=e[o],s=t[o];/^on[A-Z]/.test(o)?n&&s?r[o]=(...l)=>{const c=s(...l);return n(...l),c}:n&&(r[o]=n):o==="style"?r[o]={...n,...s}:o==="className"&&(r[o]=[n,s].filter(Boolean).join(" "))}return{...e,...r}}function Wn(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var zn=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Q=zn.reduce((e,t)=>{const r=On(`Primitive.${t}`),o=u.forwardRef((n,s)=>{const{asChild:a,...l}=n,c=a?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:s})});return o.displayName=`Primitive.${t}`,{...e,[t]:o}},{});function Vn(e,t=[]){let r=[];function o(s,a){const l=u.createContext(a),c=r.length;r=[...r,a];const d=p=>{const{scope:m,children:h,...g}=p,x=m?.[e]?.[c]||l,w=u.useMemo(()=>g,Object.values(g));return i.jsx(x.Provider,{value:w,children:h})};d.displayName=s+"Provider";function f(p,m){const h=m?.[e]?.[c]||l,g=u.useContext(h);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${p}\` must be used within \`${s}\``)}return[d,f]}const n=()=>{const s=r.map(a=>u.createContext(a));return function(l){const c=l?.[e]||s;return u.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return n.scopeName=e,[o,Yn(n,...t)]}function Yn(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const o=e.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(s){const a=o.reduce((l,{useScope:c,scopeName:d})=>{const p=c(s)[`__scope${d}`];return{...l,...p}},{});return u.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return r.scopeName=t.scopeName,r}function qn(e,[t,r]){return Math.min(r,Math.max(t,e))}function Xn(e,t){return u.useReducer((r,o)=>t[r][o]??r,e)}var Ce="ScrollArea",[kt]=Vn(Ce),[Gn,E]=kt(Ce),Tt=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:o="hover",dir:n,scrollHideDelay:s=600,...a}=e,[l,c]=u.useState(null),[d,f]=u.useState(null),[p,m]=u.useState(null),[h,g]=u.useState(null),[x,w]=u.useState(null),[S,y]=u.useState(0),[A,P]=u.useState(0),[_,I]=u.useState(!1),[O,F]=u.useState(!1),b=$(t,k=>c(k)),C=hr(n);return i.jsx(Gn,{scope:r,type:o,dir:C,scrollHideDelay:s,scrollArea:l,viewport:d,onViewportChange:f,content:p,onContentChange:m,scrollbarX:h,onScrollbarXChange:g,scrollbarXEnabled:_,onScrollbarXEnabledChange:I,scrollbarY:x,onScrollbarYChange:w,scrollbarYEnabled:O,onScrollbarYEnabledChange:F,onCornerWidthChange:y,onCornerHeightChange:P,children:i.jsx(Q.div,{dir:C,...a,ref:b,style:{position:"relative","--radix-scroll-area-corner-width":S+"px","--radix-scroll-area-corner-height":A+"px",...e.style}})})});Tt.displayName=Ce;var It="ScrollAreaViewport",Mt=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:o,nonce:n,...s}=e,a=E(It,r),l=u.useRef(null),c=$(t,l,a.onViewportChange);return i.jsxs(i.Fragment,{children:[i.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),i.jsx(Q.div,{"data-radix-scroll-area-viewport":"",...s,ref:c,style:{overflowX:a.scrollbarXEnabled?"scroll":"hidden",overflowY:a.scrollbarYEnabled?"scroll":"hidden",...e.style},children:i.jsx("div",{ref:a.onContentChange,style:{minWidth:"100%",display:"table"},children:o})})]})});Mt.displayName=It;var N="ScrollAreaScrollbar",Pe=u.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=E(N,e.__scopeScrollArea),{onScrollbarXEnabledChange:s,onScrollbarYEnabledChange:a}=n,l=e.orientation==="horizontal";return u.useEffect(()=>(l?s(!0):a(!0),()=>{l?s(!1):a(!1)}),[l,s,a]),n.type==="hover"?i.jsx(Kn,{...o,ref:t,forceMount:r}):n.type==="scroll"?i.jsx(Qn,{...o,ref:t,forceMount:r}):n.type==="auto"?i.jsx(Dt,{...o,ref:t,forceMount:r}):n.type==="always"?i.jsx(je,{...o,ref:t}):null});Pe.displayName=N;var Kn=u.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=E(N,e.__scopeScrollArea),[s,a]=u.useState(!1);return u.useEffect(()=>{const l=n.scrollArea;let c=0;if(l){const d=()=>{window.clearTimeout(c),a(!0)},f=()=>{c=window.setTimeout(()=>a(!1),n.scrollHideDelay)};return l.addEventListener("pointerenter",d),l.addEventListener("pointerleave",f),()=>{window.clearTimeout(c),l.removeEventListener("pointerenter",d),l.removeEventListener("pointerleave",f)}}},[n.scrollArea,n.scrollHideDelay]),i.jsx(V,{present:r||s,children:i.jsx(Dt,{"data-state":s?"visible":"hidden",...o,ref:t})})}),Qn=u.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=E(N,e.__scopeScrollArea),s=e.orientation==="horizontal",a=se(()=>c("SCROLL_END"),100),[l,c]=Xn("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return u.useEffect(()=>{if(l==="idle"){const d=window.setTimeout(()=>c("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(d)}},[l,n.scrollHideDelay,c]),u.useEffect(()=>{const d=n.viewport,f=s?"scrollLeft":"scrollTop";if(d){let p=d[f];const m=()=>{const h=d[f];p!==h&&(c("SCROLL"),a()),p=h};return d.addEventListener("scroll",m),()=>d.removeEventListener("scroll",m)}},[n.viewport,s,c,a]),i.jsx(V,{present:r||l!=="hidden",children:i.jsx(je,{"data-state":l==="hidden"?"hidden":"visible",...o,ref:t,onPointerEnter:j(e.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:j(e.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),Dt=u.forwardRef((e,t)=>{const r=E(N,e.__scopeScrollArea),{forceMount:o,...n}=e,[s,a]=u.useState(!1),l=e.orientation==="horizontal",c=se(()=>{if(r.viewport){const d=r.viewport.offsetWidth<r.viewport.scrollWidth,f=r.viewport.offsetHeight<r.viewport.scrollHeight;a(l?d:f)}},10);return W(r.viewport,c),W(r.content,c),i.jsx(V,{present:o||s,children:i.jsx(je,{"data-state":s?"visible":"hidden",...n,ref:t})})}),je=u.forwardRef((e,t)=>{const{orientation:r="vertical",...o}=e,n=E(N,e.__scopeScrollArea),s=u.useRef(null),a=u.useRef(0),[l,c]=u.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=Ut(l.viewport,l.content),f={...o,sizes:l,onSizesChange:c,hasThumb:d>0&&d<1,onThumbChange:m=>s.current=m,onThumbPointerUp:()=>a.current=0,onThumbPointerDown:m=>a.current=m};function p(m,h){return no(m,a.current,l,h)}return r==="horizontal"?i.jsx(Zn,{...f,ref:t,onThumbPositionChange:()=>{if(n.viewport&&s.current){const m=n.viewport.scrollLeft,h=qe(m,l,n.dir);s.current.style.transform=`translate3d(${h}px, 0, 0)`}},onWheelScroll:m=>{n.viewport&&(n.viewport.scrollLeft=m)},onDragScroll:m=>{n.viewport&&(n.viewport.scrollLeft=p(m,n.dir))}}):r==="vertical"?i.jsx(Jn,{...f,ref:t,onThumbPositionChange:()=>{if(n.viewport&&s.current){const m=n.viewport.scrollTop,h=qe(m,l);s.current.style.transform=`translate3d(0, ${h}px, 0)`}},onWheelScroll:m=>{n.viewport&&(n.viewport.scrollTop=m)},onDragScroll:m=>{n.viewport&&(n.viewport.scrollTop=p(m))}}):null}),Zn=u.forwardRef((e,t)=>{const{sizes:r,onSizesChange:o,...n}=e,s=E(N,e.__scopeScrollArea),[a,l]=u.useState(),c=u.useRef(null),d=$(t,c,s.onScrollbarXChange);return u.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),i.jsx(Lt,{"data-orientation":"horizontal",...n,ref:d,sizes:r,style:{bottom:0,left:s.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:s.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":oe(r)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.x),onDragScroll:f=>e.onDragScroll(f.x),onWheelScroll:(f,p)=>{if(s.viewport){const m=s.viewport.scrollLeft+f.deltaX;e.onWheelScroll(m),Ht(m,p)&&f.preventDefault()}},onResize:()=>{c.current&&s.viewport&&a&&o({content:s.viewport.scrollWidth,viewport:s.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:te(a.paddingLeft),paddingEnd:te(a.paddingRight)}})}})}),Jn=u.forwardRef((e,t)=>{const{sizes:r,onSizesChange:o,...n}=e,s=E(N,e.__scopeScrollArea),[a,l]=u.useState(),c=u.useRef(null),d=$(t,c,s.onScrollbarYChange);return u.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),i.jsx(Lt,{"data-orientation":"vertical",...n,ref:d,sizes:r,style:{top:0,right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":oe(r)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.y),onDragScroll:f=>e.onDragScroll(f.y),onWheelScroll:(f,p)=>{if(s.viewport){const m=s.viewport.scrollTop+f.deltaY;e.onWheelScroll(m),Ht(m,p)&&f.preventDefault()}},onResize:()=>{c.current&&s.viewport&&a&&o({content:s.viewport.scrollHeight,viewport:s.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:te(a.paddingTop),paddingEnd:te(a.paddingBottom)}})}})}),[eo,$t]=kt(N),Lt=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:o,hasThumb:n,onThumbChange:s,onThumbPointerUp:a,onThumbPointerDown:l,onThumbPositionChange:c,onDragScroll:d,onWheelScroll:f,onResize:p,...m}=e,h=E(N,r),[g,x]=u.useState(null),w=$(t,b=>x(b)),S=u.useRef(null),y=u.useRef(""),A=h.viewport,P=o.content-o.viewport,_=D(f),I=D(c),O=se(p,10);function F(b){if(S.current){const C=b.clientX-S.current.left,k=b.clientY-S.current.top;d({x:C,y:k})}}return u.useEffect(()=>{const b=C=>{const k=C.target;g?.contains(k)&&_(C,P)};return document.addEventListener("wheel",b,{passive:!1}),()=>document.removeEventListener("wheel",b,{passive:!1})},[A,g,P,_]),u.useEffect(I,[o,I]),W(g,O),W(h.content,O),i.jsx(eo,{scope:r,scrollbar:g,hasThumb:n,onThumbChange:D(s),onThumbPointerUp:D(a),onThumbPositionChange:I,onThumbPointerDown:D(l),children:i.jsx(Q.div,{...m,ref:w,style:{position:"absolute",...m.style},onPointerDown:j(e.onPointerDown,b=>{b.button===0&&(b.target.setPointerCapture(b.pointerId),S.current=g.getBoundingClientRect(),y.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",h.viewport&&(h.viewport.style.scrollBehavior="auto"),F(b))}),onPointerMove:j(e.onPointerMove,F),onPointerUp:j(e.onPointerUp,b=>{const C=b.target;C.hasPointerCapture(b.pointerId)&&C.releasePointerCapture(b.pointerId),document.body.style.webkitUserSelect=y.current,h.viewport&&(h.viewport.style.scrollBehavior=""),S.current=null})})})}),ee="ScrollAreaThumb",Ot=u.forwardRef((e,t)=>{const{forceMount:r,...o}=e,n=$t(ee,e.__scopeScrollArea);return i.jsx(V,{present:r||n.hasThumb,children:i.jsx(to,{ref:t,...o})})}),to=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:o,...n}=e,s=E(ee,r),a=$t(ee,r),{onThumbPositionChange:l}=a,c=$(t,p=>a.onThumbChange(p)),d=u.useRef(void 0),f=se(()=>{d.current&&(d.current(),d.current=void 0)},100);return u.useEffect(()=>{const p=s.viewport;if(p){const m=()=>{if(f(),!d.current){const h=oo(p,l);d.current=h,l()}};return l(),p.addEventListener("scroll",m),()=>p.removeEventListener("scroll",m)}},[s.viewport,f,l]),i.jsx(Q.div,{"data-state":a.hasThumb?"visible":"hidden",...n,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...o},onPointerDownCapture:j(e.onPointerDownCapture,p=>{const h=p.target.getBoundingClientRect(),g=p.clientX-h.left,x=p.clientY-h.top;a.onThumbPointerDown({x:g,y:x})}),onPointerUp:j(e.onPointerUp,a.onThumbPointerUp)})});Ot.displayName=ee;var Ee="ScrollAreaCorner",Ft=u.forwardRef((e,t)=>{const r=E(Ee,e.__scopeScrollArea),o=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&o?i.jsx(ro,{...e,ref:t}):null});Ft.displayName=Ee;var ro=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,...o}=e,n=E(Ee,r),[s,a]=u.useState(0),[l,c]=u.useState(0),d=!!(s&&l);return W(n.scrollbarX,()=>{const f=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(f),c(f)}),W(n.scrollbarY,()=>{const f=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(f),a(f)}),d?i.jsx(Q.div,{...o,ref:t,style:{width:s,height:l,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function te(e){return e?parseInt(e,10):0}function Ut(e,t){const r=e/t;return isNaN(r)?0:r}function oe(e){const t=Ut(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=(e.scrollbar.size-r)*t;return Math.max(o,18)}function no(e,t,r,o="ltr"){const n=oe(r),s=n/2,a=t||s,l=n-a,c=r.scrollbar.paddingStart+a,d=r.scrollbar.size-r.scrollbar.paddingEnd-l,f=r.content-r.viewport,p=o==="ltr"?[0,f]:[f*-1,0];return Bt([c,d],p)(e)}function qe(e,t,r="ltr"){const o=oe(t),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,s=t.scrollbar.size-n,a=t.content-t.viewport,l=s-o,c=r==="ltr"?[0,a]:[a*-1,0],d=qn(e,c);return Bt([0,a],[0,l])(d)}function Bt(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const o=(t[1]-t[0])/(e[1]-e[0]);return t[0]+o*(r-e[0])}}function Ht(e,t){return e>0&&e<t}var oo=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},o=0;return(function n(){const s={left:e.scrollLeft,top:e.scrollTop},a=r.left!==s.left,l=r.top!==s.top;(a||l)&&t(),r=s,o=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(o)};function se(e,t){const r=D(e),o=u.useRef(0);return u.useEffect(()=>()=>window.clearTimeout(o.current),[]),u.useCallback(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(r,t)},[r,t])}function W(e,t){const r=D(t);J(()=>{let o=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(o),o=window.requestAnimationFrame(r)});return n.observe(e),()=>{window.cancelAnimationFrame(o),n.unobserve(e)}}},[e,r])}var Wt=Tt,so=Mt,ao=Ft;const lo=u.forwardRef(({className:e,children:t,...r},o)=>i.jsxs(Wt,{ref:o,className:R("relative overflow-hidden",e),...r,children:[i.jsx(so,{className:"h-full w-full rounded-[inherit]",children:t}),i.jsx(zt,{}),i.jsx(ao,{})]}));lo.displayName=Wt.displayName;const zt=u.forwardRef(({className:e,orientation:t="vertical",...r},o)=>i.jsx(Pe,{ref:o,orientation:t,className:R("flex touch-none select-none transition-colors data-[orientation=vertical]:h-full data-[orientation=vertical]:w-2 data-[orientation=horizontal]:h-2 data-[orientation=horizontal]:w-full",e),...r,children:i.jsx(Ot,{className:"relative flex-1 rounded-full bg-border"})}));zt.displayName=Pe.displayName;export{Ao as A,U as C,Lr as M,ko as P,lo as S,hn as T,_o as a,bo as b,ce as c,xo as d,vo as e,So as f,Co as g,wo as h,ve as i,yo as j,zr as k,Ir as l,Tr as m,Po as n,Ue as o,B as p,Eo as q,jo as r,X as s,To as t,No as u,Ln as v,Ar as w,go as x,Ro as y,on as z};
