import{j as e,r as a,u as T,h as F,s as D,Q as z,y as B,B as h,S as Q,l as q,t as R}from"./index-CuXsBKB-.js";import{I as $}from"./input-BJWINCe9.js";import{u as A}from"./useSearchTitles-yS8NEnQD.js";import{X as G}from"./x-DrKdDdus.js";import{C as p}from"./circle-check-DNszu0hR.js";import{P as C}from"./plus-B-cDPHxD.js";const K="inline-flex items-center gap-1 rounded-full px-2.5 py-0.5 text-xs font-medium",V={default:"bg-card/80 text-muted-foreground border border-border",outline:"border border-border text-muted-foreground bg-transparent",accent:"bg-primary/20 text-primary border border-primary/30"},X=({variant:t="default",className:o="",...d})=>{const i=[K,V[t],o].filter(Boolean).join(" ");return e.jsx("span",{className:i,...d})},Y=(t,o)=>{const[d,i]=a.useState(t);return a.useEffect(()=>{const m=window.setTimeout(()=>{i(t)},o);return()=>{window.clearTimeout(m)}},[t,o]),d};function _(t){const o=t.posterUrl??(t.tmdbPosterPath?R(t.tmdbPosterPath,"w342"):null);return{id:t.mediaItemId,title:t.title??"Untitled",posterUrl:o}}function H(t){return{id:t.id,title:t.title,posterUrl:t.posterUrl??null}}const P=5,re=()=>{const t=T(),o=a.useMemo(()=>F(),[]),[d,i]=a.useState(""),m=Y(d,250),[I,U]=a.useState([]),[E,b]=a.useState(!0),[f,j]=a.useState(null),[c,N]=a.useState({}),u=Object.keys(c).length,[x,v]=a.useState(!1),[w,y]=a.useState(null),n=A({query:m,filters:{type:"all"}}),S=a.useMemo(()=>(n.data?.pages??[]).flatMap(r=>r.results??[]),[n.data]),k=a.useCallback(s=>{N(r=>{const l={...r};return l[s.id]?(delete l[s.id],l):{...l,[s.id]:s}})},[]),M=a.useCallback(s=>{N(r=>{const l={...r};return delete l[s],l})},[]),g=a.useCallback(async()=>{try{await D.auth.updateUser({data:{onboarded:!0}})}catch{}t("/swipe",{replace:!0})},[t]),O=a.useCallback(async()=>{y(null),v(!0);try{const s=Object.keys(c),r=await z({sessionId:o,mediaItemIds:s},{timeoutMs:45e3});if(!r.ok)throw new Error(r.message??"Onboarding failed");await g()}catch(s){console.error(s),y(s?.message??"Something went wrong")}finally{v(!1)}},[g,c,o]);return a.useEffect(()=>{let s=!1;return(async()=>{b(!0),j(null);try{const l=await q({sessionId:o,mode:"trending",limit:24,seed:`onb:${new Date().toISOString().slice(0,10)}`},{timeoutMs:3e4});if(s)return;const L=l.cards??[];U(L.map(_))}catch(l){console.error(l),s||j("Couldn’t load suggestions. You can still search below.")}finally{s||b(!1)}})(),()=>{s=!0}},[o]),x?e.jsx(B,{}):e.jsxs("div",{className:"mx-auto flex min-h-screen w-full max-w-5xl flex-col gap-6 px-4 py-10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Pick a few titles you like"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Choose at least ",P,". This helps MoviNesta personalize your “For you” deck immediately."]})]}),w&&e.jsx("div",{className:"rounded-2xl border border-destructive/40 bg-destructive/10 px-4 py-3 text-sm text-destructive",children:w}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Selected:"}),u===0?e.jsx("span",{className:"text-sm",children:"None yet"}):Object.values(c).slice(0,12).map(s=>e.jsx(X,{onClick:()=>M(s.id),children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3.5 w-3.5"}),s.title]})},s.id)),u>12&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",u-12," more"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(h,{onClick:O,disabled:u<P||x,className:"rounded-2xl",children:[e.jsx(p,{className:"mr-2 h-4 w-4"}),"Continue"]}),e.jsx(h,{variant:"ghost",onClick:g,className:"rounded-2xl",disabled:x,children:"Skip for now"})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Popular picks"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Tap to ",u?"toggle":"select"]})]}),E?e.jsx("div",{className:"rounded-2xl border border-border bg-card/50 p-4 text-sm text-muted-foreground",children:"Loading suggestions…"}):f?e.jsx("div",{className:"rounded-2xl border border-border bg-card/50 p-4 text-sm text-muted-foreground",children:f}):e.jsx("div",{className:"grid grid-cols-3 gap-3 sm:grid-cols-4 md:grid-cols-6",children:I.map(s=>{const r=!!c[s.id];return e.jsxs("button",{type:"button",onClick:()=>k(s),className:"group relative overflow-hidden rounded-2xl border border-border bg-card/60 text-left",children:[s.posterUrl?e.jsx("img",{src:s.posterUrl,alt:s.title,className:"h-44 w-full object-cover transition-transform group-hover:scale-[1.02]",loading:"lazy"}):e.jsx("div",{className:"flex h-44 w-full items-center justify-center text-xs text-muted-foreground",children:"No poster"}),e.jsx("div",{className:"p-2",children:e.jsx("div",{className:"line-clamp-2 text-xs font-medium",children:s.title})}),e.jsx("div",{className:"absolute right-2 top-2 rounded-full bg-background/80 p-1 shadow",children:r?e.jsx(p,{className:"h-4 w-4"}):e.jsx(C,{className:"h-4 w-4"})})]},s.id)})})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"pointer-events-none absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx($,{value:d,onChange:s=>i(s.target.value),placeholder:"Search movies and series…",className:"pl-9"})]}),n.isLoading?e.jsx("div",{className:"rounded-2xl border border-border bg-card/50 p-4 text-sm text-muted-foreground",children:"Searching…"}):m.trim().length>0&&S.length===0?e.jsx("div",{className:"rounded-2xl border border-border bg-card/50 p-4 text-sm text-muted-foreground",children:"No results."}):e.jsxs("div",{className:"space-y-2",children:[S.slice(0,20).map(s=>{const r=H(s),l=!!c[r.id];return e.jsxs("button",{type:"button",onClick:()=>k(r),className:"flex w-full items-center gap-3 rounded-2xl border border-border bg-card/40 p-2 text-left hover:bg-card/60",children:[r.posterUrl?e.jsx("img",{src:r.posterUrl,alt:r.title,className:"h-16 w-12 rounded-xl object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-16 w-12 items-center justify-center rounded-xl bg-background/60 text-xs text-muted-foreground",children:"—"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:r.title}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.type??"title"," ",typeof s.year=="number"?`• ${s.year}`:""]})]}),e.jsx("div",{className:"rounded-full bg-background/80 p-1 shadow",children:l?e.jsx(p,{className:"h-4 w-4"}):e.jsx(C,{className:"h-4 w-4"})})]},s.id)}),n.hasNextPage&&e.jsx("div",{className:"pt-2",children:e.jsx(h,{variant:"ghost",className:"rounded-2xl",disabled:n.isFetchingNextPage,onClick:()=>n.fetchNextPage(),children:n.isFetchingNextPage?"Loading…":"Load more"})})]})]})]})};export{re as default};
