import{c as g,s as u,m as f,u as _,I as x,j as e}from"./index-BhQyicj1.js";import{T as h}from"./TopBar-CgSqB3Qz.js";import{S as v}from"./share-2-BS-qIq3q.js";import"./arrow-left-C_upJ4sj.js";const y=r=>g({queryKey:["lists","detail",r],enabled:!!r,queryFn:async()=>{if(!r)return null;const{data:s,error:a}=await u.from("lists").select("id, user_id, name, description, is_public").eq("id",r).maybeSingle();if(a)throw new Error(a.message);if(!s)return null;const{data:l,error:o}=await u.from("list_items").select("title_id, position, created_at").eq("list_id",r).order("position",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!0}).limit(300);if(o)throw new Error(o.message);const n=l??[],i=Array.from(new Set(n.map(t=>t.title_id).filter(t=>!!t))),p=new Map;if(i.length){const{data:t,error:c}=await u.from("media_items").select(`id,
             kind,
             tmdb_title,
             tmdb_name,
             tmdb_original_title,
             tmdb_original_name,
             tmdb_release_date,
             tmdb_first_air_date,
             tmdb_poster_path,
             tmdb_backdrop_path,
             tmdb_original_language,
             omdb_title,
             omdb_year,
             omdb_language,
             omdb_imdb_id,
             omdb_imdb_rating,
             omdb_rating_rotten_tomatoes,
             omdb_poster,
             omdb_rated,
             tmdb_id`).in("id",i);if(!c&&t)for(const m of t){const d=f(m);p.set(m.id,{titleId:m.id,title:d.title??null,year:d.year??null,posterUrl:d.posterUrl??d.backdropUrl??null})}else c&&console.warn("[useListDetail] Failed to load titles",c.message)}const b=n.map(t=>p.get(t.title_id)??{titleId:t.title_id,title:null,year:null,posterUrl:null}).filter(t=>!!t.titleId);return{id:s.id,userId:s.user_id,name:s.name,description:s.description??null,isPublic:!!s.is_public,items:b}}}),w=async r=>{try{if(typeof navigator<"u"&&"share"in navigator){await navigator.share({title:r});return}}catch{}try{await navigator.clipboard.writeText(window.location.href)}catch{}},k=()=>{const r=_(),{listId:s}=x(),{data:a,isLoading:l,isError:o,error:n}=y(s);return e.jsxs("div",{className:"flex flex-1 flex-col pb-2",children:[e.jsx(h,{title:a?.name??"List",actions:[{icon:v,label:"Share",onClick:()=>w(a?.name??"List")}]}),l&&e.jsx("div",{className:"page-pad-all text-xs text-muted-foreground",children:"Loading listâ€¦"}),o&&e.jsx("div",{className:"page-pad-all",children:e.jsxs("div",{className:"rounded-2xl border border-destructive/40 bg-destructive/5 card-pad text-xs text-foreground shadow-sm",children:[e.jsx("p",{className:"font-semibold",children:"Unable to load this list."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:n?.message??"Please try again in a moment."})]})}),!l&&!o&&a&&e.jsxs("div",{className:"page-pad-all",children:[a.description&&e.jsx("p",{className:"mb-3 text-xs text-muted-foreground",children:a.description}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:a.items.map(i=>e.jsxs("button",{type:"button","aria-label":`Open ${i.title??"title"}`,className:"group relative overflow-hidden rounded-xl border border-border bg-muted/30 outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",onClick:()=>r(`/title/${i.titleId}`),children:[i.posterUrl?e.jsx("img",{src:i.posterUrl,alt:i.title??"Title",className:"aspect-[2/3] w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"aspect-[2/3] w-full bg-muted"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-background/90 to-transparent px-2 pb-1 pt-6 opacity-0 transition group-hover:opacity-100",children:e.jsx("p",{className:"line-clamp-1 text-left text-[10px] font-semibold text-foreground",children:i.title??"Untitled"})})]},i.titleId))})]})]})};export{k as default};
