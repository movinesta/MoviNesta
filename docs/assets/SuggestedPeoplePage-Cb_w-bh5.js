import{C as y,u as w,b as N,R as C,j as e,B as c,M as k,F}from"./index-BhQyicj1.js";import{T as E}from"./TopBar-CgSqB3Qz.js";import{V as M}from"./VerifiedBadge-Mnb7GTth.js";import{D as P,a as S,b as T,g,d as U}from"./dropdown-menu-DiEWwlfW.js";import{a as D}from"./appUrl-BIFKGN0O.js";import{u as R}from"./useSuggestedPeople-Z3goux_O.js";import{u as B}from"./useToggleFollow-dd4IRTbr.js";import{X as I}from"./x-mv29V4jj.js";import{E as A}from"./ellipsis-D2jDXppt.js";import{C as V}from"./copy-5oWhKRql.js";import"./arrow-left-C_upJ4sj.js";import"./index-DvH4qpt5.js";const _=[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M19 16v6",key:"tddt3s"}],["path",{d:"M22 19h-6",key:"vcuq98"}]],$=y("user-round-plus",_),z=async s=>{try{await navigator.clipboard.writeText(s)}catch{}},L=s=>s?s.startsWith("@")?s:`@${s}`:"",Y=(s,d)=>{const l=(s||d||"").replace(/^@/,"").trim();if(!l)return"?";const n=l.split(/\s+/);return n.length===1?n[0].slice(0,2).toUpperCase():(n[0][0]+n[1][0]).toUpperCase()},se=()=>{const s=w(),{data:d=[],isLoading:u,isError:l,error:n,dismissPerson:p}=R(),m=B(),{user:x}=N(),[f,h]=C.useState(null),b=async t=>{if(!x?.id){alert("You need to be signed in to start a conversation.");return}if(x.id===t){alert("You can't start a conversation with yourself.");return}h(t);try{const a=await F("create-direct-conversation",{targetUserId:t},{timeoutMs:25e3});if(!a?.ok||!a.conversationId){const r=a?.code;let i=a?.error??"Failed to get conversation id. Please try again.";throw r==="UNAUTHORIZED"?i="You need to be signed in to start a conversation.":r==="BAD_REQUEST_SELF_TARGET"?i="You can't start a conversation with yourself.":r==="SERVER_MISCONFIGURED"&&(i="Messaging is temporarily unavailable due to a server issue. Please try again later."),new Error(i)}s(`/messages/${a.conversationId}`)}catch(a){console.error("[SuggestedPeoplePage] Failed to start conversation",a);const r=a instanceof Error?a.message:"Something went wrong while starting the conversation. Please try again.";alert(r)}finally{h(null)}};return e.jsxs("div",{className:"flex flex-1 flex-col pb-2",children:[e.jsx(E,{title:"Suggested people",onBack:()=>s(-1)}),u&&e.jsx("div",{className:"page-pad-all text-xs text-muted-foreground",children:"Loading suggestions…"}),l&&e.jsx("div",{className:"page-pad-all",children:e.jsxs("div",{className:"rounded-2xl border border-destructive/40 bg-destructive/5 card-pad text-xs text-foreground shadow-sm",children:[e.jsx("p",{className:"font-semibold",children:"Unable to load suggestions."}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:n?.message??"Please try again in a moment."})]})}),!u&&!l&&d.length===0&&e.jsx("div",{className:"flex flex-1 items-center justify-center page-pad-all",children:e.jsxs("div",{className:"max-w-sm rounded-2xl border border-border bg-card/80 card-pad text-center text-xs text-muted-foreground shadow-sm",children:[e.jsx("div",{className:"mx-auto mb-3 flex h-10 w-10 items-center justify-center rounded-2xl bg-primary/15",children:e.jsx($,{className:"h-5 w-5 text-primary","aria-hidden":"true"})}),e.jsx("p",{className:"font-heading text-sm font-semibold text-foreground",children:"All caught up"}),e.jsx("p",{className:"mt-1 text-xs",children:"No new suggestions right now. Check back later."})]})}),e.jsx("div",{className:"flex flex-col stack-gap page-pad-all",children:d.map(t=>{const a=L(t.username),r=t.displayName||a||"User",i=m.isPending&&m.variables?.targetUserId===t.id,v=!!(f&&f===t.id),j=typeof t.commonTitlesCount=="number"&&t.commonTitlesCount>0?`${t.commonTitlesCount} in common`:"Suggested for you";return e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-border bg-card/80 card-pad shadow-sm",children:[e.jsx(c,{type:"button",variant:"ghost",size:"icon",onClick:()=>p(t.id),className:"absolute right-1 top-1 rounded-full text-muted-foreground","aria-label":"Dismiss suggestion",children:e.jsx(I,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs("div",{className:"flex items-center gap-3 rounded-xl outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-background",role:"button",tabIndex:0,onClick:()=>{t.username&&s(`/u/${t.username}`)},onKeyDown:o=>{o.key==="Enter"&&t.username&&s(`/u/${t.username}`)},children:[t.avatarUrl?e.jsx("img",{src:t.avatarUrl,alt:r,className:"h-12 w-12 rounded-full object-cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-muted text-xs font-semibold text-foreground",children:Y(t.displayName,t.username)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:r}),t.isVerified?e.jsx(M,{isVerified:t.isVerified??null,type:t.verifiedType??null,label:t.verifiedLabel??null,verifiedAt:t.verifiedAt??null,org:t.verifiedByOrg??null}):null]}),e.jsx("p",{className:"truncate text-xs text-muted-foreground",children:a}),e.jsx("p",{className:"mt-0.5 line-clamp-1 text-xs text-muted-foreground",children:j})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{type:"button",size:"sm",disabled:i,onClick:o=>{o.stopPropagation(),m.mutate({targetUserId:t.id,currentlyFollowing:t.isFollowing})},className:t.isFollowing?"rounded-full bg-muted px-3 text-foreground hover:bg-muted/80":"rounded-full px-3",children:i?"…":t.isFollowing?"Following":"Follow"}),e.jsx(c,{type:"button",size:"icon",variant:"secondary",className:"rounded-full",disabled:v,onClick:o=>{o.stopPropagation(),b(t.id)},"aria-label":"Message",children:e.jsx(k,{className:"h-4 w-4","aria-hidden":"true"})}),e.jsxs(P,{children:[e.jsx(S,{asChild:!0,children:e.jsx(c,{type:"button",size:"icon",variant:"secondary",className:"rounded-full",onClick:o=>o.stopPropagation(),"aria-label":"More",children:e.jsx(A,{className:"h-4 w-4","aria-hidden":"true"})})}),e.jsxs(T,{align:"end",className:"w-44",children:[e.jsxs(g,{onClick:()=>{t.username&&z(D(`/u/${t.username}`))},disabled:!t.username,children:[e.jsx(V,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Copy profile link"]}),e.jsx(U,{}),e.jsx(g,{disabled:!0,children:"Report"}),e.jsx(g,{disabled:!0,children:"Block"})]})]})]})]})]},t.id)})})]})};export{se as default};
