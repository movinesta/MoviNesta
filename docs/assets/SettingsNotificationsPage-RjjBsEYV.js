import{c as j,d as N,v,r as l,e as w,w as _,j as e,f as S,p as A,k,s as C}from"./index-DhZ1aP8k.js";import{T as P}from"./TopBar-DqXtwt_r.js";import{I as E}from"./info-Bp5B4Gdq.js";import{B as R}from"./bell-ljji5_0a.js";import{C as I}from"./circle-check-C-PkYEUg.js";import{C as F}from"./circle-alert-CddkEOkp.js";import{T as M}from"./thumbs-up-C6e4XjVS.js";import"./PageChrome-D5rVYUnf.js";import"./brand-DTIDtbc4.js";const T=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],B=j("inbox",T),o={emailActivity:!0,emailRecommendations:!0,inAppSocial:!0,inAppSystem:!0},u=["notification-preferences"],H=()=>{const{user:i}=N(),h=v(),[r,m]=l.useState(o),[p,d]=l.useState("idle"),{data:a,isLoading:f,isError:b,error:x}=w({queryKey:u,enabled:!!i,queryFn:async()=>{const{data:s,error:t}=await C.from("notification_preferences").select("user_id, email_activity, email_recommendations, in_app_social, in_app_system, updated_at").eq("user_id",i.id).maybeSingle();if(t)throw t;return s||{user_id:i.id,email_activity:o.emailActivity,email_recommendations:o.emailRecommendations,in_app_social:o.inAppSocial,in_app_system:o.inAppSystem,updated_at:new Date().toISOString()}}});l.useEffect(()=>{a&&m({emailActivity:a.email_activity,emailRecommendations:a.email_recommendations,inAppSocial:a.in_app_social,inAppSystem:a.in_app_system})},[a]);const n=_({mutationFn:async s=>{const t=await k("update-notification-prefs",{emailActivity:s.emailActivity,emailRecommendations:s.emailRecommendations,inAppSocial:s.inAppSocial,inAppSystem:s.inAppSystem});if(!t.ok)throw new Error(t.error??"Unable to save preferences");return t.preferences},onSuccess:s=>{d("saved"),h.setQueryData(u,{user_id:i?.id??"",email_activity:s.emailActivity,email_recommendations:s.emailRecommendations,in_app_social:s.inAppSocial,in_app_system:s.inAppSystem,updated_at:s.updatedAt})},onError:s=>{console.error("Failed to save notification preferences",s),d("error")}}),c=s=>t=>{m(y=>({...y,[s]:t.target.checked})),d("idle")},g=async()=>{!i||n.isPending||await n.mutateAsync(r)};return i?f?e.jsx(S,{message:"Loading your notification preferences…"}):b||!a?e.jsx("div",{className:"flex min-h-[60vh] items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md rounded-2xl border border-border bg-card/80 px-4 py-6 text-center text-sm text-foreground shadow-lg",children:[e.jsx("h1",{className:"text-base font-heading font-semibold",children:"Notifications unavailable"}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"We couldn't load your preferences right now."}),x&&e.jsxs("p",{className:"mt-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-semibold",children:"Details:"})," ",x.message]})]})}):e.jsxs("div",{className:"flex flex-1 flex-col gap-4 pb-2 pt-1",children:[e.jsx(P,{title:"Notifications",subtitle:"Control how MoviNesta keeps in touch with you."}),e.jsxs("div",{className:"mx-4 flex items-start gap-2 rounded-md border border-border bg-card/70 p-3 text-[12px] text-muted-foreground shadow-lg",children:[e.jsx(E,{className:"mt-0.5 h-4 w-4 text-muted-foreground","aria-hidden":"true"}),e.jsx("p",{className:"leading-relaxed",children:"Notification preferences are saved to your MoviNesta account and sync across devices. These toggles control both in-app surfaces and any email digests you opt into."})]}),e.jsxs("section",{className:"space-y-4 px-4 pb-24",children:[e.jsxs("div",{className:"space-y-3 rounded-2xl border border-border bg-card/80 p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-border/50",children:e.jsx(B,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h2",{className:"text-sm font-heading font-semibold text-foreground",children:"Email"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Occasional updates from MoviNesta in your inbox."})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 text-[12px]",children:[e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-foreground",children:"Activity on your content"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"New followers, comments, and reactions."})]}),e.jsx("input",{type:"checkbox",checked:r.emailActivity,onChange:c("emailActivity"),className:"mt-1 h-4 w-4 rounded border-border bg-background text-primary","aria-label":"Email activity notifications"})]}),e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-foreground",children:"Recommendations"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"Personalized movie picks and weekly digests."})]}),e.jsx("input",{type:"checkbox",checked:r.emailRecommendations,onChange:c("emailRecommendations"),className:"mt-1 h-4 w-4 rounded border-border bg-background text-primary","aria-label":"Email recommendations"})]})]})]}),e.jsxs("div",{className:"space-y-3 rounded-2xl border border-border bg-card/80 p-4 shadow-lg",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-border/50",children:e.jsx(R,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true"})}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h2",{className:"text-sm font-heading font-semibold text-foreground",children:"In-app notifications"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"What shows up inside the app. Push and OS-level settings still apply."})]})]}),e.jsxs("div",{className:"space-y-2 pt-2 text-[12px]",children:[e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-foreground",children:"Social activity"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"Follows, reactions, and friend activity."})]}),e.jsx("input",{type:"checkbox",checked:r.inAppSocial,onChange:c("inAppSocial"),className:"mt-1 h-4 w-4 rounded border-border bg-background text-primary","aria-label":"In-app social notifications"})]}),e.jsxs("label",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-foreground",children:"System messages"}),e.jsx("span",{className:"block text-xs text-muted-foreground",children:"Account notices, billing, and other important updates."})]}),e.jsx("input",{type:"checkbox",checked:r.inAppSystem,onChange:c("inAppSystem"),className:"mt-1 h-4 w-4 rounded border-border bg-background text-primary","aria-label":"In-app system messages"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 pt-1",children:[e.jsxs("div",{className:"min-h-[20px] flex-1 text-xs",children:[p==="saved"&&e.jsxs("div",{className:"flex items-center gap-1.5 text-emerald-400",children:[e.jsx(I,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Notification preferences saved to your account."})]}),p==="error"&&e.jsxs("div",{className:"flex items-center gap-1.5 text-destructive",children:[e.jsx(F,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:"Couldn't save preferences. Try again."})]})]}),e.jsxs(Button,{type:"button",size:"sm",onClick:g,disabled:n.isPending,children:[n.isPending?e.jsx(A,{className:"h-3.5 w-3.5 animate-spin","aria-hidden":"true"}):e.jsx(M,{className:"h-3.5 w-3.5","aria-hidden":"true"}),e.jsx("span",{children:n.isPending?"Saving…":"Save preferences"})]})]})]})]}):e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md rounded-2xl border border-border bg-card/80 px-4 py-6 text-center text-sm text-foreground shadow-lg",children:[e.jsx("h1",{className:"text-base font-heading font-semibold",children:"You're signed out"}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Sign in to manage how MoviNesta contacts you."})]})})};export{H as default};
