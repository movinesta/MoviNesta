import{n as De,o as gt,e as br,r as a,h as xs,k as hs,l as bs,v as ws,w as wr,x as nr,q as Je,t as rr,y as gs,j as e,B as vs,u as gr,R as sr,b as vr,c as dn,z as ys,A as js,s as fn}from"./index-DuL1-P9A.js";import{M as j}from"./material-icon-CWnTyIbw.js";import{b as Ns}from"./useDiaryLibrary-DPZopC1W.js";import{u as ks}from"./scroll-area-DkOA21cB.js";import"./textarea-CMvp5vrS.js";import{D as yr,a as jr,b as Nr,c as kr,d as Ms}from"./dialog-ClweDY8b.js";import{a as _s}from"./appUrl-BIFKGN0O.js";import{F as ir}from"./FriendAvatarStack-6AuGZBUA.js";import"./conversationsCache-B1vzQYCS.js";import"./format-BXv9LLlt.js";import"./plus-BSK9vxg7.js";import"./x-C4D7SPeX.js";import"./copy-x_fNLkwl.js";import"./circle-alert-DvC6vhnp.js";import"./index-CCS_L2cZ.js";const xn="movi_swipe_event_queue_v1";function Ss(n){if(!n)return[];try{const i=JSON.parse(n);return Array.isArray(i)?i.filter(Boolean):[]}catch{return[]}}function hn(){return Ss(gt(xn))}function Rs(n){const i=hn();i.push({...n,queuedAt:Date.now()});const o=i.slice(-200);De(xn,JSON.stringify(o))}function Cs(n){if(!n.length)return;const i=new Set(n),o=hn().filter(b=>!b.clientEventId||!i.has(b.clientEventId));De(xn,JSON.stringify(o))}function Fs(n){return"combined"}function Ts(n){if(!n)return null;const i=n.replace("-","_");return i==="for_you"?"for-you":i==="friends"?"from-friends":i==="trending"?"trending":i==="popular"?"popular":i==="explore"?"explore":i==="combined"?"combined":null}function ar(n){return n==="like"?"like":n==="dislike"?"dislike":"skip"}function Qe(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():gs()}function Is(n){const i=typeof n.posterUrl=="string"?n.posterUrl.trim():"",o=(i&&i.toLowerCase()!=="n/a"?i:"")||(n.tmdbPosterPath?rr(n.tmdbPosterPath,"w500")??"":"")||(n.tmdbBackdropPath?rr(n.tmdbBackdropPath,"w780")??"":"");if(!o)return null;const b=(n.title??"").trim()||"Untitled";return{...n,posterUrl:o,title:b}}function As(n,i){if(typeof window>"u"||i<=0||navigator.connection?.saveData)return;const S=window.requestIdleCallback??(N=>window.setTimeout(N,300)),w=n.slice(0,i);S(()=>{for(const N of w){if(!N.posterUrl)continue;const M=new Image;M.decoding="async",M.loading="lazy",M.src=N.posterUrl}})}function Es(n,i){const o=i?.limit??60,b=i?.prefetchImages??6,S=i?.dwellThresholdMs??1200,w=i?.dwellDebounceMs??8e3,N=i?.invalidateHomeQueries??!1,M=br();a.useEffect(()=>{let s=!1;const u=async()=>{if(s)return;const F=hn();if(!F.length)return;const U=[];for(const H of F)try{(await nr(H)).ok&&H.clientEventId&&U.push(H.clientEventId)}catch{break}U.length&&Cs(U)};u();const A=()=>{u()};return window.addEventListener("online",A),()=>{s=!0,window.removeEventListener("online",A)}},[]);const g=a.useMemo(()=>xs(),[]),$=a.useMemo(()=>Fs(),[n]),pe=a.useRef(new Set),P=a.useRef(!1),de=a.useRef(0),$e=a.useRef(null),Oe=a.useRef(new Set),ee=a.useRef(new Map),[Z,Wt]=a.useState({status:"idle",cards:[],errorMessage:null}),[fe,et]=a.useState(null),W=a.useCallback(s=>{Wt(u=>typeof s=="function"?s(u):s)},[]),yt=a.useCallback(s=>{if(!s.length)return 0;const u=pe.current,A=[];for(const F of s){if(u.has(F.id))continue;const U=Is(F);u.add(F.id),U&&A.push(U)}return A.length?(W(F=>{const U={...F,status:"ready",cards:[...F.cards,...A],errorMessage:null};return As(A,b),U}),A.length):0},[b,W]),Ce=a.useCallback(async(s=o)=>{if(!P.current){P.current=!0,W(u=>({...u,status:u.cards.length?"ready":"loading",errorMessage:null}));try{const u=i?.kindFilter??null,A=i?.seed??hs(g,$,u);$e.current!==A&&($e.current=A,de.current=0);const F=3;let U=0,H=0;for(;U<F&&H===0;){const Ne=`${A}:${de.current}`;de.current+=1;const kt=await bs({sessionId:g,mode:$,kindFilter:u??void 0,limit:s,seed:Ne,minImdbRating:i?.minImdbRating??null,genresAny:i?.genresAny??null},{timeoutMs:25e3}),Mt=kt.deckId,Ue=(kt.cards??[]).map((ke,ue)=>({...ke,id:ke.mediaItemId,deckId:Mt,position:ue,source:Ts(ke.source??n)}));if(!Ue.length){W(ke=>({...ke,status:ke.cards.length?"ready":"exhausted",errorMessage:null}));return}if(H=yt(Ue),H>0)break;U+=1,console.warn("[useMediaSwipeDeck] filtered out all cards (missing OMDb poster?). Retrying...",{attempt:U,mode:$,kind:n,batchSize:s})}H===0&&W(Ne=>({...Ne,status:Ne.cards.length?"ready":"exhausted",errorMessage:null}))}catch(u){const A=u instanceof Error?u.message:typeof u=="string"?u:"We couldn't load swipe cards.";W(F=>({...F,status:"error",errorMessage:A}))}finally{P.current=!1}}},[yt,o,$,i?.kindFilter,i?.minImdbRating,JSON.stringify(i?.genresAny??[]),i?.seed,g,W]);a.useEffect(()=>{pe.current=new Set,Oe.current=new Set,ee.current=new Map,P.current=!1,W({status:"loading",cards:[],errorMessage:null}),Ce(o)},[Ce,n,o,i?.kindFilter,i?.minImdbRating,JSON.stringify(i?.genresAny??[]),W]);const jt=a.useCallback(()=>{i?.seed==null&&ws(g,$,i?.kindFilter??null),de.current=0,pe.current=new Set,Oe.current=new Set,ee.current=new Map,P.current=!1,W({status:"loading",cards:[],errorMessage:null}),Ce(o)},[Ce,o,$,i?.kindFilter,i?.minImdbRating,JSON.stringify(i?.genresAny??[]),i?.seed,g,W]),tt=a.useCallback(s=>{s<=0||W(u=>({...u,cards:u.cards.slice(Math.min(s,u.cards.length))}))},[W]),q=wr({mutationFn:async s=>nr(s,{timeoutMs:2e4}),onError:(s,u)=>{const A=s instanceof Error?s.message:typeof s=="string"?s:"We couldn't save that action.";Rs(u),et({payload:u,message:A})},onSuccess:()=>{et(null),N&&(M.invalidateQueries({queryKey:Je.homeFeed(null)}),M.invalidateQueries({queryKey:Je.homeForYou(null)}))}}),L=a.useCallback((s,u)=>{if(!s)return;const A=`${s.deckId}:${s.id}`;Oe.current.has(A)||(Oe.current.add(A),q.mutate({sessionId:g,deckId:s.deckId,position:u??s.position,mediaItemId:s.id,eventType:"impression",source:s.source??null,clientEventId:Qe()}))},[q,g]),Nt=a.useCallback((s,u,A)=>{if(!s||!Number.isFinite(u)||u<S)return;const F=`${s.deckId}:${s.id}`,U=Date.now(),H=ee.current.get(F)??0;U-H<w||(ee.current.set(F,U),q.mutate({sessionId:g,deckId:s.deckId,position:A??s.position,mediaItemId:s.id,eventType:"dwell",dwellMs:Math.round(u),source:s.source??null,clientEventId:Qe()}))},[w,S,q,g]),Be=a.useCallback(s=>{const u=s.card;q.mutate({sessionId:g,deckId:u.deckId,position:u.position,mediaItemId:u.id,eventType:ar(s.direction),source:u.source??null,clientEventId:Qe()})},[q,g]),X=a.useCallback(async s=>{const u=s.card;return q.mutateAsync({sessionId:g,deckId:u.deckId,position:u.position,mediaItemId:u.id,eventType:ar(s.direction),source:u.source??null,clientEventId:Qe()})},[q,g]),je=a.useCallback(s=>{const u={...s,sessionId:s.sessionId??g,clientEventId:s.clientEventId??Qe()};q.mutate(u)},[q,g]),I=a.useCallback(async s=>{const u={...s,sessionId:s.sessionId??g,clientEventId:s.clientEventId??Qe()};try{await q.mutateAsync(u)}catch{}},[q,g]);return{sessionId:g,mode:$,cards:Z.cards,status:Z.status,isLoading:Z.status==="loading",isError:Z.status==="error",isExhausted:Z.status==="exhausted",deckError:Z.errorMessage??null,fetchMore:Ce,refresh:jt,trimConsumed:tt,trackImpression:L,trackDwell:Nt,sendEvent:je,sendEventAsync:I,swipe:Be,swipeAsync:X,swipeSyncError:fe?.message??null,retryFailedSwipe:()=>{fe&&q.mutate(fe.payload)},isRetryingSwipe:q.isPending&&!!fe}}const x=(n,i,o)=>Math.min(o,Math.max(i,n)),J=n=>{if(!n)return null;const i=n.trim();return!i||i.toUpperCase()==="N/A"?null:i},lr=n=>{if(!n||n<=0)return null;const i=Math.floor(n/60),o=n%60;return i===0?`${o}m`:o===0?`${i}h`:`${i}h ${o}m`},Ps=n=>{const i=J(n);if(!i)return null;const o=i.toLowerCase();return o==="united states"||o==="united states of america"?"US":o==="united kingdom"||o==="great britain"?"UK":o==="canada"?"CA":o==="australia"?"AU":o==="germany"?"DE":o==="france"?"FR":o==="spain"?"ES":o==="italy"?"IT":o==="japan"?"JP":o==="south korea"||o==="republic of korea"?"KR":i.length<=3?i.toUpperCase():i},V=n=>{if(n==null)return null;if(typeof n=="number")return Number.isNaN(n)?null:n;const i=parseFloat(n);return Number.isNaN(i)?null:i},or=n=>{const i=V(n);return i==null?null:Math.round(i).toLocaleString()},qt=n=>{if(!n)return;const i=[];n.year&&i.push(String(n.year));const o=[];typeof n.imdbRating=="number"&&!Number.isNaN(n.imdbRating)&&o.push(`IMDb ${n.imdbRating.toFixed(1)}`),typeof n.rtTomatoMeter=="number"&&!Number.isNaN(n.rtTomatoMeter)&&o.push(`${n.rtTomatoMeter}% Rotten Tomatoes`);const b=[...i,...o].filter(Boolean).join(" · ");return b?`${n.title} (${b})`:n.title},Ls=({message:n,onRetry:i,isRetrying:o})=>n?e.jsx("div",{className:"mx-3 mb-3 rounded-md border border-amber-500/60 bg-amber-500/10 px-3 py-2 text-xs text-amber-50",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(j,{name:"error",className:"mt-0.5 text-[18px]",ariaLabel:"Error"}),e.jsxs("div",{className:"flex flex-1 flex-col gap-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"leading-snug",children:n}),e.jsxs(vs,{type:"button",variant:"outline",size:"sm",onClick:i,disabled:o,children:[e.jsx(j,{name:"refresh",className:"text-[18px]",ariaLabel:"Retry"}),o?"Retrying…":"Retry"]})]})]})}):null,un=({title:n})=>e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-gradient-to-br from-background via-card to-background text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-2xl bg-card/70 shadow-md",children:e.jsx(j,{name:"image_not_supported",className:"text-[24px] text-muted-foreground"})}),e.jsx("span",{className:"text-[12px] font-semibold",children:"Artwork unavailable"}),n&&e.jsxs("span",{className:"max-w-[240px] truncate text-xs text-muted-foreground/80",children:["for ",n]})]})});function Ds(n){const i=n.trim().split(/\s+/).filter(Boolean);if(!i.length)return"?";const o=i[0]?.[0]??"?",b=i.length>1?i[i.length-1]?.[0]??"":"";return(o+b).toUpperCase()}function $s({open:n,onOpenChange:i,profiles:o,verb:b}){const S=gr(),w=Array.isArray(o)?o.filter(Boolean):[],N=w.length?`Friends who ${b}`:`No friends ${b} yet`;return e.jsx(yr,{open:n,onOpenChange:i,children:e.jsxs(jr,{className:"max-w-md border border-border/60 bg-card text-foreground",children:[e.jsx(Nr,{children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx(kr,{className:"text-base font-semibold text-foreground",children:N}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"-mr-2 inline-flex h-9 w-9 items-center justify-center rounded-full border border-border/60 bg-background/60 text-muted-foreground transition hover:bg-background/80 hover:text-foreground","aria-label":"Close","data-swipe-interactive":"true",children:e.jsx(j,{name:"close",className:"text-[22px]"})})]})}),w.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Once friends interact with titles, they’ll show up here."}):e.jsx("div",{className:"mt-2 max-h-[60vh] overflow-y-auto pr-1",children:e.jsx("div",{className:"space-y-2",children:w.map(M=>{const g=(M.display_name??M.username??"Friend").trim()||"Friend",$=(M.username??"").trim(),pe=Ds(g);return e.jsxs("button",{type:"button",className:"flex w-full items-center gap-3 rounded-2xl border border-border/60 bg-background/40 px-3 py-2.5 text-left transition hover:bg-background/70",onClick:()=>{$&&(i(!1),S(`/u/${$}`))},"aria-label":$?`Open ${g} profile`:g,"data-swipe-interactive":"true",children:[e.jsx("div",{className:"h-10 w-10 overflow-hidden rounded-full border border-border/60 bg-muted",children:M.avatar_url?e.jsx("img",{src:M.avatar_url,alt:g,className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("div",{className:"grid h-full w-full place-items-center text-xs font-semibold text-foreground/80",children:pe})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:g}),$?e.jsxs("div",{className:"truncate text-xs text-muted-foreground",children:["@",$]}):e.jsx("div",{className:"truncate text-xs text-muted-foreground",children:"Profile unavailable"})]}),e.jsx("div",{className:"grid h-9 w-9 place-items-center rounded-full border border-border/60 bg-background/60 text-muted-foreground",children:e.jsx(j,{name:"chevron_right",className:"text-[22px]"})})]},M.id)})})})]})})}const bt="mn_swipe_onboarding_seen",cr="mn_swipe_sfx_enabled",dr="mn_swipe_haptics_enabled",Os={floaty_gamey:{distanceWidthFactor:.22,distanceMin:86,distanceMax:140,intentFactor:.35,intentMin:30,intentMax:52,velocityThreshold:.55,velocityProjectionMs:220,dragFollowAlpha:.22,rotationFactor:15,rotateZCap:18,rotateYCap:14,rotateXCap:7,undercardTranslateY:8,undercardBlurMax:1.4,punchScale:1.015,punchDurationMs:140,burstBaseCount:12,burstDurationMs:520}},O=Os.floaty_gamey,Bs=88,vt=(n,i=1)=>{const o=typeof n=="number"&&Number.isFinite(n)&&n>0?n:typeof window<"u"?window.innerWidth:Bs;return x(o*O.distanceWidthFactor*i,O.distanceMin,O.distanceMax)},ur=(n,i=1)=>x(Math.round(vt(n,i)*O.intentFactor),O.intentMin,O.intentMax),Us=(n,i)=>{const o=Math.abs(n);if(o<=i)return n;const b=o-i;return Math.sign(n)*(i+b*.18)},mn=8,zs=1.25,Ys=1.6,qs=.25,mr=120,pn=14,Ws=70,pr=O.velocityThreshold,wt=220,Xs=360,fr=O.rotationFactor,Hs=`
@keyframes mn-swipe-burst {
  0% { transform: translate3d(0px,0px,0px) rotate(0deg) scale(1); opacity: 0.95; }
  100% { transform: translate3d(var(--dx, 0px), var(--dy, 0px), 0px) rotate(var(--rot, 0deg)) scale(var(--s, 1)); opacity: 0; }
}
.mn-swipe-burst-dot {
  position: absolute;
  left: var(--x, 0px);
  top: var(--y, 0px);
  width: var(--sz, 8px);
  height: var(--sz, 8px);
  border-radius: 9999px;
  filter: blur(0px);
  will-change: transform, opacity;
  animation: mn-swipe-burst var(--dur, 520ms) cubic-bezier(0.18, 0.78, 0.22, 1) forwards;
}
.mn-swipe-burst-dot[data-shape="square"] { border-radius: 6px; }
@media (prefers-reduced-motion: reduce) {
  .mn-swipe-burst-dot { animation: none !important; opacity: 0 !important; }
}
`,Ks={"--mn-swipe-radius":"clamp(26px, min(6vw, 4.2vh), 44px)","--mn-swipe-pad":"clamp(12px, min(4.6vw, 3.2vh), 24px)","--mn-swipe-kicker":"clamp(10px, min(2.5vw, 1.45vh), 12px)","--mn-swipe-header":"clamp(1.05rem, min(4.2vw, 2.6vh), 1.35rem)","--mn-swipe-top-hit":"clamp(2.25rem, min(9vw, 5.2vh), 2.9rem)","--mn-swipe-top-icon":"clamp(22px, min(5.6vw, 3.2vh), 30px)","--mn-swipe-title":"clamp(1.6rem, min(6.6vw, 4.4vh), 2.6rem)","--mn-swipe-subtitle":"clamp(0.92rem, min(3.6vw, 2.2vh), 1.15rem)","--mn-swipe-meta":"clamp(0.88rem, min(3.2vw, 2.0vh), 1.08rem)","--mn-swipe-chip":"clamp(0.72rem, min(2.9vw, 1.75vh), 0.9rem)","--mn-swipe-hit":"clamp(2.25rem, min(9vw, 5.5vh), 2.85rem)","--mn-swipe-gap":"clamp(1.35rem, min(6.2vw, 3.7vh), 2.5rem)","--mn-swipe-action":"clamp(3.1rem, min(12.5vw, 7.0vh), 4.1rem)","--mn-swipe-action-primary":"clamp(4.4rem, min(17.5vw, 9.2vh), 6.1rem)","--mn-swipe-icon":"clamp(22px, min(5.5vw, 3.4vh), 30px)","--mn-swipe-icon-primary":"clamp(32px, min(8.5vw, 4.8vh), 46px)","--mn-swipe-star-hit":"clamp(18px, min(5vw, 2.8vh), 24px)","--mn-swipe-star-icon":"clamp(14px, min(3.8vw, 2.1vh), 19px)"},Mr=n=>{if(n==null)return null;const i=String(n).trim();if(!i)return null;const o=i.replace(/%/g,""),b=Number(o);return Number.isFinite(b)?b:null},Gs=n=>{if(n==null)return null;const i=Math.round(n);return i<=0?null:Math.min(10,Math.max(2,i*2))},Vs=n=>{const i=(()=>{const w=String(n?.source??"").trim();if(!w)return null;const N=w.replace("-","_");return N==="for_you"||N==="for-you"?"for-you":N==="friends"||N==="from_friends"||N==="from-friends"?"from-friends":N==="trending"?"trending":N==="popular"?"popular":N==="combined"?"combined":N==="explore"?"explore":null})(),o=n?.kind==="series"?"series":n?.kind==="anime"?"anime":"movie",b=typeof n?.releaseYear=="number"?n.releaseYear:n?.releaseYear!=null?Number(n.releaseYear):null,S=typeof n?.runtimeMinutes=="number"?n.runtimeMinutes:n?.runtimeMinutes!=null?Number(n.runtimeMinutes):null;return{id:String(n?.id??""),title:String(n?.title??"Untitled"),deckId:n?.deckId??null,position:typeof n?.position=="number"?n.position:n?.position!=null?Number(n.position):null,year:Number.isFinite(b)?b:null,type:o,runtimeMinutes:Number.isFinite(S)?S:null,tagline:n?.tagline??null,mood:n?.mood??null,vibeTag:n?.vibeTag??null,posterUrl:n?.posterUrl??null,tmdbPosterPath:n?.tmdbPosterPath??null,tmdbBackdropPath:n?.tmdbBackdropPath??null,source:i,why:n?.why??null,friendIds:Array.isArray(n?.friendIds)?n.friendIds:null,friendProfiles:Array.isArray(n?.friendProfiles)?n.friendProfiles:null,friendLikesCount:typeof n?.friendLikesCount=="number"?n.friendLikesCount:Array.isArray(n?.friendProfiles)?n.friendProfiles.length:Array.isArray(n?.friendIds)?n.friendIds.length:null,topFriendName:Array.isArray(n?.friendProfiles)&&n.friendProfiles[0]?String(n.friendProfiles[0].display_name??n.friendProfiles[0].username??""):n?.topFriendName??null,topFriendInitials:n?.topFriendInitials??null,topFriendReviewSnippet:n?.topFriendReviewSnippet??null,overview:n?.overview??null,genres:Array.isArray(n?.genres)?n.genres:null,language:n?.language??null,country:n?.country??null,initialRating:typeof n?.initialRating=="number"?n.initialRating:n?.initialRating!=null?Number(n.initialRating):null,initiallyInWatchlist:!!n?.initiallyInWatchlist,imdbRating:typeof n?.imdbRating=="number"?n.imdbRating:n?.imdbRating!=null?Number(n.imdbRating):null,rtTomatoMeter:typeof n?.rtTomatoMeter=="number"?n.rtTomatoMeter:n?.rtTomatoMeter!=null?Number(n.rtTomatoMeter):null}};function xr(n){const{card:i,friendCount:o,imdb:b,rt:S}=n;let w=74;const N=i?.source??null;N==="for-you"&&(w+=10),N==="from-friends"&&(w+=7),N==="trending"&&(w+=4),N==="popular"&&(w+=2);const M=typeof i?.friendLikesCount=="number"?i.friendLikesCount:0;if(M>0){const $=o>0?M/Math.max(1,o)*18:Math.min(12,M*3);w+=$}b!=null&&(w+=(b-7)*4),S!=null&&(w+=(S-70)*.15),i?.why&&(w+=3);const g=Math.round(w);return Math.round(x(g,55,99))}const hr=async n=>{const{data:i,error:o}=await fn.from("media_items").select("id, kind, omdb_plot, omdb_director, omdb_writer, omdb_actors, omdb_genre, omdb_language, omdb_country, omdb_imdb_rating, omdb_imdb_votes, omdb_metascore, omdb_rating_rotten_tomatoes, omdb_poster, omdb_awards, omdb_box_office, omdb_released, omdb_rated, omdb_runtime, omdb_fetched_at, omdb_status, omdb_error").eq("id",n).maybeSingle();if(o)throw o;if(!i)return null;const b=i.omdb_genre!=null?String(i.omdb_genre).split(",").map(w=>w.trim()).filter(Boolean):null,S=Mr(i.omdb_rating_rotten_tomatoes);return{title_id:i.id,content_type:i.kind??null,plot:i.omdb_plot??null,omdb_director:i.omdb_director??null,omdb_writer:i.omdb_writer??null,omdb_actors:i.omdb_actors??null,genres:b,omdb_language:i.omdb_language??null,omdb_country:i.omdb_country??null,imdb_rating:i.omdb_imdb_rating??null,imdb_votes:i.omdb_imdb_votes??null,metascore:i.omdb_metascore??null,rt_tomato_pct:S,poster_url:i.omdb_poster??null,omdb_awards:i.omdb_awards??null,omdb_box_office_str:i.omdb_box_office??null,omdb_box_office:null,omdb_released:i.omdb_released??null,omdb_rated:i.omdb_rated??null,omdb_runtime:i.omdb_runtime??null,omdb_fetched_at:i.omdb_fetched_at??null,omdb_status:i.omdb_status??null,omdb_error:i.omdb_error??null}},Re="want_to_watch",Ze="watched",gi=()=>{const n=gr(),[i,o]=a.useState(null),[b,S]=a.useState(!1),[w,N]=a.useState([]),[M,g]=a.useState(0),[$,pe]=a.useState({w:0,h:0});a.useEffect(()=>{if(typeof window>"u")return;let t=0;const r=()=>{cancelAnimationFrame(t),t=requestAnimationFrame(()=>{pe({w:window.innerWidth,h:window.innerHeight})})};return r(),window.addEventListener("resize",r,{passive:!0}),window.addEventListener("orientationchange",r,{passive:!0}),()=>{cancelAnimationFrame(t),window.removeEventListener("resize",r),window.removeEventListener("orientationchange",r)}},[]);const P=a.useMemo(()=>{const t=$.h||844;return t<640?4:t<720?5:t<820?6:t<920?7:8},[$.h]),de=a.useMemo(()=>x(P+2,6,10),[P]),{cards:$e,sessionId:Oe,isLoading:ee,isError:Z,swipe:Wt,fetchMore:fe,trimConsumed:et,swipeSyncError:W,retryFailedSwipe:yt,isRetryingSwipe:Ce,trackImpression:jt,trackDwell:tt,sendEventAsync:q}=Es("combined",{limit:72,kindFilter:i,minImdbRating:M>0?M:null,genresAny:w.length?w:null}),L=a.useMemo(()=>$e.map(Vs),[$e]),Nt=a.useMemo(()=>{const t=new Set;for(const r of L){const l=r?.genres??[];for(const c of l){const d=String(c??"").trim();d&&t.add(d)}}return Array.from(t).sort((r,l)=>r.localeCompare(l))},[L]),Be=sr.useCallback(t=>{if(!t)return!1;if(w.length){const r=Array.isArray(t.genres)?t.genres:[],l=new Set(r.map(d=>String(d).toLowerCase()));if(!w.some(d=>l.has(String(d).toLowerCase())))return!1}if(M>0){const r=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)?t.imdbRating:null;if(r!=null&&r<M)return!1}return!0},[w,M]),[X,je]=a.useState(0),I=$e[X],s=L[X],[u,A]=a.useState(!1),F=a.useRef(!1);a.useEffect(()=>{F.current=u},[u]);const[U,H]=a.useState(()=>typeof window>"u"?!1:!gt(bt)),[Ne,kt]=a.useState([]),Mt=(t,r)=>{t&&kt(l=>{const c=l.includes(t);return r?c?l:[...l,t]:c?l.filter(d=>d!==t):l})},Ue=t=>Mt(s?.id,t),ke=!!s?.id&&Ne.includes(s.id),ue=L[X+1]??null,_r=!!ue?.id&&Ne.includes(ue.id),Sr=!!(ue?.posterUrl&&!_r);a.useEffect(()=>{if(typeof window>"u")return;const t=ue?.posterUrl;if(!t)return;const r=new Image;r.decoding="async",r.src=t},[ue?.posterUrl]);const[Rr,bn]=a.useState(!1),[Fe,_t]=a.useState(!1),[St,Rt]=a.useState(!1),[nt,wn]=a.useState(null),[Cr,Xt]=a.useState(!1),Me=a.useRef(null),gn=a.useRef(new Set),[vn,yn]=a.useState(null),rt=a.useRef(null),[,Fr]=a.useState(0),[Tr,jn]=a.useState(0),Ht=a.useRef(null),Kt=a.useRef(!1),[Ir,Nn]=a.useState(!1),te=s?.id??null,Ct=ue?.id??null,{user:xe}=vr(),st=br();a.useEffect(()=>{if(typeof window>"u"||L.length===0)return;const t=window.requestIdleCallback,r=()=>{const d=Math.min(Math.max(X+1,0),L.length),p=Math.min(L.length,d+8),h=L.slice(d,p).map(v=>{if(!v.id)return null;const E=Je.titleDetail(v.id);return st.getQueryData(E)?null:st.prefetchQuery({queryKey:E,queryFn:()=>hr(v.id),staleTime:1e3*60*30,gcTime:1e3*60*60})});Promise.allSettled(h.filter(Boolean))};if(t){const c=t(r);return()=>{typeof window<"u"&&"cancelIdleCallback"in window&&window.cancelIdleCallback?.(c)}}const l=window.setTimeout(r,280);return()=>window.clearTimeout(l)},[L,X,st]);const{data:it}=dn({queryKey:["title-preview",Ct],enabled:!!Ct,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>{if(!Ct)return null;const{data:t,error:r}=await fn.from("media_items").select("id, omdb_director, omdb_genre, omdb_rating_rotten_tomatoes, omdb_imdb_rating").eq("id",Ct).maybeSingle();if(r)throw r;return t?{omdb_director:t.omdb_director??null,omdb_genre:t.omdb_genre??null,omdb_rating_rotten_tomatoes:t.omdb_rating_rotten_tomatoes??null,omdb_imdb_rating:t.omdb_imdb_rating??null}:null}}),kn=J(it?.omdb_director),Ar=Mr(it?.omdb_rating_rotten_tomatoes),Er=V(it?.omdb_imdb_rating),{data:Te=0}=dn({queryKey:["friendCount",{userId:xe?.id??null}],enabled:!!xe?.id,staleTime:1e3*60*10,gcTime:1e3*60*30,refetchOnWindowFocus:!1,queryFn:async()=>{if(!xe?.id)return 0;const{count:t,error:r}=await fn.from("follows").select("followed_id",{count:"exact",head:!0}).eq("follower_id",xe.id);if(r)throw r;return t??0}}),Mn=Ns(te),_n=Mn.data?.status??null,Sn=Mn.data?.rating??null,[Pr,Ft]=a.useState(null),[Lr,Rn]=a.useState(null),Gt={status:Pr??_n},Tt=wr({mutationFn:async t=>{if(!xe?.id||!I)return;const r={sessionId:Oe,deckId:I.deckId??null,position:I.position??null,mediaItemId:I.id,source:I.source??null,events:[]},l=[];if(t.status!==void 0)if(t.statusKind==="watched"){const c=t.status===Ze;l.push({eventType:"like",payload:{ui:"SwipePage",action:"status",status:"watched",enabled:c}})}else{const c=t.status===Re;l.push({eventType:"watchlist",inWatchlist:c,payload:{ui:"SwipePage",action:"status",status:"watchlist",enabled:c}})}t.ratingStars!==void 0&&l.push({eventType:"rating",rating0_10:Gs(t.ratingStars),payload:{ui:"SwipePage",action:"rating"}}),l.length&&(r.events=l,await q(r))},onSuccess:()=>{xe?.id&&te&&(st.invalidateQueries({queryKey:Je.titleDiary(xe.id,te)}),st.invalidateQueries({queryKey:Je.diaryLibrary(xe.id)}))}}),at=a.useRef(null),Cn=a.useRef(null),It=a.useRef(!1),[Dr,$r]=a.useState(!1),[ze,Fn]=a.useState(!0),[Ye,Tn]=a.useState(!0),At=a.useRef(!0),Et=a.useRef(!0),In=a.useRef(0);a.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{It.current=t.matches,$r(t.matches)};return r(),typeof t.addEventListener=="function"?t.addEventListener("change",r):t.addListener?.(r),()=>{typeof t.removeEventListener=="function"?t.removeEventListener("change",r):t.removeListener?.(r)}},[]),a.useEffect(()=>{if(!(typeof window>"u"))try{const t=gt(cr),r=gt(dr),l=t==null?!0:t==="1",c=r==null?!0:r==="1";Fn(l),Tn(c),At.current=l,Et.current=c}catch{}},[]),a.useEffect(()=>{if(At.current=ze,!(typeof window>"u"))try{De(cr,ze?"1":"0")}catch{}},[ze]),a.useEffect(()=>{if(Et.current=Ye,!(typeof window>"u"))try{De(dr,Ye?"1":"0")}catch{}},[Ye]);const qe=a.useRef({x:0,y:0});a.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const t=window.matchMedia("(pointer: coarse)"),r=()=>{Xe.current=t.matches};return r(),typeof t.addEventListener=="function"?t.addEventListener("change",r):t.addListener?.(r),()=>{typeof t.removeEventListener=="function"?t.removeEventListener("change",r):t.removeListener?.(r)}},[]);const An=()=>{if(typeof window>"u")return null;if(at.current)return at.current;const t=window.AudioContext||window.webkitAudioContext;if(!t)return null;const r=new t;return at.current=r,r},Pt=t=>{Et.current&&(typeof navigator>"u"||typeof navigator.vibrate!="function"||navigator.vibrate(t))},Lt=(t,r=1)=>{if(!Et.current)return;const l=typeof performance<"u"?performance.now():Date.now(),c=In.current||0,d=t==="commit"?0:Ws;if(l-c<d)return;In.current=l;const p=x(r,.2,1);if(t==="threshold"){Pt(8);return}if(t==="snap"){Pt(6);return}if(t==="skip"){Pt(12);return}const m=Math.round(16+p*22);Pt(p>.7?[m,12,m+8]:m)},En=(t,r)=>{if(!At.current||typeof document<"u"&&document.visibilityState==="hidden")return;const l=An();if(!l)return;l.state==="suspended"&&l.resume().catch(()=>{});const c=1+(Math.random()*.06-.03),d=x(r,.2,1),p=l.currentTime,m=.11+d*.08,h=Math.max(1,Math.floor(l.sampleRate*m)),v=l.createBuffer(1,h,l.sampleRate),E=v.getChannelData(0);for(let K=0;K<h;K+=1){const z=1-K/h;E[K]=(Math.random()*2-1)*z}const y=l.createBufferSource();y.buffer=v;const k=l.createBiquadFilter();k.type="bandpass";const _=t==="like"?760:t==="dislike"?520:640,f=t==="like"?1180:t==="dislike"?320:560;k.frequency.setValueAtTime(Math.max(80,_*c),p),k.frequency.exponentialRampToValueAtTime(Math.max(60,f*c),p+m);const T=l.createGain();T.gain.setValueAtTime(1e-4,p),T.gain.exponentialRampToValueAtTime(.09+d*.14,p+.012),T.gain.exponentialRampToValueAtTime(1e-4,p+m),y.connect(k),k.connect(T),T.connect(l.destination),y.start(p),y.stop(p+m+.02);const C=l.createOscillator(),D=l.createGain();C.type=t==="like"?"sine":"triangle";const B=t==="like"?520:t==="dislike"?210:360;C.frequency.setValueAtTime(B*c,p),C.frequency.linearRampToValueAtTime((B+(t==="like"?180:-40))*c,p+m),D.gain.setValueAtTime(1e-4,p),D.gain.exponentialRampToValueAtTime(.04+d*.05,p+.01),D.gain.exponentialRampToValueAtTime(1e-4,p+m),C.connect(D),D.connect(l.destination),C.start(p),C.stop(p+m+.02)},Or=(t,r=1)=>{if(It.current)return;const l=Cn.current;if(!l)return;const c=l.getBoundingClientRect(),d=c.width,p=c.height;if(d<=0||p<=0)return;const m=O.burstDurationMs,h=Math.max(6,Math.round(O.burstBaseCount*x(r,.25,1))),v=t==="like"?Math.min(92,d*.28):Math.max(d-92,d*.72),E=Math.min(92,p*.14),y=t==="like"?"rgba(52,211,153,0.82)":"rgba(251,113,133,0.82)",k=t==="like"?"rgba(255,255,255,0.75)":"rgba(255,255,255,0.7)";for(let _=0;_<h;_++){const f=document.createElement("span"),T=_%5===0;f.className="mn-swipe-burst-dot",f.setAttribute("data-shape",T?"square":"dot");const C=(Math.random()*Math.PI*.9+Math.PI*.05)*(t==="like"?1:-1),D=62+Math.random()*98,B=Math.cos(C)*D,K=-Math.abs(Math.sin(C))*D*(.85+Math.random()*.5),z=5+Math.random()*6,re=(Math.random()*160-80).toFixed(1)+"deg",oe=(.8+Math.random()*.9).toFixed(2);f.style.setProperty("--x",v.toFixed(1)+"px"),f.style.setProperty("--y",E.toFixed(1)+"px"),f.style.setProperty("--dx",B.toFixed(1)+"px"),f.style.setProperty("--dy",K.toFixed(1)+"px"),f.style.setProperty("--rot",re),f.style.setProperty("--s",oe),f.style.setProperty("--sz",z.toFixed(1)+"px"),f.style.setProperty("--dur",m+"ms"),f.style.background=_%3===0?k:y,l.appendChild(f),window.setTimeout(()=>f.remove(),m+60)}},{data:R}=dn({queryKey:Je.titleDetail(te),enabled:!!te,staleTime:1e3*60*30,gcTime:1e3*60*60,refetchOnWindowFocus:!1,queryFn:async()=>te?hr(te):null}),Dt=J(R?.plot)??J(s?.overview)??null,se=R?.genres??s?.genres??null,Br=R?.omdb_country??s?.country??null,Ur=J(Br),Pn=Ps(Ur),Ie=J(R?.omdb_director),Ln=J(R?.omdb_writer),lt=J(R?.omdb_actors),We=R?.imdb_rating??s?.imdbRating??null,Vt=R?.rt_tomato_pct??s?.rtTomatoMeter??null,Qt=R?.metascore??null,Zt=R?.imdb_votes??null,Dn=J(R?.omdb_awards),$n=J(R?.omdb_box_office_str),On=J(R?.omdb_released),Jt=R?.content_type==="movie"||R?.content_type==="series"||R?.content_type==="anime"?R.content_type:s?.type??null,Bn=s,zr=Bn?.certification??Bn?.rated??R?.omdb_rated??null,Un=J(zr),zn=(Array.isArray(se)?se:se?String(se).split(",").map(t=>t.trim()):[])??[],Yn=zn.length>3?zn.slice(3).filter(Boolean):[],Yr=[R?.omdb_language??null,s?.language??null],qn=Array.from(new Set(Yr.map(t=>J(t)).filter(t=>!!t))),en=()=>xe?!0:(alert("Sign in to save this title, rate it, or add it to your watchlist."),!1),Wn=t=>{if(!(!te||!I||!en())){if(t===Re){const r=Gt.status===Re?null:Re;Ft(r),Tt.mutate({status:r,statusKind:"watchlist"});return}if(t===Ze){const r=Gt.status===Ze?null:Ze;Ft(r),Tt.mutate({status:r,statusKind:"watched"})}}},qr=()=>{!te||!I||!en()||(Ft(Re),Tt.mutate({status:Re,statusKind:"watchlist"}),Gr())},Wr=t=>{!te||!I||!en()||(Rn(t),Tt.mutate({ratingStars:t}))},Xn=t=>Gt?.status===t,tn=Lr??(Sn??null);a.useEffect(()=>{Rn(null),Ft(null)},[te,Sn,_n]);const Xr=t=>{Wr(tn===t?null:t)},Hn=()=>typeof window<"u"?_s(`/title/${s?.id??""}`):`/title/${s?.id??""}`,Hr=Hn(),Kr=async t=>{if(!s||!I)return;const r=Hn(),l=`Check this out: ${s.title}`,c=t??l;try{navigator.share?await navigator.share({title:s.title,text:c,url:r}):navigator.clipboard?.writeText?(await navigator.clipboard.writeText(`${c}

${r}`),alert("Link copied to clipboard")):alert(`${c}

${r}`)}catch{}},Kn=!!(s?.posterUrl&&!ke),ie=a.useRef(null),Gn=a.useRef(null),_e=a.useRef({w:0,h:0}),Xe=a.useRef(!1),ae=a.useRef(null),le=a.useRef(null),He=a.useRef(0),Ae=a.useRef(0),Se=a.useRef(0),Ee=a.useRef(!1),me=a.useRef(null),Vn=a.useRef(!1),he=a.useRef(null),Pe=a.useRef(0),ot=a.useRef(null),be=a.useRef(null),ne=a.useRef(null),Q=a.useRef(0),we=a.useRef(null),ge=a.useRef(.5),ve=a.useRef(.5),ct=a.useRef(null),dt=a.useRef(null),$t=a.useRef(null),Ot=a.useRef(null),Ke=a.useRef(null);a.useEffect(()=>{const t=()=>{const r=ie.current;if(!r)return;const l=r.getBoundingClientRect();!l.width||!l.height||(_e.current={w:l.width,h:l.height})};if(t(),!(typeof window>"u"))return window.addEventListener("resize",t,{passive:!0}),()=>window.removeEventListener("resize",t)},[s?.id]);const Gr=()=>{if(!s)return;H(!1),typeof window<"u"&&De(bt,"1");const t=ie.current;t&&(t.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",t.style.transform="perspective(1400px) translateX(0px) translateY(6px) scale(1.02) rotateZ(-1deg)",window.setTimeout(()=>{t.style.transform="perspective(1400px) translateX(0px) translateY(26px) scale(0.95)"},16),t.style.opacity="0"),window.setTimeout(()=>{Qn(0,!0),je(r=>Math.min(r+1,L.length)),t&&(t.style.transition="none",t.style.transform="translateX(0px) translateY(0px) scale(1)",t.style.opacity="1")},220)};a.useEffect(()=>{if(typeof window>"u")return;const t=gt(bt);H(!t)},[]),a.useEffect(()=>{Ue(!1),_t(!1),Rt(!1)},[s?.id]),a.useEffect(()=>{!I||!s||ee||Z||Be(s)||(_t(!1),Rt(!1),je(t=>Math.min(t+1,L.length)))},[I?.id,s?.id,ee,Z,Be]),a.useEffect(()=>{if(!I)return;const t=performance.now();if(Ke.current&&Ot.current&&Ot.current!==I.id){const r=$t.current;if(r!=null){const l=Math.max(0,Math.round(t-r));tt(Ke.current,l)}}if(!Be(s)){Ke.current=null,Ot.current=null,$t.current=null;return}jt(I),Ke.current=I,Ot.current=I.id,$t.current=t},[I?.id,s?.id,Be,tt,jt]),a.useEffect(()=>()=>{if(!Ke.current)return;const t=$t.current;if(t==null)return;const r=Math.max(0,Math.round(performance.now()-t));tt(Ke.current,r)},[]),a.useEffect(()=>{if(typeof window>"u")return;(window.requestIdleCallback??(r=>window.setTimeout(r,180)))(()=>{const r=L.slice(X+1,X+4);for(const l of r){if(!l?.posterUrl)continue;const c=new Image;c.loading="lazy",c.decoding="async",c.src=l.posterUrl}})},[L,X]),a.useEffect(()=>()=>{he.current&&cancelAnimationFrame(he.current),Me.current!=null&&window.clearTimeout(Me.current),rt.current!=null&&window.clearTimeout(rt.current),at.current&&at.current.close().catch(()=>{})},[]),a.useEffect(()=>{const t=L.length-X;t<12&&fe(Math.max(60,t+24))},[L.length,X,fe]),a.useEffect(()=>{if(X<=10)return;const t=Math.min(Math.max(X-6,0),L.length);t>0&&(et(t),je(r=>Math.max(4,r-t)))},[L.length,X,et]);const Qn=a.useCallback((t,r=!1,l)=>{const c=Gn.current;if(!c)return;const d=Xe.current?.96:1,p=vt(_e.current.w,d),m=x(Math.abs(t)/Math.max(1,p),0,1),h=x(t/Math.max(1,p),-1,1),v=.68+m*.32+h*m*.03,E=.9+m*.1+h*m*.02,y=.985+m*.015,k=(1-m)*O.undercardTranslateY,_=(1-m)*O.undercardBlurMax,f=1-m,T=(x(-t*.02,-10,10)+h*m*8)*f,C=x(-t/220,-2.2,2.2)*f,D=l??200;c.style.transition=r?`filter ${D}ms cubic-bezier(0.22,0.61,0.36,1), transform ${D}ms cubic-bezier(0.22,0.61,0.36,1)`:"none",c.style.transform=`translate3d(${T.toFixed(2)}px, ${k.toFixed(2)}px, 0px) rotateZ(${C.toFixed(3)}deg) scale(${y.toFixed(4)})`,c.style.filter=`brightness(${v.toFixed(3)}) saturate(${E.toFixed(3)}) blur(${_.toFixed(2)}px)`},[]),Vr=()=>{typeof performance>"u"||(ot.current=performance.now())},Qr=()=>{if(typeof performance>"u")return 1;const t=ot.current;if(t==null)return 1;const r=(performance.now()-t)/Math.max(1,O.punchDurationMs);if(r>=1)return ot.current=null,1;const l=Math.sin(Math.PI*r);return 1+(O.punchScale-1)*l},ut=(t,r=!1,l,c)=>{const d=ie.current;if(!d)return;const p=It.current,m=Xe.current?.96:1,h=vt(_e.current.w,m),v=ur(_e.current.w,m),y=(xt=>{const Yt=Math.abs(xt),ht=Math.max(1,h)*.7;if(Yt<=ht)return xt;const cn=Yt-ht;return Math.sign(xt)*(ht+cn*.38)})(t),k=x(y,-wt,wt),_=Us(y,wt),f=Math.abs(y)>.5&&me.current==="x";d.style.transformOrigin=f?`${(ve.current*100).toFixed(1)}% ${(ge.current*100).toFixed(1)}%`:"50% 50%";const T=Math.abs(k),C=v*.6,D=x((T-C)/Math.max(1,h-C),0,1),B=k>0?D:0,K=k<0?D:0;d.style.setProperty("--mn-swipe-like-opacity",String(B)),d.style.setProperty("--mn-swipe-nope-opacity",String(K)),d.style.setProperty("--mn-swipe-like-scale",String(.96+B*.04)),d.style.setProperty("--mn-swipe-nope-scale",String(.96+K*.04));const z=x(Math.abs(k)/Math.max(1,h),0,1),re=x((.5-ge.current)*2,-1,1),oe=re<0?-1:1,ce=.55+.45*Math.abs(re),Le=x((ve.current-.5)*2,-1,1),Y=x(Math.abs(Q.current)/1.35,0,1),G=k/fr*ce*oe,ye=x(G*(1+Y*.28),-18,O.rotateZCap),sn=x(k/24+Math.sign(k)*Y*2.8+-Le*z*4.5,-14,O.rotateYCap),zt=x(re*(1.8+Y*2.2)*z,-7,O.rotateXCap);if(p)d.style.setProperty("--mn-swipe-spec-o","0"),d.style.setProperty("--mn-swipe-poster-parallax","0px"),d.style.setProperty("--mn-swipe-poster-parallax-y","0px"),d.style.setProperty("--mn-swipe-bg-parallax","0px"),d.style.boxShadow="0 30px 90px rgba(0,0,0,0.62)",d.style.backdropFilter="blur(8px)";else{const xt=x(.08+z*.22+Y*.12,0,.42),Yt=x(50+k/Math.max(1,h)*18+qe.current.x*12,24,76),ht=x(28+-Se.current/Math.max(1,h)*12+qe.current.y*10,16,66);d.style.setProperty("--mn-swipe-spec-o",xt.toFixed(3)),d.style.setProperty("--mn-swipe-spec-x",`${Yt.toFixed(1)}%`),d.style.setProperty("--mn-swipe-spec-y",`${ht.toFixed(1)}%`),d.style.setProperty("--mn-swipe-poster-parallax",`${(-k*.035).toFixed(2)}px`),d.style.setProperty("--mn-swipe-poster-parallax-y",`${(Se.current*.02).toFixed(2)}px`),d.style.setProperty("--mn-swipe-bg-parallax",`${(k*.02).toFixed(2)}px`);const cn=x(.46+z*.22+Y*.14,.35,.78);d.style.boxShadow=`0 30px 92px rgba(0,0,0,${cn.toFixed(3)})`,d.style.backdropFilter=`blur(${(8+z*8).toFixed(1)}px)`}const an=p?0:x(Se.current*.18,-14,14),ln=-z*(3.2+Y*1.6),cs=Qr(),ds=(1+z*.006+Y*.004)*cs,on=p?{x:0,y:0}:qe.current,us=on.y*-4,ms=on.x*5,ps=on.y*-4,tr=l??320,fs=c??"cubic-bezier(0.16, 1, 0.3, 1)";d.style.transition=r?`transform ${tr}ms ${fs}`:"none",d.style.transform=`
      perspective(1400px)
      translate3d(${_}px, ${ps+ln+an}px, 0px)
      rotateX(${p?0:us+zt}deg)
      rotateY(${p?0:sn+ms}deg)
      rotateZ(${p?0:ye}deg)
      scale(${ds})
    `,He.current=k,Qn(k,r,tr)},Bt=(t=!0,r=0)=>{qe.current={x:0,y:0};const l=Math.abs(r),c=x(l/1.35,0,1),d=t?x(Math.round(320-c*140),170,320):void 0,p=t&&l<.45?"cubic-bezier(0.22, 1.2, 0.36, 1)":"cubic-bezier(0.16, 1, 0.3, 1)";ut(0,t,d,p),He.current=0,ae.current=null,le.current=null,be.current=null,ne.current=null,Q.current=0,Ae.current=0,Se.current=0,Ee.current=!1,me.current=null,ve.current=.5,ge.current=.5,ct.current=null},Zr=(t,r)=>{wn({card:t,direction:r}),Xt(!0),Me.current!=null&&window.clearTimeout(Me.current),Me.current=window.setTimeout(()=>Xt(!1),2800)},Jr=()=>{Xt(!1),wn(null),Me.current!=null&&(window.clearTimeout(Me.current),Me.current=null)},es=()=>{nt&&(je(t=>{const r=t-1;if(r<0)return t;const l=L[r];return l&&l.id===nt.card.id?r:t}),Ut("Reviewing previous card. Swipe actions are already saved."),typeof window<"u"&&window.requestAnimationFrame(()=>Bt(!1)),Jr())},Ut=t=>{yn(t),rt.current!=null&&window.clearTimeout(rt.current),t&&(rt.current=window.setTimeout(()=>yn(null),3200))},ts=(t,r)=>{const l=t.runtimeMinutes??0,c=se??t.genres??[],d=Jt==="series"||t.type==="series",p=c.map(m=>m.toLowerCase());return r==="like"?p.some(m=>m.includes("horror")||m.includes("thriller"))?"We’ll show more intense picks like this.":p.some(m=>m.includes("comedy"))?"We’ll show more light and funny picks like this.":d?"Nice — we’ll bring in more series that match this vibe.":We!=null&&V(We)!=null&&V(We)>=7.5?"Nice pick — we’ll show more highly rated titles like this.":t.friendLikesCount&&t.friendLikesCount>=3?"Your friends are into this — we’ll pull in more friend-favorites.":"Got it — we’ll keep tuning around this kind of title.":r==="dislike"?d?"Looks like this series isn’t your thing — we’ll dial down similar shows.":l>130&&Tr+1>=3?"You’ve skipped a few long movies — we’ll lean toward shorter runtimes.":l>130?"Noted — we’ll be more careful with super long movies.":"Okay, we’ll dial down similar titles in your feed.":r==="skip"?"We’ll move this out of your way and keep the feed feeling fresh.":null},Ge=(t,r=0)=>{if(!s||!I)return;const l=`${I.deckId??"unknown"}:${I.id}`;if(gn.current.has(l)){Ut("That swipe was already saved. Back is for review only."),Bt(!0);return}if(gn.current.add(l),H(!1),typeof window<"u"&&De(bt,"1"),Zr(s,t),Wt({card:I,direction:t}),t==="dislike"&&(s.runtimeMinutes??0)>130?jn(f=>f+1):jn(0),Fr(f=>{const T=f+1,C=ts(s,t);return C&&T>=4&&T%4===0?Ut(C):Ut(null),T}),t==="skip"){const f=ie.current;f&&(f.style.transition="transform 220ms cubic-bezier(0.22,0.61,0.36,1), opacity 220ms ease-out",f.style.transform="perspective(1400px) translateX(0px) translateY(4px) scale(1.03) rotateZ(-1deg)",window.setTimeout(()=>{f.style.transform="perspective(1400px) translateX(0px) translateY(24px) scale(0.95)"},16),f.style.opacity="0");const T=.4;Lt("skip",T),En(t,T),window.setTimeout(()=>{je(C=>Math.min(C+1,L.length)),f&&(f.style.transition="none",f.style.transform="translateX(0px) translateY(0px) scale(1)",f.style.opacity="1")},220);return}const c=t==="like"?1:-1,d=typeof window<"u"?window.innerWidth+240:Xs,p=Math.abs(r),m=x(p/1.35,0,1),h=x(p*260,0,280),v=(d+h)*c,E=x(Math.round(260-m*110),140,260),y=ie.current;if(y){const f=x((.5-ge.current)*2,-1,1),T=f<0?-1:1,C=.55+.45*Math.abs(f),D=x((ve.current-.5)*2,-1,1);y.style.transformOrigin=`${(ve.current*100).toFixed(1)}% ${(ge.current*100).toFixed(1)}%`;const B=It.current,K=v/fr*C*T,z=B?0:x(K*(1+m*.12),-24,24),re=B?0:x(c*(10+m*12)+-D*(4+m*3),-22,22),oe=B?0:x(f*(4+m*2),-8,8),ce=-4-m*14,Le=1.04+m*.04,Y=B?1:1+m*.025,G=B?1:1-m*.018;y.style.transition=`transform ${E}ms cubic-bezier(0.22,0.61,0.36,1)`,y.style.transform=`
        perspective(1400px)
        translate3d(${v}px, ${ce}px, 0px)
        rotateX(${oe}deg)
        rotateY(${re}deg)
        rotateZ(${z}deg)
        scale3d(${(Le*Y).toFixed(4)}, ${(Le*G).toFixed(4)}, 1)
      `}const k=Math.abs(He.current)+Math.abs(r)*220,_=x(k/520,.25,1);Or(t,_),Lt("commit",_),En(t,_),window.setTimeout(()=>{je(f=>Math.min(f+1,L.length)),window.requestAnimationFrame(()=>Bt(!1))},E)},ns=(t,r,l,c,d,p,m,h)=>{if(!s||!I||we.current!=null||d==="touch"&&!p||d==="touch"&&typeof m=="number"&&typeof h=="number"&&m>55&&h>55)return;const E=c instanceof HTMLElement&&!!c.closest('button, a, input, textarea, select, [data-swipe-interactive="true"][role="button"], [data-swipe-interactive="true"][tabindex]:not([tabindex="-1"])');if(Vn.current=E,E)return;Ee.current=!0,we.current=l,me.current=null;try{ie.current?.setPointerCapture(l)}catch{}ae.current=t,le.current=r;const y=ie.current;if(y){const _=y.getBoundingClientRect();_.width>0&&_.height>0?(_e.current={w:_.width,h:_.height},ve.current=x((t-_.left)/_.width,0,1),ge.current=x((r-_.top)/_.height,0,1)):(ve.current=.5,ge.current=.5)}else ve.current=.5,ge.current=.5;Ae.current=0,Se.current=0,He.current=0,Pe.current=0,ot.current=null,be.current=t,ne.current=performance.now(),dt.current=ne.current,Q.current=0;const k=Fe&&Ht.current&&Ht.current.contains(c);Kt.current=!!k},rs=(t,r,l,c,d,p,m)=>{if(we.current!=null&&l!==we.current||!Ee.current||ae.current===null||le.current===null||c==="touch"&&!d||c==="touch"&&typeof p=="number"&&typeof m=="number"&&p>55&&m>55)return;const h=performance.now(),v=t-ae.current,E=r-le.current;if(!F.current&&me.current==null){const Y=Math.abs(v),G=Math.abs(E);if(Y<mn&&G<mn)return;if(G>Y*zs){Ee.current=!1,we.current=null,me.current="y",ae.current=null,le.current=null,be.current=null,ne.current=null,Q.current=0;return}me.current="x",A(!0),F.current=!0,ae.current=t-Math.sign(v)*mn,le.current=r,be.current=t,ne.current=h,Q.current=0,At.current&&An();const ye=ie.current;if(ye)try{ye.setPointerCapture(l)}catch{}}if(!F.current||ae.current===null)return;const y=t-ae.current,k=Xe.current?.96:1,_=vt(_e.current.w,k),f=ur(_e.current.w,k),T=le.current!=null?r-le.current:0,C=Math.abs(y),D=Math.abs(T),B=x((C-D*Ys)/Math.max(1,f),0,1),K=x(1-B*.75-C/Math.max(1,_)*.22,qs,1),z=T*K,re=x((C-f*.55)/Math.max(1,f*.75),0,1),oe=y+Math.sign(y)*pn*.18*re;Ae.current=oe,Se.current=x(z,-70,70);let ce=null;if(oe>f?ce="like":oe<-f&&(ce="dislike"),ce&&ce!==ct.current&&(Lt("threshold",.6),Vr()),ct.current=ce,be.current!==null&&ne.current!==null){const Y=h-ne.current;if(Y>0){const G=(t-be.current)/Y,ye=x(G,-2.5,2.5);Q.current=Q.current*.75+ye*.25}}if(be.current=t,ne.current=h,he.current!=null)return;const Le=()=>{he.current=null;const Y=x(O.dragFollowAlpha,.08,1);let G=Ae.current;if(Ee.current&&F.current&&ne.current!=null){const ye=(typeof performance<"u"?performance.now():Date.now())-ne.current;if(ye>mr){const sn=x((ye-mr)/260,0,1),zt=Math.abs(G);if(zt>f*.45&&zt<_*.86){const an=Math.sign(G)*Math.min(f*.92,_*.84),ln=x(an-G,-pn,pn);G=G+ln*sn}}}Pe.current=Pe.current+(G-Pe.current)*Y,ut(Pe.current),Ee.current&&F.current&&me.current==="x"&&(he.current=window.requestAnimationFrame(Le))};he.current=window.requestAnimationFrame(Le)},Zn=(t,r,l)=>{if(we.current!=null&&t!==we.current)return;const c=F.current;A(!1),F.current=!1,Ee.current=!1;const d=we.current;we.current=null,he.current!=null&&(cancelAnimationFrame(he.current),he.current=null,ut(Pe.current));const p=t??d;if(p!=null)try{ie.current?.releasePointerCapture(p)}catch{}if(!c){const C=me.current==="y",D=ae.current,B=le.current,K=D!=null&&r!=null?r-D:0,z=B!=null&&l!=null?l-B:0,re=dt.current!=null?performance.now()-dt.current:null,oe=!C&&Math.abs(K)<10&&Math.abs(z)<10&&(re==null||re<280)&&!Vn.current;ae.current=null,le.current=null,be.current=null,ne.current=null,Q.current=0,dt.current=null,Ae.current=0,Se.current=0,me.current=null,ve.current=.5,ge.current=.5,ct.current=null,oe&&!(Fe&&Kt.current)&&(_t(ce=>!ce),Rt(!1));return}dt.current=null;const h=x(He.current,-wt,wt)+Q.current*O.velocityProjectionMs,v=Fe&&Kt.current,E=Xe.current?.96:1,y=vt(_e.current.w,E),k=v?y*1.6:y,_=Xe.current?pr*.92:pr,f=v?_*1.4:_,T=Math.abs(h)>=k||Math.abs(Q.current)>=f;if(ae.current=null,le.current=null,be.current=null,ne.current=null,Ae.current=0,Se.current=0,Pe.current=0,ot.current=null,me.current=null,T){Ge(h>=0?"like":"dislike",Q.current),ct.current=null,Q.current=0;return}Lt("snap",x(Math.abs(Q.current)/1.35,.25,.9)),Bt(!0,Q.current)},mt=!s||ee||Z||u,Jn=typeof s?.friendLikesCount=="number"?s.friendLikesCount:0,ss=Te>0?Math.round(Jn/Math.max(1,Te)*100):0;a.useEffect(()=>{const t=r=>{!s||mt||u||(r.key==="ArrowLeft"?(r.preventDefault(),Ge("dislike")):r.key==="ArrowRight"?(r.preventDefault(),Ge("like")):(r.key==="ArrowDown"||r.key===" ")&&(r.preventDefault(),Ge("skip")))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[s,mt,u]);const is=()=>{if(!Cr||!nt)return null;const t=nt.direction==="like"?"Loved it":nt.direction==="dislike"?"Marked as ‘No thanks’":"Saved for ‘Not now’";return e.jsx("div",{className:"pointer-events-none fixed inset-x-0 bottom-4 z-40 flex justify-center px-4 sm:px-0",children:e.jsxs("div",{className:"pointer-events-auto inline-flex items-center gap-3 rounded-md border border-border bg-background/95 px-3 py-2 text-[12px] text-foreground shadow-lg backdrop-blur",children:[e.jsx("span",{children:t}),e.jsx("button",{type:"button","aria-label":"Back to previous card",onClick:es,className:"text-xs font-semibold uppercase tracking-[0.14em] text-primary hover:text-primary/80",children:"Back"})]})})},as=()=>vn?e.jsx("div",{className:"pointer-events-none absolute inset-x-0 top-2 z-30 flex justify-center px-4 sm:px-0",children:e.jsxs("div",{className:"pointer-events-auto inline-flex max-w-md items-start gap-2 rounded-md border border-border bg-background/95 px-3 py-2 text-xs text-muted-foreground shadow-lg backdrop-blur",children:[e.jsx(j,{name:"auto_awesome",className:"mt-0.5 text-[18px] text-primary"}),e.jsx("span",{children:vn})]})}):null,pt=typeof s?.imdbRating=="number"&&!Number.isNaN(s.imdbRating)?s.imdbRating:typeof R?.imdb_rating=="number"&&!Number.isNaN(R.imdb_rating)?R.imdb_rating:V(R?.imdb_rating),ft=typeof s?.rtTomatoMeter=="number"&&!Number.isNaN(s.rtTomatoMeter)?s.rtTomatoMeter:typeof R?.rt_tomato_pct=="number"&&!Number.isNaN(R.rt_tomato_pct)?R.rt_tomato_pct:V(R?.rt_tomato_pct),nn=a.useMemo(()=>xr({card:s??null,friendCount:Te,imdb:pt??null,rt:ft??null}),[s,Te,pt,ft]),Ve=s?(()=>{const t=[];if(s.year&&t.push(String(s.year)),pt!=null&&V(pt)!=null&&t.push(`IMDb ${String(V(pt)?.toFixed(1))}`),ft!=null&&V(ft)!=null&&t.push(`RT ${Math.round(Number(ft))}%`),typeof s.runtimeMinutes=="number"&&s.runtimeMinutes>0){const r=lr(s.runtimeMinutes);r&&t.push(r)}return t.join(" • ")})():"",rn=a.useMemo(()=>{const t=Jt??s?.type??null;return t==="series"?"SERIES":t==="anime"?"ANIME":"MOVIE"},[Jt,s?.type]),er=a.useMemo(()=>{const t=se??s?.genres??null;return(Array.isArray(t)?t:t?String(t).split(",").map(l=>l.trim()).filter(Boolean):[]).map(l=>String(l??"").trim()).filter(Boolean).slice(0,3)},[se,s?.genres]),ls=t=>{if(typeof window<"u"&&window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||u)return;const r=ie.current;if(!r)return;const l=r.getBoundingClientRect(),c=(t.clientX-l.left)/l.width,d=(t.clientY-l.top)/l.height;qe.current={x:(c-.5)*2,y:(d-.5)*2},ut(Ae.current)},os=()=>{u||(qe.current={x:0,y:0},ut(He.current,!0))};return e.jsxs("div",{"data-reduce-motion":Dr?"1":"0",className:"relative flex flex-1 min-h-0 flex-col overflow-hidden overscroll-none h-[calc(100dvh-(5.5rem+env(safe-area-inset-bottom)))] sm:h-[calc(100dvh-(6rem+env(safe-area-inset-bottom)))]",style:Ks,children:[e.jsx("style",{children:Hs}),s?.posterUrl&&e.jsxs("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 -z-10",style:{backgroundImage:`url(${s.posterUrl})`,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-background/40 via-background/70 to-background"}),e.jsx("div",{className:"absolute inset-0 backdrop-blur-2xl"})]}),as(),e.jsxs("div",{className:"relative z-10 flex shrink-0 flex-col gap-[calc(var(--mn-swipe-pad)*0.75)] px-[var(--mn-swipe-pad)] pt-[calc(env(safe-area-inset-top)+var(--mn-swipe-pad)*0.75)]",children:[e.jsxs("header",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:()=>S(!0),className:"inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center text-muted-foreground/90 transition-colors hover:text-foreground","aria-label":"Filters",children:e.jsx(j,{name:"tune",className:"text-[length:var(--mn-swipe-top-icon)]"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold tracking-[0.25em] text-primary/90",children:"DISCOVERY"}),e.jsx("div",{className:"text-[length:var(--mn-swipe-header)] font-semibold text-foreground",children:"For You"})]}),e.jsxs("button",{type:"button",onClick:()=>n("/activity"),className:"relative inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center text-muted-foreground/90 transition-colors hover:text-foreground","aria-label":"Activity",children:[e.jsx(j,{name:"notifications",className:"text-[length:var(--mn-swipe-top-icon)]"}),e.jsx("span",{"aria-hidden":"true",className:"absolute right-[8px] top-[8px] h-2 w-2 rounded-full bg-primary"})]})]}),e.jsx(Ls,{message:W,onRetry:yt,isRetrying:Ce})]}),e.jsxs("div",{className:"relative z-10 flex flex-1 min-h-0 flex-col overflow-visible px-[var(--mn-swipe-pad)]",children:[e.jsxs("div",{className:"relative flex flex-1 min-h-0 items-center justify-center overflow-visible [perspective:1400px]","aria-live":"polite",children:[ee&&!s&&!Z&&e.jsx(ys,{}),Z&&!ee&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(j,{name:"info",className:"text-[32px] text-amber-400"}),e.jsx("p",{children:"We couldn't load your swipe deck."}),e.jsx("button",{type:"button",onClick:()=>fe(32),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Retry"})]}),!ee&&!Z&&!s&&e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-3 text-center text-sm text-muted-foreground",children:[e.jsx(j,{name:"auto_awesome",className:"text-[32px] text-primary"}),e.jsx("p",{children:"All caught up. New cards will appear soon."}),e.jsx("button",{type:"button",onClick:()=>fe(36),className:"mt-1 rounded-md border border-border px-3 py-1.5 text-[12px] font-semibold text-foreground hover:bg-card/70",children:"Refresh deck"})]}),!ee&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative z-10 mx-auto h-full max-h-[720px] w-full max-w-md",children:[ue&&e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0",children:(()=>{const t=ue;if(!t)return null;const r=typeof t.friendLikesCount=="number"?t.friendLikesCount:Array.isArray(t.friendProfiles)?t.friendProfiles.length:0,l=Te>0?Math.round(r/Math.max(1,Te)*100):0,c=typeof t.imdbRating=="number"&&!Number.isNaN(t.imdbRating)?t.imdbRating:Er??null,d=typeof t.rtTomatoMeter=="number"&&!Number.isNaN(t.rtTomatoMeter)?t.rtTomatoMeter:Ar??null,p=xr({card:t,friendCount:Te,imdb:c,rt:d}),m=(()=>{const h=Array.isArray(t.genres)?t.genres:[],v=it?.omdb_genre!=null?String(it.omdb_genre).split(",").map(y=>y.trim()).filter(Boolean):[];return(h.length>0?h:v).map(y=>String(y??"").trim()).filter(Boolean).slice(0,3)})();return e.jsx("div",{ref:Gn,className:"absolute inset-0",style:{filter:"brightness(0.68) saturate(0.9)",willChange:"filter"},children:e.jsx("div",{className:"relative h-full w-full rounded-[var(--mn-swipe-radius)] bg-gradient-to-b from-white/10 via-primary/25 to-white/10 p-[1.25px] shadow-[0_30px_90px_rgba(0,0,0,0.75)]",children:e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-[var(--mn-swipe-radius)] bg-background/20 backdrop-blur-sm",children:[Sr&&t.posterUrl?e.jsx("img",{src:t.posterUrl,alt:qt(t)??`${t.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>Mt(t.id,!0)}):e.jsx("div",{className:"h-full w-full",children:e.jsx(un,{title:t.title})}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/20 to-black/70"}),t.source==="from-friends"&&e.jsx("div",{className:"absolute left-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)]",children:(()=>{const h=t.topFriendName??t.friendProfiles?.[0]?.display_name??t.friendProfiles?.[0]?.username??"",v=Math.max(0,r-1),E=!!h,y=(h.trim().charAt(0)||"F").toUpperCase();return e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-black/30 px-2.5 py-2 shadow-sm backdrop-blur-md",children:[e.jsx("div",{className:"grid h-10 w-10 place-items-center overflow-hidden rounded-full border border-white/20 bg-white/10 text-sm font-semibold text-white/90",children:E&&t.friendProfiles?.[0]?.avatar_url?e.jsx("img",{src:t.friendProfiles[0].avatar_url,alt:h||"Friend",className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("span",{children:y})}),v>0&&e.jsxs("div",{className:"grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-white/10 text-sm font-semibold text-white/90",children:["+",v]}),e.jsx("div",{className:"pr-1 text-sm font-semibold text-white/90",children:E?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary",children:h}),e.jsxs("span",{className:"text-white/80",children:[" ","& others watched"]})]}):e.jsx("span",{className:"text-white/80",children:"From friends"})})]})})()}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-x-0 bottom-0 h-[72%] bg-gradient-to-t from-black/85 via-black/40 to-transparent"}),e.jsxs("div",{className:"relative",children:[(()=>{const h=t.source??"for-you",v=h==="trending"?{label:"Trending",icon:"local_fire_department"}:h==="popular"?{label:"Popular",icon:"stars"}:h==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-primary/25 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-primary-foreground backdrop-blur",children:[e.jsx(j,{name:v.icon,filled:!0,className:"text-[18px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:v.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[p,"% Match"]})]})})(),e.jsx("h2",{className:"line-clamp-2 text-[length:var(--mn-swipe-title)] font-extrabold leading-[1.02] text-white",children:t.title}),kn&&e.jsxs("p",{className:"mt-1 text-[length:var(--mn-swipe-subtitle)] font-semibold text-white/60",children:["Directed by ",kn.split(",")[0]]}),e.jsx("div",{className:"mt-4 text-[length:var(--mn-swipe-meta)] text-white/70 whitespace-nowrap overflow-hidden text-ellipsis",children:[t.year?e.jsx("span",{children:t.year},"y"):null,c!=null?e.jsxs("span",{className:"text-white/70",children:["IMDb ",String(c.toFixed(1))]},"i"):null,d!=null?e.jsxs("span",{className:"text-white/70",children:["RT ",Math.round(d),"%"]},"r"):null,typeof t.runtimeMinutes=="number"&&t.runtimeMinutes>0?e.jsx("span",{children:lr(t.runtimeMinutes)},"t"):null].filter(Boolean).map((h,v)=>e.jsxs(sr.Fragment,{children:[v>0&&e.jsx("span",{className:"mx-1 text-white/30",children:"•"}),h]},v))}),Array.isArray(t.friendProfiles)&&t.friendProfiles.length>0&&e.jsxs("div",{className:"mt-5 flex w-full items-center justify-between gap-3 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-left backdrop-blur-md","aria-label":"Friends summary",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ir,{profiles:t.friendProfiles,max:3,size:32}),e.jsxs("div",{className:"leading-tight",children:[e.jsxs("p",{className:"text-[length:var(--mn-swipe-subtitle)] font-extrabold text-white",children:[x(Math.round(l),0,100),"% of friends"]}),e.jsxs("p",{className:"text-sm font-semibold text-white/60",children:[t.source==="from-friends"?"watched":"liked"," ","this title"]})]})]}),e.jsx("div",{className:"grid h-[var(--mn-swipe-hit)] w-[var(--mn-swipe-hit)] place-items-center rounded-full border border-white/10 bg-white/10 text-white/70",children:e.jsx(j,{name:"chevron_right",className:"text-[length:var(--mn-swipe-top-icon)]"})})]}),m.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:m.map(h=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/10 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-white/75",children:["#",h]},h))})]})]})]})})})})()}),e.jsx("div",{className:"relative h-full w-full rounded-[var(--mn-swipe-radius)] bg-gradient-to-b from-white/10 via-primary/25 to-white/10 p-[1.25px] shadow-[0_30px_90px_rgba(0,0,0,0.75)]",children:e.jsxs("article",{ref:ie,role:"group","aria-roledescription":"Movie card","aria-label":qt(s),className:`relative h-full w-full select-none overflow-hidden rounded-[var(--mn-swipe-radius)] bg-background/20 backdrop-blur-sm transform-gpu will-change-transform ${Fe?"ring-1 ring-primary/40":""}`,onPointerDown:t=>{t.pointerType==="mouse"&&t.button!==0||ns(t.clientX,t.clientY,t.pointerId,t.target,t.pointerType,t.isPrimary,t.width,t.height)},onPointerMove:t=>rs(t.clientX,t.clientY,t.pointerId,t.pointerType,t.isPrimary,t.width,t.height),onPointerUp:t=>Zn(t.pointerId,t.clientX,t.clientY),onPointerCancel:t=>Zn(t.pointerId,t.clientX,t.clientY),onMouseMove:ls,onMouseLeave:os,style:{touchAction:Fe?"pan-y":"none",overscrollBehavior:"contain",userSelect:"none",WebkitUserSelect:"none"},children:[e.jsx("div",{ref:Cn,"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-20 overflow-hidden"}),e.jsxs("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-[-48px] z-[1]",children:[e.jsx("div",{className:"absolute inset-0 blur-3xl bg-emerald-400/30",style:{opacity:"var(--mn-swipe-like-opacity, 0)"}}),e.jsx("div",{className:"absolute inset-0 blur-3xl bg-rose-400/30",style:{opacity:"var(--mn-swipe-nope-opacity, 0)"}})]}),e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-[19]",style:{background:"radial-gradient(circle at var(--mn-swipe-spec-x, 50%) var(--mn-swipe-spec-y, 30%), rgba(255,255,255,0.35), rgba(255,255,255,0) 55%)",opacity:"var(--mn-swipe-spec-o, 0)",mixBlendMode:"soft-light"}}),!Fe&&e.jsxs("div",{className:"relative z-[2] h-full w-full",children:[Kn&&s.posterUrl?e.jsx("img",{src:s.posterUrl,alt:qt(s)??`${s.title} poster`,className:"h-full w-full object-cover",style:{transform:"translate3d(var(--mn-swipe-poster-parallax, 0px), var(--mn-swipe-poster-parallax-y, 0px), 0) scale(1.035)",willChange:"transform"},draggable:!1,loading:"lazy",onError:()=>Ue(!0)}):e.jsx("div",{className:"h-full w-full",style:{transform:"translate3d(var(--mn-swipe-poster-parallax, 0px), var(--mn-swipe-poster-parallax-y, 0px), 0) scale(1.02)",willChange:"transform"},children:e.jsx(un,{title:s.title})}),e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-gradient-to-b from-black/10 via-black/20 to-black/70",style:{transform:"translate3d(var(--mn-swipe-bg-parallax, 0px), 0, 0)",willChange:"transform"}}),e.jsx("div",{className:"pointer-events-none absolute inset-x-[calc(var(--mn-swipe-pad)*1.2)] top-[calc(var(--mn-swipe-pad)*0.8)] flex justify-start",children:e.jsxs("div",{className:`flex items-center gap-2 rounded-md bg-emerald-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-emerald-200 shadow-md backdrop-blur-sm ${u?"":"transition-[opacity,transform] duration-200"}`,style:{opacity:"var(--mn-swipe-like-opacity, 0)",transform:"translate3d(0,0,0) scale(var(--mn-swipe-like-scale, 0.96))"},children:[e.jsx(j,{name:"favorite",filled:!0,className:"text-[18px] text-emerald-300"}),e.jsx("span",{children:"Love it"})]})}),e.jsx("div",{className:"pointer-events-none absolute inset-x-[calc(var(--mn-swipe-pad)*1.2)] top-[calc(var(--mn-swipe-pad)*0.8)] flex justify-end",children:e.jsxs("div",{className:`flex items-center gap-2 rounded-md bg-rose-500/14 px-3 py-1.5 text-xs font-semibold uppercase tracking-[0.14em] text-rose-200 shadow-md backdrop-blur-sm ${u?"":"transition-[opacity,transform] duration-200"}`,style:{opacity:"var(--mn-swipe-nope-opacity, 0)",transform:"translate3d(0,0,0) scale(var(--mn-swipe-nope-scale, 0.96))"},children:[e.jsx(j,{name:"close",className:"text-[18px] text-rose-300"}),e.jsx("span",{children:"No thanks"})]})}),s.source==="from-friends"&&e.jsx("div",{className:"absolute left-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)]",children:(()=>{const t=s.topFriendName??s.friendProfiles?.[0]?.display_name??s.friendProfiles?.[0]?.username??"",r=Math.max(0,Jn-1),l=!!t,c=(t.trim().charAt(0)||"F").toUpperCase();return e.jsxs("div",{className:"flex items-center gap-2 rounded-full border border-white/10 bg-black/30 px-2.5 py-2 shadow-sm backdrop-blur-md",children:[e.jsx("div",{className:"grid h-10 w-10 place-items-center overflow-hidden rounded-full border border-white/20 bg-white/10 text-sm font-semibold text-white/90",children:l&&s.friendProfiles?.[0]?.avatar_url?e.jsx("img",{src:s.friendProfiles[0].avatar_url,alt:t||"Friend",className:"h-full w-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"}):e.jsx("span",{children:c})}),r>0&&e.jsxs("div",{className:"grid h-10 w-10 place-items-center rounded-full border border-white/10 bg-white/10 text-sm font-semibold text-white/90",children:["+",r]}),e.jsx("div",{className:"pr-1 text-sm font-semibold text-white/90",children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-primary",children:t}),e.jsx("span",{className:"text-white/80",children:" & others watched"})]}):e.jsx("span",{className:"text-white/80",children:"From friends"})})]})})()}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-x-0 bottom-0 h-[72%] bg-gradient-to-t from-black/85 via-black/40 to-transparent"}),e.jsxs("div",{className:"relative",children:[(()=>{const t=s.source??"for-you",r=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-primary/25 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-primary-foreground backdrop-blur",children:[e.jsx(j,{name:r.icon,filled:!0,className:"text-[18px]"}),e.jsx("span",{className:"tracking-[0.12em]",children:r.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[nn,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h2",{className:"min-w-0 line-clamp-2 text-[length:var(--mn-swipe-title)] font-extrabold leading-[1.02] text-white",children:s.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-3 py-1 text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:rn})]}),Ie&&e.jsxs("p",{className:"mt-1 text-[length:var(--mn-swipe-subtitle)] font-semibold text-white/60",children:["Directed by ",Ie.split(",")[0]]}),Ve&&e.jsx("div",{className:"mt-4 text-[length:var(--mn-swipe-meta)] text-white/70 whitespace-nowrap overflow-hidden text-ellipsis",children:Ve}),Array.isArray(s.friendProfiles)&&s.friendProfiles.length>0&&e.jsxs("button",{type:"button",onClick:()=>bn(!0),className:"mt-5 flex w-full items-center justify-between gap-3 rounded-2xl border border-white/10 bg-white/10 px-4 py-3 text-left backdrop-blur-md","aria-label":"See friends","data-swipe-interactive":"true",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ir,{profiles:s.friendProfiles,max:3,size:32}),e.jsxs("div",{className:"leading-tight",children:[e.jsxs("p",{className:"text-[length:var(--mn-swipe-subtitle)] font-extrabold text-white",children:[x(Math.round(ss),0,100),"% of friends"]}),e.jsxs("p",{className:"text-sm font-semibold text-white/60",children:[s.source==="from-friends"?"watched":"liked"," ","this title"]})]})]}),e.jsx("div",{className:"grid h-[var(--mn-swipe-hit)] w-[var(--mn-swipe-hit)] place-items-center rounded-full border border-white/10 bg-white/10 text-white/70",children:e.jsx(j,{name:"chevron_right",className:"text-[length:var(--mn-swipe-top-icon)]"})})]}),er.length>0&&e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:er.map(t=>e.jsxs("span",{className:"inline-flex items-center rounded-full border border-white/10 bg-white/10 px-3 py-1.5 text-[length:var(--mn-swipe-chip)] font-semibold text-white/75",children:["#",t]},t))})]})]})]}),Fe&&s&&e.jsxs("div",{className:"absolute inset-0 z-10 flex h-full flex-col",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden bg-[#261933]",children:[Kn&&s.posterUrl?e.jsx("img",{src:s.posterUrl,alt:qt(s)??`${s.title} poster`,className:"h-full w-full object-cover",draggable:!1,loading:"lazy",onError:()=>Ue(!0),style:{filter:"blur(6px) brightness(0.60)",transform:"scale(1.14)"}}):e.jsx(un,{title:s.title}),e.jsx("div",{className:"pointer-events-none absolute inset-0 z-0 bg-gradient-to-b from-black/10 via-black/60 to-[#261933]"})]}),e.jsx("button",{type:"button",onClick:()=>_t(!1),className:"absolute right-[var(--mn-swipe-pad)] top-[var(--mn-swipe-pad)] z-20 inline-flex h-[var(--mn-swipe-top-hit)] w-[var(--mn-swipe-top-hit)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/80 backdrop-blur hover:bg-white/15","aria-label":"Close details","data-swipe-interactive":"true",children:e.jsx(j,{name:"close",className:"text-[length:var(--mn-swipe-top-icon)]"})}),e.jsxs("div",{className:"relative z-10 flex min-h-0 flex-1 flex-col px-[var(--mn-swipe-pad)] pb-[var(--mn-swipe-pad)] pt-[calc(var(--mn-swipe-top-hit)+var(--mn-swipe-pad)*0.75)]",children:[e.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute inset-0 z-0 bg-gradient-to-b from-[#261933]/35 via-[#261933]/90 to-[#261933]"}),e.jsxs("div",{ref:Ht,id:"swipe-detail-panel","aria-label":St?"Full details":"Details summary","aria-live":"polite",className:"relative z-10 mt-1 flex min-h-0 flex-1 flex-col text-left text-[13px] text-white/70",children:[e.jsx("div",{"data-swipe-interactive":"true",className:"flex min-h-0 flex-1 flex-col overflow-hidden",children:St?e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[e.jsxs("div",{className:"shrink-0 space-y-2",children:[(()=>{const t=s.source??"for-you",r=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.25)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/80",children:[e.jsx(j,{name:r.icon,filled:!0,className:"text-[length:calc(var(--mn-swipe-chip)+0.25rem)]"}),e.jsx("span",{className:"tracking-[0.12em]",children:r.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[nn,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"min-w-0 line-clamp-1 text-[clamp(1.05rem,4.6vw,1.35rem)] font-extrabold text-white",children:s.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.7)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:rn})]}),Ve&&e.jsx("p",{className:"text-[length:var(--mn-swipe-meta)] text-white/55 whitespace-nowrap overflow-hidden text-ellipsis",children:Ve})]}),e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-2 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 grid grid-cols-2 gap-x-3 gap-y-2 rounded-2xl border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.5)] text-[length:var(--mn-swipe-chip)] leading-snug text-white/75",children:(()=>{const t=[];if(Yn.length>0&&t.push({label:"Genres",value:Yn.slice(0,6).join(", ")}),qn.length>0&&t.push({label:"Languages",value:qn.slice(0,4).join(", ")}),Ie&&t.push({label:"Director",value:Ie}),Ln&&t.push({label:"Writers",value:Ln}),lt){const l=lt.split(",").map(c=>c.trim()).filter(Boolean).slice(3);l.length>0&&t.push({label:"More cast",value:l.slice(0,8).join(", ")})}return On&&t.push({label:"Released",value:On}),Dn&&t.push({label:"Awards",value:Dn}),$n&&t.push({label:"Box office",value:$n}),We&&V(We)!=null&&t.push({label:"IMDb",value:String(V(We)?.toFixed(1))}),Vt&&V(Vt)!=null&&t.push({label:"RT",value:`${String(V(Vt))}%`}),Zt&&or(Zt)&&t.push({label:"IMDb votes",value:String(or(Zt))}),Qt&&V(Qt)!=null&&t.push({label:"Metascore",value:String(V(Qt))}),t.slice(0,10).map(r=>e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.14em] text-white/45",children:r.label}),e.jsx("p",{className:"line-clamp-2",children:r.value})]},r.label))})()}),e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden rounded-2xl border border-white/10 bg-white/10 px-3 py-2",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.14em] text-white/45",children:"Overview"}),Dt?e.jsx("p",{className:"mt-1 min-h-0 flex-1 overflow-hidden text-[length:var(--mn-swipe-meta)] leading-relaxed text-white/70",style:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:de,overflow:"hidden"},children:Dt}):e.jsx("p",{className:"mt-1 text-[length:var(--mn-swipe-meta)] text-white/40",children:"No overview available."})]})]})]}):e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col gap-3",children:[e.jsxs("div",{className:"shrink-0 space-y-2",children:[(()=>{const t=s.source??"for-you",r=t==="trending"?{label:"Trending",icon:"local_fire_department"}:t==="popular"?{label:"Popular",icon:"stars"}:t==="from-friends"?{label:"From Friends",icon:"group"}:{label:"For You",icon:"auto_awesome"};return e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.25)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/80",children:[e.jsx(j,{name:r.icon,filled:!0,className:"text-[length:calc(var(--mn-swipe-chip)+0.25rem)]"}),e.jsx("span",{className:"tracking-[0.12em]",children:r.label}),e.jsx("span",{className:"text-white/35",children:"•"}),e.jsxs("span",{className:"font-semibold text-emerald-300",children:[nn,"% Match"]})]})})(),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("h3",{className:"min-w-0 line-clamp-2 text-[clamp(1.25rem,5vw,1.75rem)] font-extrabold leading-[1.06] text-white",children:s.title}),e.jsx("span",{className:"shrink-0 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.7)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-extrabold tracking-[0.14em] text-white/75",children:rn})]}),Ve&&e.jsx("p",{className:"text-[clamp(0.78rem,2.8vw,0.95rem)] text-white/60 whitespace-nowrap overflow-hidden text-ellipsis",children:Ve}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 text-[clamp(0.70rem,2.6vw,0.8rem)] text-white/65",children:[se&&e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-2",children:[e.jsx("span",{className:"shrink-0 font-semibold text-white/75",children:"Genres"}),e.jsx("span",{className:"min-w-0 flex-1 truncate",children:Array.isArray(se)?se.slice(0,3).join(", "):String(se).split(",").map(t=>t.trim()).slice(0,3).join(", ")})]}),Un&&e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 font-semibold text-white/85",children:Un}),Pn&&e.jsx("span",{className:"rounded-full border border-white/10 bg-white/10 px-2 py-0.5 font-semibold text-white/70",children:Pn})]})]}),Dt?e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col overflow-hidden rounded-2xl border border-white/10 bg-white/10 px-3 py-2",children:[e.jsx("p",{className:"text-[length:var(--mn-swipe-kicker)] font-semibold uppercase tracking-[0.16em] text-white/45",children:"Overview"}),e.jsx("p",{className:"mt-1 min-h-0 flex-1 overflow-hidden text-[clamp(0.82rem,2.9vw,0.95rem)] leading-relaxed text-white/70",style:{display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:P,overflow:"hidden"},children:Dt})]}):e.jsx("div",{className:"min-h-0 flex-1"}),Ie||lt?e.jsxs("div",{className:"shrink-0 min-w-0 space-y-1 text-[clamp(0.70rem,2.6vw,0.78rem)] text-white/70",children:[Ie&&e.jsxs("p",{className:"line-clamp-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-white/75",children:"Director:"})," ",e.jsx("span",{className:"min-w-0",children:Ie})]}),lt&&e.jsxs("p",{className:"line-clamp-1 min-w-0",children:[e.jsx("span",{className:"font-semibold text-white/75",children:"Cast:"})," ",e.jsx("span",{className:"min-w-0",children:lt.split(",").map(t=>t.trim()).filter(Boolean).slice(0,4).join(", ")})]})]}):null,e.jsxs("div",{className:"shrink-0 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/10 px-3 py-1.5",children:[e.jsx("span",{className:"text-[length:var(--mn-swipe-chip)] font-semibold text-white/50",children:"Your rating"}),e.jsx("div",{className:"flex items-center gap-0.5","aria-label":"Your rating",children:Array.from({length:5}).map((t,r)=>{const l=r+1,c=tn!=null&&tn>=l;return e.jsx("button",{type:"button",onClick:()=>Xr(l),className:"flex h-[var(--mn-swipe-star-hit)] w-[var(--mn-swipe-star-hit)] items-center justify-center rounded-full hover:scale-105 focus-visible:outline-none",children:e.jsx(j,{name:"star",filled:c,className:`text-[length:var(--mn-swipe-star-icon)] ${c?"text-yellow-400":"text-white/30"}`})},l)})})]}),e.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-1.5",children:[e.jsx("button",{type:"button",onClick:()=>Wn(Re),className:`inline-flex items-center rounded-full px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold transition-colors ${Xn(Re)?"bg-primary/90 text-primary-foreground":"border border-white/10 bg-white/10 text-white/75 hover:bg-white/15"}`,children:"Watchlist"}),e.jsx("button",{type:"button",onClick:()=>Wn(Ze),className:`inline-flex items-center rounded-full px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold transition-colors ${Xn(Ze)?"bg-emerald-500/90 text-primary-foreground":"border border-white/10 bg-white/10 text-white/75 hover:bg-white/15"}`,children:"Watched"}),e.jsxs("button",{type:"button",onClick:()=>Nn(!0),className:"inline-flex items-center gap-1 rounded-full border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/75 hover:bg-white/15",children:[e.jsx(j,{name:"share",className:"text-[length:calc(var(--mn-swipe-chip)+0.2rem)]"}),e.jsx("span",{className:"hidden sm:inline",children:"Share"})]})]})]}),typeof s.friendLikesCount=="number"&&s.friendLikesCount>0||s.topFriendName&&s.topFriendReviewSnippet?e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/10 px-[calc(var(--mn-swipe-pad)*0.75)] py-[calc(var(--mn-swipe-pad)*0.5)] text-[length:var(--mn-swipe-chip)] text-white/80 shadow-md",children:[typeof s.friendLikesCount=="number"&&s.friendLikesCount>0&&e.jsxs("div",{className:"inline-flex items-center gap-1 text-[length:var(--mn-swipe-chip)] text-white/60",children:[e.jsx(j,{name:"local_fire_department",filled:!0,className:"text-[16px] text-primary/80"}),s.friendLikesCount===1?"1 friend likes this":`${s.friendLikesCount} friends like this`]}),s.topFriendName&&s.topFriendReviewSnippet&&e.jsxs("div",{className:"mt-1 inline-flex w-full items-start gap-2 text-left",children:[e.jsx(j,{name:"check_circle",filled:!0,className:"mt-0.5 text-[16px] text-primary"}),e.jsxs("span",{className:"block line-clamp-2 text-[length:var(--mn-swipe-chip)]",children:[s.topFriendName,": “",s.topFriendReviewSnippet,"”"]})]})]}):null]})]})}),e.jsx("div",{className:"mt-2 flex shrink-0 justify-end",children:e.jsx("button",{type:"button",onClick:()=>Rt(t=>!t),"aria-expanded":St,"aria-controls":"swipe-detail-panel",className:"inline-flex items-center gap-1 rounded-full border border-white/15 bg-white/5 px-[calc(var(--mn-swipe-pad)*0.6)] py-[calc(var(--mn-swipe-pad)*0.22)] text-[length:var(--mn-swipe-chip)] font-semibold text-white/70 hover:bg-white/10 hover:text-white",children:e.jsx("span",{children:St?"Collapse":"Full details"})})})]})]})]})]},te??"empty")})]}),U&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center bg-gradient-to-b from-background/70 via-background/50 to-background/80",children:e.jsxs("div",{className:"pointer-events-auto max-w-xs rounded-2xl border border-border bg-background/95 p-4 text-center shadow-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Swipe to decide"}),e.jsx("p",{className:"mt-1 text-[12px] text-muted-foreground",children:"Swipe left to pass, right to save what you love."}),e.jsx("button",{type:"button",className:"mt-3 w-full rounded-xl bg-primary px-3 py-2 text-sm font-semibold text-white shadow-md",onClick:()=>{H(!1),typeof window<"u"&&De(bt,"1")},children:"Got it"})]})})]})]}),e.jsxs("div",{className:"mt-2 flex shrink-0 items-center justify-center gap-[var(--mn-swipe-gap)]","aria-label":"Swipe actions",children:[e.jsx("button",{type:"button",onClick:()=>Ge("dislike"),disabled:mt,className:"inline-flex h-[var(--mn-swipe-action)] w-[var(--mn-swipe-action)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/60 shadow-md backdrop-blur transition-all duration-150 hover:bg-white/15 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Dislike",children:e.jsx(j,{name:"close",className:"text-[length:var(--mn-swipe-icon)]"})}),e.jsx("button",{type:"button",onClick:qr,disabled:mt,className:"relative inline-flex h-[var(--mn-swipe-action-primary)] w-[var(--mn-swipe-action-primary)] items-center justify-center rounded-full bg-primary text-primary-foreground shadow-[0_22px_55px_rgba(0,0,0,0.55)] transition-all duration-150 hover:brightness-110 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Add to watchlist",children:e.jsx(j,{name:"bookmark_add",filled:!0,className:"text-[length:var(--mn-swipe-icon-primary)]"})}),e.jsx("button",{type:"button",onClick:()=>Ge("like"),disabled:mt,className:"inline-flex h-[var(--mn-swipe-action)] w-[var(--mn-swipe-action)] items-center justify-center rounded-full border border-white/10 bg-white/10 text-white/60 shadow-md backdrop-blur transition-all duration-150 hover:bg-white/15 active:translate-y-[1px] disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Like",children:e.jsx(j,{name:"favorite",filled:!0,className:"text-[length:var(--mn-swipe-icon)]"})})]}),e.jsx(Qs,{isOpen:Ir,onClose:()=>Nn(!1),activeCard:s,shareUrl:Hr,onShareExternal:Kr}),e.jsx($s,{open:Rr,onOpenChange:bn,profiles:s?.friendProfiles??[],verb:s?.source==="from-friends"?"watched":"liked"}),e.jsx(yr,{open:b,onOpenChange:S,children:e.jsxs(jr,{className:"max-w-md border border-border/60 bg-card text-foreground",children:[e.jsxs(Nr,{children:[e.jsx(kr,{children:"Filters"}),e.jsx(Ms,{className:"text-muted-foreground",children:"Fine-tune what shows up in your Discovery deck."})]}),e.jsxs("div",{className:"mt-2 space-y-5",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs font-semibold tracking-wide text-muted-foreground",children:"Feedback"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>Tn(t=>!t),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",Ye?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[e.jsx(j,{name:"vibration",filled:!0,className:"text-[18px] "+(Ye?"text-primary":"text-muted-foreground")}),"Haptics"]}),e.jsxs("button",{type:"button",onClick:()=>Fn(t=>!t),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",ze?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[e.jsx(j,{name:ze?"volume_up":"volume_off",filled:!0,className:"text-[18px] "+(ze?"text-primary":"text-muted-foreground")}),"Sound"]})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Turn these off if you prefer silent, minimal feedback."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs font-semibold tracking-wide text-muted-foreground",children:"Content type"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{label:"All",value:null},{label:"Movies",value:"movie"},{label:"Series",value:"series"},{label:"Anime",value:"anime"}].map(t=>{const r=i===t.value;return e.jsxs("button",{type:"button",onClick:()=>o(t.value),className:["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-semibold transition",r?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-background/30 text-muted-foreground hover:bg-background/45"].join(" "),children:[r?e.jsx(j,{name:"check_circle",filled:!0,className:"text-[18px] text-primary"}):e.jsx("span",{className:"h-4 w-4"}),t.label]},t.label)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide text-muted-foreground",children:"Genres"}),w.length>0&&e.jsx("button",{type:"button",onClick:()=>N([]),className:"text-xs font-semibold text-primary hover:underline",children:"Clear"})]}),Nt.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Load a few cards to unlock genre filters."}):e.jsx("div",{className:"max-h-40 overflow-auto rounded-xl border border-border/60 bg-background/20 p-2",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Nt.map(t=>{const r=w.some(l=>l.toLowerCase()===t.toLowerCase());return e.jsx("button",{type:"button",onClick:()=>N(l=>r?l.filter(c=>c.toLowerCase()!==t.toLowerCase()):[...l,t]),className:["rounded-full border px-3 py-1 text-xs font-semibold transition",r?"border-primary/60 bg-primary/15 text-foreground":"border-border/60 bg-card/40 text-muted-foreground hover:bg-card/55"].join(" "),children:t},t)})})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold tracking-wide text-muted-foreground",children:"Minimum rating"}),e.jsx("div",{className:"text-xs font-semibold text-foreground",children:M<=0?"Any":M.toFixed(1)})]}),e.jsx("input",{type:"range",min:0,max:10,step:.5,value:M,onChange:t=>g(Number(t.target.value)),className:"w-full"}),e.jsxs("div",{className:"mt-1 flex justify-between text-[11px] text-muted-foreground",children:[e.jsx("span",{children:"0"}),e.jsx("span",{children:"10"})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{o(null),N([]),g(0)},className:"flex-1 rounded-xl border border-border/60 bg-background/20 px-4 py-2 text-sm font-semibold text-muted-foreground hover:bg-background/35",children:"Reset"}),e.jsx("button",{type:"button",onClick:()=>S(!1),className:"flex-1 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground hover:opacity-90",children:"Done"})]})]})]})}),is()]})]})},Qs=({isOpen:n,onClose:i,activeCard:o,shareUrl:b,onShareExternal:S})=>{const{user:w}=vr(),{data:N=[],isLoading:M}=js();if(a.useEffect(()=>{if(!n)return;const P=de=>{de.key==="Escape"&&i()};return window.addEventListener("keydown",P),()=>window.removeEventListener("keydown",P)},[n,i]),!n||!o)return null;const g=`Check this out: ${o.title}

${b}`,$=P=>{P.target===P.currentTarget&&i()},pe=P=>{(P.key==="Enter"||P.key===" ")&&i()};return e.jsx("div",{role:"button",tabIndex:0,className:"fixed inset-0 z-[9999] flex flex-col justify-end bg-black/55",onClick:$,onKeyDown:pe,children:e.jsxs("div",{role:"dialog","aria-modal":"true",className:"pointer-events-auto mb-[72px] w-full max-w-md self-center rounded-t-2xl bg-card pb-3 pt-2 shadow-[0_-18px_45px_rgba(0,0,0,0.65)]",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 pb-2",children:[e.jsx("button",{type:"button","aria-hidden":"true",tabIndex:-1,className:"rounded-full p-1 text-muted-foreground",children:e.jsx(j,{name:"search",className:"text-[18px]"})}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:"Send to"}),e.jsx("button",{type:"button",onClick:i,className:"rounded-full p-1 text-muted-foreground hover:bg-background/80",children:e.jsx("span",{className:"text-[18px] leading-none",children:"×"})})]}),e.jsxs("section",{className:"border-t border-border px-4 pt-3 pb-2",children:[e.jsx("h2",{className:"mb-2 text-[12px] font-medium uppercase tracking-[0.08em] text-muted-foreground/90",children:"Send to"}),M?e.jsx("div",{className:"flex gap-3 overflow-hidden",children:Array.from({length:4}).map((P,de)=>e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"h-11 w-11 animate-pulse rounded-full bg-border/50"}),e.jsx("div",{className:"h-2.5 w-12 animate-pulse rounded bg-border/40"})]},de))}):w?N.length===0?e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"No conversations yet. Start a chat from a profile or the Messages tab."}):e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:N.map(P=>e.jsx(Zs,{conversation:P,text:g},P.id))}):e.jsx("p",{className:"text-[12px] text-muted-foreground/80",children:"Sign in to share via messages."})]}),e.jsx("section",{className:"border-t border-border px-4 pt-3 pb-3",children:e.jsxs("div",{className:"flex gap-3 overflow-x-auto pb-1 pt-0.5",children:[e.jsx(ei,{shareUrl:b,title:o.title}),e.jsx(ti,{shareUrl:b,title:o.title}),e.jsx(ni,{onShareExternal:S}),e.jsx(Js,{shareUrl:b})]})})]})})},Zs=({conversation:n,text:i})=>{const o=n.isGroup?null:n.participants?.find(g=>!g.isSelf)??n.participants?.[0],b=o?.displayName??n.title??"Conversation",S=o?.avatarUrl,w=ks(n.id),N=()=>{w.isPending||w.mutate({text:i})},M=b.split(" ").map(g=>g.charAt(0).toUpperCase()).slice(0,2).join("");return e.jsxs("button",{type:"button",onClick:N,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center overflow-hidden rounded-full bg-muted text-xs text-muted-foreground",children:S?e.jsx("img",{src:S,alt:b,className:"h-full w-full object-cover"}):e.jsx("span",{children:M})}),w.isSuccess&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-emerald-500",children:e.jsx(j,{name:"check",filled:!0,className:"text-[14px] text-primary-foreground"})})]}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:b})]})},Js=({shareUrl:n})=>{const i=async()=>{if(navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(n)}catch{}};return e.jsxs("button",{type:"button",onClick:i,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx(j,{name:"link",className:"text-[18px] text-primary-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Copy link"})]})},ei=({shareUrl:n,title:i})=>{const o=()=>{if(typeof window>"u")return;const b=`Check this out: ${i}

${n}`,S=`https://api.whatsapp.com/send?text=${encodeURIComponent(b)}`;window.open(S,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:o,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"W"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"WhatsApp"})]})},ti=({shareUrl:n,title:i})=>{const o=()=>{if(typeof window>"u")return;const b=`Check this out: ${i}

${n}`,S=`https://t.me/share/url?url=${encodeURIComponent(n)}&text=${encodeURIComponent(b)}`;window.open(S,"_blank","noopener,noreferrer")};return e.jsxs("button",{type:"button",onClick:o,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary",children:e.jsx("span",{className:"text-[16px] font-semibold text-white",children:"T"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"Telegram"})]})},ni=({onShareExternal:n})=>{const i=async()=>{await n()};return e.jsxs("button",{type:"button",onClick:i,className:"flex w-[72px] flex-col items-center gap-1 text-center",children:[e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full border border-border bg-muted",children:e.jsx(j,{name:"more_horiz",className:"text-[18px] text-muted-foreground"})}),e.jsx("span",{className:"line-clamp-2 max-w-[72px] text-xs text-foreground",children:"More"})]})};export{gi as default};
